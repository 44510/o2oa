{"x_component_process_Xform_$Input.js.html":{"url":"x_component_process_Xform_$Input.js.html","title":"x_component_process_Xform/$Input.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/$Input.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/$Input.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class $Input 组件类，此类为所有输入组件的父类\r * @hideconstructor\r * @o2category FormComponents\r * @extends MWF.xApplication.process.Xform.$Module\r * @abstract\r */\r MWF.xApplication.process.Xform.$Input = MWF.APP$Input = new Class(\r /** @lends MWF.xApplication.process.Xform.$Input# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Module,\r \ticonStyle: \"personfieldIcon\",\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r \t\r \t_loadUserInterface: function(){\r \t\tthis._loadNode();\r if (this.json.compute === \"show\"){\r this._setValue(this._computeValue());\r }else{\r this._loadValue();\r }\r \t},\r _loadDomEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)===-1){\r (this.node.getFirst() || this.node).addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r _loadEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }else{\r (this.node.getFirst() || this.node).addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r addModuleEvent: function(key, fun){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }else{\r (this.node.getFirst() || this.node).addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }\r },\r \r _loadNode: function(){\r if (this.readonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r },\r loadDescription: function(){\r if (this.readonly || this.json.isReadonly)return;\r var v = this._getBusinessData();\r if (!v){\r if (this.json.description){\r var size = this.node.getFirst().getSize();\r var w = size.x-3;\r if( this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ){\r if (COMMON.Browser.safari) w = w-20;\r }\r \r /**\r * @summary 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点.\r * @member {Element}\r */\r this.descriptionNode = new Element(\"div\", {\"styles\": this.form.css.descriptionNode, \"text\": this.json.description}).inject(this.node);\r this.descriptionNode.setStyles({\r \"width\": \"\"+w+\"px\",\r \"height\": \"\"+size.y+\"px\",\r \"line-height\": \"\"+size.y+\"px\"\r });\r this.setDescriptionEvent();\r }\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r this.descriptionNode.addEvents({\r \"mousedown\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.clickSelect();\r }.bind(this)\r });\r this.node.getFirst().addEvents({\r \"focus\": function(){\r if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"none\");\r }.bind(this),\r \"blur\": function(){\r if (!this.node.getFirst().get(\"value\")) if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"block\");\r }.bind(this)\r });\r }\r },\r checkDescription: function(){\r if (!this.node.getFirst().get(\"value\")){\r if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"block\");\r }else{\r if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"none\");\r }\r },\r _resetNodeEdit: function(){\r var input = new Element(\"input\", {\r \"styles\": {\r \"background\": \"transparent\",\r \"width\": \"100%\",\r \"border\": \"0px\"\r },\r \"readonly\": true\r });\r \r var node = new Element(\"div\", {\"styles\": {\r \"overflow\": \"hidden\",\r \"position\": \"relative\",\r \"margin-right\": \"20px\",\r \"padding-right\": \"4px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r \r this.node.destroy();\r this.node = node;\r },\r _loadNodeEdit: function(){\r \t if (!this.json.preprocessing) this._resetNodeEdit();\r \t var input = this.node.getFirst();\r input.set(this.json.properties);\r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type,\r \t\t\t\"readonly\": true,\r \t\t\t\"events\": {\r \t\t\t\t\"click\": this.clickSelect.bind(this)\r \t\t\t}\r \t\t});\r if (this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ){\r this.iconNode = new Element(\"div\", {\r \"styles\": this.form.css[this.iconStyle],\r \"events\": {\r \"click\": this.clickSelect.bind(this)\r }\r }).inject(this.node, \"before\");\r }else if( this.form.json.nodeStyleWithhideModuleIcon ){\r this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon)\r }\r \r this.node.getFirst().addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r }.bind(this));\r \t},\r _loadStyles: function(){\r if (this.json.styles) this.node.setStyles(this.json.styles);\r if (this.json.inputStyles) if (this.node.getFirst()) this.node.getFirst().setStyles(this.json.inputStyles);\r if (this.iconNode &amp;&amp; this.iconNode.offsetParent !== null){\r var size = this.node.getSize();\r //if (!size.y){\r // var y1 = this.node.getStyle(\"height\");\r // var y2 = this.node.getFirst().getStyle(\"height\");\r // alert(y1+\",\" +y2);\r // var y = ((y1!=\"auto\" &amp;&amp; y1>y2) || y2==\"auto\") ? y1 : y2;\r // size.y = (y==\"auto\") ? \"auto\" : y.toInt();\r // //alert(size.y)\r //}\r this.iconNode.setStyle(\"height\", \"\"+size.y+\"px\");\r //alert(this.iconNode.getStyle(\"height\"))\r }\r },\r _computeValue: function(value){\r return (this.json.defaultValue &amp;&amp; this.json.defaultValue.code) ? this.form.Macro.exec(this.json.defaultValue.code, this): (value || \"\");\r },\r \tgetValue: function(){\r if (this.moduleValueAG) return this.moduleValueAG;\r var value = this._getBusinessData();\r if (!value) value = this._computeValue();\r \t\treturn value || \"\";\r \t},\r _setValue: function(value){\r \t // if (value &amp;&amp; value.isAG){\r \t // var ag = o2.AG.all(value).then(function(v){\r \t // if (o2.typeOf(v)==\"array\") v = v[0];\r // this.__setValue(v);\r // }.bind(this));\r // this.moduleValueAG = ag;\r \t // ag.then(function(){\r // this.moduleValueAG = null;\r // }.bind(this));\r // }else {\r if (!!value &amp;&amp; o2.typeOf(value.then)==\"function\"){\r var p = o2.promiseAll(value).then(function(v){\r this.__setValue(v);\r }.bind(this), function(){});\r this.moduleValueAG = p;\r p.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r }else{\r this.moduleValueAG = null;\r this.__setValue(value);\r }\r \r //this.__setValue(value);\r // }\r \r },\r __setValue: function(value){\r this._setBusinessData(value);\r if (this.node.getFirst()) this.node.getFirst().set(\"value\", value || \"\");\r if (this.readonly || this.json.isReadonly) this.node.set(\"text\", value);\r this.moduleValueAG = null;\r return value;\r },\r \r \t_loadValue: function(){\r this._setValue(this.getValue());\r \t},\r \tclickSelect: function(){\r \t},\r \t_afterLoaded: function(){\r //\t\tif (this.iconNode){\r ////\t\t\tvar p = this.node.getPosition();\r ////\t\t\tvar s = this.node.getSize();\r ////\t\t\tvar is = this.iconNode.getSize();\r ////\r ////\t\t\tvar y = p.y;\r ////\t\t\tvar x = p.x+s.x-is.x;\r //\t\t\tthis.iconNode.setStyles({\r //\t\t\t\t\"top\": \"5px\",\r //\t\t\t\t\"left\": \"-18px\"\r //\t\t\t});\r //\t\t}\r if (!this.readonly &amp;&amp; !this.json.isReadonly ){\r this.loadDescription();\r }\r \t},\r /**\r * @summary 判断组件是否只读.\r * @example\r * var readonly = this.form.get('subject').isReadonly();\r * @return {Boolean} 是否只读.\r */\r \tisReadonly : function(){\r return !!(this.readonly || this.json.isReadonly);\r },\r \tgetTextData: function(){\r \t\t//var value = this.node.get(\"value\");\r \t\t//var text = this.node.get(\"text\");\r var value = (this.node.getFirst()) ? this.node.getFirst().get(\"value\") : this.node.get(\"text\");\r var text = (this.node.getFirst()) ? this.node.getFirst().get(\"text\") : this.node.get(\"text\");\r \t\treturn {\"value\": [value || \"\"] , \"text\": [text || value || \"\"]};\r \t},\r /**\r * @summary 判断组件值是否为空.\r * @example\r * if( this.form.get('subject').isEmpty() ){\r * this.form.notice('标题不能为空', 'warn');\r * }\r * @return {Boolean} 值是否为空.\r */\r isEmpty : function(){\r \t var data = this.getData();\r \t return !data || !data.trim();\r },\r /**\r * 在脚本中使用 this.data[fieldId] 也可以获取组件值。\r * 区别如下：&lt;br/>\r * 1、当使用Promise的时候&lt;br/>\r * 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r * this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r * {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0#EggIl|具体差异请查看链接}&lt;br/>\r * 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。\r * @summary 获取组件值。\r * @example\r * var data = this.form.get('fieldId').getData(); //没有使用promise的情况、\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * var data;\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * data = this.form.get('fieldId').getData();\r * }else{\r * data = this.data['fieldId']; //直接从数据中获取字段值\r * }\r * @example\r * //使用Promise的情况\r * var field = this.form.get(\"fieldId\");\r * var dict = new this.Dict(\"test\"); //test为数据字典名称\r * var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r * promise.then( function(){\r * var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r * })\r * field.setData( promise );\r * @return 组件的数据.\r */\r \tgetData: function(when){\r if (this.json.compute == \"save\") this._setValue(this._computeValue());\r return this.getInputData();\r \t},\r getInputData: function(){\r if (this.node.getFirst()){\r return this.node.getFirst().get(\"value\");\r }else{\r return this._getBusinessData();\r }\r },\r /**\r * @summary 重置组件的值为默认值或置空。\r * @example\r * this.form.get('subject').resetData();\r */\r resetData: function(){\r this.setData(this.getValue());\r },\r /**当参数为Promise的时候，请参考文档: {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0|使用Promise处理表单异步}&lt;br/>\r * 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。\r * @summary 为组件赋值。\r * @param data{String|Promise} .\r * @example\r * this.form.get(\"fieldId\").setData(\"test\"); //赋文本值\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * this.form.get('fieldId').setData( data );\r * }else{\r * this.data['fieldId'] = data;\r * }\r * @example\r * //使用Promise\r * var field = this.form.get(\"fieldId\");\r * var dict = new this.Dict(\"test\"); //test为数据字典名称\r * var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r * field.setData( promise );\r */\r \tsetData: function(data){\r // if (data &amp;&amp; data.isAG){\r // var ag = o2.AG.all(data).then(function(v){\r // if (o2.typeOf(v)==\"array\") v = v[0];\r // this.__setData(v);\r // }.bind(this));\r // this.moduleValueAG = ag;\r // ag.then(function(){\r // this.moduleValueAG = null;\r // }.bind(this));\r // }else{\r if (!!data &amp;&amp; o2.typeOf(data.then)==\"function\"){\r var p = o2.promiseAll(data).then(function(v){\r this.__setData(v);\r // if (this.node.getFirst() &amp;&amp; !this.readonly &amp;&amp; !this.json.isReadonly) {\r // this.checkDescription();\r // this.validationMode();\r // }\r }.bind(this), function(){});\r this.moduleValueAG = p;\r p.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r }else{\r this.moduleValueAG = null;\r this.__setData(data);\r // if (this.node.getFirst() &amp;&amp; !this.readonly &amp;&amp; !this.json.isReadonly) {\r // this.checkDescription();\r // this.validationMode();\r // }\r }\r //this.__setData(data);\r //}\r \t},\r __setData: function(data){\r this._setBusinessData(data);\r if (this.node.getFirst()){\r this.node.getFirst().set(\"value\", data);\r this.checkDescription();\r this.validationMode();\r }else{\r this.node.set(\"text\", data);\r }\r this.moduleValueAG = null;\r },\r \r \r createErrorNode: function(text){\r \r //var size = this.node.getFirst().getSize();\r //var w = size.x-3;\r //if (COMMON.Browser.safari) w = w-20;\r //node.setStyles({\r // \"width\": \"\"+w+\"px\",\r // \"height\": \"\"+size.y+\"px\",\r // \"line-height\": \"\"+size.y+\"px\",\r // \"position\": \"absolute\",\r // \"top\": \"0px\"\r //});\r var node;\r if( this.form.json.errorStyle ){\r if( this.form.json.errorStyle.type === \"notice\" ){\r if( !this.form.errorNoticing ){ //如果是弹出\r this.form.errorNoticing = true;\r this.form.notice(text, \"error\", this.node, null, null, {\r onClose : function () {\r this.form.errorNoticing = false;\r }.bind(this)\r });\r }\r }else{\r node = new Element(\"div\",{\r \"styles\" : this.form.json.errorStyle.node,\r \"text\": text\r });\r if( this.form.json.errorStyle.close ){\r var closeNode = new Element(\"div\",{\r \"styles\" : this.form.json.errorStyle.close ,\r \"events\": {\r \"click\" : function(){\r this.destroy();\r }.bind(node)\r }\r }).inject(node);\r }\r }\r }else{\r node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"height\": \"20px\",\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r }\r return node;\r },\r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border-color\", \"red\");\r \r this.errNode = this.createErrorNode(text);\r //if (this.iconNode){\r // this.errNode.inject(this.iconNode, \"after\");\r //}else{\r this.errNode.inject(this.node, \"after\");\r //}\r this.showNotValidationMode(this.node);\r \r var parentNode = this.node;\r while( parentNode.offsetParent === null ){\r parentNode = parentNode.getParent();\r }\r \r if (!parentNode.isIntoView()) parentNode.scrollIntoView();\r }\r },\r showNotValidationMode: function(node){\r var p = node.getParent(\"div\");\r if (p){\r var mwftype = p.get(\"MWFtype\") || p.get(\"mwftype\");\r if (mwftype == \"tab$Content\"){\r if (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r validationConfigItem: function(routeName, data){\r var flag = (data.status===\"all\") ? true: (routeName === data.decision);\r if (flag){\r var n = this.getInputData();\r var v = (data.valueType===\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function(routeName, opinion){\r if (!this.readonly &amp;&amp; !this.json.isReadonly){\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r \r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r \r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString()!=\"true\"){\r this.notValidationMode(flag);\r return false;\r }\r }\r return true;\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_$Module.js.html":{"url":"x_component_process_Xform_$Module.js.html","title":"x_component_process_Xform/$Module.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/$Module.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/$Module.js MWF.require(\"MWF.widget.Common\", null, false);\r /** @classdesc $Module 组件类，此类为所有组件的父类。\r * @class\r * @o2category FormComponents\r * @hideconstructor\r * */\r MWF.xApplication.process.Xform.$Module = MWF.APP$Module = new Class(\r /** @lends MWF.xApplication.process.Xform.$Module# */\r {\r Implements: [Events],\r options: {\r /**\r * 组件加载前触发。\r * @event MWF.xApplication.process.Xform.$Module#queryLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载时触发.\r * @event MWF.xApplication.process.Xform.$Module#load\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载后触发.\r * @event MWF.xApplication.process.Xform.$Module#postLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\"]\r },\r initialize: function(node, json, form, options){\r /**\r * @summary 组件的节点\r * @see https://mootools.net/core/docs/1.6.0/Element/Element\r * @member {Element}\r * @example\r * //可以在脚本中获取该组件\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * field.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式\r */\r this.node = $(node);\r this.node.store(\"module\", this);\r \r /**\r * @summary 组件的配置信息，比如id,类型等.\r * @member {JsonObject}\r * @example\r * //可以在脚本中获取该组件\r * var json = this.form.get(\"fieldId\").json; //获取组件对象\r * var id = json.id; //获取组件的id\r * var type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件\r */\r this.json = json;\r \r /**\r * @summary 组件的所在表单对象.\r * @member {MWF.xApplication.process.Xform.Form}\r * @example\r * var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\r * var container = form.container; //获取表单容器\r */\r this.form = form;\r },\r _getSource: function(){\r var parent = this.node.getParent();\r while(parent &amp;&amp; (\r parent.get(\"MWFtype\")!=\"source\" &amp;&amp;\r parent.get(\"MWFtype\")!=\"subSource\" &amp;&amp;\r parent.get(\"MWFtype\")!=\"subSourceItem\"\r )) parent = parent.getParent();\r return (parent) ? parent.retrieve(\"module\") : null;\r },\r /**\r * @summary 隐藏组件.\r * @example\r * this.form.get(\"fieldId\").hide(); //隐藏组件\r */\r hide: function(){\r var dsp = this.node.getStyle(\"display\");\r if (dsp!==\"none\") this.node.store(\"mwf_display\", dsp);\r this.node.setStyle(\"display\", \"none\");\r if (this.iconNode) this.iconNode.setStyle(\"display\", \"none\");\r },\r /**\r * @summary 显示组件.\r * @example\r * this.form.get(\"fieldId\").show(); //显示组件\r */\r show: function(){\r var dsp = this.node.retrieve(\"mwf_display\", dsp);\r this.node.setStyle(\"display\", dsp);\r if (this.iconNode) this.iconNode.setStyle(\"display\", \"block\");\r },\r load: function(){\r this._loadModuleEvents();\r if (this.fireEvent(\"queryLoad\")){\r this._queryLoaded();\r this._loadUserInterface();\r this._loadStyles();\r this._loadDomEvents();\r //this._loadEvents();\r \r this._afterLoaded();\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"load\");\r }\r },\r _loadUserInterface: function(){\r //\tthis.node = this.node;\r },\r \r _loadStyles: function(){\r if (this.json.styles) Object.each(this.json.styles, function(value, key){\r if ((value.indexOf(\"x_processplatform_assemble_surface\")!=-1 || value.indexOf(\"x_portal_assemble_surface\")!=-1 || value.indexOf(\"x_cms_assemble_control\")!=-1)){\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r var host3 = MWF.Actions.getHost(\"x_cms_assemble_control\");\r if (value.indexOf(\"/x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"/x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }else if (value.indexOf(\"x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }\r if (value.indexOf(\"/x_portal_assemble_surface\")!==-1){\r value = value.replace(\"/x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }else if (value.indexOf(\"x_portal_assemble_surface\")!==-1){\r value = value.replace(\"x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }\r if (value.indexOf(\"/x_cms_assemble_control\")!==-1){\r value = value.replace(\"/x_cms_assemble_control\", host3+\"/x_cms_assemble_control\");\r }else if (value.indexOf(\"x_cms_assemble_control\")!==-1){\r value = value.replace(\"x_cms_assemble_control\", host3+\"/x_cms_assemble_control\");\r }\r value = o2.filterUrl(value);\r }\r this.node.setStyle(key, value);\r }.bind(this));\r \r // if ([\"x_processplatform_assemble_surface\", \"x_portal_assemble_surface\"].indexOf(root.toLowerCase())!==-1){\r // var host = MWF.Actions.getHost(root);\r // return (flag===\"/\") ? host+this.json.template : host+\"/\"+this.json.template\r // }\r //if (this.json.styles) this.node.setStyles(this.json.styles);\r },\r _loadModuleEvents : function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r _loadDomEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)===-1){\r this.node.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r _loadEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }else{\r this.node.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r addModuleEvent: function(key, fun){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }else{\r this.node.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }\r },\r _getBusinessData: function(){\r if (this.json.section==\"yes\"){\r return this._getBusinessSectionData();\r }else {\r if (this.json.type===\"Opinion\"){\r return this._getBusinessSectionDataByPerson();\r }else{\r return this.form.businessData.data[this.json.id] || \"\";\r }\r }\r },\r _getBusinessSectionData: function(){\r switch (this.json.sectionBy){\r case \"person\":\r return this._getBusinessSectionDataByPerson();\r case \"unit\":\r return this._getBusinessSectionDataByUnit();\r case \"activity\":\r return this._getBusinessSectionDataByActivity();\r case \"splitValue\":\r return this._getBusinessSectionDataBySplitValue();\r case \"script\":\r return this._getBusinessSectionDataByScript(((this.json.sectionByScript) ? this.json.sectionByScript.code : \"\"));\r default:\r return this.form.businessData.data[this.json.id] || \"\";\r }\r },\r _getBusinessSectionDataByPerson: function(){\r this.form.sectionListObj[this.json.id] = layout.desktop.session.user.id;\r var dataObj = this.form.businessData.data[this.json.id];\r return (dataObj) ? (dataObj[layout.desktop.session.user.id] || \"\") : \"\";\r },\r _getBusinessSectionDataByUnit: function(){\r this.form.sectionListObj[this.json.id] = \"\";\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj) return \"\";\r var key = (this.form.businessData.task) ? this.form.businessData.task.unit : \"\";\r if (key) this.form.sectionListObj[this.json.id] = key;\r return (key) ? (dataObj[key] || \"\") : \"\";\r },\r _getBusinessSectionDataByActivity: function(){\r this.form.sectionListObj[this.json.id] = \"\";\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj) return \"\";\r var key = (this.form.businessData.work) ? this.form.businessData.work.activity : \"\";\r if (key) this.form.sectionListObj[this.json.id] = key;\r return (key) ? (dataObj[key] || \"\") : \"\";\r },\r _getBusinessSectionDataBySplitValue: function(){\r this.form.sectionListObj[this.json.id] = \"\";\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj) return \"\";\r var key = (this.form.businessData.work) ? this.form.businessData.work.splitValue : \"\";\r if (key) this.form.sectionListObj[this.json.id] = key;\r return (key) ? (dataObj[key] || \"\") : \"\";\r },\r _getBusinessSectionDataByScript: function(code){\r this.form.sectionListObj[this.json.id] = \"\";\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj) return \"\";\r var key = this.form.Macro.exec(code, this);\r if (key) this.form.sectionListObj[this.json.id] = key;\r return (key) ? (dataObj[key] || \"\") : \"\";\r },\r \r _setBusinessData: function(v){\r if (this.json.section==\"yes\"){\r this._setBusinessSectionData(v);\r }else {\r if (this.json.type===\"Opinion\"){\r this._setBusinessSectionDataByPerson(v);\r }else{\r if (this.form.businessData.data[this.json.id]){\r this.form.businessData.data[this.json.id] = v;\r }else{\r this.form.businessData.data[this.json.id] = v;\r this.form.Macro.environment.setData(this.form.businessData.data);\r }\r if (this.json.isTitle) this.form.businessData.work.title = v;\r }\r }\r },\r _setBusinessSectionData: function(v){\r switch (this.json.sectionBy){\r case \"person\":\r this._setBusinessSectionDataByPerson(v);\r break;\r case \"unit\":\r this._setBusinessSectionDataByUnit(v);\r break;\r case \"activity\":\r this._setBusinessSectionDataByActivity(v);\r break;\r case \"splitValue\":\r this._setBusinessSectionDataBySplitValue(v);\r break;\r case \"script\":\r this._setBusinessSectionDataByScript(this.json.sectionByScript.code, v);\r break;\r default:\r if (this.form.businessData.data[this.json.id]){\r this.form.businessData.data[this.json.id] = v;\r }else{\r this.form.businessData.data[this.json.id] = v;\r this.form.Macro.environment.setData(this.form.businessData.data);\r }\r }\r },\r _setBusinessSectionDataByPerson: function(v){\r var resetData = false;\r var key = layout.desktop.session.user.id;\r \r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj){\r dataObj = {};\r this.form.businessData.data[this.json.id] = dataObj;\r resetData = true;\r }\r if (!dataObj[key]) resetData = true;\r dataObj[key] = v;\r \r if (resetData) this.form.Macro.environment.setData(this.form.businessData.data);\r },\r _setBusinessSectionDataByUnit: function(v){\r var resetData = false;\r var key = (this.form.businessData.task) ? this.form.businessData.task.unit : \"\";\r \r if (key){\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj){\r dataObj = {};\r this.form.businessData.data[this.json.id] = dataObj;\r resetData = true;\r }\r if (!dataObj[key]) resetData = true;\r dataObj[key] = v;\r }\r \r if (resetData) this.form.Macro.environment.setData(this.form.businessData.data);\r },\r _setBusinessSectionDataByActivity: function(v){\r var resetData = false;\r var key = (this.form.businessData.work) ? this.form.businessData.work.activity : \"\";\r \r if (key){\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj){\r dataObj = {};\r this.form.businessData.data[this.json.id] = dataObj;\r resetData = true;\r }\r if (!dataObj[key]) resetData = true;\r dataObj[key] = v;\r }\r \r if (resetData) this.form.Macro.environment.setData(this.form.businessData.data);\r },\r _setBusinessSectionDataBySplitValue: function(v){\r var resetData = false;\r var key = (this.form.businessData.work) ? this.form.businessData.work.splitValue : \"\";\r \r if (key){\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj){\r dataObj = {};\r this.form.businessData.data[this.json.id] = dataObj;\r resetData = true;\r }\r if (!dataObj[key]) resetData = true;\r dataObj[key] = v;\r }\r \r if (resetData) this.form.Macro.environment.setData(this.form.businessData.data);\r },\r \r _setBusinessSectionDataByScript: function(code, v){\r var resetData = false;\r var key = this.form.Macro.exec(code, this);\r \r if (key){\r var dataObj = this.form.businessData.data[this.json.id];\r if (!dataObj){\r dataObj = {};\r this.form.businessData.data[this.json.id] = dataObj;\r resetData = true;\r }\r if (!dataObj[key]) resetData = true;\r dataObj[key] = v;\r }\r \r if (resetData) this.form.Macro.environment.setData(this.form.businessData.data);\r },\r \r _queryLoaded: function(){},\r _afterLoaded: function(){},\r \r setValue: function(){\r },\r focus: function(){\r this.node.focus();\r }\r \r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Actionbar.js.html":{"url":"x_component_process_Xform_Actionbar.js.html","title":"x_component_process_Xform/Actionbar.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Actionbar.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Actionbar.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.require(\"MWF.widget.Tree\", null, false);\r //MWF.require(\"MWF.widget.Toolbar\", null, false);\r \r /** @class Actionbar 操作条组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var actionbar = this.form.get(\"name\"); //获取操作条\r * //方法2\r * var actionbar = this.target; //在操作条和操作本身的事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Actionbar = MWF.APPActionbar = new Class(\r /** @lends MWF.xApplication.process.Xform.Actionbar# */\r {\r Extends: MWF.APP$Module,\r options: {\r /**\r * 组件加载前触发。\r * @event MWF.xApplication.process.Xform.Actionbar#queryLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载时触发。\r * @event MWF.xApplication.process.Xform.Actionbar#load\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载后事件.由于加载过程中有异步处理，这个时候操作条有可能还未生成。\r * @event MWF.xApplication.process.Xform.Actionbar#postLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载后事件。这个时候操作条已生成\r * @event MWF.xApplication.process.Xform.Actionbar#afterLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"afterLoad\"]\r },\r /**\r * @summary 重新加载操作条.\r * @example\r * this.form.get(\"name\").reload(); //显示操作条\r */\r reload : function(){\r this._loadUserInterface();\r },\r _loadUserInterface: function(){\r // if (this.form.json.mode == \"Mobile\"){\r // this.node.empty();\r // }else if (COMMON.Browser.Platform.isMobile){\r // this.node.empty();\r // }else{\r this.toolbarNode = this.node.getFirst(\"div\");\r if(!this.toolbarNode)return;\r \r this.toolbarNode.empty();\r \r MWF.require(\"MWF.widget.Toolbar\", function(){\r /**\r * @summary Toolbar组件，平台使用该组件生成操作条。\r * @member {o2.widget.Toolbar}\r * @example\r * //可以在脚本中获取该组件\r * var toolbarWidget = this.form.get(\"fieldId\").toolbarWidget; //获取组件对象\r */\r this.toolbarWidget = new MWF.widget.Toolbar(this.toolbarNode, {\r \"style\": this.json.style,\r \"onPostLoad\" : function(){\r this.fireEvent(\"afterLoad\");\r }.bind(this)\r }, this);\r if (this.json.actionStyles) this.toolbarWidget.css = this.json.actionStyles;\r //alert(this.readonly)\r \r if( this.json.multiTools ){ //自定义操作和系统操作混合的情况，用 system : true 来区分系统和自定义\r var addReadActionFlag = !this.json.hideSystemTools &amp;&amp; !this.json.hideReadedAction; //是否需要增加已阅\r this.json.multiTools.each( function (tool) {\r if( tool.system ){\r if( !this.json.hideSystemTools ){\r if( tool.id === \"action_readed\" )addReadActionFlag = false;\r this.setToolbars([tool], this.toolbarNode, this.readonly);\r }\r }else{\r this.setCustomToolbars([tool], this.toolbarNode);\r }\r }.bind(this));\r if( addReadActionFlag ){\r var addActions = [\r {\r \"type\": \"MWFToolBarButton\",\r \"img\": \"read.png\",\r \"title\": \"标记为已阅\",\r \"action\": \"readedWork\",\r \"text\": \"已阅\",\r \"id\": \"action_readed\",\r \"control\": \"allowReadProcessing\",\r \"condition\": \"\",\r \"read\": true\r }\r ];\r this.setToolbars(addActions, this.toolbarNode, this.readonly);\r }\r this.toolbarWidget.load();\r }else{\r if (this.json.hideSystemTools){\r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }else{\r if (this.json.defaultTools){\r var addActions = [\r {\r \"type\": \"MWFToolBarButton\",\r \"img\": \"read.png\",\r \"title\": \"标记为已阅\",\r \"action\": \"readedWork\",\r \"text\": \"已阅\",\r \"id\": \"action_readed\",\r \"control\": \"allowReadProcessing\",\r \"condition\": \"\",\r \"read\": true\r }\r ];\r //this.form.businessData.control.allowReflow =\r \r //this.json.defaultTools.push(o);\r this.setToolbars(this.json.defaultTools, this.toolbarNode, this.readonly);\r if( !this.json.hideReadedAction ){\r this.setToolbars(addActions, this.toolbarNode, this.readonly);\r }\r \r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }else{\r MWF.getJSON(this.form.path+\"toolbars.json\", function(json){\r this.setToolbars(json, this.toolbarNode, this.readonly, true);\r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }.bind(this), null);\r }\r }\r }\r }.bind(this));\r // }\r },\r \r setCustomToolbars: function(tools, node){\r var path = \"../x_component_process_FormDesigner/Module/Actionbar/\";\r var iconPath = \"\";\r if( this.json.customIconStyle ){\r iconPath = this.json.customIconStyle+\"/\";\r }\r tools.each(function(tool){\r var flag = true;\r if (this.readonly){\r flag = tool.readShow;\r }else{\r flag = tool.editShow;\r }\r if (flag){\r flag = true;\r if (tool.control){\r flag = this.form.businessData.control[tool.control]\r }\r if (tool.condition){\r var hideFlag = this.form.Macro.exec(tool.condition, this);\r flag = !hideFlag;\r }\r if (flag){\r var actionNode = new Element(\"div\", {\r \"id\": tool.id,\r \"MWFnodetype\": tool.type,\r \"MWFButtonImage\": path+\"\"+this.form.options.style+\"/custom/\"+iconPath+tool.img,\r \"title\": tool.title,\r \"MWFButtonAction\": \"runCustomAction\",\r \"MWFButtonText\": tool.text\r }).inject(node);\r if( this.json.customIconOverStyle ){\r actionNode.set(\"MWFButtonImageOver\" , path+\"\"+this.form.options.style +\"/custom/\"+this.json.customIconOverStyle+ \"/\" +tool.img );\r }\r if( tool.properties ){\r actionNode.set(tool.properties);\r }\r if (tool.actionScript){\r actionNode.store(\"script\", tool.actionScript);\r }\r if (tool.sub){\r var subNode = node.getLast();\r this.setCustomToolbars(tool.sub, subNode);\r }\r }\r }\r }.bind(this));\r },\r \r setToolbarItem: function(tool, node, readonly, noCondition){\r var path = \"../x_component_process_FormDesigner/Module/Actionbar/\";\r var flag = true;\r if (tool.control){\r flag = this.form.businessData.control[tool.control]\r }\r if (!noCondition) if (tool.condition){\r var hideFlag = this.form.Macro.exec(tool.condition, this);\r flag = flag &amp;&amp; (!hideFlag);\r }\r // if (tool.id == \"action_processWork\"){\r // if (!this.form.businessData.task){\r // flag = false;\r // }\r // }\r if (tool.id == \"action_downloadAll\" || tool.id == \"action_print\"){\r if (!this.form.businessData.work.startTime){\r flag = false;\r }\r }\r if (tool.id == \"action_delete\"){\r if (!this.form.businessData.work || !this.form.businessData.work.id){\r flag = false;\r }\r }\r \r \r if (tool.id == \"action_rollback\") tool.read = true;\r if (readonly) if (!tool.read) flag = false;\r if (flag){\r var actionNode = new Element(\"div\", {\r \"id\": tool.id,\r \"MWFnodetype\": tool.type,\r //\"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+tool.img,\r \"MWFButtonImage\": path+(this.options.style||\"default\") +\"/tools/\"+ (this.json.style || \"default\") +\"/\"+tool.img,\r \"title\": tool.title,\r \"MWFButtonAction\": tool.action,\r \"MWFButtonText\": tool.text\r }).inject(node);\r if( this.json.iconOverStyle ){\r actionNode.set(\"MWFButtonImageOver\" , path+\"\"+(this.options.style||\"default\")+\"/tools/\"+( this.json.iconOverStyle || \"default\" )+\"/\"+tool.img );\r }\r if( tool.properties ){\r actionNode.set(tool.properties);\r }\r if (tool.sub){\r var subNode = node.getLast();\r this.setToolbars(tool.sub, subNode, readonly, noCondition);\r }\r }\r },\r /**\r * @summary 根据操作id获取操作，该方法在操作条的afterLoad事件中有效，操作的操作脚本有效。\r * @param {String} id - 必选，操作id.\r * @return {o2.widget.ToolbarButton} 操作\r * @example\r * var actionbar = this.form.get(\"name\"); //获取操作条\r * var item = actionbar.getItem( \"action_delete\" ); //获取删除操作\r * item.node.hide(); //隐藏删除操作的节点\r * item.node.click(); //触发操作的click事件\r */\r getItem : function( id ){\r if( this.toolbarWidget &amp;&amp; id ){\r return this.toolbarWidget.items[id]\r }\r },\r /**\r * @summary 获取所有操作，该方法在操作条的afterLoad事件中有效，操作的操作脚本有效。\r * @return {Array} 操作数组\r * @example\r * var actionbar = this.form.get(\"name\"); //获取操作条\r * var itemList = actionbar.getAllItem(); //获取操作数组\r * itemList[1].node.hide(); //隐藏第一个操作\r */\r getAllItem : function(){\r return this.toolbarWidget ? this.toolbarWidget.childrenButton : [];\r },\r setToolbars: function(tools, node, readonly, noCondition){\r tools.each(function(tool){\r this.setToolbarItem(tool, node, readonly, noCondition);\r }.bind(this));\r },\r runCustomAction: function(bt){\r var script = bt.node.retrieve(\"script\");\r this.form.Macro.exec(script, this);\r },\r saveWork: function(){\r this.form.saveWork();\r },\r closeWork: function(){\r this.form.closeWork();\r },\r processWork: function(){\r this.form.processWork();\r },\r resetWork: function(){\r this.form.resetWork();\r },\r retractWork: function(e, ev){\r this.form.retractWork(e, ev);\r },\r rerouteWork: function(e, ev){\r this.form.rerouteWork(e, ev);\r },\r deleteWork: function(){\r this.form.deleteWork();\r },\r printWork: function(){\r this.form.printWork();\r },\r readedWork: function(b,e){\r this.form.readedWork(e);\r },\r addSplit: function(e){\r this.form.addSplit(e);\r },\r rollback: function(e){\r this.form.rollback(e);\r },\r downloadAll: function(e){\r this.form.downloadAll(e);\r },\r pressWork: function(e){\r this.form.pressWork(e);\r },\r pauseTask: function(e){\r var p = this.form.pauseTask(e);\r if (p){\r p.then(function(){\r e.setText(MWF.xApplication.process.Xform.LP.resume);\r e.options.action = \"resumeTask\";\r \r var img = e.picNode.getElement(\"img\");\r var src = img.get(\"src\");\r src = src.substr(0, src.lastIndexOf(\"/\"));\r src = src+\"/resume.png\";\r img.set(\"src\", src);\r \r }.bind(this), function(){});\r }\r },\r resumeTask: function(e){\r var p = this.form.resumeTask(e);\r if (p){\r p.then(function(){\r e.setText( MWF.xApplication.process.Xform.LP.pause);\r e.options.action = \"pauseTask\";\r \r var img = e.picNode.getElement(\"img\");\r var src = img.get(\"src\");\r src = src.substr(0, src.lastIndexOf(\"/\"));\r src = src+\"/pause.png\";\r img.set(\"src\", src);\r \r }.bind(this), function(){});\r }\r }\r \r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Address.js.html":{"url":"x_component_process_Xform_Address.js.html","title":"x_component_process_Xform/Address.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Address.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Address.js //MWF.require(\"MWF.widget.PinYin\", null, false);\r MWF.xDesktop.requireApp(\"process.Xform\", \"Combox\", null, false);\r /** @class Address 地址选择组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var address = this.form.get(\"name\"); //获取组件\r * //方法2\r * var address = this.target; //组件本身的事件和脚本中获取\r * @extends MWF.xApplication.process.Xform.Combox\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Address = MWF.APPAddress = new Class(\r /** @lends MWF.xApplication.process.Xform.Address# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APPCombox,\r options: {\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"commitInput\", \"change\"]\r },\r \r initialize: function(node, json, form){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r _loadNode: function(){\r if (this.readonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r //new Element(\"select\").inject(this.node);\r },\r _loadNodeEdit: function(){\r this.node.empty();\r \r MWF.require([\"MWF.widget.Combox\",\"MWF.widget.PinYin\"], function(){\r this.combox = new MWF.widget.Combox({\r \"style\": \"blue\",\r \"onlySelect\": true,\r \"count\": 4,\r \"focusList\": true,\r \"onCommitInput\": function(){\r this.fireEvent(\"commitInput\");\r }.bind(this),\r \"onChange\": function(e, oldValues){\r var thisValues = this.combox.values.map(function(v){ return v.data || v.value});\r if ((oldValues &amp;&amp; (oldValues.join() !== thisValues.join()))){\r while (this.combox.values.length-1>e.index){\r this.combox.deleteItem(this.combox.values[this.combox.values.length-1])\r }\r this.fireEvent(\"change\");\r }\r }.bind(this),\r \"optionsMethod\": this._searchOptions.bind(this)\r });\r this.combox.intoEdit = function(e){\r if (this.options.count){\r if (this.values.length>=this.options.count){\r // if (this.input) this.input.noBlur = true;\r if (this.input) this.input.node.hide();\r // this.getLast().edit();\r return false;\r }\r }\r if (!this.input){\r this.input = new MWF.widget.Combox.Input(this, this, \"\");\r this.input.node.inject(this.node);\r this.input.node.setStyle(\"width\", \"1px\");\r }\r this.input.node.show();\r this.input.setInputNodeStyles();\r //this.input.node.set(\"value\", \"111\");\r this.input.node.focus();\r this.input.setInputPosition();\r if (this.options.focusList) this.input.searchItems();\r }\r }.bind(this), false);\r \r this.combox.inject(this.node);\r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type\r });\r \r this.combox.addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r }.bind(this));\r },\r _searchOptions: function(value, callback){\r value = value.toLowerCase();\r var i = (this.combox.editItem) ? this.combox.editItem.getItemPosition() : this.combox.values.length;\r switch (i) {\r case 0: //省\r o2.Actions.get(\"x_general_assemble_control\").listProvince(function(json){\r var list = [];\r json.data.each(function(text){\r var k = text.name;\r var keyword = k+MWF.widget.PinYin.toPY(k).toLowerCase()+MWF.widget.PinYin.toPYFirst(k).toLowerCase();\r if (value){\r //if (keyword.indexOf(value)!==-1)\r list.push({\"text\": k, \"value\": k});\r }else{\r list.push({\"text\": k, \"value\": k});\r }\r }.bind(this));\r if (list.length) if (callback) callback(list);\r }.bind(this));\r // MWF.UD.getPublicData(\"addr_province\", function(json){\r // var list = [];\r // json.each(function(text){\r // var keyword = text+MWF.widget.PinYin.toPY(text).toLowerCase()+MWF.widget.PinYin.toPYFirst(text).toLowerCase();\r // if (value){\r // if (keyword.indexOf(value)!==-1) list.push({\"text\": text, \"value\": text});\r // }else{\r // list.push({\"text\": text, \"value\": text});\r // }\r //\r // }.bind(this));\r // if (list.length) if (callback) callback(list);\r // });\r break;\r case 1: //市\r var item = this.combox.getFirst();\r \r o2.Actions.get(\"x_general_assemble_control\").listCity(item.data || item.value, function(json){\r var list = [];\r json.data.each(function(text){\r var k = text.name;\r var keyword = k+MWF.widget.PinYin.toPY(k).toLowerCase()+MWF.widget.PinYin.toPYFirst(k).toLowerCase();\r if (value){\r //if (keyword.indexOf(value)!==-1)\r list.push({\"text\": k, \"value\": k});\r }else{\r list.push({\"text\": k, \"value\": k});\r }\r }.bind(this));\r if (list.length) if (callback) callback(list);\r }.bind(this));\r \r \r // MWF.UD.getPublicData(\"addr_city_\"+item.data, function(json){\r // var list = [];\r // json.each(function(text){\r // var keyword = text+MWF.widget.PinYin.toPY(text).toLowerCase()+MWF.widget.PinYin.toPYFirst(text).toLowerCase();\r // if (value){\r // if (keyword.indexOf(value)!==-1) list.push({\"text\": text, \"value\": text});\r // }else{\r // list.push({\"text\": text, \"value\": text});\r // }\r // }.bind(this));\r // if (list.length) if (callback) callback(list);\r // });\r break;\r case 2: //区\r var f = this.combox.getFirst();\r var p = f.data || f.value;\r var item = this.combox.getFirst().getNextItem();\r \r o2.Actions.get(\"x_general_assemble_control\").listDistrict(p, item.data||item.value, function(json){\r var list = [];\r json.data.each(function(text){\r var k = text.name;\r var keyword = k+MWF.widget.PinYin.toPY(k).toLowerCase()+MWF.widget.PinYin.toPYFirst(k).toLowerCase();\r if (value){\r //if (keyword.indexOf(value)!==-1)\r list.push({\"text\": k, \"value\": k});\r }else{\r list.push({\"text\": k, \"value\": k});\r }\r }.bind(this));\r if (list.length) if (callback) callback(list);\r }.bind(this));\r \r \r // MWF.UD.getPublicData(\"addr_district_\"+item.data, function(json){\r // var list = [];\r // json.each(function(text){\r // var keyword = text+MWF.widget.PinYin.toPY(text).toLowerCase()+MWF.widget.PinYin.toPYFirst(text).toLowerCase();\r // if (value){\r // if (keyword.indexOf(value)!==-1) list.push({\"text\": text, \"value\": text});\r // }else{\r // list.push({\"text\": text, \"value\": text});\r // }\r // }.bind(this));\r // if (list.length) if (callback) callback(list);\r // });\r break;\r default:\r if (callback) callback([]);\r }\r }\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Attachment.js.html":{"url":"x_component_process_Xform_Attachment.js.html","title":"x_component_process_Xform/Attachment.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Attachment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Attachment.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.require(\"MWF.widget.AttachmentController\", null, false);\r MWF.xApplication.process.Xform.AttachmentController = new Class({\r Extends: MWF.widget.ATTER,\r \"options\": {\r \"officeFiles\": [\"doc\", \"docx\", \"dotx\", \"dot\", \"xls\", \"xlsx\", \"xlsm\", \"xlt\", \"xltx\", \"pptx\", \"ppt\", \"pot\", \"potx\", \"potm\", \"pdf\"],\r \"checkTextEnable\": true\r },\r checkAttachmentDeleteAction: function () {\r if (this.options.readonly) {\r this.setAttachmentsAction(\"delete\", false);\r return false;\r }\r if (this.options.isDeleteOption !== \"n\") {\r if (this.attachments.length) {\r var user = layout.session.user.distinguishedName;\r \r for (var i = 0; i &lt; this.attachments.length; i++) {\r var flag = true;\r var att = this.attachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if (this.options.isDeleteOption === \"o\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if (att.data.person !== layout.desktop.session.user.distinguishedName) flag = false;\r \r } else if (this.options.isDeleteOption === \"a\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if (att.data.activity !== this.module.form.businessData.activity.id) flag = false;\r \r } else if (this.options.isDeleteOption === \"ao\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if ((att.data.activity !== this.module.form.businessData.activity.id) || (att.data.person !== layout.desktop.session.user.distinguishedName)) flag = false;\r \r } else {\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r }\r \r if (flag) {\r this.setAttachmentAction(att, \"delete\", true);\r } else {\r this.setAttachmentAction(att, \"delete\", false);\r }\r }\r }\r \r } else {\r this.setAttachmentsAction(\"delete\", false);\r }\r },\r checkDeleteAction: function () {\r \r this.checkAttachmentDeleteAction();\r \r if (this.options.readonly) {\r this.setActionDisabled(this.deleteAction);\r this.setActionDisabled(this.min_deleteAction);\r return false;\r }\r if (this.options.isDeleteOption !== \"n\") {\r if (this.selectedAttachments.length) {\r var user = layout.session.user.distinguishedName;\r var flag = true;\r if (this.options.isDeleteOption === \"o\") {\r for (var i = 0; i &lt; this.selectedAttachments.length; i++) {\r var att = this.selectedAttachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r break;\r }\r if (att.data.person !== layout.desktop.session.user.distinguishedName) {\r flag = false;\r break;\r }\r }\r } else if (this.options.isDeleteOption === \"a\") {\r for (var i = 0; i &lt; this.selectedAttachments.length; i++) {\r var att = this.selectedAttachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r break;\r }\r if (att.data.activity !== this.module.form.businessData.activity.id) {\r flag = false;\r break;\r }\r }\r } else if (this.options.isDeleteOption === \"ao\") {\r for (var i = 0; i &lt; this.selectedAttachments.length; i++) {\r var att = this.selectedAttachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r break;\r }\r if ((att.data.activity !== this.module.form.businessData.activity.id) || (att.data.person !== layout.desktop.session.user.distinguishedName)) {\r flag = false;\r break;\r }\r }\r } else {\r for (var i = 0; i &lt; this.selectedAttachments.length; i++) {\r var att = this.selectedAttachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r break;\r }\r }\r }\r \r if (flag) {\r this.setActionEnabled(this.deleteAction);\r this.setActionEnabled(this.min_deleteAction);\r } else {\r this.setActionDisabled(this.deleteAction);\r this.setActionDisabled(this.min_deleteAction);\r }\r } else {\r this.setActionDisabled(this.deleteAction);\r this.setActionDisabled(this.min_deleteAction);\r }\r } else {\r // if (!this.options.isDelete){\r this.setActionDisabled(this.deleteAction);\r this.setActionDisabled(this.min_deleteAction);\r // }else{\r // if (this.selectedAttachments.length){\r // this.setActionEnabled(this.deleteAction);\r // this.setActionEnabled(this.min_deleteAction);\r // }else{\r // this.setActionDisabled(this.deleteAction);\r // this.setActionDisabled(this.min_deleteAction);\r // }\r // }\r }\r },\r isAttDeleteAvailable: function (att) {\r if (this.options.readonly) return false;\r if (this.options.toolbarGroupHidden.contains(\"edit\")) return false;\r if (this.options.isDeleteOption === \"n\") return false;\r \r var user = layout.session.user.distinguishedName;\r var flag = true;\r \r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r if (this.options.isDeleteOption === \"o\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if (att.data.person !== layout.desktop.session.user.distinguishedName) flag = false;\r \r } else if (this.options.isDeleteOption === \"a\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if (att.data.activity !== this.module.form.businessData.activity.id) flag = false;\r \r } else if (this.options.isDeleteOption === \"ao\") {\r \r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r if ((att.data.activity !== this.module.form.businessData.activity.id) || (att.data.person !== layout.desktop.session.user.distinguishedName)) flag = false;\r \r } else {\r if (!att.data.control.allowEdit &amp;&amp; att.data.person !== user) flag = false;\r }\r \r return flag;\r },\r openInOfficeControl: function (att, office) {\r if (office) {\r if (!office.openedAttachment || office.openedAttachment.id !== att.id) {\r office.save();\r if (this.module.form.businessData.workCompleted) {\r MWF.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentWorkcompletedUrl(att.id, this.module.form.businessData.workCompleted.id, function (url) {\r office.openedAttachment = { \"id\": att.id, \"site\": this.module.json.name, \"name\": att.name };\r office.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }.bind(this));\r } else {\r MWF.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentUrl(att.id, this.module.form.businessData.work.id, function (url) {\r office.openedAttachment = { \"id\": att.id, \"site\": this.module.json.name, \"name\": att.name };\r office.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }.bind(this));\r }\r }\r }\r },\r \r checkReplaceAction: function () {\r if (this.options.isReplaceHidden) return;\r if (this.options.readonly) {\r this.setActionDisabled(this.replaceAction);\r this.setActionDisabled(this.min_replaceAction);\r return false;\r }\r \r if (this.options.isReplaceOption !== \"n\") {\r if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length === 1) {\r \r var att = this.selectedAttachments[0];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r var user = layout.session.user.distinguishedName;\r var flag = true;\r \r if (this.options.isReplaceOption === \"o\") {\r flag = att.data.person === layout.desktop.session.user.distinguishedName;\r }\r if (this.options.isReplaceOption === \"a\") {\r flag = att.data.activity === this.module.form.businessData.activity.id;\r }\r if (this.options.isReplaceOption === \"ao\") {\r flag = (att.data.person === layout.desktop.session.user.distinguishedName &amp;&amp; att.data.activity === this.module.form.businessData.activity.id);\r }\r if (flag &amp;&amp; !att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r }\r \r if (flag) {\r this.setActionEnabled(this.replaceAction);\r this.setActionEnabled(this.min_replaceAction);\r } else {\r this.setActionDisabled(this.replaceAction);\r this.setActionDisabled(this.min_replaceAction);\r }\r } else {\r this.setActionDisabled(this.replaceAction);\r this.setActionDisabled(this.min_replaceAction);\r }\r } else {\r // if (!this.options.isReplace){\r this.setActionDisabled(this.replaceAction);\r this.setActionDisabled(this.min_replaceAction);\r // }else{\r // if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length===1){\r // this.setActionEnabled(this.replaceAction);\r // this.setActionEnabled(this.min_replaceAction);\r // }else{\r // this.setActionDisabled(this.replaceAction);\r // this.setActionDisabled(this.min_replaceAction);\r // }\r // }\r }\r },\r replaceAttachment: function (e, node) {\r var att = this.selectedAttachments[0].data;\r \r if (this.module.json.isOpenInOffice &amp;&amp; this.module.json.officeControlName &amp;&amp; (this.options.officeFiles.indexOf(att.extension) !== -1)) {\r var office = this.module.form.all[this.module.json.officeControlName];\r if (office) {\r if (this.min_closeOfficeAction) this.setActionEnabled(this.min_closeOfficeAction);\r if (this.closeOfficeAction) this.setActionEnabled(this.closeOfficeAction);\r this.openInOfficeControl(att, office);\r } else {\r if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length == 1) {\r if (this.module) this.module.replaceAttachment(e, node, this.selectedAttachments[0]);\r }\r }\r } else {\r if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length == 1) {\r if (this.module) this.module.replaceAttachment(e, node, this.selectedAttachments[0]);\r }\r }\r },\r isAttReplaceAvailable: function (att) {\r if (this.options.readonly) return false;\r if (this.options.toolbarGroupHidden.contains(\"edit\")) return false;\r \r if (this.options.isReplaceOption === \"n\") return false;\r \r var user = layout.session.user.distinguishedName;\r var flag = true;\r \r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r if (this.options.isReplaceOption === \"o\") {\r flag = att.data.person === layout.desktop.session.user.distinguishedName;\r }\r if (this.options.isReplaceOption === \"a\") {\r flag = att.data.activity === this.module.form.businessData.activity.id;\r }\r if (this.options.isReplaceOption === \"ao\") {\r flag = (att.data.person === layout.desktop.session.user.distinguishedName &amp;&amp; att.data.activity === this.module.form.businessData.activity.id);\r }\r if (flag &amp;&amp; !att.data.control.allowEdit &amp;&amp; att.data.person !== user) {\r flag = false;\r }\r \r return flag;\r },\r \r \r //checkAttachmentOrderAction : function(){\r // if (this.options.readonly){\r // this.setAttachmentsAction(\"order\", false );\r // return false;\r // }\r // if (this.attachments.length){\r // var user = layout.session.user.distinguishedName;\r // for (var i=0; i&lt;this.attachments.length; i++){\r // var flag = true;\r //\r // var att = this.attachments[i];\r // if( !att.data.person &amp;&amp; att.data.creatorUid )att.data.person = att.data.creatorUid;\r //\r // if ((!att.data.control.allowControl || !att.data.control.allowEdit) &amp;&amp; att.data.person!==user){\r // flag = false;\r // }\r // if (flag){\r // this.setAttachmentAction(att, \"order\", true );\r // }else{\r // this.setAttachmentAction(att, \"order\", false );\r // }\r // }\r // }\r //},\r checkOrderAction: function () {\r //this.checkAttachmentOrderAction();\r if (this.options.readonly) {\r this.setActionDisabled(this.orderAction);\r this.setActionDisabled(this.min_orderAction);\r return false;\r }\r if (this.attachments.length &amp;&amp; this.attachments.length > 1) {\r var flag = true;\r var user = layout.session.user.distinguishedName;\r for (var i = 0; i &lt; this.attachments.length; i++) {\r var att = this.attachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if ((!att.data.control.allowControl &amp;&amp; !att.data.control.allowEdit) &amp;&amp; att.data.person !== user) { //|| !att.data.control.allowEdit\r flag = false;\r break;\r }\r }\r if (flag) {\r this.setActionEnabled(this.orderAction);\r this.setActionEnabled(this.min_orderAction);\r } else {\r this.setActionDisabled(this.orderAction);\r this.setActionDisabled(this.min_orderAction);\r }\r //this.setActionEnabled(this.min_deleteAction);\r } else {\r this.setActionDisabled(this.orderAction);\r this.setActionDisabled(this.min_orderAction);\r //this.setActionDisabled(this.min_deleteAction);\r }\r },\r isAttOrderAvailable: function (att) {\r if (this.options.readonly) return false;\r if (this.options.toolbarGroupHidden.contains(\"config\")) return false;\r var user = layout.session.user.distinguishedName;\r var flag = true;\r \r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r if ((!att.data.control.allowControl || !att.data.control.allowEdit) &amp;&amp; att.data.person !== user) {\r flag = false;\r }\r return flag;\r },\r \r createTopNode: function () {\r if (this.options.title) {\r if (!this.titleNode) this.titleNode = new Element(\"div\", { \"styles\": this.css.titleNode, \"text\": this.options.title }).inject(this.node);\r }\r if (!this.topNode) {\r this.topNode = new Element(\"div\", { \"styles\": this.css.topNode }).inject(this.node);\r } else {\r this.topNode.empty();\r this.editActionBoxNode = null;\r this.editActionsGroupNode = null;\r this.topNode.setStyle(\"display\", \"\");\r if (this.isHiddenTop) {\r //this.container.setStyle(\"height\", this.container.getSize().y + 45 );\r //this.node.setStyle(\"height\", this.node.getSize().y + 45 );\r if (this.oldContentScrollNodeHeight &amp;&amp; this.contentScrollNode) {\r this.contentScrollNode.setStyle(\"min-height\", this.oldContentScrollNodeHeight);\r this.oldContentScrollNodeHeight = null;\r }\r this.isHiddenTop = false;\r }\r }\r var hiddenGroup = this.options.toolbarGroupHidden;\r if (hiddenGroup.contains(\"edit\") &amp;&amp; hiddenGroup.contains(\"read\") &amp;&amp; hiddenGroup.contains(\"list\") &amp;&amp;\r hiddenGroup.contains(\"view\") &amp;&amp; hiddenGroup.contains(\"config\") &amp;&amp;\r !(this.module.json.isOpenInOffice &amp;&amp; this.module.json.officeControlName)\r ) {\r if (this.contentScrollNode) {\r this.oldContentScrollNodeHeight = this.contentScrollNode.getStyle(\"min-height\");\r this.contentScrollNode.setStyle(\"min-height\", this.node.getStyle(\"min-height\"));\r this.topNode.setStyle(\"display\", \"none\");\r }\r this.isHiddenTop = true;\r }\r if (!hiddenGroup.contains(\"edit\")) this.createEditGroupActions();\r if (!hiddenGroup.contains(\"read\")) this.createReadGroupActions();\r if (!hiddenGroup.contains(\"list\")) this.createListGroupActions();\r if (this.module.json.isOpenInOffice &amp;&amp; this.module.json.officeControlName) this.createOfficeGroupActions();\r \r if (!hiddenGroup.contains(\"config\")) this.createConfigGroupActions();\r \r if (!hiddenGroup.contains(\"view\")) this.createViewGroupActions();\r this.checkActions();\r },\r checkActions: function () {\r // if (this.options.readonly){\r // this.setReadonly();\r // }else{\r this.checkUploadAction();\r this.checkDeleteAction();\r this.checkReplaceAction();\r //this.checkOfficeAction();\r this.checkDownloadAction();\r this.checkSizeAction();\r \r this.checkConfigAction();\r this.checkOrderAction();\r \r this.checkListStyleAction();\r // }\r },\r \r checkAttachmentConfigAction: function () {\r if (this.options.readonly) {\r this.setAttachmentsAction(\"config\", false);\r return false;\r }\r if (this.attachments.length) {\r var user = layout.session.user.distinguishedName;\r for (var i = 0; i &lt; this.attachments.length; i++) {\r var flag = true;\r \r var att = this.attachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r if ((!att.data.control.allowControl) &amp;&amp; att.data.person !== user) { // || !att.data.control.allowEdit\r flag = false;\r }\r if (flag) {\r this.setAttachmentAction(att, \"config\", true);\r } else {\r this.setAttachmentAction(att, \"config\", false);\r }\r }\r }\r },\r checkConfigAction: function () {\r this.checkAttachmentConfigAction();\r if (this.options.readonly) {\r this.setActionDisabled(this.configAction);\r if (this.checkTextAction) this.setActionDisabled(this.checkTextAction);\r return false;\r }\r if (this.selectedAttachments.length) {\r var flag = true;\r var user = layout.session.user.distinguishedName;\r for (var i = 0; i &lt; this.selectedAttachments.length; i++) {\r var att = this.selectedAttachments[i];\r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r if ((!att.data.control.allowControl) &amp;&amp; att.data.person !== user) { //|| !att.data.control.allowEdit\r flag = false;\r break;\r }\r }\r if (flag) {\r this.setActionEnabled(this.configAction);\r } else {\r this.setActionDisabled(this.configAction);\r }\r //this.setActionEnabled(this.min_deleteAction);\r } else {\r this.setActionDisabled(this.configAction);\r //this.setActionDisabled(this.min_deleteAction);\r }\r \r if (this.checkTextAction) {\r this.setActionDisabled(this.checkTextAction);\r if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length === 1) {\r var att = this.selectedAttachments[0];\r if (this.options.images.indexOf(att.data.extension.toLowerCase()) !== -1) {\r this.setActionEnabled(this.checkTextAction);\r }\r }\r }\r },\r isAttConfigAvailable: function (att) {\r if (this.options.readonly) return false;\r if (this.options.toolbarGroupHidden.contains(\"config\")) return false;\r var user = layout.session.user.distinguishedName;\r var flag = true;\r \r if (!att.data.person &amp;&amp; att.data.creatorUid) att.data.person = att.data.creatorUid;\r \r if (!att.data.control.allowControl &amp;&amp; att.data.person !== user) {\r flag = false;\r }\r return flag;\r },\r \r createEditGroupActions: function () {\r if (!this.editActionBoxNode) this.editActionBoxNode = new Element(\"div\", { \"styles\": this.css.actionsBoxNode }).inject(this.topNode);\r if (!this.editActionsGroupNode) this.editActionsGroupNode = new Element(\"div\", { \"styles\": this.css.actionsGroupNode }).inject(this.editActionBoxNode);\r this.uploadAction = this.createAction(this.editActionsGroupNode, \"upload\", o2.LP.widget.upload, function (e, node) {\r this.uploadAttachment(e, node);\r }.bind(this));\r \r this.deleteAction = this.createAction(this.editActionsGroupNode, \"delete\", o2.LP.widget[\"delete\"], function (e, node) {\r this.deleteAttachment(e, node);\r }.bind(this));\r \r if (!this.options.isReplaceHidden) {\r this.replaceAction = this.createAction(this.editActionsGroupNode, \"replace\", o2.LP.widget.replace, function (e, node) {\r this.replaceAttachment(e, node);\r }.bind(this));\r }\r \r // this.officeAction = this.createAction(this.editActionsGroupNode, \"office\", o2.LP.widget.office, function(e, node){\r // this.openInOfficeControl(e, node);\r // }.bind(this));\r \r if (!this.options.toolbarGroupHidden.contains(\"read\")) this.editActionSeparateNode = this.createSeparate(this.editActionsGroupNode);\r },\r \r createConfigGroupActions: function () {\r this.configActionBoxNode = new Element(\"div\", { \"styles\": this.css.actionsBoxNode }).inject(this.topNode);\r this.configActionsGroupNode = new Element(\"div\", { \"styles\": this.css.actionsGroupNode }).inject(this.configActionBoxNode);\r \r this.configAction = this.createAction(this.configActionsGroupNode, \"config\", MWF.LP.widget.configAttachment, function (e, node) {\r this.configAttachment(e, node);\r }.bind(this));\r \r if (this.options.checkTextEnable) {\r this.checkTextAction = this.createAction(this.configActionsGroupNode, \"check\", MWF.LP.widget.checkOcrText, function (e, node) {\r this.checkImageTex(e, node);\r }.bind(this));\r }\r this.createSeparate(this.configActionsGroupNode);\r \r this.orderAction = this.createAction(this.configActionsGroupNode, \"order\", MWF.LP.widget.order, function (e, node) {\r this.orderAttachment(e, node);\r }.bind(this));\r \r if (this.configAction) this.setActionDisabled(this.configAction);\r if (this.checkTextAction) this.setActionDisabled(this.checkTextAction);\r },\r \r createOfficeGroupActions: function () {\r this.officeActionBoxNode = new Element(\"div\", { \"styles\": this.css.actionsBoxNode }).inject(this.topNode);\r this.officeActionsGroupNode = new Element(\"div\", { \"styles\": this.css.actionsGroupNode }).inject(this.officeActionBoxNode);\r \r this.closeOfficeAction = this.createAction(this.officeActionsGroupNode, \"closeOffice\", MWF.LP.widget.closeOffice, function (e, node) {\r this.closeAttachmentOffice(e, node);\r }.bind(this));\r if (this.closeOfficeAction) this.setActionDisabled(this.closeOfficeAction);\r },\r loadMinActions: function () {\r var hiddenGroup = this.options.toolbarGroupHidden;\r if (!hiddenGroup.contains(\"edit\")) {\r this.min_uploadAction = this.createAction(this.minActionAreaNode, \"upload\", MWF.LP.widget.upload, function (e, node) {\r this.uploadAttachment(e, node);\r }.bind(this));\r \r this.min_deleteAction = this.createAction(this.minActionAreaNode, \"delete\", MWF.LP.widget[\"delete\"], function (e, node) {\r this.deleteAttachment(e, node);\r }.bind(this));\r \r if (!this.options.isReplaceHidden) {\r this.min_replaceAction = this.createAction(this.minActionAreaNode, \"replace\", MWF.LP.widget.replace, function (e, node) {\r this.replaceAttachment(e, node);\r }.bind(this));\r }\r }\r if (!hiddenGroup.contains(\"read\")) {\r this.min_downloadAction = this.createAction(this.minActionAreaNode, \"download\", MWF.LP.widget.download\r , function (e, node) {\r this.downloadAttachment(e, node);\r }.bind(this));\r }\r if (!hiddenGroup.contains(\"config\")) {\r this.min_orderAction = this.createAction(this.minActionAreaNode, \"order\", MWF.LP.widget.order, function (e, node) {\r this.orderAttachment(e, node);\r }.bind(this));\r }\r \r if (this.module.json.isOpenInOffice &amp;&amp; this.module.json.officeControlName) {\r this.min_closeOfficeAction = this.createAction(this.minActionAreaNode, \"closeOffice\", MWF.LP.widget.closeOffice, function (e, node) {\r this.closeAttachmentOffice(e, node);\r }.bind(this));\r if (this.min_closeOfficeAction) this.setActionDisabled(this.closeOfficeAction);\r }\r \r \r if (!hiddenGroup.contains(\"edit\") || !hiddenGroup.contains(\"read\")) {\r this.createSeparate(this.minActionAreaNode);\r }\r \r //this.createSeparate(this.configActionsGroupNode);\r \r if (this.options.isSizeChange) {\r //this.createSeparate(this.minActionAreaNode);\r if (!hiddenGroup.contains(\"view\")) {\r this.sizeAction = this.createAction(this.minActionAreaNode, \"max\", MWF.LP.widget.min, function () {\r this.changeControllerSize();\r }.bind(this));\r }\r }\r },\r closeAttachmentOffice: function () {\r var office = this.module.form.all[this.module.json.officeControlName];\r if (office) {\r office.openFile();\r if (this.min_closeOfficeAction) this.setActionDisabled(this.min_closeOfficeAction);\r if (this.closeOfficeAction) this.setActionDisabled(this.closeOfficeAction);\r }\r },\r configAttachment: function () {\r //this.fireEvent(\"delete\", [attachment.data]);\r \r var lp = MWF.xApplication.process.Xform.LP;\r var css = this.module.form.css;\r var node = new Element(\"div\", { \"styles\": css.attachmentPermissionNode }).inject(this.node);\r var attNames = new Element(\"div\", { \"styles\": css.attachmentPermissionNamesNode }).inject(node);\r var attNamesTitle = new Element(\"div\", { \"styles\": css.attachmentPermissionNamesTitleNode, \"text\": lp.attachmentPermissionInfo }).inject(attNames);\r var attNamesArea = new Element(\"div\", { \"styles\": css.attachmentPermissionNamesAreaNode }).inject(attNames);\r \r if (this.selectedAttachments.length) {\r this.selectedAttachments.each(function (att) {\r var attNode = new Element(\"div\", { \"styles\": css.attachmentPermissionAttNode, \"text\": att.data.name }).inject(attNamesArea);\r }.bind(this));\r }\r \r var editArea = new Element(\"div\", { \"styles\": css.attachmentPermissionEditAreaNode }).inject(node);\r var title = new Element(\"div\", { \"styles\": css.attachmentPermissionTitleNode, \"text\": lp.attachmentRead }).inject(editArea);\r var readInput = new Element(\"div\", { \"styles\": css.attachmentPermissionInputNode }).inject(editArea);\r \r title = new Element(\"div\", { \"styles\": css.attachmentPermissionTitleNode, \"text\": lp.attachmentEdit }).inject(editArea);\r var editInput = new Element(\"div\", { \"styles\": css.attachmentPermissionInputNode }).inject(editArea);\r \r title = new Element(\"div\", { \"styles\": css.attachmentPermissionTitleNode, \"text\": lp.attachmentController }).inject(editArea);\r var controllerInput = new Element(\"div\", { \"styles\": css.attachmentPermissionInputNode }).inject(editArea);\r \r var dlg = o2.DL.open(Object.merge({\r \"title\": lp.attachmentPermission,\r \"style\": this.module.form.json.dialogStyle || \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r this.setAttachmentConfig(readInput, editInput, controllerInput);\r dlg.close();\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ]\r }, (this.module.form.json.dialogOptions||{})));\r \r if (this.selectedAttachments.length === 1) {\r var data = this.selectedAttachments[0].data;\r \r var readUnitList = (data.readUnitList) || [];\r var readIdentityList = (data.readIdentityList) || [];\r var editUnitList = (data.editUnitList) || [];\r var editIdentityList = (data.editIdentityList) || [];\r var controllerUnitList = (data.controllerUnitList) || [];\r var controllerIdentityList = (data.controllerIdentityList) || [];\r \r readInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"],\r \"values\": readUnitList.concat(readIdentityList).trim()\r }));\r editInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"],\r \"values\": editUnitList.concat(editIdentityList).trim()\r }));\r controllerInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"],\r \"values\": controllerUnitList.concat(controllerIdentityList).trim()\r }));\r } else {\r readInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"]\r }));\r editInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"]\r }));\r controllerInput.setSelectPerson(this.module.form.app.content, Object.merge(Object.clone(this.module.form.json.selectorStyle || {}), {\r \"types\": [\"unit\", \"identity\"]\r }));\r }\r },\r setAttachmentConfig: function (readInput, editInput, controllerInput) {\r if (this.selectedAttachments.length) {\r var readList = readInput.retrieve(\"data-value\");\r var editList = editInput.retrieve(\"data-value\");\r var controllerList = controllerInput.retrieve(\"data-value\");\r \r var readUnitList = [];\r var readIdentityList = [];\r var editUnitList = [];\r var editIdentityList = [];\r var controllerUnitList = [];\r var controllerIdentityList = [];\r \r if (readList) {\r readList.each(function (v) {\r var vName = (typeOf(v) === \"string\") ? v : v.distinguishedName;\r var len = vName.length;\r var flag = vName.substring(len - 1, len);\r if (flag === \"U\") readUnitList.push(vName);\r if (flag === \"I\") readIdentityList.push(vName);\r });\r }\r if (editList) {\r editList.each(function (v) {\r var vName = (typeOf(v) === \"string\") ? v : v.distinguishedName;\r var len = vName.length;\r var flag = vName.substring(len - 1, len);\r if (flag === \"U\") editUnitList.push(vName);\r if (flag === \"I\") editIdentityList.push(vName);\r });\r }\r if (controllerList) {\r controllerList.each(function (v) {\r var vName = (typeOf(v) === \"string\") ? v : v.distinguishedName;\r var len = vName.length;\r var flag = vName.substring(len - 1, len);\r if (flag === \"U\") controllerUnitList.push(vName);\r if (flag === \"I\") controllerIdentityList.push(vName);\r });\r }\r \r var loadedCount = 0;\r this.selectedAttachments.each(function (att) {\r att.data.readUnitList = readUnitList;\r att.data.readIdentityList = readIdentityList;\r att.data.editUnitList = editUnitList;\r att.data.editIdentityList = editIdentityList;\r att.data.controllerUnitList = controllerUnitList;\r att.data.controllerIdentityList = controllerIdentityList;\r \r o2.Actions.get(\"x_processplatform_assemble_surface\").configAttachment(att.data.id, this.module.form.businessData.work.id, att.data, function () {\r //刷新附件权限，以后要加一个刷新附件的功能\r o2.Actions.load(\"x_processplatform_assemble_surface\").AttachmentAction.getWithWorkOrWorkCompleted(att.data.id, this.module.form.businessData.work.id, function (json) {\r var attachment = this.getAttachmentById( att.data.id );\r if( attachment ){\r attachment.data = json.data;\r \r if( attachment.deleteAction &amp;&amp; !this.isAttDeleteAvailable(attachment) ){\r attachment.deleteAction.setStyle(\"display\",\"none\");\r }\r \r if( attachment.configAction &amp;&amp; !this.isAttConfigAvailable(attachment) ){\r attachment.configAction.setStyle(\"display\",\"none\");\r }\r }\r loadedCount++;\r if( loadedCount === this.selectedAttachments.length ){\r this.checkActions();\r }\r }.bind(this))\r }.bind(this));\r }.bind(this));\r }\r },\r \r checkImageTex: function () {\r if (this.selectedAttachments.length &amp;&amp; this.selectedAttachments.length == 1) {\r var att = this.selectedAttachments[0];\r var lp = MWF.xApplication.process.Xform.LP;\r var css = this.module.form.css;\r \r var node = new Element(\"div\", { \"styles\": css.attachmentOCRNode }).inject(this.node);\r var previewNode = new Element(\"div\", { \"styles\": css.attachmentOCRImageAreaNode }).inject(node);\r var imgNode = new Element(\"img\", { \"styles\": css.attachmentOCRImageNode }).inject(previewNode);\r \r o2.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentUrl(att.data.id, this.module.form.businessData.work.id, function (url) {\r imgNode.set(\"src\", o2.filterUrl(url));\r });\r \r var areaNode = new Element(\"div\", { \"styles\": css.attachmentOCRInputAreaNode }).inject(node);\r var inputNode = new Element(\"textarea\", { \"styles\": css.attachmentOCRInputNode }).inject(areaNode);\r \r var dlg = o2.DL.open({\r \"title\": lp.attachmentOCRTitle,\r \"style\": this.module.form.json.dialogStyle || \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r this.setAttachmentOCR(inputNode, att);\r dlg.close();\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ]\r });\r if (att.data.ocr) {\r inputNode.set(\"text\", att.data.ocr.text || \"\");\r } else {\r o2.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentOCR(att.data.id, this.module.form.businessData.work.id, function (json) {\r att.data.ocr = json.data;\r inputNode.set(\"text\", json.data.text || \"\");\r }.bind(this))\r }\r \r }\r },\r setAttachmentOCR: function (inputNode, att) {\r var data = inputNode.get(\"text\");\r if (!att.data.ocr) att.data.ocr = {};\r att.data.ocr.text = data;\r o2.Actions.get(\"x_processplatform_assemble_surface\").setAttachmentOCR(att.data.id, this.module.form.businessData.work.id, {\r \"text\": data\r }, function () {\r this.module.form.app.notice(\"success\", lp.attachmentOCR_saved, this.node);\r }.bind(this));\r },\r checkMoveAction: function (item) {\r if (item) {\r var actionArea = item.getFirst().getNext();\r var actionup = actionArea.getFirst().show();\r var actiondown = actionArea.getLast().show();\r \r tmp = item.getPrevious();\r if (!tmp) actionup.hide();\r \r tmp = item.getNext();\r if (!tmp) actiondown.hide();\r }\r },\r orderAttachment: function () {\r if (this.attachments.length) {\r this.attachments = this.attachments.sort(function (a1, a2) {\r if (!a2.data.orderNumber) return 1;\r if (!a1.data.orderNumber) return -1;\r return a1.data.orderNumber - a2.data.orderNumber;\r }.bind(this));\r \r var lp = MWF.xApplication.process.Xform.LP;\r var css = this.module.form.css;\r var node = new Element(\"div\", { \"styles\": css.attachmentOrderNode });\r var infoNode = new Element(\"div\", { \"styles\": css.attachmentOrderInforNode, \"text\": lp.attachmentOrderInfo }).inject(node);\r var attrchmentsNode = new Element(\"div\", { \"styles\": css.attachmentOrderAreaNode }).inject(node);\r \r var iconUrl = \"../x_component_File/$Main/icon.json\";\r var icons = null;\r o2.getJSON(iconUrl, function (json) {\r icons = json;\r }.bind(this), false, false);\r \r this.attachments.each(function (att, idx) {\r var iconName = icons[att.data.extension.toLowerCase()] || icons.unknow;\r var iconFolderUrl = \"../x_component_File/$Main/default/file/\" + iconName;\r \r var itemNode = new Element(\"div\", { \"styles\": css.attachmentOrderItemNode }).inject(attrchmentsNode);\r itemNode.store(\"att\", att);\r var icon = new Element(\"div\", { \"styles\": css.attachmentOrderItemIconNode }).inject(itemNode);\r icon.setStyle(\"background-image\", \"url('\" + iconFolderUrl + \"')\");\r \r var actionArea = new Element(\"div\", { \"styles\": css.attachmentOrderItemActionNode }).inject(itemNode);\r var text = new Element(\"div\", { \"styles\": css.attachmentOrderItemTextNode, \"text\": att.data.name }).inject(itemNode);\r \r var actionUp = new Element(\"div\", { \"styles\": css.attachmentOrderItemActionUpNode, \"text\": lp.attachmentOrderUp }).inject(actionArea);\r var actionDown = new Element(\"div\", { \"styles\": css.attachmentOrderItemActionDownNode, \"text\": lp.attachmentOrderDown }).inject(actionArea);\r if (idx == 0) actionUp.hide();\r if (idx == this.attachments.length - 1) actionDown.hide();\r \r actionUp.addEvent(\"click\", function (e) {\r var itemNode = e.target.getParent().getParent();\r var upNode = itemNode.getPrevious();\r if (upNode) {\r itemNode.inject(upNode, \"before\");\r this.checkMoveAction(upNode);\r }\r this.checkMoveAction(itemNode);\r itemNode.highlight();\r //itemNode.setStyle(\"background-color\", \"#faf9f1\");\r }.bind(this));\r \r actionDown.addEvent(\"click\", function (e) {\r var itemNode = e.target.getParent().getParent();\r var downNode = itemNode.getNext();\r if (downNode) {\r itemNode.inject(downNode, \"after\");\r this.checkMoveAction(downNode);\r }\r this.checkMoveAction(itemNode);\r itemNode.highlight();\r // /itemNode.setStyle(\"background-color\", \"#faf9f1\");\r }.bind(this));\r \r itemNode.addEvents({\r \"mouseover\": function (e) { this.setStyle(\"background-color\", \"#f1f6fa\"); },\r \"mouseout\": function (e) { this.setStyle(\"background-color\", \"#ffffff\"); }\r });\r \r //var droppables = attrchmentsNode.getChildren();\r \r new Drag(itemNode, {\r \"handle\": icon,\r \"snap\": 5,\r \"stopPropagation\": true,\r \"preventDefault\": true,\r onStart: function (el, e) {\r var itemNode = el;\r itemNode.setStyle(\"background-color\", \"#f1f6fa\");\r var moveNode = itemNode.clone(true).setStyles(css.attachmentOrderItemNode).setStyles({\r \"background-color\": \"#faf9f1\",\r \"opacity\": 0.8,\r \"border\": \"1px dotted #333333\"\r }).inject(node);\r moveNode.position({\r \"relativeTo\": itemNode,\r \"position\": 'upperLeft',\r \"edge\": 'upperLeft'\r });\r moveNode.owner = itemNode;\r \r var move = new Drag.Move(moveNode, {\r \"container\": node,\r \"droppables\": attrchmentsNode.getChildren(),\r \"onEnter\": function (el, drop) {\r moveNode.flagNode = new Element(\"div\", { \"styles\": css.attachmentOrderFlagNode }).inject(drop, \"before\");\r },\r \"onLeave\": function (el, drop) {\r if (moveNode.flagNode) moveNode.flagNode.destroy();\r },\r \"onDrop\": function (el, drop) {\r if (moveNode.flagNode) {\r moveNode.owner.inject(moveNode.flagNode, \"after\");\r moveNode.flagNode.destroy();\r moveNode.owner.highlight();\r this.checkMoveAction(moveNode.owner);\r this.checkMoveAction(drop);\r this.checkMoveAction(attrchmentsNode.getLast());\r moveNode.destroy()\r }\r }.bind(this)\r });\r move.start(e);\r \r \r }.bind(this),\r enter: function (el) {\r el.removeClass('dragging');\r }\r });\r //itemNode.dragMove\r \r \r }.bind(this));\r \r var dlg = o2.DL.open(Object.merge({\r \"title\": lp.attachmentOrderTitle,\r \"style\": this.module.form.json.dialogStyle || \"user\",\r \"isResize\": false,\r \"content\": node,\r \"width\": \"auto\",\r \"height\": \"auto\",\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r this.sortAttachment(attrchmentsNode);\r dlg.close();\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ],\r \"onPostLoad\": function () {\r var dlg = this;\r dlg.node.setStyle(\"display\", \"block\");\r \r var size = {};\r if (css.attachmentOrderNode) {\r if (parseFloat(css.attachmentOrderNode.width).toString() !== \"NaN\") {\r size.x = parseInt(css.attachmentOrderNode.width)\r }\r if (parseFloat(css.attachmentOrderNode.height).toString() !== \"NaN\") {\r size.y = parseInt(css.attachmentOrderNode.height)\r }\r }\r \r node.show();\r var nodeSize = node.getSize();\r dlg.content.setStyles({\r \"width\": size.x || nodeSize.x,\r \"height\": size.y || nodeSize.y\r });\r dlg.setContentSize();\r }\r }, (this.module.form.json.dialogOptions||{})));\r }\r },\r sortAttachment: function (node) {\r var nodes = node.getChildren();\r nodes.each(function (item, idx) {\r var att = item.retrieve(\"att\", null);\r if (att) {\r att.data.orderNumber = idx;\r o2.Actions.load(\"x_processplatform_assemble_surface\").AttachmentAction.changeOrderNumber(att.data.id, this.module.form.businessData.work.id, idx);\r }\r }.bind(this));\r this.attachments = this.attachments.sort(function (a1, a2) {\r if (!a2.data.orderNumber) return 1;\r if (!a1.data.orderNumber) return -1;\r return a1.data.orderNumber - a2.data.orderNumber;\r }.bind(this));\r \r this.reloadAttachments();\r this.fireEvent(\"order\");\r }\r \r });\r \r \r /** @class Attachment 附件组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var attachment = this.form.get(\"name\"); //获取组件\r * //方法2\r * var attachment = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Attachment = MWF.APPAttachment = new Class(\r /** @lends MWF.xApplication.process.Xform.Attachment# */\r {\r Extends: MWF.APP$Module,\r options: {\r /**\r * @event MWF.xApplication.process.Xform.Attachment#queryLoad\r * @ignore\r */\r /**\r * @event MWF.xApplication.process.Xform.Attachment#postLoad\r * @ignore\r */\r /**\r * 附件上传后触发。本事件中可以通过this.event获取上传附件的数据\r * @event MWF.xApplication.process.Xform.Attachment#upload\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 删除附件前触发。本事件中可以通过this.event获取被删附件的数据\r * @event MWF.xApplication.process.Xform.Attachment#delete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 删除附件后触发。本事件中可以通过this.event获取被删附件的数据\r * @event MWF.xApplication.process.Xform.Attachment#afterDelete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 附件容器加载时触发。\r * @event MWF.xApplication.process.Xform.Attachment#load\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 附件有变化的时候会被触发，包括上传、删除、排序\r * @event MWF.xApplication.process.Xform.Attachment#change\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 下载附件后触发。本事件中可以通过this.event获取被下载附件对象\r * @event MWF.xApplication.process.Xform.Attachment#download\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 打开附件后触发。本事件中可以通过this.event获取被打开附件对象\r * @event MWF.xApplication.process.Xform.Attachment#open\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"upload\", \"delete\", \"afterDelete\", \"load\", \"change\",\"download\",\"open\"]\r },\r \r initialize: function (node, json, form, options) {\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r \r _loadUserInterface: function () {\r this.node.empty();\r if (this.form.businessData.work.startTime){\r this.loadAttachmentController();\r this.fireEvent(\"load\");\r }\r },\r reload: function(){\r this.node.empty();\r if (this.form.businessData.work.startTime){\r this.loadAttachmentController();\r }\r },\r loadAttachmentController: function () {\r //MWF.require(\"MWF.widget.AttachmentController\", function() {\r var options = {\r \"style\": this.json.style || \"default\",\r \"title\": \"附件区域\",\r \"listStyle\": this.json.listStyle || \"icon\",\r \"size\": this.json.size || \"max\",\r \"resize\": (this.json.resize === \"y\" || this.json.resize === \"true\"),\r \"attachmentCount\": this.json.attachmentCount || 0,\r \"isUpload\": (this.json.isUpload === \"y\" || this.json.isUpload === \"true\"),\r \"isDelete\": (this.json.isDelete === \"y\" || this.json.isDelete === \"true\"),\r \"isReplace\": (this.json.isReplace === \"y\" || this.json.isReplace === \"true\"),\r \"isDownload\": (this.json.isDownload === \"y\" || this.json.isDownload === \"true\"),\r \"isSizeChange\": (this.json.isSizeChange === \"y\" || this.json.isSizeChange === \"true\"),\r \"readonly\": (this.json.readonly === \"y\" || this.json.readonly === \"true\"),\r \"availableListStyles\": this.json.availableListStyles ? this.json.availableListStyles : [\"list\", \"seq\", \"icon\", \"preview\"],\r \"isDeleteOption\": this.json.isDelete,\r \"isReplaceOption\": this.json.isReplace,\r \"toolbarGroupHidden\": this.json.toolbarGroupHidden || [],\r \"onOrder\": function () {\r this.fireEvent(\"change\");\r }.bind(this)\r };\r if (this.readonly) options.readonly = true;\r if (this.form.json.attachmentStyle) {\r options = Object.merge(options, this.form.json.attachmentStyle);\r }\r //this.attachmentController = new MWF.widget.ATTER(this.node, this, options);\r \r /**\r * @summary 附件容器.\r * @member {MWF.xApplication.process.Xform.AttachmentController}\r * @example\r * var attachmentController = this.form.get(\"fieldId\").AttachmentController; //获取附件容器\r * var attachmentList = attachmentController.attachments; //获取所有的附件\r * var attachmentData = attachment[0].data; //获取第一个附件的数据\r */\r this.attachmentController = new MWF.xApplication.process.Xform.AttachmentController(this.node, this, options);\r this.attachmentController.load();\r \r this.form.businessData.attachmentList.each(function (att) {\r //if (att.site===this.json.id || (this.json.isOpenInOffice &amp;&amp; this.json.officeControlName===att.site)) this.attachmentController.addAttachment(att);\r if (att.site === (this.json.site || this.json.id)) this.attachmentController.addAttachment(att);\r }.bind(this));\r this.setAttachmentBusinessData();\r //}.bind(this));\r },\r setAttachmentBusinessData: function () {\r if (this.attachmentController) {\r if (this.attachmentController.attachments.length) {\r var values = this.attachmentController.attachments.map(function (d) {\r return d.data.name;\r });\r this._setBusinessData(values);\r } else {\r this._setBusinessData([]);\r }\r }\r },\r \r _loadEvents: function (editorConfig) {\r Object.each(this.json.events, function (e, key) {\r if (e.code) {\r if (this.options.moduleEvents.indexOf(key) !== -1) {\r this.addEvent(key, function (event) {\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r } else {\r this.node.addEvent(key, function (event) {\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r \r },\r isEmpty : function(){\r var data = this.getData();\r if( typeOf(data) === \"array\" ){\r return data.length == 0\r }else{\r return !data;\r }\r },\r /**\r * @summary 获取当前组件所有附件的标题.如果没有附件返回null\r * @example\r * var getAttachmentNames = this.form.get(\"name\").getData();\r * @return {StringArray|Null} 附件标题.\r */\r getData: function () {\r return (this.attachmentController) ? this.attachmentController.getAttachmentNames() : null;\r },\r createUploadFileNode: function () {\r debugger;\r var accept = \"*\";\r if (!this.json.attachmentExtType || (this.json.attachmentExtType.indexOf(\"other\") != -1 &amp;&amp; !this.json.attachmentExtOtherType)) {\r } else {\r accepts = [];\r var otherType = this.json.attachmentExtOtherType;\r this.json.attachmentExtType.each(function (v) {\r switch (v) {\r case \"word\":\r accepts.push(\".doc, .docx, .dot, .dotx\");\r break;\r case \"excel\":\r accepts.push(\".xls, .xlsx, .xlsm, .xlt, .xltx\");\r break;\r case \"ppt\":\r accepts.push(\".pptx, .ppt, .pot, .potx, .potm\");\r break;\r case \"txt\":\r accepts.push(\".txt\");\r break;\r case \"pic\":\r accepts.push(\".bmp, .gif, .psd, .jpeg, .jpg, .png\");\r break;\r case \"pdf\":\r accepts.push(\".pdf\");\r break;\r case \"zip\":\r accepts.push(\".zip, .rar\");\r break;\r case \"audio\":\r accepts.push(\".mp3, .wav, .wma, .wmv, .flac, .ape\");\r break;\r case \"video\":\r accepts.push(\".avi, .mkv, .mov, .ogg, .mp4, .mpeg\");\r break;\r case \"other\":\r if (this.json.attachmentExtOtherType) accepts.push(this.json.attachmentExtOtherType);\r break;\r }\r }.bind(this));\r accept = accepts.join(\", \");\r }\r var size = 0;\r if (this.json.attachmentSize) size = this.json.attachmentSize.toFloat();\r this.attachmentController.doUploadAttachment({ \"site\": (this.json.site || this.json.id) }, this.form.workAction.action, \"uploadAttachment\", { \"id\": this.form.businessData.work.id }, null, function (o) {\r if (o.id) {\r this.form.workAction.getAttachment(o.id, this.form.businessData.work.id, function (json) {\r if (json.data) {\r if (!json.data.control) json.data.control = {};\r this.attachmentController.addAttachment(json.data, o.messageId);\r }\r this.attachmentController.checkActions();\r \r this.setAttachmentBusinessData();\r this.fireEvent(\"upload\", [json.data]);\r this.fireEvent(\"change\");\r }.bind(this))\r }\r this.attachmentController.checkActions();\r }.bind(this), function (files) {\r if (files.length) {\r if ((files.length + this.attachmentController.attachments.length > this.attachmentController.options.attachmentCount) &amp;&amp; this.attachmentController.options.attachmentCount > 0) {\r var content = MWF.xApplication.process.Xform.LP.uploadMore;\r content = content.replace(\"{n}\", this.attachmentController.options.attachmentCount);\r this.form.notice(content, \"error\");\r return false;\r }\r }\r return true;\r }.bind(this), true, accept, size, function (o) { //错误的回调\r if (o.messageId &amp;&amp; this.attachmentController.messageItemList) {\r var message = this.attachmentController.messageItemList[o.messageId];\r if( message &amp;&amp; message.node )message.node.destroy();\r }\r }.bind(this));\r \r \r // this.uploadFileAreaNode = new Element(\"div\");\r // var html = \"&lt;input name=\\\"file\\\" type=\\\"file\\\" multiple/>\";\r // this.uploadFileAreaNode.set(\"html\", html);\r //\r // this.fileUploadNode = this.uploadFileAreaNode.getFirst();\r // this.fileUploadNode.addEvent(\"change\", function(){\r //\r // var files = this.fileUploadNode.files;\r // if (files.length){\r // if ((files.length+this.attachmentController.attachments.length > this.attachmentController.options.attachmentCount) &amp;&amp; this.attachmentController.options.attachmentCount>0){\r // var content = MWF.xApplication.process.Xform.LP.uploadMore;\r // content = content.replace(\"{n}\", this.attachmentController.options.attachmentCount);\r // this.form.notice(content, \"error\");\r // }else{\r // for (var i = 0; i &lt; files.length; i++) {\r // var file = files.item(i);\r //\r // var formData = new FormData();\r // formData.append('site', this.json.id);\r // formData.append('file', file);\r //\r // //formData.append('folder', folderId);\r //\r // this.form.workAction.uploadAttachment(this.form.businessData.work.id ,function(o, text){\r // if (o.id){\r // this.form.workAction.getAttachment(o.id, this.form.businessData.work.id, function(json){\r // if (json.data) this.attachmentController.addAttachment(json.data);\r // this.attachmentController.checkActions();\r //\r // this.fireEvent(\"upload\", [json.data]);\r // }.bind(this))\r // }\r // this.attachmentController.checkActions();\r // }.bind(this), null, formData, file);\r // }\r // }\r // }\r // }.bind(this));\r },\r uploadAttachment: function (e, node) {\r if (window.o2android &amp;&amp; window.o2android.uploadAttachment) {\r window.o2android.uploadAttachment((this.json.site || this.json.id));\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.uploadAttachment) {\r window.webkit.messageHandlers.uploadAttachment.postMessage({ \"site\": (this.json.site || this.json.id) });\r } else {\r // if (!this.uploadFileAreaNode){\r this.createUploadFileNode();\r // }\r // this.fileUploadNode.click();\r }\r },\r deleteAttachments: function (e, node, attachments) {\r var names = [];\r attachments.each(function (attachment) {\r names.push(attachment.data.name);\r }.bind(this));\r \r // if ((window.o2 &amp;&amp; window.o2.replaceAttachment) || (window.webkit &amp;&amp; window.webkit.messageHandlers)){\r // if (window.confirm(MWF.xApplication.process.Xform.LP.deleteAttachment+\"( \"+names.join(\", \")+\" )\")){\r // while (attachments.length){\r // attachment = attachments.shift();\r // this.deleteAttachment(attachment);\r // }\r // }\r // }else {\r // var tmpNode = new Element(\"div\", {\r // \"styles\": {\r // \"background-color\": \"#0000ff\",\r // \"border-style\": \"solid\",\r // \"border-color\": \"#fff\",\r // \"border-width\": \"1\",\r // \"box-shadow\": \"0px 0px 20px #999\",\r // \"z-index\": \"20000\",\r // \"overflow\": \"hidden\",\r // \"font-size\": \"14px\",\r // \"height\": \"160px\",\r // \"padding\": \"0px\",\r // \"width\": \"300px\",\r // \"position\": \"absolute\",\r // \"top\": \"50px\",\r // \"left\": \"20px\",\r // \"opacity\": 1,\r // \"border-radius\": \"5px\"\r // }\r // }).inject(this.form.app.content);\r \r var _self = this;\r this.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.deleteAttachmentTitle, MWF.xApplication.process.Xform.LP.deleteAttachment + \"( \" + names.join(\", \") + \" )\", 300, 120, function () {\r while (attachments.length) {\r var attachment = attachments.shift();\r _self.deleteAttachment(attachment);\r }\r this.close();\r }, function () {\r this.close();\r }, null, null, this.form.json.confirmStyle);\r },\r deleteAttachment: function (attachment) {\r this.fireEvent(\"delete\", [attachment.data]);\r var id = attachment.data.id;\r this.form.workAction.deleteAttachment(attachment.data.id, this.form.businessData.work.id, function (josn) {\r this.attachmentController.removeAttachment(attachment);\r this.attachmentController.checkActions();\r \r if (this.form.officeList) {\r this.form.officeList.each(function (office) {\r if (office.openedAttachment) {\r if (office.openedAttachment.id == id) {\r office.loadOfficeEdit();\r }\r }\r }.bind(this));\r }\r this.setAttachmentBusinessData();\r this.fireEvent(\"afterDelete\", [attachment.data]);\r this.fireEvent(\"change\");\r }.bind(this));\r },\r \r replaceAttachment: function (e, node, attachment) {\r if (window.o2android &amp;&amp; window.o2android.replaceAttachment) {\r window.o2android.replaceAttachment(attachment.data.id, (this.json.site || this.json.id));\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.replaceAttachment) {\r window.webkit.messageHandlers.replaceAttachment.postMessage({ \"id\": attachment.data.id, \"site\": (this.json.site || this.json.id) });\r } else {\r var _self = this;\r this.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.replaceAttachmentTitle, MWF.xApplication.process.Xform.LP.replaceAttachment + \"( \" + attachment.data.name + \" )\", 350, 120, function () {\r _self.replaceAttachmentFile(attachment);\r this.close();\r }, function () {\r this.close();\r }, null, null, this.form.json.confirmStyle);\r }\r },\r \r createReplaceFileNode: function (attachment) {\r var accept = \"*\";\r if (!this.json.attachmentExtType || this.json.attachmentExtType.indexOf(\"other\") != -1 &amp;&amp; !this.json.attachmentExtOtherType) {\r } else {\r accepts = [];\r var otherType = this.json.attachmentExtOtherType;\r this.json.attachmentExtType.each(function (v) {\r switch (v) {\r case \"word\":\r accepts.push(\".doc, .docx, .dot, .dotx\");\r break;\r case \"excel\":\r accepts.push(\".xls, .xlsx, .xlsm, .xlt, .xltx\");\r break;\r case \"ppt\":\r accepts.push(\".pptx, .ppt, .pot, .potx, .potm\");\r break;\r case \"txt\":\r accepts.push(\".txt\");\r break;\r case \"pic\":\r accepts.push(\".bmp, .gif, .psd, .jpeg, .jpg\");\r break;\r case \"pdf\":\r accepts.push(\".pdf\");\r break;\r case \"zip\":\r accepts.push(\".zip, .rar\");\r break;\r case \"audio\":\r accepts.push(\".mp3, .wav, .wma, .wmv, .flac, .ape\");\r break;\r case \"video\":\r accepts.push(\".avi, .mkv, .mov, .ogg, .mp4, .mpeg\");\r break;\r case \"other\":\r if (this.json.attachmentExtOtherType) accepts.push(this.json.attachmentExtOtherType);\r break;\r }\r });\r accept = accepts.join(\", \");\r }\r var size = 0;\r if (this.json.attachmentSize) size = this.json.attachmentSize.toFloat();\r this.attachmentController.doUploadAttachment({ \"site\": (this.json.site || this.json.id) }, this.form.workAction.action, \"replaceAttachment\",\r { \"id\": attachment.data.id, \"workid\": this.form.businessData.work.id }, null, function (o) {\r this.form.workAction.getAttachment(attachment.data.id, this.form.businessData.work.id, function (json) {\r attachment.data = json.data;\r attachment.reload();\r \r if (o.messageId &amp;&amp; this.attachmentController.messageItemList) {\r var message = this.attachmentController.messageItemList[o.messageId];\r if( message &amp;&amp; message.node )message.node.destroy();\r }\r \r this.attachmentController.checkActions();\r }.bind(this))\r }.bind(this), null, true, accept, size, function (o) { //错误的回调\r if (o.messageId &amp;&amp; this.attachmentController.messageItemList) {\r var message = this.attachmentController.messageItemList[o.messageId];\r if( message &amp;&amp; message.node )message.node.destroy();\r }\r }.bind(this));\r \r // this.replaceFileAreaNode = new Element(\"div\");\r // var html = \"&lt;input name=\\\"file\\\" type=\\\"file\\\" multiple/>\";\r // this.replaceFileAreaNode.set(\"html\", html);\r //\r // this.fileReplaceNode = this.replaceFileAreaNode.getFirst();\r // this.fileReplaceNode.addEvent(\"change\", function(){\r //\r // var files = this.fileReplaceNode.files;\r // if (files.length){\r // for (var i = 0; i &lt; files.length; i++) {\r // var file = files.item(i);\r //\r // var formData = new FormData();\r // formData.append('file', file);\r // // formData.append('site', this.json.id);\r //\r // this.form.workAction.replaceAttachment(attachment.data.id, this.form.businessData.work.id ,function(o, text){\r // this.form.workAction.getAttachment(attachment.data.id, this.form.businessData.work.id, function(json){\r // attachment.data = json.data;\r // attachment.reload();\r // this.attachmentController.checkActions();\r // }.bind(this))\r // }.bind(this), null, formData, file);\r // }\r // }\r // }.bind(this));\r },\r \r replaceAttachmentFile: function (attachment) {\r //if (!this.replaceFileAreaNode){\r this.createReplaceFileNode(attachment);\r // }\r // this.fileReplaceNode.click();\r },\r queryDownload : function( att ){\r if( this.json.events &amp;&amp; this.json.events.queryDownload &amp;&amp; this.json.events.queryDownload.code ){\r var flag = this.form.Macro.exec(this.json.events.queryDownload.code, att );\r if( flag === false ){\r return false\r }else{\r return true;\r }\r }else{\r return true;\r }\r },\r queryOpen : function( att ){\r if( this.json.events &amp;&amp; this.json.events.queryOpen &amp;&amp; this.json.events.queryOpen.code ){\r var flag = this.form.Macro.exec(this.json.events.queryOpen.code, att );\r if( flag === false ){\r return false\r }else{\r return true;\r }\r }else{\r return true;\r }\r },\r //小程序文件是否支持打开\r checkMiniProgramFile: function(ext) {\r var exts = [\"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\", \"pdf\"];\r for(var i = 0; i &lt; exts.length; i++){\r if(ext === exts[i]){\r return true;\r }\r }\r return false;\r },\r downloadAttachment: function (e, node, attachments) {\r if (this.form.businessData.work &amp;&amp; !this.form.businessData.work.completedTime) {\r attachments.each(function (att) {\r if( !this.queryDownload( att ) )return;\r if (window.o2android &amp;&amp; window.o2android.downloadAttachment) {\r window.o2android.downloadAttachment(att.data.id);\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.downloadAttachment) {\r window.webkit.messageHandlers.downloadAttachment.postMessage({ \"id\": att.data.id, \"site\": (this.json.site || this.json.id) });\r } else if (window.wx &amp;&amp; window.__wxjs_environment === 'miniprogram' &amp;&amp; this.checkMiniProgramFile(att.data.extension)) { //微信小程序\r wx.miniProgram.navigateTo({ \r url: '../file/download?attId=' + att.data.id + '&amp;type=work&amp;work=' + this.form.businessData.work.id\r });\r } else {\r if (layout.mobile) {\r //移动端 企业微信 钉钉 用本地打开 防止弹出自带浏览器 无权限问题\r this.form.workAction.getAttachmentUrl(att.data.id, this.form.businessData.work.id, function (url) {\r var xtoken = Cookie.read(\"x-token\");\r window.location = o2.filterUrl(url + \"?x-token=\" + xtoken);\r });\r } else {\r this.form.workAction.getAttachmentStream(att.data.id, this.form.businessData.work.id);\r }\r }\r this.fireEvent(\"download\",[att])\r }.bind(this));\r } else {\r attachments.each(function (att) {\r if( !this.queryDownload( att ) )return;\r if (window.o2android &amp;&amp; window.o2android.downloadAttachment) {\r window.o2android.downloadAttachment(att.data.id);\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.downloadAttachment) {\r window.webkit.messageHandlers.downloadAttachment.postMessage({ \"id\": att.data.id, \"site\": (this.json.site || this.json.id) });\r } else if (window.wx &amp;&amp; window.__wxjs_environment === 'miniprogram' &amp;&amp; this.checkMiniProgramFile(att.data.extension)) { //微信小程序\r wx.miniProgram.navigateTo({ \r url: '../file/download?attId=' + att.data.id + '&amp;type=work&amp;workCompleted=' + this.form.businessData.workCompleted.id\r });\r } else {\r if (layout.mobile) {\r //移动端 企业微信 钉钉 用本地打开 防止弹出自带浏览器 无权限问题\r this.form.workAction.getAttachmentWorkcompletedUrl(att.data.id, this.form.businessData.workCompleted.id, function (url) {\r var xtoken = Cookie.read(\"x-token\");\r window.location = o2.filterUrl(url + \"?x-token=\" + xtoken);\r });\r } else {\r this.form.workAction.getWorkcompletedAttachmentStream(att.data.id, this.form.businessData.workCompleted.id);\r }\r }\r this.fireEvent(\"download\",[att])\r }.bind(this));\r }\r },\r openAttachment: function (e, node, attachments) {\r if (this.form.businessData.work &amp;&amp; !this.form.businessData.work.completedTime) {\r attachments.each(function (att) {\r if( !this.queryOpen( att ) )return;\r if (window.o2android &amp;&amp; window.o2android.downloadAttachment) {\r window.o2android.downloadAttachment(att.data.id);\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.downloadAttachment) {\r window.webkit.messageHandlers.downloadAttachment.postMessage({ \"id\": att.data.id, \"site\": (this.json.site || this.json.id) });\r } else if (window.wx &amp;&amp; window.__wxjs_environment === 'miniprogram' &amp;&amp; this.checkMiniProgramFile(att.data.extension)) { //微信小程序\r wx.miniProgram.navigateTo({ \r url: '../file/download?attId=' + att.data.id + '&amp;type=work&amp;work=' + this.form.businessData.work.id\r });\r } else {\r if (layout.mobile) {\r //移动端 企业微信 钉钉 用本地打开 防止弹出自带浏览器 无权限问题\r this.form.workAction.getAttachmentUrl(att.data.id, this.form.businessData.work.id, function (url) {\r var xtoken = Cookie.read(\"x-token\");\r window.location = o2.filterUrl(url + \"?x-token=\" + xtoken);\r });\r } else {\r this.form.workAction.getAttachmentData(att.data.id, this.form.businessData.work.id);\r }\r \r }\r this.fireEvent(\"open\",[att])\r }.bind(this));\r } else {\r attachments.each(function (att) {\r if( !this.queryOpen( att ) )return;\r if (window.o2android &amp;&amp; window.o2android.downloadAttachment) {\r window.o2android.downloadAttachment(att.data.id);\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.downloadAttachment) {\r window.webkit.messageHandlers.downloadAttachment.postMessage({ \"id\": att.data.id, \"site\": (this.json.site || this.json.id) });\r } else if (window.wx &amp;&amp; window.__wxjs_environment === 'miniprogram' &amp;&amp; this.checkMiniProgramFile(att.data.extension)) { //微信小程序\r wx.miniProgram.navigateTo({ \r url: '../file/download?attId=' + att.data.id + '&amp;type=work&amp;workCompleted=' + this.form.businessData.workCompleted.id\r });\r } else {\r \r if (layout.mobile) {\r //移动端 企业微信 钉钉 用本地打开 防止弹出自带浏览器 无权限问题\r this.form.workAction.getAttachmentWorkcompletedUrl(att.data.id, ((this.form.businessData.workCompleted) ? this.form.businessData.workCompleted.id : this.form.businessData.work.id), function (url) {\r var xtoken = Cookie.read(\"x-token\");\r window.location = o2.filterUrl(url + \"?x-token=\" + xtoken);\r });\r } else {\r this.form.workAction.getWorkcompletedAttachmentData(att.data.id, ((this.form.businessData.workCompleted) ? this.form.businessData.workCompleted.id : this.form.businessData.work.id));\r }\r }\r this.fireEvent(\"open\",[att])\r }.bind(this));\r }\r //this.downloadAttachment(e, node, attachment);\r },\r getAttachmentUrl: function (attachment, callback) {\r if (this.form.businessData.work &amp;&amp; !this.form.businessData.work.completedTime) {\r this.form.workAction.getAttachmentUrl(attachment.data.id, this.form.businessData.work.id, callback);\r } else {\r this.form.workAction.getAttachmentWorkcompletedUrl(attachment.data.id, this.form.businessData.workCompleted.id, callback);\r }\r },\r getTextData: function(){\r var data = [];\r this.attachmentController.attachments.each(function(att){\r var o = {\r \"id\": att.data.id,\r \"person\": att.data.person,\r \"creatorUid\": att.data.creatorUid,\r \"name\": att.data.name,\r \"orderNumber\": att.data.orderNumber,\r \"length\": att.data.length,\r \"extension\": att.data.extension,\r \"lastUpdateTime\": att.data.lastUpdateTime,\r \"activityName\": att.data.activityName,\r \"control\" : att.data.control\r }\r data.push(o);\r });\r return data;\r },\r /**\r * @summary 为组件重新设置附件，该附件必须已经上传。\r * @param data {Object}.\r * &lt;pre>&lt;code class='language-js'>{\r * \"id\": \"56c4e86f-a4c8-4cc2-a150-1a0d2c5febcb\", //附件ID\r * \"name\": \"133203a2-92e6-4653-9954-161b72ddb7f9.png\", //附件名称\r * \"extension\": \"png\", //附件扩展名\r * \"length\": 43864, //附件大小\r * \"person\": \"xx@huqi@P\", //附件上传人\r * \"lastUpdateTime\": \"2018-09-27 15:50:34\", //最后的修改时间\r * \"lastUpdatePerson\": \"xx@huqi@P\", //最后的修改人\r * \"activity\": \"e31ad938-c495-45a6-8d77-b8a9b61a165b\", //附件上传的活动ID\r * \"activityName\": \"申请人\", //附件上传的活动名称\r * \"activityType\": \"manual\", //附件上传的活动类型\r * \"site\": \"$mediaOpinion\", //附件存储位置（一般用于区分附件在哪个表单元素中显示）\r * \"type\": \"image/png\" //附件类型（contentType）\r * }&lt;/code>&lt;/pre>\r */\r setData: function(data){\r this.attachmentController.clear();\r ( data || [] ).each(function (att) {\r var attachment = this.form.businessData.attachmentList.find(function(a){\r return a.id==att.id;\r });\r var attData = attachment || att;\r \r this.attachmentController.addAttachment(attData);\r }.bind(this));\r this.setAttachmentBusinessData();\r },\r createErrorNode: function (text) {\r var node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\" + \"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r return node;\r },\r notValidationMode: function (text) {\r if (!this.isNotValidationMode) {\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border\", \"1px solid red\");\r \r this.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r this.showNotValidationMode(this.node);\r }\r },\r showNotValidationMode: function (node) {\r var p = node.getParent(\"div\");\r if (p) {\r if (p.get(\"MWFtype\") == \"tab$Content\") {\r if (p.getParent(\"div\").getStyle(\"display\") == \"none\") {\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function () {\r if (this.isNotValidationMode) {\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode) {\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r validationConfigItem: function (routeName, data) {\r var flag = (data.status == \"all\") ? true : (routeName == data.decision);\r if (flag) {\r var n = this.getData();\r var v = (data.valueType == \"value\") ? n : n.length;\r switch (data.operateor) {\r case \"isnull\":\r if (!v) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v > data.value) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v &lt; data.value) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v == data.value) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v != data.value) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value) != -1) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value) == -1) {\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function (routeName, opinion) {\r if (this.json.validationConfig) {\r if (this.json.validationConfig.length) {\r for (var i = 0; i &lt; this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function (routeName, opinion) {\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r \r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r \r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString() != \"true\") {\r this.notValidationMode(flag);\r return false;\r }\r return true;\r }\r \r });\r \r MWF.xApplication.process.Xform.AttachmentDg = MWF.APPAttachmentDg = new Class({\r Extends: MWF.APPAttachment,\r loadAttachmentController: function () {\r //MWF.require(\"MWF.widget.AttachmentController\", function() {\r var options = {\r \"style\": this.json.style || \"default\",\r \"title\": \"附件区域DG\",\r \"listStyle\": this.json.listStyle || \"icon\",\r \"size\": this.json.size || \"max\",\r \"resize\": (this.json.resize === \"y\" || this.json.resize === \"true\"),\r \"attachmentCount\": this.json.attachmentCount || 0,\r \"isUpload\": (this.json.isUpload === \"y\" || this.json.isUpload === \"true\"),\r \"isDelete\": (this.json.isDelete === \"y\" || this.json.isDelete === \"true\"),\r \"isReplace\": (this.json.isReplace === \"y\" || this.json.isReplace === \"true\"),\r \"isDownload\": (this.json.isDownload === \"y\" || this.json.isDownload === \"true\"),\r \"isSizeChange\": (this.json.isSizeChange === \"y\" || this.json.isSizeChange === \"true\"),\r \"readonly\": (this.json.readonly === \"y\" || this.json.readonly === \"true\"),\r \"availableListStyles\": this.json.availableListStyles ? this.json.availableListStyles : [\"list\", \"seq\", \"icon\", \"preview\"],\r \"isDeleteOption\": this.json.isDelete,\r \"isReplaceOption\": this.json.isReplace,\r \"toolbarGroupHidden\": this.json.toolbarGroupHidden || [],\r \"onOrder\": function () {\r this.fireEvent(\"change\");\r }.bind(this)\r };\r if (this.readonly) options.readonly = true;\r if (this.form.json.attachmentStyle) {\r options = Object.merge(options, this.form.json.attachmentStyle);\r }\r this.attachmentController = new MWF.xApplication.process.Xform.AttachmentController(this.node, this, options);\r this.attachmentController.load();\r \r // var d = this._getBusinessData();\r // if (d) d.each(function (att) {\r // this.attachmentController.addAttachment(att);\r // }.bind(this));\r this.form.businessData.attachmentList.each(function (att) {\r if (att.site === (this.json.site || this.json.id)) this.attachmentController.addAttachment(att);\r }.bind(this));\r this.setAttachmentBusinessData();\r },\r setAttachmentBusinessData: function(){\r if (this.attachmentController) {\r if (this.attachmentController.attachments.length) {\r var values = this.attachmentController.attachments.map(function (d) {\r return {\r \"control\": d.data.control,\r \"name\": d.data.name,\r \"id\": d.data.id,\r \"person\": d.data.person,\r \"creatorUid\": d.data.creatorUid,\r \"orderNumber\": d.data.orderNumber,\r \"length\": d.data.length,\r \"extension\": d.data.extension,\r \"lastUpdateTime\": d.data.lastUpdateTime,\r \"activityName\": d.data.activityName\r };\r });\r this._setBusinessData(values);\r } else {\r this._setBusinessData([]);\r }\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Button.js.html":{"url":"x_component_process_Xform_Button.js.html","title":"x_component_process_Xform/Button.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Button.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Button.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Button 按钮组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var button = this.form.get(\"name\"); //获取组件\r * //方法2\r * var button = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Button = MWF.APPButton = new Class({\r Implements: [Events],\r Extends: MWF.APP$Module,\r iconStyle: \"personfieldIcon\",\r \r _loadUserInterface: function(){\r // var button = new Element(\"button\");\r // button.inject(this.node, \"after\");\r // this.node.destroy();\r // this.node = button;\r \r var button = this.node.getElement(\"button\");\r if (!button) button = new Element(\"button\");\r button.inject(this.node, \"after\");\r this.node.destroy();\r this.node = button;\r \r this.node.set({\r \"id\": this.json.id,\r \"text\": this.json.name || this.json.id,\r \"MWFType\": this.json.type\r });\r if (!this.json.preprocessing) this.node.setStyles(this.form.css.buttonStyles);\r \r }\r \r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Calendar.js.html":{"url":"x_component_process_Xform_Calendar.js.html","title":"x_component_process_Xform/Calendar.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Calendar.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Calendar.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r /** @class Calendar 日期组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Calendar = MWF.APPCalendar = new Class(\r /** @lends MWF.xApplication.process.Xform.Calendar# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \ticonStyle: \"calendarIcon\",\r options: {\r /**\r * 日期选择完成时触发.\r * @event MWF.xApplication.process.Xform.Calendar#complete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 日期选择器上点清空时触发.\r * @event MWF.xApplication.process.Xform.Calendar#clear\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 值改变时触发.\r * @event MWF.xApplication.process.Xform.Calendar#change\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 显示日期选择器时触发.\r * @event MWF.xApplication.process.Xform.Calendar#show\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 隐藏日期选择器时触发.\r * @event MWF.xApplication.process.Xform.Calendar#hide\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"queryLoad\",\"postLoad\",\"load\",\"complete\", \"clear\", \"change\",\"show\",\"hide\"]\r },\r _loadNode: function(){\r if (this.readonly || this.json.isReadonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r this.descriptionNode.addEvents({\r \"mousedown\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r //this.clickSelect();\r }.bind(this)\r });\r }\r },\r _getValueAg: function(value,isDate){\r if (value &amp;&amp; value.isAG){\r return value.then(function(v){\r this._getValueAg(v, isDate);\r }.bind(this), function(){});\r }else{\r var d = (!!value) ? Date.parse(value) : \"\";\r if (isDate){\r return d || null;\r }else{\r return (d) ? d.format(this.json.format) : \"\";\r }\r }\r },\r getValue: function(isDate){\r if (this.moduleValueAG) return this.moduleValueAG;\r var value = this._getBusinessData();\r if( value &amp;&amp; !isDate)return value;\r if (!value) value = this._computeValue();\r if (value.then) return value;\r \r var d = (!!value) ? Date.parse(value) : \"\";\r if (isDate){\r return d || null;\r }else{\r //if (d) value = Date.parse(value).format(this.json.format);\r return (d) ? d.format(this.json.format) : \"\";\r }\r \r return value || \"\";\r },\r getValueStr : function(){\r var value = this._getBusinessData();\r if (!value) value = this._computeValue();\r return value;\r },\r \r __setValue: function(value){\r var v;\r if( typeOf( value ) === \"date\" ){\r v = (value) ? ( Date.parse(value)).format(this.json.format) : \"\";\r }else{\r v = value;\r }\r this._setBusinessData(value);\r if (this.node.getFirst()) this.node.getFirst().set(\"value\", v || \"\");\r if (this.readonly || this.json.isReadonly) this.node.set(\"text\", v);\r this.moduleValueAG = null;\r return value;\r },\r \r \tclickSelect: function(){\r \r var _self = this;\r if (!this.calendar){\r MWF.require(\"MWF.widget.Calendar\", function(){\r var options = {\r \"style\": layout.mobile ? \"xform_mobile\" : \"xform\",\r \"secondEnable\" : this.json.isSelectSecond,\r \"isTime\": (this.json.selectType===\"datetime\" || this.json.selectType===\"time\"),\r \"timeOnly\": (this.json.selectType === \"time\"),\r //\"target\": this.form.node,\r \"target\": layout.mobile ? $(document.body) : this.form.app.content,\r \"format\": this.json.format,\r \"onComplate\": function(formateDate, date){\r this.validationMode();\r if(this.validation())this._setBusinessData(this.getInputData(\"change\"));\r this.fireEvent(\"complete\");\r }.bind(this),\r \"onChange\": function(){\r this.fireEvent(\"change\");\r }.bind(this),\r \"onClear\": function(){\r this.validationMode();\r if(this.validation())this._setBusinessData(this.getInputData(\"change\"));\r this.fireEvent(\"clear\");\r if (!this.node.getFirst().get(\"value\")) if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"block\");\r }.bind(this),\r \"onShow\": function(){\r if (_self.descriptionNode) _self.descriptionNode.setStyle(\"display\", \"none\");\r \r if( layout.mobile ){\r this.container.position({\r relativeTo: $(document.body),\r position: 'leftCenter',\r edge: 'leftCenter'\r //offset : { y : -25 }\r });\r }else{\r var parent = _self.node.getParent();\r while( parent ){\r var overflow = parent.getStyle(\"overflow\");\r var overflowY = parent.getStyle(\"overflow-y\");\r if( overflow === \"auto\" || overflow === \"scroll\" || overflowY === \"auto\" || overflowY === \"scroll\" ){\r _self.scrollFun = function( e ){\r if (this.container.position ) {\r this.container.position({\r relativeTo: this.node,\r position: 'bottomLeft',\r edge: 'upperLeft',\r allowNegative : true\r });\r }\r }.bind(this);\r _self.scrollParentNode = parent;\r parent.addEvent( \"scroll\", _self.scrollFun );\r parent = null;\r }else{\r parent = parent.getParent();\r }\r }\r }\r _self.fireEvent(\"show\");\r },\r \"onHide\": function(){\r if (!this.node.getFirst().get(\"value\")) if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"block\");\r if( _self.scrollParentNode &amp;&amp; _self.scrollFun ){\r _self.scrollParentNode.removeEvent(\"scroll\", _self.scrollFun);\r }\r _self.fireEvent(\"hide\");\r }.bind(this)\r };\r options.baseDate = this.getBaseDate();\r /**\r * @summary 日期弹出选择界面，只读情况下无此成员.\r * @member {MWF.widget.Calendar}\r * @example\r * var calendar = this.form.get(\"fieldId\").calendar; //获取组件\r * if(calendar)calendar.show(); //弹出选择组件\r */\r this.calendar = new MWF.widget.Calendar(this.node.getFirst(), options);\r if( this.form.json &amp;&amp; this.form.json.canlendarStyle &amp;&amp; typeOf( this.form.json.canlendarStyle.zIndex ) !== \"null\" &amp;&amp; typeOf( this.form.json.canlendarStyle.zIndex ) !== \"undefined\" ){\r this.calendar.container.setStyle(\"z-index\", this.form.json.canlendarStyle.zIndex );\r }\r this.calendar.show();\r }.bind(this));\r }else{\r var options = {};\r options.baseDate = this.getBaseDate();\r this.calendar.setOptions(options);\r //this.calendar.show();\r this.node.getFirst().focus();\r }\r \t},\r getBaseDate : function(){\r var d;\r var value = this.getValue(true);\r if( value &amp;&amp; value.getTime() > 10000 ){\r d = value;\r }else{\r var ud = Date.parse( this.unformatDate( this.getValueStr() ) );\r if( ud &amp;&amp; ud.getTime() > 10000 ){\r d = ud;\r }else{\r d = new Date();\r }\r }\r return d;\r },\r unformatDate : function( dateStr ){\r var formatStr = this.json.format;\r var matchArr = [ \"%Y\", \"%m\", \"%d\", \"%H\", \"%M\", \"%S\", \"%z\", \"%Z\" ];\r var lengthArr = [ 4, 2, 2, 2, 2, 2, 5, 3];\r var indexArr = [ formatStr.indexOf(\"%Y\"), formatStr.indexOf(\"%m\"), formatStr.indexOf(\"%d\"), formatStr.indexOf(\"%H\"), formatStr.indexOf(\"%M\"), formatStr.indexOf(\"%S\"), formatStr.indexOf(\"%z\"), formatStr.indexOf(\"%Z\") ];\r var resultArr = [ null, null, null, null, null, null, null, null ];\r for( var i=0; i&lt;matchArr.length; i++ ){\r if( indexArr[i] === -1 )continue;\r var leftLength = 0;\r var leftUnitLength = 0;\r Array.each( indexArr, function( n, k ){\r if( n === -1 )return;\r if( indexArr[i] > n ){\r leftLength += lengthArr[k];\r leftUnitLength += matchArr[k].length;\r }\r });\r resultArr[i] = dateStr.substr( indexArr[i] - leftUnitLength + leftLength, lengthArr[i] );\r }\r var now = new Date();\r for( var i=0; i &lt; resultArr.length; i++ ){\r if( !resultArr[i] ){\r switch ( matchArr[i] ){\r case \"%Y\":\r case \"%m\":\r case \"%d\":\r resultArr[i] = now.format( matchArr[i] );\r break;\r case \"%H\":\r case \"%M\":\r case \"%S\":\r resultArr[i] = \"00\";\r break;\r case \"%z\":\r case \"%Z\":\r default:\r break;\r }\r }\r }\r return resultArr[0] + \"-\" + resultArr[1] + \"-\" + resultArr[2] + \" \" + resultArr[3]+\":\"+resultArr[4]+\":\"+resultArr[5];\r }\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Checkbox.js.html":{"url":"x_component_process_Xform_Checkbox.js.html","title":"x_component_process_Xform/Checkbox.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Checkbox.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Checkbox.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r MWF.require(\"MWF.widget.UUID\", null, false);\r /** @class Calendar 多选按钮组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Checkbox = MWF.APPCheckbox = new Class(\r /** @lends MWF.xApplication.process.Xform.Checkbox# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \r loadDescription: function(){},\r _loadNode: function(){\r if (this.readonly || this.json.isReadonly ){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r var radioValues = this.getOptions();\r var value = this.getValue();\r if (value){\r var texts = [];\r radioValues.each(function(item){\r var tmps = item.split(\"|\");\r var t = tmps[0];\r var v = tmps[1] || t;\r \r if (value.indexOf(v)!=-1){\r texts.push(t);\r }\r });\r this.node.set(\"text\", texts.join(\", \"));\r }\r },\r _resetNodeEdit: function(){\r var div = new Element(\"div\");\r div.set(this.json.properties);\r div.inject(this.node, \"after\");\r \r this.node.destroy();\r this.node = div;\r },\r _loadNodeEdit: function(){\r \t\t//this.container = new Element(\"select\");\r if (!this.json.preprocessing) this._resetNodeEdit();\r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type,\r \t\t\t\"styles\": {\r \t\t\t\t\"display\": \"inline\"\r \t\t\t}\r \t\t});\r \t\tthis.setOptions();\r \t},\r _loadDomEvents: function(){\r },\r _loadEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!=-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }else{\r //this.node.addEvent(key, function(event){\r // return this.form.Macro.fire(e.code, this, event);\r //}.bind(this));\r }\r }\r }.bind(this));\r },\r addModuleEvent: function(key, fun){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }else{\r var inputs = this.node.getElements(\"input\");\r inputs.each(function(input){\r input.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }.bind(this));\r }\r },\r /**\r * @summary 重新计算下拉选项，该功能通常用在下拉选项为动态计算的情况.\r * @example\r * this.form.get('fieldId').resetOption();\r */\r resetOption: function(){\r this.node.empty();\r this.setOptions();\r },\r /**\r * @summary 获取选择项。\r * @return {Array} 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：&lt;pre>&lt;code class='language-js'>[\r * \"女|female\",\r * \"男|male\"\r * ]&lt;/code>&lt;/pre>\r * @example\r * this.form.get('fieldId').getOptions();\r */\r \tgetOptions: function(){\r \t\tif (this.json.itemType == \"values\"){\r \t\t\treturn this.json.itemValues;\r \t\t}else{\r \t\t\treturn this.form.Macro.exec(((this.json.itemScript) ? this.json.itemScript.code : \"\"), this);\r \t\t}\r \t\t//return [];\r \t},\r \r /**\r * @summary 获取整理后的选择项。\r * @return {Object} 返回整理后的选择项，如：\r * &lt;pre>&lt;code class='language-js'>{\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]}\r * &lt;/code>&lt;/pre>\r * @example\r * var optionData = this.form.get('fieldId').getOptionsObj();\r */\r getOptionsObj : function(){\r var textList = [];\r var valueList = [];\r var optionItems = this.getOptions();\r if (!optionItems) optionItems = [];\r if (o2.typeOf(optionItems)===\"array\"){\r optionItems.each(function(item){\r var tmps = item.split(\"|\");\r textList.push( tmps[0] );\r valueList.push( tmps[1] || tmps[0] );\r }.bind(this));\r }\r return { textList : textList, valueList : valueList };\r },\r \r setOptions: function(){\r var optionItems = this.getOptions();\r this._setOptions(optionItems);\r },\r \r _setOptions: function(optionItems){\r var p = o2.promiseAll(optionItems).then(function(radioValues){\r this.moduleSelectAG = null;\r if (!radioValues) radioValues = [];\r if (o2.typeOf(radioValues)===\"array\"){\r var flag = (new MWF.widget.UUID).toString();\r radioValues.each(function(item){\r var tmps = item.split(\"|\");\r var text = tmps[0];\r var value = tmps[1] || text;\r \r var radio = new Element(\"input\", {\r \"type\": \"checkbox\",\r \"name\": ((this.json.properties) ? this.json.properties.name : null) || flag+this.json.id,\r \"value\": value,\r \"showText\": text,\r \"styles\": this.json.buttonStyles\r }).inject(this.node);\r //radio.appendText(text, \"after\");\r \r var textNode = new Element( \"span\", {\r \"text\" : text,\r \"styles\" : { \"cursor\" : \"default\" }\r }).inject(this.node);\r textNode.addEvent(\"click\", function( ev ){\r if( this.radio.get(\"disabled\") === true || this.radio.get(\"disabled\") === \"true\" )return;\r this.radio.checked = ! this.radio.checked;\r this.radio.fireEvent(\"change\");\r this.radio.fireEvent(\"click\");\r }.bind( {radio : radio} ) );\r \r radio.addEvent(\"click\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\") || []);\r }.bind(this));\r \r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!=-1){\r }else{\r radio.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r \r }.bind(this));\r }\r }.bind(this), function(){});\r this.moduleSelectAG = p;\r if (p) p.then(function(){\r this.moduleSelectAG = null;\r }.bind(this), function(){\r this.moduleSelectAG = null;\r }.bind(this));\r \t},\r \r _setValue: function(value, m){\r var mothed = m || \"__setValue\";\r \t if (!!value){\r var p = o2.promiseAll(value).then(function(v){\r //if (o2.typeOf(v)==\"array\") v = v[0];\r if (this.moduleSelectAG){\r this.moduleValueAG = this.moduleSelectAG;\r this.moduleSelectAG.then(function(){\r this[mothed](v);\r return v;\r }.bind(this), function(){});\r }else{\r this[mothed](v)\r }\r return v;\r }.bind(this), function(){});\r this.moduleValueAG = p;\r if (this.moduleValueAG) this.moduleValueAG.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r }else{\r this[mothed](value);\r }\r \r \r // this.moduleValueAG = o2.AG.all(value).then(function(v){\r // if (this.moduleSelectAG){\r // this.moduleValueAG = this.moduleSelectAG;\r // this.moduleSelectAG.then(function(){\r // this.moduleValueAG = null;\r // this.__setValue(v);\r // }.bind(this));\r // }else{\r // this.moduleValueAG = null;\r // this.__setValue(v);\r // }\r // return v;\r // }.bind(this));\r //\r // if (this.moduleValueAG) this.moduleValueAG.then(function(){\r // this.moduleValueAG = \"\";\r // }.bind(this));\r },\r \r __setValue: function(value){\r this._setBusinessData(value);\r var radios = this.node.getElements(\"input\");\r for (var i=0; i&lt;radios.length; i++){\r var radio = radios[i];\r radio.checked = value.indexOf(radio.value) != -1;\r }\r },\r /**\r * @summary 获取选中的值和文本.\r * @example\r * var array = this.form.get('fieldId').getTextData();\r * @return {Object} 返回选中项值和文本，格式为 { 'value' : value, 'text' : text }.\r */\r \tgetTextData: function(){\r \t\tvar inputs = this.node.getElements(\"input\");\r \t\tvar value = [];\r \t\tvar text = [];\r \t\tif (inputs.length){\r \t\t\tinputs.each(function(input){\r \t\t\t\tif (input.checked){\r \t\t\t\t\tvar v = input.get(\"value\");\r \t\t\t\t\tvar t = input.get(\"showText\");\r \t\t\t\t\tvalue.push(v || \"\");\r \t\t\t\t\ttext.push(t || v || \"\");\r \t\t\t\t}\r \t\t\t});\r \t\t}\r \t\tif (!value.length) value = [\"\"];\r \t\tif (!text.length) text = [\"\"];\r \t\treturn {\"value\": value, \"text\": text};\r \t},\r //getData: function(){\r \t\t//var inputs = this.node.getElements(\"input\");\r \t\t//var value = [];\r \t\t//if (inputs.length){\r \t\t//\tinputs.each(function(input){\r \t\t//\t\tif (input.checked){\r \t\t//\t\t\tvar v = input.get(\"value\");\r \t\t//\t\t\tif (v) value.push(v || \"\");\r \t\t//\t\t}\r \t\t//\t});\r \t\t//}\r \t\t//return (value.length==1) ? value[0] : value;\r //},\r isEmpty: function(){\r var data = this.getData();\r if( typeOf(data) !== \"array\" )return true;\r if( data.length === 0 )return true;\r return false;\r },\r getInputData: function(){\r if (this.readonly || this.json.isReadonly ){\r return this._getBusinessData();\r }else{\r var inputs = this.node.getElements(\"input\");\r var value = [];\r if (inputs.length){\r inputs.each(function(input){\r if (input.checked){\r var v = input.get(\"value\");\r if (v) value.push(v || \"\");\r }\r });\r }\r return (value.length) ? value : [];\r }\r },\r resetData: function(){\r this.setData(this.getValue());\r },\r /**当参数为Promise的时候，请查看文档: {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0|使用Promise处理表单异步}\r * @summary 为字段赋值，并且使值对应的选项选中。\r * @param data{String|Promise} .\r * @example\r * this.form.get(\"fieldId\").setData(\"test\"); //赋文本值\r * @example\r * //使用Promise\r * var field = this.form.get(\"fieldId\");\r * var dict = new this.Dict(\"test\"); //test为数据字典名称\r * var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r * field.setData( promise );\r */\r setData: function(data){\r \t return this._setValue(data, \"__setData\");\r // if (data &amp;&amp; data.isAG){\r // this.moduleValueAG = data;\r // data.addResolve(function(v){\r // this.setData(v);\r // }.bind(this));\r // }else{\r // this.__setData(data);\r // this.moduleValueAG = null;\r // }\r },\r \r __setData: function(data){\r this._setBusinessData(data);\r \r \t\tvar inputs = this.node.getElements(\"input\");\r \t\tif (inputs.length){\r \t\t\tinputs.each(function(input){\r \t\t\t\tif (typeOf(data)==\"array\"){\r \t\t\t\t\tif (data.indexOf(input.get(\"value\"))!=-1){\r \t\t\t\t\t\tinput.set(\"checked\", true);\r \t\t\t\t\t}else{\r \t\t\t\t\t\tinput.set(\"checked\", false);\r \t\t\t\t\t}\r \t\t\t\t}else{\r \t\t\t\t\tif (data == input.get(\"value\")){\r \t\t\t\t\t\tinput.set(\"checked\", true);\r \t\t\t\t\t}else{\r \t\t\t\t\t\tinput.set(\"checked\", false);\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t});\r this.validationMode();\r \t\t}\r this.fireEvent(\"setData\");\r \t},\r \r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"background\", this.node.getStyles(\"background\"));\r this.node.setStyle(\"background\", \"#ffdcdc\");\r \r this.errNode = this.createErrorNode(text);\r if (this.iconNode){\r this.errNode.inject(this.iconNode, \"after\");\r }else{\r this.errNode.inject(this.node, \"after\");\r }\r this.showNotValidationMode(this.node);\r \r if (!this.node.isIntoView()) this.node.scrollIntoView();\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"background\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r validationConfigItem: function(routeName, data){\r var flag = (data.status===\"all\") ? true: (routeName === data.decision);\r if (flag){\r var n = this.getInputData();\r if( typeOf(n)===\"array\" &amp;&amp; n.length === 0 )n = \"\";\r var v = (data.valueType===\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Combox.js.html":{"url":"x_component_process_Xform_Combox.js.html","title":"x_component_process_Xform/Combox.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Combox.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Combox.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r /** @class Combox 组合框组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Combox = MWF.APPCombox = new Class(\r /** @lends MWF.xApplication.process.Xform.Combox# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \ticonStyle: \"selectIcon\",\r options: {\r /**\r * 手工输入完成后触发。\r * @event MWF.xApplication.process.Xform.Combox#commitInput\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 值改变时触发。\r * @event MWF.xApplication.process.Xform.Combox#change\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"commitInput\", \"change\"]\r },\r \r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r _loadNode: function(){\r if (this.readonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r //new Element(\"select\").inject(this.node);\r },\r _loadNodeEdit: function(){\r this.node.empty();\r \r MWF.require(\"MWF.widget.Combox\", function(){\r this.combox = select = new MWF.widget.Combox({\r \"onlySelect\": this.json.onlySelect===\"y\",\r \"count\": this.json.count.toInt() || 0,\r \"splitStr\": this.json.splitStr || \",\\\\s*|;\\\\s*|，\\\\s*|；\\\\s*\",\r \"splitShow\": this.json.splitShow || \", \",\r \"list\": this.getOptions(),\r \"onCommitInput\": function(item){\r this.fireEvent(\"commitInput\");\r }.bind(this),\r \"onChange\": function(){\r this.fireEvent(\"change\");\r }.bind(this),\r \"optionsMethod\": this._searchOptions()\r });\r }.bind(this), false);\r \r \r // var select = new Element(\"select\");\r // select.set(this.json.properties);\r select.inject(this.node);\r //this.node.destroy();\r // this.areaNode = this.node;\r // this.node = select;\r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type\r });\r \r this.combox.addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r }.bind(this));\r \r },\r _searchOptions: function(){\r if (this.json.itemType === \"dynamic\"){\r \t\t\treturn function(value, callback){\r \t\t\t\tvar event = {\r \t\t\t\t\t\"value\": value,\r \t\t\t\t\t\"callback\": callback\r \t\t\t\t};\r this.form.Macro.fire(((this.json.itemDynamic) ? this.json.itemDynamic.code : \"\"), this, event);\r \t\t\t}.bind(this);\r \t\t}else{\r \treturn null;\r \t\t}\r \t},\r /**\r * @summary 获取选择项数组.\r * @example\r * var array = this.form.get('fieldId').getOptions();\r * @return {Array} 选择项数组，如果配置为脚本返回计算结果.\r */\r getOptions: function(){\r \tvar list = [];\r if (this.json.itemType === \"values\"){\r list = this.json.itemValues;\r }else if (this.json.itemType === \"script\"){\r list = this.form.Macro.exec(((this.json.itemScript) ? this.json.itemScript.code : \"\"), this);\r }\r \r if (list.length){\r var options = [];\r list.each(function(v){\r if (typeOf(v)===\"object\"){\r options.push(v);\r }else{\r \tv = v.toString();\r \tarr = v.split(\"|\");\r \tvar o = { \"text\": \"\", \"keyword\": \"\", \"value\": \"\" };\r \tswitch (arr.length){\r case 0: break;\r \t\t\t\t\t\tcase 1:\r o.text = arr[0];\r o.keyword = arr[0];\r o.value = arr[0];\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase 2:\r o.text = arr[0];\r o.keyword = arr[0];\r o.value = arr[1];\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase 3:\r o.text = arr[0];\r o.keyword = arr[1];\r o.value = arr[2];\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tdefault:\r o.text = arr[0];\r o.keyword = arr[1];\r o.value = arr[2];\r \t\t\t\t\t}\r options.push(o);\r \t\t\t\t}\r \t\t\t}.bind(this));\r return options;\r \t\t}\r return [];\r },\r /**\r * 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。\r * @summary 为组件赋值。\r * @param value{String} .\r * @example\r * this.form.get(\"fieldId\").setData(\"test\"); //赋文本值\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * this.form.get('fieldId').setData( data );\r * }else{\r * this.data['fieldId'] = data;\r * }\r */\r setData: function(value){\r this._setBusinessData(value);\r this._setValue(value);\r \t},\r _setValue: function(value){\r if (!value) value = [];\r if (value.length==1 &amp;&amp; (!value[0])) value = [];\r if (typeOf(value) !==\"array\") value = [value];\r \r \t\tif (this.combox){\r this.combox.clear();\r \r comboxValues = [];\r value.each(function(v){\r \t\t\t\tif (typeOf(v)===\"object\"){\r comboxValues.push({\r \t\t\t\t\t\t\"text\": v.text || v.title || v.subject || v.name,\r \t\t\t\t\t\t\"value\": v\r });\r \t\t\t\t}else{\r comboxValues.push(v.toString());\r \t\t\t\t}\r \t\t\t}.bind(this));\r this.combox.addNewValues(comboxValues);\r \t\t}else{\r value.each(function(v, i){\r var text = \"\";\r if (typeOf(v)===\"object\"){\r \ttext = v.text || v.title || v.subject || v.name;\r }else{\r text = v.toString();\r }\r if (i&lt;value.length-1) text += this.json.splitShow;\r new Element(\"div\", {\"styles\": {\r \"float\": \"left\",\r \"margin-right\": \"5px\"\r },\"text\": text}).inject(this.node.getFirst() || this.node);\r }.bind(this));\r \t\t}\r },\r /**\r * @summary 重新计算下拉选项，该功能通常用在下拉选项为动态计算的情况.\r * @example\r * this.form.get('fieldId').resetOption();\r */\r resetOption: function(){\r if (this.combox){\r var list = this.getOptions();\r this.combox.setOptions({\"list\": list});\r }\r },\r /**\r * @summary 添加下拉选项.\r * @param text {String} 下拉选项文本\r * @param value {String} 下拉选项值\r * @example\r * this.form.get('fieldId').addOption(\"秘密\",\"level1\");\r */\r \taddOption: function(text, value){\r if (this.combox){\r var list = this.getOptions();\r list.push({\r \t\t\t\t\"text\": text,\r \t\t\t\t\"value\": value\r \t\t\t});\r this.combox.setOptions({\"list\": list});\r }\r \t},\r isEmpty : function(){\r var data = this.getData();\r if( typeOf(data) === \"array\" ){\r return data.length === 0;\r }else{\r return !data;\r }\r },\r getInputData: function(){\r if (this.combox) return this.combox.getData();\r return this._getBusinessData();\r },\r /**\r * @summary 获取选中的值和文本.\r * @example\r * var array = this.form.get('fieldId').getTextData();\r * @return {Object} 返回选中项值和文本，格式为 { 'value' : value, 'text' : text }.\r */\r getTextData: function(){\r \t var v = this.getData();\r return {\"value\": v, \"text\": v};\r //return this.node.get(\"text\");\r },\r resetData: function(){\r this.setData(this.getValue());\r }\r \t\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Common.js.html":{"url":"x_component_process_Xform_Common.js.html","title":"x_component_process_Xform/Common.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Common.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Common.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Common 通用组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var el = this.form.get(\"name\"); //获取组件\r * //方法2\r * var el = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Common = MWF.APPCommon = new Class({\r Extends: MWF.APP$Module,\r _loadUserInterface: function(){\r if (this.json.innerHTML){\r var nodes = this.node.childNodes;\r for (var i=0; i&lt;nodes.length; i++){\r if (nodes[i].nodeType===Node.ELEMENT_NODE){\r if (!nodes[i].get(\"MWFtype\")){\r nodes[i].destroy();\r i--;\r }\r }else{\r if (nodes[i].removeNode){\r nodes[i].removeNode();\r }else{\r nodes[i].parentNode.removeChild(nodes[i]);\r }\r i--;\r //nodes[i]\r }\r }\r this.node.appendHTML(this.json.innerHTML);\r \r // if (this.node.get(\"html\") !== this.json.innerHTML){\r //this.node.appendHTML(this.json.innerHTML);\r // }\r }\r this.node.setProperties(this.json.properties);\r }\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_DatagridMobile.js.html":{"url":"x_component_process_Xform_DatagridMobile.js.html","title":"x_component_process_Xform/DatagridMobile.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/DatagridMobile.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/DatagridMobile.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class DatagridMobile 数据网格组件（移动端）。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var datagrid = this.form.get(\"name\"); //获取组件\r * //方法2\r * var datagrid = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.DatagridMobile = new Class(\r /** @lends MWF.xApplication.process.Xform.DatagridMobile# */\r {\r Implements: [Events],\r Extends: MWF.APP$Module,\r isEdit: false,\r options: {\r /**\r * 当前条目编辑完成时触发。通过this.event可以获取对应的table。\r * @event MWF.xApplication.process.Xform.DatagridMobile#completeLineEdit\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 添加条目时触发。通过this.event可以获取对应的table。\r * @event MWF.xApplication.process.Xform.DatagridMobile#addLine\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 删除条目前触发。通过this.event可以获取对应的table。\r * @event MWF.xApplication.process.Xform.DatagridMobile#deleteLine\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 删除条目后触发。\r * @event MWF.xApplication.process.Xform.DatagridMobile#afterDeleteLine\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 编辑条目时触发。\r * @event MWF.xApplication.process.Xform.DatagridMobile#editLine\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"queryLoad\",\"postLoad\",\"load\",\"completeLineEdit\", \"addLine\", \"deleteLine\", \"afterDeleteLine\",\"editLine\"]\r },\r \r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r \r _loadUserInterface: function(){\r this.fireEvent(\"queryLoad\");\r \r this.editModules = [];\r this.node.setStyle(\"overflow-x\", \"hidden\");\r this.node.setStyle(\"overflow-y\", \"hidden\");\r this.table = this.node.getElement(\"table\");\r \r this.createMobileTable();\r \r \r this.editable = (!this.readonly);\r if (this.editable &amp;&amp; this.json.editableScript &amp;&amp; this.json.editableScript.code){\r this.editable = this.form.Macro.exec(((this.json.editableScript) ? this.json.editableScript.code : \"\"), this);\r }\r //this.editable = false;\r \r this.deleteable = this.json.deleteable !== \"no\";\r this.addable = this.json.addable !== \"no\";\r \r this.gridData = this._getValue();\r \r this.totalModules = [];\r this._loadDatagridTitleModules();\r \r if (this.editable!=false){\r this._loadDatagridDataModules();\r //this._addTitleActionColumn();\r // this._loadEditDatagrid();\r // //this._loadReadDatagrid();\r // this.fireEvent(\"postLoad\");\r // this.fireEvent(\"load\");\r this._loadEditDatagrid(function(){\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"load\");\r }.bind(this));\r }else{\r this._loadDatagridDataModules();\r this._loadReadDatagrid(function(){\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"load\");\r }.bind(this));\r \r // this._loadReadDatagrid();\r // this.fireEvent(\"postLoad\");\r // this.fireEvent(\"load\");\r }\r },\r createMobileTable: function(){\r var mobileTable = new Element(\"table\").inject(this.node);\r mobileTable.set(this.json.properties);\r //mobileTable.setStyle(\"display\", \"none\");\r //mobileTable.setStyle(\"margin-bottom\", \"10px\");\r var trs = this.table.getElements(\"tr\");\r var titleTds = trs[0].getElements(\"th\");\r var contentTds = trs[1].getElements(\"td\");\r titleTds.each(function(titleTd, i){\r var mobileTr = mobileTable.insertRow();\r //var mobileTr = new Element(\"tr\").inject(mobileTable);\r var th = new Element(\"th\").inject(mobileTr);\r th.set({\r \"html\": titleTd.get(\"html\"),\r \"id\": titleTd.get(\"id\"),\r \"mwftype\": titleTd.get(\"mwftype\")\r });\r var td = new Element(\"td\").inject(mobileTr);\r td.set({\r \"html\": contentTds[i].get(\"html\"),\r \"id\": contentTds[i].get(\"id\"),\r \"mwftype\": contentTds[i].get(\"mwftype\")\r });\r \r var json = this.form._getDomjson(titleTd);\r if( json &amp;&amp; json.isShow === false )mobileTr.hide();\r }.bind(this));\r this.table.destroy();\r this.table = null;\r this.table = mobileTable;\r },\r \r _loadStyles: function(){\r //this.table.setStyles(this.json.tableStyles);\r this.node.setStyles(this.json.styles);\r var tables = this.node.getElements(\"table\");\r tables.each(function(table){\r table.setStyles(this.json.tableStyles);\r }.bind(this));\r \r },\r _getValue: function(){\r if (this.moduleValueAG) return this.moduleValueAG;\r var value = [];\r value = this._getBusinessData();\r if (!value){\r if (this.json.defaultData &amp;&amp; this.json.defaultData.code) value = this.form.Macro.exec(this.json.defaultData.code, this);\r if (!value.isAG) if (o2.typeOf(value)==\"array\") value = {\"data\": value || []};\r }\r return value || [];\r },\r getValue: function(){\r return this._getValue();\r },\r \r _getValueText: function(idx, value){\r var module = this.editModules[idx];\r if (module){\r switch (module.json.type){\r case \"Select\":\r for (var i=0; i&lt;module.json.itemValues.length; i++){\r var itemv = module.json.itemValues[i];\r var arr = itemv.split(/\\|/);\r var text = arr[0];\r var v = (arr.length>1) ? arr[1] : arr[0];\r if (value===v) return text;\r }\r \r // var ops = module.node.getElements(\"option\");\r // for (var i=0; i&lt;ops.length; i++){\r // \tif (ops[i].value == value){\r // \t\treturn ops[i].get(\"text\");\r // \t}\r // }\r break;\r case \"Radio\":\r var ops = module.node.getElements(\"input\");\r for (var i=0; i&lt;ops.length; i++){\r if (ops[i].value == value){\r return ops[i].get(\"showText\");\r }\r }\r break;\r case \"Checkbox\":\r var ops = module.node.getElements(\"input\");\r var texts = [];\r for (var i=0; i&lt;ops.length; i++){\r if (value.indexOf(ops[i].value) != -1) texts.push(ops[i].get(\"showText\"));\r }\r if (texts.length) return texts.join(\", \");\r break;\r case \"Orgfield\":\r case \"Personfield\":\r case \"Org\":\r //var v = module.getTextData();\r //return v.text[0];\r \r if (typeOf(value)===\"array\"){\r var textArray = [];\r value.each( function( item ){\r if (typeOf(item)===\"object\"){\r textArray.push( item.name+((item.unitName) ? \"(\"+item.unitName+\")\" : \"\") );\r }else{\r textArray.push(item);\r }\r }.bind(this));\r return textArray.join(\", \");\r }else if (typeOf(value)===\"object\"){\r return value.name+((value.unitName) ? \"(\"+value.unitName+\")\" : \"\");\r }else{\r return value;\r }\r break;\r case \"Textarea\":\r var reg = new RegExp(\"\\n\",\"g\");\r var reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r var reg3 = new RegExp(\"\\u003e\",\"g\");\r value = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r break;\r }\r }\r return value;\r },\r \r editValidation: function(){\r var flag = true;\r this.editModules.each(function(field, key){\r if (field.json.type!=\"sequence\"){\r field.validationMode();\r if (!field.validation()) flag = false;\r }\r }.bind(this));\r return flag;\r },\r \r _loadReadDatagrid: function(callback){\r var p = o2.promiseAll(this.gridData).then(function(v){\r this.gridData = v;\r if (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r this.__loadReadDatagrid(callback);\r this.moduleValueAG = null;\r return v;\r }.bind(this), function(){});\r this.moduleValueAG = p;\r if (this.moduleValueAG) this.moduleValueAG.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r \r // if (this.gridData &amp;&amp; this.gridData.isAG){\r // this.moduleValueAG = this.gridData;\r // this.gridData.addResolve(function(v){\r // this.gridData = v;\r // this._loadReadDatagrid(callback);\r // }.bind(this));\r // }else{\r // if (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r // this.__loadReadDatagrid(callback);\r // this.moduleValueAG = null;\r // }\r },\r \r __loadReadDatagrid: function(callback){\r //this.gridData = this._getValue();\r \r \r var titleHeaders = this.table.getElements(\"th\");\r var tds = this.table.getElements(\"td\");\r \r if (this.gridData.data){\r this.gridData.data.each(function(data, idx){\r var dataDiv = new Element(\"div.dataDiv\", {\"styles\": {\"overflow\": \"hidden\", \"margin-bottom\": \"10px\"}}); //.inject(this.node);\r \r if (this.totalDiv){\r dataDiv.inject(this.totalDiv, \"before\");\r }else{\r dataDiv.inject(this.node);\r }\r \r this._createItemTitleNode(dataDiv, idx);\r \r var tableDiv = new Element(\"div\", {\"styles\": this.form.css.gridMobileTableNode }).inject(dataDiv);\r var table = new Element(\"table\").inject(tableDiv);\r table.set(this.json.properties);\r table.store(\"data\", data);\r //table.setStyle(\"margin-bottom\", \"10px\");\r titleHeaders.each(function(th, index){\r var tr = table.insertRow(index);\r var datath = new Element(\"th\").inject(tr);\r datath.set(\"text\", th.get(\"text\"));\r datath.setStyle(\"width\", \"30%\");\r \r var cell = tr.insertCell(1);\r cell.set(\"MWFId\", tds[index].get(\"id\"));\r \r var cellData = data[th.get(\"id\")];\r \r if( typeOf( cellData ) !== \"array\" ) {\r if (cellData) {\r for (key in cellData) {\r var v = cellData[key];\r \r var module = this.editModules[index];\r if (module &amp;&amp; module.json.type == \"ImageClipper\") {\r this._createImage(cell, module, v);\r } else if (module &amp;&amp; (module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\")) {\r this._createAttachment(cell, module, v);\r } else {\r text = this._getValueText(index, v);\r if (module &amp;&amp; module.json.type == \"Textarea\") {\r cell.set(\"html\", text);\r } else {\r cell.set(\"text\", text);\r }\r //cell.set(\"text\", text);\r }\r \r \r // if (typeOf(v)===\"array\"){\r // var textArray = [];\r // v.each( function( item ){\r // if (typeOf(item)===\"object\"){\r // textArray.push( item.name+((item.unitName) ? \"(\"+item.unitName+\")\" : \"\") );\r // }else{\r // textArray.push(item);\r // }\r // }.bind(this));\r // cell.set(\"text\", textArray.join(\", \"));\r // }else if (typeOf(v)===\"object\"){\r // cell.set(\"text\", v.name+((v.unitName) ? \"(\"+v.unitName+\")\" : \"\"));\r // }else{\r // cell.set(\"text\", v);\r // }\r break;\r //\r // cell.set(\"text\", cellData[key]);\r // break;\r }\r } else { //Sequence\r cell.setStyle(\"text-align\", \"left\");\r cell.set(\"text\", idx + 1);\r }\r }\r \r var json = this.form._getDomjson(th);\r if( json &amp;&amp; json.isShow === false )tr.hide();\r \r }.bind(this));\r }.bind(this));\r }\r if (callback) callback();\r //this._loadTotal();\r },\r \r _loadEditDatagrid: function(callback){\r var p = o2.promiseAll(this.gridData).then(function(v){\r this.gridData = v;\r if (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r this.__loadEditDatagrid(callback);\r this.moduleValueAG = null;\r return v;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r this.moduleValueAG = p;\r if (this.moduleValueAG) this.moduleValueAG.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r \r \r // if (this.gridData &amp;&amp; this.gridData.isAG){\r // this.moduleValueAG = this.gridData;\r // this.gridData.addResolve(function(v){\r // this.gridData = v;\r // this._loadEditDatagrid(callback);\r // }.bind(this));\r // }else{\r // if (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r // this.__loadEditDatagrid(callback);\r // this.moduleValueAG = null;\r // }\r },\r __loadEditDatagrid: function(callback){\r //this._createHelpNode();\r \r //this.gridData = this._getValue();\r \r var titleHeaders = this.table.getElements(\"th\");\r var tds = this.table.getElements(\"td\");\r \r var _self = this;\r \r if (this.gridData.data.length){\r if( this.addAction )this.addAction.setStyle(\"display\",\"none\");\r this.gridData.data.each(function(data, idx){\r var dataDiv = new Element(\"div.dataDiv\", {\"styles\": {\"overflow\": \"hidden\", \"margin-bottom\": \"10px\"}}); //.inject(this.node);\r \r if (this.totalDiv){\r dataDiv.inject(this.totalDiv, \"before\");\r }else{\r dataDiv.inject(this.node);\r }\r \r this._createItemTitleNode(dataDiv, idx);\r \r var tableDiv = new Element(\"div\", {\"styles\": this.form.css.gridMobileTableNode }).inject(dataDiv);\r var table = new Element(\"table\").inject(tableDiv);\r table.set(this.json.properties);\r table.store(\"data\", data);\r //table.setStyle(\"margin-bottom\", \"10px\");\r titleHeaders.each(function(th, index){\r var tr = table.insertRow(index);\r var datath = new Element(\"th\").inject(tr);\r datath.set(\"text\", th.get(\"text\"));\r datath.setStyle(\"width\", \"30%\");\r \r var cell = tr.insertCell(1);\r cell.set(\"MWFId\", tds[index].get(\"id\"));\r \r var cellData = data[th.get(\"id\")];\r if (cellData){\r for (key in cellData){\r var v = cellData[key];\r \r var module = this.editModules[index];\r if( module &amp;&amp; module.json.type == \"ImageClipper\" ){\r this._createImage( cell, module, v )\r }else if( module &amp;&amp; (module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\") ){\r this._createAttachment( cell, module, v );\r }else{\r text = this._getValueText(index, v);\r if( module &amp;&amp; module.json.type == \"Textarea\" ){\r cell.set(\"html\", text);\r }else{\r cell.set(\"text\", text);\r }\r //cell.set(\"text\", text);\r }\r \r // if (typeOf(v)===\"object\"){\r // cell.set(\"text\", v.name+((v.unitName) ? \"(\"+v.unitName+\")\" : \"\"));\r // }else{\r // cell.set(\"text\", v);\r // }\r break;\r //\r // cell.set(\"text\", cellData[key]);\r // break;\r }\r }else{ //Sequence\r cell.setStyle(\"text-align\", \"left\");\r cell.set(\"text\", idx+1);\r }\r \r var json = this.form._getDomjson(th);\r if( json &amp;&amp; json.isShow === false )tr.hide();\r }.bind(this));\r var size = dataDiv.getSize();\r //dataDiv.setStyle(\"height\", \"\"+size.y+\"px\");\r \r //dataDiv.addEvent(\"touchstart\", function(e){_self.actionTouchstart(this, e);});\r //dataDiv.addEvent(\"touchmove\", function(e){_self.actionTouchmove(this, e);});\r //dataDiv.addEvent(\"touchend\", function(e){_self.actionTouchend(this, e);});\r //dataDiv.addEvent(\"touchcancel\", function(e){_self.actionTouchcancel(this, e);});\r //\r //dataDiv.addEvent(\"mousedown\", function(e){_self._actionMousedown(this, e);});\r //dataDiv.addEvent(\"mouseup\", function(e){_self._actionMouseup(this, e);});\r \r //this.showMoveAction(dataDiv, 60);\r //this.showEndMoveAction(dataDiv);\r }.bind(this));\r }else{\r if (this.addAction){\r if( this.addable )this.addAction.setStyle(\"display\", \"block\");\r }else{\r if( this.addable )this._loadAddAction();\r }\r // this._loadAddAction();\r }\r if (callback) callback();\r //this._loadTotal();\r },\r _loadActions: function(titleDiv){\r var actionNode = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridActionNode\r }).inject(titleDiv);\r \r var delAction = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridDelActionNode,\r \"text\": MWF.xApplication.process.Xform.LP[\"delete\"]\r }).inject(actionNode);\r if( !this.deleteable )delAction.hide();\r \r var editAction = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridEditActionNode,\r \"text\": MWF.xApplication.process.Xform.LP.edit\r }).inject(actionNode);\r \r var addAction = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridAddActionNode,\r \"text\": MWF.xApplication.process.Xform.LP.add\r }).inject(actionNode);\r if( !this.addable )addAction.hide();\r \r var cancelAction = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridCancelActionNode,\r \"text\": MWF.xApplication.process.Xform.LP.cancelEdit\r }).inject(actionNode);\r var completeAction = new Element(\"div\", {\r \"styles\": this.form.css.mobileDatagridCompleteActionNode,\r \"text\": MWF.xApplication.process.Xform.LP.completedEdit\r }).inject(actionNode);\r \r \r var _self = this;\r if( this.deleteable )delAction.addEvent(\"click\", function(e){\r _self._deleteLine(this.getParent().getParent().getParent(), e);\r });\r editAction.addEvent(\"click\", function(e){\r _self._editLine(this.getParent().getParent().getParent(), e);\r });\r completeAction.addEvent(\"click\", function(e){\r _self._completeLineEdit();\r });\r cancelAction.addEvent(\"click\", function(e){\r _self._cancelLineEdit(e);\r });\r if( this.addable )addAction.addEvent(\"click\", function(e){\r _self._addLine();\r });\r },\r _createImage : function( cell, module, data ){\r cell.empty();\r if( !data )return;\r var img = new Element(\"img\",{\r src : MWF.xDesktop.getImageSrc( data )\r }).inject( cell, \"top\" );\r img.setStyles({\r \"max-width\": \"90%\"\r })\r },\r _createAttachment: function ( cell, module, data ){\r cell.empty();\r var options = {\r \"style\": module.json.style || \"default\",\r \"title\": \"附件区域\",\r \"listStyle\": module.json.dg_listStyle || \"icon\",\r \"size\": module.json.dg_size || \"min\",\r \"resize\": (module.json.dg_resize === \"y\" || this.json.dg_resize === \"true\"),\r \"attachmentCount\": 0,\r \"isUpload\": false,\r \"isDelete\": false,\r \"isReplace\": false,\r \"isDownload\": true,\r \"isSizeChange\": (module.json.dg_isSizeChange === \"y\" || module.json.dg_isSizeChange === \"true\"),\r \"readonly\": true,\r \"availableListStyles\": module.json.dg_availableListStyles ? module.json.dg_availableListStyles : [\"list\", \"seq\", \"icon\", \"preview\"],\r \"isDeleteOption\": \"n\",\r \"isReplaceOption\": \"n\",\r \"toolbarGroupHidden\": module.json.dg_toolbarGroupHidden || []\r };\r if (this.readonly) options.readonly = true;\r if(!this.editable &amp;&amp; !this.addable)options.readonly = true;\r \r var atts = [];\r data.each(function(d){\r var att = module.attachmentController.attachments.find(function(a){\r return d.id == a.data.id;\r });\r if (att) module.attachmentController.removeAttachment(att);\r });\r module.setAttachmentBusinessData();\r \r \r var attachmentController = new MWF.xApplication.process.Xform.AttachmentController(cell, module, options);\r attachmentController.load();\r \r data.each(function (att) {\r var attachment = this.form.businessData.attachmentList.find(function(a){\r return a.id==att.id;\r });\r var attData = attachment || att;\r //if (att.site===this.json.id || (this.json.isOpenInOffice &amp;&amp; this.json.officeControlName===att.site)) this.attachmentController.addAttachment(att);\r attachmentController.addAttachment(attData);\r }.bind(this));\r },\r _createItemTitleNode: function(node, idx){\r var n = idx+1;\r var titleDiv = new Element(\"div\", {\"styles\": this.json.itemTitleStyles}).inject(node);\r titleDiv.setStyle(\"overflow\", \"hidden\");\r var textNode = new Element(\"div\", {\r \"styles\": {\"float\": \"left\"},\r \"text\": MWF.xApplication.process.Xform.LP.item+n\r }).inject(titleDiv);\r //if (idx==0){\r if( this.editable != false ){\r this._loadActions(titleDiv);\r }\r \r //}\r },\r _createHelpNode: function(){\r this.helpNode = new Element(\"div\", {\"styles\": this.form.css.mobileGridHelpNode}).inject(this.node, \"top\");\r this.helpContentNode = new Element(\"div\", {\"styles\": this.form.css.mobileGridHelpContentNode}).inject(this.helpNode);\r this.helpContentNode.set(\"html\", MWF.xApplication.process.Xform.LP.mobileGridHelp);\r new mBox.Tooltip({\r content: this.helpContentNode,\r setStyles: {content: {padding: 15, lineHeight: 20}},\r attach: this.helpNode,\r transition: 'flyin',\r position: {\r x: ['right'],\r y: ['center']\r },\r event: 'click'\r });\r },\r _editLine:function(node){\r if (this.isEdit){\r if (!this._completeLineEdit()) return false;\r }\r \r this.currentEditLine = node;\r var currentEditTable = node.getElement(\"table\");\r if (this.currentEditLine){\r this.table.setStyles({\r \"background-color\": \"#fffeb5\",\r \"display\": \"table\"\r });\r this.table.inject(currentEditTable, \"after\");\r //this.currentEditLine.setStyle(\"display\", \"none\");\r currentEditTable.setStyle(\"display\", \"none\");\r \r var actions = this.currentEditLine.getFirst(\"div\").getLast(\"div\").getElements(\"div\");\r if (actions[0]) actions[0].setStyle(\"display\", \"none\");\r if (actions[1]) actions[1].setStyle(\"display\", \"none\");\r if (actions[2]) actions[2].setStyle(\"display\", \"none\");\r if (actions[3]) actions[3].setStyle(\"display\", \"block\");\r if (actions[4]) actions[4].setStyle(\"display\", \"block\");\r \r //this.addAction.inject(this.table, \"after\");\r //this.addAction.set(\"text\", MWF.xApplication.process.Xform.LP.completedEdit);\r //this.addAction.removeEvents(\"click\");\r //this.addAction.addEvent(\"click\", function(){\r // this._completeLineEdit();\r //}.bind(this));\r \r \r var data = this.currentEditLine.getElement(\"table\").retrieve(\"data\");\r var titleThs = this.table.getElements(\"th\");\r titleThs.each(function(th, idx){\r var id = th.get(\"id\");\r var module = this.editModules[idx];\r if (module){\r if (module.json.type==\"sequence\"){\r module.node.set(\"text\", this.currentEditLine.getElement(\"table\").getElements(\"tr\")[idx].getElement(\"td\").get(\"text\"));\r }else {\r if (data[id]) {\r module.setData(data[id][module.json.id]);\r } else {\r module.setData(null);\r }\r }\r }\r }.bind(this));\r \r //var cellIdx = this.currentEditLine.getElements(\"td\").indexOf(td);\r //var module = this.editModules[cellIdx-1];\r //if (module) module.focus();\r \r this.fireEvent(\"editLine\");\r \r this.isEdit =true;\r }\r this.validationMode();\r },\r _loadAddAction: function(){\r if( !this.addAction ){\r this.addAction = new Element(\"div\", {\"styles\": this.form.css.gridMobileActionNode}).inject(this.node, \"top\");\r this.addAction.set(\"text\", MWF.xApplication.process.Xform.LP.addLine);\r this.addAction.addEvent(\"click\", function(){\r this._addLine();\r }.bind(this));\r }\r },\r _addLine: function(){\r if (this.isEdit){\r if (!this._completeLineEdit()) return false;\r }\r if (this.addAction) this.addAction.setStyle(\"display\", \"none\");\r \r var tables = this.node.getElements(\"table\");\r var idx;\r var dataDiv = new Element(\"div.datagridDataDiv\", {\"styles\": {\"overflow\": \"hidden\", \"margin-bottom\": \"10px\"}});\r if (this.totalDiv){\r idx = tables.length-2;\r dataDiv.inject(this.totalDiv, \"before\");\r }else{\r idx = tables.length-1;\r dataDiv.inject(this.node);\r }\r this._createItemTitleNode(dataDiv, idx);\r \r var tableDiv = new Element(\"div\", {\"styles\": this.form.css.gridMobileTableNode }).inject(dataDiv);\r \r this.table.setStyles({\r \"background-color\": \"#fffeb5\",\r \"display\": \"table\"\r });\r \r this.currentEditLine = null;\r this.table.inject(tableDiv);\r this.isEdit = true;\r \r var actions = dataDiv.getFirst(\"div\").getLast(\"div\").getElements(\"div\");\r if (actions[0]) actions[0].setStyle(\"display\", \"none\");\r if (actions[1]) actions[1].setStyle(\"display\", \"none\");\r if (actions[2]) actions[2].setStyle(\"display\", \"none\");\r if (actions[3]) actions[3].setStyle(\"display\", \"block\");\r if (actions[4]) actions[4].setStyle(\"display\", \"block\");\r \r if (!dataDiv.isIntoView()) dataDiv.scrollIntoView(true);\r \r //this.addAction.set(\"text\", MWF.xApplication.process.Xform.LP.completedEdit);\r //this.addAction.removeEvents(\"click\");\r //this.addAction.addEvent(\"click\", function(){\r // this._completeLineEdit();\r //}.bind(this));\r \r this.validationMode();\r this.fireEvent(\"addLine\", [this.table]);\r },\r _cancelLineEdit : function(e){\r var datagrid = this;\r var _self = this;\r this.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.cancelDatagridLineEditTitle, MWF.xApplication.process.Xform.LP.cancelDatagridLineEdit, 300, 120, function(){\r \r datagrid.isEdit = false;\r \r if (datagrid.currentEditLine) {\r // datagrid.currentEditLine.setStyle(\"display\", \"table-row\");\r \r var currentEditTable = datagrid.currentEditLine.getElement(\"table\");\r currentEditTable.setStyle(\"display\", \"table\");\r \r var actions = datagrid.currentEditLine.getFirst(\"div\").getLast(\"div\").getElements(\"div\");\r if (actions[0] &amp;&amp; this.deleteable ) actions[0].setStyle(\"display\", \"block\");\r if (actions[1] ) actions[1].setStyle(\"display\", \"block\");\r if (actions[2] &amp;&amp; this.addable ) actions[2].setStyle(\"display\", \"block\");\r if (actions[3]) actions[3].setStyle(\"display\", \"none\");\r if (actions[4]) actions[4].setStyle(\"display\", \"none\");\r \r datagrid._editorTrGoBack();\r }else{\r var datagridDataDiv = e.target.getParent(\".datagridDataDiv\");\r datagrid._editorTrGoBack();\r if(datagridDataDiv)datagridDataDiv.destroy();\r }\r \r datagrid.editModules.each(function(module){\r if (module &amp;&amp; (module.json.type==\"Attachment\" || module.json.type==\"AttachmentDg\")){\r module.attachmentController.attachments.each(function(att){\r datagrid.form.workAction.deleteAttachment(att.data.id, datagrid.form.businessData.work.id);\r });\r module.attachmentController.clear();\r }\r });\r \r datagrid.currentEditLine = null;\r \r if (!_self.gridData.data.length){\r if (_self.addAction){\r if( _self.addable )_self.addAction.setStyle(\"display\", \"block\");\r }else{\r if( _self.addable )_self._loadAddAction();\r }\r }\r \r this.close();\r \r datagrid.fireEvent(\"cancelLineEdit\");\r }, function(){\r // var color = currentTr.retrieve(\"bgcolor\");\r // currentTr.tween(\"background\", color);\r this.close();\r }, null, null, this.form.json.confirmStyle);\r },\r _completeLineEdit: function( ev ){\r if (!this.editValidation()){\r return false;\r }\r \r this.isEdit = false;\r var saveFlag = false;\r //var flag = true;\r \r var griddata = {};\r var dataNode = null;\r var table;\r \r if (this.currentEditLine){\r dataNode = this.currentEditLine;\r griddata = dataNode.getElement(\"table\").retrieve(\"data\");\r this.currentEditLine.getElement(\"table\").setStyle(\"display\", \"table\");\r table = dataNode.getElement(\"table\");\r \r var actions = this.currentEditLine.getFirst(\"div\").getLast(\"div\").getElements(\"div\");\r if (actions[0] &amp;&amp; this.deleteable ) actions[0].setStyle(\"display\", \"block\");\r if (actions[1]) actions[1].setStyle(\"display\", \"block\");\r if (actions[2] &amp;&amp; this.addable ) actions[2].setStyle(\"display\", \"block\");\r if (actions[3]) actions[3].setStyle(\"display\", \"none\");\r if (actions[4]) actions[4].setStyle(\"display\", \"none\");\r }else{\r //dataNode = new Element(\"div\", {\"styles\": {\"overflow\": \"hidden\", \"margin-bottom\": \"10px\"}}).inject(this.table, \"before\");\r //var tableDiv = new Element(\"div\", {\"styles\": {\"overflow\": \"hidden\"}}).inject(dataNode);\r \r var dataDiv = this.table.getParent(\".datagridDataDiv\");\r if(dataDiv){\r dataDiv.removeClass(\"datagridDataDiv\").addClass(\"dataDiv\");\r }\r \r var actions = this.table.getParent().getPrevious(\"div\").getLast(\"div\").getElements(\"div\");\r if (actions[0] &amp;&amp; this.deleteable ) actions[0].setStyle(\"display\", \"block\");\r if (actions[1]) actions[1].setStyle(\"display\", \"block\");\r if (actions[2] &amp;&amp; this.addable ) actions[2].setStyle(\"display\", \"block\");\r if (actions[3]) actions[3].setStyle(\"display\", \"none\");\r if (actions[4]) actions[4].setStyle(\"display\", \"none\");\r \r table = new Element(\"table\", {\r styles : this.json.tableStyles\r }).inject(this.table, \"before\");\r table.set(this.json.properties);\r griddata = {};\r \r //dataNode.addEvent(\"touchstart\", function(e){_self.actionTouchstart(this, e);});\r //dataNode.addEvent(\"touchmove\", function(e){_self.actionTouchmove(this, e);});\r //dataNode.addEvent(\"touchend\", function(e){_self.actionTouchend(this, e);});\r //dataNode.addEvent(\"touchcancel\", function(e){_self.actionTouchcancel(this, e);});\r }\r \r var tables = this.node.getElements(\"table\");\r var titleHeaders = this.table.getElements(\"th\");\r var tds = this.table.getElements(\"td\");\r var dataRows = table.getElements(\"tr\");\r \r titleHeaders.each(function(th, idx){\r var dataRow = dataRows[idx];\r var id = th.get(\"id\");\r var module = this.editModules[idx];\r if (module){\r var data;\r if (module.json.type==\"sequence\"){\r var i;\r if (!this.currentEditLine){\r i = tables.length-1;\r if (this.totalTable) i = tables.length-2;\r }else{\r i = this.currentEditLine.getElement(\"table\").getElements(\"tr\")[idx].getElement(\"td\").get(\"text\");\r }\r data = {\"value\": [i], \"text\": [i]};\r }else if( module.json.type==\"Attachment\" || module.json.type == \"AttachmentDg\" ) {\r saveFlag = true;\r var data = module.getTextData();\r //data.site = module.json.site;\r if (!griddata[id]) griddata[id] = {};\r griddata[id][module.json.id] = data;\r // }else if( [\"Orgfield\",\"Personfield\",\"Org\",\"Address\"].contains(module.json.type) ){\r // data = module.getTextData();\r // if (!griddata[id]) griddata[id] = {};\r // griddata[id][module.json.id] = data.value;\r }else{\r data = module.getTextData();\r //if (data.value[0]) flag = false;\r if (data.value.length&lt;2){\r if (!griddata[id]) griddata[id] = {};\r griddata[id][module.json.id] = data.value[0];\r }else{\r if (!griddata[id]) griddata[id] = {};\r griddata[id][module.json.id] = data.value;\r }\r }\r \r var cell;\r // var text = this._getValueText(idx, data.text.join(\", \"));\r \r if (dataRow){\r cell = dataRow.getElement(\"td\");\r if( module.json.type == \"ImageClipper\" ){\r this._createImage( cell, module, data.text );\r }else if( module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\" ){\r this._createAttachment( cell, module, data );\r }else{\r var text = this._getValueText(idx, data.text.join(\", \"));\r if( module &amp;&amp; module.json.type == \"Textarea\" ){\r cell.set(\"html\", text);\r }else{\r cell.set(\"text\", text);\r }\r //cell.set(\"text\", data.text.join(\", \"));\r }\r }else{\r dataRow = table.insertRow(idx);\r var datath = new Element(\"th\").inject(dataRow);\r datath.set(\"text\", th.get(\"text\"));\r datath.setStyle(\"width\", \"30%\");\r \r cell = dataRow.insertCell(1);\r cell.set(\"MWFId\", tds[idx].get(\"id\"));\r \r var cellData = data[th.get(\"id\")];\r if( module.json.type == \"ImageClipper\" ){\r this._createImage( cell, module, data.text );\r }else if( module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\" ){\r this._createAttachment( cell, module, data );\r }else{\r var text = this._getValueText(idx, data.text.join(\", \"));\r if( module &amp;&amp; module.json.type == \"Textarea\" ){\r cell.set(\"html\", text);\r }else{\r cell.set(\"text\", text);\r }\r //cell.set(\"text\", data.text.join(\", \"));\r }\r }\r }else{\r if (!dataRow) {\r dataRow = table.insertRow(idx);\r var datath1 = new Element(\"th\").inject(dataRow);\r datath1.set(\"text\", th.get(\"text\"));\r datath1.setStyle(\"width\", \"30%\");\r cell = dataRow.insertCell(1);\r }\r }\r \r var json = this.form._getDomjson(th);\r if( json &amp;&amp; json.isShow === false )dataRow.hide();\r \r module = null;\r }.bind(this));\r \r table.store(\"data\", griddata);\r table.setStyle(\"display\", \"table\");\r \r //if (flag){\r // newTr.destroy();\r //}\r this.currentEditLine = null;\r \r this._editorTrGoBack();\r \r this.getData();\r this._loadDatagridStyle();\r \r this.validationMode();\r this.fireEvent(\"completeLineEdit\", [table]);\r \r if (this.addAction){\r this.addAction.set(\"text\", MWF.xApplication.process.Xform.LP.addLine);\r this.addAction.removeEvents(\"click\");\r this.addAction.addEvent(\"click\", function(){\r this._addLine();\r }.bind(this));\r }\r \r if(saveFlag){\r this.form.saveFormData();\r }\r return true;\r },\r _editorTrGoBack: function(){\r this.table.setStyle(\"display\", \"none\");\r this.table.inject(this.node, \"top\");\r \r //if (this.totalDiv){\r // this.addAction.inject(this.totalDiv, \"before\");\r //}else{\r // this.addAction.inject(this.node);\r //}\r \r //\t\tthis.editTr.removeEvents(\"blur\");\r // if (this.totalTr){\r // this.editorTr.inject(this.totalTr, \"before\");\r // }else{\r // var lastTrs = this.table.getElements(\"tr\");\r // var lastTr = lastTrs[lastTrs.length-1];\r // this.editorTr.inject(lastTr, \"after\");\r // }\r },\r \r _actionMousedown: function(node, e){\r var status = node.retrieve(\"editStatus\");\r if (!status){\r node.store(\"editStatus\", new Date());\r }\r this._checkMouseDown(node);\r },\r _checkMouseDown: function(node){\r var status = node.retrieve(\"editStatus\");\r if (status){\r var d = (new Date()).getTime();\r if (d-status.getTime()>1000){\r this._editLine(node);\r node.eliminate(\"editStatus\");\r }else{\r window.setTimeout(function(){\r this._checkMouseDown(node);\r }.bind(this), 1000)\r }\r }\r },\r _actionMouseup: function(node, e){\r node.eliminate(\"editStatus\");\r },\r \r actionTouchstart: function(node, e){\r var p = {\"x\": e.touches[0].pageX, \"y\": e.touches[0].pageY};\r //node.store(\"start\", p);\r var action = node.retrieve(\"action\");\r if (action){\r node.store(\"touchStatus\", {\"p\": p, \"status\": \"hide\", \"isHide\": false});\r }else{\r node.store(\"touchStatus\", {\"p\": p, \"status\": \"show\"});\r }\r this._actionMousedown(node, e);\r //e.preventDefault();\r },\r actionTouchmove: function(node, e){\r var touchStatus = node.retrieve(\"touchStatus\");\r var p = touchStatus.p;\r var status = touchStatus.status;\r var x = e.touches[0].pageX;\r var y = e.touches[0].pageY;\r \r if (Math.abs(p.x-x)>10 || Math.abs(p.y-y)>10){\r this._actionMouseup(node);\r }\r if (status==\"show\"){\r if ((p.x-x > 20) &amp;&amp; Math.abs(p.y-y)&lt;40){\r this.showMoveAction(node, p.x-x);\r e.preventDefault();\r }\r }else{\r if ((x-p.x > 20) &amp;&amp; Math.abs(p.y-y)&lt;40){\r touchStatus.isHide = true;\r this.hideMoveAction(node, x- p.x);\r e.preventDefault();\r }\r }\r \r },\r actionTouchend: function(node, e){\r var touchStatus = node.retrieve(\"touchStatus\");\r var p = touchStatus.p;\r var status = touchStatus.status;\r if (status==\"show\"){\r var action = node.retrieve(\"action\");\r if (action) this.showEndMoveAction(node);\r }else{\r if (touchStatus.isHide) this.hideEndMoveAction(node);\r }\r },\r actionTouchcancel: function(node, e){\r this._actionMouseup(node);\r },\r showEndMoveAction: function(node){\r var action = node.retrieve(\"action\");\r var tableNode = node.getLast(\"div\");\r new Fx.Tween(action, {\"duration\": 100}).start(\"width\", \"60px\");\r new Fx.Tween(tableNode, {\"duration\": 100}).start(\"margin-right\", \"60px\");\r \r var _self = this;\r action.addEvent(\"click\", function(e){\r _self._deleteLine(node, e);\r });\r },\r _deleteLine: function(node, e){\r var saveFlag = false;\r var currentTable = node.getElement(\"table\");\r if (currentTable){\r \r var datagrid = this;\r var _self = this;\r this.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.deleteDatagridLineTitle, MWF.xApplication.process.Xform.LP.deleteDatagridLine, 300, 120, function(){\r _self.fireEvent(\"deleteLine\", [currentTable]);\r \r var data = currentTable.retrieve(\"data\");\r \r //var attKeys = [];\r \r var titleThs = _self.table.getElements(\"th\");\r titleThs.each(function(th, i){\r var key = th.get(\"id\");\r var module = _self.editModules[i];\r if (key &amp;&amp; module &amp;&amp; (module.json.type==\"Attachment\" || module.json.type==\"AttachmentDg\")){\r saveFlag = true;\r data[key][module.json.id].each(function(d){\r _self.form.workAction.deleteAttachment(d.id, _self.form.businessData.work.id);\r });\r }\r });\r \r node.destroy();\r //datagrid._loadZebraStyle();\r datagrid._loadSequence();\r datagrid._loadTotal();\r datagrid.getData();\r \r if (!_self.gridData.data.length){\r if (_self.addAction){\r if( _self.addable )_self.addAction.setStyle(\"display\", \"block\");\r }else{\r if( _self.addable )_self._loadAddAction();\r }\r }\r this.close();\r \r _self.fireEvent(\"afterDeleteLine\");\r \r if(saveFlag){\r _self.form.saveFormData();\r }\r \r }, function(){\r //var color = currentTr.retrieve(\"bgcolor\");\r //currentTr.tween(\"background-color\", color);\r this.close();\r }, null, null, this.form.json.confirmStyle);\r }\r this.validationMode();\r },\r hideEndMoveAction: function(node){\r var action = node.retrieve(\"action\");\r var tableNode = node.getLast(\"div\");\r \r new Fx.Tween(action, {\"duration\": 100}).start(\"width\", \"0px\");\r new Fx.Tween(tableNode, {\"duration\": 100}).start(\"margin-right\", \"0px\").chain(function(){\r action.destroy();\r node.eliminate(\"action\");\r });\r \r },\r showMoveAction: function(node, length){\r var action = node.retrieve(\"action\");\r var tableNode = node.getLast(\"div\");\r if (!action){\r var size = node.getSize();\r action = new Element(\"div\", {\r \"styles\": this.form.css.gridMobileDeleteActionAreaNode\r }).inject(node, \"top\");\r var button = new Element(\"div\", {\r \"styles\": this.form.css.gridMobileDeleteActionNode,\r \"text\": MWF.xApplication.process.Xform.LP[\"delete\"]\r }).inject(action);\r \r action.setStyle(\"height\",\"\"+size.y+\"px\");\r action.setStyle(\"line-height\",\"\"+size.y+\"px\");\r node.store(\"action\", action);\r }\r if (length>60) length = 60;\r action.setStyle(\"width\", \"\"+length+\"px\");\r tableNode.setStyle(\"margin-right\", \"\"+length+\"px\");\r },\r hideMoveAction: function(node, length){\r var action = node.retrieve(\"action\");\r var tableNode = node.getLast(\"div\");\r var width = 60-length;\r if (width&lt;0) width=0;\r if (action) action.setStyle(\"width\", \"\"+width+\"px\");\r tableNode.setStyle(\"margin-right\", \"\"+width+\"px\");\r },\r \r _loadDatagridStyle: function(){\r //var ths = this.node.getElements(\"th\");\r //ths.setStyles(this.form.css.datagridTitle);\r \r this.loadGridTitleStyle();\r this.loadGridContentStyle();\r //this.loadGridActionStyle();\r this.loadGridEditStyle();\r \r this._loadTotal();\r this._loadBorderStyle();\r this._loadZebraStyle();\r this._loadSequence();\r },\r \r loadGridEditStyle: function(){\r if (this.table){\r if (this.json.editStyles){\r var tds = this.table.getElements(\"td\");\r tds.setStyles(this.json.editStyles);\r }\r }\r },\r //loadGridActionStyle: function(){\r // if (this.editable!=false){\r // if (this.json.actionStyles){\r // var trs = this.table.getElements(\"tr\");\r // trs.each(function(tr, idx){\r // if (idx != 0) tr.getFirst().setStyles(this.json.actionStyles);\r // }.bind(this));\r // }\r // }\r //},\r loadGridTitleStyle: function(){\r if (this.json.titleStyles){\r var ths = this.node.getElements(\"th\");\r ths.setStyles(this.json.titleStyles);\r }\r },\r loadGridContentStyle: function(){\r if (this.json.contentStyles){\r var tds = this.node.getElements(\"td\");\r tds.setStyles(this.json.contentStyles);\r }\r },\r \r _loadZebraStyle: function(){\r if (this.json.zebraColor || this.json.backgroundColor){\r var tables = this.node.getElements(\"table\");\r tables.each(function(table){\r this._loadTableZebraStyle(table);\r }.bind(this));\r }\r },\r _loadTableZebraStyle: function(table){\r var trs = table.getElements(\"tr\");\r for (var i=0; i&lt;trs.length; i++){\r if (this.json.backgroundColor) trs[i].setStyle(\"background-color\", this.json.backgroundColor);\r if ((i%2)==0){\r if (this.json.zebraColor) trs[i].setStyle(\"background-color\", this.json.zebraColor);\r }\r }\r },\r \r createTotalDiv: function(){\r this.totalDiv = new Element(\"div.totalDiv\", {\"styles\": {\"overflow\": \"hidden\", \"margin-bottom\": \"10px\"}}).inject(this.node);\r var titleNode = new Element(\"div\", {\"styles\": this.json.itemTitleStyles}).inject(this.totalDiv);\r titleNode.set(\"text\", MWF.xApplication.process.Xform.LP.amount);\r var tableNode = new Element(\"div\", {\"styles\": this.form.css.gridMobileTableNode }).inject(this.totalDiv);\r this.totalTable = new Element(\"table\", {\r styles : this.json.tableStyles\r }).inject(tableNode);\r this.totalTable.set(this.json.properties);\r },\r \r _loadTotal: function(){\r var data = {};\r this.totalResaults = {};\r if (this.totalModules.length){\r if (!this.totalDiv){\r this.createTotalDiv();\r }\r var totalResaults = [];\r //this.totalModules.each(function(m. i){\r // totalResaults.push(0);\r //}.bind(this));\r var tables = this.node.getElements(\"table\");\r //var totalTds = this.totalTr.getElements(\"td\");\r for (var i=1; i&lt;tables.length-1; i++){\r \r var cells = tables[i].getElements(\"td\");\r this.totalModules.each(function(m, idx){\r if (!totalResaults[idx]) totalResaults.push(0);\r var tmpV = new Decimal(totalResaults[idx]);\r if (m.type==\"number\"){\r var cell = cells[m.index];\r var addv = cell.get(\"text\").toFloat();\r tmpV = tmpV.plus(addv||0);\r //tmpV = tmpV + addv;\r }\r if (m.type==\"count\"){\r tmpV = tmpV.plus(1);\r //tmpV = tmpV+1;\r }\r totalResaults[idx] = tmpV.toString();\r data[m.module.json.id] = totalResaults[idx];\r }.bind(this));\r }\r \r var trs = this.totalTable.getElements(\"tr\");\r this.totalModules.each(function(m, i){\r var tr = trs[i];\r if (!tr){\r tr = this.totalTable.insertRow(i);\r var datath = new Element(\"th\").inject(tr);\r datath.set(\"text\", m.module.node.get(\"text\"));\r // datath.setStyle(\"width\", \"30%\");\r datath.setStyles(this.json.titleStyles);\r tr.insertCell(1).setStyles(this.json.amountStyles).set(\"text\", totalResaults[i] || \"\");\r }else{\r tr.getElement(\"td\").set(\"text\", totalResaults[i] || \"\");\r }\r \r if( m.isShow === false )tr.hide();\r \r this.totalResaults[m.module.json.id] = totalResaults[i];\r }.bind(this));\r if (this.totalTable){\r var ths = this.totalTable.getElements(\"th\");\r ths.setStyles(this.json.titleStyles);\r //if (this.json.border) this._loadTableBorderStyle(this.totalTable);\r //if (this.json.zebraColor || this.json.backgroundColor) this._loadTableZebraStyle(this.totalTable);\r }\r }\r return data;\r },\r _loadSequence: function(){\r var tables = this.node.getElements(\"table\");\r tables.each(function(table, idx){\r var cells = table.getElements(\"td\");\r cells.each(function(cell){\r var module = cell.retrieve(\"module\");\r if (module){\r if (module.json.cellType==\"sequence\"){\r cell.set(\"text\", idx)\r }\r }\r }.bind(this));\r }.bind(this));\r },\r \r _loadBorderStyle: function(){\r if (this.json.border){\r var tables = this.node.getElements(\"table\");\r tables.each(function(table){\r this._loadTableBorderStyle(table)\r }.bind(this));\r }\r },\r _loadTableBorderStyle: function(table){\r table.setStyles({\r \"border-top\": this.json.border,\r \"border-left\": this.json.border\r });\r var ths = table.getElements(\"th\");\r ths.setStyles({\r \"border-bottom\": this.json.border,\r \"border-right\": this.json.border\r });\r var tds = table.getElements(\"td\");\r tds.setStyles({\r \"border-bottom\": this.json.border,\r \"border-right\": this.json.border,\r \"background\": \"transparent\"\r });\r },\r _loadDatagridTitleModules: function(){\r var ths = this.node.getElements(\"th\");\r ths.each(function(th){\r var json = this.form._getDomjson(th);\r th.store(\"dataGrid\", this);\r if (json){\r var module = this.form._loadModule(json, th);\r this.form.modules.push(module);\r }\r }.bind(this));\r },\r _loadDatagridDataModules: function(){\r var tds = this.node.getElements(\"td\");\r tds.each(function(td){\r var json = this.form._getDomjson(td);\r td.store(\"dataGrid\", this);\r if (json){\r var isField = false;\r var module = this.form._loadModule(json, td, function(){\r isField = this.field;\r this.field = false;\r });\r if( isField ){\r module.node.setStyle(\"padding-right\",\"0px\");\r }\r td.store(\"module\", module);\r this.form.modules.push(module);\r }\r }.bind(this));\r },\r _afterLoaded: function(){\r if (this.moduleValueAG){\r this.moduleValueAG.then(function(){\r this._loadDatagridStyle();\r if (this.table) this.table.setStyle(\"display\", \"none\");\r }.bind(this));\r }else{\r this._loadDatagridStyle();\r if (this.table) this.table.setStyle(\"display\", \"none\");\r }\r },\r /**\r * @summary 重置数据网格的值为默认值或置空。\r * @example\r * this.form.get('fieldId').resetData();\r */\r resetData: function(){\r this.setData(this._getValue());\r },\r /**当参数为Promise的时候，请查看文档: {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0|使用Promise处理表单异步}&lt;br/>\r * 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。\r * @summary 为数据网格赋值。\r * @param data{DatagridData|Promise|Array} 必选，数组或Promise.\r * @example\r * this.form.get(\"fieldId\").setData([]); //赋空值\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * this.form.get('fieldId').setData( data );\r * }else{\r * this.data['fieldId'] = data;\r * }\r *@example\r * //使用Promise\r * var field = this.form.get(\"fieldId\");\r * var promise = new Promise(function(resolve, reject){ //发起异步请求\r * var oReq = new XMLHttpRequest();\r * oReq.addEventListener(\"load\", function(){ //绑定load事件\r * resolve(oReq.responseText);\r * });\r * oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r * oReq.send();\r * });\r * promise.then( function(){\r * var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r * })\r * field.setData( promise );\r */\r setData: function(data){\r if (!data){\r data = this._getValue();\r }\r this._setData(data);\r },\r _setData: function(data){\r var p = o2.promiseAll(this.data).then(function(v){\r this.gridData = v;\r if (o2.typeOf(data)==\"array\") data = {\"data\": data};\r this.__setData(data);\r this.moduleValueAG = null;\r return v;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r this.moduleValueAG = p;\r if (this.moduleValueAG) this.moduleValueAG.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r \r // if (data &amp;&amp; data.isAG){\r // this.moduleValueAG = data;\r // data.addResolve(function(v){\r // this._setData(v);\r // }.bind(this));\r // }else{\r // if (o2.typeOf(data)==\"array\") data = {\"data\": data};\r // this.__setData(data);\r // this.moduleValueAG = null;\r // }\r },\r __setData: function(data){\r // if( typeOf( data ) === \"object\" &amp;&amp; typeOf(data.data) === \"array\" ){\r // if (data){\r // this._setBusinessData(data);\r // this.gridData = data;\r // }else{\r // this.gridData = this._getValue();\r // }\r this._setBusinessData(data);\r this.gridData = data;\r \r // if (this.isEdit) this._completeLineEdit();\r if( this.isEdit ){\r this.isEdit = false;\r if (this.currentEditLine) {\r this._editorTrGoBack();\r this.currentEditLine.destroy()\r }else{\r var datagridDataDiv = this.node.getElement(\".datagridDataDiv\");\r this._editorTrGoBack();\r if(datagridDataDiv)datagridDataDiv.destroy();\r }\r this.currentEditLine = null;\r }\r \r if (this.gridData){\r \r var divs = this.node.getElements(\".dataDiv\");\r for (var i=0; i&lt;divs.length; i++){\r var table = divs[i].getElement(\"table\");\r var tds = table.getElements(\"td\");\r for (var j=0; j&lt;tds.length; j++){\r var td = tds[j];\r var moduleTd = td.retrieve(\"module\");\r if (moduleTd){\r this.form.modules.erase(moduleTd);\r moduleTd = null;\r }\r }\r var ths = table.getElements(\"th\");\r for (var k=0; k&lt;ths.length; k++){\r var th = ths[k];\r var moduleTh = th.retrieve(\"module\");\r if (moduleTh){\r this.form.modules.erase(moduleTh);\r moduleTh = null;\r }\r }\r }\r for( var i=0; i&lt;divs.length; i++ ){\r divs[i].destroy();\r }\r \r // var tables = this.node.getElements(\"table\");\r // for (var i=1; i&lt;tables.length-1; i++){\r // var table = tables[i];\r // var tds = table.getElements(\"td\");\r // for (var j=0; j&lt;tds.length; j++){\r // var td = tds[j];\r // var moduleTd = td.retrieve(\"module\");\r // if (moduleTd){\r // this.form.modules.erase(moduleTd);\r // delete moduleTd;\r // }\r // }\r // var ths = table.getElements(\"th\");\r // for (var k=0; k&lt;ths.length; k++){\r // var th = ths[k];\r // var moduleTh = th.retrieve(\"module\");\r // if (moduleTh){\r // this.form.modules.erase(moduleTh);\r // delete moduleTh;\r // }\r // }\r // }\r //\r // while (tables.length>2){\r // tables[1].destroy();\r // tables = this.node.getElements(\"table\");\r // }\r if (this.editable!=false){\r this._loadEditDatagrid();\r //this._loadReadDatagrid();\r }else{\r this._loadReadDatagrid();\r }\r this._loadDatagridStyle();\r }\r \r \r },\r /**\r * @summary 获取总计数据.\r * @example\r * var totalObject = this.form.get('fieldId').getTotal();\r * @return {Object} 总计数据\r */\r getTotal: function(){\r this._loadTotal();\r return this.totalResaults;\r },\r /**\r * @summary 判断数据网格是否为空.\r * @example\r * if( this.form.get('fieldId').isEmpty() ){\r * this.form.notice('至少需要添加一条数据', 'warn');\r * }\r * @return {Boolean} 是否为空\r */\r isEmpty: function(){\r var data = this.getData();\r if( !data )return true;\r if( typeOf( data ) === \"object\" ){\r if( typeOf( data.data ) !== \"array\" )return true;\r if( data.data.length === 0 )return true;\r }\r return false;\r },\r /**\r * 在脚本中使用 this.data[fieldId] 也可以获取组件值。\r * 区别如下：&lt;br/>\r * 1、当使用Promise的时候&lt;br/>\r * 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r * this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r * {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0#EggIl|具体差异请查看链接}&lt;br/>\r * 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。\r * @summary 获取数据网格数据.\r * @example\r * var data = this.form.get('fieldId').getData();\r *@example\r * //如果无法确定表单上是否有组件，需要判断\r * var data;\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * data = this.form.get('fieldId').getData();\r * }else{\r * data = this.data['fieldId']; //直接从数据中获取字段值\r * }\r * @example\r * //使用Promise\r * var field = this.form.get(\"fieldId\");\r * var promise = new Promise(function(resolve, reject){ //发起异步请求\r * var oReq = new XMLHttpRequest();\r * oReq.addEventListener(\"load\", function(){ //绑定load事件\r * resolve(oReq.responseText);\r * });\r * oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r * oReq.send();\r * });\r * promise.then( function(){\r * var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r * })\r * field.setData( promise );\r * @return {DatagridData}\r */\r getData: function(){\r if (this.editable!=false){\r if (this.isEdit) this._completeLineEdit();\r var data = [];\r \r var tables = this.node.getElements(\"table\");\r for (var i=1; i&lt;((this.totalTable) ? tables.length-1 : tables.length); i++){\r var table = tables[i];\r var d = table.retrieve(\"data\");\r if (d) data.push(d);\r }\r this.gridData = {};\r this.gridData.data = data;\r \r this._loadTotal();\r this.gridData.total = this.totalResaults;\r \r this._setBusinessData(this.gridData);\r \r return (this.gridData.data.length) ? this.gridData : {data:[]};\r }else{\r return this._getBusinessData();\r }\r },\r getAmount: function(){\r return this._loadTotal();\r },\r createErrorNode: function(text){\r var node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"text-align\": \"left\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r return node;\r },\r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border\", \"1px solid red\");\r \r this.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r this.showNotValidationMode(this.node);\r }\r },\r showNotValidationMode: function(node){\r var p = node.getParent(\"div\");\r if (p){\r if (p.get(\"MWFtype\") == \"tab$Content\"){\r if (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r \r validationConfigItem: function(routeName, data){\r var flag = (data.status==\"all\") ? true: (routeName == data.decision);\r if (flag){\r var n = this.getData();\r if( typeOf(n)===\"object\" &amp;&amp; JSON.stringify(n) === JSON.stringify({data:[]}) )n = \"\";\r var v = (data.valueType==\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function(routeName, opinion){\r if (this.isEdit){\r if (!this.editValidation()){\r return false;\r }\r }\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r \r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r \r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString()!=\"true\"){\r this.notValidationMode(flag);\r return false;\r }\r return true;\r }\r \r });\r \r MWF.xApplication.process.Xform.DatagridMobile$Title = new Class({\r Extends: MWF.APP$Module,\r _afterLoaded: function(){\r this.dataGrid = this.node.retrieve(\"dataGrid\");\r if ((this.json.total == \"number\") || (this.json.total == \"count\")){\r this.dataGrid.totalModules.push({\r \"module\": this,\r \"index\": this.node.getParent(\"tr\").rowIndex,\r \"type\": this.json.total,\r \"isShow\": this.json.isShow\r })\r }\r //\tthis.form._loadModules(this.node);\r }\r });\r MWF.xApplication.process.Xform.DatagridMobile$Data = new Class({\r Extends: MWF.APP$Module,\r _afterLoaded: function(){\r //this.form._loadModules(this.node);\r this.dataGrid = this.node.retrieve(\"dataGrid\");\r \r var td = this.node;\r if (this.json.cellType == \"sequence\"){\r var flag = true;\r for (var i=0; i&lt;this.dataGrid.editModules.length; i++){\r if (this.dataGrid.editModules[i].json.id == this.json.id){\r flag = false;\r break;\r }\r }\r if (flag){\r this.dataGrid.editModules.push({\r \"json\": {\"type\": \"sequence\", \"id\": this.json.id},\r \"node\": td ,\r \"focus\": function(){}\r });\r }\r td.empty();\r }else{\r var moduleNodes = this.form._getModuleNodes(this.node);\r moduleNodes.each(function(node){\r var json = this.form._getDomjson(node);\r var isField = false;\r \r if (json.type==\"Attachment\" || json.type==\"AttachmentDg\" ){\r json.type = \"AttachmentDg\";\r //json.site = this.dataGrid.getAttachmentRandomSite();\r //json.id = json.site;\r }\r \r var module = this.form._loadModule(json, node, function(){\r isField = this.field;\r this.field = false;\r });\r if( isField ){\r module.node.setStyle(\"padding-right\",\"0px\");\r }\r module.dataModule = this;\r this.dataGrid.editModules.push(module);\r }.bind(this));\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_DatagridPC.js.html":{"url":"x_component_process_Xform_DatagridPC.js.html","title":"x_component_process_Xform/DatagridPC.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/DatagridPC.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/DatagridPC.js /**\r * 数据网格数据结构.\r * @typedef {Object} DatagridData\r * @property {Array} data - 数据网格列表数据\r * @property {Object} total - 统计数据\r * @example\r * \t{\r \t \"data\": [ //数据网格条目\r \t\t{\r \t\t \"datagrid_datagrid$Title\": { //数据网格第1列title标识\r \t\t\t\"org_20\": { //数据网格第1列字段标识，人员组件单个对象，存的是对象\r \t\t\t \"distinguishedName\": \"张三@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"张三\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t}\r \t\t },\r \t\t \"datagrid_datagrid$Title1\": { //数据网格第2列title标识\r \t\t\t\"org_21\": [{ //数据网格第2列字段标识，人员组件多个对象，存的是数组\r \t\t\t \"distinguishedName\": \"张三@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"张三\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t},{\r \t\t\t \"distinguishedName\": \"李四@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"李四\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t}]\r \t\t },\r \t\t \"datagrid_datagrid$Title_2\": { //数据网格第2列title标识\r \t\t\t\"number\": \"111\" //数据网格第3列字段标识和值\r \t\t },\r \t\t \"datagrid_datagrid$Title_3\": { //数据网格第3列title标识\r \t\t\t\"textfield_2\": \"杭州\" //数据网格第4列字段标识和值\r \t\t },\r \t\t \"datagrid_datagrid$Title_4\": { //数据网格第4列title标识\r \t\t\t\"attachment_1\": [ //数据网格第5列字段标识\r \t\t\t {\r \t\t\t\t\"activityName\": \"拟稿\",\r \t\t\t\t\"extension\": \"jpg\",\r \t\t\t\t\"id\": \"9514758e-9e28-4bfe-87d7-824f2811f173\",\r \t\t\t\t\"lastUpdateTime\": \"2020-12-09 21:48:03\",\r \t\t\t\t\"length\": 452863.0,\r \t\t\t\t\"name\": \"111.jpg\",\r \t\t\t\t\"person\": \"李四@lisi@P\"\r \t\t\t }\r \t\t\t]\r \t\t }\r \t\t},\r \t\t...\r \t ],\r \t \"total\": { //统计数据，列title设置了总计\r \t\t\"datagrid_datagrid$Title_2\": \"333\", //总计列2\r \t\t\"datagrid_datagrid$Title_3\": \"2\" //总计列3\r \t }\r \t}\r */\r MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class DatagridPC 数据网格组件（PC端）。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var datagrid = this.form.get(\"name\"); //获取组件\r * //方法2\r * var datagrid = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.DatagridPC = new Class(\r \t/** @lends MWF.xApplication.process.Xform.DatagridPC# */\r \t{\r \t\tImplements: [Events],\r \t\tExtends: MWF.APP$Module,\r \t\tisEdit: false,\r \t\toptions: {\r \t\t\t/**\r \t\t\t * 当前条目编辑完成时触发。通过this.event可以获取对应的tr。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#completeLineEdit\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t/**\r \t\t\t * 添加条目时触发。通过this.event可以获取对应的tr。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#addLine\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t/**\r \t\t\t * 删除条目前触发。通过this.event可以获取对应的tr。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#deleteLine\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t/**\r \t\t\t * 删除条目后触发。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#afterDeleteLine\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t/**\r \t\t\t * 编辑条目时触发。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#editLine\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t/**\r \t\t\t * 导出excel的时候触发，this.event指向导出的数据，您可以通过修改this.event来修改数据。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#export\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t * @example\r \t\t\t * &lt;caption>this.event数据格式如下：&lt;/caption>\r \t\t\t * {\r \t\t\t * \tdata : [\r \t\t\t * \t\t[\"姓名\",\"性别\",\"学历\",\"专业\",\"出生日期\",\"毕业日期\"], //标题\r \t\t\t * \t\t[ \"张三\",\"男\",\"大学本科\",\"计算机\",\"2001-1-2\",\"2019-9-2\" ], //第一行数据\r \t\t\t * \t\t[ \"李四\",\"男\",\"大学专科\",\"数学\",\"1998-1-2\",\"2018-9-2\" ] //第二行数据\r \t\t\t * \t], //导出的数据\r \t\t\t * colWidthArray : [100, 50, 100, 200, 150, 150], //每列宽度\r \t\t\t * title : \"xxxx\" //导出的excel文件标题\r \t\t\t * }\r \t\t\t */\r \t\t\t/**\r \t\t\t * 在导入excel，进行数据校验后触发，this.event指向导入的数据。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#validImport\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t * @example\r \t\t\t * &lt;caption>this.event数据格式如下：&lt;/caption>\r \t\t\t * {\r \t\t\t * \tdata : [\r \t\t\t * \t {\r \t\t\t * \t \t\"姓名\" : \"张三\",\r \t\t\t * \t \t\"性别\" : \"男\",\r \t\t\t * \t \t\"学历\" ： \"大学本科\",\r \t\t\t * \t \"专业\" : \"计算机\",\r \t\t\t * \t \"出生日期\" : \"aa01-1-2\",\r \t\t\t * \t \t\"毕业日期\" : \"2019-9-2\",\r \t\t\t * \t \t\"errorTextList\" : [\r \t\t\t * \t \t \"第5列：aa01-1-2不是正确的日期格式。\"\r \t\t\t * \t \t] //校验出的错误信息，如果改行数据正确，则无该字段\r \t\t\t * \t }\r \t\t\t * \t ...\r \t\t\t * ], //导入的数据\r \t\t\t * \"validted\" : true //是否校验通过，可以在本事件中修改该参数，确定是否强制导入\r \t\t\t * }\r \t\t\t */\r \t\t\t/**\r \t\t\t * 在导入excel，数据校验成功将要设置回数据网格的时候触发，this.event指向整理过的导入数据，格式见{@link DatagridData}。\r \t\t\t * @event MWF.xApplication.process.Xform.DatagridPC#import\r \t\t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t\t */\r \t\t\t\"moduleEvents\": [\"queryLoad\",\"postLoad\",\"load\",\"completeLineEdit\", \"addLine\", \"deleteLine\", \"afterDeleteLine\",\"editLine\", \"export\", \"import\", \"validImport\"]\r \t\t},\r \r \t\tinitialize: function(node, json, form, options){\r \t\t\tthis.node = $(node);\r \t\t\tthis.node.store(\"module\", this);\r \t\t\tthis.json = json;\r \t\t\tthis.form = form;\r \t\t\tthis.field = true;\r \t\t},\r \r \t\t_loadUserInterface: function(){\r \t\t\tthis.fireEvent(\"queryLoad\");\r \r \t\t\tthis.editModules = [];\r \t\t\tthis.node.setStyle(\"overflow-x\", \"auto\");\r \t\t\tthis.node.setStyle(\"overflow-y\", \"hidden\");\r \t\t\tthis.table = this.node.getElement(\"table\");\r \r \t\t\tthis.editable = (this.readonly) ? false : true;\r \t\t\tif (this.editable &amp;&amp; this.json.editableScript &amp;&amp; this.json.editableScript.code){\r \t\t\t\tthis.editable = this.form.Macro.exec(((this.json.editableScript) ? this.json.editableScript.code : \"\"), this);\r \t\t\t}\r \r \t\t\tthis.deleteable = this.json.deleteable !== \"no\";\r \t\t\tthis.addable = this.json.addable !== \"no\";\r \r \t\t\t//允许导入\r \t\t\tthis.importenable = this.editable &amp;&amp; (this.json.impexpType === \"impexp\" || this.json.impexpType === \"imp\");\r \t\t\t//允许导出\r \t\t\tthis.exportenable = this.json.impexpType === \"impexp\" || this.json.impexpType === \"exp\";\r \r \t\t\tthis.gridData = this._getValue();\r \r \t\t\tthis.totalModules = [];\r \t\t\tthis._loadDatagridTitleModules();\r \r \t\t\tif (this.editable!=false){\r \t\t\t\tthis._loadDatagridDataModules();\r \t\t\t\tthis._addTitleActionColumn();\r \r \t\t\t\tthis._loadEditDatagrid(function(){\r \t\t\t\t\tthis._loadImportExportAction();\r \t\t\t\t\tthis.fireEvent(\"postLoad\");\r \t\t\t\t\tthis.fireEvent(\"load\");\r \t\t\t\t}.bind(this));\r \t\t\t\t//this._loadReadDatagrid();\r \t\t\t}else{\r \t\t\t\tthis._loadDatagridDataModules();\r \t\t\t\tthis._getDatagridEditorTr();\r \t\t\t\tthis._loadReadDatagrid(function(){\r \t\t\t\t\tif(this.editorTr)this.editorTr.setStyle(\"display\", \"none\");\r \t\t\t\t\tthis._loadImportExportAction();\r \t\t\t\t\tthis.fireEvent(\"postLoad\");\r \t\t\t\t\tthis.fireEvent(\"load\");\r \t\t\t\t}.bind(this));\r \r \t\t\t}\r \t\t},\r \t\t_loadStyles: function(){\r \t\t\tthis.table.setStyles(this.json.tableStyles);\r \t\t\tthis.node.setStyles(this.json.styles);\r \t\t},\r \t\t_getValue: function(){\r \t\t\tif (this.moduleValueAG) return this.moduleValueAG;\r \t\t\tvar value = [];\r \t\t\tvalue = this._getBusinessData();\r \t\t\tif (!value){\r \t\t\t\tif (this.json.defaultData &amp;&amp; this.json.defaultData.code) value = this.form.Macro.exec(this.json.defaultData.code, this);\r \t\t\t\tif (!value.then) if (o2.typeOf(value)==\"array\") value = {\"data\": value || []};\r \t\t\t}\r \t\t\treturn value || {};\r \t\t},\r \t\tgetValue: function(){\r \t\t\treturn this._getValue();\r \t\t},\r \t\t_getDatagridTr: function(){\r \t\t\tthis._getDatagridTitleTr();\r \t\t\tthis._getDatagridEditorTr();\r \t\t},\r \t\t_getDatagridTitleTr: function(){\r \t\t\tthis.titleTr = this.table.getElement(\"tr\");\r \t\t\treturn this.titleTr;\r \t\t},\r \t\t_getDatagridEditorTr: function(){\r \t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\tthis.editorTr = trs[trs.length-1];\r \t\t\tthis.editorTr.addClass(\"datagridEditorTr\");\r \r \t\t\treturn this.editorTr;\r \t\t},\r \t\t_addTitleActionColumn: function(){\r \t\t\tif (!this.titleTr) this._getDatagridTitleTr();\r \t\t\tif (!this.editorTr) this._getDatagridEditorTr();\r \r \t\t\tvar actionTh = new Element(\"th\", {\"styles\": {\"width\": \"46px\"}}).inject(this.titleTr, \"top\");\r \t\t\tnew Element(\"th\").inject(this.titleTr, \"bottom\");\r \t\t\tif( this.addable ){\r \t\t\t\tthis._createAddLineAction(actionTh);\r \t\t\t}\r \t\t\t//this._createDelLineAction(actionTh);\r \r \t\t\tvar actionEditTd = new Element(\"td\").inject(this.editorTr, \"top\");\r \t\t\tthis._createCompleteAction(actionEditTd);\r \t\t\tif( this.deleteable ){\r \t\t\t\tthis._createCancelAction(actionEditTd);\r \t\t\t}\r \r \t\t\tnew Element(\"td\").inject(this.editorTr, \"bottom\");\r \r \t\t\t//if (this.totalTr){\r \t\t\t// new Element(\"td\").inject(this.totalTr, \"top\");\r \t\t\t// new Element(\"td\").inject(this.totalTr, \"bottom\");\r \t\t\t// this.totalModules.each(function(m){\r \t\t\t// m.index = m.index+1;\r \t\t\t// });\r \t\t\t//}\r \t\t},\r \r \t\t_loadEditDatagrid: function(callback){\r \t\t\tvar p = o2.promiseAll(this.gridData).then(function(v){\r \t\t\t\tthis.gridData = v;\r \t\t\t\tif (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r \t\t\t\tthis.__loadEditDatagrid(callback);\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t\treturn v;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \t\t\tthis.moduleValueAG = p;\r \t\t\tif (this.moduleValueAG) this.moduleValueAG.then(function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \t\t\t// if (this.gridData &amp;&amp; this.gridData.isAG){\r \t\t\t// \tthis.moduleValueAG = this.gridData;\r \t\t\t// \tthis.gridData.addResolve(function(v){\r \t\t\t// \t\tthis.gridData = v;\r \t\t\t// \t\tthis._loadEditDatagrid(callback);\r \t\t\t// \t}.bind(this));\r \t\t\t// }else{\r \t\t\t// \tif (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r \t\t\t// \tthis.__loadEditDatagrid(callback);\r \t\t\t// \tthis.moduleValueAG = null;\r \t\t\t// }\r \t\t},\r \t\t__loadEditDatagrid: function(callback){\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\tvar editorTds = this.editorTr.getElements(\"td\");\r \r \t\t\tif (this.gridData.data){\r \t\t\t\tthis.gridData.data.each(function(data, idx){\r \t\t\t\t\tvar tr = $(this.table.insertRow(idx+1));\r \t\t\t\t\ttr.store(\"data\", data);\r \t\t\t\t\ttitleThs.each(function(th, index){\r \t\t\t\t\t\tvar cellData = data[th.get(\"id\")];\r \t\t\t\t\t\tvar text = \"\";\r \t\t\t\t\t\tfor (key in cellData){\r \t\t\t\t\t\t\tvar value = cellData[key];\r \t\t\t\t\t\t\ttext = this._getValueText(index-1, value);\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tthis._createNewEditTd(tr, index, editorTds[index].get(\"id\"), text, titleThs.length-1, idx);\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}.bind(this));\r \t\t\t}\r \t\t\tthis.editorTr.setStyle(\"display\", \"none\");\r \t\t\tif (callback) callback();\r \t\t},\r \r \r \t\t_getValueText: function(idx, value){\r \r \t\t\tvar module = this.editModules[idx];\r \t\t\tif (module){\r \t\t\t\tswitch (module.json.type){\r \t\t\t\t\tcase \"Select\":\r \t\t\t\t\t\tfor (var i=0; i&lt;module.json.itemValues.length; i++){\r \t\t\t\t\t\t\tvar itemv = module.json.itemValues[i];\r \t\t\t\t\t\t\tvar arr = itemv.split(/\\|/);\r \t\t\t\t\t\t\tvar text = arr[0];\r \t\t\t\t\t\t\tvar v = (arr.length>1) ? arr[1] : arr[0];\r \t\t\t\t\t\t\tif (value===v) return text;\r \t\t\t\t\t\t}\r \t\t\t\t\t\t// var ops = module.node.getElements(\"option\");\r \t\t\t\t\t\t// for (var i=0; i&lt;ops.length; i++){\r \t\t\t\t\t\t// \tif (ops[i].value == value){\r \t\t\t\t\t\t// \t\treturn ops[i].get(\"text\");\r \t\t\t\t\t\t// \t\tbreak;\r \t\t\t\t\t\t// \t}\r \t\t\t\t\t\t// }\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"Radio\":\r \t\t\t\t\t\tvar ops = module.node.getElements(\"input\");\r \t\t\t\t\t\tfor (var i=0; i&lt;ops.length; i++){\r \t\t\t\t\t\t\tif (ops[i].value == value){\r \t\t\t\t\t\t\t\treturn ops[i].get(\"showText\");\r \t\t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"Checkbox\":\r \t\t\t\t\t\tvar ops = module.node.getElements(\"input\");\r \t\t\t\t\t\tvar texts = [];\r \t\t\t\t\t\tfor (var i=0; i&lt;ops.length; i++){\r \t\t\t\t\t\t\tif (value.indexOf(ops[i].value) != -1) texts.push(ops[i].get(\"showText\"));\r \t\t\t\t\t\t}\r \t\t\t\t\t\tif (texts.length) return texts.join(\", \");\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"Orgfield\":\r \t\t\t\t\tcase \"Personfield\":\r \t\t\t\t\tcase \"Org\":\r \t\t\t\t\t\t//var v = module.getTextData();\r \t\t\t\t\t\t//return v.text[0];\r \r \t\t\t\t\t\tif (typeOf(value)===\"array\"){\r \t\t\t\t\t\t\tvar textArray = [];\r \t\t\t\t\t\t\tvalue.each( function( item ){\r \t\t\t\t\t\t\t\tif (typeOf(item)===\"object\"){\r \t\t\t\t\t\t\t\t\ttextArray.push( item.name+((item.unitName) ? \"(\"+item.unitName+\")\" : \"\") );\r \t\t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\t\ttextArray.push(item);\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t}.bind(this));\r \t\t\t\t\t\t\treturn textArray.join(\", \");\r \t\t\t\t\t\t}else if (typeOf(value)===\"object\"){\r \t\t\t\t\t\t\treturn value.name+((value.unitName) ? \"(\"+value.unitName+\")\" : \"\");\r \t\t\t\t\t\t}else{\r \t\t\t\t\t\t\treturn value;\r \t\t\t\t\t\t}\r \r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"Textarea\":\r \t\t\t\t\t\tvar reg = new RegExp(\"\\n\",\"g\");\r \t\t\t\t\t\tvar reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r \t\t\t\t\t\tvar reg3 = new RegExp(\"\\u003e\",\"g\");\r \t\t\t\t\t\tvalue = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r \t\t\t\t\t\tbreak;\r \t\t\t\t\t// case \"address\":\r \t\t\t\t\t// \tif (typeOf(value)===\"array\"){\r \t\t\t\t\t//\r \t\t\t\t\t// \t}\r \t\t\t\t\t// \tbreak;\r \t\t\t\t}\r \t\t\t}\r \t\t\treturn value;\r \t\t},\r \r \t\t_createNewEditTd: function(tr, idx, id, text, lastIdx, rowIndex){\r \t\t\tvar cell = $(tr.insertCell(idx));\r \t\t\tif (idx==0){\r \t\t\t\tcell.setStyles(this.form.css.gridLineActionCell);\r \t\t\t\tif( this.addable )this._createAddLineAction(cell);\r \t\t\t\tif( this.deleteable )this._createDelLineAction(cell);\r \t\t\t}else if (idx == lastIdx){\r \t\t\t\tcell.setStyles(this.form.css.gridMoveActionCell);\r \t\t\t\tthis._createMoveLineAction(cell);\r \t\t\t}else{\r \t\t\t\tcell.set(\"MWFId\", id);\r \r \t\t\t\tvar module = this.editModules[idx-1];\r \t\t\t\tif( module &amp;&amp; module.json.type == \"ImageClipper\" ){\r \t\t\t\t\tthis._createImage( cell, module, text )\r \t\t\t\t}else if( module &amp;&amp; module.json.type == \"Image\" ) {\r \t\t\t\t\tthis._createImg(cell, module, rowIndex);\r \t\t\t\t}else if( module &amp;&amp; module.json.type == \"Button\" ) {\r \t\t\t\t\tthis._createButton(cell, module, rowIndex);\r \t\t\t\t}else if( module &amp;&amp; module.json.type == \"Label\" ) {\r \t\t\t\t\tthis._createLabel(cell, module, rowIndex);\r \t\t\t\t}else if( module &amp;&amp; (module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\") ){\r \t\t\t\t\tthis._createAttachment( cell, module, text );\r \t\t\t\t}else{\r \t\t\t\t\tif( module &amp;&amp; module.json.type == \"Textarea\" ){\r \t\t\t\t\t\tcell.set(\"html\", text);\r \t\t\t\t\t}else{\r \t\t\t\t\t\tcell.set(\"text\", text);\r \t\t\t\t\t}\r \t\t\t\t\t// /cell.set(\"text\", text);\r \t\t\t\t}\r \t\t\t\tif( !module || ![\"Button\"].contains( module.json.type ) ){\r \t\t\t\t\tcell.addEvent(\"click\", function(e){\r \t\t\t\t\t\tthis._editLine(e.target);\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}\r \t\t\t}\r \t\t\tvar json = this.form._getDomjson(cell);\r \r \t\t\tif (json){\r \t\t\t\tcell.store(\"dataGrid\", this);\r \t\t\t\tvar module = this.form._loadModule(json, cell);\r \t\t\t\tcell.store(\"module\", module);\r \t\t\t\tthis.form.modules.push(module);\r \t\t\t\tif( json.isShow === false )cell.hide();\r \t\t\t}\r \r \t\t},\r \r \t\t_createAddLineAction: function(td){\r \t\t\tvar addLineAction = new Element(\"div\", {\r \t\t\t\t\"styles\": this.form.css.addLineAction,\r \t\t\t\t\"events\": {\r \t\t\t\t\t\"click\": function(e){\r \t\t\t\t\t\tthis._addLine(e.target);\r \t\t\t\t\t}.bind(this)\r \t\t\t\t}\r \t\t\t});\r \t\t\taddLineAction.inject(td);\r \t\t},\r \t\t_createDelLineAction: function(td){\r \t\t\tvar delLineAction = new Element(\"div\", {\r \t\t\t\t\"styles\": this.form.css.delLineAction,\r \t\t\t\t\"events\": {\r \t\t\t\t\t\"click\": function(e){\r \t\t\t\t\t\tthis._deleteLine(e);\r \t\t\t\t\t}.bind(this)\r \t\t\t\t}\r \t\t\t});\r \t\t\tdelLineAction.inject(td);\r \t\t},\r \t\t_createCompleteAction: function(td){\r \t\t\tvar completeAction = new Element(\"div\", {\r \t\t\t\t\"styles\": this.form.css.completeLineAction,\r \t\t\t\t\"events\": {\r \t\t\t\t\t\"click\": function(e){\r \t\t\t\t\t\tthis._completeLineEdit(e);\r \t\t\t\t\t}.bind(this)\r \t\t\t\t}\r \t\t\t});\r \t\t\tcompleteAction.inject(td);\r \t\t},\r \t\t_createCancelAction: function(td){\r \t\t\tvar cancelAction = new Element(\"div\", {\r \t\t\t\t\"styles\": this.form.css.delLineAction,\r \t\t\t\t\"events\": {\r \t\t\t\t\t\"click\": function(e){\r \t\t\t\t\t\tthis._cancelLineEdit(e);\r \t\t\t\t\t}.bind(this)\r \t\t\t\t}\r \t\t\t});\r \t\t\tcancelAction.inject(td);\r \t\t},\r \r \t\t_editLine:function(td){\r \t\t\tif (this.isEdit){\r \t\t\t\tif (!this._completeLineEdit()) return false;\r \t\t\t}\r \r \t\t\tthis.currentEditLine = td.getParent(\"tr\");\r \t\t\tif (this.currentEditLine){\r \t\t\t\tthis.editorTr.setStyles({\r \t\t\t\t\t//\"background-color\": \"#fffeb5\",\r \t\t\t\t\t\"display\": \"table-row\"\r \t\t\t\t});\r \t\t\t\tthis.editorTr.inject(this.currentEditLine, \"before\");\r \t\t\t\tthis.currentEditLine.setStyle(\"display\", \"none\");\r \r \t\t\t\tvar data = this.currentEditLine.retrieve(\"data\");\r \t\t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\t\ttitleThs.each(function(th, idx){\r \t\t\t\t\tvar id = th.get(\"id\");\r \t\t\t\t\tvar module = this.editModules[idx-1];\r \t\t\t\t\tif (module){\r \t\t\t\t\t\tif (module.json.type==\"sequence\"){\r \t\t\t\t\t\t\tmodule.node.set(\"text\", module.node.getParent(\"tr\").rowIndex);\r \t\t\t\t\t\t}else if( module.setData ){\r \r \t\t\t\t\t\t\tif (data[id]) {\r \t\t\t\t\t\t\t\tmodule.setData(data[id][module.json.id]);\r \t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\tmodule.setData(null);\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \t\t\t\t}.bind(this));\r \r \r \r \t\t\t\tvar cellIdx = this.currentEditLine.getElements(\"td\").indexOf(td);\r \t\t\t\tvar module = this.editModules[cellIdx-1];\r \t\t\t\tif (module) module.focus();\r \r \r \t\t\t\tthis.fireEvent(\"editLine\");\r \r \t\t\t\tthis.isEdit =true;\r \t\t\t}\r \t\t\tthis.validationMode();\r \t\t},\r \t\teditValidation: function(){\r \t\t\tvar flag = true;\r \t\t\tthis.editModules.each(function(field, key){\r \t\t\t\tif (field.json.type!=\"sequence\" &amp;&amp; field.validationMode ){\r \t\t\t\t\tfield.validationMode();\r \t\t\t\t\tif (!field.validation()) flag = false;\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t\treturn flag;\r \t\t},\r \r \t\t// _cancelLineEdit: function(e){\r \t\t// \tthis.isEdit = false;\r \t\t//\r \t\t// \tvar flag = true;\r \t\t//\r \t\t// \tvar griddata = {};\r \t\t// \tvar newTr = null;\r \t\t//\r \t\t// \tif (this.currentEditLine){\r \t\t// \t\tnewTr = this.currentEditLine;\r \t\t// \t\tgriddata = this.currentEditLine.retrieve(\"data\");\r \t\t// \t}else{\r \t\t// \t\tnewTr = new Element(\"tr\").inject(this.editorTr, \"before\");\r \t\t// \t\tgriddata = {};\r \t\t// \t}\r \t\t//\r \t\t// \tif (flag){\r \t\t// \t\tnewTr.destroy();\r \t\t// \t}\r \t\t// \tthis.currentEditLine = null;\r \t\t//\r \t\t// \tthis._editorTrGoBack();\r \t\t//\r \t\t// \t// if (this.json.contentStyles){\r \t\t// \t// \tvar tds = newTr.getElements(\"td\");\r \t\t// \t// \ttds.setStyles(this.json.contentStyles);\r \t\t// \t// }\r \t\t// \t// if (this.json.actionStyles){\r \t\t// \t// \tnewTr.getFirst().setStyles(this.json.actionStyles);\r \t\t// \t// }\r \t\t//\r \t\t// \t// this._loadBorderStyle();\r \t\t// \t// this._loadZebraStyle();\r \t\t// \t// this._loadSequence();\r \t\t//\r \t\t// \tthis.fireEvent(\"cancelLineEdit\");\r \t\t// },\r \t\t_cancelLineEdit: function(e){\r \r \t\t\tvar datagrid = this;\r \t\t\tthis.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.cancelDatagridLineEditTitle, MWF.xApplication.process.Xform.LP.cancelDatagridLineEdit, 300, 120, function(){\r \t\t\t\tif (datagrid.currentEditLine) {\r \t\t\t\t\tdatagrid.currentEditLine.setStyle(\"display\", \"table-row\");\r \t\t\t\t}\r \r \t\t\t\tdatagrid.editModules.each(function(module){\r \t\t\t\t\tif (module &amp;&amp; (module.json.type==\"Attachment\" || module.json.type==\"AttachmentDg\")){\r \t\t\t\t\t\tmodule.attachmentController.attachments.each(function(att){\r \t\t\t\t\t\t\tdatagrid.form.workAction.deleteAttachment(att.data.id, datagrid.form.businessData.work.id);\r \t\t\t\t\t\t});\r \t\t\t\t\t\tmodule.attachmentController.clear();\r \t\t\t\t\t}\r \t\t\t\t});\r \r \t\t\t\tdatagrid.isEdit = false;\r \t\t\t\tdatagrid.currentEditLine = null;\r \r \t\t\t\tdatagrid._editorTrGoBack();\r \r \t\t\t\t// this._loadBorderStyle();\r \t\t\t\t// this._loadZebraStyle();\r \t\t\t\t// this._loadSequence();\r \t\t\t\t// this.getData();\r \r \t\t\t\t// datagrid._loadZebraStyle();\r \t\t\t\t// datagrid._loadSequence();\r \t\t\t\t// datagrid._loadTotal();\r \t\t\t\t// datagrid.getData();\r \t\t\t\tthis.close();\r \r \t\t\t\tdatagrid.fireEvent(\"cancelLineEdit\");\r \t\t\t}, function(){\r \t\t\t\t// var color = currentTr.retrieve(\"bgcolor\");\r \t\t\t\t// currentTr.tween(\"background\", color);\r \t\t\t\tthis.close();\r \t\t\t}, null, null, this.form.json.confirmStyle);\r \r \t\t},\r \t\t_completeLineEdit: function( ev ){\r \r \t\t\tdebugger;\r \r \t\t\t//this.currentEditLine.getElemets(td);\r \t\t\tif (!this.editValidation()){\r \t\t\t\treturn false;\r \t\t\t}\r \r \t\t\tthis.isEdit = false;\r \r \t\t\tvar flag = true;\r \t\t\tvar saveFlag = false;\r \r \t\t\tvar griddata = {};\r \t\t\tvar newTr = null;\r \r \t\t\tif (this.currentEditLine){\r \t\t\t\tnewTr = this.currentEditLine;\r \t\t\t\tgriddata = this.currentEditLine.retrieve(\"data\");\r \t\t\t}else{\r \t\t\t\tnewTr = new Element(\"tr\").inject(this.editorTr, \"before\");\r \t\t\t\tgriddata = {};\r \t\t\t}\r \r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\tvar editorTds = this.editorTr.getElements(\"td\");\r \t\t\tvar cells = newTr.getElements(\"td\");\r \t\t\ttitleThs.each(function(th, idx){\r \t\t\t\tvar cell = cells[idx];\r \t\t\t\tvar id = th.get(\"id\");\r \t\t\t\tvar module = this.editModules[idx-1];\r \t\t\t\tif (module){\r \t\t\t\t\tif (module.json.type==\"sequence\"){\r \t\t\t\t\t\tflag = false;\r \t\t\t\t\t\tvar i = newTr.rowIndex;\r \t\t\t\t\t\tvar data = {\"value\": [i], \"text\": [i]};\r \t\t\t\t\t}else if (module.json.type==\"Attachment\" || module.json.type == \"AttachmentDg\"){\r \t\t\t\t\t\tsaveFlag = true;\r \t\t\t\t\t\tflag = false;\r \t\t\t\t\t\tvar data = module.getTextData();\r \t\t\t\t\t\t//data.site = module.json.site;\r \t\t\t\t\t\tif (!griddata[id]) griddata[id] = {};\r \t\t\t\t\t\tgriddata[id][module.json.id] = data;\r \t\t\t\t\t\t// }else if( [\"Orgfield\",\"Personfield\",\"Org\",\"Address\"].contains(module.json.type) ){\r \t\t\t\t\t\t// \tdata = module.getTextData();\r \t\t\t\t\t\t// \tif( data.value &amp;&amp; data.value.length )flag = false;\r \t\t\t\t\t\t// \tif (!griddata[id]) griddata[id] = {};\r \t\t\t\t\t\t// \tgriddata[id][module.json.id] = data.value;\r \t\t\t\t\t}else if( module.getTextData ){\r \t\t\t\t\t\tvar data = module.getTextData();\r \t\t\t\t\t\tif (data.value[0]) flag = false;\r \t\t\t\t\t\tif (data.value.length&lt;2){\r \t\t\t\t\t\t\tif (!griddata[id]) griddata[id] = {};\r \t\t\t\t\t\t\tgriddata[id][module.json.id] = data.value[0];\r \t\t\t\t\t\t}else{\r \t\t\t\t\t\t\tif (!griddata[id]) griddata[id] = {};\r \t\t\t\t\t\t\tgriddata[id][module.json.id] = data.value;\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \r \t\t\t\t\tif( data ){\r \t\t\t\t\t\tif (cell){\r \t\t\t\t\t\t\tif( module.json.type == \"ImageClipper\" ){\r \t\t\t\t\t\t\t\tthis._createImage( cell, module, data.text[0] );\r \t\t\t\t\t\t\t}else if( module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\" ){\r \t\t\t\t\t\t\t\tthis._createAttachment( cell, module, data );\r \t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\tvar text = this._getValueText(idx-1, data.text.join(\", \"));\r \t\t\t\t\t\t\t\tif( module.json.type == \"Textarea\"){\r \t\t\t\t\t\t\t\t\tcell.set(\"html\", text);\r \t\t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\t\tcell.set(\"text\", data.text.join(\", \"));\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}else{\r \t\t\t\t\t\t\tif( module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\" ){\r \t\t\t\t\t\t\t\tthis._createNewEditTd(newTr, idx, editorTds[idx].get(\"id\"), data, titleThs.length-1);\r \t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\tvar text = this._getValueText(idx-1, data.text.join(\", \"));\r \t\t\t\t\t\t\t\tthis._createNewEditTd(newTr, idx, editorTds[idx].get(\"id\"), text, titleThs.length-1);\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \t\t\t\t\t}else{\r \t\t\t\t\t\tif (!cell) this._createNewEditTd(newTr, idx, id, \"\", titleThs.length-1);\r \t\t\t\t\t}\r \t\t\t\t}else{\r \t\t\t\t\tif (!cell) this._createNewEditTd(newTr, idx, id, \"\", titleThs.length-1);\r \t\t\t\t}\r \t\t\t\tmodule = null;\r \t\t\t}.bind(this));\r \r \t\t\tnewTr.store(\"data\", griddata);\r \t\t\tnewTr.setStyle(\"display\", \"table-row\");\r \r \t\t\tif (flag){\r \t\t\t\tnewTr.destroy();\r \t\t\t}\r \t\t\tthis.currentEditLine = null;\r \r \t\t\tthis._editorTrGoBack();\r \r \t\t\tif (this.json.contentStyles){\r \t\t\t\tvar tds = newTr.getElements(\"td\");\r \t\t\t\ttds.setStyles(this.json.contentStyles);\r \t\t\t}\r \t\t\tif (this.json.actionStyles){\r \t\t\t\tnewTr.getFirst().setStyles(this.json.actionStyles);\r \t\t\t}\r \r \t\t\tthis._loadBorderStyle();\r \t\t\tthis._loadZebraStyle();\r \t\t\tthis._loadSequence();\r \t\t\tthis.getData();\r \t\t\tthis.validationMode();\r \t\t\tthis.fireEvent(\"completeLineEdit\", [newTr]);\r \r \t\t\tif( saveFlag ){\r \t\t\t\tthis.form.saveFormData();\r \t\t\t}\r \r \t\t\treturn true;\r \t\t},\r \t\t// _createImg : function(cell, module, idx){\r \t\t// \tcell.empty();\r \t\t// \tif( module.node ){\r \t\t// \t\tvar node = module.node.clone();\r \t\t// \t\tnode.set(\"id\", module.json ? (module.json.id +\"_\"+idx) : \"\" );\r \t\t// \t\tnode.inject(cell);\r \t\t// \t}\r \t\t// },\r \t\t_createImg : function(cell, module, idx){\r \t\t\tthis._cloneModule(cell, module, idx);\r \t\t},\r \t\t_createLabel : function(cell, module, idx){\r \t\t\tthis._cloneModule(cell, module, idx);\r \t\t},\r \t\t_createButton : function(cell, module, idx){\r \t\t\tthis._cloneModule(cell, module, idx);\r \t\t},\r \t\t_cloneModule : function(cell, module, idx){\r \t\t\tdebugger;\r \t\t\tcell.empty();\r \t\t\tif( module.node &amp;&amp; module.json ){\r \t\t\t\tvar json = Object.clone( module.json );\r \t\t\t\tjson.id = json.id +\"_\"+idx;\r \r \t\t\t\tvar node = module.node.clone();\r \t\t\t\tnode.set(\"id\", json.id);\r \t\t\t\tnode.inject(cell);\r \r \t\t\t\tthis.form._loadModule(json, node)\r \t\t\t}\r \t\t},\r \t\t_createImage : function( cell, module, data ){\r \t\t\tcell.empty();\r \t\t\tif( !data )return;\r \t\t\tvar img = new Element(\"img\",{\r \t\t\t\tsrc : MWF.xDesktop.getImageSrc( data )\r \t\t\t}).inject( cell, \"top\" );\r \t\t\tif( module.json.clipperType == \"size\" ){\r \t\t\t\tvar width = module.json.imageWidth;\r \t\t\t\tvar height = module.json.imageHeight;\r \t\t\t\tif (width &amp;&amp; height) {\r \t\t\t\t\timg.setStyles({\r \t\t\t\t\t\twidth: width + \"px\",\r \t\t\t\t\t\theight: height + \"px\"\r \t\t\t\t\t})\r \t\t\t\t}\r \t\t\t}\r \t\t},\r \t\t_createAttachment: function ( cell, module, data ){\r \t\t\tcell.empty();\r \t\t\tvar options = {\r \t\t\t\t\"style\": module.json.style || \"default\",\r \t\t\t\t\"title\": \"附件区域\",\r \t\t\t\t\"listStyle\": module.json.dg_listStyle || \"icon\",\r \t\t\t\t\"size\": module.json.dg_size || \"min\",\r \t\t\t\t\"resize\": (module.json.dg_resize === \"y\" || this.json.dg_resize === \"true\"),\r \t\t\t\t\"attachmentCount\": 0,\r \t\t\t\t\"isUpload\": false,\r \t\t\t\t\"isDelete\": false,\r \t\t\t\t\"isReplace\": false,\r \t\t\t\t\"isDownload\": true,\r \t\t\t\t\"isSizeChange\": (module.json.dg_isSizeChange === \"y\" || module.json.dg_isSizeChange === \"true\"),\r \t\t\t\t\"readonly\": true,\r \t\t\t\t\"availableListStyles\": module.json.dg_availableListStyles ? module.json.dg_availableListStyles : [\"list\", \"seq\", \"icon\", \"preview\"],\r \t\t\t\t\"isDeleteOption\": \"n\",\r \t\t\t\t\"isReplaceOption\": \"n\",\r \t\t\t\t\"toolbarGroupHidden\": module.json.dg_toolbarGroupHidden || []\r \t\t\t};\r \t\t\tif (this.readonly) options.readonly = true;\r \t\t\tif(!this.editable &amp;&amp; !this.addable)options.readonly = true;\r \r \t\t\tvar atts = [];\r \t\t\t( data || [] ).each(function(d){\r \t\t\t\tvar att = module.attachmentController.attachments.find(function(a){\r \t\t\t\t\treturn d.id == a.data.id;\r \t\t\t\t});\r \t\t\t\tif (att) module.attachmentController.removeAttachment(att);\r \t\t\t});\r \t\t\tmodule.setAttachmentBusinessData();\r \r \r \t\t\tvar attachmentController = new MWF.xApplication.process.Xform.AttachmentController(cell, module, options);\r \t\t\tattachmentController.load();\r \r \t\t\t( data || [] ).each(function (att) {\r \t\t\t\tvar attachment = this.form.businessData.attachmentList.find(function(a){\r \t\t\t\t\treturn a.id==att.id;\r \t\t\t\t});\r \t\t\t\tvar attData = attachment || att;\r \t\t\t\t//if (att.site===this.json.id || (this.json.isOpenInOffice &amp;&amp; this.json.officeControlName===att.site)) this.attachmentController.addAttachment(att);\r \t\t\t\tattachmentController.addAttachment(attData);\r \t\t\t}.bind(this));\r \t\t},\r \t\t_editorTrGoBack: function(){\r \t\t\tthis.editorTr.setStyle(\"display\", \"none\");\r //\t\tthis.editTr.removeEvents(\"blur\");\r \t\t\tif (this.totalTr){\r \t\t\t\tthis.editorTr.inject(this.totalTr, \"before\");\r \t\t\t}else{\r \t\t\t\tvar lastTrs = this.table.getElements(\"tr\");\r \t\t\t\tvar lastTr = lastTrs[lastTrs.length-1];\r \t\t\t\tthis.editorTr.inject(lastTr, \"after\");\r \t\t\t}\r \t\t},\r \t\t_addLine: function(node){\r \t\t\tif (this.isEdit){\r \t\t\t\tif (!this._completeLineEdit()) return false;\r \t\t\t}\r \t\t\tthis.editorTr.setStyles({\r \t\t\t\t//\"background-color\": \"#fffeb5\",\r \t\t\t\t\"display\": \"table-row\"\r \t\t\t});\r \t\t\tthis.currentEditLine = null;\r \t\t\tvar currentTr = node.getParent(\"tr\");\r \t\t\tif (currentTr){\r \t\t\t\tthis.editorTr.inject(currentTr, \"after\");\r \t\t\t}\r \t\t\tthis.isEdit =true;\r \t\t\tthis.validationMode();\r \t\t\tthis.fireEvent(\"addLine\",[this.editorTr]);\r //\t\tnewTr.addEvent(\"blur\", function(e){\r //\t\t\tthis._completeLineEdit();\r //\t\t}.bind(this));\r \t\t},\r \t\t_deleteLine: function(e){\r \t\t\tvar saveFlag = false;\r \t\t\tvar currentTr = e.target.getParent(\"tr\");\r \t\t\tif (currentTr){\r \t\t\t\tvar color = currentTr.getStyle(\"background\");\r \t\t\t\tcurrentTr.store(\"bgcolor\", color);\r \t\t\t\tcurrentTr.tween(\"background-color\", \"#ffd4d4\");\r \t\t\t\tvar datagrid = this;\r \t\t\t\tvar _self = this;\r \t\t\t\tthis.form.confirm(\"warn\", e, MWF.xApplication.process.Xform.LP.deleteDatagridLineTitle, MWF.xApplication.process.Xform.LP.deleteDatagridLine, 300, 120, function(){\r \t\t\t\t\t_self.fireEvent(\"deleteLine\", [currentTr]);\r \r \t\t\t\t\tvar data = currentTr.retrieve(\"data\");\r \r \t\t\t\t\t//var attKeys = [];\r \t\t\t\t\tvar titleThs = _self.titleTr.getElements(\"th\");\r \t\t\t\t\ttitleThs.each(function(th, i){\r \t\t\t\t\t\tvar key = th.get(\"id\");\r \t\t\t\t\t\tvar module = (i>0) ? _self.editModules[i-1] : null;\r \t\t\t\t\t\tif (key &amp;&amp; module &amp;&amp; (module.json.type==\"Attachment\" || module.json.type==\"AttachmentDg\")){\r \t\t\t\t\t\t\tdata[key][module.json.id].each(function(d){\r \t\t\t\t\t\t\t\t_self.form.workAction.deleteAttachment(d.id, _self.form.businessData.work.id);\r \t\t\t\t\t\t\t});\r \t\t\t\t\t\t\tsaveFlag = true;\r \t\t\t\t\t\t}\r \t\t\t\t\t});\r \r \t\t\t\t\tcurrentTr.destroy();\r \t\t\t\t\tdatagrid._loadZebraStyle();\r \t\t\t\t\tdatagrid._loadSequence();\r \t\t\t\t\tdatagrid._loadTotal();\r \t\t\t\t\tdatagrid.getData();\r \t\t\t\t\tthis.close();\r \r \t\t\t\t\t_self.fireEvent(\"afterDeleteLine\");\r \r \t\t\t\t\tif(saveFlag){\r \t\t\t\t\t\t_self.form.saveFormData();\r \t\t\t\t\t}\r \t\t\t\t}, function(){\r \t\t\t\t\tvar color = currentTr.retrieve(\"bgcolor\");\r \t\t\t\t\tcurrentTr.tween(\"background\", color);\r \t\t\t\t\tthis.close();\r \t\t\t\t}, null, null, this.form.json.confirmStyle);\r \t\t\t}\r \t\t\tthis.validationMode();\r \t\t},\r \t\t_createMoveLineAction: function(td){\r \t\t\tvar moveLineAction = new Element(\"div\", {\r \t\t\t\t\"styles\": this.form.css.moveLineAction,\r \t\t\t\t\"events\": {\r \t\t\t\t\t\"mousedown\": function(e){\r \t\t\t\t\t\tthis._moveLine(e);\r \t\t\t\t\t}.bind(this)\r \t\t\t\t}\r \t\t\t});\r \t\t\tmoveLineAction.inject(td);\r \t\t},\r \t\t_getMoveDragNode: function(tr){\r \t\t\tvar table = tr.getParent(\"table\");\r \t\t\tvar div = table.getParent(\"div\");\r \t\t\tvar size = div.getSize();\r \t\t\tvar dragNode = div.clone().setStyle(\"width\", size.x).inject(document.body);\r \t\t\tvar dragtable = dragNode.getElement(\"table\");\r \t\t\tdragtable.empty();\r \r \t\t\tvar clone = tr.clone().setStyles(this.form.css.gridMoveLineDragNodeTr).inject(dragtable);\r \t\t\tvar tds = tr.getElements(\"td\");\r \t\t\tvar clonetds = clone.getElements(\"td\");\r \t\t\ttds.each(function(td, idx){\r \t\t\t\tvar size = td.getComputedSize();\r \t\t\t\tclonetds[idx].setStyle(\"width\", size.width+1);\r \t\t\t});\r \r \t\t\tvar coordinates = tr.getCoordinates();\r \t\t\tdragNode.setStyles(this.form.css.gridMoveLineDragNode);\r \t\t\tdragNode.setStyles(coordinates);\r \r \t\t\treturn dragNode;\r \t\t},\r \t\t_moveLine: function(e){\r \t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\tvar div = e.target;\r \t\t\tvar tr = div.getParent(\"tr\");\r \r \t\t\tvar dragNode = this._getMoveDragNode(tr);\r \t\t\tcoordinates = dragNode.getCoordinates();\r \t\t\tvar dragTr = dragNode.getElement(\"tr\");\r \t\t\tvar dragTable = dragNode.getElement(\"table\");\r \r \t\t\tvar color = tr.getStyle(\"background\");\r \t\t\ttr.store(\"bgcolor\", color);\r \t\t\t//tr.tween('background-color', '#f3f1ad');\r \t\t\ttr.tween('background-color', '#e4f6e9');\r \r \r \t\t\tvar drag = new Drag.Move(dragNode, {\r \t\t\t\t\"droppables\": trs.erase(tr),\r \t\t\t\t\"limit\": {\"x\": [coordinates.left, coordinates.left]},\r \t\t\t\tonDrop: function(dragging, droppable){\r \t\t\t\t\tdragging.destroy();\r \t\t\t\t\t//debugger;\r \t\t\t\t\tvar color = tr.retrieve(\"bgcolor\");\r \t\t\t\t\tif (color){\r \t\t\t\t\t\ttr.tween(\"background\", color);\r \t\t\t\t\t}else{\r \t\t\t\t\t\ttr.tween(\"background\", \"transparent\");\r \t\t\t\t\t}\r \t\t\t\t\t//if (droppable){\r \t\t\t\t\t// color = droppable.retrieve(\"bgcolor\");\r \t\t\t\t\t// if (color){\r \t\t\t\t\t// droppable.tween(\"background\", color);\r \t\t\t\t\t// }else{\r \t\t\t\t\t// droppable.tween(\"background\", \"transparent\");\r \t\t\t\t\t// }\r \t\t\t\t\t//}\r \r \t\t\t\t\ttr.setStyle(\"display\", \"table-row\");\r \t\t\t\t\tif (droppable != null){\r \t\t\t\t\t\ttr.inject(dragTr, \"after\");\r \t\t\t\t\t\tdragTr.destroy();\r \t\t\t\t\t\t//this._loadZebraStyle();\r \t\t\t\t\t\t//this._loadSequence();\r \t\t\t\t\t\t//this._loadTotal();\r \t\t\t\t\t\tthis._loadDatagridStyle();\r \t\t\t\t\t\tthis.getData();\r \t\t\t\t\t}\r \r \t\t\t\t}.bind(this),\r \t\t\t\t\"onEnter\": function(dragging, drop){\r \t\t\t\t\t//var color = drop.getStyle(\"background\");\r \t\t\t\t\t//if (color.toUpperCase()!='#d1eaf3') drop.store(\"bgcolor\", color);\r \t\t\t\t\t//drop.tween(\"background-color\", \"#d1eaf3\");\r \t\t\t\t\tdragNode.setStyle(\"display\", \"none\");\r \t\t\t\t\tdragTr.inject(drop, \"after\");\r \t\t\t\t},\r \t\t\t\t\"onLeave\": function(dragging, drop){\r \t\t\t\t\t//var color = drop.retrieve(\"bgcolor\");\r \t\t\t\t\t//if (color){\r \t\t\t\t\t//\tdrop.tween(\"background\", color);\r \t\t\t\t\t//}else{\r \t\t\t\t\t//\tdrop.tween(\"background\", \"transparent\");\r \t\t\t\t\t//}\r \t\t\t\t\tdragTr.inject(dragTable);\r \t\t\t\t\tdragNode.setStyle(\"display\", \"block\");\r //\t\t\t\ttr.setStyle(\"display\", \"table-row\");\r \t\t\t\t},\r \t\t\t\t\"ondrag\": function(){\r \t\t\t\t\tthis.table.setStyle(\"cursor\", \"move\");\r \t\t\t\t\tdragNode.setStyle(\"cursor\", \"move\");\r \t\t\t\t},\r \t\t\t\t\"onCancel\": function(dragging){\r \t\t\t\t\tdragging.destroy();\r \t\t\t\t\tvar color = tr.retrieve(\"bgcolor\");\r \t\t\t\t\tif (color){\r \t\t\t\t\t\ttr.tween(\"background\", color);\r \t\t\t\t\t}else{\r \t\t\t\t\t\ttr.tween(\"background\", \"transparent\");\r \t\t\t\t\t}\r \t\t\t\t\ttr.setStyle(\"display\", \"table-row\");\r \t\t\t\t}\r \t\t\t});\r \t\t\tdrag.start(e);\r \t\t\ttr.setStyle(\"display\", \"none\");\r \t\t},\r \t\t_loadReadDatagrid: function(callback){\r \t\t\tvar p = o2.promiseAll(this.gridData).then(function(v){\r \t\t\t\tthis.gridData = v;\r \t\t\t\tif (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r \t\t\t\tthis.__loadReadDatagrid(callback);\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t\treturn v;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \t\t\tthis.moduleValueAG = p;\r \t\t\tif (this.moduleValueAG) this.moduleValueAG.then(function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \r \t\t\t// if (this.gridData &amp;&amp; this.gridData.isAG){\r \t\t\t// \tthis.moduleValueAG = this.gridData;\r \t\t\t// \tthis.gridData.addResolve(function(v){\r \t\t\t// \t\tthis.gridData = v;\r \t\t\t// \t\tthis._loadReadDatagrid(callback);\r \t\t\t// \t}.bind(this));\r \t\t\t// }else{\r \t\t\t// \tif (o2.typeOf(this.gridData)==\"array\") this.gridData = {\"data\": this.gridData};\r \t\t\t// \tthis.__loadReadDatagrid(callback);\r \t\t\t// \tthis.moduleValueAG = null;\r \t\t\t// }\r \t\t},\r \r \t\t__loadReadDatagrid: function(callback){\r \t\t\t//this.gridData = this._getValue();\r \t\t\tif (!this.titleTr) this._getDatagridTitleTr();\r \t\t\t//var titleTr = this.table.getElement(\"tr\");\r \t\t\tvar titleHeaders = this.titleTr.getElements(\"th\");\r \r \t\t\tvar lastTrs = this.table.getElements(\"tr\");\r \t\t\tvar lastTr = lastTrs[lastTrs.length-1];\r \t\t\t//var tds = lastTr.getElements(\"td\");\r \r \t\t\tdebugger;\r \r \t\t\tif (this.gridData.data){\r \t\t\t\tthis.gridData.data.each(function(data, idx){\r \t\t\t\t\tvar tr = this.table.insertRow(idx+1);\r \t\t\t\t\ttr.store(\"data\", data);\r \r \t\t\t\t\ttitleHeaders.each(function(th, index){\r \t\t\t\t\t\tvar cell = tr.insertCell(index);\r \t\t\t\t\t\t// cell.set(\"MWFId\", tds[index].get(\"id\"));\r \t\t\t\t\t\tvar cellData = data[th.get(\"id\")];\r \r \t\t\t\t\t\tvar module = this.editModules[index];\r \t\t\t\t\t\tif( typeOf( cellData ) !== \"array\" ){\r \t\t\t\t\t\t\tif (cellData) {\r \t\t\t\t\t\t\t\tfor (key in cellData) {\r \t\t\t\t\t\t\t\t\tvar v = cellData[key];\r \t\t\t\t\t\t\t\t\tif (module &amp;&amp; module.json.type == \"ImageClipper\") {\r \t\t\t\t\t\t\t\t\t\tthis._createImage(cell, module, v);\r \t\t\t\t\t\t\t\t\t} else if (module &amp;&amp; (module.json.type == \"Attachment\" || module.json.type == \"AttachmentDg\")) {\r \t\t\t\t\t\t\t\t\t\tthis._createAttachment(cell, module, v);\r \t\t\t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\t\t\tvar text = this._getValueText(index, v);\r \t\t\t\t\t\t\t\t\t\tif (module &amp;&amp; module.json.type == \"Textarea\") {\r \t\t\t\t\t\t\t\t\t\t\tcell.set(\"html\", text);\r \t\t\t\t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\t\t\t\tcell.set(\"text\", text);\r \t\t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t}else if( module &amp;&amp; module.json.type == \"Image\" ) {\r \t\t\t\t\t\t\t\tthis._createImg(cell, module, idx);\r \t\t\t\t\t\t\t}else if( module &amp;&amp; module.json.type == \"Button\" ) {\r \t\t\t\t\t\t\t\tthis._createButton(cell, module, idx);\r \t\t\t\t\t\t\t}else if( module &amp;&amp; module.json.type == \"Label\" ) {\r \t\t\t\t\t\t\t\tthis._createLabel(cell, module, idx);\r \t\t\t\t\t\t\t}else if( module &amp;&amp; module.json.type == \"sequence\" ){ //Sequence\r \t\t\t\t\t\t\t\tcell.setStyle(\"text-align\", \"center\");\r \t\t\t\t\t\t\t\tcell.set(\"text\", tr.rowIndex);\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \r \r \t\t\t\t\t\tvar json = this.form._getDomjson(th);\r \t\t\t\t\t\tif( json &amp;&amp; json.isShow === false )cell.hide();\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}.bind(this));\r \t\t\t}\r \t\t\tthis._loadTotal();\r \r \t\t\tif (callback) callback();\r \t\t},\r \r \t\t_loadImportExportAction: function(){\r \t\t\tdebugger;\r \t\t\tthis.impexpNode = this.node.getElement(\"div.impexpNode\");\r \t\t\tif( this.impexpNode )this.impexpNode.destroy();\r \t\t\tthis.impexpNode = null;\r \r \t\t\tif( !this.exportenable &amp;&amp; !this.importenable )return;\r \r \t\t\tvar position = [\"leftTop\",\"centerTop\",\"rightTop\"].contains( this.json.impexpPosition || \"\" ) ? \"top\" : \"bottom\";\r \t\t\tvar container = new Element(\"div\").inject(this.node, position);\r \r \t\t\tthis.importExportAreaNode = new Element(\"div\").inject( container );\r \t\t\tif( [\"leftTop\",\"leftBottom\"].contains( this.json.impexpPosition || \"\" ) ){\r \t\t\t\tthis.importExportAreaNode.setStyles({ \"float\" : \"left\" })\r \t\t\t}else if( [\"rightTop\",\"rightBottom\"].contains( this.json.impexpPosition || \"\" ) ){\r \t\t\t\tthis.importExportAreaNode.setStyles({ \"float\" : \"right\" })\r \t\t\t}else{\r \t\t\t\tthis.importExportAreaNode.setStyles({ \"margin\" : \"0px auto\" })\r \t\t\t}\r \r \t\t\tif( this.exportenable ){\r \t\t\t\tthis.exportActionNode = new Element(\"div\", {\r \t\t\t\t\ttext : this.json.exportActionText || MWF.xApplication.process.Xform.LP.datagridExport\r \t\t\t\t}).inject(this.importExportAreaNode);\r \t\t\t\tvar styles;\r \t\t\t\tif( this.json.exportActionStyles ){\r \t\t\t\t\tstyles = this.json.exportActionStyles\r \t\t\t\t}else{\r \t\t\t\t\tstyles = this.form.css.gridExportActionStyles;\r \t\t\t\t}\r \t\t\t\tthis.exportActionNode.setStyles(styles);\r \r \t\t\t\tthis.exportActionNode.addEvent(\"click\", function () {\r \t\t\t\t\tthis.exportToExcel();\r \t\t\t\t}.bind(this))\r \t\t\t}\r \r \t\t\tif( this.importenable ){\r \t\t\t\tthis.importActionNode = new Element(\"div\", {\r \t\t\t\t\ttext : this.json.importActionText || MWF.xApplication.process.Xform.LP.datagridImport\r \t\t\t\t}).inject(this.importExportAreaNode);\r \t\t\t\tvar styles;\r \t\t\t\tif( this.json.importActionStyles ){\r \t\t\t\t\tstyles = this.json.importActionStyles;\r \t\t\t\t}else{\r \t\t\t\t\tstyles = this.form.css.gridImportActionStyles;\r \t\t\t\t}\r \t\t\t\tthis.importActionNode.setStyles(styles);\r \r \t\t\t\tthis.importActionNode.addEvent(\"click\", function () {\r \t\t\t\t\tthis.importFromExcel();\r \t\t\t\t}.bind(this))\r \t\t\t}\r \r \t\t\tif( [\"centerTop\",\"centerBottom\"].contains( this.json.impexpPosition ) ){\r \t\t\t\tvar width = 2;\r \r \t\t\t\tif( this.exportActionNode ){\r \t\t\t\t\twidth = width + this.exportActionNode.getSize().x +\r \t\t\t\t\t\tthis.exportActionNode.getStyle(\"padding-left\").toFloat() +\r \t\t\t\t\t\t+ this.exportActionNode.getStyle(\"padding-right\").toFloat() +\r \t\t\t\t\t\t+ this.exportActionNode.getStyle(\"margin-left\").toFloat() +\r \t\t\t\t\t\t+ this.exportActionNode.getStyle(\"margin-right\").toFloat()\r \t\t\t\t}\r \r \t\t\t\tif( this.importActionNode ){\r \t\t\t\t\twidth = width + this.importActionNode.getSize().x +\r \t\t\t\t\t\tthis.importActionNode.getStyle(\"padding-left\").toFloat() +\r \t\t\t\t\t\t+ this.importActionNode.getStyle(\"padding-right\").toFloat() +\r \t\t\t\t\t\t+ this.importActionNode.getStyle(\"margin-left\").toFloat() +\r \t\t\t\t\t\t+ this.importActionNode.getStyle(\"margin-right\").toFloat()\r \t\t\t\t}\r \r \t\t\t\tthis.importExportAreaNode.setStyle( \"width\", width+\"px\" );\r \t\t\t}\r \t\t},\r \r \t\t_loadDatagridStyle: function(){\r \t\t\t//var ths = this.titleTr.getElements(\"th\");\r \t\t\t//ths.setStyles(this.form.css.datagridTitle);\r \t\t\tthis.loadGridTitleStyle();\r \t\t\tthis.loadGridContentStyle();\r \t\t\tthis.loadGridActionStyle();\r \t\t\tthis.loadGridEditStyle();\r \r \t\t\tthis._loadTotal();\r \t\t\tthis._loadBorderStyle();\r \t\t\tthis._loadZebraStyle();\r \t\t\tthis._loadSequence();\r \t\t},\r \t\tloadGridEditStyle: function(){\r \t\t\tif (this.editorTr){\r \t\t\t\tif (this.json.editStyles){\r \t\t\t\t\tvar tds = this.editorTr.getElements(\"td\");\r \t\t\t\t\ttds.setStyles(this.json.editStyles);\r \t\t\t\t}\r \t\t\t}\r \t\t},\r \t\tloadGridActionStyle: function(){\r \t\t\tif (this.editable!=false){\r \t\t\t\tif (this.json.actionStyles){\r \t\t\t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\t\t\ttrs.each(function(tr, idx){\r \t\t\t\t\t\tif (idx != 0) tr.getFirst().setStyles(this.json.actionStyles);\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}\r \t\t\t}\r \t\t},\r \t\tloadGridTitleStyle: function(){\r \t\t\tif (this.json.titleStyles){\r \t\t\t\tvar ths = this.titleTr.getElements(\"th\");\r \t\t\t\tths.setStyles(this.json.titleStyles);\r \t\t\t}\r \t\t},\r \t\tloadGridContentStyle: function(){\r \t\t\tif (this.json.contentStyles){\r \t\t\t\tvar tds = this.table.getElements(\"td\");\r \t\t\t\ttds.setStyles(this.json.contentStyles);\r \t\t\t}\r \t\t},\r \r \t\t_loadZebraStyle: function(){\r \t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\tfor (var i=1; i&lt;trs.length; i++){\r \t\t\t\tif (!trs[i].hasClass(\"datagridTotalTr\")){\r \t\t\t\t\tif (this.json.backgroundColor) trs[i].setStyle(\"background-color\", this.json.backgroundColor);\r \t\t\t\t\tif ((i%2)==0){\r \t\t\t\t\t\tif (this.json.zebraColor) trs[i].setStyle(\"background-color\", this.json.zebraColor);\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t}\r \t\t},\r \t\tcreateTotalTr: function(){\r \t\t\tvar trs = this.node.getElements(\"tr\");\r \t\t\tvar lastTr = trs[trs.length-1];\r \t\t\tthis.totalTr = new Element(\"tr.datagridTotalTr\", {\"styles\": this.form.css.datagridTotalTr}).inject(lastTr, \"after\");\r \t\t\tvar ths = this.node.getElements(\"th\");\r \t\t\tths.each(function(th, idx){\r \t\t\t\tvar td = new Element(\"td\", {\"text\": \"\", \"styles\": this.form.css.datagridTotalTd}).inject(this.totalTr);\r \t\t\t\tif (this.json.amountStyles) td.setStyles(this.json.amountStyles);\r \r \t\t\t\tvar json = this.form._getDomjson(th);\r \t\t\t\tif( json &amp;&amp; json.isShow === false )td.hide();\r \t\t\t}.bind(this));\r \t\t},\r \t\t_loadTotal: function(){\r \t\t\tvar data = {};\r \t\t\tthis.totalResaults = {};\r \t\t\tif (this.totalModules.length){\r \t\t\t\tif (!this.totalTr){\r \t\t\t\t\tthis.createTotalTr();\r \t\t\t\t}\r \r \t\t\t\tvar totalResaults = [];\r \t\t\t\t//this.totalModules.each(function(m. i){\r \t\t\t\t// totalResaults.push(0);\r \t\t\t\t//}.bind(this));\r \r \t\t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\t\tvar totalTds = this.totalTr.getElements(\"td\");\r \r \t\t\t\tfor (var i=1; i&lt;trs.length; i++){\r \t\t\t\t\tif (!trs[i].hasClass(\"datagridTotalTr\") &amp;&amp; (!trs[i].hasClass(\"datagridEditorTr\"))){\r \t\t\t\t\t\tvar cells = trs[i].getElements(\"td\");\r \r \t\t\t\t\t\tthis.totalModules.each(function(m, i){\r \t\t\t\t\t\t\tif (!totalResaults[i]) totalResaults.push(0);\r \t\t\t\t\t\t\tvar tmpV = new Decimal(totalResaults[i]);\r \t\t\t\t\t\t\tif (m.type==\"number\"){\r \t\t\t\t\t\t\t\tvar cell = cells[m.index];\r \t\t\t\t\t\t\t\tvar addv = cell.get(\"text\").toFloat();\r \t\t\t\t\t\t\t\ttmpV = tmpV.plus(addv||0);\r \t\t\t\t\t\t\t\t//tmpV = tmpV + addv;\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\tif (m.type==\"count\"){\r \t\t\t\t\t\t\t\ttmpV = tmpV.plus(1);\r \t\t\t\t\t\t\t\t//tmpV = tmpV+1;\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\ttotalResaults[i] = tmpV.toString();\r \t\t\t\t\t\t\tdata[m.module.json.id] = totalResaults[i];\r \r \t\t\t\t\t\t}.bind(this));\r \t\t\t\t\t}\r \t\t\t\t}\r \r \t\t\t\tthis.totalModules.each(function(m, i){\r \t\t\t\t\tthis.totalResaults[m.module.json.id] = totalResaults[i];\r \t\t\t\t\tvar td = totalTds[m.index];\r \t\t\t\t\ttd.set(\"text\", isNaN( totalResaults[i] ) ? \"\" : totalResaults[i] );\r \t\t\t\t}.bind(this));\r \t\t\t}\r \t\t\treturn data;\r \t\t},\r \t\t_loadSequence: function(){\r \t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\tfor (var i=1; i&lt;trs.length; i++){\r \t\t\t\tvar cells = trs[i].getElements(\"td\");\r \t\t\t\tcells.each(function(cell){\r \t\t\t\t\tvar module = cell.retrieve(\"module\");\r \t\t\t\t\tif (module){\r \t\t\t\t\t\tif (module.json.cellType==\"sequence\"){\r \t\t\t\t\t\t\tcell.set(\"text\", i)\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \t\t\t\t}.bind(this));\r \t\t\t}\r \t\t},\r \r \t\t_loadBorderStyle: function(){\r \t\t\tif (this.json.border){\r \t\t\t\tthis.table.setStyles({\r \t\t\t\t\t\"border-top\": this.json.border,\r \t\t\t\t\t\"border-left\": this.json.border\r \t\t\t\t});\r \t\t\t\tvar ths = this.table.getElements(\"th\");\r \t\t\t\tths.setStyles({\r \t\t\t\t\t\"border-bottom\": this.json.border,\r \t\t\t\t\t\"border-right\": this.json.border\r \t\t\t\t});\r \t\t\t\tvar tds = this.table.getElements(\"td\");\r \t\t\t\ttds.setStyles({\r \t\t\t\t\t\"border-bottom\": this.json.border,\r \t\t\t\t\t\"border-right\": this.json.border,\r \t\t\t\t\t\"background\": \"transparent\"\r \t\t\t\t});\r \t\t\t}\r \t\t},\r \t\t_loadDatagridTitleModules: function(){\r \t\t\tvar ths = this.node.getElements(\"th\");\r \t\t\tths.each(function(th){\r \t\t\t\tvar json = this.form._getDomjson(th);\r \t\t\t\tth.store(\"dataGrid\", this);\r \t\t\t\tif (json){\r \t\t\t\t\tvar module = this.form._loadModule(json, th);\r \t\t\t\t\tthis.form.modules.push(module);\r \t\t\t\t\tif( json.isShow === false )th.hide();\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t},\r \t\t_loadDatagridDataModules: function(){\r \t\t\tvar tds = this.node.getElements(\"td\");\r \t\t\ttds.each(function(td){\r \t\t\t\tvar json = this.form._getDomjson(td);\r \t\t\t\ttd.store(\"dataGrid\", this);\r \t\t\t\tif (json){\r \t\t\t\t\tvar isField = false;\r \t\t\t\t\tvar module = this.form._loadModule(json, td, function(){\r \t\t\t\t\t\tisField = this.field;\r \t\t\t\t\t\tthis.field = false;\r \t\t\t\t\t});\r \t\t\t\t\tif( isField ){\r \t\t\t\t\t\tmodule.node.setStyle(\"padding-right\",\"0px\");\r \t\t\t\t\t}\r \t\t\t\t\ttd.store(\"module\", module);\r \t\t\t\t\tthis.form.modules.push(module);\r \t\t\t\t\tif( json.isShow === false )td.hide();\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t},\r \t\t_afterLoaded: function(){\r \t\t\tif (this.moduleValueAG){\r \t\t\t\tthis.moduleValueAG.then(function(){\r \t\t\t\t\tthis._loadDatagridStyle();\r \t\t\t\t}.bind(this));\r \t\t\t}else{\r \t\t\t\tthis._loadDatagridStyle();\r \t\t\t}\r \t\t},\r \t\t/**\r \t\t * @summary 重置数据网格的值为默认值或置空。\r \t\t * @example\r \t\t * this.form.get('fieldId').resetData();\r \t\t */\r \t\tresetData: function(){\r \t\t\tthis.setData(this._getValue());\r \t\t},\r \t\t/**当参数为Promise的时候，请查看文档: {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0|使用Promise处理表单异步}&lt;br/>\r \t\t * 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。\r \t\t * @summary 为数据网格赋值。\r \t\t * @param data{DatagridData|Promise|Array} 必选，数组或Promise.\r \t\t * @example\r \t\t * this.form.get(\"fieldId\").setData([]); //赋空值\r \t\t * @example\r \t\t * //如果无法确定表单上是否有组件，需要判断\r \t\t * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r \t\t * this.form.get('fieldId').setData( data );\r \t\t * }else{\r \t\t * this.data['fieldId'] = data;\r \t\t * }\r \t\t *@example\r \t\t * //使用Promise\r \t\t * var field = this.form.get(\"fieldId\");\r \t\t * var promise = new Promise(function(resolve, reject){ //发起异步请求\r \t\t * var oReq = new XMLHttpRequest();\r \t\t * oReq.addEventListener(\"load\", function(){ //绑定load事件\r \t\t * resolve(oReq.responseText);\r \t\t * });\r \t\t * oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r \t\t * oReq.send();\r \t\t * });\r \t\t * promise.then( function(){\r \t\t * var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r \t\t * })\r \t\t * field.setData( promise );\r \t\t */\r \t\tsetData: function(data){\r \t\t\tif (!data){\r \t\t\t\tdata = this._getValue();\r \t\t\t}\r \t\t\tthis._setData(data);\r \t\t},\r \t\t_setData: function(data){\r \t\t\tvar p = o2.promiseAll(this.data).then(function(v){\r \t\t\t\tthis.gridData = v;\r \t\t\t\tif (o2.typeOf(data)==\"array\") data = {\"data\": data};\r \t\t\t\tthis.__setData(data);\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t\treturn v;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \t\t\tthis.moduleValueAG = p;\r \t\t\tif (this.moduleValueAG) this.moduleValueAG.then(function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \r \t\t\t// if (data &amp;&amp; data.isAG){\r \t\t\t// \tthis.moduleValueAG = data;\r \t\t\t// \tdata.addResolve(function(v){\r \t\t\t// \t\tthis._setData(v);\r \t\t\t// \t}.bind(this));\r \t\t\t// }else{\r \t\t\t// \tif (o2.typeOf(data)==\"array\") data = {\"data\": data};\r \t\t\t// \tthis.__setData(data);\r \t\t\t// \tthis.moduleValueAG = null;\r \t\t\t// }\r \t\t},\r \t\t__setData: function(data){\r \t\t\t// if( typeOf( data ) === \"object\" &amp;&amp; typeOf(data.data) === \"array\" ){\r \t\t\tthis._setBusinessData(data);\r \t\t\tthis.gridData = data;\r \r \t\t\t// if (this.isEdit) this._completeLineEdit();\r \t\t\tif( this.isEdit ){ //如果有在编辑的，取消编辑行\r \t\t\t\tif (this.currentEditLine) {\r \t\t\t\t\tthis.currentEditLine.setStyle(\"display\", \"table-row\");\r \t\t\t\t}\r \t\t\t\tthis.isEdit = false;\r \t\t\t\tthis.currentEditLine = null;\r \t\t\t\tthis._editorTrGoBack();\r \t\t\t}\r \r \t\t\tif (this.gridData){\r \t\t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\t\tfor (var i=1; i&lt;trs.length-1; i++){\r \t\t\t\t\tvar tr = trs[i];\r \t\t\t\t\tif( tr.hasClass(\"datagridEditorTr\") )continue;\r \t\t\t\t\tvar tds = tr.getElements(\"td\");\r \t\t\t\t\tfor (var j=0; j&lt;tds.length; j++){\r \t\t\t\t\t\tvar td = tds[j];\r \t\t\t\t\t\tvar module = td.retrieve(\"module\");\r \t\t\t\t\t\tif (module){\r \t\t\t\t\t\t\tthis.form.modules.erase(module);\r \t\t\t\t\t\t\tmodule = null;\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t\tfor (var i=1; i&lt;trs.length-1; i++){\r \t\t\t\t\tif( trs[i].hasClass(\"datagridTotalTr\") )continue;\r \t\t\t\t\tif( trs[i].hasClass(\"datagridEditorTr\") )continue;\r \t\t\t\t\ttrs[i].destroy();\r \t\t\t\t}\r \t\t\t\t//while (this.table.rows.length>2){\r \t\t\t\t//this.table.rows[1].destroy();\r \t\t\t\t//}\r \t\t\t\tif (this.editable!=false){\r \t\t\t\t\tthis._loadEditDatagrid();\r \t\t\t\t\t//this._loadReadDatagrid();\r \t\t\t\t}else{\r \t\t\t\t\tthis._loadReadDatagrid();\r \t\t\t\t}\r \t\t\t\tthis._loadDatagridStyle();\r \t\t\t}\r \t\t},\r \t\t/**\r \t\t * @summary 获取总计数据.\r \t\t * @example\r \t\t * var totalObject = this.form.get('fieldId').getTotal();\r \t\t * @return {Object} 总计数据\r \t\t */\r \t\tgetTotal: function(){\r \t\t\tthis._loadTotal();\r \t\t\treturn this.totalResaults;\r \t\t},\r \t\t/**\r \t\t * @summary 判断数据网格是否为空.\r \t\t * @example\r \t\t * if( this.form.get('fieldId').isEmpty() ){\r \t\t * this.form.notice('至少需要添加一条数据', 'warn');\r \t\t * }\r \t\t * @return {Boolean} 是否为空\r \t\t */\r \t\tisEmpty: function(){\r \t\t\tvar data = this.getData();\r \t\t\tif( !data )return true;\r \t\t\tif( typeOf( data ) === \"object\" ){\r \t\t\t\tif( typeOf( data.data ) !== \"array\" )return true;\r \t\t\t\tif( data.data.length === 0 )return true;\r \t\t\t}\r \t\t\treturn false;\r \t\t},\r \r \t\t/**\r \t\t * 在脚本中使用 this.data[fieldId] 也可以获取组件值。\r \t\t * 区别如下：&lt;br/>\r \t\t * 1、当使用Promise的时候&lt;br/>\r \t\t * 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r \t\t * this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。&lt;br/>\r \t\t * {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0#EggIl|具体差异请查看链接}&lt;br/>\r \t\t * 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。\r \t\t * @summary 获取数据网格数据.\r \t\t * @example\r \t\t * var data = this.form.get('fieldId').getData();\r \t\t *@example\r \t\t * //如果无法确定表单上是否有组件，需要判断\r \t\t * var data;\r \t\t * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r \t\t * data = this.form.get('fieldId').getData();\r \t\t * }else{\r \t\t * data = this.data['fieldId']; //直接从数据中获取字段值\r \t\t * }\r \t\t * @example\r \t\t * //使用Promise\r \t\t * var field = this.form.get(\"fieldId\");\r \t\t * var promise = new Promise(function(resolve, reject){ //发起异步请求\r \t\t * var oReq = new XMLHttpRequest();\r \t\t * oReq.addEventListener(\"load\", function(){ //绑定load事件\r \t\t * resolve(oReq.responseText);\r \t\t * });\r \t\t * oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r \t\t * oReq.send();\r \t\t * });\r \t\t * promise.then( function(){\r \t\t * var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r \t\t * })\r \t\t * field.setData( promise );\r \t\t * @return {DatagridData}\r \t\t */\r \t\tgetData: function(){\r \t\t\tif (this.editable!=false){\r \t\t\t\tif (this.isEdit) this._completeLineEdit();\r \t\t\t\tvar data = [];\r \t\t\t\tvar trs = this.table.getElements(\"tr\");\r \t\t\t\tfor (var i=1; i&lt;trs.length-1; i++){\r \t\t\t\t\tvar tr = trs[i];\r \t\t\t\t\tvar d = tr.retrieve(\"data\");\r \t\t\t\t\tif (d) data.push(d);\r \t\t\t\t}\r \r \t\t\t\tthis.gridData = {};\r \t\t\t\tthis.gridData.data = data;\r \r \t\t\t\tthis._loadTotal();\r \t\t\t\tthis.gridData.total = this.totalResaults;\r \r \t\t\t\tthis._setBusinessData(this.gridData);\r \r \t\t\t\treturn (this.gridData.data.length) ? this.gridData : {data:[]};\r \t\t\t}else{\r \t\t\t\treturn this._getBusinessData();\r \t\t\t}\r \t\t},\r \t\tgetAmount: function(){\r \t\t\treturn this._loadTotal();\r \t\t},\r \t\tcreateErrorNode: function(text){\r \t\t\tvar node = new Element(\"div\");\r \t\t\tvar iconNode = new Element(\"div\", {\r \t\t\t\t\"styles\": {\r \t\t\t\t\t\"width\": \"20px\",\r \t\t\t\t\t\"height\": \"20px\",\r \t\t\t\t\t\"float\": \"left\",\r \t\t\t\t\t\"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r \t\t\t\t}\r \t\t\t}).inject(node);\r \t\t\tvar textNode = new Element(\"div\", {\r \t\t\t\t\"styles\": {\r \t\t\t\t\t\"line-height\": \"20px\",\r \t\t\t\t\t\"margin-left\": \"20px\",\r \t\t\t\t\t\"color\": \"red\",\r \t\t\t\t\t\"word-break\": \"keep-all\"\r \t\t\t\t},\r \t\t\t\t\"text\": text\r \t\t\t}).inject(node);\r \t\t\treturn node;\r \t\t},\r \t\tnotValidationMode: function(text){\r \t\t\tif (!this.isNotValidationMode){\r \t\t\t\tthis.isNotValidationMode = true;\r \t\t\t\tthis.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r \t\t\t\tthis.node.setStyle(\"border\", \"1px solid red\");\r \r \t\t\t\tthis.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r \t\t\t\tthis.showNotValidationMode(this.node);\r \t\t\t}\r \t\t},\r \t\tshowNotValidationMode: function(node){\r \t\t\tvar p = node.getParent(\"div\");\r \t\t\tif (p){\r \t\t\t\tif (p.get(\"MWFtype\") == \"tab$Content\"){\r \t\t\t\t\tif (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r \t\t\t\t\t\tvar contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r \t\t\t\t\t\tvar tabAreaNode = contentAreaNode.getPrevious(\"div\");\r \t\t\t\t\t\tvar idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r \t\t\t\t\t\tvar tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r \t\t\t\t\t\ttabNode.click();\r \t\t\t\t\t\tp = tabAreaNode.getParent(\"div\");\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t\tthis.showNotValidationMode(p);\r \t\t\t}\r \t\t},\r \t\tvalidationMode: function(){\r \t\t\tif (this.isNotValidationMode){\r \t\t\t\tthis.isNotValidationMode = false;\r \t\t\t\tthis.node.setStyles(this.node.retrieve(\"borderStyle\"));\r \t\t\t\tif (this.errNode){\r \t\t\t\t\tthis.errNode.destroy();\r \t\t\t\t\tthis.errNode = null;\r \t\t\t\t}\r \t\t\t}\r \t\t},\r \r \t\tvalidationConfigItem: function(routeName, data){\r \t\t\tvar flag = (data.status==\"all\") ? true: (routeName == data.decision);\r \t\t\tif (flag){\r \t\t\t\tvar n = this.getData();\r \t\t\t\tif( typeOf(n)===\"object\" &amp;&amp; JSON.stringify(n) === JSON.stringify({data:[]}) )n = \"\";\r \t\t\t\tvar v = (data.valueType==\"value\") ? n : n.length;\r \t\t\t\tswitch (data.operateor){\r \t\t\t\t\tcase \"isnull\":\r \t\t\t\t\t\tif (!v){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"notnull\":\r \t\t\t\t\t\tif (v){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"gt\":\r \t\t\t\t\t\tif (v>data.value){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"lt\":\r \t\t\t\t\t\tif (v&lt;data.value){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"equal\":\r \t\t\t\t\t\tif (v==data.value){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"neq\":\r \t\t\t\t\t\tif (v!=data.value){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"contain\":\r \t\t\t\t\t\tif (v.indexOf(data.value)!=-1){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t\tcase \"notcontain\":\r \t\t\t\t\t\tif (v.indexOf(data.value)==-1){\r \t\t\t\t\t\t\tthis.notValidationMode(data.prompt);\r \t\t\t\t\t\t\treturn false;\r \t\t\t\t\t\t}\r \t\t\t\t\t\tbreak;\r \t\t\t\t}\r \t\t\t}\r \t\t\treturn true;\r \t\t},\r \t\tvalidationConfig: function(routeName, opinion){\r \t\t\tif (this.json.validationConfig){\r \t\t\t\tif (this.json.validationConfig.length){\r \t\t\t\t\tfor (var i=0; i&lt;this.json.validationConfig.length; i++) {\r \t\t\t\t\t\tvar data = this.json.validationConfig[i];\r \t\t\t\t\t\tif (!this.validationConfigItem(routeName, data)) return false;\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t\treturn true;\r \t\t\t}\r \t\t\treturn true;\r \t\t},\r \t\t/**\r \t\t * @summary 根据组件的校验设置进行校验。\r \t\t * @param {String} [routeName] - 可选，路由名称.\r \t\t * @example\r \t\t * if( !this.form.get('fieldId').validation() ){\r \t\t * return false;\r \t\t * }\r \t\t * @return {Boolean} 是否通过校验\r \t\t */\r \t\tvalidation: function(routeName, opinion){\r \t\t\tif (this.isEdit){\r \t\t\t\tif (!this.editValidation()){\r \t\t\t\t\treturn false;\r \t\t\t\t}\r \t\t\t}\r \t\t\tif (!this.validationConfig(routeName, opinion)) return false;\r \r \t\t\tif (!this.json.validation) return true;\r \t\t\tif (!this.json.validation.code) return true;\r \r \t\t\tthis.currentRouteName = routeName;\r \t\t\tvar flag = this.form.Macro.exec(this.json.validation.code, this);\r \t\t\tthis.currentRouteName = \"\";\r \r \t\t\tif (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r \t\t\tif (flag.toString()!=\"true\"){\r \t\t\t\tthis.notValidationMode(flag);\r \t\t\t\treturn false;\r \t\t\t}\r \t\t\treturn true;\r \t\t},\r \t\tgetAttachmentRandomSite: function(){\r \t\t\tvar i = (new Date()).getTime();\r \t\t\treturn this.json.id+i;\r \t\t},\r \r \r \t\tisAvaliableImpExpColumn : function(thJson, module, type){\r \t\t\tif (thJson &amp;&amp; ( thJson.isShow === false || thJson.isImpExp === false ))return false; //隐藏列，不允许导入导出\r \t\t\tif (module &amp;&amp; (module.json.type == \"sequence\" || module.json.cellType == \"sequence\") )return false; //序号列\r \t\t\tif (module &amp;&amp; [\"Image\",\"Button\",\"ImageClipper\",\"Attachment\",\"AttachmentDg\",\"Label\"].contains(module.json.type) )return false; //图片，附件,Label列不导入导出\r \t\t\t// if (type===\"import\" &amp;&amp; module &amp;&amp; [\"Label\"].contains(module.json.type))return false; //Label 不导入\r \t\t\treturn true;\r \t\t},\r \t\tgetExportColWidthArray : function(){\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\tvar colWidthArr = [];\r \t\t\ttitleThs.each(function(th, index){\r \t\t\t\tif ( this.editable &amp;&amp; (index===0 || index === titleThs.length-1) )return; //第一列操作列和最后一列排序列\r \r \t\t\t\tvar thJson = this.form._getDomjson( th );\r \t\t\t\tvar module = this.editModules[this.editable ? (index-1) : index];\r \t\t\t\tif ( this.isAvaliableImpExpColumn( thJson, module ) ) {\r \t\t\t\t\tif (module &amp;&amp; [\"Org\",\"Reader\",\"Author\",\"Personfield\",\"Orgfield\"].contains(module.json.type)) {\r \t\t\t\t\t\tcolWidthArr.push(340);\r \t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Address\") {\r \t\t\t\t\t\tcolWidthArr.push(170);\r \t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Textarea\") {\r \t\t\t\t\t\tcolWidthArr.push(260);\r \t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Htmleditor\") {\r \t\t\t\t\t\tcolWidthArr.push(500);\r \t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Calendar\") {\r \t\t\t\t\t\tcolWidthArr.push(150);\r \t\t\t\t\t} else {\r \t\t\t\t\t\tcolWidthArr.push(150);\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t\treturn colWidthArr;\r \t\t},\r \t\tgetExportDateIndexArray : function(){\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\tvar dateIndexArr = []; //日期格式列下标\r \t\t\tvar idx=0;\r \t\t\ttitleThs.each(function(th, index){\r \t\t\t\tif ( this.editable &amp;&amp; (index===0 || index === titleThs.length-1) )return; //第一列操作列和最后一列排序列\r \t\t\t\tvar thJson = this.form._getDomjson( th );\r \t\t\t\tvar module = this.editModules[this.editable ? (index-1) : index];\r \t\t\t\tif ( this.isAvaliableImpExpColumn( thJson, module ) ) {\r \t\t\t\t\tif (module &amp;&amp; module.json.type === \"Calendar\") {\r \t\t\t\t\t\tdateIndexArr.push(idx);\r \t\t\t\t\t}\r \t\t\t\t\tidx++;\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t\treturn dateIndexArr;\r \t\t},\r \t\tgetExportTitleArray : function( type ){\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\tvar titleArr = [];\r \t\t\ttitleThs.each(function(th, index){\r \t\t\t\tif ( this.editable &amp;&amp; (index===0 || index === titleThs.length-1) )return; //第一列操作列和最后一列排序列\r \t\t\t\tvar thJson = this.form._getDomjson( th );\r \t\t\t\tvar module = this.editModules[this.editable ? (index-1) : index];\r \t\t\t\tif ( this.isAvaliableImpExpColumn( thJson, module, type ) ) {\r \t\t\t\t\ttitleArr.push(th.get(\"text\"));\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t\treturn titleArr;\r \t\t},\r \r \t\texportToExcel : function () {\r \t\t\tdebugger;\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\t// var editorTds = this.editorTr.getElements(\"td\");\r \r \t\t\tvar resultArr = [];\r \r \t\t\tvar titleArr = this.getExportTitleArray();\r \t\t\tvar colWidthArr = this.getExportColWidthArray();\r \t\t\tvar dateIndexArr = this.getExportDateIndexArray(); //日期格式列下标\r \r \t\t\t// var idx=0;\r \t\t\t// titleThs.each(function(th, index){\r \t\t\t// \tif ( this.editable &amp;&amp; (index===0 || index === titleThs.length-1) )return; //第一列操作列和最后一列排序列\r \t\t\t//\r \t\t\t// \tvar thJson = this.form._getDomjson( th );\r \t\t\t// \tvar module = this.editModules[this.editable ? (index-1) : index];\r \t\t\t// \tif ( this.isAvaliableImpExpColumn( thJson, module ) ) {\r \t\t\t// \t\tif (module &amp;&amp; [\"Org\",\"Reader\",\"Author\",\"Personfield\",\"Orgfield\"].contains(module.json.type)) {\r \t\t\t// \t\t\tcolWidthArr.push(340);\r \t\t\t// \t\t} else if (module &amp;&amp; module.json.type === \"Address\") {\r \t\t\t// \t\t\tcolWidthArr.push(170);\r \t\t\t// \t\t} else if (module &amp;&amp; module.json.type === \"Textarea\") {\r \t\t\t// \t\t\tcolWidthArr.push(260);\r \t\t\t// \t\t} else if (module &amp;&amp; module.json.type === \"Htmleditor\") {\r \t\t\t// \t\t\tcolWidthArr.push(500);\r \t\t\t// \t\t} else if (module &amp;&amp; module.json.type === \"Calendar\") {\r \t\t\t// \t\t\tcolWidthArr.push(150);\r \t\t\t// \t\t\tdateIndexArr.push(idx);\r \t\t\t// \t\t} else {\r \t\t\t// \t\t\tcolWidthArr.push(150);\r \t\t\t// \t\t}\r \t\t\t// \t\tidx++;\r \t\t\t// \t\ttitleArr.push(th.get(\"text\"));\r \t\t\t// \t}\r \t\t\t// }.bind(this));\r \r \t\t\tresultArr.push( titleArr );\r \r \t\t\tif (this.gridData.data){\r \t\t\t\tthis.gridData.data.each(function(data, idx){\r \t\t\t\t\tvar array = [];\r \r \t\t\t\t\ttitleThs.each(function(th, index){\r \t\t\t\t\t\tif ( this.editable &amp;&amp; (index===0 || index === titleThs.length-1) )return; //第一列操作列和最后一列排序列\r \r \t\t\t\t\t\tvar module = this.editModules[ this.editable ? (index-1) : index];\r \t\t\t\t\t\tvar thJson = this.form._getDomjson( th );\r \r \t\t\t\t\t\tif ( this.isAvaliableImpExpColumn( thJson, module ) ) {\r \r \t\t\t\t\t\t\tvar cellData = data[th.get(\"id\")];\r \t\t\t\t\t\t\tvar text = \"\";\r \r \t\t\t\t\t\t\tif( cellData ) {\r \t\t\t\t\t\t\t\tif (typeOf(cellData) !== \"array\") { //序号\r \t\t\t\t\t\t\t\t\tfor (key in cellData) {\r \t\t\t\t\t\t\t\t\t\tvar value = cellData[key];\r \t\t\t\t\t\t\t\t\t\tif (module &amp;&amp; [\"Org\", \"Reader\", \"Author\", \"Personfield\", \"Orgfield\"].contains(module.json.type)) {\r \t\t\t\t\t\t\t\t\t\t\tif (typeOf(value) === \"array\") {\r \t\t\t\t\t\t\t\t\t\t\t\tvar textArray = [];\r \t\t\t\t\t\t\t\t\t\t\t\tvalue.each(function (item) {\r \t\t\t\t\t\t\t\t\t\t\t\t\tif (typeOf(item) === \"object\") {\r \t\t\t\t\t\t\t\t\t\t\t\t\t\ttextArray.push(item.distinguishedName);\r \t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\t\t\t\t\t\t\ttextArray.push(item);\r \t\t\t\t\t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t\t\t\t\t}.bind(this));\r \t\t\t\t\t\t\t\t\t\t\t\ttext = textArray.join(\", \\n\");\r \t\t\t\t\t\t\t\t\t\t\t} else if (typeOf(value) === \"object\") {\r \t\t\t\t\t\t\t\t\t\t\t\ttext = value.distinguishedName;\r \t\t\t\t\t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\t\t\t\t\ttext = value;\r \t\t\t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Textarea\") {\r \t\t\t\t\t\t\t\t\t\t\ttext = value;\r \t\t\t\t\t\t\t\t\t\t} else {\r \t\t\t\t\t\t\t\t\t\t\ttext = this._getValueText(this.editable ? (index - 1) : index, value);\r \t\t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t} else if (module &amp;&amp; module.json.type === \"Label\" &amp;&amp; module.node) {\r \t\t\t\t\t\t\t\ttext = module.node.get(\"text\");\r \t\t\t\t\t\t\t}\r \r \t\t\t\t\t\t\tif( !text &amp;&amp; typeOf(text) !== \"number\" ){\r \t\t\t\t\t\t\t\ttext = \"\";\r \t\t\t\t\t\t\t}\r \r \t\t\t\t\t\t\tarray.push( text );\r \t\t\t\t\t\t}\r \r \r \t\t\t\t\t}.bind(this));\r \r \t\t\t\t\tresultArr.push( array );\r \r \t\t\t\t}.bind(this));\r \t\t\t}\r \r \t\t\tvar title;\r \t\t\tif( this.json.excelName &amp;&amp; this.json.excelName.code ){\r \t\t\t\ttitle = this.form.Macro.exec(this.json.excelName.code, this);\r \t\t\t}else{\r \t\t\t\ttitle = MWF.xApplication.process.Xform.LP.exportDefaultName;\r \t\t\t}\r \t\t\tvar titleA = title.split(\".\");\r \t\t\tif( [\"xls\",\"xlst\"].contains( titleA[titleA.length-1].toLowerCase() ) ){\r \t\t\t\ttitleA.splice( titleA.length-1 );\r \t\t\t}\r \t\t\ttitle = titleA.join(\".\");\r \r \t\t\tvar arg = { data : resultArr, colWidthArray : colWidthArr, title : title };\r \t\t\tthis.fireEvent(\"export\", [arg]);\r \r \t\t\tnew MWF.xApplication.process.Xform.DatagridPC.ExcelUtils( this ).export( resultArr, arg.title || title, colWidthArr, dateIndexArr );\r \t\t},\r \t\timportFromExcel : function () {\r \t\t\tdebugger;\r \t\t\tvar columnList = [];\r \r \t\t\tvar dateColArray = []; //日期列\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \r \t\t\tvar idx = 1;\r \t\t\tvar orgTitleList = [];\r \t\t\ttitleThs.each(function(th, index){\r \t\t\t\tif (this.editable &amp;&amp; (index===0 || index === titleThs.length-1 ))return; //第一列操作列和最后一列排序列\r \t\t\t\tvar module = this.editModules[this.editable ? (index-1) : index];\r \t\t\t\tvar thJson = this.form._getDomjson( th );\r \t\t\t\tif ( this.isAvaliableImpExpColumn( thJson, module, \"import\" )){\r \t\t\t\t\tcolumnList.push({\r \t\t\t\t\t\ttext : th.get(\"text\").trim(),\r \t\t\t\t\t\tindex: idx,\r \t\t\t\t\t\tthJson: thJson,\r \t\t\t\t\t\tmodule: module\r \t\t\t\t\t});\r \t\t\t\t\tidx++;\r \t\t\t\t\tif (module &amp;&amp; module.json.type === \"Calendar\"){\r \t\t\t\t\t\tdateColArray.push(idx);\r \t\t\t\t\t}else if( module &amp;&amp; [\"Org\",\"Reader\",\"Author\",\"Personfield\",\"Orgfield\"].contains(module.json.type) ){\r \t\t\t\t\t\torgTitleList.push(th.get(\"text\"));\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t}.bind(this));\r \r \r \t\t\tnew MWF.xApplication.process.Xform.DatagridPC.ExcelUtils( this ).upload( dateColArray, function (importedData) {\r \r \t\t\t\tvar checkAndImport = function () {\r \t\t\t\t\tif( !this.checkImportedData( columnList, importedData ) ){\r \t\t\t\t\t\tthis.openImportedErrorDlg( columnList, importedData );\r \t\t\t\t\t}else{\r \t\t\t\t\t\tthis.setImportData( columnList, importedData )\r \t\t\t\t\t}\r \t\t\t\t}.bind(this);\r \r \t\t\t\tif( orgTitleList.length > 0 ){\r \t\t\t\t\tthis.listImportAllOrgData( orgTitleList, importedData, function () {\r \t\t\t\t\t\tcheckAndImport();\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}else{\r \t\t\t\t\tcheckAndImport();\r \t\t\t\t}\r \r \r \t\t\t}.bind(this));\r \t\t},\r \r \t\tsetImportData: function(columnList, importedData){\r \r \t\t\tvar data = {\r \t\t\t\t\"data\" : []\r \t\t\t};\r \r \t\t\timportedData.each( function( importedLineData, lineIndex ){\r \r \t\t\t\tvar lineData = {};\r \r \t\t\t\tcolumnList.each( function (obj, i) {\r \t\t\t\t\tvar index = obj.index;\r \t\t\t\t\tvar module = obj.module;\r \t\t\t\t\tvar thJson = obj.thJson;\r \t\t\t\t\tvar text = obj.text;\r \r \t\t\t\t\tvar d = importedLineData[text] || \"\";\r \r \t\t\t\t\tvar value;\r \t\t\t\t\tswitch (module.json.type) {\r \t\t\t\t\t\tcase \"Org\":\r \t\t\t\t\t\tcase \"Reader\":\r \t\t\t\t\t\tcase \"Author\":\r \t\t\t\t\t\tcase \"Personfield\":\r \t\t\t\t\t\tcase \"Orgfield\":\r \t\t\t\t\t\t\tvar arr = d.split(/\\s*,\\s*/g ); //空格,空格\r \t\t\t\t\t\t\tif( arr.length === 0 ){\r \t\t\t\t\t\t\t\tvalue = this.getImportOrgData( d );\r \t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\tvalue = [];\r \t\t\t\t\t\t\t\tarr.each( function(d, idx){\r \t\t\t\t\t\t\t\t\tvar obj = this.getImportOrgData( d );\r \t\t\t\t\t\t\t\t\tvalue.push( obj );\r \t\t\t\t\t\t\t\t}.bind(this));\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Combox\":\r \t\t\t\t\t\tcase \"Address\":\r \t\t\t\t\t\t\tarr = d.split(/\\s*,\\s*/g ); //空格,空格\r \t\t\t\t\t\t\tvalue = arr.length === 0 ? arr[0] : arr;\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Checkbox\":\r \t\t\t\t\t\t\tarr = d.split(/\\s*,\\s*/g ); //空格,空格\r \t\t\t\t\t\t\tvar options = module.getOptionsObj();\r \t\t\t\t\t\t\tarr.each( function( a, i ){\r \t\t\t\t\t\t\t\tvar idx = options.textList.indexOf( a );\r \t\t\t\t\t\t\t\tarr[ i ] = idx > -1 ? options.valueList[ idx ] : \"\";\r \t\t\t\t\t\t\t});\r \t\t\t\t\t\t\tvalue = arr.length === 1 ? arr[0] : arr;\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Radio\":\r \t\t\t\t\t\tcase \"Select\":\r \t\t\t\t\t\t\tvalue = d.replace(/&amp;#10;/g,\"\"); //换行符&amp;#10;\r \t\t\t\t\t\t\tvar options = module.getOptionsObj();\r \t\t\t\t\t\t\tvar idx = options.textList.indexOf( value );\r \t\t\t\t\t\t\tvalue = idx > -1 ? options.valueList[ idx ] : \"\";\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Textarea\":\r \t\t\t\t\t\t\tvalue = d.replace(/&amp;#10;/g,\"\\n\"); //换行符&amp;#10;\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Calendar\":\r \t\t\t\t\t\t\tvalue = d.replace(/&amp;#10;/g,\"\"); //换行符&amp;#10;\r \t\t\t\t\t\t\tif( value ){\r \t\t\t\t\t\t\t\tvar format;\r \t\t\t\t\t\t\t\tif (!module.json.format){\r \t\t\t\t\t\t\t\t\tif (module.json.selectType===\"datetime\" || module.json.selectType===\"time\"){\r \t\t\t\t\t\t\t\t\t\tformat = (module.json.selectType === \"time\") ? \"%H:%M\" : (Locale.get(\"Date\").shortDate + \" \" + \"%H:%M\")\r \t\t\t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\t\t\tformat = Locale.get(\"Date\").shortDate;\r \t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t}else{\r \t\t\t\t\t\t\t\t\tformat = module.json.format;\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\tvalue = Date.parse( value ).format( format );\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tdefault:\r \t\t\t\t\t\t\tvalue = d.replace(/&amp;#10;/g,\"\"); //换行符&amp;#10;\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t}\r \r \t\t\t\t\tlineData[ thJson.id ] = {};\r \t\t\t\t\tlineData[ thJson.id ][ module.json.id ] = value;\r \r \t\t\t\t}.bind(this));\r \r \t\t\t\tdata.data.push( lineData );\r \t\t\t}.bind(this));\r \r \t\t\tthis.fireEvent(\"import\", [data] );\r \r \t\t\tthis.setData( data );\r \t\t\tthis.form.notice( MWF.xApplication.process.Xform.LP.importSuccess );\r \r \t\t},\r \t\topenImportedErrorDlg : function( columnList, tableData ){\r \t\t\tvar _self = this;\r \r \t\t\tvar objectToString = function (obj, type) {\r \t\t\t\tif(!obj)return \"\";\r \t\t\t\tvar arr = [];\r \t\t\t\tObject.each(obj, function (value, key) {\r \t\t\t\t\tif( type === \"style\" ){\r \t\t\t\t\t\tarr.push( key + \":\"+ value +\";\" )\r \t\t\t\t\t}else{\r \t\t\t\t\t\tarr.push( key + \"='\"+ value +\"'\" )\r \t\t\t\t\t}\r \t\t\t\t})\r \t\t\t\treturn arr.join( \" \" )\r \t\t\t}\r \r \t\t\tvar htmlArray = [\"&lt;table \"+ objectToString( this.json.properties ) +\" style='\"+objectToString( this.json.tableStyles, \"style\" )+\"'>\"];\r \r \t\t\tvar titleStyle = objectToString( this.json.titleStyles, \"style\" );\r \t\t\thtmlArray.push( \"&lt;tr>\" );\r \t\t\tcolumnList.each( function (obj, i) {\r \t\t\t\thtmlArray.push( \"&lt;th style='\"+titleStyle+\"'>\"+obj.text+\"&lt;/th>\" );\r \t\t\t});\r \t\t\thtmlArray.push( \"&lt;th style='\"+titleStyle+\"'> \"+MWF.xApplication.process.Xform.LP.validationInfor +\"&lt;/th>\" );\r \t\t\thtmlArray.push( \"&lt;/tr>\" );\r \r \t\t\tvar contentStyles = Object.clone( this.json.contentStyles );\r \t\t\tif( !contentStyles[ \"border-bottom\" ] &amp;&amp; !contentStyles[ \"border\" ] )contentStyles[ \"border-bottom\" ] = \"1px solid #eee\";\r \t\t\tvar contentStyle = objectToString( Object.merge( contentStyles, {\"text-align\":\"left\"}) , \"style\" );\r \r \t\t\ttableData.each( function( lineData, lineIndex ){\r \r \t\t\t\thtmlArray.push( \"&lt;tr>\" );\r \t\t\t\tcolumnList.each( function (obj, i) {\r \t\t\t\t\thtmlArray.push( \"&lt;td style='\"+contentStyle+\"'>\"+ ( lineData[ obj.text ] || '' ).replace(/&amp;#10;/g,\"&lt;br/>\") +\"&lt;/td>\" ); //换行符&amp;#10;\r \t\t\t\t});\r \t\t\t\thtmlArray.push( \"&lt;td style='\"+contentStyle+\"'>\"+( lineData.errorTextList ? lineData.errorTextList.join(\"&lt;br/>\") : \"\" )+\"&lt;/td>\" );\r \t\t\t\thtmlArray.push( \"&lt;/tr>\" );\r \r \t\t\t}.bind(this));\r \t\t\thtmlArray.push( \"&lt;/table>\" );\r \r \t\t\tvar div = new Element(\"div\", { style : \"padding:10px;\", html : htmlArray.join(\"\") });\r \t\t\tvar dlg = o2.DL.open({\r \t\t\t\t\"style\" : this.form.json.dialogStyle || \"user\",\r \t\t\t\t\"title\": MWF.xApplication.process.Xform.LP.importFail,\r \t\t\t\t\"content\": div,\r \t\t\t\t\"offset\": {\"y\": 0},\r \t\t\t\t\"isMax\": true,\r \t\t\t\t\"width\": 1000,\r \t\t\t\t\"height\": 700,\r \t\t\t\t\"buttonList\": [\r \t\t\t\t\t{\r \t\t\t\t\t\t\"type\": \"exportWithError\",\r \t\t\t\t\t\t\"text\": MWF.xApplication.process.Xform.LP.datagridExport,\r \t\t\t\t\t\t\"action\": function () { _self.exportWithImportDataToExcel(columnList, tableData); }\r \t\t\t\t\t},\r \t\t\t\t\t{\r \t\t\t\t\t\t\"type\": \"cancel\",\r \t\t\t\t\t\t\"text\": MWF.LP.process.button.cancel,\r \t\t\t\t\t\t\"action\": function () { dlg.close(); }\r \t\t\t\t\t}\r \t\t\t\t],\r \t\t\t\t\"onPostClose\": function(){\r \t\t\t\t\tdlg = null;\r \t\t\t\t}.bind(this)\r \t\t\t});\r \r \t\t},\r \t\texportWithImportDataToExcel : function ( columnList, importedData ) {\r \t\t\tdebugger;\r \t\t\tvar titleThs = this.titleTr.getElements(\"th\");\r \t\t\t// var editorTds = this.editorTr.getElements(\"td\");\r \r \t\t\tvar resultArr = [];\r \r \t\t\tvar colWidthArr = this.getExportColWidthArray();\r \t\t\tcolWidthArr.push( 220 );\r \r \t\t\tvar dateIndexArr = this.getExportDateIndexArray(); //日期格式列下标\r \r \t\t\tvar titleArr = this.getExportTitleArray(\"import\");\r \t\t\ttitleArr.push( MWF.xApplication.process.Xform.LP.validationInfor );\r \t\t\tresultArr.push( titleArr );\r \r \t\t\timportedData.each( function( lineData, lineIndex ){\r \t\t\t\tvar array = [];\r \t\t\t\tcolumnList.each( function (obj, i) {\r \t\t\t\t\tarray.push( ( lineData[ obj.text ] || '' ).replace(/&amp;#10;/g, \"\\n\") );\r \t\t\t\t});\r \t\t\t\tarray.push( lineData.errorTextListExcel ? lineData.errorTextListExcel.join(\"\\n\") : \"\" );\r \r \t\t\t\tresultArr.push( array );\r \t\t\t}.bind(this));\r \r \t\t\tvar title;\r \t\t\tif( this.json.excelName &amp;&amp; this.json.excelName.code ){\r \t\t\t\ttitle = this.form.Macro.exec(this.json.excelName.code, this);\r \t\t\t}else{\r \t\t\t\ttitle = MWF.xApplication.process.Xform.LP.exportDefaultName;\r \t\t\t}\r \t\t\tvar titleA = title.split(\".\");\r \t\t\tif( [\"xls\",\"xlst\"].contains( titleA[titleA.length-1].toLowerCase() ) ){\r \t\t\t\ttitleA.splice( titleA.length-1 );\r \t\t\t}\r \t\t\ttitle = titleA.join(\".\");\r \r \t\t\tvar arg = { data : resultArr, colWidthArray : colWidthArr, title : title, withError : true };\r \t\t\tthis.fireEvent(\"export\", [arg]);\r \r \t\t\tnew MWF.xApplication.process.Xform.DatagridPC.ExcelUtils( this ).export( resultArr, arg.title || title, colWidthArr, dateIndexArr );\r \t\t},\r \t\tcheckImportedData : function( columnList, tableData ){\r \t\t\tvar flag = true;\r \r \t\t\tvar lp = MWF.xApplication.process.Xform.LP;\r \t\t\tvar columnText = lp.importValidationColumnText;\r \t\t\tvar columnTextExcel = lp.importValidationColumnTextExcel;\r \t\t\tvar excelUtil = new MWF.xApplication.process.Xform.DatagridPC.ExcelUtils( this );\r \r \t\t\ttableData.each( function(lineData, lineIndex){\r \r \t\t\t\tvar errorTextList = [];\r \t\t\t\tvar errorTextListExcel = [];\r \r \t\t\t\tcolumnList.each( function (obj, i) {\r \t\t\t\t\tvar index = obj.index;\r \t\t\t\t\tvar module = obj.module;\r \t\t\t\t\tvar thJson = obj.thJson;\r \t\t\t\t\tvar text = obj.text;\r \r \t\t\t\t\tvar colInfor = columnText.replace( \"{n}\", index );\r \t\t\t\t\tvar colInforExcel = columnTextExcel.replace( \"{n}\", excelUtil.index2ColName( index-1 ) );\r \r \t\t\t\t\tvar d = lineData[text] || \"\";\r \r \t\t\t\t\tswitch (module.json.type) {\r \t\t\t\t\t\tcase \"Org\":\r \t\t\t\t\t\tcase \"Reader\":\r \t\t\t\t\t\tcase \"Author\":\r \t\t\t\t\t\tcase \"Personfield\":\r \t\t\t\t\t\tcase \"Orgfield\":\r \t\t\t\t\t\t\tvar arr = d.split(/\\s*,\\s*/g ); //空格,空格\r \t\t\t\t\t\t\tarr.each( function(d, idx){\r \t\t\t\t\t\t\t\tvar obj = this.getImportOrgData( d );\r \t\t\t\t\t\t\t\tif( obj.errorText ){\r \t\t\t\t\t\t\t\t\terrorTextList.push( colInfor + obj.errorText + + lp.fullstop );\r \t\t\t\t\t\t\t\t\terrorTextListExcel.push( colInforExcel + obj.errorText + + lp.fullstop );\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t}.bind(this));\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Number\":\r \t\t\t\t\t\t\tif (parseFloat(d).toString() === \"NaN\"){\r \t\t\t\t\t\t\t\terrorTextList.push( colInfor + d + lp.notValidNumber + lp.fullstop );\r \t\t\t\t\t\t\t\terrorTextListExcel.push( colInforExcel + d + lp.notValidNumber + lp.fullstop );\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tcase \"Calendar\":\r \t\t\t\t\t\t\tif( !( isNaN(d) &amp;&amp; !isNaN(Date.parse(d) ))){\r \t\t\t\t\t\t\t\terrorTextList.push(colInfor + d + lp.notValidDate + lp.fullstop );\r \t\t\t\t\t\t\t\terrorTextListExcel.push( colInforExcel + d + lp.notValidDate + lp.fullstop );\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\tdefault:\r \t\t\t\t\t\t\tbreak;\r \t\t\t\t\t}\r \t\t\t\t\tif (module.json.type!=\"sequence\" &amp;&amp; module.setData){\r \t\t\t\t\t\tmodule.setData();\r \t\t\t\t\t\tmodule.validationMode();\r \t\t\t\t\t\tif (!module.validation()){\r \t\t\t\t\t\t\terrorTextList.push(colInfor + module.errNode.get(\"text\"));\r \t\t\t\t\t\t\terrorTextListExcel.push( colInforExcel + module.errNode.get(\"text\"));\r \t\t\t\t\t\t\tmodule.errNode.destroy();\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \t\t\t\t}.bind(this));\r \r \t\t\t\tif(errorTextList.length>0){\r \t\t\t\t\tlineData.errorTextList = errorTextList;\r \t\t\t\t\tlineData.errorTextListExcel = errorTextListExcel;\r \t\t\t\t\tflag = false;\r \t\t\t\t}\r \r \t\t\t\tdebugger;\r \r \t\t\t}.bind(this));\r \r \t\t\tvar arg = {\r \t\t\t\tvalidted : flag,\r \t\t\t\tdata : tableData\r \t\t\t};\r \t\t\tthis.fireEvent( \"validImport\", [arg] );\r \r \t\t\treturn arg.validted;\r \t\t},\r \t\tgetImportOrgData : function( str ){\r \t\t\tstr = str.trim();\r \t\t\tvar flag = str.substr(str.length-2, 2);\r \t\t\tswitch (flag.toLowerCase()){\r \t\t\t\tcase \"@i\":\r \t\t\t\t\treturn this.identityMapImported[str] || {\"errorText\": str + MWF.xApplication.process.Xform.LP.notExistInSystem };\r \t\t\t\tcase \"@p\":\r \t\t\t\t\treturn this.personMapImported[str] || {\"errorText\": str + MWF.xApplication.process.Xform.LP.notExistInSystem };\r \t\t\t\tcase \"@u\":\r \t\t\t\t\treturn this.unitMapImported[str] || {\"errorText\": str + MWF.xApplication.process.Xform.LP.notExistInSystem };\r \t\t\t\tcase \"@g\":\r \t\t\t\t\treturn this.groupMapImported[str] || {\"errorText\": str + MWF.xApplication.process.Xform.LP.notExistInSystem };\r \t\t\t\tdefault:\r \t\t\t\t\treturn this.identityMapImported[str] ||\r \t\t\t\t\t\tthis.personMapImported[str] ||\r \t\t\t\t\t\tthis.unitMapImported[str] ||\r \t\t\t\t\t\tthis.groupMapImported[str] ||\r \t\t\t\t\t\t{\"errorText\": str + MWF.xApplication.process.Xform.LP.notExistInSystem };\r \r \t\t\t}\r \t\t},\r \t\tlistImportAllOrgData : function (orgTitleList, tableData, callback) {\r \t\t\tvar identityList = [], personList = [], unitList = [], groupList = [];\r \t\t\tif( orgTitleList.length > 0 ){\r \t\t\t\ttableData.each( function( lineData, lineIndex ){\r \t\t\t\t\t// if( lineIndex === 0 )return;\r \r \t\t\t\t\torgTitleList.each( function (title, index) {\r \r \t\t\t\t\t\tif( !lineData[title] )return;\r \r \t\t\t\t\t\tvar arr = lineData[title].split(/\\s*,\\s*/g );\r \t\t\t\t\t\tarr.each( function( a ){\r \t\t\t\t\t\t\ta = a.trim();\r \t\t\t\t\t\t\tvar flag = a.substr(a.length-2, 2);\r \t\t\t\t\t\t\tswitch (flag.toLowerCase()){\r \t\t\t\t\t\t\t\tcase \"@i\":\r \t\t\t\t\t\t\t\t\tidentityList.push( a ); break;\r \t\t\t\t\t\t\t\tcase \"@p\":\r \t\t\t\t\t\t\t\t\tpersonList.push( a ); break;\r \t\t\t\t\t\t\t\tcase \"@u\":\r \t\t\t\t\t\t\t\t\tunitList.push( a ); break;\r \t\t\t\t\t\t\t\tcase \"@g\":\r \t\t\t\t\t\t\t\t\tgroupList.push( a ); break;\r \t\t\t\t\t\t\t\tdefault:\r \t\t\t\t\t\t\t\t\tidentityList.push( a );\r \t\t\t\t\t\t\t\t\tpersonList.push( a );\r \t\t\t\t\t\t\t\t\tunitList.push( a );\r \t\t\t\t\t\t\t\t\tgroupList.push( a );\r \t\t\t\t\t\t\t\t\tbreak;\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t})\r \t\t\t\t\t})\r \t\t\t\t});\r \t\t\t\tvar identityLoaded, personLoaded, unitLoaded, groupLoaded;\r \t\t\t\tvar check = function () {\r \t\t\t\t\tif( identityLoaded &amp;&amp; personLoaded &amp;&amp; unitLoaded &amp;&amp; groupLoaded ){\r \t\t\t\t\t\tif(callback)callback();\r \t\t\t\t\t}\r \t\t\t\t};\r \r \t\t\t\tthis.identityMapImported = {};\r \t\t\t\tif( identityList.length ){\r \t\t\t\t\to2.Actions.load(\"x_organization_assemble_express\").IdentityAction.listObject({ identityList : identityList }, function (json) {\r \t\t\t\t\t\tjson.data.each( function (d) { this.identityMapImported[ d.matchKey ] = d; }.bind(this));\r \t\t\t\t\t\tidentityLoaded = true;\r \t\t\t\t\t\tcheck();\r \t\t\t\t\t}.bind(this))\r \t\t\t\t}else{\r \t\t\t\t\tidentityLoaded = true;\r \t\t\t\t\tcheck();\r \t\t\t\t}\r \r \t\t\t\tthis.personMapImported = {};\r \t\t\t\tif( personList.length ){\r \t\t\t\t\to2.Actions.load(\"x_organization_assemble_express\").PersonAction.listObject({ personList : personList }, function (json) {\r \t\t\t\t\t\tjson.data.each( function (d) { this.personMapImported[ d.matchKey ] = d; }.bind(this));\r \t\t\t\t\t\tpersonLoaded = true;\r \t\t\t\t\t\tcheck();\r \t\t\t\t\t}.bind(this))\r \t\t\t\t}else{\r \t\t\t\t\tpersonLoaded = true;\r \t\t\t\t\tcheck();\r \t\t\t\t}\r \r \t\t\t\tthis.unitMapImported = {};\r \t\t\t\tif( unitList.length ){\r \t\t\t\t\to2.Actions.load(\"x_organization_assemble_express\").UnitAction.listObject({ unitList : unitList }, function (json) {\r \t\t\t\t\t\tjson.data.each( function (d) { this.unitMapImported[ d.matchKey ] = d; }.bind(this));\r \t\t\t\t\t\tunitLoaded = true;\r \t\t\t\t\t\tcheck();\r \t\t\t\t\t}.bind(this))\r \t\t\t\t}else{\r \t\t\t\t\tunitLoaded = true;\r \t\t\t\t\tcheck();\r \t\t\t\t}\r \r \t\t\t\tthis.groupMapImported = {};\r \t\t\t\tif( groupList.length ){\r \t\t\t\t\to2.Actions.load(\"x_organization_assemble_express\").GroupAction.listObject({ groupList : groupList }, function (json) {\r \t\t\t\t\t\tjson.data.each( function (d) { this.groupMapImported[ d.matchKey ] = d; }.bind(this));\r \t\t\t\t\t\tgroupLoaded = true;\r \t\t\t\t\t\tcheck();\r \t\t\t\t\t}.bind(this))\r \t\t\t\t}else{\r \t\t\t\t\tgroupLoaded = true;\r \t\t\t\t\tcheck();\r \t\t\t\t}\r \t\t\t}\r \t\t}\r \r \t});\r \r MWF.xApplication.process.Xform.DatagridPC$Title = new Class({\r \tExtends: MWF.APP$Module,\r \t_afterLoaded: function(){\r \t\tthis.dataGrid = this.node.retrieve(\"dataGrid\");\r \t\tif ((this.json.total == \"number\") || (this.json.total == \"count\")){\r \t\t\tthis.dataGrid.totalModules.push({\r \t\t\t\t\"module\": this,\r \t\t\t\t\"index\": (this.dataGrid.editable!=false) ? this.node.cellIndex+1 : this.node.cellIndex,\r \t\t\t\t\"type\": this.json.total\r \t\t\t})\r \t\t}\r \t\t//\tthis.form._loadModules(this.node);\r \t}\r });\r MWF.xApplication.process.Xform.DatagridPC$Data = new Class({\r \tExtends: MWF.APP$Module,\r \t_afterLoaded: function(){\r \t\t//this.form._loadModules(this.node);\r \t\tthis.dataGrid = this.node.retrieve(\"dataGrid\");\r \r \t\tvar td = this.node;\r \r \t\tif (this.json.cellType == \"sequence\"){\r \t\t\tvar flag = true;\r \t\t\tfor (var i=0; i&lt;this.dataGrid.editModules.length; i++){\r \t\t\t\tif (this.dataGrid.editModules[i].json.id == this.json.id){\r \t\t\t\t\tflag = false;\r \t\t\t\t\tbreak;\r \t\t\t\t}\r \t\t\t}\r \t\t\tif (flag){\r \t\t\t\tthis.dataGrid.editModules.push({\r \t\t\t\t\t\"json\": {\"type\": \"sequence\", \"id\": this.json.id},\r \t\t\t\t\t\"node\": td ,\r \t\t\t\t\t\"focus\": function(){}\r \t\t\t\t});\r \t\t\t}\r \t\t}else{\r \t\t\tvar moduleNodes = this.form._getModuleNodes(this.node);\r \t\t\tmoduleNodes.each(function(node){\r \t\t\t\tvar json = this.form._getDomjson(node);\r \t\t\t\tif( json ){\r \t\t\t\t\tvar isField = false;\r \t\t\t\t\tif (json.type==\"Attachment\" || json.type==\"AttachmentDg\" ){\r \t\t\t\t\t\tjson.type = \"AttachmentDg\";\r \t\t\t\t\t\t//json.site = this.dataGrid.getAttachmentRandomSite();\r \t\t\t\t\t\t//json.id = json.site;\r \t\t\t\t\t}\r \t\t\t\t\tvar module = this.form._loadModule(json, node, function(){\r \t\t\t\t\t\tisField = this.field;\r \t\t\t\t\t\tthis.field = false;\r \t\t\t\t\t});\r \t\t\t\t\tif( isField ){\r \t\t\t\t\t\tmodule.node.setStyle(\"padding-right\",\"0px\");\r \t\t\t\t\t}\r \t\t\t\t\tmodule.dataModule = this;\r \t\t\t\t\tthis.dataGrid.editModules.push(module);\r \t\t\t\t}\r \t\t\t}.bind(this));\r \t\t}\r \t}\r });\r \r MWF.xApplication.process.Xform.DatagridPC.ExcelUtils = new Class({\r \tinitialize: function( datagrid ){\r \t\tthis.datagrid = datagrid;\r \t\tthis.form = datagrid.form;\r \t\tif (!FileReader.prototype.readAsBinaryString) {\r \t\t\tFileReader.prototype.readAsBinaryString = function (fileData) {\r \t\t\t\tvar binary = \"\";\r \t\t\t\tvar pt = this;\r \t\t\t\tvar reader = new FileReader();\r \t\t\t\treader.onload = function (e) {\r \t\t\t\t\tvar bytes = new Uint8Array(reader.result);\r \t\t\t\t\tvar length = bytes.byteLength;\r \t\t\t\t\tfor (var i = 0; i &lt; length; i++) {\r \t\t\t\t\t\tbinary += String.fromCharCode(bytes[i]);\r \t\t\t\t\t}\r \t\t\t\t\t//pt.result - readonly so assign binary\r \t\t\t\t\tpt.content = binary;\r \t\t\t\t\tpt.onload();\r \t\t\t\t};\r \t\t\t\treader.readAsArrayBuffer(fileData);\r \t\t\t}\r \t\t}\r \t},\r \t_loadResource : function( callback ){\r \t\tif( !window.XLSX || !window.xlsxUtils ){\r \t\t\tvar uri = \"../x_component_Template/framework/xlsx/xlsx.full.js\";\r \t\t\tvar uri2 = \"../x_component_Template/framework/xlsx/xlsxUtils.js\";\r \t\t\tCOMMON.AjaxModule.load(uri, function(){\r \t\t\t\tCOMMON.AjaxModule.load(uri2, function(){\r \t\t\t\t\tcallback();\r \t\t\t\t}.bind(this))\r \t\t\t}.bind(this))\r \t\t}else{\r \t\t\tcallback();\r \t\t}\r \t},\r \t_openDownloadDialog: function(url, saveName){\r \t\t/**\r \t\t * 通用的打开下载对话框方法，没有测试过具体兼容性\r \t\t * @param url 下载地址，也可以是一个blob对象，必选\r \t\t * @param saveName 保存文件名，可选\r \t\t */\r \t\tif( Browser.name !== 'ie' ){\r \t\t\tif(typeof url == 'object' &amp;&amp; url instanceof Blob){\r \t\t\t\turl = URL.createObjectURL(url); // 创建blob地址\r \t\t\t}\r \t\t\tvar aLink = document.createElement('a');\r \t\t\taLink.href = url;\r \t\t\taLink.download = saveName || ''; // HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效\r \t\t\tvar event;\r \t\t\tif(window.MouseEvent &amp;&amp; typeOf( window.MouseEvent ) == \"function\" ) event = new MouseEvent('click');\r \t\t\telse\r \t\t\t{\r \t\t\t\tevent = document.createEvent('MouseEvents');\r \t\t\t\tevent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\r \t\t\t}\r \t\t\taLink.dispatchEvent(event);\r \t\t}else{\r \t\t\twindow.navigator.msSaveBlob( url, saveName);\r \t\t}\r \t},\r \r \tindex2ColName : function( index ){\r \t\tif (index &lt; 0) {\r \t\t\treturn null;\r \t\t}\r \t\tvar num = 65;// A的Unicode码\r \t\tvar colName = \"\";\r \t\tdo {\r \t\t\tif (colName.length > 0)index--;\r \t\t\tvar remainder = index % 26;\r \t\t\tcolName = String.fromCharCode(remainder + num) + colName;\r \t\t\tindex = (index - remainder) / 26;\r \t\t} while (index > 0);\r \t\treturn colName;\r \t},\r \r \tupload : function ( dateColIndexArray, callback ) {\r \t\tvar dateColArray = [];\r \t\tdateColIndexArray.each( function (idx) {\r \t\t\tdateColArray.push( this.index2ColName( idx ));\r \t\t}.bind(this))\r \r \r \t\tvar uploadFileAreaNode = new Element(\"div\");\r \t\tvar html = \"&lt;input name=\\\"file\\\" type=\\\"file\\\" accept=\\\"csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel\\\" />\";\r \t\tuploadFileAreaNode.set(\"html\", html);\r \r \t\tvar fileUploadNode = uploadFileAreaNode.getFirst();\r \t\tfileUploadNode.addEvent(\"change\", function () {\r \t\t\tvar files = fileNode.files;\r \t\t\tif (files.length) {\r \t\t\t\tvar file = files.item(0);\r \t\t\t\tif( file.name.indexOf(\" \") > -1 ){\r \t\t\t\t\tthis.form.notice( MWF.xApplication.process.Xform.LP.uploadedFilesCannotHaveSpaces, \"error\");\r \t\t\t\t\treturn false;\r \t\t\t\t}\r \r \t\t\t\t//第三个参数是日期的列\r \t\t\t\tthis.import( file, function(json){\r \t\t\t\t\t//json为导入的结果\r \t\t\t\t\tif(callback)callback(json);\r \t\t\t\t\tuploadFileAreaNode.destroy();\r \t\t\t\t}.bind(this), dateColArray ); //[\"E\",\"F\"]\r \r \t\t\t}\r \t\t}.bind(this));\r \t\tvar fileNode = uploadFileAreaNode.getFirst();\r \t\tfileNode.click();\r \t},\r \texport : function(array, fileName, colWidthArr, dateIndexArray){\r \t\t// var array = [[\"姓名\",\"性别\",\"学历\",\"专业\",\"出生日期\",\"毕业日期\"]];\r \t\t// array.push([ \"张三\",\"男\",\"大学本科\",\"计算机\",\"2001-1-2\",\"2019-9-2\" ]);\r \t\t// array.push([ \"李四\",\"男\",\"大学专科\",\"数学\",\"1998-1-2\",\"2018-9-2\" ]);\r \t\t// this.export(array, \"导出数据\"+(new Date).format(\"db\"));\r \t\tthis._loadResource( function(){\r \t\t\tvar data = window.xlsxUtils.format2Sheet(array, 0, 0, null);//偏移3行按keyMap顺序转换\r \t\t\tvar wb = window.xlsxUtils.format2WB(data, \"sheet1\", undefined);\r \t\t\tvar wopts = { bookType: 'xlsx', bookSST: false, type: 'binary' };\r \t\t\tvar dataInfo = wb.Sheets[wb.SheetNames[0]];\r \r \t\t\tvar widthArray = [];\r \t\t\tarray[0].each( function( v, i ){ //设置标题行样式\r \r \t\t\t\tif( !colWidthArr )widthArray.push( {wpx: 100} );\r \r \t\t\t\tvar at = String.fromCharCode(97 + i).toUpperCase();\r \t\t\t\tvar di = dataInfo[at+\"1\"];\r \t\t\t\t// di.v = v;\r \t\t\t\t// di.t = \"s\";\r \t\t\t\tdi.s = { //设置副标题样式\r \t\t\t\t\tfont: {\r \t\t\t\t\t\t//name: '宋体',\r \t\t\t\t\t\tsz: 12,\r \t\t\t\t\t\tcolor: {rgb: \"#FFFF0000\"},\r \t\t\t\t\t\tbold: true,\r \t\t\t\t\t\titalic: false,\r \t\t\t\t\t\tunderline: false\r \t\t\t\t\t},\r \t\t\t\t\talignment: {\r \t\t\t\t\t\thorizontal: \"center\" ,\r \t\t\t\t\t\tvertical: \"center\"\r \t\t\t\t\t}\r \t\t\t\t};\r \t\t\t}.bind(this));\r \r \t\t\tif( dateIndexArray &amp;&amp; dateIndexArray.length ){\r \t\t\t\tdateIndexArray.each( function( value, index ){\r \t\t\t\t\tdateIndexArray[ index ] = this.index2ColName(value);\r \t\t\t\t}.bind(this))\r \t\t\t}\r \r \t\t\tfor( var key in dataInfo ){\r \t\t\t\t//设置所有样式，wrapText=true 后 /n会被换行\r \t\t\t\tif( key.substr(0, 1) !== \"!\" ){\r \t\t\t\t\tvar di = dataInfo[key];\r \t\t\t\t\tif( !di.s )di.s = {};\r \t\t\t\t\tif( !di.s.alignment )di.s.alignment = {};\r \t\t\t\t\tdi.s.alignment.wrapText = true;\r \r \t\t\t\t\tdebugger;\r \r \t\t\t\t\tif( dateIndexArray &amp;&amp; dateIndexArray.length ){\r \t\t\t\t\t\tvar colName = key.replace(/\\d+/g,''); //清除数字\r \t\t\t\t\t\tvar rowNum = key.replace( colName, '');\r \t\t\t\t\t\tif( rowNum > 1 &amp;&amp; dateIndexArray.contains( colName ) ){\r \t\t\t\t\t\t\t//di.s.numFmt = \"yyyy-mm-dd HH:MM:SS\"; //日期列 两种方式都可以\r \t\t\t\t\t\t\tdi.z = 'yyyy-mm-dd HH:MM:SS'; //日期列\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \t\t\t\t}\r \r \t\t\t}\r \r \t\t\tif( colWidthArr ){\r \t\t\t\tcolWidthArr.each( function (w) {\r \t\t\t\t\twidthArray.push( {wpx: w} );\r \t\t\t\t})\r \t\t\t}\r \t\t\tdataInfo['!cols'] = widthArray; //列宽度\r \r \t\t\tthis._openDownloadDialog(window.xlsxUtils.format2Blob(wb), fileName +\".xlsx\");\r \t\t}.bind(this))\r \t},\r \timport : function( file, callback, dateColArray ){\r \t\tthis._loadResource( function(){\r \t\t\tvar reader = new FileReader();\r \t\t\tvar workbook, data;\r \t\t\treader.onload = function (e) {\r \t\t\t\t//var data = data.content;\r \t\t\t\tif (!e) {\r \t\t\t\t\tdata = reader.content;\r \t\t\t\t}else {\r \t\t\t\t\tdata = e.target.result;\r \t\t\t\t}\r \t\t\t\tworkbook = window.XLSX.read(data, { type: 'binary' });\r \t\t\t\t//wb.SheetNames[0]是获取Sheets中第一个Sheet的名字\r \t\t\t\t//wb.Sheets[Sheet名]获取第一个Sheet的数据\r \t\t\t\tvar sheet = workbook.SheetNames[0];\r \t\t\t\tif (workbook.Sheets.hasOwnProperty(sheet)) {\r \t\t\t\t\t// fromTo = workbook.Sheets[sheet]['!ref'];\r \t\t\t\t\t// console.log(fromTo);\r \t\t\t\t\tdebugger;\r \t\t\t\t\tvar worksheet = workbook.Sheets[sheet];\r \r \t\t\t\t\tif( dateColArray &amp;&amp; typeOf(dateColArray) == \"array\" &amp;&amp; dateColArray.length ){\r \t\t\t\t\t\tvar rowCount;\r \t\t\t\t\t\tif( worksheet['!range'] ){\r \t\t\t\t\t\t\trowCount = worksheet['!range'].e.r;\r \t\t\t\t\t\t}else{\r \t\t\t\t\t\t\tvar ref = worksheet['!ref'];\r \t\t\t\t\t\t\tvar arr = ref.split(\":\");\r \t\t\t\t\t\t\tif(arr.length === 2){\r \t\t\t\t\t\t\t\trowCount = parseInt( arr[1].replace(/[^0-9]/ig,\"\") );\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \t\t\t\t\t\tif( rowCount ){\r \t\t\t\t\t\t\tfor( var i=0; i&lt;dateColArray.length; i++ ){\r \t\t\t\t\t\t\t\tfor( var j=1; j&lt;=rowCount; j++ ){\r \t\t\t\t\t\t\t\t\tvar cell = worksheet[ dateColArray[i]+j ];\r \t\t\t\t\t\t\t\t\tif( cell ){\r \t\t\t\t\t\t\t\t\t\tdelete cell.w; // remove old formatted text\r \t\t\t\t\t\t\t\t\t\tcell.z = 'yyyy-mm-dd'; // set cell format\r \t\t\t\t\t\t\t\t\t\twindow.XLSX.utils.format_cell(cell); // this refreshes the formatted text.\r \t\t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t\t}\r \t\t\t\t\t\t\t}\r \t\t\t\t\t\t}\r \t\t\t\t\t}\r \r \t\t\t\t\tvar json = window.XLSX.utils.sheet_to_json( worksheet );\r \t\t\t\t\t//var data = window.XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheet], {dateNF:'YYYY-MM-DD'});\r \t\t\t\t\tif(callback)callback(json);\r \t\t\t\t\t// console.log(JSON.stringify(json));\r \t\t\t\t\t// break; // 如果只取第一张表，就取消注释这行\r \t\t\t\t}\r \t\t\t\t// for (var sheet in workbook.Sheets) {\r \t\t\t\t// if (workbook.Sheets.hasOwnProperty(sheet)) {\r \t\t\t\t// fromTo = workbook.Sheets[sheet]['!ref'];\r \t\t\t\t// console.log(fromTo);\r \t\t\t\t// var json = window.XLSX.utils.sheet_to_json(workbook.Sheets[sheet]);\r \t\t\t\t// console.log(JSON.stringify(json));\r \t\t\t\t// // break; // 如果只取第一张表，就取消注释这行\r \t\t\t\t// }\r \t\t\t\t// }\r \t\t\t};\r \t\t\treader.readAsBinaryString(file);\r \t\t})\r \t}\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Div.js.html":{"url":"x_component_process_Xform_Div.js.html","title":"x_component_process_Xform/Div.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Div.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Div.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Div 容器组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var div = this.form.get(\"name\"); //获取组件\r * //方法2\r * var div = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Div = MWF.APPDiv = new Class({\r Extends: MWF.APP$Module\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Documenteditor.js.html":{"url":"x_component_process_Xform_Documenteditor.js.html","title":"x_component_process_Xform/Documenteditor.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Documenteditor.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Documenteditor.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Documenteditor 公文编辑器。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var documenteditor = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var documenteditor = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Documenteditor = MWF.APPDocumenteditor = new Class(\r /** @lends MWF.xApplication.process.Xform.Documenteditor# */\r {\r Extends: MWF.APP$Module,\r options: {\r /**\r * 当公文编辑器内容每次被渲染的时候都会触发。\r * @event MWF.xApplication.process.Xform.Documenteditor#loadPage\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"beforeLoad\", \"postLoad\", \"afterLoad\", \"loadPage\"],\r \"docPageHeight\": 850.4,\r \"docPageFullWidth\": 794,\r \"pageShow\": \"single\"\r },\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r _loadCss: function(reload){\r var key = encodeURIComponent(this.cssPath);\r if (!reload &amp;&amp; o2.widget.css[key]){\r this.css = o2.widget.css[key];\r }else{\r this.cssPath = (this.cssPath.indexOf(\"?\")!=-1) ? this.cssPath+\"&amp;v=\"+o2.version.v : this.cssPath+\"?v=\"+o2.version.v;\r var r = new Request.JSON({\r url: this.cssPath,\r secure: false,\r async: false,\r method: \"get\",\r noCache: false,\r onSuccess: function(responseJSON, responseText){\r this.css = responseJSON;\r o2.widget.css[key] = responseJSON;\r }.bind(this),\r onError: function(text, error){\r console.log(error + text);\r }\r });\r r.send();\r }\r },\r load: function(){\r if (!this.json.isDelay){\r this.active();\r }\r },\r /**\r * 激活公文编辑器编辑。设置了延迟加载的时候，可以通过这个方法来激活\r * @example\r * this.form.get(\"fieldId\").active();\r */\r active: function(){\r this._loadModuleEvents();\r if (this.fireEvent(\"queryLoad\")){\r this.fireEvent(\"beforeLoad\");\r this.cssPath = this.form.path+this.form.options.style+\"/doc.wcss\";\r this._loadCss();\r \r this._queryLoaded();\r this._loadUserInterface(function(){\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"afterLoad\");\r this.fireEvent(\"load\");\r \r this.form.app.addEvent(\"resize\", function(){\r // if (this.options.pageShow!==\"double\"){\r // this._doublePage();\r // }else{\r this._singlePage();\r // }\r this._checkScale();\r }.bind(this));\r }.bind(this));\r this._loadStyles();\r \r this._afterLoaded();\r }\r },\r \r _createNewPage: function(){\r var pageNode = new Element(\"div.doc_layout_page\", {\"styles\": this.css.doc_page}).inject(this.contentNode);\r var pageContentNode = new Element(\"div.doc_layout_page_content\", {\"styles\": this.css.doc_layout_page_content}).inject(pageNode);\r pageNode.set(\"data-pagecount\", this.pages.length+1);\r this.pages.push(pageNode);\r return pageNode;\r },\r _getShow: function(name, typeItem, scriptItem){\r switch (this.json[typeItem]) {\r case \"y\":\r return true;\r case \"n\":\r return false;\r case \"a\":\r if ([\"copies\", \"secret\", \"priority\", \"attachment\", \"annotation\", \"copyto\", \"copyto2\"].indexOf(name!=-1)){\r return !!this.data[name] &amp;&amp; (!!this.data[name].length);\r }\r return true;\r case \"s\":\r if (this.json[scriptItem] &amp;&amp; this.json[scriptItem].code){\r return !!this.form.Macro.exec(this.json[scriptItem].code, this);\r }\r return true;\r default:\r return true;\r }\r },\r _createPage: function(callback){\r var pageContentNode = this._createNewPage().getFirst();\r \r var control = this.getShowControl();\r this.json.fileup = !!(control.signer);\r \r if (this.json.css &amp;&amp; this.json.css.code &amp;&amp; !this.styleNode){\r var cssText = this.form.parseCSS(this.json.css.code);\r cssText = cssText.replace(/documenteditor_table/g, 'documenteditor_table'+this.form.json.id+this.json.id)\r \r \r // var rex = new RegExp(\"(.+)(?=\\\\{)\", \"g\");\r // var match;\r // var id = this.json.id.replace(/\\-/g, \"\");\r // var prefix = this.form.json.id+this.json.id;\r //\r // while ((match = rex.exec(cssText)) !== null) {\r // var rulesStr = match[0];\r // if (rulesStr.indexOf(\",\")!=-1){\r // var rules = rulesStr.split(/\\s*,\\s*/g);\r // rules = rules.map(function(r){\r // return r+prefix;\r // });\r // var rule = rules.join(\", \");\r // cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r // rex.lastIndex = rex.lastIndex + (prefix.length*rules.length);\r //\r // }else{\r // var rule = match[0]+prefix;\r // cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r // rex.lastIndex = rex.lastIndex + prefix.length;\r // }\r // }\r \r var styleNode = document.createElement(\"style\");\r styleNode.setAttribute(\"type\", \"text/css\");\r styleNode.id=\"style\"+this.json.id;\r //styleNode.inject(pageContentNode);\r styleNode.inject(this.node, \"top\");\r \r if(styleNode.styleSheet){\r var setFunc = function(){\r styleNode.styleSheet.cssText = cssText;\r };\r if(styleNode.styleSheet.disabled){\r setTimeout(setFunc, 10);\r }else{\r setFunc();\r }\r }else{\r var cssTextNode = document.createTextNode(cssText);\r styleNode.appendChild(cssTextNode);\r }\r this.styleNode = styleNode;\r }\r \r if (this.json.documentTempleteType==\"cus\"){\r pageContentNode.loadHtml(o2.filterUrl(this.json.documentTempleteUrl), function(){\r if (this.json.toWordPageNumber==\"y\") this.doPageStyles(pageContentNode);\r \r if (this.attachmentTemplete){\r var attNode = pageContentNode.getElement(\".doc_layout_attachment_content\");\r if (attNode) attNode.empty();\r }\r if (callback) callback(control);\r this.fireEvent(\"loadPage\");\r }.bind(this));\r }else{\r this.getTempleteJson(function(){\r var templete = this.json.documentTempleteName || \"standard\";\r pageContentNode.loadHtml(o2.filterUrl(\"../x_component_process_FormDesigner/Module/Documenteditor/templete/\"+this.templeteJson[templete].file), function(){\r if (this.json.toWordPageNumber==\"y\") this.doPageStyles(pageContentNode);\r \r if (this.attachmentTemplete){\r var attNode = pageContentNode.getElement(\".doc_layout_attachment_content\");\r if (attNode) attNode.empty();\r }\r if (callback) callback(control);\r this.fireEvent(\"loadPage\");\r }.bind(this));\r }.bind(this));\r }\r },\r doPageStyles: function(pageContentNode){\r var style = pageContentNode.getLast(\"style\");\r if (style){\r var origin = window.location.origin;\r var header = o2.filterUrl(origin+\"/x_component_process_FormDesigner/Module/Documenteditor/header.htm\");\r \r var text = style.get(\"html\");\r var pageRex = /(?:@page\\s*\\{)([\\s\\S]*?)(?:\\})/;\r var arr = text.match(pageRex);\r if (arr &amp;&amp; arr.length){\r cssText = arr[2];\r if (cssText){\r var last = cssText.substr(cssText.length-1,1);\r if (last!==\";\") cssText = cssText+\";\";\r cssText += \"mso-page-border-surround-header:no;\\n\" +\r \" mso-page-border-surround-footer:no;\\n\" +\r \" mso-footnote-separator:url(\\\"\"+header+\"\\\") fs;\\n\" +\r \" mso-footnote-continuation-separator:url(\\\"\"+header+\"\\\") fcs;\\n\" +\r \" mso-endnote-separator:url(\\\"\"+header+\"\\\") es;\\n\" +\r \" mso-endnote-continuation-separator:url(\\\"\"+header+\"\\\") ecs;\\n\" +\r \" mso-facing-pages:yes;\";\r text = text.replace(arr[0], arr[1]+cssText+arr[3]);\r }\r }else{\r text += \"@page\\n\" +\r \" {mso-page-border-surround-header:no;\\n\" +\r \" mso-page-border-surround-footer:no;\\n\" +\r \" mso-footnote-separator:url(\\\"\"+header+\"\\\") fs;\\n\" +\r \" mso-footnote-continuation-separator:url(\\\"\"+header+\"\\\") fcs;\\n\" +\r \" mso-endnote-separator:url(\\\"\"+header+\"\\\") es;\\n\" +\r \" mso-endnote-continuation-separator:url(\\\"\"+header+\"\\\") ecs;\\n\" +\r \" mso-facing-pages:yes;}\"\r }\r \r pageRex = /(@page\\s*WordSection1\\s*\\{)([\\s\\S]*?)(\\})/;\r arr = text.match(pageRex);\r if (arr &amp;&amp; arr.length){\r cssText = arr[2];\r if (cssText){\r var last = cssText.substr(cssText.length-1,1);\r if (last!==\";\") cssText = cssText+\";\";\r cssText += \"mso-header-margin:42.55pt;\\n\" +\r \" mso-footer-margin:70.9pt;\\n\" +\r \" mso-even-footer:url(\\\"\"+header+\"\\\") ef1;\\n\" +\r \" mso-footer:url(\\\"\"+header+\"\\\") f1;\\n\" +\r \" mso-paper-source:0;\";\r text = text.replace(arr[0], arr[1]+cssText+arr[3]);\r }\r }else{\r text += \"@page WordSection1\\n\" +\r \" {size:595.3pt 841.9pt;\\n\" +\r \" margin:104.9pt 73.7pt 99.25pt 79.4pt;\\n\" +\r \" layout-grid:15.6pt;\\n\" +\r \" line-height:normal;\\n\" +\r \" font-size:16.0pt;\\n\" +\r \" font-family:仿宋;\\n\" +\r \" letter-spacing:-0.4pt;\\n\" +\r \" mso-header-margin:42.55pt;\\n\" +\r \" mso-footer-margin:70.9pt;\\n\" +\r \" mso-even-footer:url(\\\"\"+header+\"\\\") ef1;\\n\" +\r \" mso-footer:url(\\\"\"+header+\"\\\") f1;\\n\" +\r \" mso-paper-source:0;\\n\" +\r \" }\"\r }\r style.set(\"html\", text)\r }\r },\r getTempleteJson: function(callback){\r if (this.templeteJson){\r if (callback) callback();\r }else{\r o2.getJSON(o2.filterUrl(\"../x_component_process_FormDesigner/Module/Documenteditor/templete/templete.json\"), function(json){\r this.templeteJson = json;\r if (callback) callback();\r }.bind(this));\r }\r },\r getShowControl: function(){\r var control = {};\r control.copiesSecretPriority = this._getShow(\"copiesSecretPriority\", \"copiesSecretPriorityShow\", \"copiesSecretPriorityShowScript\");\r \r control.copies = this._getShow(\"copies\", \"copiesShow\", \"copiesShowScript\");\r control.secret = this._getShow(\"secret\", \"secretShow\", \"secretShowScript\");\r control.priority = this._getShow(\"priority\", \"priorityShow\", \"priorityShowScript\");\r \r control.redHeader = this._getShow(\"redHeader\", \"redHeaderShow\", \"redHeaderShowScript\");\r control.redLine = this._getShow(\"redLine\", \"redLineShow\", \"redLineShowScript\");\r \r control.signer = this._getShow(\"signer\", \"signerShow\", \"signerShowScript\");\r control.fileno = this._getShow(\"fileno\", \"filenoShow\", \"filenoShowScript\");\r control.subject = this._getShow(\"subject\", \"subjectShow\", \"subjectShowScript\");\r control.mainSend = this._getShow(\"mainSend\", \"mainSendShow\", \"mainSendShowScript\");\r control.attachment = this._getShow(\"attachment\", \"attachmentShow\", \"attachmentShowScript\");\r control.issuanceUnit = this._getShow(\"issuanceUnit\", \"issuanceUnitShow\", \"issuanceUnitShowScript\");\r control.issuanceDate = this._getShow(\"issuanceDate\", \"issuanceDateShow\", \"issuanceDateShowScript\");\r control.annotation = this._getShow(\"annotation\", \"annotationShow\", \"annotationShowScript\");\r control.copyto = this._getShow(\"copyto\", \"copytoShow\", \"copytoShowScript\");\r control.copyto2 = this._getShow(\"copyto2\", \"copyto2Show\", \"copyto2ShowScript\");\r control.editionUnit = this._getShow(\"editionUnit\", \"editionUnitShow\", \"editionUnitShowScript\");\r control.editionDate = this._getShow(\"editionDate\", \"editionDateShow\", \"editionDateShowScript\");\r \r control.meetingAttend = this._getShow(\"meetingAttend\", \"meetingAttendShow\", \"meetingAttendShowScript\");\r control.meetingLeave = this._getShow(\"meetingLeave\", \"meetingLeaveShow\", \"meetingLeaveShowScript\");\r control.meetingSit = this._getShow(\"meetingSit\", \"meetingSitShow\", \"meetingSitShowScript\");\r control.meetingRecord = this._getShow(\"meetingRecord\", \"meetingRecordShow\", \"meetingRecordShowScript\");\r return control;\r },\r // _getEdit: function(name, typeItem, scriptItem){\r // switch (this.json[typeItem]) {\r // case \"y\":\r // return true;\r // case \"n\":\r // return false;\r // // case \"a\":\r // // if ([\"copies\", \"secret\", \"priority\", \"attachment\", \"annotation\", \"copyto\"].indexOf(name!=-1)){\r // // return !!this.data[name] &amp;&amp; (!!this.data[name].length);\r // // }\r // // return true;\r // case \"s\":\r // if (this.json[scriptItem] &amp;&amp; this.json[scriptItem].code){\r // return !!this.form.Macro.exec(this.json[scriptItem].code, this);\r // }\r // return true;\r // }\r // },\r getEditControl: function(){\r var control = {};\r control.copies = this._getEdit(\"copies\", \"copiesEdit\", \"copiesEditScript\");\r control.secret = this._getEdit(\"secret\", \"secretEdit\", \"secretEditScript\");\r control.priority = this._getEdit(\"priority\", \"priorityEdit\", \"priorityEditScript\");\r control.redHeader = this._getEdit(\"redHeader\", \"redHeaderEdit\", \"redHeaderEditScript\");\r control.signer = this._getEdit(\"signer\", \"signerEdit\", \"signerEditScript\");\r control.fileno = this._getEdit(\"fileno\", \"filenoEdit\", \"filenoEditScript\");\r control.subject = this._getEdit(\"subject\", \"subjectEdit\", \"subjectEditScript\");\r control.mainSend = this._getEdit(\"mainSend\", \"mainSendEdit\", \"mainSendEditScript\");\r control.attachment = this._getEdit(\"attachment\", \"attachmentEdit\", \"attachmentEditScript\");\r control.issuanceUnit = this._getEdit(\"issuanceUnit\", \"issuanceUnitEdit\", \"issuanceUnitEditScript\");\r control.issuanceDate = this._getEdit(\"issuanceDate\", \"issuanceDateEdit\", \"issuanceDateEditScript\");\r control.annotation = this._getEdit(\"annotation\", \"annotationEdit\", \"annotationEditScript\");\r control.copyto = this._getEdit(\"copyto\", \"copytoEdit\", \"copytoEditScript\");\r control.copyto2 = this._getEdit(\"copyto2\", \"copyto2Edit\", \"copyto2EditScript\");\r control.editionUnit = this._getEdit(\"editionUnit\", \"editionUnitEdit\", \"editionUnitEditScript\");\r control.editionDate = this._getEdit(\"editionDate\", \"editionDateEdit\", \"editionDateEditScript\");\r control.meetingAttend = this._getShow(\"meetingAttend\", \"meetingAttendEdit\", \"meetingAttendEditScript\");\r control.meetingLeave = this._getShow(\"meetingLeave\", \"meetingLeaveEdit\", \"meetingLeaveEditScript\");\r control.meetingSit = this._getShow(\"meetingSit\", \"meetingSitEdit\", \"meetingSitEditScript\");\r control.meetingRecord = this._getShow(\"meetingRecord\", \"meetingRecordEdit\", \"meetingRecordEditScript\");\r return control;\r },\r //份数 密级 紧急程度\r _loadCopiesSecretPriority: function(){\r this.layout_copiesSecretPriority = this.contentNode.getElement(\".doc_layout_copiesSecretPriority\");\r if (this.layout_copiesSecretPriority) this.layout_copiesSecretPriority.setStyles(this.css.doc_layout_copiesSecretPriority);\r \r this.layout_copies = this.contentNode.getElement(\".doc_layout_copies\");\r if (this.layout_copies) this.layout_copies.setStyles(this.css.doc_layout_copies);\r \r this.layout_secret = this.contentNode.getElement(\".doc_layout_secret\");\r if (this.layout_secret) this.layout_secret.setStyles(this.css.doc_layout_secret);\r \r this.layout_priority = this.contentNode.getElement(\".doc_layout_priority\");\r if (this.layout_priority) this.layout_priority.setStyles(this.css.doc_layout_priority);\r \r this.layout_copiesSecretPriority_blank = this.contentNode.getElement(\".doc_layout_copiesSecretPriority_blank\");\r \r },\r \r //红头\r _loadRedHeader: function(){\r this.layout_redHeader = this.contentNode.getElement(\".doc_layout_redHeader\");\r if (this.layout_redHeader) this.layout_redHeader.setStyles(this.css.doc_layout_redHeader);\r },\r //文号签发人（上行文）\r _loadFileNoUp: function(){\r this.layout_filenoArea = this.contentNode.getElement(\".doc_layout_fileno_area\");\r this.layout_fileNoUpTable = this.contentNode.getElement(\".doc_layout_filenoup\");\r if (this.layout_fileNoUpTable) this.layout_fileNoUpTable.setStyles(this.css.doc_layout_filenoup);\r \r var td = this.contentNode.getElement(\".doc_layout_filenoup_fileno_td\");\r if (td) td.setStyles(this.css.doc_layout_filenoup_fileno_td);\r \r this.layout_fileno = this.contentNode.getElement(\".doc_layout_filenoup_fileno\");\r if (this.layout_fileno) this.layout_fileno.setStyles(this.css.doc_layout_filenoup_fileno);\r \r td = this.contentNode.getElement(\".doc_layout_filenoup_signer_td\");\r if (td) td.setStyles(this.css.doc_layout_filenoup_signer_td);\r \r var node = this.contentNode.getElement(\".doc_layout_filenoup_signer_table\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signer_table);\r node = this.contentNode.getElement(\".doc_layout_filenoup_signerTitle_td\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signerTitle_td);\r this.layout_signerTitle = this.contentNode.getElement(\".doc_layout_filenoup_signer\");\r if (this.layout_signerTitle) this.layout_signerTitle.setStyles(this.css.doc_layout_filenoup_signer);\r node = this.contentNode.getElement(\".doc_layout_filenoup_signerContent_td\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signerContent_td);\r \r this.layout_signer = this.contentNode.getElement(\".doc_layout_filenoup_signerContent\");\r if (this.layout_signer) this.layout_signer.setStyles(this.css.doc_layout_filenoup_signerContent);\r \r if (!this.layout_fileno){\r this.layout_fileNoUpTable = this.contentNode.getElement(\".doc_layout_filenoup\");\r this.layout_filenoArea = this.contentNode.getElement(\".doc_layout_fileno_area\");\r this.layout_fileno = this.contentNode.getElement(\".doc_layout_fileno\");\r if (this.layout_fileno) this.layout_fileno.setStyles(this.css.doc_layout_fileno);\r }\r },\r \r //文号\r _loadFileNo: function(){\r this.layout_fileNoUpTable = this.contentNode.getElement(\".doc_layout_filenoup\");\r this.layout_filenoArea = this.contentNode.getElement(\".doc_layout_fileno_area\");\r this.layout_fileno = this.contentNode.getElement(\".doc_layout_fileno\");\r if (this.layout_fileno) this.layout_fileno.setStyles(this.css.doc_layout_fileno);\r \r td = this.contentNode.getElement(\".doc_layout_filenoup_signer_td\");\r if (td) td.setStyles(this.css.doc_layout_filenoup_signer_td);\r \r var node = this.contentNode.getElement(\".doc_layout_filenoup_signer_table\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signer_table);\r node = this.contentNode.getElement(\".doc_layout_filenoup_signerTitle_td\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signerTitle_td);\r this.layout_signerTitle = this.contentNode.getElement(\".doc_layout_filenoup_signer\");\r if (this.layout_signerTitle) this.layout_signerTitle.setStyles(this.css.doc_layout_filenoup_signer);\r node = this.contentNode.getElement(\".doc_layout_filenoup_signerContent_td\");\r if (node) node.setStyles(this.css.doc_layout_filenoup_signerContent_td);\r \r this.layout_signer = this.contentNode.getElement(\".doc_layout_filenoup_signerContent\");\r if (this.layout_signer) this.layout_signer.setStyles(this.css.doc_layout_filenoup_signerContent);\r \r if (!this.layout_fileno){\r this.layout_filenoArea = this.contentNode.getElement(\".doc_layout_fileno_area\");\r this.layout_fileNoUpTable = this.contentNode.getElement(\".doc_layout_filenoup\");\r if (this.layout_fileNoUpTable) this.layout_fileNoUpTable.setStyles(this.css.doc_layout_filenoup);\r \r var td = this.contentNode.getElement(\".doc_layout_filenoup_fileno_td\");\r if (td) td.setStyles(this.css.doc_layout_filenoup_fileno_td);\r \r this.layout_fileno = this.contentNode.getElement(\".doc_layout_filenoup_fileno\");\r if (this.layout_fileno) this.layout_fileno.setStyles(this.css.doc_layout_filenoup_fileno);\r }\r },\r \r //红线\r _loadRedLine: function(){\r this.layout_redLine = this.contentNode.getElement(\".doc_layout_redline\");\r if (this.layout_redLine) this.layout_redLine.setStyles(this.css.doc_layout_redline);\r },\r \r //标题\r _loadSubject:function(){\r this.layout_subject = this.contentNode.getElement(\".doc_layout_subject\");\r if (this.layout_subject) this.layout_subject.setStyles(this.css.doc_layout_subject);\r },\r \r //主送\r _loadMainSend: function(){\r this.layout_mainSend = this.contentNode.getElement(\".doc_layout_mainSend\");\r if (this.layout_mainSend) this.layout_mainSend.setStyles(this.css.doc_layout_mainSend);\r },\r \r //正文\r // _createFiletext: function(filetextNode, node, where){\r // if (!filetextNode){\r // var filetextNode = new Element(\"div.doc_layout_filetext\").inject(node, where);\r // filetextNode.addClass(\"doc_block\");\r // filetextNode.setAttribute('contenteditable', true);\r // }\r // CKEDITOR.disableAutoInline = true;\r // var filetextEditor = CKEDITOR.inline(filetextNode, this._getEditorConfig());\r // filetextNode.store(\"editor\", filetextEditor);\r // if (!this.filetextEditors) this.filetextEditors = [];\r // this.filetextEditors.push(filetextEditor);\r //\r // filetextEditor.on( 'blur', function(e) {\r // // var filetextNode = e.editor.container.$;\r // // var pageNode = filetextNode.getParent(\".doc_layout_page\");\r // // this._checkSplitPage(pageNode);\r // // this._repage();\r // }.bind(this));\r //\r // return filetextNode;\r // },\r _loadFiletext: function(){\r this.layout_filetext = this.contentNode.getElement(\".doc_layout_filetext\");\r this.layout_filetext.addClass(\"css\"+this.form.json.id+this.json.id);\r this.layout_filetext.setStyles(this.css.doc_layout_filetext);\r \r //this.layout_filetext = this.contentNode.getElement(\".doc_layout_filetext\");\r // if (this.layout_filetexts.length){\r // this.layout_filetexts.each(function(layout_filetext){\r // layout_filetext.setStyles(this.css.doc_layout_filetext);\r // }.bind(this));\r // }\r },\r \r //附件\r _loadAttachment: function(){\r this.layout_attachmentTable = this.contentNode.getElement(\".doc_layout_attachment\");\r if (this.layout_attachmentTable) this.layout_attachmentTable.setStyles(this.css.doc_layout_attachment);\r \r var node = this.contentNode.getElement(\".doc_layout_attachment_title_td\");\r if (node) node.setStyles(this.css.doc_layout_attachment_title_td);\r \r this.layout_attachmentTitle = this.contentNode.getElement(\".doc_layout_attachment_title\");\r if (node) node.setStyles(this.css.doc_layout_attachment_title);\r \r node = this.contentNode.getElement(\".doc_layout_attachment_content_td\");\r if (node) node.setStyles(this.css.doc_layout_attachment_content_td);\r \r this.layout_attachment = this.contentNode.getElement(\".doc_layout_attachment_content\");\r if (this.layout_attachment) this.layout_attachment.setStyles(this.css.doc_layout_attachment_content);\r },\r \r //发布单位\r _loadIssuance: function(){\r this.layout_issuanceTable = this.contentNode.getElement(\".doc_layout_issuance\");\r this.layout_issuanceUnit = this.contentNode.getElement(\".doc_layout_issuanceUnit\");\r this.layout_issuanceDate = this.contentNode.getElement(\".doc_layout_issuanceDate\");\r \r if (this.layout_issuanceTable) this.layout_issuanceTable.setStyles(this.css.doc_layout_issuance);\r if (this.layout_issuanceUnit) this.layout_issuanceUnit.setStyles(this.css.doc_layout_issuanceUnit);\r if (this.layout_issuanceDate) this.layout_issuanceDate.setStyles(this.css.doc_layout_issuanceDate);\r },\r \r //附注\r _loadAnnotation: function(){\r this.layout_annotation = this.contentNode.getElement(\".doc_layout_annotation\");\r if (this.layout_annotation) this.layout_annotation.setStyles(this.css.doc_layout_annotation);\r },\r \r //版记\r _loadEdition: function(){\r this.layout_editionArea = this.contentNode.getElement(\".doc_layout_editionArea\");\r this.layout_edition = this.contentNode.getElement(\".doc_layout_edition\");\r if (this.layout_edition) this.layout_edition.setStyles(this.css.doc_layout_edition);\r \r var node = this.contentNode.getElement(\".doc_layout_edition_copyto\");\r if (node) node.setStyles(this.css.doc_layout_edition_copyto);\r node = this.contentNode.getElement(\".doc_layout_edition_copyto_table\");\r if (node) node.setStyles(this.css.doc_layout_edition_copyto_table);\r \r var node = this.contentNode.getElement(\".doc_layout_edition_copyto2\");\r if (node) node.setStyles(this.css.doc_layout_edition_copyto);\r node = this.contentNode.getElement(\".doc_layout_edition_copyto2_table\");\r if (node) node.setStyles(this.css.doc_layout_edition_copyto_table);\r \r this.layout_copytoTitle = this.contentNode.getElement(\".doc_layout_edition_copyto_title\");\r if (this.layout_copytoTitle) this.layout_copytoTitle.setStyles(this.css.doc_layout_edition_copyto_title);\r this.layout_copytoContent = this.contentNode.getElement(\".doc_layout_edition_copyto_content\");\r if (this.layout_copytoContent) this.layout_copytoContent.setStyles(this.css.doc_layout_edition_copyto_content);\r \r this.layout_copyto2Title = this.contentNode.getElement(\".doc_layout_edition_copyto2_title\");\r if (this.layout_copyto2Title) this.layout_copyto2Title.setStyles(this.css.doc_layout_edition_copyto_title);\r this.layout_copyto2Content = this.contentNode.getElement(\".doc_layout_edition_copyto2_content\");\r if (this.layout_copyto2Content) this.layout_copyto2Content.setStyles(this.css.doc_layout_edition_copyto_content);\r \r var issuance = this.contentNode.getElement(\".doc_layout_edition_issuance\");\r if (issuance) issuance.setStyles(this.css.doc_layout_edition_issuance);\r var issuance_table = this.contentNode.getElement(\".doc_layout_edition_issuance_table\");\r if (issuance_table) issuance_table.setStyles(this.css.doc_layout_edition_issuance_table);\r this.layout_edition_issuance_unit = this.contentNode.getElement(\".doc_layout_edition_issuance_unit\");\r if (this.layout_edition_issuance_unit) this.layout_edition_issuance_unit.setStyles(this.css.doc_layout_edition_issuance_unit);\r this.layout_edition_issuance_date = this.contentNode.getElement(\".doc_layout_edition_issuance_date\");\r if (this.layout_edition_issuance_date) this.layout_edition_issuance_date.setStyles(this.css.doc_layout_edition_issuance_date);\r },\r \r _loadMeeting: function(){\r this.layout_meetingAttendArea = this.contentNode.getElement(\".doc_layout_meeting_attend\");\r this.layout_meetingAttendTitle = this.contentNode.getElement(\".doc_layout_meeting_attend_title\");\r this.layout_meetingAttendContent = this.contentNode.getElement(\".doc_layout_meeting_attend_content\");\r \r this.layout_meetingLeaveArea = this.contentNode.getElement(\".doc_layout_meeting_leave\");\r this.layout_meetingLeaveTitle = this.contentNode.getElement(\".doc_layout_meeting_leave_title\");\r this.layout_meetingLeaveContent = this.contentNode.getElement(\".doc_layout_meeting_leave_content\");\r \r this.layout_meetingSitArea = this.contentNode.getElement(\".doc_layout_meeting_sit\");\r this.layout_meetingSitTitle = this.contentNode.getElement(\".doc_layout_meeting_sit_title\");\r this.layout_meetingSitContent = this.contentNode.getElement(\".doc_layout_meeting_sit_content\");\r \r this.layout_meetingRecordArea = this.contentNode.getElement(\".doc_layout_meeting_record\");\r this.layout_meetingRecordTitle = this.contentNode.getElement(\".doc_layout_meeting_record_title\");\r this.layout_meetingRecordContent = this.contentNode.getElement(\".doc_layout_meeting_record_content\");\r },\r _loadCustom: function(){\r \r var nodes = this.contentNode.getElements(\".doc_layout\");\r nodes.each(function(node){\r var name = node.get(\"data-doc-layout\");\r if (!this.customLayouts) this.customLayouts = [];\r this.customLayouts.push({\r \"name\": name,\r \"node\": node,\r });\r this[name] = node;\r }.bind(this));\r },\r _loadPageLayout: function(control){\r this._loadCopiesSecretPriority();\r this._loadRedHeader();\r \r if (this.json.fileup){\r this._loadFileNoUp();\r }else{\r this._loadFileNo();\r }\r if (!this.layout_fileno) this._loadFileNo();\r \r this._loadRedLine();\r this._loadSubject();\r \r this._loadMainSend();\r this._loadFiletext();\r this._loadAttachment();\r \r this._loadIssuance();\r \r this._loadAnnotation();\r \r this._loadEdition();\r \r //会议纪要\r this._loadMeeting();\r \r //自定义\r this._loadCustom();\r \r \r \r this.reSetShow(control);\r this.reSetEdit();\r \r // 份数: this.layout_copies\r // 密级: this.layout_secret\r // 紧急程度: this.layout_priority\r // 红头: this.layout_redHeader\r // 上行文编号签发： this.layout_fileNoUpTable\r // 文号: this.layout_fileno\r // 签发: this.layout_signerTitle\r // 签发人: this.layout_signer\r // 文号： this.layout_fileno\r // 红线： this.layout_redLine\r // 标题： this.layout_subject\r // 主送单位： this.layout_mainSend\r // 正文： this.layout_filetexts\r // 附件： this.layout_attachmentTitle\r // 附件： this.layout_attachment\r // 单位： this.layout_issuanceUnit\r // 签发时间： this.layout_issuanceDate\r // 附注： this.layout_annotation\r // 抄送： this.layout_copytoTitle\r // 抄送： this.layout_copytoContent\r // 版记单位 this.layout_edition_issuance_unit\r // 版记日期 this.layout_edition_issuance_date\r },\r \r reSetShow: function(control){\r if (!control) control = this.getShowControl();\r var m = function(s){ return (control[s]) ? \"show\" : \"hide\"; }\r \r if (this.layout_copiesSecretPriority) this.layout_copiesSecretPriority[m(\"copiesSecretPriority\")]();\r // control.copies = this._getShow(\"copies\", \"copiesShow\", \"copiesShowScript\");\r // control.secret = this._getShow(\"secret\", \"secretShow\", \"secretShowScript\");\r // control.priority = this._getShow(\"priority\", \"priorityShow\", \"priorityShowScript\");\r var n = 0;\r if (!control.copies) n++;\r if (!control.secret) n++;\r if (!control.priority) n++;\r if (this.layout_copiesSecretPriority_blank){\r while (n>0){\r this.layout_copiesSecretPriority_blank.empty();\r this.layout_copiesSecretPriority_blank.appendHTML(\"&lt;span style='font-size:16.0pt'>&amp;nbsp;&lt;/span>\");\r n--;\r }\r }\r \r if (this.layout_copies) this.layout_copies[m(\"copies\")]();\r if (this.layout_secret) this.layout_secret[m(\"secret\")]();\r if (this.layout_priority) this.layout_priority[m(\"priority\")]();\r \r if (this.layout_redHeader) this.layout_redHeader[m(\"redHeader\")]();\r if (this.layout_redLine) this.layout_redLine[m(\"redLine\")]();\r \r if (this.layout_fileNoUpTable) this.layout_fileNoUpTable[m(\"signer\")]();\r if (this.layout_filenoArea) this.layout_filenoArea[(!control.signer) ? \"show\" : \"hide\"]();\r \r \r if (this.layout_signerTitle) this.layout_signerTitle[m(\"signer\")]();\r if (this.layout_signer) this.layout_signer[m(\"signer\")]();\r \r \r if (this.layout_fileno) this.layout_fileno[m(\"fileno\")]();\r if (this.layout_subject) this.layout_subject[m(\"subject\")]();\r if (this.layout_mainSend) this.layout_mainSend[m(\"mainSend\")]();\r if (this.layout_attachmentTable) this.layout_attachmentTable[m(\"attachment\")]();\r if (this.layout_issuanceUnit) this.layout_issuanceUnit[m(\"issuanceUnit\")]();\r if (this.layout_issuanceDate) this.layout_issuanceDate[m(\"issuanceDate\")]();\r \r \r if (this.layout_issuanceUnit &amp;&amp; this.layout_issuanceDate){\r var table = this.layout_issuanceUnit.getParent(\"table\")\r if (table &amp;&amp; !table.hasClass(\"doc_layout_headIssuance\")) {\r var unitWidth = o2.getTextSize(this.layout_issuanceUnit.get(\"text\"), {\r \"font-size\": \"16pt\",\r \"font-family\": \"'Times New Roman',仿宋\",\r \"letter-spacing\": \"-0.4pt\"\r }).x;\r var dateWidth = o2.getTextSize(this.layout_issuanceDate.get(\"text\"), {\r \"font-size\": \"16pt\",\r \"font-family\": \"'Times New Roman',仿宋\",\r \"letter-spacing\": \"-0.4pt\"\r }).x;\r // var unitWidth = this.layout_issuanceUnit.getSize().x;\r // var dateWidth = this.layout_issuanceDate.getSize().x;\r if (unitWidth &lt; dateWidth) {\r var flagTd = this.layout_issuanceUnit.getParent(\"td\").getNext(\"td\");\r if (flagTd) {\r var pt = ((dateWidth - unitWidth) / 96) * 72 + 32 + 32;\r flagTd.setStyle(\"width\", \"\" + pt + \"pt\");\r }\r table = this.layout_issuanceDate.getParent(\"table\");\r table.setStyle(\"width\", \"auto\");\r flagTd = this.layout_issuanceDate.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var p = this.layout_issuanceDate.getParent(\"p\");\r if (p) p.setStyle(\"text-align\", \"right\");\r \r } else {\r var flagTd = this.layout_issuanceUnit.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var table = this.layout_issuanceUnit.getParent(\"table\");\r var x = table.getSize().x;\r \r table = this.layout_issuanceDate.getParent(\"table\");\r table.setStyle(\"width\", \"\" + x + \"px\");\r \r flagTd = this.layout_issuanceDate.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var p = this.layout_issuanceDate.getParent(\"p\");\r if (p) p.setStyle(\"text-align\", \"center\");\r }\r }\r }\r \r if (this.layout_annotation) this.layout_annotation[m(\"annotation\")]();\r \r if ((!control.copyto || !this.layout_copytoContent) &amp;&amp; (!control.copyto2 || !this.layout_copyto2Content) &amp;&amp; (!control.editionUnit || !this.layout_edition_issuance_unit) &amp;&amp; (!control.editionDate || !this.layout_edition_issuance_date)){\r if (this.layout_editionArea) this.layout_editionArea.hide();\r }else{\r if ((!control.copyto || !this.layout_copytoContent) &amp;&amp; (!control.copyto2 || !this.layout_copyto2Content) ){\r if (this.layout_edition){\r if (this.layout_copytoContent) this.layout_copytoContent.getParent(\"tr\").destroy();\r if (this.layout_copyto2Content) this.layout_copyto2Content.getParent(\"tr\").destroy();\r // if (this.layout_edition) this.layout_edition.getElement(\"tr\").getElements(\"td\")[0].setStyles({\r // \"border-top\": \"solid windowtext 1.5pt\",\r // \"mso-border-top-alt\": \"solid windowtext 1pt\"\r // });\r }\r }else if (!control.copyto || !this.layout_copytoContent){\r if (this.layout_copytoContent) this.layout_copytoContent.getParent(\"tr\").destroy();\r //if (this.layout_copyto2Content) this.layout_edition.getElement(\"tr\").destroy();\r // if (this.layout_edition) this.layout_edition.getElement(\"tr\").getElements(\"td\").setStyles({\r // \"border-top\": \"solid windowtext 1.5pt\",\r // \"mso-border-top-alt\": \"solid windowtext 1pt\"\r // });\r }else if (!control.copyto2 || !this.layout_copyto2Content) {\r if (this.layout_copyto2Content) this.layout_copyto2Content.getParent(\"tr\").destroy();\r // if (this.layout_edition) this.layout_edition.getElement(\"tr\").getElements(\"td\").setStyles({\r // \"border-bottom\": \"solid windowtext 0.75pt\",\r // \"mso-border-bottom-alt\": \"solid windowtext 0.75pt\"\r // });\r }\r if ((!control.editionUnit || !this.layout_edition_issuance_unit) &amp;&amp; (!control.editionDate || !this.layout_edition_issuance_date)){\r if (this.layout_editionArea &amp;&amp; (this.layout_edition_issuance_date || this.layout_edition_issuance_unit)){\r var trs = this.layout_editionArea.getElement(\"table\").rows;\r trs.item(trs.length-1).destroy();\r // trs = this.layout_editionArea.getElement(\"table\").rows;\r // var tr = trs.item(trs.length-1);\r // if (tr){\r // tr.getElements(\"td\").setStyles({\r // \"border-bottom\": \"solid windowtext 1.5pt\",\r // \"mso-border-bottom-alt\": \"solid windowtext 1pt\"\r // });\r // }\r }\r }\r if (this.layout_editionArea &amp;&amp; (this.layout_edition_issuance_date || this.layout_edition_issuance_unit)){\r trs = this.layout_editionArea.getElement(\"table\").rows;\r for (var i=0; i&lt;trs.length; i++){\r var tds = trs.item(i).cells;\r for (var n=0; n&lt;tds.length; n++){\r var td = tds.item(n);\r var tdClass = td.get(\"class\");\r var tdClassList = (tdClass) ? tdClass.split(/\\s+/g) : [];\r \r if (tdClassList.indexOf(\"line_top_thin_bottom_thick\") != -1) tdClassList = tdClassList.erase(\"line_top_thin_bottom_thick\");\r if (tdClassList.indexOf(\"line_top_thick_bottom_thin\") != -1) tdClassList = tdClassList.erase(\"line_top_thick_bottom_thin\");\r if (tdClassList.indexOf(\"line_top_thick_bottom_thick\") != -1) tdClassList = tdClassList.erase(\"line_top_thick_bottom_thick\");\r \r if (tdClassList.indexOf(\"line_top_thin_bottom_thin\") == -1) tdClassList.unshift(\"line_top_thin_bottom_thin\");\r \r // td.setStyles({\r // \"border-top\": \"solid windowtext 0.75pt\",\r // \"mso-border-top-alt\": \"solid windowtext 0.75pt\",\r // \"border-bottom\": \"solid windowtext 0.75pt\",\r // \"mso-border-bottom-alt\": \"solid windowtext 0.75pt\",\r // });\r if (i==0 &amp;&amp; i!=(trs.length-1)){\r if (tdClassList.indexOf(\"line_top_thin_bottom_thin\") != -1) tdClassList = tdClassList.erase(\"line_top_thin_bottom_thin\");\r tdClassList.unshift(\"line_top_thick_bottom_thin\");\r // td.setStyles({\r // \"border-top\": \"solid windowtext 1.5pt\",\r // \"mso-border-top-alt\": \"solid windowtext 1pt\"\r // });\r }else if (i==0 &amp;&amp; i==(trs.length-1)){\r if (tdClassList.indexOf(\"line_top_thin_bottom_thin\") != -1) tdClassList = tdClassList.erase(\"line_top_thin_bottom_thin\");\r tdClassList.unshift(\"line_top_thick_bottom_thick\");\r }else if (i!=0 &amp;&amp; i==(trs.length-1)){\r if (tdClassList.indexOf(\"line_top_thin_bottom_thin\") != -1) tdClassList = tdClassList.erase(\"line_top_thin_bottom_thin\");\r tdClassList.unshift(\"line_top_thin_bottom_thick\");\r }\r // if (i==(trs.length-1)){\r // if (tdClassList.indexOf(\"line_bottom_thin\") != -1) tdClassList = tdClassList.erase(\"line_bottom_thin\");\r // if (tdClassList.indexOf(\"line_bottom_thick\") == -1) tdClassList.push(\"line_bottom_thick\");\r // // td.setStyles({\r // // \"border-bottom\": \"solid windowtext 1.5pt\",\r // // \"mso-border-bottom-alt\": \"solid windowtext 1pt\"\r // // });\r // }\r \r tdClass = tdClassList.join(\" \");\r td.set(\"class\", tdClass);\r }\r }\r }\r \r var coptyToTitleNode = (this.layout_copytoTitle || this.layout_copyto2Title);\r if (coptyToTitleNode){\r var editionTable = coptyToTitleNode.getParent(\"table\");\r if (editionTable) if (editionTable.get(\"data-compute-style\")==\"y\"){\r var rows = editionTable.rows;\r for (var i=0; i&lt;rows.length; i++){\r var cell = rows[i].cells[0];\r \r var tmp = cell.getElement(\".doc_layout_edition_issuance_unit\");\r if (!tmp) tmp = cell.getElement(\".doc_layout_edition_issuance_date\");\r if (!tmp){\r var text = cell.get(\"text\").trim();\r var l = 14*text.length;\r var wl = 19*text.length;\r cell.setStyles({\r \"max-width\": \"\"+l+\"pt\",\r \"min-width\": \"\"+l+\"pt\",\r \"width\": \"\"+wl+\"pt\"\r });\r }\r }\r }\r }\r \r \r \r if (this.layout_editionArea) this.layout_editionArea.show();\r if (this.layout_copytoTitle) this.layout_copytoTitle[m(\"copyto\")]();\r if (this.layout_copytoContent) this.layout_copytoContent[m(\"copyto\")]();\r if (this.layout_copyto2Title) this.layout_copyto2Title[m(\"copyto2\")]();\r if (this.layout_copyto2Content) this.layout_copyto2Content[m(\"copyto2\")]();\r \r if (this.layout_edition_issuance_unit) this.layout_edition_issuance_unit[m(\"editionUnit\")]();\r if (this.layout_edition_issuance_date) this.layout_edition_issuance_date[m(\"editionDate\")]();\r }\r \r if (this.layout_meetingAttendArea) this.layout_meetingAttendArea[m(\"meetingAttend\")]();\r if (this.layout_meetingLeaveArea) this.layout_meetingLeaveArea[m(\"meetingLeave\")]();\r if (this.layout_meetingSitArea) this.layout_meetingSitArea[m(\"meetingSit\")]();\r if (this.layout_meetingRecordArea) this.layout_meetingRecordArea[m(\"meetingRecord\")]();\r \r // this.layout_annotation[m(\"annotation\")]();\r // this.layout_annotation[m(\"annotation\")]();\r // this.layout_annotation[m(\"annotation\")]();\r },\r reSetEdit: function(control){\r //未进行数据绑定时，可允许编辑\r if (!control) var control = this.getEditControl();\r if (this.layout_subject){\r if (!this.json.subjectValueData &amp;&amp; this.json.subjectValueType==\"data\"){\r this.layout_subject.set(\"contenteditable\", control.subject);\r // this.layout_subject.addEvent(\"blur\", function(){\r // this.getData();\r // }.bind(this))\r this.layout_subject.addEvent(\"blur\", function(e){\r var subject = this.layout_subject.get(\"text\");\r if (!subject){\r this.layout_subject.set(\"html\", this.data.subject);\r this.form.app.notice(MWF.xApplication.process.Xform.LP.subjectEmpty, \"error\", this.layout_subject, {\"x\": \"center\",\"y\":\"top\"}, {\"x\": 0,\"y\":60});\r e.preventDefault();\r e.stopPropagation();\r }else{\r this.getData();\r }\r }.bind(this));\r }\r }\r \r if (this.layout_issuanceUnit){\r if (!this.json.issuanceUnitValueData &amp;&amp; this.json.issuanceUnitValueType==\"data\"){\r this.layout_issuanceUnit.set(\"contenteditable\", control.issuanceUnit);\r // this.layout_issuanceUnit.addEvent(\"blur\", function(){\r // this.getData();\r // }.bind(this))\r \r this.layout_issuanceUnit.addEvent(\"blur\", function(e){\r var issuanceUnit = this.layout_issuanceUnit.get(\"text\");\r if (!issuanceUnit){\r this.layout_issuanceUnit.set(\"html\", this.data.issuanceUnit);\r this.form.app.notice(MWF.xApplication.process.Xform.LP.issuanceUnitEmpty, \"error\", this.layout_issuanceUnit, {\"x\": \"center\",\"y\":\"top\"}, {\"x\": 0,\"y\":60});\r e.preventDefault();\r e.stopPropagation();\r }else{\r this.getData();\r }\r }.bind(this));\r }\r }\r \r \r // this.layout_subject.addEvent(\"keydown\", function(e){\r // debugger;\r // if (this.json.subjectValueType==\"data\" &amp;&amp; this.json.subjectValueData){\r // // var v = e.target.get(\"HTML\");\r // // this.form.businessData.data[this.json.subjectValueData] = v\r // var module = this.form.all[this.json.subjectValueData];\r // if (module){\r // var bindFun = module.node.retrieve(this.json.id+\"bindFun\");\r // module.node\r // }\r // }\r // }.bind(this));\r },\r \r _loadUserInterface: function(callback){\r this.node.empty();\r this.node.setStyles(this.form.css.documentEditorNode);\r this.pages = [];\r \r this.allowEdit = this._isAllowEdit();\r this.allowPrint = this._isAllowPrint();\r this.allowHistory = this._isAllowHistory();\r this.toolNode = new Element(\"div\", {\"styles\": this.css.doc_toolbar}).inject(this.node);\r this.contentNode = new Element(\"div#doc_content\", {\"styles\": this.css.doc_content}).inject(this.node);\r \r if (!this.form.isLoaded){\r this.form.addEvent(\"afterModulesLoad\", function(){this.loadDocumentEditor(callback);}.bind(this));\r }else{\r this.loadDocumentEditor(callback);\r }\r \r },\r loadDocumentEditor: function(callback){\r this._loadToolbars();\r this._loadFiletextPage(function(){\r if (this.options.pageShow!==\"double\"){\r this._singlePage();\r }else{\r this._doublePage();\r }\r \r // this.form.addEvent(\"beforeProcess\", function(){\r // this.resetData();\r // if (this.checkSaveNewEdition()) this.saveNewDataEdition();\r // this.notSaveResetData = true;\r // }.bind(this));\r this.form.addEvent(\"beforeSave\", function(){\r this.resetData();\r this.checkSaveNewEdition();\r //if (!this.notSaveResetData) this.resetData();\r }.bind(this));\r \r if (this.json.toWord==\"y\"){\r if (this.json.toWordTrigger==\"open\") this.docToWord();\r if (this.json.toWordTrigger==\"save\") this.form.addEvent(\"beforeSave\", this.docToWord.bind(this));\r if (this.json.toWordTrigger==\"submit\") this.form.addEvent(\"beforeProcess\", this.docToWord.bind(this));\r }\r if (!layout.mobile) this.loadSideToolbar();\r \r o2.load(\"../o2_lib/diff-match-patch/diff_match_patch.js\");\r \r if (this.form.businessData.data[\"$work\"]){\r var id = this.form.businessData.data[\"$work\"].job;\r o2.Actions.load(\"x_processplatform_assemble_surface\").DocumentVersionAction.listWithJobCategory(id, this.json.id, function(json){\r this.historyDocumentList = json.data;\r if (this.historyDocumentList.length){\r o2.Actions.load(\"x_processplatform_assemble_surface\").DocumentVersionAction.get(this.historyDocumentList[this.historyDocumentList.length-1].id, function(json){\r var data = JSON.parse(json.data.data);\r this.originaHistoryData = data.data;\r }.bind(this));\r }\r }.bind(this));\r }\r \r \r if (callback) callback();\r }.bind(this));\r \r if (!this.form.documenteditorList) this.form.documenteditorList=[];\r this.form.documenteditorList.push(this);\r },\r \r checkSaveNewEdition: function(callback){\r \r if (!this.allowEdit || !this.data.filetext || this.data.filetext == this.json.defaultValue.filetext) return false;\r if (this.form.businessData.work){\r var originaData = this.form.businessData.originalData[this.json.id];\r var editionData = {\"category\": this.json.id};\r if (!originaData || !originaData.filetext || !this.originaHistoryData){\r //保存原始版本\r this.originaHistoryData = {\"data\": this.data.filetext};\r editionData.data = JSON.stringify({\"data\": this.data.filetext});\r }else if (originaData.filetext!=this.data.filetext){\r //保存历史版本\r var data = this.data.filetext;\r var earlyData = originaData.filetext;\r var dmp = new diff_match_patch();\r var diff_d = dmp.diff_main(earlyData, data);\r dmp.diff_cleanupSemantic(diff_d);\r var patch_list = dmp.patch_make(earlyData, data, diff_d);\r editionData.data = JSON.stringify({\"patchs\": dmp.patch_toText(patch_list)});\r }else{\r return false;\r }\r o2.Actions.load(\"x_processplatform_assemble_surface\").DocumentVersionAction.create(this.form.businessData.work.id, editionData, function(json){\r //originaData.filetext = this.data.filetext;\r if (callback) callback();\r }.bind(this));\r }\r },\r // saveNewDataEdition: function(callback){\r // if (this.form.businessData.work){\r // var editionData = {\"category\": this.json.id};\r // if (this.form.businessData.originalData[this.json.id] &amp;&amp; this.form.businessData.originalData[this.json.id].filetext){\r // var data = this.data.filetext;\r // var earlyData = this.form.businessData.originalData[this.json.id].filetext;\r // var dmp = new diff_match_patch();\r // var diff_d = dmp.diff_main(earlyData, data);\r // dmp.diff_cleanupSemantic(diff_d);\r // var patch_list = dmp.patch_make(earlyData, data, diff_d);\r // editionData.data = {\"patchs\": dmp.patch_toText(patch_list)};\r //\r // }else{\r // editionData.data = {\"data\": this.data.filetext};\r // }\r // o2.Actions.load(\"x_processplatform_assemble_surface\").DocumentVersionAction.create(this.form.businessData.work.id, editionData, function(json){\r // this.form.businessData.originalData[this.json.id] = this.data.filetext;\r // if (callback) callback();\r // }.bind(this));\r // }\r // },\r resizeToolbar: function(){\r if (this.toolbarNode){\r var p = this.toolNode.getPosition(this.scrollNode);\r var size = this.toolNode.getSize();\r var pl = this.toolbarNode.getStyle(\"padding-left\").toInt();\r var pr = this.toolbarNode.getStyle(\"padding-right\").toInt();\r var x = size.x-pl-pr;\r \r //var pNode = this.toolNode.getOffsetParent();\r \r var paddingTop = this.form.node.getStyle(\"padding-top\");\r try {\r paddingTop = paddingTop.toInt();\r }catch (e) {\r paddingTop = 0;\r }\r \r if (p.y&lt;paddingTop){\r this.toolbarNode.inject(this.scrollNode);\r this.toolbarNode.setStyles({\r \"position\": \"absolute\",\r \"width\": \"\"+x+\"px\",\r \"z-index\": 200,\r \"top\": paddingTop+\"px\",\r \"left\": \"\"+p.x+\"px\"\r });\r }else{\r this.toolbarNode.inject(this.toolNode);\r this.toolbarNode.setStyles({\"position\": \"static\"});\r }\r }\r },\r resizeSidebar: function(){\r if (this.sidebarNode){\r var fileTextNode = this.contentNode.getElement(\"div.doc_layout_filetext\");\r if (fileTextNode){\r this.sidebarNode.position({\r relativeTo: fileTextNode,\r position: 'topLeft',\r edge: 'topRight',\r offset: {\"x\": -20, \"y\": 60}\r });\r \r var p = fileTextNode.getPosition(this.form.app.content);\r var ptop = fileTextNode.getPosition(this.node);\r //if ((p.y+s.y)&lt;0) this.sidebarNode.setStyle(\"top\", p.y+s.y);\r \r if (p.y&lt;0){\r var top = ptop.y-p.y+200;\r this.sidebarNode.setStyle(\"top\", top);\r }\r // var p = fileTextNode.getPosition();\r // this.sidebarNode.setStyle(\"top\", p.y);\r }\r }\r },\r loadSideToolbar: function(){\r if (this.allowEdit){\r if (this.pages.length){\r var fileTextNode = this.pages[0].getElement(\"div.doc_layout_filetext\");\r if (fileTextNode){\r this.sidebarNode = new Element(\"div\", {\"styles\": this.css.doc_sidebar}).inject(this.node);\r this.resizeSidebar();\r \r this.scrollNode = this.sidebarNode.getParentSrcollNode();\r if (this.scrollNode){\r this.scrollNode.addEvent(\"scroll\", function(){\r this.resizeSidebar();\r }.bind(this));\r }\r \r html = \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/editdoc.png\\\" title=\\\"\"+MWF.xApplication.process.Xform.LP.editdoc+\"\\\" MWFButtonAction=\\\"_switchReadOrEditInline\\\" MWFButtonText=\\\"\"+MWF.xApplication.process.Xform.LP.editdoc+\"\\\">&lt;/span>\";\r \r this.sidebarNode.set(\"html\", html);\r \r MWF.require(\"MWF.widget.Toolbar\", function() {\r this.sideToolbar = new MWF.widget.Toolbar(this.sidebarNode, {\"style\": \"documentEdit_side\"}, this);\r this.sideToolbar.load();\r }.bind(this));\r \r }\r }\r }\r },\r _returnScale: function(){\r this.isScale = false;\r this.scale = 0;\r this.contentNode.setStyles({\r \"transform\":\"scale(1)\",\r });\r \r if (this.pages.length){\r this.pages.each(function(page){\r page.setStyles({\r \"transform\":\"scale(1)\",\r });\r });\r }\r this.node.setStyles({\r \"height\": \"auto\"\r });\r },\r _checkScale: function(offset){\r offset = 0;\r if (this.pages.length){\r //var pageSize = this.pages[0].getSize();\r var pageSize_x = this.options.docPageFullWidth\r var contentSize = this.contentNode.getSize();\r var contentWidth = (offset) ? contentSize.x-20-offset : contentSize.x-20;\r if (contentWidth&lt;pageSize_x){\r this.isScale = true;\r var scale = (contentWidth)/pageSize_x;\r this.scale = scale;\r this.zoom();\r this.resetNodeSize();\r }\r }\r },\r zoom: function(scale){\r if (scale) this.scale = scale;\r \r if (this.zoomSelectAction){\r for (var i=0; i&lt;this.zoomSelectAction.options.length; i++){\r var option = this.zoomSelectAction.options[i];\r if (Math.abs(this.scale-option.value.toFloat())&lt;0.05){\r option.set(\"selected\", true);\r break;\r }\r }\r }\r \r var w = this.node.getSize().x;\r if (this.history &amp;&amp; this.history.historyListAreaNode) w = w-this.history.historyListAreaNode.getComputedSize().totalWidth-2;\r w = w/this.scale;\r this.contentNode.setStyles({\r \"transform\":\"scale(\"+this.scale+\")\",\r \"transform-origin\": \"0px 0px\",\r \"overflow\": \"auto\",\r \"width\": \"\"+w+\"px\"\r });\r },\r \r _switchReadOrEdit: function(){\r if (this.editMode){\r this._readFiletext();\r if (this.allowEdit) {\r var button = this.toolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdoc_mobile : MWF.xApplication.process.Xform.LP.editdoc);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc.png\");\r //this.getFullWidthFlagNode().dispose();\r }\r this.editMode = false;\r }else{\r this._editFiletext();\r if (this.allowEdit) {\r var button = this.toolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdocCompleted_mobile : MWF.xApplication.process.Xform.LP.editdocCompleted);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc_completed.png\");\r //this.toolbar.node.inject(this.getFullWidthFlagNode());\r \r }\r this.editMode = true;\r }\r },\r _switchReadOrEditInline: function(){\r if (this.editMode){\r this._readFiletext();\r if (this.allowEdit){\r if (!layout.mobile) {\r var button = this.sideToolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdoc_mobile : MWF.xApplication.process.Xform.LP.editdoc);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc.png\");\r //this.getFullWidthFlagNode().dispose();\r }\r button = this.toolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdoc_mobile : MWF.xApplication.process.Xform.LP.editdoc);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc.png\");\r //this.getFullWidthFlagNode().dispose();\r \r \r // if (!layout.mobile)this.sideToolbar.childrenButton[0].setText(MWF.xApplication.process.Xform.LP.editdoc);\r // this.toolbar.childrenButton[0].setText(MWF.xApplication.process.Xform.LP.editdoc);\r }\r this.editMode = false;\r }else{\r this._editFiletext(\"inline\");\r if (this.allowEdit){\r if (!layout.mobile) {\r var button = this.sideToolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdocCompleted_mobile : MWF.xApplication.process.Xform.LP.editdocCompleted);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc_completed.png\");\r //this.toolbar.node.inject(this.getFullWidthFlagNode());\r }\r button = this.toolbar.childrenButton[0];\r button.setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdocCompleted_mobile : MWF.xApplication.process.Xform.LP.editdocCompleted);\r button.picNode.getElement(\"img\").set(\"src\", \"../x_component_process_Xform/$Form/default/icon/editdoc_completed.png\");\r //this.toolbar.node.inject(this.getFullWidthFlagNode());\r // if (!layout.mobile) this.sideToolbar.childrenButton[0].setText(MWF.xApplication.process.Xform.LP.editdocCompleted);\r // this.toolbar.childrenButton[0].setText(MWF.xApplication.process.Xform.LP.editdocCompleted);\r }\r this.editMode = true;\r }\r },\r // getFullWidthFlagNode: function(){\r // if (!this.fullWidthFlagNode){\r // this.fullWidthFlagNode = new Element(\"span\", {\r // \"styles\": {\r // \"line-height\": \"26px\",\r // \"color\": \"#999999\",\r // \"font-size\": \"12px\"\r // },\r // \"text\": MWF.xApplication.process.Xform.LP.fullWidth\r // });\r // }\r // return this.fullWidthFlagNode;\r // },\r _printDoc: function(){\r var scale = this.scale;\r this.toWord(function(data){\r if (this.form.businessData.work &amp;&amp; !this.form.businessData.work.completedTime){\r this.form.workAction.getAttachmentStream(data.id, this.form.businessData.work.id);\r }else{\r this.form.workAction.getWorkcompletedAttachmentStream(data.id, ((this.form.businessData.workCompleted) ? this.form.businessData.workCompleted.id : this.form.businessData.work.id));\r }\r this.scaleTo(scale);\r }.bind(this));\r },\r _historyDoc: function(){\r this.getHistory(function(){\r //this.history.play();\r }.bind(this));\r },\r getHistory: function(callback){\r if (this.history){\r this.history.active(function(){\r if (callback) callback();\r });\r }else{\r MWF.xDesktop.requireApp(\"process.Xform\", \"widget.DocumentHistory\", function(){\r this.history = new MWF.xApplication.process.Xform.widget.DocumentHistory(this);\r this.history.load(function(){\r if (callback) callback();\r });\r }.bind(this));\r }\r },\r \r \r htmlToText: function(html){\r var tmpdiv = new Element(\"div\", {\"html\": html});\r var text = tmpdiv.get(\"text\");\r tmpdiv.destroy();\r return text;\r },\r \r \r _readFiletext: function(){\r //this._returnScale();\r //this.zoom(1);\r var scale = this.scale;\r if (this.filetextEditor) this.filetextEditor.destroy();\r if (this.filetextScrollNode){\r if (this.reLocationFiletextToolbarFun){\r this.filetextScrollNode.removeEvent(\"scroll\", this.reLocationFiletextToolbarFun);\r //this.form.app.removeEvent(\"resize\", this.reLocationFiletextToolbarFun);\r this.reLocationFiletextToolbarFun = null;\r }\r this.filetextScrollNode = null;\r }\r if (this.filetextToolbarNode) this.filetextToolbarNode = null;\r \r this.layout_filetext.setAttribute('contenteditable', false);\r this.data = this.getData();\r // debugger;\r if (!this.data.filetext){\r //this.data.filetext = this.json.defaultValue.filetext;\r this.layout_filetext.set(\"html\", this.json.defaultValue.filetext);\r }\r //this._checkSplitPage(this.pages[0]);\r this._repage();\r this.scaleTo(scale);\r },\r _editFiletext: function(inline){\r this._returnScale();\r this.zoom(1);\r this._singlePage();\r this.pages = [];\r this.contentNode.empty();\r this._createPage(function(control){\r this._loadPageLayout(control);\r \r // var docData = this._getBusinessData();\r // if (!docData) docData = this._getDefaultData();\r if (this.data.filetext == this.json.defaultValue.filetext) this.data.filetext = \"　　\";\r this.setData(this.data);\r \r this._checkScale();\r this.node.setStyles({\r \"height\":\"auto\"\r });\r \r this._createEditor(inline);\r }.bind(this));\r },\r _createEditor: function(inline){\r if (this.allowEdit){\r this.loadCkeditorFiletext(function(e){\r e.editor.focus();\r var text = this.data.filetext.replace(/\\u3000*/g, \"\");\r if (!text){\r var range = e.editor.createRange();\r range.moveToElementEditEnd(e.editor.editable());\r \r range.select();\r range.scrollIntoView();\r }else{\r e.editor.getSelection().scrollIntoView();\r }\r //e.editor.getSelection().scrollIntoView();\r \r var text = this.data.filetext.replace(/\\u3000*/g, \"\");\r if (!text){\r var range = e.editor.createRange();\r range.moveToElementEditEnd(e.editor.editable());\r \r range.select();\r range.scrollIntoView();\r }else{\r e.editor.getSelection().scrollIntoView();\r }\r // e.editor.getSelection().scrollIntoView();\r //\r //this.getFiletextToolber();\r //this.filetextToolbarNode.inject(this.layout_filetext.getOffsetParent());\r \r this.locationFiletextToolbar();\r }.bind(this), inline);\r }\r },\r getFiletextToolber: function(){\r if (this.filetextEditor) {\r if (!this.filetextToolbarNode) {\r var className = \"cke_editor_\" + this.filetextEditor.name;\r var filetextToolbarNode = $$(\".\" + className)[0];\r this.filetextToolbarNode = filetextToolbarNode;\r //filetextToolbarNode.destroy();\r }\r }\r },\r reLocationFiletextToolbar: function(){\r this.getFiletextToolber();\r // if (this.filetextToolbarNode){\r // this.filetextToolbarNode.setStyle(\"display\", \"block\");\r // var offsetNode = this.layout_filetext.getOffsetParent();\r //\r // this.filetextToolbarNode.setStyle(\"left\", 0);\r // var h = this.filetextToolbarNode.getSize().y;\r // var p = this.layout_filetext.getPosition(offsetNode).y-h;\r //\r // var postion = this.layout_filetext.getPosition(this.form.app.content);\r // if (postion.y-h&lt;0){\r // this.filetextToolbarNode.inject(this.form.app.content);\r // this.filetextToolbarNode.setStyle(\"top\", 0);\r // this.filetextToolbarNode.setStyle(\"left\", \"\"+postion.x+\"px\");\r // }else{\r // this.filetextToolbarNode.inject(offsetNode);\r // this.filetextToolbarNode.setStyle(\"top\", \"\" + p + \"px\");\r // this.filetextToolbarNode.setStyle(\"left\", 0);\r // this.filetextToolbarNode.setStyle(\"left\", \"auto\");\r // }\r // }\r if (this.filetextToolbarNode){\r if (!this.filetextScrollNode){\r var scrollNode = this.contentNode;\r while (scrollNode &amp;&amp; (scrollNode.getScrollSize().y&lt;=scrollNode.getSize().y || (scrollNode.getStyle(\"overflow\")!==\"auto\" &amp;&amp; scrollNode.getStyle(\"4-y\")!==\"auto\"))){\r scrollNode = scrollNode.getParent();\r }\r this.filetextScrollNode = scrollNode;\r }\r var h = this.filetextToolbarNode.getSize().y;\r var position = this.layout_filetext.getPosition();\r var size = this.layout_filetext.getSize();\r var contentSize = this.filetextScrollNode.getSize();\r \r if (position.y&lt;0 &amp;&amp; size.y+position.y+h&lt;contentSize.y){\r // var top = size.y+position.y;\r // this.filetextToolbarNode.setStyle(\"top\", \"\"+top+\"px\");\r \r var tp = this.toolbar.node.getPosition();\r var tsy = this.toolbar.node.getSize().y;\r var h = tp.y+tsy;\r this.filetextToolbarNode.setStyle(\"top\", \"\"+h+\"px\");\r }else if (position.y-h&lt;0){\r var tp = this.toolbar.node.getPosition();\r var tsy = this.toolbar.node.getSize().y;\r var h = tp.y+tsy;\r this.filetextToolbarNode.setStyle(\"top\", \"\"+h+\"px\");\r }else{\r var p = this.layout_filetext.getPosition().y-h;\r this.filetextToolbarNode.setStyle(\"top\", \"\" + p + \"px\");\r }\r \r \r }\r \r //\r // this.filetextToolbarNode.inject(offsetNode);\r //\r //\r // this.filetextToolbarNode.setStyle(\"top\", \"\"+p+\"px\");\r \r },\r locationFiletextToolbar: function(){\r this.reLocationFiletextToolbar();\r if (this.filetextToolbarNode) {\r var scrollNode = this.contentNode;\r while (scrollNode &amp;&amp; (scrollNode.getScrollSize().y&lt;=scrollNode.getSize().y || (scrollNode.getStyle(\"overflow\")!==\"auto\" &amp;&amp; scrollNode.getStyle(\"overflow-y\")!==\"auto\"))){\r scrollNode = scrollNode.getParent();\r }\r if (scrollNode){\r this.filetextScrollNode = scrollNode;\r this.reLocationFiletextToolbarFun = this.reLocationFiletextToolbar.bind(this);\r this.filetextScrollNode.addEvent(\"scroll\", this.reLocationFiletextToolbarFun);\r }\r }\r },\r \r _isAllowEdit:function(){\r if (this.readonly) return false;\r if (this.json.allowEdit==\"n\") return false;\r if (this.json.allowEdit==\"s\"){\r if (this.json.allowEditScript &amp;&amp; this.json.allowEditScript.code){\r return !!this.form.Macro.exec(this.json.allowEditScript.code, this);\r }\r }\r return true;\r },\r _isAllowPrint: function(){\r if (this.json.allowPrint==\"n\") return false;\r if (this.json.allowPrint==\"s\"){\r if (this.json.allowPrintScript &amp;&amp; this.json.allowPrintScript.code){\r return !!this.form.Macro.exec(this.json.allowPrintScript.code, this);\r }\r }\r return true;\r },\r _isAllowHistory: function(){\r if (this.json.allowHistory==\"n\") return false;\r if (this.json.allowHistory==\"s\"){\r if (this.json.allowHistoryScript &amp;&amp; this.json.allowHistoryScript.code){\r return !!this.form.Macro.exec(this.json.allowHistoryScript.code, this);\r }\r }\r return true;\r },\r \r _getEdit: function(name, typeItem, scriptItem){\r switch (this.json[typeItem]) {\r case \"y\":\r return true;\r case \"n\":\r return false;\r case \"s\":\r if (this.json[scriptItem] &amp;&amp; this.json[scriptItem].code){\r return !!this.form.Macro.exec(this.json[scriptItem].code, this);\r }\r return true;\r }\r },\r loadCkeditorStyle: function(node){\r if (node){\r o2.load(\"ckeditor\", function(){\r //CKEDITOR.disableAutoInline = true;\r node.setAttribute('contenteditable', true);\r var editor = CKEDITOR.inline(this.layout_filetext, this._getEditorConfig());\r this.filetextEditor.on(\"instanceReady\", function(e){\r if (callback) callback(e);\r }.bind(this));\r }.bind(this));\r }\r },\r \r \r _loadToolbars: function(){\r var html =\"\";\r var editdoc, printdoc, history;\r \r if (layout.mobile){\r editdoc = MWF.xApplication.process.Xform.LP.editdoc_mobile;\r printdoc = MWF.xApplication.process.Xform.LP.printdoc_mobile;\r history = MWF.xApplication.process.Xform.LP.history_mobile;\r }else{\r editdoc = MWF.xApplication.process.Xform.LP.editdoc;\r printdoc = MWF.xApplication.process.Xform.LP.printdoc;\r history = MWF.xApplication.process.Xform.LP.history;\r }\r if (this.allowEdit){\r //html += \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/editdoc.png\\\" title=\\\"\"+MWF.xApplication.process.Xform.LP.editdoc+\"\\\" MWFButtonAction=\\\"_switchReadOrEdit\\\" MWFButtonText=\\\"\"+MWF.xApplication.process.Xform.LP.editdoc+\"\\\">&lt;/span>\";\r html += \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/editdoc.png\\\" title=\\\"\"+editdoc+\"\\\" MWFButtonAction=\\\"_switchReadOrEditInline\\\" MWFButtonText=\\\"\"+editdoc+\"\\\">&lt;/span>\";\r //html += \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/headerdoc.png\\\" title=\\\"\"+MWF.xApplication.process.Xform.LP.headerdoc+\"\\\" MWFButtonAction=\\\"_redheaderDoc\\\" MWFButtonText=\\\"\"+MWF.xApplication.process.Xform.LP.headerdoc+\"\\\">&lt;/span>\";\r }\r if (this.allowPrint){\r html += \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/print.png\\\" title=\\\"\"+printdoc+\"\\\" MWFButtonAction=\\\"_printDoc\\\" MWFButtonText=\\\"\"+printdoc+\"\\\">&lt;/span>\";\r }\r if (this.allowHistory){\r html += \"&lt;span MWFnodetype=\\\"MWFToolBarButton\\\" MWFButtonImage=\\\"../x_component_process_Xform/$Form/default/icon/versions.png\\\" title=\\\"\"+history+\"\\\" MWFButtonAction=\\\"_historyDoc\\\" MWFButtonText=\\\"\"+history+\"\\\">&lt;/span>\";\r }\r \r // if (this.json.fullWidth==\"y\"){\r // html += \"&lt;span style='line-height: 26px; color: #999999; font-size: 12px'>已启用半角空格自动转换为全角空格，如需输入半角空格，请使用：SHIFT+空格&lt;/span>\"\r // }\r this.toolbarNode = new Element(\"div\", {\"styles\": this.css.doc_toolbar_node}).inject(this.toolNode);\r this.toolbarNode.set(\"html\", html);\r \r MWF.require(\"MWF.widget.Toolbar\", function() {\r this.toolbar = new MWF.widget.Toolbar(this.toolbarNode, {\"style\": \"documentEdit\"}, this);\r this.toolbar.load();\r }.bind(this));\r \r if (!layout.mobile){\r this.scrollNode = this.toolbarNode.getParentSrcollNode();\r if (this.scrollNode){\r this.scrollNode.addEvent(\"scroll\", function(){\r this.resizeToolbar();\r }.bind(this));\r }\r }\r \r //if (this.json.canDoublePage!==\"n\" &amp;&amp; !layout.mobile){\r this.doublePageAction = new Element(\"div\", {\"styles\": this.css.doc_toolbar_doublePage, \"text\": MWF.xApplication.process.Xform.LP.doublePage}).inject(this.toolbarNode);\r this.doublePageAction.addEvent(\"click\", function(){\r if (this.options.pageShow!==\"double\"){\r this._doublePage();\r }else{\r this.options.pageShow=\"single\";\r this.reload();\r //this._singlePage();\r }\r }.bind(this));\r if (this.json.canDoublePage!==\"n\" &amp;&amp; !layout.mobile) this.doublePageAction.hide();\r //}\r \r \r \r this.zoomActionArea = new Element(\"div\", {\"styles\": {\"float\": \"right\", \"margin-right\": \"10px\"}}).inject(this.toolbarNode);\r if (this.json.isScale !== \"y\") this.zoomActionArea.hide();\r this.zoomAddAction = new Element(\"div\", {\r \"styles\": {\r \"float\": \"right\",\r \"margin-top\": \"3px\",\r \"height\": \"20px\",\r \"width\": \"20px\",\r \"text-align\": \"center\",\r \"line-height\": \"20px\",\r \"border\": \"1px solid #cccccc\",\r \"background-color\": \"#ffffff\",\r \"margin-left\": \"5px\"\r },\r \"text\": \"+\"\r }).inject(this.zoomActionArea);\r \r this.zoomSelectAction = new Element(\"select\", {\r \"styles\": {\r \"float\": \"right\",\r \"margin-top\": \"3px\",\r \"height\": \"20px\",\r \"width\": \"60px\",\r \"text-align\": \"center\",\r \"line-height\": \"20px\",\r \"border\": \"1px solid #cccccc\",\r \"background-color\": \"#ffffff\",\r \"margin-left\": \"5px\"\r },\r \"text\": \"100%\"\r }).inject(this.zoomActionArea);\r \r this.zoomSubAction = new Element(\"div\", {\r \"styles\": {\r \"float\": \"right\",\r \"margin-top\": \"3px\",\r \"height\": \"20px\",\r \"width\": \"20px\",\r \"text-align\": \"center\",\r \"line-height\": \"20px\",\r \"border\": \"1px solid #cccccc\",\r \"background-color\": \"#ffffff\",\r \"margin-left\": \"5px\"\r },\r \"text\": \"-\"\r }).inject(this.zoomActionArea);\r \r \r \r // this.zoomSelectAction = new Element(\"select\", {\"styles\": {\"float\": \"right\"}}).inject(this.toolbarNode);\r var options = \"&lt;option value='2'>200%&lt;/option> \" +\r \"&lt;option value='1.95'>195%&lt;/option>\" +\r \"&lt;option value='1.9'>190%&lt;/option>\" +\r \"&lt;option value='1.85'>185%&lt;/option>\" +\r \"&lt;option value='1.8'>180%&lt;/option>\" +\r \"&lt;option value='1.75'>175%&lt;/option>\" +\r \"&lt;option value='1.7'>170%&lt;/option>\" +\r \"&lt;option value='1.65'>165%&lt;/option>\" +\r \"&lt;option value='1.6'>160%&lt;/option>\" +\r \"&lt;option value='1.55'>155%&lt;/option>\" +\r \"&lt;option value='1.5'>150%&lt;/option> \" +\r \"&lt;option value='1.45'>145%&lt;/option>\" +\r \"&lt;option value='1.4'>140%&lt;/option>\" +\r \"&lt;option value='1.35'>135%&lt;/option>\" +\r \"&lt;option value='1.3'>130%&lt;/option>\" +\r \"&lt;option value='1.25'>125%&lt;/option>\" +\r \"&lt;option value='1.2'>120%&lt;/option>\" +\r \"&lt;option value='1.15'>115%&lt;/option>\" +\r \"&lt;option value='1.1'>110%&lt;/option>\" +\r \"&lt;option value='1.05'>105%&lt;/option>\" +\r \"&lt;option value='1' selected>100%&lt;/option>\" +\r \"&lt;option value='0.95'>95%&lt;/option>\" +\r \"&lt;option value='0.90'>90%&lt;/option>\" +\r \"&lt;option value='0.85'>85%&lt;/option>\" +\r \"&lt;option value='0.80'>80%&lt;/option>\" +\r \"&lt;option value='0.75'>75%&lt;/option>\" +\r \"&lt;option value='0.70'>70%&lt;/option>\" +\r \"&lt;option value='0.65'>65%&lt;/option>\" +\r \"&lt;option value='0.6'>60%&lt;/option>\" +\r \"&lt;option value='0.55'>55%&lt;/option>\" +\r \"&lt;option value='0.5'>50%&lt;/option>\";\r this.zoomSelectAction.set(\"html\", options);\r this.zoomSelectAction.addEvent(\"change\", function(e){\r this.scaleTo(e.target.options[e.target.selectedIndex].value);\r }.bind(this));\r \r this.zoomAddAction.addEvent(\"click\", function(){\r \r var i = (this.scale/0.05).toInt();\r if (i*0.05&lt;this.scale) i++;\r var v = i*0.05;\r //var v = this.zoomSelectAction.options[this.zoomSelectAction.selectedIndex].value.toFloat();\r v = v+0.05;\r if (v&lt;0.5) v = 0.5;\r if (v>2) v = 2;\r this.scaleTo(v);\r }.bind(this));\r this.zoomSubAction.addEvent(\"click\", function(){\r var i = (this.scale/0.05).toInt();\r if (i*0.05&lt;this.scale) i++;\r var v = i*0.05;\r //var v = this.zoomSelectAction.options[this.zoomSelectAction.selectedIndex].value.toFloat();\r v = v-0.05;\r if (v&lt;0.5) v = 0.5;\r if (v>2) v = 2;\r this.scaleTo(v);\r }.bind(this));\r },\r /**缩放文件内容\r * @param scale{Number} 缩放的比率\r * @example\r * this.form.get(\"fieldId\").scaleTo(0.5);\r */\r scaleTo: function(scale){\r this._returnScale();\r this.scale = scale;\r this.zoom();\r var w = this.contentNode.getSize().x;\r var count = 1;\r var docPageFullWidth = (this.scale) ? this.scale*this.options.docPageFullWidth : this.options.docPageFullWidth;\r var pageWidth = count * docPageFullWidth;\r var margin = (w-pageWidth)/(count+1);\r if (this.isScale){\r margin = \"10\";\r }\r if (this.scale) margin = margin/this.scale;\r if (margin &lt; 10){\r var offset = 10-margin;\r margin = 10;\r this.contentNode.scrollTo(offset, 0);\r }\r this.pages.each(function(page, i){\r page.setStyles({\r \"float\": \"left\",\r \"margin-left\": \"\"+margin+\"px\"\r });\r });\r this.resetNodeSize();\r },\r \r _repage: function(delay){\r if (this.options.pageShow!==\"double\"){\r this._singlePage();\r }else{\r this._doublePage();\r }\r if (delay){\r if (!this.form.isLoaded){\r this.form.addEvent(\"afterLoad\", this._checkScale.bind(this));\r }else{\r this._checkScale();\r }\r }else{\r this._checkScale();\r }\r },\r _singlePage: function(){\r //if (this.editMode) this._readFiletext();\r \r var scale = this.singlePageZoom || 1;\r if( this.singlePageZoom &amp;&amp; this.singlePageZoom.toInt() != 1 ){\r this.isScale = true;\r this.scale = this.singlePageZoom;\r this.singlePageZoom = null;\r }\r \r this.zoom(scale);\r this._checkScale();\r \r var w = this.contentNode.getSize().x;\r var count = 1;\r var docPageFullWidth = (this.scale) ? this.scale*this.options.docPageFullWidth : this.options.docPageFullWidth;\r //var docPageFullWidth = this.options.docPageFullWidt;\r \r var pageWidth = count * docPageFullWidth;\r var margin = (w-pageWidth)/(count+1);\r \r if (this.isScale){\r margin = \"10\";\r }\r if (this.scale) margin = margin/this.scale;\r this.pages.each(function(page, i){\r page.setStyles({\r \"float\": \"left\",\r \"margin-left\": \"\"+margin+\"px\"\r });\r });\r \r this.resetNodeSize();\r // this.pages.each(function(page){\r // page.setStyle(\"float\", \"none\");\r // });\r this.resizeSidebar();\r this.options.pageShow=\"single\";\r this.doublePageAction.set(\"text\", MWF.xApplication.process.Xform.LP.doublePage);\r },\r resetNodeSize: function(){\r var contentSize = this.contentNode.getSize();\r var toolbarSize = this.toolNode.getSize();\r contentHeight = contentSize.y;\r var h = contentHeight+toolbarSize.y+20;\r //h = h - contentSize.y*(1-this.scale);\r \r this.node.setStyles({\r \"height\":\"\"+h+\"px\"\r });\r this.resizeSidebar();\r },\r createWaitSplitPage: function(){\r this.node.mask({\r \"style\": {\r \"background-color\": \"#cccccc\",\r \"opacity\": 0.3\r }\r });\r \r this.waitSplitPageNode = new Element(\"div\", {\"styles\": this.form.css.waitSplitPageNode, \"text\": MWF.xApplication.process.Xform.LP.computePage}).inject(this.node);\r this.waitSplitPageNode.position({\r \"relativeTo\": this.node,\r \"position\": \"topRight\",\r \"edge\": \"topRight\",\r \"offset\": {\r \"x\": -10,\r \"y\": 45\r }\r });\r \r //this.form.notice(MWF.xApplication.process.Xform.LP.computePage, \"info\", this.node);\r },\r clearWaitSplitPage: function(){\r this.node.unmask();\r if (this.waitSplitPageNode) this.waitSplitPageNode.destroy();\r this.waitSplitPageNode = null;\r },\r \r _doublePage: function(){\r if (this.editMode) this._switchReadOrEditInline();\r \r if( this.zoomSelectAction ){\r this.singlePageZoom = ( this.zoomSelectAction.options[this.zoomSelectAction.selectedIndex].value ).toFloat();\r }\r \r this.zoom(1);\r this.createWaitSplitPage();\r window.setTimeout(function(){\r this._checkSplitPage(this.pages[0]);\r \r this.zoom(1);\r var w = this.contentNode.getSize().x;\r var toPageWidth = (w-100)/2;\r scale = toPageWidth/this.options.docPageFullWidth;\r if (scale&lt;1) this.zoom(scale);\r \r var docPageFullWidth = (this.scale) ? this.scale*this.options.docPageFullWidth : this.options.docPageFullWidth;\r //var docPageFullWidth = this.options.docPageFullWidth;\r \r var w = this.contentNode.getSize().x;\r var count = (w/docPageFullWidth).toInt();\r var pages = this.contentNode.getElements(\".doc_layout_page\");\r count = Math.min(pages.length, count);\r \r var pageWidth = count * docPageFullWidth;\r var margin = (w-pageWidth)/(count+1);\r if (this.scale) margin = margin/(this.scale);\r this.pages.each(function(page, i){\r page.setStyles({\r \"float\": \"left\",\r \"margin-left\": \"\"+margin+\"px\"\r });\r });\r // this.pages.each(function(page, i){\r // if ((i % 2)===0){\r // page.setStyle(\"float\", \"left\");\r // }else{\r // page.setStyle(\"float\", \"right\");\r // }\r // });\r this.resetNodeSize();\r \r this.options.pageShow=\"double\";\r this.doublePageAction.set(\"text\", MWF.xApplication.process.Xform.LP.singlePage);\r \r this.resizeSidebar();\r this.clearWaitSplitPage();\r }.bind(this), 1000);\r },\r _getDefaultData: function(){\r return Object.clone(this.json.defaultValue);\r //return Object.clone(MWF.xApplication.process.Xform.LP.documentEditor);\r },\r \r _loadFiletextPage: function(callback){\r this.data = this._getBusinessData();\r if (!this.data) this.data = this._getDefaultData();\r this._computeData(true);\r \r this._createPage(function(control){\r this._loadPageLayout(control);\r \r // this.data = this._getBusinessData();\r // if (!this.data) this.data = this._getDefaultData();\r \r this.setData(this.data);\r // this._checkSplitPage(this.pages[0]);\r //this._repage(true);\r //this.loadCkeditorFiletext();\r \r if (!this.readonly){\r //if (this.json.allowEditFiletext!==false) this.loadCkeditorFiletext();\r // if (this.json.allowEditRedheader) this.loadCkeditorRedheader();\r // if (this.json.allowEditSubject) this.loadCkeditorSubject();\r // if (this.json.allowEditMainSend) this.loadCkeditorMainSend();\r // if (this.json.allowEditFileNo) this.loadCkeditorFileNo();\r // if (this.json.allowEditSigner) this.loadCkeditorSigner();\r // if (this.json.allowEditAttachment) this.loadCkeditorAttachment();\r }\r \r if (callback) callback();\r }.bind(this));\r },\r \r \r _getEditorConfig: function(){\r // var mathElements = [\r // 'math',\r // 'maction',\r // 'maligngroup',\r // 'malignmark',\r // 'menclose',\r // 'merror',\r // 'mfenced',\r // 'mfrac',\r // 'mglyph',\r // 'mi',\r // 'mlabeledtr',\r // 'mlongdiv',\r // 'mmultiscripts',\r // 'mn',\r // 'mo',\r // 'mover',\r // 'mpadded',\r // 'mphantom',\r // 'mroot',\r // 'mrow',\r // 'ms',\r // 'mscarries',\r // 'mscarry',\r // 'msgroup',\r // 'msline',\r // 'mspace',\r // 'msqrt',\r // 'msrow',\r // 'mstack',\r // 'mstyle',\r // 'msub',\r // 'msup',\r // 'msubsup',\r // 'mtable',\r // 'mtd',\r // 'mtext',\r // 'mtr',\r // 'munder',\r // 'munderover',\r // 'semantics',\r // 'annotation',\r // 'annotation-xml'\r // ];\r \r //CKEDITOR.plugins.addExternal('ckeditor_wiris', 'https://ckeditor.com/docs/ckeditor4/4.13.0/examples/assets/plugins/ckeditor_wiris/', 'plugin.js');\r \r var editorConfig = {\r qtRows: 20, // Count of rows\r qtColumns: 20, // Count of columns\r qtBorder: '1', // Border of inserted table\r qtWidth: '95%', // Width of inserted table\r qtStyle: { 'border-collapse' : 'collapse' },\r qtClass: 'documenteditor_table'+this.form.json.id+this.json.id, // Class of table\r qtCellPadding: '0', // Cell padding table\r qtCellSpacing: '0', // Cell spacing table\r qtPreviewBorder: '4px double black', // preview table border\r qtPreviewSize: '4px', // Preview table cell size\r qtPreviewBackground: '#c8def4', // preview table background (hover)\r \r // format_tags: '标题一;标题二;标题三;标题四;正文', // entries is displayed in \"Paragraph format\"\r format_tags: '标题一;标题二;正文(标题三,四)', // entries is displayed in \"Paragraph format\"\r 'format_标题一': {\r name: '标题一(三号黑体)',\r element: 'div',\r styles: {\r 'font-family': '黑体',\r 'font-size': '16pt'\r }\r },\r 'format_标题二': {\r name: '标题二(三号楷体)',\r element: 'div',\r styles: {\r 'font-family': '楷体',\r 'font-size': '16pt'\r }\r },\r // 'format_标题三': {\r // name: '标题三',\r // element: 'div',\r // styles: {\r // 'font-family': '仿宋',\r // 'font-size': '16pt'\r // }\r // },\r // 'format_标题四': {\r // name: '标题四',\r // element: 'div',\r // styles: {\r // 'font-family': '仿宋',\r // 'font-size': '16pt'\r // }\r // },\r 'format_正文(标题三,四)': {\r name: '正文(标题三,四)',\r element: 'div',\r styles: {\r 'font-family': '仿宋',\r 'font-size': '16pt'\r }\r }\r \r \r };\r editorConfig.toolbarGroups = [\r { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\r { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\r { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\r { name: 'forms', groups: [ 'forms' ] },\r { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\r { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\r { name: 'links', groups: [ 'links' ] },\r { name: 'insert', groups: [ 'insert' ] },\r { name: 'styles', groups: [ 'styles' ] },\r { name: 'colors', groups: [ 'colors' ] },\r { name: 'tools', groups: [ 'tools' ] },\r { name: 'others', groups: [ 'others' ] },\r { name: 'about', groups: [ 'about' ] }\r ];\r //editorConfig.extraPlugins = \"ecnet,colordialog,tableresize,quicktable,mathjax,ckeditor_wiris\";\r //editorConfig.extraPlugins = \"ecnet,colordialog,quicktable,tableresize,eqneditor\";\r //editorConfig.extraPlugins = \"tableresize,quicktable\";\r editorConfig.extraPlugins = \"quicktable,tableresize\";\r \r //editorConfig.mathJaxLib = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML',\r editorConfig.removeButtons = 'NumberedList,Source,Save,NewPage,Preview,Print,Templates,Paste,PasteFromWord,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Bold,Italic,Underline,Strike,Subscript,Superscript,CopyFormatting,RemoveFormat,BulletedList,Outdent,Indent,Blockquote,CreateDiv,BidiLtr,BidiRtl,Language,Link,Unlink,Anchor,Image,Flash,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,TextColor,BGColor,Maximize,ShowBlocks,About,Styles,Font,FontSize';\r \r //editorConfig.extraAllowedContent = mathElements.join(' ') + '(*)[*]{*};img[data-mathml,data-custom-editor,role](Wirisformula)';\r \r editorConfig.pasteFromWordRemoveFontStyles = false;\r editorConfig.pasteFromWordRemoveStyles = false;\r \r //editorConfig.removeButtons = 'NewPage,Templates,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Bold,Italic,Underline,Strike,Subscript,Superscript,Blockquote,CreateDiv,BidiLtr,BidiRtl,Language,Link,Unlink,Anchor,Image,Flash,HorizontalRule,Smiley,SpecialChar,Iframe,Styles,Font,FontSize,TextColor,BGColor,ShowBlocks,About';\r editorConfig.removePlugins = ['magicline'];\r editorConfig.enterMode = 3;\r // editorConfig.extraPlugins = ['ecnet','mathjax'];\r // editorConfig.removePlugins = ['magicline'];\r // editorConfig.mathJaxLib = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML';\r return editorConfig;\r },\r \r _checkSplitPage: function(pageNode){\r if (this.layout_edition) this.layout_edition.setStyles({ \"position\": \"static\"});\r var contentNode = pageNode.getFirst();\r if (contentNode.getSize().y>this.options.docPageHeight){\r this._splitPage(pageNode);\r }\r var i = pageNode.get(\"data-pagecount\").toInt();\r \r if (i &amp;&amp; this.pages.length-1>=i){\r this._checkSplitPage(this.pages[i]);\r }\r if (this.layout_edition) this.layout_edition.setStyles({ \"position\": \"absolute\", \"bottom\": \"0px\" });\r },\r \r _splitFiletextNodeOneWord:function(lnode, nextPageNode){\r var text = lnode.textContent;\r var len = text.length;\r var left = text.substring(0, len-1);\r var right = text.substring(len-1, len);\r lnode.textContent = left;\r nextPageNode.textContent = right+nextPageNode.textContent;\r //nextPageNode.appendText(right, \"top\");\r },\r _splitFiletext: function(node, nextPageNode, nextFiletextNode, pageNode){\r var contentNode = pageNode.getFirst();\r var lnode = node.lastChild;\r if (!lnode){\r if (node.parentNode) node.parentNode.removeChild(node);\r //node.remove();\r }else{\r while (contentNode.getSize().y>this.options.docPageHeight &amp;&amp; lnode) {\r var tmpnode = lnode.previousSibling;\r var nodeType = lnode.nodeType;\r if (!nextPageNode) nextPageNode = nextFiletextNode;\r \r if (nodeType == Node.ELEMENT_NODE) {\r if (lnode.tagName == \"table\") {\r lnode.inject(nextPageNode);\r } else if (lnode.tagName == \"BR\") {\r if (lnode.parentNode) lnode.parentNode.removeChild(lnode);\r } else {\r var id = lnode.get(\"data-pagePart\");\r if (!id){\r id = (new o2.widget.UUID()).toString();\r lnode.set(\"data-pagePart\", id);\r }\r var tmpNode = nextPageNode.getFirst();\r if (tmpNode &amp;&amp; tmpNode.get(\"data-pagePart\")==id){\r nextPageNode = tmpNode;\r }else{\r nextPageNode = lnode.clone(false).inject(nextPageNode, \"top\");\r }\r //var subnode = lnode.getLast();\r this._splitFiletext(lnode, nextPageNode, nextFiletextNode, pageNode);\r if (!lnode.firstChild) if (lnode.parentNode) lnode.parentNode.removeChild(lnode);\r nextPageNode = nextPageNode.getParent();\r }\r } else if (nodeType == Node.TEXT_NODE) {\r var nextPageTextNode = nextPageNode.insertBefore(document.createTextNode(\"\"), nextPageNode.firstChild);\r while ((contentNode.getSize().y > this.options.docPageHeight) &amp;&amp; lnode.textContent) {\r //console.log(contentNode.getSize().y);\r this._splitFiletextNodeOneWord(lnode, nextPageTextNode)\r }\r if (!lnode.textContent) if (lnode.parentNode) lnode.parentNode.removeChild(lnode); //lnode.remove();\r } else {\r //lnode.remove();\r if (lnode.parentNode) lnode.parentNode.removeChild(lnode);\r }\r \r lnode = tmpnode;\r }\r if (!node.lastChild) if (node.parentNode) node.parentNode.removeChild(node); //node.remove();\r }\r //this._checkSplitPage(pageNode);\r },\r \r _splitPage: function(pageNode){\r var contentNode = pageNode.getFirst();\r var blockNodes = pageNode.getElements(\".doc_block\");\r if (blockNodes.length){\r var blockNode = blockNodes[blockNodes.length-1];\r var idx = this.pages.indexOf(pageNode);\r if (this.pages.length&lt;=idx+1) this._createNewPage();\r var nextPage = this.pages[idx+1];\r if (blockNode.hasClass(\"doc_layout_filetext\")){\r \r var filetextNode = nextPage.getElement(\".doc_layout_filetext\");\r if (!filetextNode){\r filetextNode = new Element(\"div.doc_layout_filetext\").inject(nextPage.getFirst(), \"top\");\r //filetextNode.setAttribute('contenteditable', true);\r }\r if (!filetextNode.hasClass(\"doc_block\"))filetextNode.addClass(\"doc_block\");\r //var nextEditor = filetextNode.retrieve(\"editor\");\r \r var node = blockNode;\r \r var nextPageNode = filetextNode;\r this._splitFiletext(node, nextPageNode, filetextNode, pageNode);\r \r }else{\r blockNode.inject(nextPage.getFirst(), \"top\");\r //var contentNode = pageNode.getFirst();\r if (contentNode.getSize().y>this.options.docPageHeight){\r this._splitPage(pageNode);\r }\r }\r }\r },\r \r transWidth: function(node){\r if (!node) return '';\r while (node){\r if (node.nodeType==3){\r node.nodeValue = node.nodeValue.replace(/\\x20/g, \"　\");\r }else if (node.nodeType==8){\r //nothing\r }else{\r this.transWidth(node.firstChild);\r }\r node = node.nextSibling;\r }\r },\r insertFullWidth: function(node, txt){\r if (!node) return '';\r while (node){\r if (node.nodeType==3){\r node.nodeValue = txt+node.nodeValue;\r return true;\r }else if (node.nodeType==8){\r //nothing\r }else{\r var flag = this.insertFullWidth(node.firstChild, txt);\r if (flag) return true;\r }\r node = node.nextSibling;\r }\r },\r \r loadCkeditorFiletext: function(callback, inline){\r if (this.layout_filetext){\r o2.load(\"../o2_lib/htmleditor/ckeditor4130/ckeditor.js\", function(){\r CKEDITOR.disableAutoInline = true;\r this.layout_filetext.setAttribute('contenteditable', true);\r \r if (inline){\r this.filetextEditor = CKEDITOR.inline(this.layout_filetext, this._getEditorConfig());\r }else{\r this.filetextEditor = CKEDITOR.replace(this.layout_filetext, this._getEditorConfig());\r }\r this.filetextEditor.on(\"instanceReady\", function(e){\r if (callback) callback(e);\r }.bind(this));\r this.filetextEditor.on( 'focus', function( e ) {\r window.setTimeout(this.reLocationFiletextToolbar.bind(this), 10);\r }.bind(this) );\r \r this.filetextEditor.on( 'paste', function( e ) {\r var html = e.data.dataValue;\r //if (this.json.fullWidth==\"y\") html = html.replace(/\\x20/g, \"　\");\r var tmp = new Element(\"div\")\r tmp.set(\"html\", html);\r var pList = tmp.getElements(\"p\");\r pList.each(function(p, i){\r //if (Browser.name==\"ie\"){\r if (this.json.fullWidth!==\"n\") this.transWidth(p);\r if (!p.getParent(\"table\")){\r var text = p.get(\"text\");\r var rex = /^\\u3000*/;\r var m = text.match(rex);\r var l = (m[0]) ? Math.max((2-m[0].length), 0): 2;\r var txt = \"\";\r // for (var i=0; i&lt;l; i++) txt+=\"　\";\r // this.insertFullWidth(p.getFirst(), txt);\r for (var i=0; i&lt;l; i++) p.appendText(\"　\",\"top\");\r }\r //}else{\r // var textIndent = p.getStyle(\"text-indent\");\r // if (textIndent.toInt()) p.appendText(\"　　\",\"top\");\r //}\r }.bind(this));\r e.data.dataValue = tmp.get(\"html\");\r tmp.destroy();\r \r this.fireEvent(\"paste\");\r }.bind(this) );\r \r this.filetextEditor.on( 'afterPaste', function( e ) {\r this.resetNodeSize();\r this.fireEvent(\"afterPaste\");\r }.bind(this) );\r \r \r if (this.json.textIndent!==\"n\"){\r this.layout_filetext.addEvent(\"keyup\", function(ev){\r if (ev.code==13) this.filetextEditor.insertText(\"　　\");\r }.bind(this));\r }\r if (this.json.fullWidth!==\"n\"){\r this.filetextEditor.addCommand( 'insertHalfSpace', {\r exec: function( editor ) {\r editor.insertText(\" \");\r }\r } );\r this.filetextEditor.setKeystroke( CKEDITOR.SHIFT + 32, 'insertHalfSpace' );\r \r this.filetextEditor.on(\"key\", function(e){\r if (this.json.fullWidth!==\"n\") if (e.data.keyCode==32){\r e.editor.insertText(\"　\");\r e.cancel();\r }\r }.bind(this));\r }\r \r \r }.bind(this));\r }\r },\r \r _loadEvents: function(editorConfig){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r this.editor.on(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this), this);\r }\r }.bind(this));\r \r },\r \r _bindFieldChange: function(name,dataItem, dom){\r var field = this.form.all[this.json[dataItem]];\r if (field){\r var bindFun = function(){\r this._computeItemFieldData(name, dataItem);\r //if (this.data[name]){\r if (this[dom]){\r if (dom==\"layout_redHeader\" || dom==\"layout_subject\" || dom==\"layout_issuanceUnit\" || dom==\"layout_meetingAttendContent\" || dom==\"layout_meetingLeaveContent\" || dom==\"layout_meetingSitContent\" || dom==\"layout_meetingRecordContent\"){\r this[dom].set(\"html\", this.data[name]|| \"\");\r }else if (dom==\"layout_attachment\"){\r this.setAttachmentData();\r }else{\r this[dom].set(\"text\", this.data[name]|| \"\");\r }\r }\r \r this.reSetShow();\r //}\r }.bind(this);\r field.node.store(this.json.id+\"bindFun\", bindFun);\r field.addModuleEvent(\"change\", bindFun);\r }\r },\r _computeItemFieldData: function(name, dataItem, dataItemNode){\r var v = \"\";\r var module = (dataItemNode) ? this.form.all[dataItemNode] : this.form.all[this.json[dataItem]];\r if (module &amp;&amp; module.getData) v = module.getData();\r if (!v) v = (dataItemNode) ? this.form.businessData.data[dataItemNode] : this.form.businessData.data[this.json[dataItem]];\r \r if (v){\r var t = o2.typeOf(v);\r switch (t) {\r case \"string\":\r switch (name) {\r case \"issuanceDate\":\r case \"editionDate\":\r var d = new Date(v);\r \r if (d.isValid() &amp;&amp; d.getFullYear()!=1970){\r var y = d.getFullYear();\r var m = d.getMonth();\r var day = d.getDate();\r m = m +1;\r this.data[name] = \"\"+y+\"年\"+m+\"月\"+day+\"日\";\r }else{\r this.data[name] = v;\r }\r //this.data[name] = (new Date(v).isValid()) ? Date.parse(v).format(\"％Y年％m月％d％日\") : v;\r break;\r case \"mainSend\":\r this.data[name] = v + \"：\";\r break;\r default:\r this.data[name] = v;\r }\r break;\r case \"array\":\r var strs = [];\r v.each(function(value){\r if (o2.typeOf(value)==\"object\" &amp;&amp; value.distinguishedName){\r strs.push(value.name);\r }else{\r strs.push(value.toString());\r }\r });\r //if (strs.length){\r switch (name) {\r case \"attachment\":\r // this.data[name] = strs.map(function(n, i){ var j = i+1; return j+\"、\"+n}).join(\"&lt;br>\");\r var atts = strs.map(function(a){\r return (a.indexOf(\".\")!=-1) ? a.substring(0, a.lastIndexOf(\".\")) : a;\r });\r this.data[name] = atts;\r break;\r case \"issuanceDate\":\r case \"editionDate\":\r var tmpStrs = strs.map(function(n, i){\r var d = Date.parse(n);\r if (d.isValid() &amp;&amp; d.getFullYear()!=1970){\r var y = d.getFullYear();\r var m = d.getMonth();\r var day = d.getDate();\r m = m +1;\r return \"\"+y+\"年\"+m+\"月\"+day+\"日\";\r }else{\r return n;\r }\r //return () ? d.format(\"%Y年%m月%d日\") : n;\r });\r this.data[name] = tmpStrs.join(\"，\");\r break;\r case \"mainSend\":\r this.data[name] = strs.join(\"，\") + \"：\";\r break;\r default:\r this.data[name] = strs.join(\"，\");\r }\r //}\r break;\r default:\r this.data[name] = v.toString();\r }\r }else{\r this.data[name] = this.json.defaultValue[name];\r }\r },\r computeData: function(){\r this._computeData(false);\r this.setData(this.data);\r },\r _computeItemData: function(name, typeItem, dataItem, scriptItem, ev, dom){\r switch (this.json[typeItem]) {\r case \"data\":\r if (this.json[dataItem]){\r if (ev) this._bindFieldChange(name, dataItem, dom);\r this._computeItemFieldData(name, dataItem);\r }\r break;\r case \"script\":\r if (this.json[scriptItem] &amp;&amp; this.json[scriptItem].code){\r var v = this.form.Macro.exec(this.json[scriptItem].code, this);\r this.data[name] = v;\r if (name==\"attachment\"){\r //this.data[name] = (typeOf(v)==\"array\") ? v.map(function(n, i){ var j = i+1; return j+\"、\"+n}).join(\"&lt;br>\") : v;\r this.data[name] = (typeOf(v)==\"array\") ? v : [v];\r }\r if (name==\"issuanceDate\" || name==\"editionDate\"){\r var d = Date.parse(v);\r if (d.isValid() &amp;&amp; d.getFullYear()!=1970){\r var y = d.getFullYear();\r var m = d.getMonth();\r var day = d.getDate();\r m = m +1;\r this.data[name] = \"\"+y+\"年\"+m+\"月\"+day+\"日\";\r }else{\r this.data[name] = v;\r }\r //this.data[name] = (d.isValid() &amp;&amp; d.getFullYear()!=1970) ? d.format(\"%Y年%m月%d日\") : v;\r }\r }\r break;\r }\r },\r \r _computeCustomItemData: function(name, field, ev){\r //if (this.json.customFields[l.name]){\r if (ev) this._bindCustomFieldChange(name, field, name);\r this._computeItemFieldData(name, null, field);\r //}\r },\r _bindCustomFieldChange: function(name, dataItem, dom){\r var field = this.form.all[dataItem];\r if (field){\r var bindFun = function(){\r this._computeItemFieldData(name, null, dataItem);\r //if (this.data[name]){\r if (this[dom]){\r \r if (dom==\"layout_redHeader\" || dom==\"layout_subject\" || dom==\"layout_issuanceUnit\"){\r this[dom].set(\"html\", this.data[name]|| \"\");\r }else if (dom==\"layout_attachment\"){\r this.setAttachmentData();\r }else{\r this[dom].set(\"text\", this.data[name]|| \"\");\r }\r }\r \r this.reSetShow();\r //}\r }.bind(this);\r field.node.store(this.json.id+\"bindFun\", bindFun);\r field.addModuleEvent(\"change\", bindFun);\r }\r },\r \r _computeData: function(ev){\r this._computeItemData(\"copies\", \"copiesValueType\", \"copiesValueData\", \"copiesValueScript\", ev, \"layout_copies\");\r this._computeItemData(\"secret\", \"secretValueType\", \"secretValueData\", \"secretValueScript\", ev, \"layout_secret\");\r this._computeItemData(\"priority\", \"priorityValueType\", \"priorityValueData\", \"priorityValueScript\", ev, \"layout_priority\");\r this._computeItemData(\"redHeader\", \"redHeaderValueType\", \"redHeaderValueData\", \"redHeaderValueScript\", ev, \"layout_redHeader\");\r this._computeItemData(\"fileno\", \"filenoValueType\", \"filenoValueData\", \"filenoValueScript\", ev, \"layout_fileno\");\r this._computeItemData(\"signer\", \"signerValueType\", \"signerValueData\", \"signerValueScript\", ev, \"layout_signer\");\r this._computeItemData(\"subject\", \"subjectValueType\", \"subjectValueData\", \"subjectValueScript\", ev, \"layout_subject\");\r this._computeItemData(\"mainSend\", \"mainSendValueType\", \"mainSendValueData\", \"mainSendValueScript\", ev, \"layout_mainSend\");\r this._computeItemData(\"attachment\", \"attachmentValueType\", \"attachmentValueData\", \"attachmentValueScript\", ev, \"layout_attachment\");\r this._computeItemData(\"issuanceUnit\", \"issuanceUnitValueType\", \"issuanceUnitValueData\", \"issuanceUnitValueScript\", ev, \"layout_issuanceUnit\");\r this._computeItemData(\"issuanceDate\", \"issuanceDateValueType\", \"issuanceDateValueData\", \"issuanceDateValueScript\", ev, \"layout_issuanceDate\");\r this._computeItemData(\"annotation\", \"annotationValueType\", \"annotationValueData\", \"annotationValueScript\", ev, \"layout_annotation\");\r this._computeItemData(\"copyto\", \"copytoValueType\", \"copytoValueData\", \"copytoValueScript\", ev, \"layout_copytoContent\");\r this._computeItemData(\"copyto2\", \"copyto2ValueType\", \"copyto2ValueData\", \"copyto2ValueScript\", ev, \"layout_copyto2Content\");\r this._computeItemData(\"editionUnit\", \"editionUnitValueType\", \"editionUnitValueData\", \"editionUnitValueScript\", ev, \"layout_edition_issuance_unit\");\r this._computeItemData(\"editionDate\", \"editionDateValueType\", \"editionDateValueData\", \"editionDateValueScript\", ev, \"layout_edition_issuance_date\");\r \r this._computeItemData(\"meetingAttend\", \"meetingAttendValueType\", \"meetingAttendValueData\", \"meetingAttendValueScript\", ev, \"layout_meetingAttendContent\");\r this._computeItemData(\"meetingLeave\", \"meetingLeaveValueType\", \"meetingLeaveValueData\", \"meetingLeaveValueScript\", ev, \"layout_meetingLeaveContent\");\r this._computeItemData(\"meetingSit\", \"meetingSitValueType\", \"meetingSitValueData\", \"meetingSitValueScript\", ev, \"layout_meetingSitContent\");\r this._computeItemData(\"meetingRecord\", \"meetingRecordValueType\", \"meetingRecordValueData\", \"meetingRecordValueScript\", ev, \"layout_meetingRecordContent\");\r \r Object.each(this.json.customFields, function(field, k){\r this._computeCustomItemData(k, field, ev);\r }.bind(this));\r \r // if (this.customLayouts){\r // this.customLayouts.each(function(l){\r // this._computeCustomItemData(l, ev);\r // }.bind(this))\r // }\r \r },\r \r _loadValue: function(){\r var data = this._getBusinessData();\r },\r \r /**重新计算公文编辑器的所有字段，当字段是脚本时可以使用该方法立即更新\r * @summary 重新计算公文编辑器的所有字段\r * @example\r * this.form.get(\"fieldId\").reload();\r */\r reload: function(){\r this.resetData();\r },\r resetData: function(diffFiletext){\r if (this.editMode){ this._switchReadOrEditInline(); }\r \r this._computeData(false);\r \r this.pages = [];\r this.contentNode.empty();\r if (this.allowEdit) this.toolbar.childrenButton[0].setText((layout.mobile) ? MWF.xApplication.process.Xform.LP.editdoc_mobile : MWF.xApplication.process.Xform.LP.editdoc);\r this.editMode = false;\r \r this._createPage(function(control){\r this._loadPageLayout(control);\r \r this.setData(this.data, diffFiletext);\r //this._checkSplitPage(this.pages[0]);\r \r this._repage();\r }.bind(this));\r },\r /**\r * @summary 判断公文编辑器的正文内容是否已经填写\r * @return {Boolean} 是否为空\r * @example\r * if( this.form.get(\"fieldId\").isEmpty() ){\r * this.form.notice('请填写正文内容')\r * }\r */\r isEmpty: function(){\r var data = this.getData();\r if( typeOf(data) !== \"object\" )return true;\r return !data.filetext || data.filetext===this.json.defaultValue.filetext;\r },\r /**\r * @summary 获取公文编辑器数据\r * @return {Object} 公文编辑器的数据\r * @example\r * var data = this.form.get(\"fieldId\").getData();\r */\r getData: function(){\r //if (this.editMode){\r \r if (this.layout_copies) this.data.copies = this.layout_copies.get(\"text\");\r if (this.layout_secret) this.data.secret = this.layout_secret.get(\"text\");\r if (this.layout_priority) this.data.priority = this.layout_priority.get(\"text\");\r if (this.layout_redHeader) this.data.redHeader = this.layout_redHeader.get(\"html\");\r if (this.layout_fileno) this.data.fileno = this.layout_fileno.get(\"text\");\r if (this.layout_signerTitle) this.data.signerTitle = this.layout_signerTitle.get(\"text\");\r if (this.layout_signer) this.data.signer = this.layout_signer.get(\"text\");\r if (this.layout_subject) this.data.subject = this.layout_subject.get(\"html\");\r if (this.layout_mainSend) this.data.mainSend = this.layout_mainSend.get(\"text\");\r if (this.editMode) if (this.layout_filetext){\r var text = this.layout_filetext.get(\"text\");\r text = text.replace(/\\u3000*/g, \"\");\r if (text &amp;&amp; text !==this.json.defaultValue.filetext){\r this.data.filetext = this.layout_filetext.get(\"html\");\r }else{\r this.data.filetext = \"\";\r }\r }\r if (this.layout_signer) this.data.signer = this.layout_signer.get(\"text\");\r if (this.layout_attachmentTitle) this.data.attachmentTitle = this.layout_attachmentTitle.get(\"text\");\r if (this.layout_attachment){\r this._computeItemData(\"attachment\", \"attachmentValueType\", \"attachmentValueData\", \"attachmentValueScript\", false, \"layout_attachment\");\r // var atts = [];\r // var nodes = this.layout_attachment.getElements(\".doc_layout_attachment_content_name\");\r // if (nodes.length){\r // nodes.each(function(node){\r // atts.push(node.get(\"text\"));\r // });\r // }\r // this.data.attachment = atts;\r }\r if (this.layout_issuanceUnit) this.data.issuanceUnit = this.layout_issuanceUnit.get(\"html\");\r if (this.layout_issuanceDate) this.data.issuanceDate = this.layout_issuanceDate.get(\"text\");\r if (this.layout_annotation) this.data.annotation = this.layout_annotation.get(\"text\");\r if (this.layout_copytoTitle) this.data.copytoTitle = this.layout_copytoTitle.get(\"text\");\r if (this.layout_copytoContent) this.data.copyto = this.layout_copytoContent.get(\"text\");\r if (this.layout_copyto2Title) this.data.copyto2Title = this.layout_copyto2Title.get(\"text\");\r if (this.layout_copyto2Content) this.data.copyto2 = this.layout_copyto2Content.get(\"text\");\r if (this.layout_edition_issuance_unit) this.data.editionUnit = this.layout_edition_issuance_unit.get(\"text\");\r if (this.layout_edition_issuance_date) this.data.editionDate = this.layout_edition_issuance_date.get(\"text\");\r \r if (this.layout_meetingAttendTitle) this.data.meetingAttendTitle = this.layout_meetingAttendTitle.get(\"text\");\r if (this.layout_meetingLeaveTitle) this.data.meetingLeaveTitle = this.layout_meetingLeaveTitle.get(\"text\");\r if (this.layout_meetingSitTitle) this.data.meetingSitTitle = this.layout_meetingSitTitle.get(\"text\");\r \r if (this.layout_meetingAttendContent) this.data.meetingAttend = this.layout_meetingAttendContent.get(\"html\");\r if (this.layout_meetingLeaveContent) this.data.meetingLeave = this.layout_meetingLeaveContent.get(\"html\");\r if (this.layout_meetingSitContent) this.data.meetingSit = this.layout_meetingSitContent.get(\"html\");\r if (this.layout_meetingRecordContent) this.data.meetingRecord = this.layout_meetingRecordContent.get(\"html\");\r \r if (this.customLayouts){\r this.customLayouts.each(function(l){\r this.data[l.name] = l.node.get(\"html\");\r }.bind(this))\r }\r \r //}\r return this.data;\r },\r setAttachmentData: function(){\r if (!this.attachmentTemplete){\r this.attachmentTemplete = this.layout_attachment.get(\"html\");\r }\r this.layout_attachment.empty();\r if (this.data.attachment &amp;&amp; this.data.attachment.length &amp;&amp; this.data.attachment.each){\r //var tmpdiv = new Element(\"div\", {\"styles\": {\"display\":\"none\"}}).inject(document.body);\r var tmpdiv = new Element(\"div\");\r this.data.attachment.each(function(name, idx){\r tmpdiv.set(\"html\", this.attachmentTemplete);\r var serialNode = tmpdiv.getElement(\".doc_layout_attachment_content_serial\");\r var nameNode = tmpdiv.getElement(\".doc_layout_attachment_content_name\");\r if (serialNode) serialNode.set(\"text\", idx+1);\r if (nameNode) nameNode.set(\"text\", name);\r var html = tmpdiv.get(\"html\");\r tmpdiv.empty();\r this.layout_attachment.appendHTML(html);\r }.bind(this));\r tmpdiv.destroy();\r }\r },\r /**设置公文编辑器数据\r * @param {Object} data\r * @example\r * var data = this.form.get(\"fieldId\").getData();\r * data.filetext = \"测试内容\";\r * this.form.get(\"fieldId\").setData(data);\r */\r setData: function(data, diffFiletext){\r if (data){\r this.data = data;\r // this.data[\"$json\"] = this.json;\r this._setBusinessData(data);\r if (this.layout_copies){\r if (data.copies){\r this.layout_copies.set(\"text\", data.copies || \" \");\r }else{\r this.layout_copies.set(\"html\", \"&lt;span>&amp;nbsp&lt;/span>\");\r }\r }\r if (this.layout_secret){\r if (data.secret){\r this.layout_secret.set(\"text\", data.secret || \" \");\r }else{\r this.layout_secret.set(\"html\", \"&lt;span>&amp;nbsp&lt;/span>\");\r }\r }\r if (this.layout_priority){\r if (data.priority){\r this.layout_priority.set(\"text\", data.priority || \" \");\r }else{\r this.layout_priority.set(\"html\", \"&lt;span>&amp;nbsp&lt;/span>\");\r }\r }\r \r \r if (this.layout_redHeader) this.layout_redHeader.set(\"html\", data.redHeader || \"\");\r if (this.layout_fileno) this.layout_fileno.set(\"text\", data.fileno || \" \");\r if (this.layout_signerTitle) this.layout_signerTitle.set(\"text\", data.signerTitle || \" \");\r if (this.layout_signer) this.layout_signer.set(\"text\", data.signer || \" \");\r if (this.layout_subject) this.layout_subject.set(\"html\", data.subject || \" \");\r if (this.layout_mainSend) this.layout_mainSend.set(\"text\", data.mainSend || \" \");\r if (diffFiletext) {\r this.layout_filetext.set(\"html\", diffFiletext);\r }else if (this.layout_filetext){\r //this.layout_filetext.set(\"placeholder\", this.json.defaultValue.filetext);\r this.layout_filetext.set(\"html\", data.filetext || \"　　\");\r }\r if (this.layout_signer) this.layout_signer.set(\"text\", data.signer || \"\");\r if (this.layout_attachmentTitle) this.layout_attachmentTitle.set(\"text\", data.attachmentTitle || \" \");\r \r if (this.layout_attachment){\r this.setAttachmentData();\r }\r \r if (this.layout_issuanceUnit) this.layout_issuanceUnit.set(\"html\", data.issuanceUnit || \" \");\r if (this.layout_issuanceDate) this.layout_issuanceDate.set(\"text\", data.issuanceDate || \" \");\r if (this.layout_annotation) this.layout_annotation.set(\"text\", data.annotation || \" \");\r if (this.layout_copytoTitle) this.layout_copytoTitle.set(\"text\", data.copytoTitle || \" \");\r if (this.layout_copytoContent) this.layout_copytoContent.set(\"text\", data.copyto || \" \");\r if (this.layout_copyto2Title) this.layout_copyto2Title.set(\"text\", data.copyto2Title || \" \");\r if (this.layout_copyto2Content) this.layout_copyto2Content.set(\"text\", data.copyto2 || \" \");\r if (this.layout_edition_issuance_unit) this.layout_edition_issuance_unit.set(\"text\", data.editionUnit || \" \");\r if (this.layout_edition_issuance_date) this.layout_edition_issuance_date.set(\"text\", data.editionDate || \" \");\r \r if (this.layout_meetingAttendTitle) this.layout_meetingAttendTitle.set(\"text\", data.meetingAttendTitle || this.json.defaultValue.meetingAttendTitle || \" \");\r if (this.layout_meetingLeaveTitle) this.layout_meetingLeaveTitle.set(\"text\", data.meetingLeaveTitle || this.json.defaultValue.meetingLeaveTitle || \" \");\r if (this.layout_meetingSitTitle) this.layout_meetingSitTitle.set(\"text\", data.meetingSitTitle || this.json.defaultValue.meetingSitTitle || \" \");\r \r if (this.layout_meetingAttendContent) this.layout_meetingAttendContent.set(\"html\", data.meetingAttend || \" \");\r if (this.layout_meetingLeaveContent) this.layout_meetingLeaveContent.set(\"html\", data.meetingLeave || \" \");\r if (this.layout_meetingSitContent) this.layout_meetingSitContent.set(\"html\", data.meetingSit || \" \");\r if (this.layout_meetingRecordContent) this.layout_meetingRecordContent.set(\"html\", data.meetingRecord || \" \");\r \r if (this.customLayouts){\r this.customLayouts.each(function(l){\r l.node.set(\"html\", this.data[l.name] || \"　\");\r }.bind(this))\r }\r \r \r \r if (this.layout_issuanceUnit &amp;&amp; this.layout_issuanceDate ){\r var table = this.layout_issuanceUnit.getParent(\"table\")\r if (table &amp;&amp; !table.hasClass(\"doc_layout_headIssuance\")){\r var unitWidth = o2.getTextSize(this.layout_issuanceUnit.get(\"text\"), {\r \"font-size\":\"16pt\",\r \"font-family\":\"'Times New Roman',仿宋\",\r \"letter-spacing\": \"-0.4pt\"\r }).x;\r var dateWidth = o2.getTextSize(this.layout_issuanceDate.get(\"text\"), {\r \"font-size\":\"16pt\",\r \"font-family\":\"'Times New Roman',仿宋\",\r \"letter-spacing\": \"-0.4pt\"\r }).x;\r \r // var unitWidth = this.layout_issuanceUnit.getSize().x;\r // var dateWidth = this.layout_issuanceDate.getSize().x;\r if (unitWidth&lt;dateWidth){\r var flagTd = this.layout_issuanceUnit.getParent(\"td\").getNext(\"td\");\r if (flagTd){\r var pt = ((dateWidth-unitWidth)/96)*72 +32+32;\r flagTd.setStyle(\"width\", \"\"+pt+\"pt\");\r }\r table = this.layout_issuanceDate.getParent(\"table\");\r table.setStyle(\"width\", \"auto\");\r flagTd = this.layout_issuanceDate.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var p = this.layout_issuanceDate.getParent(\"p\");\r if (p) p.setStyle(\"text-align\", \"right\");\r \r }else{\r var flagTd = this.layout_issuanceUnit.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var table = this.layout_issuanceUnit.getParent(\"table\");\r var x = table.getSize().x;\r \r table = this.layout_issuanceDate.getParent(\"table\");\r table.setStyle(\"width\", \"\"+x+\"px\");\r \r flagTd = this.layout_issuanceDate.getParent(\"td\").getNext(\"td\");\r if (flagTd) flagTd.setStyle(\"width\", \"32pt\");\r var p = this.layout_issuanceDate.getParent(\"p\");\r if (p) p.setStyle(\"text-align\", \"center\");\r }\r }\r }\r var coptyToTitleNode = (this.layout_copytoTitle || this.layout_copyto2Title);\r if (coptyToTitleNode){\r var editionTable = coptyToTitleNode.getParent(\"table\");\r if (editionTable) if (editionTable.get(\"data-compute-style\")==\"y\"){\r var rows = editionTable.rows;\r for (var i=0; i&lt;rows.length; i++){\r var cell = rows[i].cells[0];\r \r var tmp = cell.getElement(\".doc_layout_edition_issuance_unit\");\r if (!tmp) tmp = cell.getElement(\".doc_layout_edition_issuance_date\");\r if (!tmp){\r var text = cell.get(\"text\").trim();\r var l = 14*text.length;\r var wl = 19*text.length;\r cell.setStyles({\r \"max-width\": \"\"+l+\"pt !important\",\r \"min-width\": \"\"+l+\"pt !important\",\r \"width\": \"\"+wl+\"pt\"\r });\r }\r \r }\r }\r }\r }\r },\r createErrorNode: function(text){\r var node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r return node;\r },\r \r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border\", \"1px solid red\");\r \r this.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r this.showNotValidationMode(this.node);\r }\r },\r showNotValidationMode: function(node){\r var p = node.getParent(\"div\");\r if (p){\r if (p.get(\"MWFtype\") == \"tab$Content\"){\r if (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r \r validationConfigItem: function(routeName, data){\r var flag = (data.status==\"all\") ? true: (routeName == data.decision);\r if (flag){\r var n = this.getData();\r var v = (data.valueType==\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function(routeName, opinion){\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r \r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r \r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString()!=\"true\"){\r this.notValidationMode(flag);\r return false;\r }\r return true;\r },\r removeDisplayNone: function(node){\r var n = node.getFirst();\r while (n){\r if (n.getStyle(\"display\")==\"none\"){\r var tmp = n.getNext();\r n.destroy();\r n = tmp;\r }else{\r n = this.removeDisplayNone(n);\r n = n.getNext();\r }\r }\r return node;\r },\r /**将公文编辑器内容以html形式输出\r * @return {String}\r * @example\r * var html = this.form.get(\"fieldId\").getDocumentHtml();\r */\r getDocumentHtml: function(){\r var tmpNode = this.contentNode.getFirst().getFirst().clone(true);\r var htmlNode = tmpNode.getLast();\r htmlNode = this.removeDisplayNone(htmlNode);\r var nodes = tmpNode.querySelectorAll(\"[data-w-style]\");\r if (nodes.length){\r for (var i=0; i&lt;nodes.length; i++){\r var n = nodes.item(i);\r wStyle = n.dataset[\"wStyle\"];\r var styles = wStyle.split(/\\s*\\;\\s*/g);\r styles.each(function(style){\r if (style){\r try{\r s = style.split(/\\s*\\:\\s*/g);\r n.setStyle(s[0], s[1]);\r }catch(e) {}\r }\r });\r }\r }\r var htmlStr = tmpNode.get(\"html\");\r tmpNode.destroy();\r return \"&lt;html xmlns:v=\\\"urn:schemas-microsoft-com:vml\\\">&lt;head>&lt;meta charset=\\\"UTF-8\\\" />&lt;/head>&lt;body>\"+htmlStr+\"&lt;/body>&lt;/html>\";\r },\r /**\r * @summary 将公文编辑器转换成附件，转换的文件名和格式等信息与配置有关\r * @param {Function} [callback] 转换后的回调方法，参数是附件数据.\r * @param {string} [name] - 如果为空或者不传，转换的文件名和格式等信息与配置有关.\r * @example\r * this.form.get(\"fieldId\").toWord( function(attachmentData){\r * //attachmentData 转换后的附件数据\r * })\r */\r toWord: function(callback, name){\r \r var docNmae = name || \"\";\r if (!docNmae){\r try{\r docNmae = this.json.toWordFilename || this.form.businessData.data.subject || this.form.businessData.data[\"$work\"].title\r }catch (e) {}\r }\r var toEdit = false;\r if (this.editMode){\r toEdit = true;\r this._readFiletext();\r }\r //this._returnScale();\r this.zoom(1);\r \r this.pages = [];\r this.contentNode.empty();\r this._createPage(function(control){\r this._loadPageLayout(control);\r this.setData(this.data);\r this._checkScale();\r this.node.setStyles({\r \"height\":\"auto\"\r });\r \r //var content = this.contentNode.getFirst().getFirst().get(\"html\");\r // var tmpNode = this.contentNode.getFirst().getFirst().clone(true);\r // var htmlNode = tmpNode.getLast();\r // htmlNode = this.removeDisplayNone(htmlNode);\r // var nodes = tmpNode.querySelectorAll(\"[data-w-style]\");\r // if (nodes.length){\r // for (var i=0; i&lt;nodes.length; i++){\r // var n = nodes.item(i);\r // wStyle = n.dataset[\"wStyle\"];\r // var styles = wStyle.split(/\\s*\\;\\s*/g);\r // styles.each(function(style){\r // if (style){\r // try{\r // s = style.split(/\\s*\\:\\s*/g);\r // n.setStyle(s[0], s[1]);\r // }catch(e) {}\r // }\r // });\r // }\r // }\r var content = this.getDocumentHtml();\r //var content = \"&lt;html xmlns:v=\\\"urn:schemas-microsoft-com:vml\\\">&lt;head>&lt;meta charset=\\\"UTF-8\\\" />&lt;/head>&lt;body>\"+tmpNode.get(\"html\")+\"&lt;/body>&lt;/html>\";\r \r var fileName = docNmae || this.json.toWordFilename || \"$doc\";\r var n = fileName.lastIndexOf(\".\");\r if (n==-1) fileName = fileName+\".doc\";\r // var ex = fileName.substring(n, fileName.length).toLowerCase();\r // if (ex!==\".doc\" &amp;&amp; ex!==\".docx\") fileName = fileName+\".doc\";\r \r var body = {\r \"fileName\": fileName,\r \"site\": this.json.toWordSite || \"$doc\",\r \"content\": content\r };\r o2.Actions.get(\"x_processplatform_assemble_surface\").docToWord(this.form.businessData.work.id, body, function(json){\r if (this.form.businessData.workCompleted){\r o2.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentWorkcompleted(json.data.id, this.form.businessData.workCompleted.id,function(attjson){\r if (callback) callback(attjson.data);\r this.showToWord(attjson.data);\r }.bind(this));\r }else{\r o2.Actions.get(\"x_processplatform_assemble_surface\").getAttachment(json.data.id, this.form.businessData.work.id,function(attjson){\r if (callback) callback(attjson.data);\r this.showToWord(attjson.data);\r }.bind(this));\r }\r }.bind(this));\r //tmpNode.destroy();\r \r if (!toEdit){\r this._readFiletext();\r }else{\r this._createEditor(\"inline\");\r }\r }.bind(this));\r },\r docToWord: function(){\r var flag = true;\r if (this.json.toWordConditionScript &amp;&amp; this.json.toWordConditionScript.code){\r flag = !!this.form.Macro.exec(this.json.toWordConditionScript.code, this);\r }\r if (flag){\r this.toWord();\r }\r },\r showToWord: function(att_word){\r var site = this.json.toWordSite || \"$doc\";\r var attModule = this.form.all[site];\r if (attModule){\r var atts = [];\r attModule.attachmentController.attachments.each(function(att){\r if (att.data.name!==att_word.name){\r atts.push(att.data)\r }\r }.bind(this));\r \r attModule.attachmentController.clear();\r \r atts.each(function (att) {\r //if (att.site===this.json.id || (this.json.isOpenInOffice &amp;&amp; this.json.officeControlName===att.site)) this.attachmentController.addAttachment(att);\r if ((att.site === attModule.json.id) &amp;&amp; att.name!==att_word.name) attModule.attachmentController.addAttachment(att);\r }.bind(this));\r // attModule.attachmentController.reloadAttachments();\r attModule.attachmentController.addAttachment(att_word);\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Form.js.html":{"url":"x_component_process_Xform_Form.js.html","title":"x_component_process_Xform/Form.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Form.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Form.js //MWF.require([\"MWF.widget.Common\", \"MWF.widget.Identity\", \"MWF.widget.O2Identity\"], null, false);\r MWF.require([\"MWF.widget.Common\", \"MWF.widget.O2Identity\"], null, false);\r MWF.xApplication.process = MWF.xApplication.process || {};\r MWF.xApplication.process.Xform = MWF.xApplication.process.Xform || {};\r MWF.xDesktop.requireApp(\"process.Xform\", \"lp.\" + MWF.language, null, false);\r //MWF.xDesktop.requireApp(\"process.Xform\", \"Package\", null, false);\r \r /** @class Form 流程表单。\r * @o2category FormComponents\r * @o2range {Process}\r * @example\r * //可以在脚本中获取表单\r * //方法1：\r * var form = this.form.getApp().appForm; //获取表单\r * //方法2\r * var form = this.target; //在表单本身的事件脚本中获取\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Form = MWF.APPForm = new Class(\r /** @lends MWF.xApplication.process.Xform.Form# */\r {\r Implements: [Options, Events],\r Extends: MWF.widget.Common,\r options: {\r \"style\": \"default\",\r \"readonly\": false,\r \"cssPath\": \"\",\r \"macro\": \"FormContext\",\r \"parameters\": null,\r \"moduleEvents\": [\r /**\r * 表单加载前触发。数据（businessData）、预加载脚本和表单html已经就位。\r * @event MWF.xApplication.process.Xform.Form#queryLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"queryLoad\",\r /**\r * 表单加载前触发。如果是流程表单，已提示抢办锁定。\r * @event MWF.xApplication.process.Xform.Form#beforeLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeLoad\",\r /**\r * 表单的所有组件加载前触发，此时表单的样式和js head已经加载。\r * @event MWF.xApplication.process.Xform.Form#beforeModulesLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeModulesLoad\",\r /**\r * 表单加载后触发。主表单的组件加载完成，但不保证子表单、子页面、部件加载完成。\r * @event MWF.xApplication.process.Xform.Form#postLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"postLoad\",\r /**\r * 表单的所有组件加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。\r * @event MWF.xApplication.process.Xform.Form#afterModulesLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterModulesLoad\",\r /**\r * 表单加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。\r * @event MWF.xApplication.process.Xform.Form#afterLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterLoad\",\r /**\r * 保存前触发。如果是流程表单，流转前也会触发本事件。\r * @event MWF.xApplication.process.Xform.Form#beforeSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeSave\",\r /**\r * 保存后触发。如果是流程表单，流转后也会触发本事件。\r * @event MWF.xApplication.process.Xform.Form#afterSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterSave\",\r /**\r * 关闭前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeClose\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeClose\",\r /**\r * 弹出提交界面前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeProcessWork\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeProcessWork\",\r /**\r * 流转前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeProcess\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeProcess\",\r /**\r * 流转后触发。\r * @event MWF.xApplication.process.Xform.Form#afterProcess\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterProcess\",\r /**\r * 重置处理人前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeReset\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeReset\",\r /**\r * 重置处理人后触发。\r * @event MWF.xApplication.process.Xform.Form#afterReset\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterReset\",\r /**\r * 撤回前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeRetract\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeRetract\",\r /**\r * 撤回后触发。\r * @event MWF.xApplication.process.Xform.Form#afterRetract\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterRetract\",\r /**\r * 调度前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeReroute\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeReroute\",\r /**\r * 调度后触发。\r * @event MWF.xApplication.process.Xform.Form#afterReroute\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterReroute\",\r /**\r * 删除工作前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeDelete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeDelete\",\r /**\r * 删除工作后触发。\r * @event MWF.xApplication.process.Xform.Form#afterDelete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterDelete\",\r \"resize\",\r /**\r * 已阅前触发。\r * @event MWF.xApplication.process.Xform.Form#beforeReaded\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeReaded\",\r /**\r * 已阅后触发。\r * @event MWF.xApplication.process.Xform.Form#afterReaded\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterReaded\"]\r },\r initialize: function (node, data, options) {\r this.setOptions(options);\r \r /**\r * @summary 表单容器\r * @see https://mootools.net/core/docs/1.6.0/Element/Element\r * @member {Element}\r * @example\r * //可以在脚本中获取表单容器\r * var formContainer = this.form.getApp().appForm.container;\r */\r this.container = $(node);\r this.container.setStyle(\"-webkit-user-select\", \"text\");\r if (Browser.firefox) this.container.setStyle(\"opacity\", 0);\r this.data = data;\r \r /**\r * @summary 表单的配置信息，比如表单名称，提交方式等等.\r * @member {Object}\r * @example\r * //可以在脚本中获取表单配置信息\r * var json = this.form.getApp().appForm.json; //表单配置信息\r * var name = json.name; //表单名称\r */\r this.json = data.json;\r this.html = data.html;\r \r this.path = \"../x_component_process_Xform/$Form/\";\r this.cssPath = this.options.cssPath || \"../x_component_process_Xform/$Form/\" + this.options.style + \"/css.wcss\";\r this._loadCss();\r \r this.sectionListObj = {};\r \r /**\r * @summary 表单中的所有组件数组.\r * @member {Array}\r * @example\r * //下面的样例对表单组件进行循环，并且判断是输入类型的组件\r * var modules = this.form.getApp().appForm.modules; //获取所有表单组件\r * for( var i=0; i&lt;modules.length; i++ ){ //循环处理组件\r * //获取组件的类型\r var moduleName = module.json.moduleName;\r if( !moduleName ){\r moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r }\r if( [\"calendar\",\"combox\",\"number\",\"textfield\"].contains( moduleName )){ //输入类型框\r //do something\r }\r * }\r */\r this.modules = [];\r \r /**\r * 该对象的key是组件标识，value是组件对象，可以使用该对象根据组件标识获取组件。&lt;br/>\r * 需要注意的是，在子表单中嵌入不绑定数据的组件（比如div,common,button等等），系统允许重名。&lt;br/>\r * 在打开表单的时候，系统会根据重名情况，自动在组件的标识后跟上 \"_1\", \"_2\"。\r * @summary 表单中的所有组件对象.\r * @member {Object}\r * @example\r * var moduleAll = this.form.getApp().appForm.all; //获取组件对象\r * var subjectField = moduleAll[\"subject\"] //获取名称为subject的组件\r */\r this.all = {};\r this.allForName = {};\r this.forms = {};\r \r //if (!this.personActions) this.personActions = new MWF.xAction.org.express.RestActions();\r },\r parseCSS: function (css) {\r var rex = /(url\\(.*\\))/g;\r var match;\r while ((match = rex.exec(css)) !== null) {\r var pic = match[0];\r var len = pic.length;\r var s = pic.substring(pic.length - 2, pic.length - 1);\r var n0 = (s === \"'\" || s === \"\\\"\") ? 5 : 4;\r var n1 = (s === \"'\" || s === \"\\\"\") ? 2 : 1;\r pic = pic.substring(n0, pic.length - n1);\r \r if ((pic.indexOf(\"x_processplatform_assemble_surface\") != -1 || pic.indexOf(\"x_portal_assemble_surface\") != -1)) {\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r if (pic.indexOf(\"/x_processplatform_assemble_surface\") !== -1) {\r pic = pic.replace(\"/x_processplatform_assemble_surface\", pic + \"/x_processplatform_assemble_surface\");\r } else if (pic.indexOf(\"x_processplatform_assemble_surface\") !== -1) {\r pic = pic.replace(\"x_processplatform_assemble_surface\", pic + \"/x_processplatform_assemble_surface\");\r }\r if (pic.indexOf(\"/x_portal_assemble_surface\") !== -1) {\r pic = pic.replace(\"/x_portal_assemble_surface\", host2 + \"/x_portal_assemble_surface\");\r } else if (pic.indexOf(\"x_portal_assemble_surface\") !== -1) {\r pic = pic.replace(\"x_portal_assemble_surface\", host2 + \"/x_portal_assemble_surface\");\r }\r pic = o2.filterUrl(pic);\r }\r pic = \"url('\" + pic + \"')\";\r var len2 = pic.length;\r \r css = css.substring(0, match.index) + pic + css.substring(rex.lastIndex, css.length);\r rex.lastIndex = rex.lastIndex + (len2 - len);\r }\r return css;\r },\r loadCss: function () {\r cssText = (this.json.css) ? this.json.css.code : \"\";\r //var head = (document.head || document.getElementsByTagName(\"head\")[0] || document.documentElement);\r var styleNode = $(\"style\" + this.json.id);\r if (styleNode) styleNode.destroy();\r if (cssText) {\r cssText = this.parseCSS(cssText);\r \r var rex = new RegExp(\"(.+)(?=\\\\{)\", \"g\");\r var match;\r var id = this.json.id.replace(/\\-/g, \"\");\r var prefix = \".css\" + id + \" \";\r \r while ((match = rex.exec(cssText)) !== null) {\r var rulesStr = match[0];\r if (rulesStr.indexOf(\",\") != -1) {\r var rules = rulesStr.split(/\\s*,\\s*/g);\r rules = rules.map(function (r) {\r return prefix + r;\r });\r var rule = rules.join(\", \");\r cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r rex.lastIndex = rex.lastIndex + (prefix.length * rules.length);\r \r } else {\r var rule = prefix + match[0];\r cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r rex.lastIndex = rex.lastIndex + prefix.length;\r }\r }\r \r var styleNode = document.createElement(\"style\");\r styleNode.setAttribute(\"type\", \"text/css\");\r styleNode.id = \"style\" + this.json.id;\r styleNode.inject(this.container, \"before\");\r \r if (styleNode.styleSheet) {\r var setFunc = function () {\r styleNode.styleSheet.cssText = cssText;\r };\r if (styleNode.styleSheet.disabled) {\r setTimeout(setFunc, 10);\r } else {\r setFunc();\r }\r } else {\r var cssTextNode = document.createTextNode(cssText);\r styleNode.appendChild(cssTextNode);\r }\r return \"css\" + id;\r }\r return \"\";\r },\r keyLock: function (async) {\r var lockData = null;\r var key = this.businessData.work.id + \"-\" + this.businessData.work.activityToken;\r o2.Actions.load(\"x_processplatform_assemble_surface\").KeyLockAction.lock({ \"key\": key }, function (json) {\r flagData = json.data;\r if (async &amp;&amp; flagData.success) this.keyLockTimeoutId = window.setTimeout(function () { this.keyLock(true) }.bind(this), 90000);\r if (async &amp;&amp; !flagData.success) this.app.reload();\r }.bind(this), null, !!async);\r return flagData;\r },\r checkLock: function () {\r if (this.businessData.control.allowProcessing &amp;&amp; this.businessData.activity.manualMode == \"grab\") {\r this.app.addEvent(\"queryClose\", function () {\r if (this.keyLockTimeoutId) window.clearTimeout(this.keyLockTimeoutId);\r }.bind(this));\r var lockData = this.keyLock();\r if (lockData.success) {\r this.keyLock(true);\r } else {\r this.businessData.control.allowProcessing = false;\r this.businessData.control.allowSave = false;\r this.businessData.control.allowReset = false;\r this.businessData.control.allowReroute = false;\r this.businessData.control.allowDelete = false;\r this.businessData.control.allowAddSplit = false;\r this.businessData.control.allowRetract = false;\r this.businessData.control.allowRollback = false;\r this.lockDataPerson = lockData.person;\r // var text = MWF.xApplication.process.Xform.LP.keyLockInfor;\r // text = text.replace(\"{name}\", o2.name.cn(lockData.person));\r // var title = MWF.xApplication.process.Xform.LP.keyLockTitle;\r // this.app.alert(\"info\", \"center\", title, text, 400, 160);\r \r // o2.DL.open({\r // \"title\": title,\r // \"text\": text,\r // \"width\": 400\r // })\r }\r }\r },\r load: function (callback) {\r this.checkLock();\r this.loadExtendStyle(function () {\r if (this.app) {\r if (this.app.formNode) this.app.formNode.setStyles(this.json.styles);\r if (this.app.addEvent) {\r this.app.addEvent(\"resize\", function () {\r this.fireEvent(\"resize\");\r }.bind(this));\r this.app.addEvent(\"queryClose\", function () {\r this.beforeCloseWork();\r }.bind(this));\r }\r }\r if (!this.businessData.control.allowSave) this.setOptions({ \"readonly\": true });\r \r var cssClass = \"\";\r if (this.json.css &amp;&amp; this.json.css.code) cssClass = this.loadCss();\r \r this.loadMacro(function () {\r //this.container.setStyle(\"opacity\", 0);\r \r this.container.set(\"html\", this.html);\r this.node = this.container.getFirst();\r if (cssClass) this.node.addClass(cssClass);\r \r this._loadEvents();\r \r this.loadRelatedScript();\r //this.loadResource( function () {\r // this.loadDictionaryList(function () {\r \r this.fireEvent(\"queryLoad\");\r if (this.event_resolve) {\r this.event_resolve(function () {\r this.loadForm(callback)\r }.bind(this));\r } else {\r this.loadForm(callback);\r }\r \r // }.bind(this));\r \r //}.bind(this));\r \r }.bind(this));\r }.bind(this));\r },\r loadRelatedScript: function () {\r \r if (this.json.includeScripts &amp;&amp; this.json.includeScripts.length) {\r var includeScriptText = \"\";\r var includedIds = [];\r this.json.includeScripts.each(function (s) {\r if (this.app.relatedScriptMap &amp;&amp; this.app.relatedScriptMap[s.id]) {\r includeScriptText += \"\\n\" + this.app.relatedScriptMap[s.id].text;\r includedIds.push(s.id);\r }\r }.bind(this));\r \r if (includeScriptText) this.Macro.exec(includeScriptText, this);\r }\r },\r //@todo 载入脚本和数据字典\r // loadResource : function( callback ){\r // var cb = function () {\r // if( this.syncScriptLoaded &amp;&amp; this.asyncScriptLoaded &amp;&amp; this.dictionaryLoaded ){\r // if(callback)callback();\r // }\r // }.bind(this);\r // // this.loadScriptList( cb );\r // this.loadDictionaryList( cb );\r // },\r // loadDictionaryList: function (callback) {\r // this.dictionaryLoaded = false;\r // var loadedCount = 0;\r // if (this.json.includeDictionaries &amp;&amp; this.json.includeDictionaries.length) {\r // var fun = function () {\r // loadedCount++;\r // if (this.json.includeDictionaries.length &lt;= loadedCount) {\r // this.dictionaryLoaded = true;\r // if (callback) callback();\r // }\r // }.bind(this);\r //\r // this.json.includeDictionaries.map(function (d) {\r // var action = MWF.Actions.get(d.dictionary.appType === \"cms\" ? \"x_cms_assemble_control\" : \"x_processplatform_assemble_surface\");\r // if (d.path &amp;&amp; d.path !== \"root\") {\r // action[\"getDictData\"](d.dictionary.id, d.dictionary.appId, d.path, function (json) {\r // MWF.xScript.addDictToCache(d.dictionary, d.path, json.data);\r // fun();\r // }.bind(this), function () {\r // fun();\r // }.bind(this), true);\r // } else {\r // action[\"getDictRoot\"](d.dictionary.id, d.dictionary.appId, function (json) {\r // MWF.xScript.addDictToCache(d.dictionary, d.path, json.data);\r // fun();\r // }.bind(this), function () {\r // fun();\r // }.bind(this), true);\r // }\r // }.bind(this));\r // } else {\r // this.dictionaryLoaded = true;\r // if (callback) callback();\r // }\r // },\r // loadScriptList : function( callback ){\r // var asyncList = [];\r // var syncList = [];\r //\r // this.syncScriptLoaded = false;\r // this.asyncScriptLoaded = false;\r //\r // if( this.json.scripts &amp;&amp; this.json.scripts.length ){\r // for( var i=0; i&lt;this.json.scripts.length; i++ ){\r // var script = this.json.scripts[i];\r // script.scriptList.map( function ( s ) {\r // s.type = s.appType;\r // s.application = s.application || s.appId || s.appName;\r // });\r // if( script.async ){\r // asyncList = asyncList.concat( script.scriptList );\r // }else{\r // syncList = syncList.concat( script.scriptList );\r // }\r // }\r // }\r //\r // var loadSyncList = function () {\r // if( syncList.length === 0 ){\r // this.syncScriptLoaded = true;\r // if(callback)callback();\r // }else{\r // this.Macro.environment.include(syncList, function(){\r // this.syncScriptLoaded = true;\r // if(callback)callback();\r // }.bind(this), false);\r // }\r // }.bind(this);\r //\r // var loadAsyncList = function () {\r // if( asyncList.length === 0 ){\r // this.asyncScriptLoaded = true;\r // if(callback)callback();\r // }else{\r // this.Macro.environment.include(asyncList, function(){\r // this.asyncScriptLoaded = true;\r // if(callback)callback();\r // }.bind(this), true);\r // }\r // }.bind(this);\r //\r // loadAsyncList();\r // loadSyncList();\r // },\r loadForm: function (callback) {\r if (this.lockDataPerson) {\r var text = MWF.xApplication.process.Xform.LP.keyLockInfor;\r text = text.replace(\"{name}\", o2.name.cn(this.lockDataPerson));\r var title = MWF.xApplication.process.Xform.LP.keyLockTitle;\r this.app.alert(\"info\", \"center\", title, text, 400, 160);\r }\r \r if (this.app) if (this.app.fireEvent) this.app.fireEvent(\"queryLoad\");\r this._loadBusinessData();\r this.fireEvent(\"beforeLoad\");\r if (this.app) if (this.app.fireEvent) this.app.fireEvent(\"beforeLoad\");\r this.loadContent(callback);\r },\r loadExtendStyle: function (callback) {\r if (!this.json.styleConfig || !this.json.styleConfig.extendFile) {\r if (callback) callback();\r return;\r }\r if (this.json[\"$version\"] == \"5.2\") {\r if (callback) callback();\r return;\r }\r var stylesUrl = \"../x_component_process_FormDesigner/Module/Form/skin/\" + this.json.styleConfig.extendFile;\r MWF.getJSON(stylesUrl, {\r \"onSuccess\": function (responseJSON) {\r if (responseJSON &amp;&amp; responseJSON.form) {\r this.json = Object.merge(this.json, responseJSON.form);\r }\r if (callback) callback();\r }.bind(this),\r \"onRequestFailure\": function () {\r if (callback) callback();\r }.bind(this),\r \"onError\": function () {\r if (callback) callback();\r }.bind(this)\r }\r );\r },\r loadMacro: function (callback) {\r //if (!MWF.Macro[this.options.macro || \"FormContext\"]){\r MWF.require(\"MWF.xScript.Macro\", function () {\r this.Macro = new MWF.Macro[this.options.macro || \"FormContext\"](this);\r if (callback) callback();\r }.bind(this));\r // }else{\r // this.Macro = new MWF.Macro[this.options.macro || \"FormContext\"](this);\r // if (callback) callback();\r // }\r },\r loadContent: function (callback) {\r this.subformCount = 0;\r this.subformLoadedCount = 0;\r this.subformLoaded = [this.json.id];\r \r this.subpageCount = 0;\r this.subpageLoadedCount = 0;\r this.subpageLoaded = [];\r \r this.widgetCount = 0;\r this.widgetLoadedCount = 0;\r this.widgetLoaded = [];\r \r this._loadHtml();\r this._loadForm();\r this.fireEvent(\"beforeModulesLoad\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeModulesLoad\");\r this._loadModules(this.node);\r if (Browser.firefox) this.container.setStyle(\"opacity\", 1);\r \r if (this.json.mode === \"Mobile\") {\r var node = document.body.getElement(\".o2_form_mobile_actions\");\r if (node) {\r node.empty();\r this._loadMobileActions(node, callback);\r } else {\r console.log(\"没有找到移动端底部操作栏！\")\r }\r } else {\r if (callback) callback();\r }\r \r this.fireEvent(\"postLoad\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"postLoad\");\r this.checkSubformLoaded(true);\r },\r checkSubformLoaded: function (isAllSubformLoaded) {\r if (isAllSubformLoaded) {\r this.isAllSubformLoaded = true;\r }\r if (!this.isAllSubformLoaded) return;\r //console.log( \"checkSubformLoaded this.subformCount=\"+ this.subformCount + \" this.subformLoadedCount=\"+this.subformLoadedCount );\r if ((!this.subformCount || this.subformCount === this.subformLoadedCount) &amp;&amp;\r (!this.subpageCount || this.subpageCount === this.subpageLoadedCount) &amp;&amp;\r (!this.widgetCount || this.widgetCount === this.widgetLoadedCount)\r ) {\r //this.container.setStyle(\"opacity\", 1);\r this.fireEvent(\"afterModulesLoad\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterModulesLoad\");\r \r this.fireEvent(\"afterLoad\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterLoad\");\r this.isLoaded = true;\r }\r },\r _loadMobileDefaultTools: function (callback) {\r if (this.json.defaultTools) {\r if (callback) callback();\r } else {\r this.json.defaultTools = o2.JSON.get(\"../x_component_process_FormDesigner/Module/Form/toolbars.json\", function (json) {\r this.json.defaultTools = json;\r if (callback) callback();\r }.bind(this));\r }\r },\r \r _loadMobileActions: function (node, callback) {\r var tools = [];\r this._loadMobileDefaultTools(function () {\r if (this.json.defaultTools) {\r this.json.defaultTools.each(function (tool) {\r var flag = this._checkDefaultMobileActionItem(tool, this.options.readonly);\r if (flag) tools.push(tool);\r }.bind(this));\r }\r if (this.json.tools) {\r this.json.tools.each(function (tool) {\r var flag = this._checkCustomMobileActionItem(tool, this.options.readonly);\r if (flag) tools.push(tool);\r }.bind(this));\r }\r this.mobileTools = tools;\r //app上用原来的按钮样式\r if (window.o2android) {\r if (tools.length) if (node) this._createMobileActions(node, tools);\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.o2mLog) {\r if (tools.length) if (node) this._createMobileActions(node, tools);\r } else {\r //钉钉 企业微信用新的样式\r if (tools.length) if (node) this._createMobileActionsDingdingStyle(node, tools);\r }\r if (callback) callback();\r }.bind(this));\r },\r // 修改成钉钉 button\r _createMobileActionsDingdingStyle: function (node, tools) {\r node.show();\r var count = tools.length;\r if (count &lt;= 2) {\r //左边 间隔\r var dingdingSplitLeft = new Element(\"div\", { \"styles\": this.css.html5ActionButtonDingdingSplit, \"text\": \" \" }).inject(node);\r var splitSize = dingdingSplitLeft.getSize();\r var size = document.body.getSize();\r var buttonWidth = (size.x - splitSize.x * (count + 1) - (count * 2)) / count;\r tools.each(function (tool) {\r var actionStyle = this.css.html5ActionButtonDingdingNormal;\r if (tool.text === \"继续流转\" || tool.text === \"撤回\" || tool.id === \"action_processWork\" || tool.id === \"action_retract\") {\r actionStyle = this.css.html5ActionButtonDingdingPrimary;\r } else if (tool.text === \"删除文件\" || tool.id === \"action_delete\") {\r actionStyle = this.css.html5ActionButtonDingdingDanger;\r }\r actionStyle.width = buttonWidth + \"px\";\r var action = new Element(\"div\", { \"styles\": actionStyle, \"text\": tool.text }).inject(node);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var clickFun = function () {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { };\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this);\r if (tool.text === \"继续流转\" || tool.id === \"action_processWork\") {\r //输入法激活的时候，需要一段时间等待输入法关闭\r window.setTimeout(clickFun, 100)\r } else {\r clickFun();\r }\r }.bind(this));\r new Element(\"div\", { \"styles\": this.css.html5ActionButtonDingdingSplit, \"text\": \" \" }).inject(node);\r }.bind(this));\r } else {\r //左边 间隔\r var dingdingSplitLeft = new Element(\"div\", { \"styles\": this.css.html5ActionButtonDingdingSplit, \"text\": \" \" }).inject(node);\r var splitSize = dingdingSplitLeft.getSize();\r var size = document.body.getSize();\r var buttonWidth = (size.x - splitSize.x * 4 - 6) / 5;\r for (var i = 0; i &lt; 3; i++) {\r tool = tools[i];\r var actionStyle = this.css.html5ActionButtonDingdingNormal;\r if (tool.text === \"继续流转\" || tool.text === \"撤回\") {\r actionStyle = this.css.html5ActionButtonDingdingPrimary;\r } else if (tool.text === \"删除文件\") {\r actionStyle = this.css.html5ActionButtonDingdingDanger;\r }\r if (i == 2) {\r this.css.html5ActionButtonDingdingMore.width = buttonWidth + \"px\";\r var action = new Element(\"div\", { \"styles\": this.css.html5ActionButtonDingdingMore, \"text\": \"…\" }).inject(node);\r action.addEvent(\"click\", function (e) {\r this._loadMoreMobileActionsDingdingStyle(tools, 2, node);\r }.bind(this));\r } else {\r actionStyle.width = (buttonWidth * 2) + \"px\";\r var action = new Element(\"div\", { \"styles\": actionStyle, \"text\": tool.text }).inject(node);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { }\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this));\r }\r new Element(\"div\", { \"styles\": this.css.html5ActionButtonDingdingSplit, \"text\": \" \" }).inject(node);\r }\r }\r },\r _loadMoreMobileActionsDingdingStyle: function (tools, n, node) {\r document.body.mask({\r \"style\": {\r \"background-color\": \"#cccccc\",\r \"opacity\": 0.6\r },\r \"hideOnClick\": true,\r \"onHide\": function () {\r this.actionMoreArea.setStyle(\"display\", \"none\");\r }.bind(this)\r });\r if (this.actionMoreArea) {\r this.actionMoreArea.setStyle(\"display\", \"block\");\r } else {\r var size = document.body.getSize();\r this.actionMoreArea = new Element(\"div\", { \"styles\": this.css.html5ActionOtherArea }).inject(document.body);\r var pl = this.actionMoreArea.getStyle(\"padding-left\").toInt();\r var pr = this.actionMoreArea.getStyle(\"padding-right\").toInt();\r var w = size.x - pl - pr;\r this.actionMoreArea.setStyle(\"width\", \"\" + w + \"px\");\r for (var i = n; i &lt; tools.length; i++) {\r tool = tools[i];\r var actionStyle = this.css.html5ActionButtonDingdingNormal;\r if (tool.text === \"继续流转\" || tool.text === \"撤回\") {\r actionStyle = this.css.html5ActionButtonDingdingPrimary;\r } else if (tool.text === \"删除文件\") {\r actionStyle = this.css.html5ActionButtonDingdingDanger;\r }\r actionStyle.width = \"100%\";\r var action = new Element(\"div\", { \"styles\": actionStyle, \"text\": tool.text }).inject(this.actionMoreArea);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { }\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this));\r }\r }\r },\r \r _createMobileActions: function (node, tools) {\r node.show();\r var count = tools.length;\r if (count &lt;= 2) {\r this.css.html5ActionButton.width = \"100%\";\r if (count == 2) this.css.html5ActionButton.width = \"49%\";\r tools.each(function (tool) {\r var action = new Element(\"div\", { \"styles\": this.css.html5ActionButton, \"text\": tool.text }).inject(node);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { }\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this));\r this._setMobileBottonStyle(action);\r }.bind(this));\r if (count == 2) new Element(\"div\", { \"styles\": this.css.html5ActionButtonSplit }).inject(node.getLast(), \"before\");\r } else {\r this.css.html5ActionButton.width = \"38%\"\r for (var i = 0; i &lt; 2; i++) {\r tool = tools[i];\r var action = new Element(\"div\", { \"styles\": this.css.html5ActionButton, \"text\": tool.text }).inject(node);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { }\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this));\r this._setMobileBottonStyle(action);\r }\r new Element(\"div\", { \"styles\": this.css.html5ActionButtonSplit }).inject(node.getLast(), \"before\");\r new Element(\"div\", { \"styles\": this.css.html5ActionButtonSplit }).inject(node);\r this.css.html5ActionButton.width = \"23%\"\r var action = new Element(\"div\", { \"styles\": this.css.html5ActionButton, \"text\": \"…\" }).inject(node);\r action.addEvent(\"click\", function (e) {\r this._loadMoreMobileActions(tools, 2, node);\r }.bind(this));\r this._setMobileBottonStyle(action);\r }\r },\r _loadMoreMobileActions: function (tools, n, node) {\r document.body.mask({\r \"style\": {\r \"background-color\": \"#cccccc\",\r \"opacity\": 0.6\r },\r \"hideOnClick\": true,\r \"onHide\": function () {\r this.actionMoreArea.setStyle(\"display\", \"none\");\r }.bind(this)\r });\r if (this.actionMoreArea) {\r this.actionMoreArea.setStyle(\"display\", \"block\");\r } else {\r \r var size = document.body.getSize();\r this.actionMoreArea = new Element(\"div\", { \"styles\": this.css.html5ActionOtherArea }).inject(document.body);\r var pl = this.actionMoreArea.getStyle(\"padding-left\").toInt();\r var pr = this.actionMoreArea.getStyle(\"padding-right\").toInt();\r var w = size.x - pl - pr;\r this.actionMoreArea.setStyle(\"width\", \"\" + w + \"px\");\r for (var i = n; i &lt; tools.length; i++) {\r tool = tools[i];\r var action = new Element(\"div\", { \"styles\": this.css.html5ActionOtherButton, \"text\": tool.text }).inject(this.actionMoreArea);\r action.store(\"tool\", tool);\r action.addEvent(\"click\", function (e) {\r var t = e.target.retrieve(\"tool\");\r e.setDisable = function () { }\r if (t.actionScript) {\r this._runCustomAction(t.actionScript);\r } else {\r if (this[t.action]) this[t.action](e);\r }\r }.bind(this));\r this._setMobileBottonStyle(action);\r }\r }\r \r // actionArea.position({\r // relativeTo: node,\r // position: 'topCenter',\r // edge: 'bottomCenter'\r // });\r },\r _setMobileBottonStyle: function (action) {\r var _self = this;\r action.addEvents({\r \"mouseover\": function (e) { this.setStyles(_self.css.html5ActionButton_over) },\r \"mouseout\": function (e) { this.setStyles(_self.css.html5ActionButton_up) },\r \"mousedown\": function (e) { this.setStyles(_self.css.html5ActionButton_over) },\r \"mouseup\": function (e) { this.setStyles(_self.css.html5ActionButton_up) },\r \"touchstart\": function (e) { this.setStyles(_self.css.html5ActionButton_over) },\r \"touchcancel\": function (e) { this.setStyles(_self.css.html5ActionButton_up) },\r \"touchend\": function (e) { this.setStyles(_self.css.html5ActionButton_up) },\r \"touchmove\": function (e) { this.setStyles(_self.css.html5ActionButton_over) }\r });\r },\r _runCustomAction: function (actionScript) {\r //var script = bt.node.retrieve(\"script\");\r this.Macro.exec(actionScript, this);\r },\r _checkCustomMobileActionItem: function (tool, readonly) {\r var flag = true;\r if (readonly) {\r flag = tool.readShow;\r } else {\r flag = tool.editShow;\r }\r if (flag) {\r flag = true;\r if (tool.control) {\r flag = this.form.businessData.control[tool.control]\r }\r if (tool.condition) {\r var hideFlag = this.Macro.exec(tool.condition, this);\r flag = !hideFlag;\r }\r }\r return flag;\r },\r _checkDefaultMobileActionItem: function (tool, readonly, noCondition) {\r var flag = true;\r if (tool.control) {\r flag = this.businessData.control[tool.control]\r }\r if (!noCondition) if (tool.condition) {\r var hideFlag = this.Macro.exec(tool.condition, this);\r flag = flag &amp;&amp; (!hideFlag);\r }\r if (tool.id == \"action_processWork\") {\r if (!this.businessData.task &amp;&amp; this.businessData.work.startTime) {\r flag = false;\r }\r }\r if (tool.id == \"action_rollback\") tool.read = true;\r if (readonly) if (!tool.read) flag = false;\r return flag;\r },\r _loadBusinessData: function () {\r if (!this.businessData) {\r this.businessData = {};\r // this.businessData = {\r // \"data\": {\r // \"select\": \"222\",\r // \"radio\": \"bbb\",\r // \"checkbox\": [\"check1\", \"check3\"],\r // \"orderData\": [\r // {\r // \"orderName\": {\"namefield\": \"电脑\"},\r // \"orderCount\": {\"countField\": \"3\"},\r // \"priceCount\": {\"priceField\": \"9000\"}\r // },\r // {\r // \"orderName\": {\"namefield\": \"路由器\"},\r // \"orderCount\": {\"countField\": \"2\"},\r // \"priceCount\": {\"priceField\": \"1000\"}\r // },\r // {\r // \"orderName\": {\"namefield\": \"网线\"},\r // \"orderCount\": {\"countField\": \"10\"},\r // \"priceCount\": {\"priceField\": \"200\"}\r // }\r // ]\r //\r // }\r // };\r }\r },\r \r _loadHtml: function () {\r // this.container.set(\"html\", this.html);\r // this.node = this.container.getFirst();\r //this.node.setStyle(\"overflow\", \"hidden\");\r this.node.addEvent(\"selectstart\", function (e) {\r var select = \"text\";\r if (e.target.getStyle(\"-webkit-user-select\")) {\r select = e.target.getStyle(\"-webkit-user-select\").toString().toLowerCase();\r }\r \r if (select !== \"text\" &amp;&amp; select !== \"auto\") e.preventDefault();\r });\r },\r \r _loadForm: function () {\r this._loadStyles();\r this._loadCssLinks();\r this._loadScriptSrc();\r this._loadJsheader();\r //this._loadEvents();\r },\r _loadStyles: function () {\r if (this.json.styles) Object.each(this.json.styles, function (value, key) {\r if ((value.indexOf(\"x_processplatform_assemble_surface\") != -1 || value.indexOf(\"x_portal_assemble_surface\") != -1)) {\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r if (value.indexOf(\"/x_processplatform_assemble_surface\") !== -1) {\r value = value.replace(\"/x_processplatform_assemble_surface\", host1 + \"/x_processplatform_assemble_surface\");\r } else if (value.indexOf(\"x_processplatform_assemble_surface\") !== -1) {\r value = value.replace(\"x_processplatform_assemble_surface\", host1 + \"/x_processplatform_assemble_surface\");\r }\r if (value.indexOf(\"/x_portal_assemble_surface\") !== -1) {\r value = value.replace(\"/x_portal_assemble_surface\", host2 + \"/x_portal_assemble_surface\");\r } else if (value.indexOf(\"x_portal_assemble_surface\") !== -1) {\r value = value.replace(\"x_portal_assemble_surface\", host2 + \"/x_portal_assemble_surface\");\r }\r }\r value = o2.filterUrl(value);\r this.node.setStyle(key, value);\r }.bind(this));\r //this.node.setStyles(this.json.styles);\r },\r _loadCssLinks: function () {\r var urls = this.json.cssLinks;\r urls.each(function (url) {\r new Element(\"link\", {\r \"rel\": \"stylesheet\",\r \"type\": \"text/css\",\r \"href\": url\r }).inject($(document.head));\r });\r },\r _loadScriptSrc: function () {\r var urls = this.json.scriptSrc;\r urls.each(function (url) {\r new Element(\"script\", {\r \"src\": url\r }).inject($(document.head));\r });\r },\r _loadJsheader: function () {\r var code = (this.json.jsheader) ? this.json.jsheader.code : \"\";\r if (code) Browser.exec(code);\r },\r _loadEvents: function () {\r Object.each(this.json.events, function (e, key) {\r if (e.code) {\r if (this.options.moduleEvents.indexOf(key) !== -1) {\r this.addEvent(key, function (event) {\r return this.Macro.fire(e.code, this, event);\r }.bind(this));\r } else {\r if (key === \"load\") {\r this.addEvent(\"postLoad\", function () {\r return this.Macro.fire(e.code, this);\r }.bind(this));\r } else if (key === \"submit\") {\r this.addEvent(\"beforeProcess\", function () {\r return this.Macro.fire(e.code, this);\r }.bind(this));\r } else {\r this.node.addEvent(key, function (event) {\r return this.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }\r }.bind(this));\r },\r addModuleEvent: function (key, fun) {\r if (this.options.moduleEvents.indexOf(key) !== -1) {\r this.addEvent(key, function (event) {\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r } else {\r if (key === \"load\") {\r this.addEvent(\"postLoad\", function (event) {\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r } else if (key === \"submit\") {\r this.addEvent(\"beforeProcess\", function (event) {\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r } else {\r this.node.addEvent(key, function (event) {\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }\r }\r },\r \r _getDomjson: function (dom) {\r var mwfType = dom.get(\"MWFtype\") || dom.get(\"mwftype\");\r switch (mwfType) {\r case \"form\":\r return this.json;\r case \"\":\r return null;\r default:\r var id = dom.get(\"id\");\r if (!id) id = dom.get(\"MWFId\");\r if (id) {\r return this.json.moduleList[id];\r } else {\r return null;\r }\r }\r },\r _getModuleNodes: function (dom) {\r var moduleNodes = [];\r var subDom = dom.getFirst();\r while (subDom) {\r var mwftype = subDom.get(\"MWFtype\") || subDom.get(\"mwftype\");\r if (mwftype) {\r var type = mwftype;\r if (type.indexOf(\"$\") === -1) {\r moduleNodes.push(subDom);\r }\r // &amp;&amp; mwftype !== \"tab$Content\"\r if (mwftype !== \"datagrid\" &amp;&amp; mwftype !== \"subSource\" &amp;&amp; mwftype !== \"tab$Content\") {\r moduleNodes = moduleNodes.concat(this._getModuleNodes(subDom));\r }\r } else {\r moduleNodes = moduleNodes.concat(this._getModuleNodes(subDom));\r }\r subDom = subDom.getNext();\r }\r return moduleNodes;\r },\r \r _loadModules: function (dom) {\r //var subDom = this.node.getFirst();\r //while (subDom){\r // if (subDom.get(\"MWFtype\")){\r // var json = this._getDomjson(subDom);\r // var module = this._loadModule(json, subDom);\r // this.modules.push(module);\r // }\r // subDom = subDom.getNext();\r //}\r var moduleNodes = this._getModuleNodes(dom);\r //alert(moduleNodes.length);\r \r moduleNodes.each(function (node) {\r var json = this._getDomjson(node);\r //if( json.type === \"Subform\" || json.moduleName === \"subform\" )this.subformCount++;\r //if( json.type === \"Subpage\" || json.moduleName === \"subpage\" )this.subpageCount++;\r var module = this._loadModule(json, node);\r this.modules.push(module);\r }.bind(this));\r },\r _loadModule: function (json, node, beforeLoad) {\r //console.log( json.id );\r if (json.type === \"Subform\" || json.moduleName === \"subform\") this.subformCount++;\r //if( json.type === \"Subform\" || json.moduleName === \"subform\" ){\r // console.log( \"add subformcount ， this.subformCount = \" + this.subformCount );\r //}\r if (json.type === \"Subpage\" || json.moduleName === \"subpage\") this.subpageCount++;\r if (json.type === \"Widget\" || json.moduleName === \"widget\") this.widgetCount++;\r if (!MWF[\"APP\" + json.type]) {\r MWF.xDesktop.requireApp(\"process.Xform\", json.type, null, false);\r }\r var module = new MWF[\"APP\" + json.type](node, json, this);\r if (beforeLoad) beforeLoad.apply(module);\r if (!this.all[json.id]) this.all[json.id] = module;\r \r if (json.name) {\r if (this.allForName[json.name]) {\r var item = this.allForName[json.name];\r typeOf(item) === \"array\" ? item.push(module) : this.allForName[json.name] = [item, module];\r } else {\r this.allForName[json.name] = module;\r }\r }\r \r if (module.field) {\r if (!this.forms[json.id]) this.forms[json.id] = module;\r }\r module.readonly = this.options.readonly;\r module.load();\r return module;\r },\r saveOpinion: function (module) {\r var op = module._getBusinessSectionDataByPerson();\r MWF.UD.getDataJson(\"userOpinion\", function (json) {\r if (!json) json = [];\r var idx = json.indexOf(op);\r if (idx == -1) {\r if (json.length >= 50) json.shift();\r \r } else {\r json.splice(idx, 1);\r }\r json.push(op);\r MWF.UD.putData(\"userOpinion\", json);\r }.bind(this), false);\r },\r loadPathData: function (path) {\r var data = null;\r this.workAction.getJobDataByPath(this.businessData.work.job, path, function (json) {\r data = json.data || null;\r }, null, false);\r return data;\r },\r /**\r * @summary 获取表单的所有数据.\r * @example\r * var data = this.form.getApp().appForm.getData();\r * @return {Object}\r */\r getData: function (issubmit) {\r //var data = Object.clone(this.businessData.data);\r var data = this.businessData.data;\r Object.each(this.forms, function (module, id) {\r if (module.json.type === \"Opinion\") {\r \r if (issubmit) {\r this.saveOpinion(module);\r \r var key = layout.desktop.session.user.id;\r if (typeOf(data[id]) === \"object\" &amp;&amp; typeOf(data[id][key]) === \"string\") {\r data[id][key] = \"\";\r } else if (typeOf(data[id]) === \"string\") {\r data[id] = \"\";\r }\r // delete data[id];\r } else {\r var v = module.getData();\r // var d = this.loadPathData(id);\r // if (d) data[id] = d;\r data[id] = this.getSectionDataByPerson(v, data[id]);\r }\r } else {\r if (module.json.section === \"yes\") {\r // var d = this.loadPathData(id);\r // if (d) data[id] = d;\r data[id] = this.getSectionData(module, data[id]);\r } else {\r data[id] = module.getData();\r }\r }\r }.bind(this));\r \r this.businessData.data = data;\r this.Macro.environment.setData(this.businessData.data);\r return data;\r },\r getSectionData: function (module, obj) {\r var v = module.getData();\r switch (module.json.sectionBy) {\r case \"person\":\r return this.getSectionDataByPerson(v, obj);\r case \"unit\":\r return this.getSectionDataByUnit(v, obj);\r case \"activity\":\r return this.getSectionDataByPActivity(v, obj);\r case \"splitValue\":\r return this.getSectionDataBySplitValue(v, obj);\r case \"script\":\r return this.getSectionDataByScript(module.json.sectionByScript.code, v, obj);\r default:\r return v;\r }\r },\r getSectionDataByPerson: function (v, obj) {\r var key = layout.desktop.session.user.id;\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r obj[key] = v;\r return obj;\r },\r getSectionDataByUnit: function (v, obj) {\r var key = (this.businessData.task) ? this.businessData.task.unit : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r if (key) obj[key] = v;\r return obj;\r },\r getSectionDataByPActivity: function (v, obj) {\r var key = (this.businessData.work) ? this.businessData.work.activity : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r if (key) obj[key] = v;\r return obj;\r },\r getSectionDataBySplitValue: function (v, obj) {\r var key = (this.businessData.work) ? this.businessData.work.splitValue : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r if (key) obj[key] = v;\r return obj;\r },\r \r getSectionDataByScript: function (code, v, obj) {\r var key = this.Macro.exec(code, this);\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r if (key) obj[key] = v;\r return obj;\r },\r \r setSection: function (json, data) {\r var obj = data[json.name];\r switch (json.sectionBy) {\r case \"person\":\r return this.setSectionByPerson(obj, json.name);\r case \"unit\":\r return this.setSectionByUnit(obj, json.name);\r case \"activity\":\r return this.setSectionByPActivity(obj, json.name);\r case \"splitValue\":\r return this.setSectionBySplitValue(obj, json.name);\r case \"script\":\r return this.setSectionByScript(json.sectionByScript.code, obj, json.name);\r default:\r return v;\r }\r },\r setSectionByPerson: function (obj, name) {\r var key = layout.desktop.session.user.id;\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r //obj[key] = v;\r this.sectionListObj[name] = key;\r return obj;\r },\r setSectionByUnit: function (obj, name) {\r var key = (this.businessData.task) ? this.businessData.task.unit : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r this.sectionListObj[name] = key || \"\";\r //if (key) obj[key] = v;\r return obj;\r },\r setSectionByPActivity: function (obj, name) {\r var key = (this.businessData.work) ? this.businessData.work.activity : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r this.sectionListObj[name] = key || \"\";\r //if (key) obj[key] = v;\r return obj;\r },\r setSectionBySplitValue: function (obj, name) {\r var key = (this.businessData.work) ? this.businessData.work.splitValue : \"\";\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r this.sectionListObj[name] = key || \"\";\r //if (key) obj[key] = v;\r return obj;\r },\r \r setSectionByScript: function (code, obj, name) {\r var key = this.Macro.exec(code, this);\r if (!obj || (typeOf(obj) !== \"object\")) obj = {};\r this.sectionListObj[name] = key || \"\";\r //if (key) obj[key] = v;\r return obj;\r },\r saveWork: function (callback, silent) {\r \r if (this.businessData.control[\"allowSave\"]) {\r this.fireEvent(\"beforeSave\");\r this.fireEvent(\"beforeSaveWork\");\r \r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeSave\");\r this.saveFormData(function (json) {\r if (this.app &amp;&amp; !silent) this.app.notice(MWF.xApplication.process.Xform.LP.dataSaved, \"success\");\r if (callback &amp;&amp; typeOf(callback) === \"function\") callback();\r this.fireEvent(\"afterSave\");\r this.fireEvent(\"afterSaveWork\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterSave\");\r }.bind(this));\r \r } else {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r //if (failure) failure(null, \"Permission Denied\", \"\");\r }\r },\r \r getSectionList: function () {\r return Object.keys(this.sectionListObj).map(function (p) {\r var o = { \"path\": p };\r if (this.sectionListObj[p]) o.key = this.sectionListObj[p];\r return o;\r }.bind(this));\r },\r \r \r setModifedDataByPathList: function (data, pathList) {\r var d = this.modifedData;\r for (var i = 0; i &lt; pathList.length; i++) {\r if (i === pathList.length - 1) {\r d[pathList[i]] = data;\r } else {\r if (typeOf(d[pathList[i]]) === \"object\" || typeOf(d[pathList[i]]) === \"array\") {\r d = d[pathList[i]]\r } else if (typeOf(pathList[i]) === \"number\") {\r d = d[pathList[i]] = [];\r } else {\r d = d[pathList[i]] = {};\r }\r }\r }\r },\r getOrigianlPathData: function (pathList) {\r var d = this.businessData.originalData;\r for (var i = 0; i &lt; pathList.length; i++) {\r if (i === pathList.length - 1) {\r d = d[pathList[i]];\r } else {\r if (typeOf(d[pathList[i]]) === \"object\" || typeOf(d[pathList[i]]) === \"array\") {\r d = d[pathList[i]];\r } else {\r return null;\r }\r }\r }\r return d;\r },\r setModifedData: function (data, pathList) {\r pathList = pathList || [];\r if (typeOf(data) === \"object\") {\r for (var key in data) {\r var pList = Array.clone(pathList);\r pList.push(key);\r this.setModifedData(data[key], pList);\r }\r } else if (typeOf(data) === \"array\") {\r var od = this.getOrigianlPathData(pathList);\r // if (typeOf(od) !== \"array\" || od.length !== data.length || JSON.stringify(od) !== JSON.stringify(data)) {\r if (typeOf(od) !== \"array\" || od.length !== data.length || !this.compareObjects( od, data ) ) {\r this.setModifedDataByPathList(data, pathList);\r }\r //}else{\r // for( var i=0; i&lt;data.length; i++ ){\r // this.setModifedData(data[i], pathList.push(i));\r // }\r //}\r } else if (typeOf(data) !== \"null\") { //后台对null是忽略处理的，认为值没有变化\r var od = this.getOrigianlPathData(pathList);\r if (typeOf(data) !== typeOf(od) || data !== od) {\r this.setModifedDataByPathList(data, pathList);\r }\r }\r },\r compareObjects: function(o, p, deep){\r if( !deep )deep = 0;\r if( deep > 15 )return false; //最大层数，避免相互嵌套\r var type1 = typeOf( o ), type2 = typeOf( p );\r if( type1 !== type2 )return false;\r \r if( type1 === \"object\" ){\r for( var k in o ){\r if( o[k] === null || o[k] === undefined )delete o[k]\r }\r for( var k in p ){\r if( p[k] === null || p[k] === undefined )delete p[k]\r }\r }\r switch (type1) {\r case \"object\":\r case \"array\":\r var i, keysO = Object.keys(o), keysP = Object.keys(p);\r if (keysO.length !== keysP.length){\r return false;\r }\r keysO.sort();\r keysP.sort();\r for ( i=0; i&lt;keysO.length; i++ ){\r var key = keysO[i];\r if( type1 === \"array\" )key = key.toInt();\r var valueO = o[key], valueP = p[key];\r if( this.compareObjects( valueO, valueP, deep++ ) === false ){\r return false;\r }\r }\r break;\r case \"function\":\r break;\r default:\r if (o!==p){\r return false;\r }\r }\r return true;\r },\r \r saveFormData: function (callback, failure, history, data, issubmit, isstart) {\r if (this.businessData.work.startTime) {\r this.saveFormDataInstance(callback, failure, history, data, issubmit);\r } else {\r this.saveFormDataDraft(callback, failure, history, data, issubmit, isstart);\r }\r },\r saveFormDataInstance: function (callback, failure, history, data, issubmit) {\r if (this.officeList) {\r this.officeList.each(function (module) {\r module.save(history);\r });\r }\r var data = data || this.getData(issubmit);\r \r this.modifedData = {};\r this.setModifedData(data);\r \r this.workAction.saveData(callback || function () { }, failure, this.businessData.work.id, this.modifedData);\r \r this.businessData.originalData = null;\r this.businessData.originalData = Object.clone(data);\r },\r saveFormDataDraft: function (callback, failure, history, data, issubmit, isstart) {\r if (this.officeList) {\r this.officeList.each(function (module) {\r module.save(history);\r });\r }\r var data = data || this.getData(issubmit);\r var draft = {\r \"data\": data,\r \"work\": this.businessData.work,\r \"identity\": this.businessData.work.creatorIdentityDn\r }\r this.workAction.saveDraft(draft, function (json) {\r this.workAction.getDraft(json.data.id, function (json) {\r this.businessData.work = json.data.work;\r this.app.options.draftId = json.data.work.id;\r \r if (layout.app &amp;&amp; layout.app.inBrowser) {\r if (layout.app) layout.app.$openWithSelf = true;\r if (callback) callback();\r if (!isstart) layout.desktop.openApplication(null, \"process.Work\", { \"draftId\": this.app.options.draftId });\r } else {\r this.app.options.desktopReload = true;\r \r this.app.appId = \"process.Work\" + json.data.work.id;\r if (layout.desktop.apps) {\r delete layout.desktop.apps[this.app.options.appId];\r } else {\r layout.desktop.apps = {};\r }\r layout.desktop.apps[this.app.appId] = this.app;\r \r if (callback) callback();\r \r if (!isstart) this.app.reload();\r }\r \r }.bind(this));\r }.bind(this), failure);\r this.businessData.originalData = null;\r this.businessData.originalData = Object.clone(data);\r },\r setProcessorSectionOrgList: function (data) {\r if (!this.routeDataList) this.getRouteDataList();\r var routeList = this.routeDataList;\r //var processorSectionOrg = [];\r for (var i = 0; i &lt; routeList.length; i++) {\r (routeList[i].selectConfigList || []).each(function (config, j) {\r if (config.section == \"yes\") {\r this.setSection(config, data);\r }\r }.bind(this))\r }\r },\r \r /**\r * @summary 获取当前工作的路由配置数据.\r * @example\r * this.form.getApp().appForm.getRouteDataList();\r * @return {Object[]}\r */\r getRouteDataList: function () {\r if (!this.routeDataList) {\r o2.Actions.get(\"x_processplatform_assemble_surface\").listRoute({ \"valueList\": this.businessData.task.routeList }, function (json) {\r json.data.each(function (d) {\r d.selectConfigList = JSON.parse(d.selectConfig || \"[]\");\r }.bind(this));\r this.routeDataList = json.data;\r }.bind(this), null, false);\r }\r return this.routeDataList;\r },\r \r beforeCloseWork: function () {\r this.fireEvent(\"beforeClose\");\r if (this.app &amp;&amp; this.app.fireEvent) {\r this.app.fireEvent(\"beforeClose\");\r // this.fireEvent(\"afterClose\");\r }\r if (!this.options.readonly) {\r if (this.businessData.work &amp;&amp; this.businessData.work.id) {\r if (!this.isSendBeacon) {\r if (this.app.inBrowser &amp;&amp; navigator.sendBeacon) {\r var obj = this.workAction.action.actions[\"checkDraft\"];\r var url = this.workAction.action.address + obj.uri;\r url = url.replace(\"{id}\", this.businessData.work.id);\r navigator.sendBeacon(url);\r } else {\r this.workAction.checkDraft(this.businessData.work.id, function () {\r if (layout.desktop.apps) {\r if (layout.desktop.apps[\"TaskCenter\"] &amp;&amp; layout.desktop.apps[\"TaskCenter\"].window) {\r layout.desktop.apps[\"TaskCenter\"].content.unmask();\r layout.desktop.apps[\"TaskCenter\"].refreshAll();\r }\r }\r }.bind(this), null, false);\r }\r this.isSendBeacon = true;\r }\r }\r } else {\r this.app.refreshTaskCenter();\r }\r },\r closeWork: function () {\r // this.fireEvent(\"beforeClose\");\r // if (this.app &amp;&amp; this.app.fireEvent){\r // this.app.fireEvent(\"beforeClose\");\r // // this.fireEvent(\"afterClose\");\r // }\r // debugger;\r // if (!this.options.readonly)\r // if (this.businessData.work) this.workAction.checkDraft(this.businessData.work.id);\r \r this.app.close();\r },\r getMessageContent: function (data, maxLength, titlelp) {\r var content = \"\";\r if (data.completed) {\r content += MWF.xApplication.process.Xform.LP.workCompleted;\r } else {\r if (data.occurSignalStack) {\r if (data.signalStack &amp;&amp; data.signalStack.length) {\r var activityUsers = [];\r data.signalStack.each(function (stack) {\r var idList = [];\r if (stack.splitExecute) {\r idList = stack.splitExecute.splitValueList || [];\r }\r if (stack.manualExecute) {\r idList = stack.manualExecute.identities || [];\r }\r var count = 0;\r var ids = [];\r idList.each( function(i){\r var cn = o2.name.cn(i);\r if( !ids.contains( cn ) ){\r ids.push(cn)\r }\r });\r if (ids.length > 8) {\r count = ids.length;\r ids = ids.slice(0, 8);\r }\r ids = o2.name.cns(ids);\r var lp = MWF.xApplication.process.Xform.LP;\r var t = \"&lt;b>\" + lp.nextActivity + \"&lt;/b>&lt;span style='color: #ea621f'>\" + stack.name + \"&lt;/span>；&lt;b>\" + lp.nextUser + \"&lt;/b>&lt;span style='color: #ea621f'>\" + ids.join(\",\") + \"&lt;/span> &lt;b>\" + ((count) ? \",\" + lp.next_etc.replace(\"{count}\", count) : \"\") + \"&lt;/b>\";\r activityUsers.push(t);\r }.bind(this));\r content += activityUsers.join(\"&lt;br>\");\r } else {\r content += MWF.xApplication.process.Xform.LP.taskCompleted;\r }\r } else {\r if (data.properties.nextManualList &amp;&amp; data.properties.nextManualList.length) {\r var activityUsers = [];\r data.properties.nextManualList.each(function (a) {\r var ids = [];\r a.taskIdentityList.each(function (i) {\r var cn = o2.name.cn(i);\r if( !ids.contains( cn ) ){\r ids.push(cn)\r }\r });\r var t = \"&lt;b>\" + MWF.xApplication.process.Xform.LP.nextActivity + \"&lt;/b>&lt;span style='color: #ea621f'>\" + a.activityName + \"&lt;/span>；&lt;b>\" + MWF.xApplication.process.Xform.LP.nextUser + \"&lt;/b>&lt;span style='color: #ea621f'>\" + ids.join(\",\") + \"&lt;/span>\";\r activityUsers.push(t);\r });\r content += activityUsers.join(\"&lt;br>\");\r } else {\r if (data.arrivedActivityName) {\r content += MWF.xApplication.process.Xform.LP.arrivedActivity + data.arrivedActivityName;\r } else {\r content += MWF.xApplication.process.Xform.LP.taskCompleted;\r }\r \r }\r }\r }\r var title = this.businessData.data.title || this.businessData.data.subject || this.businessData.work.title\r if (maxLength &amp;&amp; title.length > maxLength) {\r title = title.substr(0, maxLength) + \"...\"\r }\r return \"&lt;div>\" + (titlelp || MWF.xApplication.process.Xform.LP.taskProcessedMessage) + \"“\" + title + \"”&lt;/div>\" + content;\r },\r addMessage: function (data, notShowBrowserDkg) {\r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.taskProcessed,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.taskProcessedMessage)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser &amp;&amp; !notShowBrowserDkg) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.taskProcessedMessage));\r }\r }\r },\r formValidation: function (routeName, opinion, medias) {\r if (this.options.readonly) return true;\r this.Macro.environment.form.currentRouteName = routeName;\r this.Macro.environment.form.opinion = opinion;\r this.Macro.environment.form.medias = medias;\r \r var flag = true;\r //flag = this.validation();\r Object.each(this.forms, function (field, key) {\r field.validationMode();\r if (!field.validation(routeName, opinion, medias)) flag = false;\r }.bind(this));\r return flag;\r },\r validation: function (routeName, opinion, processor, medias) {\r this.Macro.environment.form.currentRouteName = routeName;\r this.Macro.environment.form.opinion = opinion;\r this.Macro.environment.form.medias = medias;\r var routeFlag = this.validationRoute(processor);\r var opinionFlag = this.validationOpinion(processor);\r return routeFlag &amp;&amp; opinionFlag;\r },\r validationRoute: function (processor) {\r if (!this.json.validationRoute) return true;\r if (!this.json.validationRoute.code) return true;\r var flag = this.Macro.exec(this.json.validationRoute.code, this);\r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString() != \"true\") {\r this.notValidationRouteMode(flag, processor);\r return false;\r }\r return true;\r },\r validationOpinion: function (processor) {\r if (!this.json.validationOpinion) return true;\r if (!this.json.validationOpinion.code) return true;\r var flag = this.Macro.exec(this.json.validationOpinion.code, this);\r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString() != \"true\") {\r this.notValidationOpinionMode(flag, processor);\r return false;\r }\r return true;\r },\r formCustomValidation: function () {\r if (!this.json.validationFormCustom) return true;\r if (!this.json.validationFormCustom.code) return true;\r var flag = this.Macro.exec(this.json.validationFormCustom.code, this);\r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString() != \"true\") {\r this.notValidationOpinionMode(flag);\r return false;\r }\r return true;\r },\r notValidationRouteMode: function (flag, processor) {\r if (processor) processor.routeSelectorArea.setStyle(\"background-color\", \"#ffe9e9\");\r MWF.xDesktop.notice(\r \"error\",\r { \"x\": \"center\", \"y\": \"top\" },\r flag,\r (processor) ? processor.routeSelectorArea : this.app.content,\r null, //{\"x\": 0, \"y\": 30}\r { \"closeOnBoxClick\": true, \"closeOnBodyClick\": true, \"fixed\": true, \"delayClose\": 6000 }\r );\r //new mBox.Notice({\r // type: \"error\",\r // position: {\"x\": \"center\", \"y\": \"top\"},\r // move: false,\r // target: (processor) ? processor.routeSelectorArea : this.app.content,\r // delayClose: 6000,\r // content: flag\r //});\r },\r notValidationOpinionMode: function (flag, processor) {\r if (processor) processor.inputTextarea.setStyle(\"background-color\", \"#ffe9e9\");\r MWF.xDesktop.notice(\r \"error\",\r (processor) ? { \"x\": \"center\", \"y\": \"top\" } : { \"x\": \"right\", \"y\": \"top\" },\r flag,\r (processor) ? processor.inputTextarea : this.app.content,\r null, //{\"x\": 0, \"y\": 30}\r { \"closeOnBoxClick\": true, \"closeOnBodyClick\": true, \"fixed\": true, \"delayClose\": 6000 }\r );\r //new mBox.Notice({\r // type: \"error\",\r // position: (processor) ? {\"x\": \"center\", \"y\": \"top\"} : {\"x\": \"right\", \"y\": \"top\"},\r // move: false,\r // target: (processor) ? processor.inputTextarea : this.app.content,\r // delayClose: 6000,\r // content: flag\r //});\r },\r \r \r //fireRtEvent: function(type, args, delay){\r // type = removeOn(type);\r // var events = this.$events[type];\r // if (!events) return this;\r // if (!events.length) return this;\r // var event = events[events.length-1];\r // args = Array.from(args);\r // if (delay) fn.delay(delay, this, args);\r // else return fn.apply(this, args);\r // return this;\r //},\r getIgnoreImpowerIdentity: function (processorOrgList) {\r \r var list = [];\r var check = function (org, isProcessOrg) {\r var moduleData = isProcessOrg ? org.getValue() : org.getData();\r var flag = false;\r if (typeOf(moduleData) === \"array\" &amp;&amp; moduleData.length) {\r moduleData.each(function (d) {\r if (d.ignoreEmpower) {\r list.push(d.distinguishedName || d.unique || d.id);\r d.ignoredEmpower = true;\r delete d.ignoreEmpower;\r flag = true;\r }\r })\r }\r if (flag) org.setData(moduleData);\r }\r \r var modules = this.modules;\r for (var i = 0; i &lt; modules.length; i++) {\r var module = modules[i];\r var moduleName = module.json.moduleName;\r if (!moduleName) moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r if (moduleName === \"org\") {\r check(module)\r }\r }\r if (processorOrgList &amp;&amp; processorOrgList.length > 0) {\r for (var i = 0; i &lt; processorOrgList.length; i++) {\r check(processorOrgList[i], true)\r }\r }\r \r return list;\r },\r //saveDocumentEditor\r submitWork: function (routeName, opinion, medias, callback, processor, data, appendTaskIdentityList, processorOrgList, callbackBeforeSave) {\r if (!this.businessData.control[\"allowProcessing\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r this.app.content.unmask();\r if (processor &amp;&amp; processor.node) processor.node.unmask();\r return false;\r }\r \r if (!this.formValidation(routeName, opinion, medias)) {\r this.app.content.unmask();\r //this.app.notice(\"\", \"error\", target, where, offset);\r if (callback) callback();\r return false;\r }\r if (!this.validation(routeName, opinion, processor, medias)) {\r //this.app.content.unmask();\r if (processor &amp;&amp; processor.node) processor.node.unmask();\r //if (callback) callback();\r return false;\r }\r if (!opinion) {\r var idx = this.businessData.task.routeNameList.indexOf(routeName);\r if (this.businessData.task.routeOpinionList[idx]) {\r opinion = this.businessData.task.routeOpinionList[idx];\r }\r // else{\r // opinion = routeName;\r // }\r }\r this.fireEvent(\"beforeProcess\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeProcess\");\r // if (this.documenteditorList) {\r // this.documenteditorList.each(function (module) {\r // module.save(history);\r // });\r // }\r \r //处理忽略授权\r var ignoreEmpowerIdentityList = this.getIgnoreImpowerIdentity(processorOrgList);\r \r var _self = this;\r MWF.require(\"MWF.widget.Mask\", function () {\r this.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r this.mask.loadNode(this.app.content);\r \r if (callbackBeforeSave) callbackBeforeSave();\r this.fireEvent(\"beforeSave\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeSave\");\r this.saveFormData(function (json) {\r this.businessData.task.routeName = routeName;\r this.businessData.task.opinion = opinion || \"\";\r \r var mediaIds = [];\r if (medias &amp;&amp; medias.length) {\r medias.each(function (file) {\r var formData = new FormData();\r formData.append(\"file\", file);\r formData.append(\"site\", \"$mediaOpinion\");\r this.workAction.uploadAttachment(this.businessData.work.id, formData, file, function (json) {\r mediaIds.push(json.data.id);\r }.bind(this), null, false);\r }.bind(this));\r }\r if (mediaIds.length) this.businessData.task.mediaOpinion = mediaIds.join(\",\");\r \r if (appendTaskIdentityList &amp;&amp; appendTaskIdentityList.length) {\r var list = [];\r appendTaskIdentityList.each(function (identity) {\r if (typeOf(identity) === \"object\") {\r list.push(identity.distinguishedName || identity.unique || identity.id)\r } else {\r list.push(identity);\r }\r }.bind(this));\r this.businessData.task.appendTaskIdentityList = list;\r }\r \r this.businessData.task.ignoreEmpowerIdentityList = ignoreEmpowerIdentityList;\r \r this.fireEvent(\"afterSave\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterSave\");\r \r this.workAction.processTask(function (json) {\r //if (processor) processor.destroy();\r //if (processNode) processNode.destroy();\r if (callback) callback(json);\r \r this.taskList = json.data;\r this.fireEvent(\"afterProcess\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterProcess\");\r // this.notice(MWF.xApplication.process.Xform.LP.taskProcessed, \"success\");\r this.addMessage(json.data, true);\r \r if (this.app.taskObject) this.app.taskObject.destroy();\r \r if (this.closeImmediatelyOnProcess) {\r this.app.close();\r } else if (typeOf(this.showCustomSubmitedDialog) === \"function\") {\r this.showCustomSubmitedDialog(json.data);\r } else if (layout.mobile) {\r //移动端页面关闭\r _self.finishOnMobile()\r } else {\r if (this.app.inBrowser) {\r if (this.mask) this.mask.hide();\r if (this.json.isPrompt !== false) {\r this.showSubmitedDialog(json.data);\r } else {\r if (this.json.afterProcessAction == \"redirect\" &amp;&amp; this.json.afterProcessRedirectScript &amp;&amp; this.json.afterProcessRedirectScript.code) {\r var url = this.Macro.exec(this.json.afterProcessRedirectScript.code, this);\r (new URI(url)).go();\r } else {\r this.app.close();\r }\r }\r //}\r \r } else {\r this.app.close();\r }\r }\r //window.setTimeout(function(){this.app.close();}.bind(this), 2000);\r }.bind(this), null, this.businessData.task.id, this.businessData.task);\r }.bind(this), null, true, data, true);\r \r }.bind(this));\r },\r showSubmitedDialog: function (data) {\r var content = this.getMessageContent(data, this.json.submitedDlgStyle ? this.json.submitedDlgStyle.maxTitleLength : 60);\r //if( this.json.submitedDlgUseNotice ){\r // MWF.xDesktop.notice(\"success\", {x: \"right\", y:\"top\"}, content);\r // if (this.json.isPrompt!==false){\r // if (this.json.promptCloseTime!=0){\r // var t = this.json.promptCloseTime || 2;\r // t = t.toInt()*1000;\r // var _work = this;\r // window.setTimeout(function(){ _work.app.close();}, t);\r // }\r // }else{\r // this.app.close();\r // }\r //}else{\r var div = new Element(\"div\", { \"styles\": { \"margin\": \"10px 10px 0px 10px\", \"padding\": \"5px\", \"overflow\": \"hidden\", \"width\": \"270px\" } }).inject(this.app.content);\r div.set(\"html\", content);\r var timerNode = new Element(\"div\", { \"styles\": { \"margin-top\": \"5px\" } }).inject(div);\r var options = {\r \"content\": div,\r \"isTitle\": false,\r \"width\": 350,\r \"height\": 180,\r \"buttonList\": [\r {\r \"text\": this.app.lp.closePage,\r \"action\": function () {\r dlg.close();\r if (this.json.afterProcessAction == \"redirect\" &amp;&amp; this.json.afterProcessRedirectScript &amp;&amp; this.json.afterProcessRedirectScript.code) {\r var url = this.Macro.exec(this.json.afterProcessRedirectScript.code, this);\r (new URI(url)).go();\r } else {\r this.app.close();\r }\r }.bind(this)\r }\r ]\r };\r if (this.json.submitedDlgStyle) {\r options = Object.merge(options, this.json.submitedDlgStyle);\r if (this.json.submitedDlgStyle.contentStyle) {\r div.setStyles(this.json.submitedDlgStyle.contentStyle);\r delete options.contentStyle;\r }\r }\r var size = this.app.content.getSize();\r switch (options.promptPosition || this.json.promptPosition || \"righttop\") {\r case \"lefttop\":\r options.top = 10;\r options.left = 10;\r options.fromTop = 10;\r options.fromLeft = 10;\r break;\r case \"righttop\":\r options.top = 10;\r options.left = size.x - options.width - 10;\r options.fromTop = 10;\r options.fromLeft = size.x - 10;\r break;\r case \"leftbottom\":\r options.top = size.y - options.height - 10;\r options.left = 10;\r options.fromTop = size.y - 10;\r options.fromLeft = 10;\r break;\r case \"rightbottom\":\r options.top = size.y - options.height - 10;\r options.left = size.x - options.width - 10;\r options.fromTop = size.y - 10;\r options.fromLeft = size.x - 10;\r break;\r default:\r delete options.top;\r delete options.left;\r delete options.fromTop;\r delete options.fromLeft;\r }\r var _work = this;\r options.onPostLoad = function () {\r \r var dialog = this;\r dialog.node.setStyle(\"display\", \"block\");\r var nodeSize = div.getSize();\r dialog.content.setStyles({\r //\"width\" : nodeSize.x,\r \"height\": nodeSize.y\r });\r dialog.setContentSize();\r \r if ((options.promptCloseTime || _work.json.promptCloseTime) != 0) {\r var t = options.promptCloseTime || _work.json.promptCloseTime || 2;\r t = t.toInt() * 1000;\r \r if (options.isCountDown) {\r timerNode.set(\"text\", _work.app.lp.closePageCountDownText.replace(\"{second}\", Math.ceil(t / 1000).toString()));\r t = t - 1000;\r \r var countDown = function () {\r if (t > 0) {\r timerNode.set(\"text\", _work.app.lp.closePageCountDownText.replace(\"{second}\", Math.ceil(t / 1000).toString()));\r t = t - 1000;\r window.setTimeout(countDown, 1000);\r } else {\r dlg.close();\r \r if (_work.json.afterProcessAction == \"redirect\" &amp;&amp; _work.json.afterProcessRedirectScript &amp;&amp; _work.json.afterProcessRedirectScript.code) {\r var url = _work.Macro.exec(_work.json.afterProcessRedirectScript.code, _work);\r (new URI(url)).go();\r } else {\r _work.app.close();\r }\r }\r };\r window.setTimeout(countDown, 1000);\r } else {\r window.setTimeout(function () {\r if (_work.json.afterProcessAction == \"redirect\" &amp;&amp; _work.json.afterProcessRedirectScript &amp;&amp; _work.json.afterProcessRedirectScript.code) {\r var url = _work.Macro.exec(_work.json.afterProcessRedirectScript.code, _work);\r (new URI(url)).go();\r } else {\r _work.app.close();\r }\r }, t);\r }\r }\r };\r var dlg = o2.DL.open(options);\r \r },\r startDraftProcess: function () {\r if (!this.formCustomValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r if (!this.formValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r this.saveFormData(function () {\r this.workAction.startDraft(this.businessData.work.id, function (json) {\r this.app.options.workId = json.data[0].work;\r if (layout.mobile || !layout.desktop.message) {\r if (layout.notice) {\r layout.notice(MWF.xApplication.process.Xform.LP.processStartedMessage + \"“[\" + json.data[0].processName + \"]\" + (this.businessData.data.title || this.businessData.data.subject));\r }\r } else {\r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.processStarted,\r \"content\": \"&lt;div>\" + MWF.xApplication.process.Xform.LP.processStartedMessage + \"“[\" + json.data[0].processName + \"]\" + (this.businessData.data.title || this.businessData.data.subject) + \"”&lt;/div>\"\r };\r \r var tooltip = layout.desktop.message.addTooltip(msg);\r var item = layout.desktop.message.addMessage(msg);\r }\r }\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r if (layout.app) layout.app.$openWithSelf = true;\r layout.desktop.openApplication(null, \"process.Work\", { \"workId\": this.app.options.workId, \"action\": \"processTask\" });\r }\r this.app.options.action = \"processTask\";\r this.app.reload();\r \r //this.app.notice(MWF.xApplication.process.Xform.LP.dataSaved, \"success\");\r //草稿模式暂时不能上传附件，不能直接流转文件\r // o2.Actions.invokeAsync([\r // {\"action\": this.workAction, \"name\": \"loadWork\"},\r // {\"action\": this.workAction, \"name\": \"getWorkControl\"},\r // {\"action\": this.workAction, \"name\": \"getWorkLog\"},\r // {\"action\": this.workAction, \"name\": \"getRecordLog\"},\r // {\"action\": this.workAction, \"name\": \"listAttachments\"}\r // ], {\"success\": function(json_work, json_control, json_log, json_record, json_att){\r // if (json_work &amp;&amp; json_control &amp;&amp; json_log &amp;&amp; json_att){\r // this.app.parseData(json_work.data, json_control.data, null, json_log.data, json_record.data, json_att.data);\r // var workData = json_work.data;\r // this.businessData.activity = workData.activity;\r // this.businessData.originalData = Object.clone( this.businessData.data );\r // this.businessData.taskList = workData.taskList;\r // this.businessData.task = this.getCurrentTaskData(workData);\r // this.businessData.taskList = workData.taskList;\r // this.businessData.readList = workData.readList;\r // this.businessData.work = workData.work;\r // this.businessData.workCompleted = (workData.work.completedTime) ? workData.work : null;\r //\r // this.businessData.workLogList = json_log.data;\r // this.businessData.recordList = json_record.data;\r // this.businessData.attachmentList = json_att.data;\r // this.businessData.control = json_control.data;\r //\r // if (this.businessData.task){\r // this.processWork();\r // }else{\r // this.app.options.workId = json.data[0].work;\r // this.app.reload();\r // }\r // }\r // }.bind(this), \"failure\": function(){}}, json.data[0].work);\r \r }.bind(this));\r }.bind(this), null, false, null, false, true)\r },\r getCurrentTaskData: function (data) {\r if ((data.currentTaskIndex || data.currentTaskIndex === 0) &amp;&amp; data.currentTaskIndex != -1) {\r this.app.options.taskId = this.businessData.taskList[data.currentTaskIndex].id;\r return this.businessData.taskList[data.currentTaskIndex];\r }\r return null;\r },\r \r processWork: function () {\r var _self = this;\r \r if (!this.businessData.work.startTime) {\r this.startDraftProcess();\r } else if (this.json.submitFormType === \"select\") {\r this.processWork_custom();\r } else if (this.json.submitFormType === \"script\") {\r this.processWork_custom();\r } else {\r if (this.json.mode == \"Mobile\") {\r setTimeout(function () {\r this.processWork_mobile();\r }.bind(this), 100);\r } else {\r this.processWork_pc();\r }\r }\r },\r processWork_custom: function () {\r this.fireEvent(\"beforeProcessWork\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeProcessWork\");\r \r if (!this.formCustomValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r \r if (!this.formValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r \r \r if (!this.submitFormModule) {\r if (!MWF[\"APPSubmitform\"]) {\r MWF.xDesktop.requireApp(\"process.Xform\", \"Subform\", null, false);\r }\r var submitFormContainer = new Element(\"div\").inject(layout.mobile ? $(document.body) : this.app.content);\r this.submitFormModule = new MWF[\"APPSubmitform\"](submitFormContainer, this.json, this);\r this.submitFormModule.addEvent(\"afterModulesLoad\", function () {\r this.submitFormModule.show();\r }.bind(this))\r this.submitFormModule.load();\r } else {\r this.submitFormModule.show();\r }\r },\r processWork_pc: function () {\r var _self = this;\r this.fireEvent(\"beforeProcessWork\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeProcessWork\");\r \r if (!this.formCustomValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r // MWF.require(\"MWF.widget.Mask\", function() {\r // this.mask = new MWF.widget.Mask({\"style\": \"desktop\", \"zIndex\": 50000});\r // this.mask.loadNode(this.app.content);\r \r if (!this.formValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r \r var setSize = function (notRecenter) {\r \r var dlg = this;\r if (!dlg || !dlg.node) return;\r dlg.node.setStyle(\"display\", \"block\");\r var size = processNode.getSize();\r dlg.content.setStyles({\r \"height\": size.y,\r \"width\": size.x\r });\r \r var s = dlg.setContentSize();\r // if ( dlg.content.getStyle(\"overflow-y\") === \"auto\" &amp;&amp; dlg.content.getStyle(\"overflow-x\") !== \"auto\" ) {\r // var paddingRight = (dlg.content.getStyle(\"padding-right\").toInt() || 0 );\r // if( paddingRight &lt; 20 ){\r // dlg.node.setStyle(\"width\", dlg.node.getStyle(\"width\").toInt() + 20 + \"px\");\r // dlg.content.setStyle(\"width\", dlg.content.getStyle(\"width\").toInt() + 20 + \"px\");\r // }\r // }\r if (!notRecenter) dlg.reCenter();\r }\r \r //var node = new Element(\"div\", {\"styles\": this.css.rollbackAreaNode});\r var processNode = new Element(\"div\", { \"styles\": this.app.css.processNode_Area }).inject(this.node);\r this.setProcessNode(processNode, \"process\", function (processor) {\r this.processDlg = o2.DL.open({\r \"title\": this.app.lp.process,\r \"style\": this.json.dialogStyle || \"user\",\r \"isResize\": false,\r \"content\": processNode,\r \"maskNode\": this.app.content,\r \"positionHeight\": 800,\r \"maxHeight\": 800,\r \"maxHeightPercent\": \"98%\",\r \"minTop\": 5,\r \"width\": \"auto\", //processNode.retrieve(\"width\") || 1000, //600,\r \"height\": \"auto\", //processNode.retrieve(\"height\") || 401,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function (d, e) {\r if (this.processor) this.processor.okButton.click();\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () {\r this.processDlg.close();\r if (this.processor) this.processor.destroy();\r }.bind(this)\r }\r ],\r \"onPostLoad\": function () {\r processor.options.mediaNode = this.content;\r setSize.call(this)\r }\r });\r \r }.bind(this), function () {\r if (this.processDlg) setSize.call(this.processDlg, true)\r }.bind(this));\r },\r processWork_mobile: function () {\r if (this.app.inBrowser) {\r this.app.content.setStyle(\"height\", document.body.getSize().y);\r }\r \r this.fireEvent(\"beforeProcessWork\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeProcessWork\");\r var position = this.app.content.getPosition(this.app.content.getOffsetParent());\r \r if (this.json.mode != \"Mobile\") {\r this.app.content.mask({\r \"destroyOnHide\": true,\r \"style\": this.app.css.maskNode,\r \"useIframeShim\": true,\r \"iframeShimOptions\": { \"browsers\": true },\r \"onShow\": function () {\r this.shim.shim.setStyles({\r \"opacity\": 0,\r \"top\": \"\" + position.y + \"px\",\r \"left\": \"\" + position.x + \"px\"\r });\r }\r });\r }\r \r if (!this.formCustomValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r // MWF.require(\"MWF.widget.Mask\", function() {\r // this.mask = new MWF.widget.Mask({\"style\": \"desktop\", \"zIndex\": 50000});\r // this.mask.loadNode(this.app.content);\r \r if (!this.formValidation(\"\", \"\")) {\r this.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r \r var processNode = this.createProcessNode();\r \r //this.setProcessNode(processNode);\r this.setProcessNode(processNode);\r \r this.showProcessNode(processNode);\r processNode.setStyle(\"overflow\", \"auto\");\r //}.bind(this));\r },\r \r createProcessNode: function () {\r var fromCss = this.app.css.processNode_from;\r var css = this.app.css.processNode;\r if (layout.mobile) {\r fromCss = this.app.css.processNodeMobile_from;\r css = this.app.css.processNodeMobile;\r \r // var contentSize = this.app.content.getSize();\r fromCss.width = \"100%\";\r css.width = \"100%\";\r fromCss.height = \"100%\";\r css.height = \"100%\";\r }\r \r if (this.json.mode == \"Mobile\") {\r var processNode = new Element(\"div\", { \"styles\": fromCss }).inject(document.body);\r } else {\r var processNode = new Element(\"div\", { \"styles\": fromCss }).inject(this.app.content);\r }\r \r \r processNode.position({\r relativeTo: this.app.content,\r position: \"topcenter\",\r edge: \"topcenter\"\r });\r return processNode;\r },\r getOpinion: function () {\r var opinion = \"\";\r var medias = [];\r Object.each(this.forms, function (m, id) {\r if (m.json.type === \"Opinion\") if (this.businessData.data[id]) opinion += \" \" + m._getBusinessSectionDataByPerson();\r if (m.handwritingFile) if (m.handwritingFile[layout.session.user.distinguishedName]) medias.push(m.handwritingFile[layout.session.user.distinguishedName]);\r if (m.soundFile) if (m.soundFile[layout.session.user.distinguishedName]) medias.push(m.soundFile[layout.session.user.distinguishedName]);\r if (m.videoFile) if (m.videoFile[layout.session.user.distinguishedName]) medias.push(m.videoFile[layout.session.user.distinguishedName]);\r }.bind(this));\r return { \"opinion\": opinion.trim(), \"medias\": medias };\r },\r setProcessNode: function (processNode, style, postLoadFun, resizeFun) {\r var _self = this;\r MWF.xDesktop.requireApp(\"process.Work\", \"Processor\", function () {\r var op = this.getOpinion();\r var mds = op.medias;\r \r var innerNode;\r if (layout.mobile) {\r innerNode = new Element(\"div\").inject(processNode);\r }\r \r this.processor = new MWF.xApplication.process.Work.Processor(innerNode || processNode, this.businessData.task, {\r \"style\": (layout.mobile) ? \"mobile\" : (style || \"default\"),\r \"opinion\": op.opinion,\r \"tabletWidth\": this.json.tabletWidth || 0,\r \"tabletHeight\": this.json.tabletHeight || 0,\r \"onPostLoad\": function () {\r if (postLoadFun) postLoadFun(this);\r },\r \"onResize\": function () {\r if (resizeFun) resizeFun();\r },\r \"onCancel\": function () {\r processNode.destroy();\r _self.app.content.unmask();\r delete this;\r },\r \"onSubmit\": function (routeName, opinion, medias, appendTaskIdentityList, processorOrgList, callbackBeforeSave) {\r if (!medias || !medias.length) {\r medias = mds;\r } else {\r medias = medias.concat(mds)\r }\r \r _self.submitWork(routeName, opinion, medias, function () {\r this.destroy();\r processNode.destroy();\r if (_self.processDlg) _self.processDlg.close();\r delete this;\r }.bind(this), this, null, appendTaskIdentityList, processorOrgList, callbackBeforeSave);\r }\r }, this);\r }.bind(this));\r },\r showProcessNode: function (processNode) {\r if (layout.mobile) {\r processNode.setStyles(this.app.css.processNodeMobile)\r } else {\r var size = this.app.content.getSize();\r var nodeSize = processNode.getSize();\r \r var top = size.y / 2 - nodeSize.y / 2 - 20;\r var left = size.x / 2 - nodeSize.x / 2;\r if (top &lt; 0) top = 0;\r \r this.app.css.processNode.top = \"\" + top + \"px\";\r this.app.css.processNode.left = \"\" + left + \"px\";\r \r var morph = new Fx.Morph(processNode, {\r \"duration\": 300,\r \"transition\": Fx.Transitions.Expo.easeOut\r });\r morph.start(this.app.css.processNode);\r }\r \r },\r \r \r confirm: function (type, e, title, text, width, height, ok, cancel, callback, mask, style) {\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var size = this.container.getSize();\r var x = 0;\r var y = 0;\r \r if (typeOf(e) === \"element\") {\r var position = e.getPosition(this.app.content);\r x = position.x;\r y = position.y;\r } else {\r if (Browser.name == \"firefox\") {\r x = parseFloat(e.event.clientX || e.event.x);\r y = parseFloat(e.event.clientY || e.event.y);\r } else {\r x = parseFloat(e.event.x);\r y = parseFloat(e.event.y);\r }\r \r if (e.target) {\r var position = e.target.getPosition(this.app.content);\r //var position = e.target.getPosition();\r x = position.x;\r y = position.y;\r }\r }\r \r // if (Browser.Platform.ios){\r // $(\"textdiv\").set(\"text\", \"$(document.body).getScroll().y: \"+$(document.body).getScroll().y);\r // y = y-$(document.body).getScroll().y;\r // }\r \r if (x + parseFloat(width) > size.x) {\r x = x - parseFloat(width);\r }\r if (x &lt; 0) x = 10;\r if (y + parseFloat(height) > size.y) {\r y = y - parseFloat(height);\r }\r if (y &lt; 0) y = 10;\r \r //var x = parseFloat((Browser.name===\"firefox\") ? e.event.clientX : e.event.x);\r //var y = parseFloat((Browser.name===\"firefox\") ? e.event.clientY : e.event.y);\r \r // if (x+parseFloat(width)>size.x){\r // x = x-parseFloat(width);\r // }\r if (x &lt; 0) x = 20;\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": title,\r \"style\": style || \"o2\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": e.event.y,\r \"fromLeft\": (Browser.name === \"firefox\") ? e.event.clientX - 20 : e.event.x - 20,\r \"width\": width,\r \"height\": height,\r \"text\": text,\r \"container\": this.app.content,\r \"maskNode\": mask || this.app.content,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": ok\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": cancel\r }\r ]\r });\r \r switch (type.toLowerCase()) {\r case \"success\":\r if (this.json.confirmIcon &amp;&amp; this.json.confirmIcon.success) {\r dlg.content.setStyle(\"background-image\", \"url(\" + this.json.confirmIcon.success + \")\");\r } else {\r dlg.content.setStyle(\"background-image\", \"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1hJREFUeNqsWGtsVEUUPnMf+y6rLcW2tDxUKARaikqgiWh8BlH8IwYkaozhh4nhB1FMTKkxQtQYQzRGE2JEfMRHYhQSVChgFYIGqLSUtoKUQmlp2b53u233de94zuzcZbfdbhdwkpPZmbl3zjffnHPuOcue/WgxZNnc3OT3cQ4rGIMlwNg8BjATGEwDDgHOeZdpQis3eKMR5Sd62kaO/PHp5QDub2ba9OtNTYnf2lQIcOO5igpr8eeT3kL9XneuCi6vAvYcFWxOBqrO6BlvZIx7w8PGwlG/uWZkwADNzo4//e7CfQMdYz/88t6F8/i+icB4Jl0sEzPIxEbsXiwotVd6C3TwTFezZRGCfQb4r0bhSnPo78io8dWP1ed24nRkPFNTMoMnnYNsbGYK2zR/pYsRGxJc1mDcuQqKHbwF2t3/Hh29a+3bC8oHOkM7UPk5UpGOpQQzFsINHyxahDaxdeYix/r8223AFLjpxpGL3rYIXDw5um+gc+ydwx9fqsPpKC0lP6eWr54hfjT+2gPP7Fg0R1HgreIyx/rpc2zxjfjNCzXXrSo4PMr8sWFecEuRo6mjMdBPdpQMJuWa6GoKF9jX55bo13UlE5jg8szobshyotG+RtT1OJrBAA43o/hRYhOYKVuVvxFtZPusCie7GUbQvcnmIBbh4noEoqR15zQV/N1GeXFZzvD5Y4P1ydclwJD7om1sn3uPs0S3x1++ESHlJgJB74FiXgkD4XZQLGr4NQtBh2DDvWa+3aOd7D4b7CGDFjcjr2dt3mxbpQNjB53sRsTA7YiN0IgBRWYlrJz2suhpTPO0bj1LegpKHWWFpZ6nUL0ngYOAUkBz34JAYjytEO1GJN5Pth4LmRAajkGxuQJWFb0CLpdL9DSmeVpPfp/0uXP1B2+b5y5A/cJbVLSVh9252uu5M/WM1BMYSLKBdFczS6mEx0peBbfbDU6nE1RVhdnOZdDj78AruyyvLP6+ZmMQDQMCYc3tp/xnKSAq9K2xuxmYBp8oeIJY2ITwSAxm8uWip7E43bj1ErYCHpsVB0KsOBwO0dOY5mdrlXhdSe+ikN6cPNtSeTsqgV2iOxRchFRBh4uGOSpCY8QTP5C/SfQ0pnkjmrq+es6WBBBN0wQrNpsNvF4vFBYWwgvL3ofFeY/EmZQ6SK/do5YiECeFGYW+vprGUu0AaY/iHYeDceqfmLtFKKGexjRP15K8ngxEUa6FbfpNwH5qfQua+w8lGCUhvbpDLZE2g8xgGkAhP4WRCJ3YhFk6KrozrignJ0f0NKb50LCRsp4OCJNu/X3LG3Cm92Dcm5LYJ71oO9MtMJrIRyguGzwRPelu5zoqYc28a4rodLqui2eexPk9/3DRTwXku6ZqaOo7KOw2bdqgMLf8EigaJUaxCHgT+yCY8hmPwrrFb4oNLbEUkGITj7iuoloozwTk28ZqONMzOZA4U3w07mLANMrQ0CO85GpWO+M7iKsMNlRsk2zxxP2TYo/HIwBZ43RAvmmohkZfzaRAqIlgGDH7rEChUaqIXrFQUVPfauiqEcifvWubUJAMiLwkLeUSyNenEMjVzECokTdGQman/FiaGuWs6DlrdNvENxs6DwCuw3PLtqcAygTkq5Nb4XT31EAEGIragVgrBTz6PmmUPBNdppH+hfrOGhEbnl8+OSALyJfHtwpGswFiXdNgV6jFAqPm3+7yOb36A5pdKaY906UF3f4LcNXfDhUlDyUUjwey+6+qOPAs0w8KH0NXI00nvu/aFQoaPnxtWKFyAhHui4Yw/0B20goyU3+5BnYfq0oASPYymqd1em7SPcYJ6fP7wn8OdYcp0RoRzFBiHPCFexRdqdR0VsRkzjpBiKGhC+BDhpbOfijBzOdHq+BU+4H4ic3sJIYRPtAbbWk+1Pv54JXQRdxmiExI+CTVNVROjI2YPGPeggrrLh2AXUeqBCvU09jk15f7kJ6+S6P7244PUT0VkDYTz/QoGf+ntr9h/srcIs2mLFVY5oyua7AVfIF2qGvbn5rFZSHESn9HaG/Nhxc/wxmylUErDxbMyBomQnVNcDC2Lyq9a1LB051o3T/hWzOV0L6D3eHalsN936K+PgkkYiWkyVWR+dsnl85RXRP0R3+OxbioEP4vof2GfOHac0f6v7h4cqhZghlNLldS6iZCiA/6qK7RnapLtSvlwCm43ES1QFdjco6s722q6d2NFcFp1NMjbSWWsdbGypIshj7POatfu+MlT55tnd2lljHOso1l18yIYYIeNFrIWGt3tv8o2SAZJu8h80iutRPMWE0aNFEXobqGygk0ar+iM5eqswIrqE0w3ASAeD8WjDX1d4ztIfet3+v7XRprL/0nQIxYtba8kan/hUDUikx8PJTFl96fdx/lrJQqUoZGiRHlI5QG0NeXPnr0raEQf7a2r04GtICU4FT/QmTDPJOGTqAcMnl2yrFNJkZWMIhJ7yAZk5E1JMfm+EI/naLraQRKlQBUKUoSGFNWh4YEZowv7jO1/wQYAIxJoZGb/Cz/AAAAAElFTkSuQmCC)\");\r }\r break;\r case \"error\":\r if (this.json.confirmIcon &amp;&amp; this.json.confirmIcon.error) {\r dlg.content.setStyle(\"background-image\", \"url(\" + this.json.confirmIcon.error + \")\");\r } else {\r dlg.content.setStyle(\"background-image\", \"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABsVJREFUeNqkWFtsFGUU/nZn2r21IqX3llp6AQmkWDVGAgIlGI0EeMAHffAFa998MCQaE8JDxZCgSHzQKIm3qPHFGC7GW0xqkIgIKhhEwFJaKSDQUtplu73s7vidmX/q32F2uw2TnOzMv2fO+f5z/8fci7yvWAZYRXo4CCwLAM1cq+HvXRYwQrrM/7rTwB+TwC/dwKG3uU75mVxCO7T7wExgKHiBATzJ2411wMoy3pSQ5gg6UiFpgpQgDZNukK6TLgBHuf7lAPD5q8DfXMpQl5U3mA4P4ztAO3+2tADLCQSV+VsR/5L+If0G/EqgH78EvKtwT1lqr0en6SfoLaCe1niB7nj+CQIuV+uZWYApV8RNPPAVcP/rQMtF4I03gbNcpjdvt5KxQXs4SKKflxBI54PAs20EElNvZTQJucjLFyUtpZwioJVurFtMD/4MXBXWDUqnL5jHHYt0PgQ8da/4UFMwThpTz0HF7wfEj0/kSKwVAwsZU5U1wKkTwOBBj7GD08xE17QSSJPanVCKlCSNkM5s2mT/JtV6epZ8InclsH4R9TjYRKWPZQixnch2POJsZNpOb5HOb9yIi5s3I5XJIHb2rL2LoBZL+fBZKhOZaS3LgPgh4HcnYZ34scFI+goQxsj8iA+QHipItrejrKwMiaVLMZJIIEpFAaUkH76AFrEVfLxEzzEej/0FXFOGc8CQ8bmFTOE6DciEUnCBCsapoLGxETU1NYhGo7i+YAHiSlFauWMmvqAGKOzcVzDlh2mdo2o/loCJkeEVRnldSMsGUdCrKaiqqkJxcTEikQgKCgpsRbJzk4oukm8iB1+CfEUKkLtZub/CZOsFvht0Qi1lrAfW0WwvN3gyI7J1K+7ZswfNzc0oLS1FKBRCMBiEaZoIh8OOovp6jI6NYXLLFjQ1NdlAxCKGYaCwsBAlJSWoJ08lwQZTKaSPHJmSL9YZZWZx438eZ8yLMwwWtWeYaqvv9oBJ8UWDyovWrUMgEPi/ZPPeBWT/rlhhx0h1dbUNRABPpSrvBVhixw4kd+26rRyMOq3jCl31kzya0vSiKgW91/DOnbZJ53V22iAsy5pSIopra2vtNflP3KIDcTcwuH074pQT8JEvelkMF4kjpBuY0n1Dbjj7XDcpSCCU+gCKxWK+77hABghkOAsQuUIOivmq3xrSm2qMLJZxrwEKlGJQ5QGUC8gVBSSYQ67hoCidAiPzSCCHZSxVlXopeHhiAk30v8RBtivFQO3etg1Du3fbbihQKe0L3MmqmGrYwaAMRuPKMl6aVCkeJ11jRvSuWYO+vj4kk0lf4bIu/wuf8MfV+5NZ5I87RhhVuAKmTGhsbHPCWSwiwoYoOMQ60tDQgPLycjvNfWOA6/J/Op3GefJzsMLcAwfs6PSz0JhTXAfcBDNlVCS0xaYHSEql3jCBRLSC5k3faV1XZZnwySWABmUqJKCo8oUOaNTZbL9SlzE4Niwh8lURLf/TyoQzAZFgdcmvDklhjKsKXKAqsF5rZEztAboOAz+KA4xHmeo0+tNFqky7VMkKfJ+nAnuV2rtn1pS0td32n16B67kpRjZuqQrs6pB5mW37s5OswoLNaOTUdRfQRjPWGhrqOF80aYVSTwXWgfQQSL8URiqa6wGkV+B+ZuAlTwUWF/VxyPoUeD/uTH5x4xhjiNapoHXWhj3l+ubhw0hTkbtz3SXdBNJHIJgFn+Vx0Tlg37eOi+RAkTTk+MDueY1WWc64qQ5oZpSXhpSiedrOz1HBBVWZZ8Pn0phzcjj9DfBBvz1r4aYkrz3PvEhZq9lIyfgY3RXwzrY3lKKytWtxhgp6fHaaL5+AoU8stulPvgB+UFZJuPOMPaF/D5wgoGq6q9XMosianER3FiD58iWcDNr/GvCegwtDbjeywShAGQ5Y3aYzZC00PELsDkxFmOGokosv6cy/XV8DHyr3XFfL1rSBnL/WNqKUcw3rQWWhD6A7oaSTPV1dwEecX07CmX1v6W3Re4iz5IAl5xqCiTIMW0zJ5DsAkXKOLxbHy/1iEQ3IiHdYmAbGdZccsBhDXXKcoMAyWqjCynJwywVCqjgbz2kJVokR5RoXyKRkctYTpQ5Iepica+Q4QesMU0GUoCozPjGS0QZ5t9uzJ51ioO6T9FVZc1XFiLgm5X6ROJjvJ5EOZ4iXwaeIs2Elz1WreExtlVFRJjQZjGQekTFAuq80PRazbp6JTtOyxy87FX9EkYCY8H6v6fDMNzNdagayQYXVZ5mIei7UmrHrnQlFSZXJY9qnECuXIjMPMJZ2lHIPj6aaGg0FNOD5CJHWjtl5f0n5T4ABAFHaXG6UVjGNAAAAAElFTkSuQmCC)\");\r }\r break;\r case \"info\":\r if (this.json.confirmIcon &amp;&amp; this.json.confirmIcon.info) {\r dlg.content.setStyle(\"background-image\", \"url(\" + this.json.confirmIcon.info + \")\");\r } else {\r dlg.content.setStyle(\"background-image\", \"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABvBJREFUeNqsWF1sFFUUPndm9n+3W5aWLi2VGgJtgy3UEn6MQGI0GgmC0UgfTEjEBxPDA29qYqLGGOODifGBGGOUYOKDPIg2QgykWgUtP1WgLT+lFKFCf9l2uz+z83c9Z3p3u1u6u4Pxpqczd+7MPd8999xzvrPskb2fgsMW4NzaBpxvBsbWMWCrgUEdAKsA4HHO+R2wrOucmxe5qZ9Jjt3ovtX1eRznt0pN2ndof+5eKYcAJ34YJPlFvH3OFV7+uOyPgOQLg+wJAXP5gMkueifM9XTYzMw2W+mZnWbqHjDF09Pc8WFneur2kaHOjwbxewuB8VK6WCnLoCVexcsrnmWNW1zhKMiBKqdWBDM5CfrMKKh3+8+bWurw1W/f/gwfawstVdYyuNIGtMYBxqT9/lVbmRyIZMFlUeKfCdyiPi0WN02ScPdkvGX2KxJa0IOiVETbU0O/Ptr00getamzkY1R+lbAuZiV52fpnC4FY5lqQpPe80bX7/A2bmIRbQcpzggAQLFhaGiw1aV+5nqEPEQcjWDnAJJLLC57q1Ux2+9tATzwUXN40PH3j7Nj4hWMW6cbr4mDmLIJAals63Esbsk8LhFsGAkjBY3UaPN8M8HKbBGsiHBRmwK1pEy0kC+Pkf4eK/EtA8gTX8Mxs1Lukti9+6+IUAco3ROE24dZ4apo6XEvq57dkQbPQKtsQ575NleB1z30erQbYsMoApScJ3bd1kMRWLWw0r9/Ud+Ci72H3AMoMinGfZchZ0Ufe961Yz/LNvFBoi/ZuDMKaukoIBAIQDofB7XaD1+MGl8Thl6EMWkYq+r3srQAzfrc1VN8yG7t26k/UpGfNJ+WOL54ab30746TQMkuIBVuaaiAUCoHf7wdFUewr9ek5jZf8HucnPe7Q0j3R9t0tqNdtn4AsGIoj7sjKLbI3ZDtiKSEnvTyqgSzLhScB+/ScxsvNQXq8NY0twdrGF/DTYBYH/QtQQJN9lbZzlhOa7MRADHRDnB4h1KfnNO5kHtLnCkSeCERXR4V1QK5e98yTij/ypquyrug+Fwhu7+BoGsbjGngVCaoq3NA7PAuHT4/BjxdjUMrf8oUpqN/IRNGO/TM3e69QQFQo1zB3wN7PMokht+802Q/nUij/5MVyNnesJTnrAmUb6UXfacPb71ESCiU9CkxQBsxcfFHB0tXFjz2CkRQP5iw/AlIcgSG9sjfYiLc+CjMKZV8mk4GM0mBw/MDTUdjc4ANVVUHXdftk5AIWnqozf6tw8FQc44yz/EV6ZZe3XvgM9ogGUFwoYxmav7IyAitXLgNN0yCRSNiAcgHN5YJdyyU42N2LSzYdopHId6rmwdh8BBz4DMA7Ry7D71fG4d2OFjvQFVqOg2EY837lsGGADIhMIFGojIOpoWUMB2LCsd4RSGdKbKmjeYSgXgSeEoZnCjE0y8iEMa06Wgk3DQxOJiZvdFhJWsTRnVuGIxjL0CazGVWxqaKeaba5iLMZcoGu2Dg4BYPUA0/niEiWlkKc1TLUnXYQcjKBZZQd55azhaFeMNLx6xTwiHApRJ65oTleTdn3rAewDOpVY3cGcmCIxQfrPD3I6DYRuS5vGbPsuBOfISqiJyb7Jge6zmE3TVslUTmBCDs5miy3qqJCJ6CMItPMnbxSQvoyM2OnM9N3iWglbcsQW6dyAq2yW5Hk9rncUiQ3oSKT9hnjCTkwRd15DKb93DRwkQwToVw8R5Hl0CoDscE/TmI3jqLSBttnk+oaKiesTJIT4V5MuGHY5Ht7cxWk00jGrcL8RH16TuM2STcMKDYX6UlN3Dw+PdQzKMBoOdpJDH1qoOuvSOPWWklxt9krWkg3cTVv7NkAr+3aaFNNsko+n6G+z+eDra0PQU2lD37rv7MonSBfUaduHx0+/skXODqGEsvyYNsyoobRqK4xUrFOCkZ2vMgThqYPBUMQDAbtYJcPJCv0nMbpPXp/4Rw0L/pI12T/yW9Q36QAomU5cEFFiQWW0vDU6xu9kRVvuXwVO+wE+n81pB2Z+HjX1JXuQ1NzJ2i0aHVADbeLU4FFdY3s9vkll6eVAWcLa6cHFeQ/XL03cnTi0k9fYUVwgVQJXzGKVpTCfywqsBB9F5UTyDmq8aTVsP8Cgk5ZJjGQHL32NfkIBrjhPCA6uUfRijIfEO0l1TWKJ3gWnXoG61w/U1zRnFPC/VVjlvFRM9REH4aM7yYunfhy7PzRn4WzThC9pOFsrZ0PpuSvEOhDkiA+QWLxS5u2byPOSlSRGBoRI+IjRAMo+1LSo1xDIZ4iqwhocSGJcr9COCGITJw6AuUVpY1P9N2CGDFhHkOcDk2E+KQIaNS3Ck24uKIHaQRKFgBkIVIeGFJoCjHE1XI6+b8CDABnZtjY0mkIGQAAAABJRU5ErkJggg==)\");\r }\r break;\r case \"warn\":\r if (this.json.confirmIcon &amp;&amp; this.json.confirmIcon.warn) {\r dlg.content.setStyle(\"background-image\", \"url(\" + this.json.confirmIcon.warn + \")\");\r } else {\r dlg.content.setStyle(\"background-image\", \"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABgtJREFUeNqsWG2IlFUUft6vmdlZd539GFdTY5VMomy1oBJUSPLXkmQt5I8gCIMK+iH0K4ooEvtTRP7JX9JKWCC1mUUkIkQKSoaZH60t2pboOK37Mc6Ozsw779t57t5xx5ndnTvhC4d373nnnnPuOeee85y1Jr+G6dNcCrBB6AnbQo9tY4UFLLYstIYhMsK/IjRULOF0voATx87jp60fICPygzmFbpn+26pnzK0ilrk2+kTp5kgC6+w4YDfJxpiQJ+QAYUmoKHQLCG4K5YDsCI7fzOPgcBr7172BP0VUILrC/22MnHSbvF6KLcRap1WMmGfsRQRZ2Z8BJv7BybEs9t6/DbuFXaj2VKUx7ize6BZvbHcdvB67D5bdrD/ocwUiruiLZPFGSbziiHci4iVPpEn41MM9pPZWPBofwiOX9uDh05fwkSgf5Dln8lKNZwo+HnRsvBVbjK1eJ39RdWIxJCfhGB0HxjNTBtGQhHiuPQHEY9MG3X5EbXEESA3i4KmL2Ln5Xfwi3CINmjVM9IjnYGeTGOJ2zOx+SU5cE8Hp/DMIopvgxFejlDsFO38IC6ID6JIDRCMz7/WvA1cG8d2PJ/H2y5/gLA2a9ndVmBia2CIxpL3yJ1XG5MUzTh8S3e/B9Zo09x74xSeRS7vyfT+i3sx7KXfRCvSuz2NUltuFJmhj+btdmazMEa+NsZidfIYlsQXzE51oa2tDV1eXenNNPr/PtZ/ylybxwtEP8Ypw4pU22OXrq27NvZIh4dzCeI07lvQiHo8jFovBdV315pp8fp9rP+VTT/cCPL/jRawSTqScma4OT1+sA2vtqN4w552V03meMsKyprLblowlj2s/qC+DepJLsWpjD56T5aDOnRI908yC5jTVOVEl1THWhKhPwrVx/UNYqL0DmyU+0iyVNWooKKxjTGgmh/o6k+h5tRcbhBNTDla9JtKAV+6SZ5RBondZF9YwOkKOq5qeZ6CkUpmJMQYP9Xa0YqX8ySRxXdV9bXMBloShnLg134RvhQ3IEr2tTViqc8ZxNQwwFuCJANsqiOJ4jSHke40cTPQ2RdFZNsYmHrEaiHVEmqI/drTGO+paC5/fTWVRghTaZl1ibJvAqG6hqqygIsG+/iXCID8VFk1ck+9Z5rKoV8BYThc9yyVCE2A0nyDJKOmEoiP98GV7mNwKO7EOwfjPwL9fKL7q2CUzWTRGANiILgghjRkKfTwAyxw4cWt4pR+F4X72NAn2FIxQzg4aECMtcmISl3WzDFxi1sDH046hZ4JQ45kbgmeyFXhGUGB7i8YzhgcTvbg2jiHCKPrTJXgmE56ZgKIoH5XGn/YEz3QLnpm/GrcmTiE9dkiOOaBuU9QzN+bsMM7dNoYo/qk1OC597vEahDbDU5BtuVbBMysr8ExS45lBV74LnjHwMhFjahRndn2rUN9NhsrmOEEUX/LNbgB/F13yLBJtyTvwDNfkNyLnj8s4dv5vBbQmVdcmWuc4IYl0MjC44jz0guWb0NLSojAMoQTfXJPvGNQs6hGvnNt7GIeFkyGk4hcVGM41HCcEZIV1ix53jJ+QieDOWKi18CN2fWOo58QF/PD5ETVPZXTO3IZ8Aeea9Dj2FOt4R7WDq1L0SlVFT9bke3WMofzf/8I3fTvwlXAYomy5IChj9AxT4FyTmsBBPyyXoVpSRe9qP8LfXkNw7ZAaIfnmmnwbs++l3AspHPl4APuEw2I3pr0S1owqMsO4B97BYz3L8eaiFvR6uHsPceWFNI7s/h6f7TqgblBq1umgPCRwwOJcc3EEe3NsOXN4yYRUkRQ5vw5j4P19+FQbkha6Ud04aiZK8Y6lS2ALxwmi+GQcqxyGKDT3RCBSSkKpLM4xWXWOjGi6UXeirDKI1yXOcYIonuC5s1lQoTbKKlPZCdYUBZpSGZxhHeH11bdmVOdIrnLWNv4vhPzQ1sBnHlE8wTMxK6EiERqBEfEIYQC7L5seew1LPCurLmgZTdl6/4UwaWmWzq2IRvHNGrNGNLmYdpCvb0dBl/hJXdAKJrOF1eClsHX4XP12NM+qGFJKmnz9NgYV/wkwAMYATK0QLuhAAAAAAElFTkSuQmCC)\");\r }\r break;\r default:\r if (this.json.confirmIcon &amp;&amp; this.json.confirmIcon.warn) {\r dlg.content.setStyle(\"background-image\", \"url(\" + this.json.confirmIcon.warn + \")\");\r }\r break;\r }\r dlg.show();\r }.bind(this));\r },\r alert: function (type, title, text, width, height) {\r this.app.alert(type, \"center\", title, text, width, height);\r },\r notice: function (content, type, target, where, offset, option) {\r if (!where) where = { \"x\": \"right\", \"y\": \"top\" };\r //if (!target) target = this.node;\r if (!type) type = \"ok\";\r var noticeTarget = target || this.app.window.content;\r var off = offset;\r if (!off) {\r off = {\r x: 10,\r y: where.y.toString().toLowerCase() == \"bottom\" ? 10 : 10\r };\r }\r var options = {\r type: type,\r position: where,\r move: false,\r target: noticeTarget,\r delayClose: (type === \"error\") ? 10000 : 5000,\r //delayClose: 20000000,\r offset: off,\r content: content\r }\r if (this.json.noticeStyle) {\r options = Object.merge(options, this.json.noticeStyle);\r }\r if (this.json[\"notice\" + type.capitalize() + \"Style\"]) {\r options = Object.merge(options, this.json[\"notice\" + type.capitalize() + \"Style\"]);\r }\r if (option &amp;&amp; typeOf(option) === \"object\") {\r options = Object.merge(options, option);\r }\r new mBox.Notice(options);\r },\r addSplit: function () {\r if (!this.businessData.control[\"allowAddSplit\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var width = 600;\r var height = 230;\r var p = MWF.getCenterPosition(this.app.content, width, height);\r \r var _self = this;\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.app.lp.addSplit,\r //\"style\": \"work\",\"\r \"style\": this.json.dialogStyle || \"user\",\r \"top\": p.y - 100,\r \"left\": p.x,\r \"fromTop\": p.y - 100,\r \"fromLeft\": p.x,\r \"width\": width,\r \"height\": height,\r \"url\": this.app.path + \"split.html\",\r \"container\": this.app.content,\r \"isClose\": true,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function (d, e) {\r //this.doResetWork(dlg);\r var input = dlg.content.getElement(\"input\");\r var checks = dlg.content.getElements(\".o2_addSplit_radio\");\r var value = input.get(\"value\");\r var trimExist = true;\r if (checks[1].checked) trimExist = false;\r _self.doAddSplit(dlg, value, trimExist);\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ],\r \"onPostShow\": function () {\r //var okButton = dlg.content.getElement(\".o2_addSplit_okButton\");\r //var cancelButton = dlg.content.getElement(\".o2_addSplit_cancelButton\");\r var selectButton = dlg.content.getElement(\".o2_addSplit_selector\");\r var input = dlg.content.getElement(\"input\");\r var checks = dlg.content.getElements(\".o2_addSplit_radio\");\r \r //okButton.addEvent(\"click\", function(){\r // var value = input.get(\"value\");\r // var trimExist = true;\r // if (checks[1].checked) trimExist = false;\r // _self.doAddSplit(this, value, trimExist);\r //}.bind(this));\r //cancelButton.addEvent(\"click\", function(){\r // this.close();\r //}.bind(this));\r selectButton.addEvent(\"click\", function () {\r var value = input.get(\"value\");\r MWF.xDesktop.requireApp(\"Selector\", \"package\", function () {\r new o2.O2Selector(_self.app.content, {\r \"type\": \"\",\r \"count\": 0,\r \"values\": (value) ? value.split(o2.splitStr) : [],\r \"types\": [\"unit\", \"identity\", \"group\", \"role\"],\r \"onComplete\": function (items) {\r var v = [];\r items.each(function (item) {\r v.push(item.data.distinguishedName);\r });\r input.set(\"value\", v.join(\", \"));\r }\r });\r }.bind(this));\r //_self.selectSplitUnit(this);\r }.bind(this));\r }\r });\r dlg.show();\r }.bind(this));\r },\r doAddSplit: function (dlg, splitValues, trimExist) {\r if (!splitValues) {\r this.app.notice(MWF.xApplication.process.Xform.LP.inputSplitValue, \"error\", dlg.node);\r return false;\r }\r MWF.require(\"MWF.widget.Mask\", function () {\r var splitValue = splitValues.split(o2.splitStr);\r this.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r this.mask.loadNode(this.app.content);\r \r this.fireEvent(\"beforeAddSplit\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeAddSplit\");\r \r this.addSplitWork(splitValue, trimExist, function (json) {\r this.fireEvent(\"afterAddSplit\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterAddSplit\");\r this.addAddSplitMessage(json.data);\r // this.workAction.loadWork(function(workJson){\r // this.fireEvent(\"afterAddSplit\");\r // if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterAddSplit\");\r // this.addAddSplitMessage(workJson.data);\r // }.bind(this), null, this.businessData.work.id);\r dlg.close();\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r this.app.notice(\"request json error: \" + errorText, \"error\", dlg.node);\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this));\r }.bind(this));\r },\r addSplitWork: function (splitValue, trimExist, success, failure) {\r var data = { \"splitValueList\": splitValue, \"trimExist\": trimExist };\r if (this.options.readonly) {\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2AddSplit(this.businessData.work.id, data, function (json) {\r if (success) success(json);\r }.bind(this),\r function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r });\r // this.workAction.addSplit(\r // function (json) {\r // if (success) success(json);\r // }.bind(this),\r // function (xhr, text, error) {\r // if (failure) failure(xhr, text, error);\r // },\r // this.businessData.work.id, data\r // );\r } else {\r this.saveFormData(\r function (json) {\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2AddSplit(this.businessData.work.id, data, function (json) {\r if (success) success(json);\r }.bind(this),\r function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r });\r // this.workAction.addSplit(\r // function (json) {\r // if (success) success(json);\r // }.bind(this),\r // function (xhr, text, error) {\r // if (failure) failure(xhr, text, error);\r // },\r // this.businessData.work.id, data\r // );\r }.bind(this),\r function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r }, true, null, true\r );\r }\r \r },\r setRollBackChecked: function (item) {\r item.store(\"isSelected\", true);\r item.setStyles(this.css.rollbackItemNode_current);\r \r item.getFirst().setStyles(this.css.rollbackItemIconNode_current);\r \r var node = item.getLast().getFirst();\r node.getFirst().setStyles(this.css.rollbackItemActivityNode_current);\r node.getLast().setStyles(this.css.rollbackItemTimeNode_current);\r \r node = item.getLast().getLast();\r node.getFirst().setStyles(this.css.rollbackItemTaskTitleNode_current);\r node.getLast().setStyles(this.css.rollbackItemTaskNode_current);\r \r var checkeds = item.getElements(\"input\");\r if (checkeds) checkeds.set(\"checked\", true);\r },\r setRollBackUnchecked: function (item) {\r item.store(\"isSelected\", false);\r item.setStyles(this.css.rollbackItemNode);\r \r item.getFirst().setStyles(this.css.rollbackItemIconNode);\r \r var node = item.getLast().getFirst();\r node.getFirst().setStyles(this.css.rollbackItemActivityNode);\r node.getLast().setStyles(this.css.rollbackItemTimeNode);\r \r node = item.getLast().getLast();\r node.getFirst().setStyles(this.css.rollbackItemTaskTitleNode);\r node.getLast().setStyles(this.css.rollbackItemTaskNode);\r \r var checkeds = item.getElements(\"input\");\r if (checkeds) checkeds.set(\"checked\", false);\r },\r getRollbackLogs: function (rollbackItemNode) {\r var _self = this;\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkLogAction.listRollbackWithWorkOrWorkCompleted(this.businessData.work.id, function (json) {\r \r json.data.each(function (log) {\r //if (!log.splitting &amp;&amp; log.connected &amp;&amp; (log.taskCompletedList.length || log.readList.length || log.readCompletedList.length)) {\r if (!log.splitting &amp;&amp; log.connected) {\r var node = new Element(\"div\", { \"styles\": this.css.rollbackItemNode }).inject(rollbackItemNode);\r node.store(\"log\", log);\r var iconNode = new Element(\"div\", { \"styles\": this.css.rollbackItemIconNode }).inject(node);\r var contentNode = new Element(\"div\", { \"styles\": this.css.rollbackItemContentNode }).inject(node);\r \r var div = new Element(\"div\", { \"styles\": { \"overflow\": \"hidden\" } }).inject(contentNode);\r var activityNode = new Element(\"div\", { \"styles\": this.css.rollbackItemActivityNode, \"text\": log.fromActivityName }).inject(div);\r var timeNode = new Element(\"div\", { \"styles\": this.css.rollbackItemTimeNode, \"text\": log.arrivedTime }).inject(div);\r div = new Element(\"div\", { \"styles\": { \"overflow\": \"hidden\" } }).inject(contentNode);\r var taskTitleNode = new Element(\"div\", { \"styles\": this.css.rollbackItemTaskTitleNode, \"text\": this.app.lp.taskCompletedPerson + \": \" }).inject(div);\r \r if (log.taskCompletedList.length) {\r log.taskCompletedList.each(function (o) {\r var text = o2.name.cn(o.person) + \"(\" + o.completedTime + \")\";\r var check = new Element(\"input\", {\r \"value\": o.identity,\r \"type\": \"checkbox\",\r \"styles\": this.css.rollbackItemTaskCheckNode\r }).inject(div);\r check.addEvent(\"click\", function (e) {\r e.stopPropagation();\r });\r var taskNode = new Element(\"div\", { \"styles\": this.css.rollbackItemTaskNode, \"text\": text }).inject(div);\r }.bind(this));\r } else {\r var text = this.app.lp.systemFlow;\r var taskNode = new Element(\"div\", { \"styles\": this.css.rollbackItemTaskNode, \"text\": text }).inject(div);\r }\r \r \r \r node.addEvents({\r \"mouseover\": function () {\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(_self.css.rollbackItemNode_over);\r },\r \"mouseout\": function () {\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(_self.css.rollbackItemNode)\r },\r \"click\": function () {\r var isSelected = this.retrieve(\"isSelected\");\r if (isSelected) {\r _self.setRollBackUnchecked(this);\r } else {\r var items = rollbackItemNode.getChildren();\r items.each(function (item) {\r _self.setRollBackUnchecked(item);\r });\r _self.setRollBackChecked(this);\r }\r }\r });\r }\r }.bind(this));\r \r }.bind(this), null, false);\r \r },\r rollback: function () {\r if (!this.businessData.control[\"allowRollback\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r var node = new Element(\"div\", { \"styles\": this.css.rollbackAreaNode });\r var html = \"&lt;div style=\\\"line-height: 30px; height: 30px; color: #333333; overflow: hidden;float:left;\\\">请选择文件要回溯到的位置：&lt;/div>\";\r html += \"&lt;div style=\\\"line-height: 30px; height: 30px; color: #333333; overflow: hidden;float:right;\\\">&lt;input class='rollback_flowOption' checked type='checkbox' />并尝试继续流转&lt;/div>\";\r html += \"&lt;div style=\\\"clear:both; max-height: 300px; margin-bottom:10px; margin-top:10px; overflow-y:auto;\\\">&lt;/div>\";\r node.set(\"html\", html);\r var rollbackItemNode = node.getLast();\r this.getRollbackLogs(rollbackItemNode);\r node.inject(this.app.content);\r \r var dlg = o2.DL.open({\r \"title\": this.app.lp.rollback,\r \"style\": this.json.dialogStyle || \"user\",\r \"isResize\": false,\r \"content\": node,\r \"width\": 600,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function (d, e) {\r this.doRollback(node, e, dlg);\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ]\r });\r },\r doRollback: function (node, e, dlg) {\r var rollbackItemNode = node.getLast();\r var items = rollbackItemNode.getChildren();\r var flowOption = (node.getElement(\".rollback_flowOption\").checked);\r var _self = this;\r for (var i = 0; i &lt; items.length; i++) {\r if (items[i].retrieve(\"isSelected\")) {\r var text = this.app.lp.rollbackConfirmContent;\r var log = items[i].retrieve(\"log\");\r var checks = items[i].getElements(\"input:checked\");\r var idList = [];\r checks.each(function (check) {\r var id = check.get(\"value\");\r if (idList.indexOf(id) == -1) idList.push(id);\r });\r \r text = text.replace(\"{log}\", log.fromActivityName + \"(\" + log.arrivedTime + \")\");\r this.app.confirm(\"infor\", e, this.app.lp.rollbackConfirmTitle, text, 450, 120, function () {\r _self.doRollbackAction(log.id, flowOption, dlg, idList);\r \r dlg.close();\r \r this.close();\r }, function () {\r this.close();\r }, null, null, this.json.confirmStyle);\r break;\r }\r }\r },\r \r doRollbackAction: function (log, flowOption, dlg, idList) {\r MWF.require(\"MWF.widget.Mask\", function () {\r this.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r this.mask.loadNode(this.app.content);\r \r this.fireEvent(\"beforeRollback\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeRollback\");\r \r this.doRollbackActionInvoke(log, flowOption, idList, function (json) {\r if (json.data.properties) {\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterRollback\");\r this.addRollbackMessage(json.data);\r \r } else {\r var id = json.data.id;\r this.workAction.listTaskByWork(function (workJson) {\r this.fireEvent(\"afterRollback\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterRollback\");\r this.addRollbackMessage_old(workJson.data);\r //this.app.notice(MWF.xApplication.process.Xform.LP.rollbackOk+\": \"+MWF.name.cns(names).join(\", \"), \"success\");\r //if (!this.app.inBrowser) this.app.close();\r }.bind(this), null, id);\r }\r if (!this.app.inBrowser) this.app.close();\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r this.app.notice(\"request json error: \" + errorText, \"error\");\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this));\r }.bind(this));\r },\r doRollbackActionInvoke: function (id, flowOption, idList, success, failure) {\r if (this.businessData.work.completedTime) {\r var method = \"rollbackWorkcompleted\";\r o2.Actions.get(\"x_processplatform_assemble_surface\")[method](this.businessData.work.id, { \"workLog\": id }, function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error)\r }.bind(this));\r } else {\r var body = {\r \"workLog\": id,\r \"taskCompletedIdentityList\": idList,\r \"processing\": !!flowOption\r }\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2Rollback(this.businessData.work.id, body, function (json) {\r //o2.Actions.get(\"x_processplatform_assemble_surface\")[method](this.businessData.work.id, { \"workLog\": id }, function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error)\r }.bind(this));\r }\r \r },\r \r inBrowserDkg: function (content) {\r if (this.mask) this.mask.hide();\r \r if (this.json.submitedDlgUseNotice) {\r MWF.xDesktop.notice(\"success\", { x: \"right\", y: \"top\" }, content);\r if (this.json.isPrompt !== false) {\r if (this.json.promptCloseTime != 0) {\r var t = this.json.promptCloseTime || 2;\r t = t.toInt() * 1000;\r var _work = this;\r window.setTimeout(function () { _work.app.close(); }, t);\r }\r } else {\r this.app.close();\r }\r } else {\r var div = new Element(\"div\", { \"styles\": { \"margin\": \"10px 10px 0px 10px\", \"padding\": \"5px\", \"overflow\": \"hidden\" } }).inject(this.app.content);\r div.set(\"html\", content);\r \r if (this.json.isPrompt !== false) {\r var options = {\r \"content\": div,\r \"isTitle\": false,\r \"width\": 350,\r \"height\": 180,\r \"buttonList\": [\r {\r \"text\": MWF.xApplication.process.Xform.LP.ok,\r \"action\": function () { dlg.close(); this.app.close(); }.bind(this)\r }\r ]\r }\r var size = this.app.content.getSize();\r switch (this.json.promptPosition || \"righttop\") {\r case \"lefttop\":\r options.top = 10;\r options.left = 10;\r options.fromTop = 10;\r options.fromLeft = 10;\r break;\r case \"righttop\":\r options.top = 10;\r options.left = size.x - 360;\r options.fromTop = 10;\r options.fromLeft = size.x - 10;\r break;\r case \"leftbottom\":\r options.top = size.y - 190;\r options.left = 10;\r options.fromTop = size.y - 10;\r options.fromLeft = 10;\r break;\r case \"rightbottom\":\r options.top = size.y - 190;\r options.left = size.x - 360;\r options.fromTop = size.y - 10;\r options.fromLeft = size.x - 10;\r break;\r default:\r delete options.top;\r delete options.left;\r delete options.fromTop;\r delete options.fromLeft;\r }\r var dlg = o2.DL.open(options);\r if (this.json.promptCloseTime != 0) {\r var t = this.json.promptCloseTime || 2;\r t = t.toInt() * 1000;\r var _work = this;\r window.setTimeout(function () { dlg.close(); _work.app.close(); }, t);\r }\r } else {\r this.app.close();\r }\r }\r },\r addRollbackMessage_old: function (data) {\r var users = [];\r data.each(function (task) {\r users.push(MWF.name.cn(task.person) + \"(\" + MWF.name.cn(task.unit) + \")\");\r }.bind(this));\r var content = \"&lt;div>&lt;b>\" + MWF.xApplication.process.Xform.LP.currentActivity + \"&lt;font style=\\\"color: #ea621f\\\">\" + data[0].activityName + \"&lt;/font>, \" + MWF.xApplication.process.Xform.LP.nextUser + \"&lt;font style=\\\"color: #ea621f\\\">\" + users.join(\", \") + \"&lt;/font>&lt;/b>&lt;/div>\";\r \r \r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.workRollback,\r \"content\": \"&lt;div>\" + MWF.xApplication.process.Xform.LP.rollbackWorkInfor + \"“\" + this.businessData.work.title + \"”&lt;/div>\" + content\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(\"&lt;div>\" + MWF.xApplication.process.Xform.LP.rollbackWorkInfor + \"“\" + this.businessData.work.title + \"”&lt;/div>\" + content);\r }\r }\r },\r \r addRollbackMessage: function (data) {\r \r \r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.workRollback,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.rollbackWorkInfor)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.rollbackWorkInfor));\r }\r }\r },\r \r /**\r * 需要判断权限\r * @summary 给待办人发送提醒(催促办理).\r * @example\r * if( this.workContext.getControl().allowPress ){ //判断流程节点是否设置了催办并且当前人员是否有催办权限\r * this.form.getApp().appForm.pressWork();\r * }\r */\r pressWork: function (e) {\r if (e &amp;&amp; e.setDisable) e.setDisable(true);\r o2.Actions.get(\"x_processplatform_assemble_surface\").press(this.businessData.work.id, function (json) {\r var users = o2.name.cns(json.data.valueList).join(\", \");\r this.app.notice(\"已经向待办人：\" + users + \", 发送了提醒\", \"success\");\r if (e &amp;&amp; e.setDisable) e.setDisable(false);\r }.bind(this), function (xhr, text, error) {\r //e.setDisable(false);\r if (xhr.status != 0) {\r var errorText = error;\r if (xhr) {\r var json = JSON.decode(xhr.responseText);\r if (json) {\r errorText = json.message.trim() || \"request json error\";\r } else {\r errorText = \"request json error: \" + xhr.responseText;\r }\r }\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, errorText);\r }\r });\r },\r \r /**\r * @summary 将待办设置为挂起状态，不计算工作时长.\r * @example\r * this.form.getApp().appForm.pauseTask();\r */\r pauseTask: function (e) {\r if (!this.businessData.control[\"allowPause\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r \r if (this.businessData.task){\r if (e &amp;&amp; e.disable) e.disable(true);\r return o2.Actions.get(\"x_processplatform_assemble_surface\").pauseTask(this.businessData.task.id, function (json) {\r this.app.notice(MWF.xApplication.process.Xform.LP.pauseWork, \"success\");\r this.businessData.control[\"allowResume\"] = true;\r if (e &amp;&amp; e.enable) e.enable(false);\r }.bind(this), function (xhr, text, error) {\r //e.setDisable(false);\r if (xhr.status != 0) {\r var errorText = error;\r if (xhr) {\r var json = JSON.decode(xhr.responseText);\r if (json) {\r errorText = json.message.trim() || \"request json error\";\r } else {\r errorText = \"request json error: \" + xhr.responseText;\r }\r }\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, errorText);\r }\r });\r }\r },\r \r /**\r * @summary 将待办从挂起状态恢复为正常状态.\r * @example\r * this.form.getApp().appForm.resumeTask();\r */\r resumeTask: function (e) {\r if (!this.businessData.control[\"allowResume\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r if (this.businessData.task){\r if (e &amp;&amp; e.disable) e.disable(true);\r return o2.Actions.get(\"x_processplatform_assemble_surface\").resumeTask(this.businessData.task.id, function (json) {\r this.app.notice(MWF.xApplication.process.Xform.LP.resumeWork, \"success\");\r this.businessData.control[\"allowPause\"] = true;\r if (e &amp;&amp; e.enable) e.enable(false);\r }.bind(this), function (xhr, text, error) {\r //e.setDisable(false);\r if (xhr.status != 0) {\r var errorText = error;\r if (xhr) {\r var json = JSON.decode(xhr.responseText);\r if (json) {\r errorText = json.message.trim() || \"request json error\";\r } else {\r errorText = \"request json error: \" + xhr.responseText;\r }\r }\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, errorText);\r }\r });\r }\r },\r \r downloadAll: function () {\r var htmlFormId = \"\";\r o2.Actions.load(\"x_processplatform_assemble_surface\").AttachmentAction.uploadWorkInfo(this.businessData.work.id, \"pdf\", {\r \"workHtml\": this.app.content.get(\"html\"),\r \"pageWidth\": 1000\r }, function (json) {\r htmlFormId = json.data.id;\r }.bind(this), null, false);\r htmlFormId = htmlFormId.replace(\"#\", \"%23\");\r var url = \"/x_processplatform_assemble_surface/jaxrs/attachment/batch/download/work/\" + this.businessData.work.id + \"/site/(0)/stream\";\r url = o2.filterUrl(o2.Actions.getHost(\"x_processplatform_assemble_surface\") + url);\r window.open(o2.filterUrl(url + \"?fileName=&amp;flag=\" + htmlFormId));\r },\r resetWork: function () {\r if (!this.businessData.control[\"allowReset\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var width = 680;\r var height = 300;\r var p = MWF.getCenterPosition(this.app.content, width, height);\r \r var _self = this;\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.app.lp.reset,\r \"style\": this.json.dialogStyle || \"user\", //|| \"work\",\r \"top\": p.y - 100,\r \"left\": p.x,\r \"fromTop\": p.y - 100,\r \"fromLeft\": p.x,\r \"width\": width,\r \"height\": height,\r \"url\": this.app.path + \"reset.html\",\r \"container\": this.app.content,\r \"isClose\": true,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function (d, e) {\r this.doResetWork(dlg);\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ],\r \"onPostShow\": function () {\r //$(\"resetWork_okButton\").addEvent(\"click\", function(){\r // _self.doResetWork(this);\r //}.bind(this));\r //$(\"resetWork_cancelButton\").addEvent(\"click\", function(){\r // this.close();\r //}.bind(this));\r \r $(\"resetWork_selPeopleButton\").addEvent(\"click\", function () {\r _self.selectPeople(this);\r }.bind(this));\r }\r });\r dlg.show();\r }.bind(this));\r },\r selectPeople: function (dlg) {\r var range = this.businessData.activity.resetRange || \"department\";\r var count = this.businessData.activity.resetCount || 0;\r switch (range) {\r case \"unit\":\r this.selectPeopleUnit(dlg, this.businessData.task.unit, count);\r // this.personActions.getDepartmentByIdentity(function(json){\r // this.selectPeopleDepartment(dlg, json.data, count);\r // }.bind(this), null, this.businessData.task.identity);\r break;\r case \"topUnit\":\r MWF.require(\"MWF.xScript.Actions.UnitActions\", function () {\r orgActions = new MWF.xScript.Actions.UnitActions();\r var data = { \"unitList\": [this.businessData.task.unit] };\r orgActions.listUnitSupNested(data, function (json) {\r v = json.data[0];\r this.selectPeopleUnit(dlg, v, count);\r }.bind(this));\r }.bind(this));\r // this.personActions.getCompanyByIdentity(function(json){\r // this.selectPeopleCompany(dlg, json.data, count)\r // }.bind(this), null, this.businessData.task.identity);\r break;\r case \"script\":\r o2.Actions.load(\"x_processplatform_assemble_surface\").ProcessAction.getActivity(this.businessData.work.activity, \"manual\", function (activityJson) {\r var scriptText = activityJson.data.activity.resetRangeScriptText;\r if (!scriptText) return;\r var resetRange = this.Macro.exec(activityJson.data.activity.resetRangeScriptText, this);\r this.selectPeopleUnit(dlg, \"\", count, resetRange);\r }.bind(this))\r break;\r default:\r this.selectPeopleAll(dlg, count);\r }\r },\r selectPeopleUnit: function (dlg, unit, count, include) {\r var names = dlg.identityList || [];\r var areaNode = $(\"resetWork_selPeopleArea\");\r var options = {\r \"values\": names,\r \"type\": \"identity\",\r \"count\": count,\r \"units\": (unit) ? [unit] : [],\r \"title\": this.app.lp.reset,\r \"onComplete\": function (items) {\r areaNode.empty();\r var identityList = [];\r items.each(function (item) {\r new MWF.widget.O2Identity(item.data, areaNode, { \"style\": \"reset\" });\r identityList.push(item.data.distinguishedName);\r }.bind(this));\r dlg.identityList = identityList;\r }.bind(this)\r };\r if (include) {\r options.noUnit = true;\r options.include = typeOf(include) === \"array\" ? include : [include];\r }\r MWF.xDesktop.requireApp(\"Selector\", \"package\", function () {\r var selector = new MWF.O2Selector(this.app.content, options);\r }.bind(this));\r \r },\r selectPeopleAll: function (dlg, count) {\r var names = dlg.identityList || [];\r var areaNode = $(\"resetWork_selPeopleArea\");\r var options = {\r \"values\": names,\r \"type\": \"identity\",\r \"count\": count,\r \"title\": this.app.lp.reset,\r \"onComplete\": function (items) {\r areaNode.empty();\r var identityList = [];\r items.each(function (item) {\r new MWF.widget.O2Identity(item.data, areaNode, { \"style\": \"reset\" });\r identityList.push(item.data.distinguishedName);\r }.bind(this));\r dlg.identityList = identityList;\r }.bind(this)\r };\r MWF.xDesktop.requireApp(\"Selector\", \"package\", function () {\r var selector = new MWF.O2Selector(this.app.content, options);\r }.bind(this));\r \r },\r \r \r doResetWork: function (dlg) {\r var names = dlg.identityList || [];\r if (!names.length) {\r this.app.notice(MWF.xApplication.process.Xform.LP.inputResetPeople, \"error\", dlg.node);\r return false;\r }\r var opinion = $(\"resetWork_opinion\").get(\"value\");\r var checkbox = dlg.content.getElement(\".resetWork_keepOption\");\r var keep = (checkbox.checked);\r \r var nameText = [];\r names.each(function (n) { nameText.push(MWF.name.cn(n)); });\r if (!opinion) {\r opinion = MWF.xApplication.process.Xform.LP.resetTo + \": \" + nameText.join(\", \");\r }\r \r MWF.require(\"MWF.widget.Mask\", function () {\r this.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r this.mask.loadNode(this.app.content);\r \r this.fireEvent(\"beforeReset\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeReset\");\r \r this.resetWorkToPeson(names, opinion, keep, function (workJson) {\r //this.workAction.loadWork(function (workJson) {\r this.fireEvent(\"afterReset\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterReset\");\r this.addResetMessage(workJson.data);\r //this.app.notice(MWF.xApplication.process.Xform.LP.resetOk + \": \" + MWF.name.cns(names).join(\", \"), \"success\");\r if (!this.app.inBrowser) this.app.close();\r //}.bind(this), null, this.businessData.work.id);\r dlg.close();\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r this.app.notice(\"request json error: \" + errorText, \"error\", dlg.node);\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this));\r }.bind(this));\r \r //var data = {\r // \"opinion\": opinion,\r // \"routeName\": MWF.xApplication.process.Xform.LP.reset,\r // \"identityList\": names\r //}\r //\r //this.workAction.resetWork(function(json){\r //\r //}.bind(this), null, this.businessData.task.id, data);\r },\r resetWorkToPeson: function (identityList, opinion, keep, success, failure) {\r var data = {\r \"opinion\": opinion,\r \"routeName\": MWF.xApplication.process.Xform.LP.reset,\r \"identityList\": identityList,\r \"keep\": !!keep\r };\r this.saveFormData(\r function (json) {\r o2.Actions.load(\"x_processplatform_assemble_surface\").TaskAction.V2Reset(\r //this.workAction.resetWork(\r function (json) {\r if (success) success(json);\r }.bind(this),\r function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r },\r this.businessData.task.id, data\r );\r }.bind(this),\r function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r }, true, null, true\r );\r \r \r },\r addAddSplitMessage: function (data) {\r // var content = \"\";\r // if (data &amp;&amp; data.length) {\r // data.each(function (work) {\r // var users = [];\r // work.taskList.each(function (task) {\r // users.push(MWF.name.cn(task.person) + \"(\" + MWF.name.cn(task.unit) + \")\");\r // }.bind(this));\r // content += \"&lt;div>&lt;b>\" + MWF.xApplication.process.Xform.LP.nextActivity + \"&lt;font style=\\\"color: #ea621f\\\">\" + work.activityName + \"&lt;/font>, \" + MWF.xApplication.process.Xform.LP.nextUser + \"&lt;font style=\\\"color: #ea621f\\\">\" + users.join(\", \") + \"&lt;/font>&lt;/b>&lt;/div>\";\r // }.bind(this));\r // } else {\r // content += MWF.xApplication.process.Xform.LP.workCompleted;\r // }\r \r if (layout.desktop.message) {\r //var content = \"&lt;div>&lt;b>\"+MWF.xApplication.process.Xform.LP.currentActivity+\"&lt;font style=\\\"color: #ea621f\\\">\"+data.work.activityName+\"&lt;/font>, \"+MWF.xApplication.process.Xform.LP.nextUser+\"&lt;font style=\\\"color: #ea621f\\\">\"+users.join(\", \")+\"&lt;/font>&lt;/b>&lt;/div>\";\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.addSplitWork,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.addSplitWorkInfor)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.addSplitWorkInfor));\r }\r }\r },\r addResetMessage: function (data) {\r // var content = \"\";\r // if (data.completed){\r // content += MWF.xApplication.process.Xform.LP.workCompleted;\r // }else{\r // if (data.properties.nextManualList &amp;&amp; data.properties.nextManualList.length){\r // var activityUsers = [];\r // data.properties.nextManualList.each(function(a){\r // var ids = [];\r // a.taskIdentityList.each(function(i){\r // ids.push(o2.name.cn(i))\r // });\r // var t = \"&lt;b>\"+MWF.xApplication.process.Xform.LP.nextActivity + \"&lt;/b>&lt;span style='color: #ea621f'>\"+a.activityName+\"&lt;/span>；&lt;b>\"+ MWF.xApplication.process.Xform.LP.nextUser+ \"&lt;/b>&lt;span style='color: #ea621f'>\"+ids.join(\",\")+\"&lt;/span>\";\r // activityUsers.push(t);\r // });\r // content += activityUsers.join(\"&lt;br>\");\r // }else{\r // content += MWF.xApplication.process.Xform.LP.taskCompleted;\r // }\r // }\r \r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.workReset,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.resetWorkInfor)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.resetWorkInfor));\r }\r }\r },\r \r retractWork: function (e, ev) {\r var _self = this;\r if (this.json.mode == \"Mobile\") {\r //window.confirm 在ios移动端不可用 ??\r // if (window.confirm(MWF.xApplication.process.Xform.LP.retractText)) {\r \r var p = MWF.getCenterPosition(document.body, 300, 150);\r console.log(\"position x:\" + p.x + \" , y:\" + p.y);\r var x = p.x;\r if (p.x &lt; 20) {\r x = 20;\r } else {\r x = p.x;\r }\r var event = {\r \"event\": {\r \"x\": x,\r \"y\": p.y - 200,\r \"clientX\": x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.retractTitle, MWF.xApplication.process.Xform.LP.retractText, 300, 120, function () {\r _self.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r \r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.fireEvent(\"beforeRetract\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"beforeRetract\");\r \r _self.doRetractWork(function () {\r //_self.workAction.getJobByWork(function(workJson){\r _self.fireEvent(\"afterRetract\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"afterRetract\");\r _self.app.notice(MWF.xApplication.process.Xform.LP.workRetract, \"success\");\r _self.app.content.unmask();\r if (_self.mask) { _self.mask.hide(); _self.mask = null; }\r \r _self.finishOnMobile()\r }.bind(this), function (xhr, text, error) {\r _self.app.content.unmask();\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\");\r if (_self.mask) { _self.mask.hide(); _self.mask = null; }\r });\r }.bind(this));\r }, function () {\r this.close();\r }, null, null, this.json.confirmStyle);\r \r \r \r \r \r } else {\r var p = MWF.getCenterPosition(this.app.content, 300, 150);\r var event = {\r \"event\": {\r \"x\": p.x,\r \"y\": p.y - 200,\r \"clientX\": p.x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.retractTitle, MWF.xApplication.process.Xform.LP.retractText, 300, 120, function () {\r _self.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r \r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.fireEvent(\"beforeRetract\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"beforeRetract\");\r \r _self.doRetractWork(function (json) {\r //_self.workAction.getJobByWork(function(workJson){\r _self.fireEvent(\"afterRetract\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"afterRetract\");\r //_self.addRetractMessage(json.data);\r _self.app.notice(MWF.xApplication.process.Xform.LP.workRetract, \"success\");\r _self.app.content.unmask();\r _self.app.reload();\r //}, null, _self.businessData.work.id);\r this.close();\r if (_self.mask) { _self.mask.hide(); _self.mask = null; }\r }.bind(this), function (xhr, text, error) {\r _self.app.content.unmask();\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\");\r if (_self.mask) { _self.mask.hide(); _self.mask = null; }\r });\r }.bind(this));\r \r //this.close();\r }, function () {\r this.close();\r }, null, null, this.json.confirmStyle);\r }\r },\r doRetractWork: function (success, failure) {\r if (this.businessData.control[\"allowRetract\"]) {\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2Retract(this.businessData.work.id, null, function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r });\r // this.workAction.retractWork(function (json) {\r // if (success) success();\r // }.bind(this), function (xhr, text, error) {\r // if (failure) failure(xhr, text, error);\r // }, this.businessData.work.id);\r } else {\r if (failure) failure(null, \"Permission Denied\", \"\");\r }\r },\r addRetractMessage: function (data) {\r // var users = [];\r // data.taskList.each(function (task) {\r // users.push(MWF.name.cn(task.person) + \"(\" + MWF.name.cn(task.unit) + \")\");\r // }.bind(this));\r // var content = \"&lt;div>&lt;b>\" + MWF.xApplication.process.Xform.LP.currentActivity + \"&lt;font style=\\\"color: #ea621f\\\">\" + data.work.activityName + \"&lt;/font>, \" + MWF.xApplication.process.Xform.LP.nextUser + \"&lt;font style=\\\"color: #ea621f\\\">\" + users.join(\", \") + \"&lt;/font>&lt;/b>&lt;/div>\";\r \r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.workRetract,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.retractWorkInfor)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.retractWorkInfor));\r }\r }\r },\r /**\r * 如果当前人员没有调度权限或者流程节点未配置调度，则提醒Permission Denied.\r * @summary 弹出调度界面\r * @example\r * this.form.getApp().appForm.rerouteWork();\r */\r rerouteWork: function (e, ev) {\r if (!this.businessData.control[\"allowReroute\"]) {\r MWF.xDesktop.notice(\"error\", { x: \"right\", y: \"top\" }, \"Permission Denied\");\r return false;\r }\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var width = 560;\r var height = 260;\r var p = MWF.getCenterPosition(this.app.content, width, height);\r \r var _self = this;\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.app.lp.reroute,\r \"style\": this.json.dialogStyle || \"user\", //|| \"work\",\r \"top\": p.y - 100,\r \"left\": p.x,\r \"fromTop\": p.y - 100,\r \"fromLeft\": p.x,\r \"width\": width,\r \"height\": height,\r \"url\": this.app.path + \"reroute.html\",\r \"container\": this.app.content,\r \"isClose\": true,\r \"buttonList\": [\r {\r \"type\": \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function (d, e) {\r _self.doRerouteWork(dlg);\r }.bind(this)\r },\r {\r \"type\": \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { dlg.close(); }\r }\r ],\r \"onPostShow\": function () {\r //$(\"rerouteWork_okButton\").addEvent(\"click\", function(){\r // _self.doRerouteWork(this);\r //}.bind(this));\r //$(\"rerouteWork_cancelButton\").addEvent(\"click\", function(){\r // this.close();\r //}.bind(this));\r \r var select = $(\"rerouteWork_selectActivity\");\r _self.workAction.getRerouteTo(_self.businessData.work.process, function (json) {\r json.data.agentList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#agent\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.cancelList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#cancel\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.choiceList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#choice\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r // json.data.controllerList.each(function(activity){\r // new Element(\"option\", {\r // \"value\": activity.id+\"#condition\",\r // \"text\": activity.name\r // }).inject(select);\r // }.bind(_self));\r \r json.data.delayList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#delay\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.embedList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#embed\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.endList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#end\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.invokeList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#invoke\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.manualList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#manual\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.mergeList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#merge\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.messageList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#message\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.parallelList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#parallel\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.serviceList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#service\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r \r json.data.splitList.each(function (activity) {\r new Element(\"option\", {\r \"value\": activity.id + \"#split\",\r \"text\": activity.name\r }).inject(select);\r }.bind(_self));\r }.bind(_self));\r \r var selPeopleButton = this.content.getElement(\".rerouteWork_selPeopleButton\");\r selPeopleButton.addEvent(\"click\", function () {\r _self.selectReroutePeople(this);\r }.bind(this));\r }\r });\r dlg.show();\r }.bind(this));\r },\r selectReroutePeople: function (dlg) {\r var names = dlg.identityList || [];\r var areaNode = dlg.content.getElement(\".rerouteWork_selPeopleArea\");\r var options = {\r \"values\": names,\r \"type\": \"identity\",\r \"count\": 0,\r \"title\": this.app.lp.reroute,\r \"onComplete\": function (items) {\r areaNode.empty();\r var identityList = [];\r items.each(function (item) {\r new MWF.widget.O2Identity(item.data, areaNode, { \"style\": \"reset\" });\r identityList.push(item.data.distinguishedName);\r }.bind(this));\r dlg.identityList = identityList;\r }.bind(this)\r };\r MWF.xDesktop.requireApp(\"Selector\", \"package\", function () {\r var selector = new MWF.O2Selector(this.app.content, options);\r }.bind(this));\r },\r doRerouteWork: function (dlg) {\r var opinion = $(\"rerouteWork_opinion\").get(\"value\");\r var select = $(\"rerouteWork_selectActivity\");\r var activity = select.options[select.selectedIndex].get(\"value\");\r var activityName = select.options[select.selectedIndex].get(\"text\");\r var tmp = activity.split(\"#\");\r activity = tmp[0];\r var type = tmp[1];\r \r var nameArr = [];\r var names = dlg.identityList || [];\r names.each(function (n) { nameArr.push(n); });\r //var nameText = nameArr.join(\", \");\r // if (!opinion) {\r // opinion = MWF.xApplication.process.Xform.LP.resetTo + \": \" + nameText.join(\", \");\r // }\r \r MWF.require(\"MWF.widget.Mask\", function () {\r this.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r this.mask.loadNode(this.app.content);\r \r this.fireEvent(\"beforeReroute\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterRetract\");\r \r this.rerouteWorkToActivity(activity, type, opinion, nameArr, function (workJson) {\r //this.workAction.loadWork(function (workJson) {\r this.fireEvent(\"afterReroute\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterReroute\");\r this.addRerouteMessage(workJson.data);\r this.app.notice(MWF.xApplication.process.Xform.LP.rerouteOk + \": \" + activityName, \"success\");\r if (!this.app.inBrowser) this.app.close();\r //}.bind(this), null, this.businessData.work.id);\r dlg.close();\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r this.app.notice(\"request json error: \" + errorText, \"error\", dlg.node);\r if (this.mask) { this.mask.hide(); this.mask = null; }\r }.bind(this));\r }.bind(this));\r },\r rerouteWorkToActivity: function (activity, type, opinion, nameArr, success, failure) {\r var body = {\r \"activity\": activity,\r \"activityType\": type,\r \"mergeWork\": false,\r \"manualForceTaskIdentityList\": nameArr\r };\r if (this.businessData.task) {\r this.saveFormData(function (json) {\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2Reroute(this.businessData.work.id, body, function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r });\r // this.workAction.rerouteWork(function (json) {\r // if (success) success();\r // }.bind(this), function (xhr, text, error) {\r // if (failure) failure(xhr, text, error);\r // }, this.businessData.work.id, activity, type);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r }, true, null, true);\r } else {\r o2.Actions.load(\"x_processplatform_assemble_surface\").WorkAction.V2Reroute(this.businessData.work.id, body, function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r });\r \r // this.workAction.rerouteWork(function (json) {\r // if (success) success();\r // }.bind(this), function (xhr, text, error) {\r // if (failure) failure(xhr, text, error);\r // }, this.businessData.work.id, activity, type);\r }\r },\r addRerouteMessage: function (data) {\r \r if (layout.desktop.message) {\r var msg = {\r \"subject\": MWF.xApplication.process.Xform.LP.workReroute,\r \"content\": this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.rerouteWorkInfor)\r };\r layout.desktop.message.addTooltip(msg);\r return layout.desktop.message.addMessage(msg);\r } else {\r if (this.app.inBrowser) {\r this.inBrowserDkg(this.getMessageContent(data, 0, MWF.xApplication.process.Xform.LP.rerouteWorkInfor));\r }\r }\r },\r \r deleteDraftWork: function () {\r var _self = this;\r if (this.json.mode === \"Mobile\") {\r var p = MWF.getCenterPosition(document.body, 300, 150);\r console.log(\"position x:\" + p.x + \" , y:\" + p.y);\r var x = p.x;\r if (p.x &lt; 20) {\r x = 20;\r } else {\r x = p.x;\r }\r var event = {\r \"event\": {\r \"x\": x,\r \"y\": p.y - 200,\r \"clientX\": x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.deleteWorkTitle, MWF.xApplication.process.Xform.LP.deleteWorkText.text, 300, 120, function () {\r _self.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r // if (window.confirm(MWF.xApplication.process.Xform.LP.deleteWorkText.text)) {\r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.doDeleteWork(function () {\r _self.app.notice(MWF.xApplication.process.Xform.LP.workDelete + \": “\" + _self.businessData.work.title + \"”\", \"success\");\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r _self.finishOnMobile()\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\");\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this));\r }.bind(this));\r }, function () {\r this.close();\r }, null, null, this.json.confirmStyle);\r } else {\r var p = MWF.getCenterPosition(this.app.content, 380, 150);\r var event = {\r \"event\": {\r \"x\": p.x,\r \"y\": p.y - 200,\r \"clientX\": p.x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.deleteWorkTitle, MWF.xApplication.process.Xform.LP.deleteWorkText, 380, 120, function () {\r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.doDeleteWork(function () {\r _self.app.notice(MWF.xApplication.process.Xform.LP.workDelete + \": “\" + _self.businessData.work.title + \"”\", \"success\");\r _self.app.close();\r this.close();\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\");\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this));\r }.bind(this));\r }, function () {\r this.close();\r }, null, this.app.content, this.json.confirmStyle);\r }\r },\r deleteWork: function () {\r if (!this.businessData.work.startTime) {\r this.deleteDraftWork();\r } else {\r var _self = this;\r if (this.json.mode === \"Mobile\") {\r var p = MWF.getCenterPosition(document.body, 300, 150);\r console.log(\"position x:\" + p.x + \" , y:\" + p.y);\r var x = p.x;\r if (p.x &lt; 20) {\r x = 20;\r } else {\r x = p.x;\r }\r var event = {\r \"event\": {\r \"x\": x,\r \"y\": p.y - 200,\r \"clientX\": x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.deleteWorkTitle, MWF.xApplication.process.Xform.LP.deleteWorkText.text, 300, 120, function () {\r _self.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r // if (window.confirm(MWF.xApplication.process.Xform.LP.deleteWorkText.text)) {\r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.fireEvent(\"beforeDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"beforeDelete\");\r \r _self.doDeleteWork(function () {\r _self.fireEvent(\"afterDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"afterDelete\");\r _self.app.notice(MWF.xApplication.process.Xform.LP.workDelete + \": “\" + _self.businessData.work.title + \"”\", \"success\");\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r _self.finishOnMobile()\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\", dlg.node);\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this));\r }.bind(this));\r }, function () {\r this.close();\r }, null, this.app.content, this.json.confirmStyle);\r } else {\r var p = MWF.getCenterPosition(this.app.content, 380, 150);\r var event = {\r \"event\": {\r \"x\": p.x,\r \"y\": p.y - 200,\r \"clientX\": p.x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.process.Xform.LP.deleteWorkTitle, MWF.xApplication.process.Xform.LP.deleteWorkText, 380, 120, function () {\r // _self.app.content.mask({\r // \"style\": {\r // \"background-color\": \"#999\",\r // \"opacity\": 0.6\r // }\r // });\r \r \r MWF.require(\"MWF.widget.Mask\", function () {\r _self.mask = new MWF.widget.Mask({ \"style\": \"desktop\", \"zIndex\": 50000 });\r _self.mask.loadNode(_self.app.content);\r \r _self.fireEvent(\"beforeDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"beforeDelete\");\r \r _self.doDeleteWork(function () {\r _self.fireEvent(\"afterDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"afterDelete\");\r _self.app.notice(MWF.xApplication.process.Xform.LP.workDelete + \": “\" + _self.businessData.work.title + \"”\", \"success\");\r _self.app.close();\r this.close();\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this), function (xhr, text, error) {\r var errorText = error + \":\" + text;\r if (xhr) errorText = xhr.responseText;\r _self.app.notice(\"request json error: \" + errorText, \"error\", dlg.node);\r if (_self.mask) {\r _self.mask.hide();\r _self.mask = null;\r }\r }.bind(this));\r }.bind(this));\r \r \r //_self.workAction.deleteWork(function(json){\r // _self.app.notice(MWF.xApplication.process.Xform.LP.workDelete+\": “\"+_self.businessData.work.title+\"”\", \"success\");\r // _self.app.close();\r // this.close();\r //}.bind(this), null, _self.businessData.work.id);\r //this.close();\r }, function () {\r this.close();\r }, null, this.app.content, this.json.confirmStyle);\r }\r }\r },\r doDeleteDraftWork: function (success, failure) {\r this.workAction.deleteDraftWork(function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r }, this.businessData.work.id);\r },\r doDeleteWork: function (success, failure) {\r if (!this.businessData.work.startTime) {\r this.doDeleteDraftWork(success, failure);\r } else {\r if (this.businessData.control[\"allowDelete\"]) {\r //this.workAction.deleteWork(function (json) {\r this.workAction.abandoned(function (json) {\r if (success) success(json);\r }.bind(this), function (xhr, text, error) {\r if (failure) failure(xhr, text, error);\r }, this.businessData.work.id);\r //}\r }else {\r if (failure) failure(null, \"Permission Denied\", \"\");\r }\r }\r },\r \r //printWork: function(){\r // var form = this.json.id;\r // if (this.json.printForm){\r // form = this.json.printForm;\r // }\r // window.open(\"../x_desktop/printWork.html?workid=\"+this.businessData.work.id+\"&amp;app=\"+this.businessData.work.application+\"&amp;form=\"+form);\r //},\r printWork: function (app, form) {\r var application = app || (this.businessData.work) ? this.businessData.work.application : this.businessData.workCompleted.application;\r var form = form;\r if (!form) {\r form = this.json.id;\r if (this.json.printForm) form = this.json.printForm;\r }\r if (this.businessData.workCompleted) {\r var application = app || this.businessData.workCompleted.application;\r window.open(o2.filterUrl(\"../x_desktop/printWork.html?workCompletedId=\" + this.businessData.workCompleted.id + \"&amp;app=\" + application + \"&amp;form=\" + form));\r } else {\r var application = app || this.businessData.work.application;\r window.open(o2.filterUrl(\"../x_desktop/printWork.html?workid=\" + this.businessData.work.id + \"&amp;app=\" + application + \"&amp;form=\" + form));\r }\r },\r /**\r * @summary 将当前处理人的待阅设置为已阅.\r * @param {Event|Element} [e] - Event 或者Mootools Element，指定提示框弹出的位置\r * @example\r * if( this.workContext.getControl().allowReadProcessing ){ //是否有待阅\r * this.form.getApp().appForm.readedWork();\r * }\r */\r readedWork: function (e) {\r if( !e )e = new Event(event);\r this.fireEvent(\"beforeReaded\");\r var _self = this;\r var title = this.businessData.work.title;\r if (title.length > 75) {\r title = title.substr(0, 74) + \"...\"\r }\r var text = \"您确定要将“\" + title + \"”标记为已阅吗？\";\r \r this.app.confirm(\"infor\", e, \"标记已阅确认\", text, 300, 120, function () {\r var confirmDlg = this;\r var read = null;\r for (var i = 0; i &lt; _self.businessData.readList.length; i++) {\r if (_self.businessData.readList[i].person === layout.session.user.distinguishedName) {\r read = _self.businessData.readList[i];\r break;\r }\r }\r \r if (read) {\r _self.app.action.setReaded(function () {\r _self.fireEvent(\"afterReaded\");\r _self.app.reload();\r if (layout.mobile) {\r \r //移动端页面关闭\r _self.finishOnMobile()\r } else {\r confirmDlg.close();\r }\r }, null, read.id, read);\r } else {\r _self.app.reload();\r if (layout.mobile) {\r \r //移动端页面关闭\r _self.finishOnMobile()\r } else {\r confirmDlg.close();\r }\r }\r \r }, function () {\r this.close();\r }, null, this.app.content, this.json.confirmStyle);\r },\r openWindow: function (form, app) {\r //var application = app || (this.businessData.work) ? this.businessData.work.application : this.businessData.workCompleted.application;\r var form = form;\r if (!form) {\r form = this.json.id;\r //if (this.json.printForm) form = this.json.printForm;\r }\r if (this.businessData.workCompleted) {\r var application = app || this.businessData.workCompleted.application;\r window.open(o2.filterUrl(\"../x_desktop/printWork.html?workCompletedId=\" + this.businessData.workCompleted.id + \"&amp;app=\" + application + \"&amp;form=\" + form));\r } else {\r var application = app || this.businessData.work.application;\r window.open(o2.filterUrl(\"../x_desktop/printWork.html?workid=\" + this.businessData.work.id + \"&amp;app=\" + application + \"&amp;form=\" + form));\r }\r //window.open(\"../x_desktop/printWork.html?workid=\"+this.businessData.work.id+\"&amp;app=\"+this.businessData.work.application+\"&amp;form=\"+form);\r },\r /**\r * @summary 将新上传的附件在指定的附件组件中展现.\r * @param {String} site - 附件组件的标识\r * @param {String} id - 新上传的附件id\r * @example\r * this.form.getApp().appForm.uploadedAttachment(site, id);\r */\r uploadedAttachment: function (site, id) {\r this.workAction.getAttachment(id, this.businessData.work.id, function (json) {\r var att = this.all[site];\r if (att) {\r if (json.data) att.attachmentController.addAttachment(json.data);\r att.attachmentController.checkActions();\r att.fireEvent(\"upload\", [json.data]);\r }\r }.bind(this));\r },\r replacedAttachment: function (site, id) {\r this.workAction.getAttachment(id, this.businessData.work.id, function (json) {\r \r var att = this.all[site];\r if (att) {\r var attachmentController = att.attachmentController;\r var attachment = null;\r for (var i = 0; i &lt; attachmentController.attachments.length; i++) {\r if (attachmentController.attachments[i].data.id === id) {\r attachment = attachmentController.attachments[i];\r break;\r }\r }\r attachment.data = json.data;\r attachment.reload();\r attachmentController.checkActions();\r }\r }.bind(this))\r },\r //移动端页面 工作处理完成后 \r finishOnMobile: function () {\r var _self = this;\r //新建检查\r // if (this.json.checkDraft){\r // this.workAction.checkDraft(this.businessData.work.id, function (json) {\r // // var str = JSON.stringify(json);\r // _self.finishOnMobileReal();\r // }.bind(this), function () {\r // _self.finishOnMobileReal();\r // }, false);\r // }else {\r // _self.finishOnMobileReal();\r // }\r this.workAction.checkDraft(this.businessData.work.id, function (json) {\r // var str = JSON.stringify(json);\r _self.finishOnMobileReal();\r }.bind(this), function () {\r _self.finishOnMobileReal();\r }, false);\r },\r \r finishOnMobileReal: function () {\r if (window.o2android &amp;&amp; window.o2android.closeWork) {\r window.o2android.closeWork(\"\");\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.closeWork) {\r window.webkit.messageHandlers.closeWork.postMessage(\"\");\r } else if (window.wx &amp;&amp; window.__wxjs_environment === 'miniprogram') { //微信小程序 关闭页面\r wx.miniProgram.navigateBack({ delta: 1 });\r } else if (this.json.afterProcessAction === \"redirect\" &amp;&amp; this.json.afterProcessRedirectScript &amp;&amp; this.json.afterProcessRedirectScript.code) {\r var url = this.Macro.exec(this.json.afterProcessRedirectScript.code, this);\r (new URI(url)).go();\r } else {\r var len = window.history.length;\r if (len > 1) {\r history.back();\r } else {\r var uri = new URI(window.location.href);\r var redirectlink = uri.getData(\"redirectlink\");\r if (redirectlink) {\r history.replaceState(null, \"work\", redirectlink);\r redirectlink.toURI().go();\r } else {\r window.location = o2.filterUrl(\"../x_desktop/appMobile.html?app=process.TaskCenter\");\r history.replaceState(null, \"work\", o2.filterUrl(\"../x_desktop/appMobile.html?app=process.TaskCenter\"));\r o2.filterUrl(\"../x_desktop/appMobile.html?app=process.TaskCenter\").toURI().go();\r }\r }\r }\r }\r \r });\r \r \r /**\r * @class PortalPage 门户页面。\r * @alias PortalPage\r * @o2category FormComponents\r * @o2range {Portal}\r * @extends MWF.xApplication.process.Xform.Form\r * @example\r * //可以在脚本中获取页面\r * //方法1：\r * var page = this.form.getApp().appForm; //获取页面\r * //方法2\r * var page = this.target; //在页面本身的事件脚本中获取\r * @hideconstructor\r */\r var PortalPage=\"\";\r \r /**\r * @event PortalPage#beforeProcessWork\r * @ignore\r */\r /**\r * @event PortalPage#beforeProcess\r * @ignore\r */\r /**\r * @event PortalPage#afterProcess\r * @ignore\r */\r /**\r * @event PortalPage#beforeReset\r * @ignore\r */\r /**\r * @event PortalPage#afterReset\r * @ignore\r */\r /**\r * @event PortalPage#beforeRetract\r * @ignore\r */\r /**\r * @event PortalPage#afterRetract\r * @ignore\r */\r /**\r * @event PortalPage#beforeReroute\r * @ignore\r */\r /**\r * @event PortalPage#afterReroute\r * @ignore\r */\r /**\r * @event PortalPage#beforeDelete\r * @ignore\r */\r /**\r * @event PortalPage#afterDelete\r * @ignore\r */\r /**\r * @event PortalPage#beforeReaded\r * @ignore\r */\r /**\r * @event PortalPage#afterReaded\r * @ignore\r */\r /**\r * @method PortalPage#getRouteDataList\r * @ignore\r */\r /**\r * @method PortalPage#pressWork\r * @ignore\r */\r /**\r * @method PortalPage#rerouteWork\r * @ignore\r */\r /**\r * @method PortalPage#readedWork\r * @ignore\r */\r /**\r * @method PortalPage#uploadedAttachment\r * @ignore\r */\r \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Htmleditor.js.html":{"url":"x_component_process_Xform_Htmleditor.js.html","title":"x_component_process_Xform/Htmleditor.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Htmleditor.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Htmleditor.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Htmleditor HTML编辑器。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var htmlEditor = this.form.get(\"name\"); //获取组件\r * //方法2\r * var htmlEditor = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Htmleditor = MWF.APPHtmleditor = new Class(\r /** @lends MWF.xApplication.process.Xform.Htmleditor# */\r {\r \tExtends: MWF.APP$Module,\r options: {\r \"moduleEvents\": [\"load\", \"postLoad\", \"afterLoad\"]\r },\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r load: function(){\r \r if (this.fireEvent(\"queryLoad\")){\r this._queryLoaded();\r this._loadUserInterface();\r this._loadStyles();\r //this._loadEvents();\r \r this._afterLoaded();\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"load\");\r }\r },\r \r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r if (this.readonly){\r this.node.set(\"html\", this._getBusinessData());\r this.node.setStyles({\r \"-webkit-user-select\": \"text\",\r \"-moz-user-select\": \"text\"\r });\r }else{\r var config = Object.clone(this.json.editorProperties);\r if (this.json.config){\r if (this.json.config.code){\r var obj = this.form.Macro.exec(this.json.config.code, this);\r Object.each(obj, function(v, k){\r config[k] = v;\r });\r }\r }\r this.loadCkeditor(config);\r }\r // this._loadValue();\r \t},\r loadCkeditor: function(config){\r COMMON.AjaxModule.loadDom(\"ckeditor\", function(){\r CKEDITOR.disableAutoInline = true;\r var editorDiv = new Element(\"div\").inject(this.node);\r var htmlData = this._getBusinessData();\r if (htmlData){\r editorDiv.set(\"html\", htmlData);\r }else if (this.json.templateCode){\r editorDiv.set(\"html\", this.json.templateCode);\r }\r var height = this.node.getSize().y;\r var editorConfig = config || {};\r \r if (this.form.json.mode===\"Mobile\"){\r if (!editorConfig.toolbar &amp;&amp; !editorConfig.toolbarGroups){\r editorConfig.toolbar = [\r { name: 'paragraph', items: [ 'Bold', 'Italic', \"-\" , 'TextColor', \"BGColor\", 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock', \"-\", 'Undo', 'Redo' ] },\r { name: 'basicstyles', items: [ 'Styles', 'FontSize']}\r ];\r }\r }\r \r editorConfig.localImageMaxWidth = 800;\r editorConfig.reference = this.form.businessData.work.job;\r editorConfig.referenceType = \"processPlatformJob\";\r if( editorConfig &amp;&amp; editorConfig.extraPlugins ){\r var extraPlugins = editorConfig.extraPlugins;\r extraPlugins = typeOf( extraPlugins ) === \"array\" ? extraPlugins : extraPlugins.split(\",\");\r extraPlugins.push( 'pagebreak' );\r editorConfig.extraPlugins = extraPlugins;\r }else{\r editorConfig.extraPlugins = ['pagebreak'];\r }\r \r // CKEDITOR.basePath = COMMON.contentPath+\"/res/framework/htmleditor/ckeditor/\";\r // CKEDITOR.plugins.basePath = COMMON.contentPath+\"/res/framework/htmleditor/ckeditor/plugins/\";\r this.editor = CKEDITOR.replace(editorDiv, editorConfig);\r \r this.editor.addCommand(\"ecnet\", {\r exec:function(editor){\r this.ecnet();\r }.bind(this)\r });\r this.editor.ui.add('ecnet', CKEDITOR.UI_BUTTON, {\r label:'智能纠错',\r icon: '../x_component_process_Xform/$Form/default/icon/ecnet.png',\r command:\"ecnet\"\r });\r \r this._loadEvents();\r //this.editor.on(\"loaded\", function(){\r // this._loadEvents();\r //}.bind(this));\r \r //this.setData(data)\r \r this.editor.on(\"change\", function(){\r //this._setBusinessData(this.getData());\r }.bind(this));\r \r if (this.json.ecnet===\"y\"){\r // this.editor.on( \"key\", function( evt ) {\r // // var char = evt.data.domEvent.$.char;\r // // if ([\".\", \",\", \"?\", \";\", \"'\", \" \"].indexOf(char)!==-1){\r // // this.ecnet(evt.editor.getData());\r // // }\r // }.bind(this));\r // this.editor.on(\"blur\", function(){\r // if (!this.notEcnetFlag) this.ecnet(this.getData());\r // }.bind(this));\r }\r \r \r // this._loadEvents();\r }.bind(this));\r },\r getEcnetString: function(node, nodes){\r for (var i=0; i&lt;node.childNodes.length; i++){\r if (node.childNodes[i].nodeType===Node.TEXT_NODE){\r var s = this.ecnetString.length;\r this.ecnetString += node.childNodes[i].nodeValue;\r var e = this.ecnetString.length;\r \r nodes.push({\r \"pnode\": node,\r \"node\": node.childNodes[i],\r \"start\": s, \"end\": e\r });\r }else{\r this.getEcnetString(node.childNodes[i], nodes);\r }\r }\r },\r createEcnetNode: function(node){\r var newNode = node.node.ownerDocument.createElement(\"span\");\r \r var increment = 0;\r var html = node.node.nodeValue;;\r node.ecnets.each(function(ecnet){\r var s = ecnet.begin+increment-node.start;\r var e = ecnet.end+increment-node.start;\r if (s&lt;0) s=0;\r if (e>node.end+increment) e = node.end+increment;\r var length = html.length;\r \r var left = html.substring(0, s);\r var ecnetStr = html.substring(s, e);\r var right = html.substring(e, html.length);\r \r html = left+\"&lt;span class='o2_ecnet_item' style='color: red'>&lt;u>\"+ecnetStr+\"&lt;/u>&lt;/span>\"+right;\r increment += (html.length-length);\r \r }.bind(this));\r newNode.innerHTML = html;\r node.pnode.replaceChild(newNode, node.node);\r node.pnode.textNode = node.node;\r node.pnode.ecnetNode = newNode;\r \r var _self = this;\r var editorFrame = this.editor.document.$.defaultView.frameElement;\r var spans = newNode.getElementsByTagName(\"span\");\r if (spans.length){\r for (var i = 0; i&lt;spans.length; i++){\r var span = spans[i];\r if (span.className===\"o2_ecnet_item\"){\r var ecnetNode = new Element(\"div\", {\"styles\": {\r \"border\": \"1px solid #999999\",\r \"box-shadow\": \"0px 0px 5px #999999\",\r \"background-color\": \"#ffffff\",\r \"position\": \"fixed\",\r \"display\": \"none\"\r }}).inject(editorFrame, \"after\");\r var correctNode = new Element(\"div\", {\r \"styles\": {\r \"padding\": \"3px 10px\",\r \"font-weight\": \"bold\",\r \"font-size\": \"12px\",\r \"cursor\": \"pointer\"\r },\r \"text\": node.ecnets[i].origin+\"->\"+node.ecnets[i].correct,\r \"events\": {\r \"mouseover\": function(){this.setStyle(\"background-color\", \"#dddddd\")},\r \"mouseout\": function(){this.setStyle(\"background-color\", \"#ffffff\")},\r \"mousedown\": function(){\r var ecnetNode = this.getParent();\r var node = ecnetNode.node;\r var item = ecnetNode.node.ecnets[ecnetNode.idx];\r var textNode = node.node.ownerDocument.createTextNode(item.correct);\r ecnetNode.span.parentNode.replaceChild(textNode, ecnetNode.span);\r ecnetNode.destroy();\r node.node.nodeValue = node.pnode.ecnetNode.innerText;\r \r node.ecnets.erase(item);\r if (!node.ecnets.length){\r _self.ecnetNodes.erase(node);\r }\r }\r }\r }).inject(ecnetNode);\r var ignoreNode = new Element(\"div\", {\r \"styles\": {\r \"padding\": \"3px 10px\",\r \"font-size\": \"12px\",\r \"cursor\": \"pointer\"\r },\r \"text\": MWF.xApplication.process.Xform.LP.ignore,\r \"events\": {\r \"mouseover\": function(){this.setStyle(\"background-color\", \"#dddddd\")},\r \"mouseout\": function(){this.setStyle(\"background-color\", \"#ffffff\")},\r \"mousedown\": function(){\r var ecnetNode = this.getParent();\r var node = ecnetNode.node;\r var item = ecnetNode.node.ecnets[ecnetNode.idx];\r var textNode = node.node.ownerDocument.createTextNode(ecnetNode.span.innerText);\r ecnetNode.span.parentNode.replaceChild(textNode, ecnetNode.span);\r ecnetNode.destroy();\r node.node.nodeValue = node.pnode.ecnetNode.innerText;\r \r node.ecnets.erase(item);\r if (!node.ecnets.length){\r _self.ecnetNodes.erase(node);\r }\r }\r }\r }).inject(ecnetNode);\r ecnetNode.node = node;\r ecnetNode.idx = i;\r \r span.ecnetNode = ecnetNode;\r ecnetNode.span = span;\r span.addEventListener(\"click\", function(){\r var ecnetNode = this.ecnetNode;\r ecnetNode.show();\r var y = this.offsetTop;\r var x = this.offsetLeft;\r var w = this.offsetWidth;\r var h = this.offsetHeight;\r var p = editorFrame.getPosition();\r var s = ecnetNode.getSize();\r var top = y+p.y+h+5;\r var left = x+p.x-((s.x-w)/2);\r \r ecnetNode.style.left = \"\"+left+\"px\";\r ecnetNode.style.top = \"\"+top+\"px\";\r \r var _span = this;\r var hideEcnetNode = function(){\r ecnetNode.hide();\r _span.ownerDocument.removeEventListener(\"mousedown\", hideEcnetNode);\r };\r this.ownerDocument.addEventListener(\"mousedown\", hideEcnetNode);\r \r });\r \r }\r }\r }\r \r //node.pnode.ecnetInforNode = ecnetNode;\r \r // var spans = newNode.getElementsByTagName(\"span\");\r // if (spans.length){\r // var span = spans[0];\r // span.addEventListener(\"click\", function(){\r // ecnetNode.style.display = \"block\";\r // var y = span.offsetTop;\r // var x = span.offsetLeft;\r // var w = span.offsetWidth;\r // var h = span.offsetHeight;\r // var p = editorFrame.getPosition();\r // var s = ecnetNode.getSize();\r // var top = y+p.y+h+5;\r // var left = x+p.x-((s.x-w)/2);\r //\r // ecnetNode.style.left = \"\"+left+\"px\";\r // ecnetNode.style.top = \"\"+top+\"px\";\r // });\r // span.addEventListener(\"mouseout\", function(){});\r // }\r \r },\r clearEcnetNodes: function(){\r if (this.ecnetNodes &amp;&amp; this.ecnetNodes.length){\r this.ecnetNodes.each(function(node){\r if (node.pnode.ecnetNode){\r if (node.pnode.ecnetInforNode) node.pnode.ecnetInforNode.destroy();\r node.pnode.ecnetInforNode = null;\r node.pnode.replaceChild(node.pnode.textNode, node.pnode.ecnetNode);\r }\r }.bind(this));\r this.ecnetNodes = [];\r }\r },\r ecnet: function(data){\r //this.editor.document.$.body.innerText\r var editorFrame = this.editor.document.$.defaultView.frameElement;\r //var data = this.editor.getData();\r var body = this.editor.document.$.body;\r \r if (!this.ecnetNodes) this.ecnetNodes = [];\r if (this.ecnetNodes.length) this.clearEcnetNodes();\r \r var nodes = [];\r this.ecnetString = \"\";\r this.getEcnetString(body, nodes);\r \r MWF.Actions.get(\"x_general_assemble_control\").ecnetCheck({\"value\": this.ecnetString}, function(json){\r if (json.data.itemList &amp;&amp; json.data.itemList.length){\r \r nodes.each(function(node){\r var items = [];\r json.data.itemList.each(function(item){\r if ((node.end&lt;=item.end &amp;&amp; node.end>item.begin) || (node.start>=item.begin &amp;&amp; node.start&lt;item.end) || (node.start&lt;=item.begin &amp;&amp; node.end>item.end)){\r items.push(item);\r }\r }.bind(this));\r if (items.length){\r node.ecnets = items;\r this.ecnetNodes.push(node);\r }\r }.bind(this));\r \r \r this.ecnetNodes.each(function(node){\r this.createEcnetNode(node);\r }.bind(this));\r \r \r // var item = json.data.itemList[0];\r // var left = data.substring(0, item.begin);\r // var ecnetStr = data.substring(item.begin, item.end);\r // var right = data.substring(item.end, data.length);\r //\r // var newData = left+\"&lt;span class='o2_ecnet_item' style='color:red' title='\"+item.origin+\"->\"+item.correc+\"'>&lt;u>\"+ecnetStr+\"&lt;/u>&lt;/span>\"+right;\r //this.editor.document.$.body.setSelectionRange(item.begin, item.end);\r //this.editor.setData(newData);\r \r // var iframe = editorFrame.clone();\r // iframe.inject(this.node);\r // iframe.position({\r // \"relativeTo\": editorFrame,\r // \"position\": 'upperLeft',\r // \"edge\": 'upperLeft'\r // });\r // iframe.contentWindow.document.body.set(\"html\", newData);\r }else{\r body = null;\r nodes = null;\r }\r }.bind(this));\r },\r _loadEvents: function(editorConfig){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r this.editor.on(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this), this);\r }\r }.bind(this));\r \r },\r addModuleEvent: function(key, fun){\r this.editor.on(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this), this);\r },\r _loadValue: function(){\r var data = this._getBusinessData();\r },\r /**\r * @summary 重置组件的值为默认值或置空。\r * @example\r * this.form.get('fieldId').resetData();\r */\r resetData: function(){\r this.setData(this._getBusinessData());\r },\r /**\r * @summary 判断组件值是否为空.\r * @example\r * if( this.form.get('fieldId').isEmpty() ){\r * this.form.notice('HTML编辑器不能为空', 'warn');\r * }\r * @return {Boolean} 值是否为空.\r */\r isEmpty : function(){\r return !this.getData().trim();\r },\r /**\r * 当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。\r * @summary 获取组件值。\r * @example\r * var data = this.form.get('fieldId').getData();\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * var data;\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * data = this.form.get('fieldId').getData();\r * }else{\r * data = this.data['fieldId']; //直接从数据中获取字段值\r * }\r * @return 组件的数据.\r */\r getData: function(){\r this.clearEcnetNodes();\r return this.editor ? this.editor.getData() : \"\";\r },\r /**\r * 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。\r * @summary 为组件赋值。\r * @param data{String} .\r * @example\r * this.form.get(\"fieldId\").setData(\"test\"); //赋文本值\r * @example\r * //如果无法确定表单上是否有组件，需要判断\r * if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r * this.form.get('fieldId').setData( data );\r * }else{\r * this.data['fieldId'] = data;\r * }\r */\r setData: function(data){\r this._setBusinessData(data);\r if (this.editor) this.editor.setData(data);\r },\r createErrorNode: function(text){\r var node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r return node;\r },\r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border\", \"1px solid red\");\r \r this.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r this.showNotValidationMode(this.node);\r if (!this.node.isIntoView()) this.node.scrollIntoView();\r }\r },\r showNotValidationMode: function(node){\r var p = node.getParent(\"div\");\r if (p){\r if (p.get(\"MWFtype\") == \"tab$Content\"){\r if (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r \r validationConfigItem: function(routeName, data){\r var flag = (data.status==\"all\") ? true: (routeName == data.decision);\r if (flag){\r var n = this.getData();\r var v = (data.valueType==\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function(routeName, opinion){\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r \r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r \r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString()!=\"true\"){\r this.notValidationMode(flag);\r return false;\r }\r return true;\r }\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Iframe.js.html":{"url":"x_component_process_Xform_Iframe.js.html","title":"x_component_process_Xform/Iframe.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Iframe.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Iframe.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Iframe HTML iframe。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var iframe = this.form.get(\"name\"); //获取组件\r * //方法2\r * var iframe = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Iframe = MWF.APPIframe = new Class({\r \tExtends: MWF.APP$Module,\r \r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r \r var src = this.json.src;\r if (this.json.valueType==\"script\"){\r src = this.form.Macro.exec(((this.json.script) ? this.json.script.code : \"\"), this);\r }\r \r \t\tthis.iframe = new Element(\"iframe\", {\r \t\t\t\"src\": src\r \t\t}).inject(this.node, \"after\");\r \t\t\r \t\tthis.node.destroy();\r \t\tthis.node = this.iframe.setStyles({\r \t\t\t\"width\": \"100%\",\r \t\t\t\"border\": \"0\"\r \t\t});\r \t}\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Image.js.html":{"url":"x_component_process_Xform_Image.js.html","title":"x_component_process_Xform/Image.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Image.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Image.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Image 图片。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var img = this.form.get(\"name\"); //获取组件\r * //方法2\r * var img = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Image = MWF.APPImage = new Class(\r {\r Extends: MWF.APP$Module,\r _loadUserInterface: function(){\r if (this.json.properties &amp;&amp; this.json.properties[\"src\"]){\r var value = this.json.properties[\"src\"];\r if ((value.indexOf(\"x_processplatform_assemble_surface\")!=-1 || value.indexOf(\"x_portal_assemble_surface\")!=-1 || value.indexOf(\"x_cms_assemble_control\")!=-1)){\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r var host3 = MWF.Actions.getHost(\"x_cms_assemble_control\");\r if (value.indexOf(\"/x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"/x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }else if (value.indexOf(\"x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }\r if (value.indexOf(\"/x_portal_assemble_surface\")!==-1){\r value = value.replace(\"/x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }else if (value.indexOf(\"x_portal_assemble_surface\")!==-1){\r value = value.replace(\"x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }\r if (value.indexOf(\"/x_cms_assemble_control\")!==-1){\r value = value.replace(\"/x_cms_assemble_control\", host3+\"/x_cms_assemble_control\");\r }else if (value.indexOf(\"x_cms_assemble_control\")!==-1){\r value = value.replace(\"x_cms_assemble_control\", host3+\"/x_cms_assemble_control\");\r }\r value = o2.filterUrl(value);\r }\r try{\r this.node.set(\"src\", value);\r }catch(e){}\r }else if (this.json.srcfile &amp;&amp; this.json.srcfile!=\"none\"){\r value = this.json.srcfile;\r if (typeOf(value)===\"object\"){\r var url = (value.portal) ? MWF.xDesktop.getPortalFileUr(value.id, value.portal) : MWF.xDesktop.getProcessFileUr(value.id, value.application);\r url = o2.filterUrl(url);\r this.node.set(\"src\", url);\r }else{\r var host = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r var action = MWF.Actions.get(\"x_portal_assemble_surface\");\r var uri = action.action.actions.readFile.uri;\r uri = uri.replace(\"{flag}\", value);\r uri = uri.replace(\"{applicationFlag}\", this.form.json.application);\r value = host+\"/x_portal_assemble_surface\"+uri;\r value = o2.filterUrl(value);\r this.node.set(\"src\", value);\r }\r }else if (typeOf(this.json.src)==\"object\"){\r var src = MWF.xDesktop.getImageSrc( this.json.src.imageId );\r this.node.set(\"src\", src);\r }\r },\r reset: function(){\r this._loadUserInterface();\r }\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_ImageClipper.js.html":{"url":"x_component_process_Xform_ImageClipper.js.html","title":"x_component_process_Xform/ImageClipper.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/ImageClipper.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/ImageClipper.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class ImageClipper 图片编辑组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var imageClipper = this.form.get(\"name\"); //获取组件\r * //方法2\r * var imageClipper = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.ImageClipper = MWF.APPImageClipper = new Class(\r /** @lends MWF.xApplication.process.Xform.ImageClipper# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Module,\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r _loadUserInterface: function(){\r this.field = true;\r this.node.empty();\r var data = this._getBusinessData();\r if( data ){\r var img = new Element(\"img\",{\r src : MWF.xDesktop.getImageSrc( data )\r });\r if (layout.mobile || COMMON.Browser.Platform.isMobile) {\r img.setStyles({\r \"max-width\": \"90%\"\r })\r }else if( this.json.clipperType == \"size\" ){\r var width = this.json.imageWidth;\r var height = this.json.imageHeight;\r if( width &amp;&amp; height ){\r img.setStyles({\r width : width+\"px\",\r height : height+\"px\"\r })\r }\r }\r img.inject( this.node );\r }\r if( this.readonly || this.json.isReadonly )return;\r \r var divBottom = new Element(\"div\").inject( this.node );\r var button = new Element(\"button\").inject(divBottom);\r button.set({\r \t\t\t//\"id\": this.json.id,\r \t\t\t\"text\": this.json.name || this.json.id,\r \t\t\t\"styles\": this.form.css.buttonStyles,\r \t\t\t\"MWFType\": this.json.type\r });\r button.addEvent(\"click\", function(){\r this.validationMode();\r var d = this._getBusinessData();\r if (layout.mobile){\r o2.imageClipperCallback = function( str ){\r var data = JSON.parse( str );\r this.setData( data ? data.fileId : \"\" );\r this.validation();\r o2.imageClipperCallback = null;\r }.bind(this);\r // 兼容cms编辑表单\r var referencetype = \"processPlatformJob\";\r if(this.form.businessData.work &amp;&amp; this.form.businessData.work.referencetype) {\r referencetype = this.form.businessData.work.referencetype\r }\r var jsonString = JSON.stringify({\r \"mwfId\" : this.json.id,\r \"callback\" : \"o2.imageClipperCallback\",\r \"referencetype\": referencetype,\r \"reference\": this.form.businessData.work.job\r });\r if( window.o2android &amp;&amp; window.o2android.uploadImage2FileStorage ){\r window.o2android.uploadImage2FileStorage(jsonString)\r }else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.uploadImage2FileStorage){\r window.webkit.messageHandlers.uploadImage2FileStorage.postMessage(jsonString);\r }else {\r this.selectImage( d, function(data){\r this.setData( data ? data.id : \"\" );\r this.validation();\r }.bind(this));\r }\r }else{\r this.selectImage( d, function(data){\r this.setData( data ? data.id : \"\" );\r this.validation();\r }.bind(this));\r }\r }.bind(this));\r \t},\r getTextData : function(){\r var value = this._getBusinessData() || \"\";\r return {\"value\": [value], \"text\": [value]};\r },\r /**\r * @summary 判断组件值是否为空.\r * @example\r * if( this.form.get('fieldId').isEmpty() ){\r * this.form.notice('请上传图片', 'warn');\r * }\r * @return {Boolean} 值是否为空.\r */\r isEmpty : function(){\r return !this.getData();\r },\r /**\r * 获取上传的图片ID。\r * @summary 获取上传的图片ID。\r * @example\r * var id = this.form.get('fieldId').getData(); //获取上传的图片id\r * var url = MWF.xDesktop.getImageSrc( id ); //获取图片的url\r */\r getData: function( data ){\r return this._getBusinessData() || \"\";\r },\r setData: function( data ){\r this._setBusinessData(data);\r var img = this.node.getElements(\"img\");\r if( img &amp;&amp; img.length )img.destroy();\r if( !data )return;\r var img = new Element(\"img\",{\r src : MWF.xDesktop.getImageSrc( data )\r }).inject( this.node, \"top\" );\r if (layout.mobile || COMMON.Browser.Platform.isMobile) {\r img.setStyles({\r \"max-width\": \"90%\"\r })\r }else if( this.json.clipperType == \"size\" ){\r var width = this.json.imageWidth;\r var height = this.json.imageHeight;\r if (width &amp;&amp; height) {\r img.setStyles({\r width: width + \"px\",\r height: height + \"px\"\r })\r }\r }\r },\r \r selectImage: function(d, callback){\r var clipperType = this.json.clipperType || \"unrestricted\";\r var ratio = 1;\r var description = \"\";\r var maxSize = 800;\r if( clipperType == \"unrestricted\" ){\r ratio = 0;\r }else if( clipperType == \"size\" ){\r var width = (this.json.imageWidth) ? this.json.imageWidth.toInt() : 600;\r var height = (this.json.imageHeight) ? this.json.imageHeight.toInt() : 500;\r ratio = width / height;\r maxSize = Math.max( width, height );\r if( !isNaN( width ) &amp;&amp; !isNaN( height ) ){\r description = MWF.LP.widget.pictureSize.replace(/{width}/g, width).replace(/{height}/g, height);\r }\r }else if( clipperType == \"ratio\" ){\r ratio = this.json.imageRatio || 1;\r description = MWF.LP.widget.pictureRatio.replace(/{ratio}/g, ratio);\r }\r MWF.xDesktop.requireApp(\"process.Xform\", \"widget.ImageClipper\", function(){\r this.imageClipper = new MWF.xApplication.process.Xform.widget.ImageClipper(this.form.app, {\r \"style\": \"default\",\r \"aspectRatio\" : ratio,\r \"description\" : description,\r \"imageUrl\" : d ? MWF.xDesktop.getImageSrc( d ) : \"\",\r \"reference\" : this.form.businessData.work.job,\r \"referenceType\": \"processPlatformJob\",\r \"resultMaxSize\" : maxSize,\r \"onChange\" : function(){\r callback( { src : this.imageClipper.imageSrc, id : this.imageClipper.imageId } );\r }.bind(this)\r });\r this.imageClipper.load();\r }.bind(this));\r },\r createErrorNode: function(text){\r var node = new Element(\"div\");\r var iconNode = new Element(\"div\", {\r \"styles\": {\r \"width\": \"20px\",\r \"height\": \"20px\",\r \"float\": \"left\",\r \"background\": \"url(\"+\"../x_component_process_Xform/$Form/default/icon/error.png) center center no-repeat\"\r }\r }).inject(node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"20px\",\r \"margin-left\": \"20px\",\r \"color\": \"red\",\r \"word-break\": \"keep-all\"\r },\r \"text\": text\r }).inject(node);\r return node;\r },\r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"borderStyle\", this.node.getStyles(\"border-left\", \"border-right\", \"border-top\", \"border-bottom\"));\r this.node.setStyle(\"border\", \"1px solid red\");\r \r this.errNode = this.createErrorNode(text).inject(this.node, \"after\");\r this.showNotValidationMode(this.node);\r if (!this.node.isIntoView()) this.node.scrollIntoView();\r }\r },\r showNotValidationMode: function(node){\r var p = node.getParent(\"div\");\r if (p){\r if (p.get(\"MWFtype\") == \"tab$Content\"){\r if (p.getParent(\"div\").getStyle(\"display\")==\"none\"){\r var contentAreaNode = p.getParent(\"div\").getParent(\"div\");\r var tabAreaNode = contentAreaNode.getPrevious(\"div\");\r var idx = contentAreaNode.getChildren().indexOf(p.getParent(\"div\"));\r var tabNode = tabAreaNode.getLast().getFirst().getChildren()[idx];\r tabNode.click();\r p = tabAreaNode.getParent(\"div\");\r }\r }\r this.showNotValidationMode(p);\r }\r },\r validationMode: function(){\r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"borderStyle\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r },\r validationConfigItem: function(routeName, data){\r var flag = (data.status==\"all\") ? true: (routeName == data.decision);\r if (flag){\r var n = this.getData();\r var v = (data.valueType==\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r /**\r * @summary 根据组件的校验设置进行校验。\r * @param {String} [routeName] - 可选，路由名称.\r * @example\r * if( !this.form.get('fieldId').validation() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r validation: function(routeName, opinion){\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString()!=\"true\"){\r this.notValidationMode(flag);\r return false;\r }\r return true;\r }\r \t\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Label.js.html":{"url":"x_component_process_Xform_Label.js.html","title":"x_component_process_Xform/Label.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Label.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Label.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Label 文本组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var label = this.form.get(\"name\"); //获取组件\r * //方法2\r * var label = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Label = MWF.APPLabel = new Class(\r /** @lends MWF.xApplication.process.Xform.Label# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Module,\r \t\r \t_loadUserInterface: function(){\r \t\tif (this.json.valueType == \"text\"){\r \t\t\tthis.node.set(\"text\", this.json.text || \"\");\r \t\t}\r \t\tif (this.json.valueType == \"script\"){\r \t\t\tvar code = (this.json.script) ? this.json.script.code : \"\";\r \t\t\tif (code){\r \t\t\t var value = this.form.Macro.exec(code, this);\r \t\t\t this._setNodeText(value);\r \t\t\t\t//this.node.set(\"text\", this.form.Macro.exec(code, this) || \"\");\r \t\t\t} \r \t\t}\r \t\tif (this.json.prefixIcon || this.json.suffixIcon){\r var text = this.node.get(\"text\");\r this.node.empty();\r \r var tNode = new Element(\"div\", {\"styles\": {\r \t\"margin-left\": (this.json.prefixIcon) ? \"20px\" : \"0px\",\r \"margin-right\": (this.json.suffixIcon) ? \"20px\" : \"0px\",\r \"height\": \"100%\"\r \t\t\t}, \"text\": text}).inject(this.node);\r \r if (this.json.prefixIcon){\r var node = new Element(\"div\", {\"styles\": {\r \"float\": \"left\",\r \"width\": \"20px\",\r \"height\": \"\"+this.node.getSize().y+\"px\",\r \"background\": \"url(\"+this.json.prefixIcon+\") center center no-repeat\"\r }}).inject(tNode, \"before\");\r }\r if (this.json.suffixIcon){\r var node = new Element(\"div\", {\"styles\": {\r \"float\": \"right\",\r \"width\": \"20px\",\r \"height\": \"\"+this.node.getSize().y+\"px\",\r \"background\": \"url(\"+this.json.suffixIcon+\") center center no-repeat\"\r }}).inject(tNode, \"before\");\r }\r \t\t}\r \t},\r _setNodeText: function(value){\r if (value &amp;&amp; value.isAG){\r value.addResolve(function(v){\r this._setNodeText(v);\r }.bind(this));\r }else{\r o2.promiseAll(value).then(function(v){\r this.node.set(\"text\", v || \"\");\r }.bind(this), function(){});\r //this.node.set(\"text\", value || \"\");\r }\r },\r /**当参数为Promise的时候，请参考文档: {@link https://www.yuque.com/o2oa/ixsnyt/ws07m0|使用Promise处理表单异步}&lt;br/>\r * @summary 为组件设置文本，该文本不会被保存到后台。\r * @param text{String|Promise} .\r * @example\r * this.form.get(\"fieldId\").setText(\"test\"); //赋文本值\r * @example\r * //使用Promise\r * var field = this.form.get(\"fieldId\");\r * var dict = new this.Dict(\"test\"); //test为数据字典名称\r * var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r * field.setText( promise );\r */\r setText: function(text){\r \t if (!!text){\r o2.promiseAll(text).then(function(v){\r this.node.set(\"text\", v || \"\");\r }.bind(this), function(){});\r }else{\r this.node.set(\"text\", v || \"\");\r }\r //this.node.set(\"text\", text);\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Log.js.html":{"url":"x_component_process_Xform_Log.js.html","title":"x_component_process_Xform/Log.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Log.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Log.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r \r /** @class Log 流程记录组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var log = this.form.get(\"name\"); //获取组件\r * //方法2\r * var log = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Log = MWF.APPLog = new Class(\r /** @lends MWF.xApplication.process.Xform.Log# */\r {\r \tExtends: MWF.APP$Module,\r options: {\r /**\r * 加载数据后事件。\r * @event MWF.xApplication.process.Xform.Log#postLoadData\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r * @example\r * //触发该事件的时候可以获取到流程数据workLog\r * var workLog = this.target.workLog;\r * //可以修改workLog达到定制化流程记录的效果\r * do something\r */\r /**\r * 加载每行流程信息以后触发，可以通过this.event获得下列信息：\r * &lt;pre>&lt;code>\r {\r \"data\" : {}, //当前行流程信息\r \"node\" : logTaskNode, //当前节点\r \"log\" : object, //指向流程记录\r \"type\" : \"task\" //\"task\"表示待办，\"taskCompleted\"表示已办\r }\r &lt;/code>&lt;/pre>\r * @event MWF.xApplication.process.Xform.Log#postLoadLine\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"postLoadData\", \"postLoadLine\"]\r },\r \r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r this.node.setStyle(\"-webkit-user-select\", \"text\");\r if (this.form.businessData){\r if (this.json.logType!==\"record\"){\r if (this.form.businessData.workLogList){\r this.workLog = Array.clone(this.form.businessData.workLogList);\r this.fireEvent(\"postLoadData\");\r this.loadWorkLog();\r }\r }else{\r if (this.form.businessData.recordList){\r this.workLog = Array.clone(this.form.businessData.recordList);\r this.fireEvent(\"postLoadData\");\r this.loadRecordLog();\r }\r }\r \r }\r \t},\r loadRecordLog: function(){\r if( !this.json.category || this.json.category === \"none\" ){\r if (this.json.mode===\"table\"){\r this.loadRecordLogTable();\r }else if (this.json.mode===\"text\"){\r this.loadRecordLogText();\r }else if (this.json.mode===\"media\"){\r this.loadRecordLogMedia();\r }else{\r this.loadRecordLogDefault();\r }\r }else{\r this.loadCategoryList(\"_loadRecordCategoryList\", \"_loadRecordCategoryList\");\r if( !this.categoryList.length )return;\r this.expandCount = 0;\r if( this.json.expand &amp;&amp; this.json.expand === \"enable\" ){\r this.expandCount = parseInt( this.json.expandCount );\r }\r this.table = new Element(\"table\", this.json.tableProperties).inject( this.node );\r this.categoryList.each( function( key, idx ){\r var list = this.categoryJson[key];\r if( list &amp;&amp; list.length ){\r \r var tr = new Element(\"tr\").inject( this.table );\r if( this.expandCount &amp;&amp; (idx + 1) > this.expandCount ){\r tr.setStyle(\"display\",\"none\");\r }\r var text = key;\r if( this.json.category === \"unit\" ){\r text = key.split(\"@\")[0];\r }\r new Element(\"td\", {\r styles : this.json.titleTdStyles,\r text : text\r }).inject( tr );\r \r var td = new Element(\"td\", {\r styles : this.json.contentTdStyles\r }).inject( tr );\r \r var div = new Element(\"div\",{\r styles : this.json.contentDivStyles || {}\r }).inject( td );\r \r \r if( this.json.sortTypeInCategory === \"completedTimeAsc\" || this.json.sortTypeInCategory === \"completedTimeDesc\" ){\r list.sort(function(a, b){\r if( this.json.sortTypeInCategory === \"completedTimeAsc\" ) {\r return Date.parse(a.recordTime) - Date.parse(b.recordTime);\r }else if( this.json.sortTypeInCategory === \"completedTimeDesc\" ) {\r return Date.parse(b.recordTime) - Date.parse(a.recordTime);\r }\r }.bind(this));\r \r \r // sortedList = [];\r // list.each( function( log ){\r // if (log.taskCompletedList.length) {\r // log.taskCompletedList.each(function (t) {\r // var copyLog = Object.clone( log );\r // copyLog.readList = [];\r // copyLog.readCompletedList = [];\r // copyLog.taskList = [];\r // copyLog.taskCompletedList = [t];\r // sortedList.push( copyLog );\r // }.bind(this));\r // }\r // }.bind(this));\r // sortedList.sort(function(a, b){\r // if( this.json.sortTypeInCategory === \"completedTimeAsc\" ) {\r // return Date.parse(a.taskCompletedList[0].completedTime) - Date.parse(b.taskCompletedList[0].completedTime);\r // }else if( this.json.sortTypeInCategory === \"completedTimeDesc\" ) {\r // return Date.parse(b.taskCompletedList[0].completedTime) - Date.parse(a.taskCompletedList[0].completedTime);\r // }\r // }.bind(this));\r // list.each( function( log ) {\r // if (log.taskList.length) {\r // log.taskList.each(function (t) {\r // var copyLog = Object.clone(log);\r // copyLog.readList = [];\r // copyLog.readCompletedList = [];\r // copyLog.taskCompletedList = [];\r // copyLog.taskList = [t];\r // sortedList.push(copyLog);\r // }.bind(this));\r // }\r // })\r }\r \r if (this.json.mode===\"table\"){\r this.loadRecordLogTable( list, div );\r }else if (this.json.mode===\"text\"){\r this.loadRecordLogText( list, div );\r }else if (this.json.mode===\"media\"){\r this.loadRecordLogMedia( list, div );\r }else{\r this.loadRecordLogDefault( list, div );\r }\r \r this._loadTableStyles();\r }\r }.bind(this));\r if( this.categoryList.length > this.expandCount ){\r this.loadExpandCollapseNode();\r }\r }\r },\r \r _loadRecordCategoryList : function( category ){\r this.categoryList = [];\r this.categoryJson = {};\r if( category === \"fromOpinionGroup\" ){\r this.workLog.sort( function( a, b ){\r if( a.properties.fromOpinionGroup &amp;&amp; b.properties.fromOpinionGroup ) {\r var array1 = a.properties.fromOpinionGroup.split(\"#\");\r var array2 = b.properties.fromOpinionGroup.split(\"#\");\r for (var i = 0; i &lt; array1.length; i++) {\r var value1 = array1[i];\r var value2 = array2[i];\r if (this.isNumber(value1) &amp;&amp; this.isNumber(value2)) {\r if (parseFloat(value1) !== parseFloat(value2)) {\r return parseFloat(value1) - parseFloat(value2);\r }else{\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.recordTime) - Date.parse(b.recordTime);\r }\r }\r } else if (!this.isNumber(value1) &amp;&amp; !this.isNumber(value2)) {\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.recordTime) - Date.parse(b.recordTime);\r }\r } else {\r return this.isNumber(value1) ? -1 : 1;\r }\r }\r return Date.parse(a.recordTime) - Date.parse(b.recordTime);\r }else if( a.properties.fromOpinionGroup || b.properties.fromOpinionGroup ){\r return a.properties.fromOpinionGroup ? -1 : 1;\r }else{\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.recordTime) - Date.parse(b.recordTime);\r }\r }\r }.bind(this))\r }\r this.workLog.each( function(log, idx){\r var key;\r if( this.json.category === \"activityGroup\" ){\r if( log.properties.fromOpinionGroup ){\r var arr = log.properties.fromOpinionGroup.split(\"#\");\r key = arr[arr.length-1]\r }else{\r key = log.fromActivityName;\r }\r }else{\r key = log[category];\r }\r \r if( key &amp;&amp; this.checkRecordShow(log)){\r if( this.categoryList.indexOf( key ) === -1 ){\r this.categoryList.push( key );\r }\r if( !this.categoryJson[key] )this.categoryJson[key] = [];\r this.categoryJson[key].push( log );\r }\r }.bind(this))\r },\r \r loadRecordLogTable: function( list, container ){\r var taskTable = new Element(\"table\", {\r \"styles\": this.form.css.logTableTask,\r \"border\": \"0\",\r \"cellSpacing\": \"0\",\r \"cellpadding\": \"3px\",\r \"width\": \"100%\"\r }).inject(container || this.node);\r var tr = taskTable.insertRow(0).setStyles(this.form.css.logTableTaskTitleLine);\r \r var td = tr.insertCell(0).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.person);\r td = tr.insertCell(1).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.activity);\r td = tr.insertCell(2).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.department);\r td = tr.insertCell(3).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.startTime);\r td = tr.insertCell(4).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.completedTime);\r td = tr.insertCell(5).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.route);\r td = tr.insertCell(6).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.opinion);\r \r td = tr.insertCell(7).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.arrivedActivitys);\r td = tr.insertCell(8).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.arrivedUsers);\r \r if( list ){\r list.each(function(log, idx){\r this.loadRecordLogLine_table(log, idx, taskTable );\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkRecordShow(log)) this.loadRecordLogLine_table(log, idx, taskTable );\r }.bind(this));\r }\r },\r checkRecordShow: function(log){\r var flag = true;\r if (this.json.filterScript &amp;&amp; this.json.filterScript.code){\r this.form.Macro.environment.log = log;\r this.form.Macro.environment.list = null;\r flag = this.form.Macro.exec(this.json.filterScript.code, this);\r }else{\r if (this.json.filterActivity &amp;&amp; this.json.filterActivity.length){\r filterActivitys = this.json.filterActivity;\r flag = (filterActivitys.indexOf(log.fromActivityName)!==-1);\r }\r if (this.json.filterActivityAlias){\r if (this.json.filterActivityAlias.length){\r filterActivityAlias = this.json.filterActivityAlias;\r flag = ((log.fromActivityAlias) &amp;&amp; filterActivityAlias.indexOf(log.fromActivityAlias)!==-1);\r }\r }\r if (this.json.filterPerson &amp;&amp; this.json.filterPerson.length){\r flag = (this.json.filterPerson.indexOf(log.person)!==-1);\r if (!flag) flag = (this.json.filterPerson.indexOf(o2.name.cn(log.person))!==-1);\r }\r if (this.json.filterRoute &amp;&amp; this.json.filterRoute.length){\r filterRoutes = this.json.filterRoute;\r flag = (filterRoutes.indexOf(log.properties.routeName)!==-1);\r }\r }\r return flag;\r },\r \r loadRecordLogLine_table: function(log, idx, taskTable){\r var style = ((idx % 2)===0) ? \"logTableTaskLine\" : \"logTableTaskLine_even\";\r if (log.type===\"currentTask\"){\r if (this.json.isTask) this.loadRecordTaskLine_table(log, taskTable, true, style);\r }else{\r this.loadRecordTaskLine_table(log, taskTable, false, style);\r }\r },\r loadRecordTaskLine_table: function(task, table, isTask, style){\r // var style = \"logTableTaskLine\";\r // \"logTableTaskLine_even\"\r \r css = (isTask) ? Object.merge(this.form.css[\"logTableTaskLine_task\"], this.form.css[style] ): this.form.css[style];\r \r \r if (isTask) style = \"logTableTaskLine_task\";\r var tr = table.insertRow(table.rows.length);\r var td = tr.insertCell(0).setStyles(css);\r \r var person = (task.person) ? task.person.substring(0, task.person.indexOf(\"@\")) : \"\";\r if (task.properties.empowerFromIdentity){\r var ep = o2.name.cn(task.properties.empowerFromIdentity);\r person = person + \" \"+MWF.xApplication.process.Xform.LP.replace+\" \" + ep;\r }\r if (task.type === \"empower\") task.properties.startTime = task.recordTime;\r td.set(\"text\", person);\r td = tr.insertCell(1).setStyles(css);\r td.set(\"text\", task.fromActivityName || \"\");\r td = tr.insertCell(2).setStyles(css);\r td.set(\"text\", (task.unit) ? task.unit.substring(0, task.unit.indexOf(\"@\")) : \"\");\r td = tr.insertCell(3).setStyles(css);\r td.set(\"text\", task.properties.startTime || \"\");\r td = tr.insertCell(4).setStyles(css);\r td.set(\"text\", task.recordTime || \"\");\r \r var router, opinion, arrivedActivitys, arrivedUsers;\r arrivedActivitys = task.properties.nextManualList.map(function(o){\r return o.activityName;\r }).join(\",\");\r arrivedUsers = (task.properties.nextManualTaskIdentityList &amp;&amp; task.properties.nextManualTaskIdentityList.length) ? o2.name.cns(task.properties.nextManualTaskIdentityList).join(\",\") : \"\";\r \r switch (task.type) {\r case \"empower\":\r router = MWF.xApplication.process.Xform.LP.empower;\r var empowerTo = (task.properties.nextManualTaskIdentityList &amp;&amp; task.properties.nextManualTaskIdentityList.length) ? o2.name.cns(task.properties.nextManualTaskIdentityList).join(\",\") : \"\";\r opinion = MWF.xApplication.process.Xform.LP.empowerTo + empowerTo;\r task.properties.startTime = task.recordTime;\r break;\r case \"retract\":\r router = MWF.xApplication.process.Xform.LP.retract;\r opinion = MWF.xApplication.process.Xform.LP.retract;\r break;\r case \"reroute\":\r router = task.properties.routeName || MWF.xApplication.process.Xform.LP.reroute;\r opinion = task.properties.opinion || MWF.xApplication.process.Xform.LP.rerouteTo+\": \"+arrivedActivitys;\r break;\r case \"rollback\":\r router = task.properties.routeName || MWF.xApplication.process.Xform.LP.rollback;\r opinion = task.properties.opinion || MWF.xApplication.process.Xform.LP.rollbackTo+\": \"+task.arrivedActivityName;\r break;\r case \"reset\":\r var resetUser = task.properties.nextManualTaskIdentityList.erase(task.identity);\r resetUserText = o2.name.cns(resetUser).join(\",\");\r router = MWF.xApplication.process.Xform.LP.resetTo+\":\"+resetUserText;\r opinion = task.properties.opinion || \"\"\r break;\r case \"appendTask\":\r case \"back\":\r case \"addSplit\":\r case \"urge\":\r case \"expire\":\r case \"read\":\r default:\r router = task.properties.routeName || \"\";\r opinion = task.properties.opinion || \"\";\r }\r \r \r td = tr.insertCell(5).setStyles(css);\r td.set(\"text\",router);\r var opinionTd = tr.insertCell(6).setStyles(css);\r opinionTd.set(\"html\", \"&lt;div style='display: inline-block; float: left'>\"+opinion+\"&lt;/div>\");\r td = tr.insertCell(7).setStyles(css);\r td.set(\"text\",arrivedActivitys);\r td = tr.insertCell(8).setStyles(css);\r td.set(\"html\", arrivedUsers);\r \r var atts = [];\r if (task.properties.mediaOpinion){\r var mediaIds = task.properties.mediaOpinion.split(\",\");\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r if (atts.length) this.loadMediaOpinion(atts, opinionTd.getFirst(), \"table\");\r }\r \r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"node\" : tr,\r \"atts\" : atts,\r \"log\" : this,\r \"type\" : isTask ? \"task\" : \"taskCompleted\"\r }]);\r },\r loadRecordLogDefault: function(list, container){\r var logActivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityNode_record}).inject(container || this.node);\r if( list ){\r list.each(function(log, idx){\r this.loadRecordLogLine_default(log, idx, logActivityNode);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkRecordShow(log)) this.loadRecordLogLine_default(log, idx, logActivityNode);\r }.bind(this));\r }\r },\r loadRecordLogLine_default: function(log, idx, container){\r //var style = ((idx % 2)===0) ? \"logTableTaskLine_even\" : \"logTableTaskLine\";\r var style = ((idx % 2)===0) ? \"logActivityChildRecordNode\" : \"logActivityChildRecordNode_even\";\r \r var childNode = new Element(\"div\", {\"styles\": this.form.css[style]}).inject((container || this.node));\r if (log.type===\"currentTask\"){\r if (this.json.isTask) this.loadRecordTaskLine_default(log, childNode, true);\r }else{\r this.loadRecordTaskLine_default(log, childNode, false);\r }\r },\r loadRecordTaskLine_default: function(task, node, isTask, margin, isZebra, nodeStyle, noIconNode){\r \r var style = \"logTaskNode\";\r var textStyle = \"logTaskFloatTextNode\";\r if (nodeStyle){\r style = \"logTaskTextNode\";\r textStyle = \"logTaskTextNode\";\r }\r var logTaskNode = new Element(\"div\", {\"styles\": this.form.css[style]}).inject(node);\r var iconNode;\r if( !noIconNode ){\r iconNode = new Element(\"div\", {\"styles\": this.form.css.logTaskIconNode_record}).inject(logTaskNode);\r }\r var textNode = new Element(\"div\", {\"styles\": this.form.css[textStyle]}).inject(logTaskNode);\r \r if (isZebra){\r logTaskNode.setStyles(this.form.css[this.lineClass]);\r if (this.lineClass === \"logTaskNode\"){\r this.lineClass = \"logTaskNode_even\";\r }else{\r this.lineClass = \"logTaskNode\";\r }\r }\r \r var left = 0;\r if( iconNode ){\r if (margin) iconNode.setStyle(\"margin-left\", margin);\r left = iconNode.getStyle(\"margin-left\").toInt();\r left = left + 28;\r }\r if( !nodeStyle ){\r textNode.setStyle(\"margin-left\",left+\"px\");\r }\r var html;\r var company = \"\";\r var atts = [];\r if (!isTask){\r company = (task.unitList) ? task.unitList[task.unitList.length-1] : \"\";\r html = this.json.textStyle;\r \r var lp = MWF.xApplication.process.Xform.LP;\r if (task.type==\"empower\") html = \"&lt;font style='color:#ff5400;'>{person}&lt;/font>（{department}）\"+lp.in+\"【{activity}】\"+lp.activity+\"，\"+lp.empowerTo +\"&lt;font style='color:#ff5400;'>{empowerTo}&lt;/font>。（{time}）&lt;/font>\";\r \r var nextTaskText = (task.properties.nextManualTaskIdentityList &amp;&amp; task.properties.nextManualTaskIdentityList.length) ? o2.name.cns(task.properties.nextManualTaskIdentityList).join(\",\") : \"\";\r \r if (this.json.textStyleScript &amp;&amp; this.json.textStyleScript.code){\r this.form.Macro.environment.log = task;\r this.form.Macro.environment.list = null;\r html = this.form.Macro.exec(this.json.textStyleScript.code, this);\r }\r \r // var person = (task.person) ? task.person.substring(0, task.person.indexOf(\"@\")) : \"\";\r // if( task.type !== \"empowerTask\" &amp;&amp; task.empowerFromIdentity){\r // person = person+\" \"+lp.replace+\" \"+o2.name.cn(task.empowerFromIdentity||\"\");\r // }\r \r var person = (task.person) ? task.person.substring(0, task.person.indexOf(\"@\")) : \"\";\r if (task.properties.empowerFromIdentity){\r var ep = o2.name.cn(task.properties.empowerFromIdentity);\r person = person + \" \"+MWF.xApplication.process.Xform.LP.replace+\" \" + ep;\r }\r \r var router, opinion, arrivedActivitys, arrivedUsers;\r arrivedActivitys = task.properties.nextManualList.map(function(o){\r return o.activityName;\r }).join(\",\");\r arrivedUsers = (task.properties.nextManualTaskIdentityList &amp;&amp; task.properties.nextManualTaskIdentityList.length) ? o2.name.cns(task.properties.nextManualTaskIdentityList).join(\",\") : \"\";\r \r switch (task.type) {\r case \"empower\":\r \r router = MWF.xApplication.process.Xform.LP.empower;\r var empowerTo = (task.properties.nextManualTaskIdentityList &amp;&amp; task.properties.nextManualTaskIdentityList.length) ? o2.name.cns(task.properties.nextManualTaskIdentityList).join(\",\") : \"\";\r opinion = MWF.xApplication.process.Xform.LP.empowerTo + empowerTo;\r task.properties.startTime = task.recordTime;\r break;\r case \"retract\":\r router = MWF.xApplication.process.Xform.LP.retract;\r opinion = MWF.xApplication.process.Xform.LP.retract;\r break;\r case \"reroute\":\r router = task.properties.routeName || MWF.xApplication.process.Xform.LP.reroute;\r opinion = task.properties.opinion || MWF.xApplication.process.Xform.LP.rerouteTo+\": \"+arrivedActivitys;\r break;\r case \"rollback\":\r router = task.properties.routeName || MWF.xApplication.process.Xform.LP.rollback;\r opinion = task.properties.opinion || MWF.xApplication.process.Xform.LP.rollbackTo+\": \"+task.arrivedActivityName;\r break;\r case \"reset\":\r var resetUser = task.properties.nextManualTaskIdentityList.erase(task.identity);\r resetUserText = o2.name.cns(resetUser).join(\",\");\r router = MWF.xApplication.process.Xform.LP.resetTo+\":\"+resetUserText;\r opinion = task.properties.opinion || \"\"\r break;\r case \"appendTask\":\r case \"back\":\r case \"addSplit\":\r case \"urge\":\r case \"expire\":\r case \"read\":\r case \"task\":\r case \"empowerTask\":\r default:\r router = task.properties.routeName || \"\";\r opinion = task.properties.opinion || \"\";\r }\r \r html = html.replace(/\\{person\\}/g, person );\r html = html.replace(/\\{department\\}/g, (task.unit) ? task.unit.substring(0, task.unit.indexOf(\"@\")) : \"\");\r html = html.replace(/\\{route\\}/g, router);\r html = html.replace(/\\{time\\}/g, task.recordTime);\r html = html.replace(/\\{date\\}/g, new Date().parse(task.recordTime).format(\"%Y-%m-%d\"));\r html = html.replace(/\\{opinion\\}/g, opinion);\r html = html.replace(/\\{company\\}/g, company.substring(0, company.indexOf(\"@\")));\r html = html.replace(/\\{startTime\\}/g, task.properties.startTime);\r html = html.replace(/\\{startDate\\}/g, new Date().parse(task.properties.startTime).format(\"%Y-%m-%d\"));\r html = html.replace(/\\{activity\\}/g, task.fromActivityName);\r html = html.replace(/\\{arrivedActivity\\}/g, arrivedActivitys);\r html = html.replace(/\\{img\\}/g, \"&lt;span class='mwf_log_img'>&lt;/span>\");\r html = html.replace(/\\{empowerTo\\}/g, arrivedUsers);\r html = html.replace(/\\{next\\}/g, nextTaskText);\r \r //var html = MWF.xApplication.process.Xform.LP.nextUser + task.person+\"(\"+task.department+\")\" +\", \"+\r // MWF.xApplication.process.Xform.LP.selectRoute + \": [\" + task.routeName + \"], \" +\r // MWF.xApplication.process.Xform.LP.submitAt + \": \" + task.completedTime+ \", \" +\r // MWF.xApplication.process.Xform.LP.idea + \": &lt;font style=\\\"color: #00F\\\">\" + (task.opinion || \"\")+\"&lt;/font>\";\r \r textNode.set(\"html\", html);\r var imgNode = textNode.getElement(\".mwf_log_img\");\r if (task.properties.mediaOpinion){\r var mediaIds = task.properties.mediaOpinion.split(\",\");\r // var atts = [];\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r if (atts.length){\r if (imgNode){\r this.loadMediaOpinion_show(atts, task, imgNode, true);\r // atts.each(function(att){\r // this.loadMediaOpinion_image_show(att, task, imgNode);\r // }.bind(this));\r \r }else{\r this.loadMediaOpinion(atts, textNode, \"default\");\r }\r }\r }\r }else{\r var person = (task.person) ? task.person.substring(0, task.person.indexOf(\"@\")) : \"\";\r if (task.properties.empowerFromIdentity){\r var ep = o2.name.cn(task.properties.empowerFromIdentity);\r person = person + \" \"+MWF.xApplication.process.Xform.LP.replace+\" \" + ep;\r }\r html = person+\"(\"+task.unit.substring(0, task.unit.indexOf(\"@\"))+\"), 【\"+task.fromActivityName+\"】\" + MWF.xApplication.process.Xform.LP.processing+\", \"+\r MWF.xApplication.process.Xform.LP.comeTime + \": \" + task.properties.startTime;\r textNode.set(\"html\", html);\r if(iconNode)iconNode.setStyle(\"background-image\", \"url(\"+\"../x_component_process_Xform/$Form/\"+this.form.options.style+\"/icon/rightRed.png)\");\r }\r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"atts\" : atts,\r \"node\" : logTaskNode,\r \"log\" : this,\r \"type\" : isTask ? \"task\" : \"taskCompleted\"\r }]);\r },\r \r \r loadRecordLogText: function(list, container){\r this.lineClass = \"logTaskNode\";\r if( list ){\r list.each(function(log, idx){\r this.loadRecordLogLine_text(log, idx, container);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkRecordShow(log)) this.loadRecordLogLine_text(log, idx, container);\r }.bind(this));\r }\r },\r loadRecordLogLine_text: function(log, idx, container){\r if (log.type===\"currentTask\"){\r if (this.json.isTask) this.loadRecordTaskLine_text(log, container || this.node, true);\r }else{\r this.loadRecordTaskLine_text(log, container || this.node, false);\r }\r },\r loadRecordTaskLine_text: function(task, node, isTask){\r this.loadRecordTaskLine_default(task, node, isTask, \"0px\", false, true, true);\r },\r \r loadRecordLogMedia: function(list, container){\r if( list ){\r list.each(function(log, idx){\r this.loadRecordLogLine_media(log, idx, container);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkRecordShow(log)) this.loadRecordLogLine_media(log, idx, container);\r }.bind(this));\r }\r \r },\r loadRecordLogLine_media: function(log, idx, container){\r this.loadRecordTaskLine_media(log, container);\r },\r loadRecordTaskLine_media: function(task, container){\r if (task.properties.mediaOpinion){\r var mediaIds = task.properties.mediaOpinion.split(\",\");\r var atts = [];\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r var isCompleted = !!task.recordTime;\r task.completedTime = task.recordTime;\r var node = new Element(\"div\").inject( container || this.node );\r if (atts.length) this.loadMediaOpinion_show(atts, task, node);\r \r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"atts\" : atts,\r \"node\" : node,\r \"log\" : this,\r \"type\" : isCompleted ? \"taskCompleted\" : \"task\"\r }]);\r }\r },\r \r //worklog -----------------------------------------------------------------------------\r \r loadWorkLog: function(){\r if( !this.json.category || this.json.category === \"none\" ){\r if (this.json.mode===\"table\"){\r this.loadWorkLogTable();\r }else if (this.json.mode===\"text\"){\r this.loadWorkLogText();\r }else if (this.json.mode===\"media\"){\r this.loadWorkLogMedia();\r }else{\r this.loadWorkLogDefault();\r }\r }else{\r this.loadCategoryList();\r if( !this.categoryList.length )return;\r this.expandCount = 0;\r if( this.json.expand &amp;&amp; this.json.expand === \"enable\" ){\r this.expandCount = parseInt( this.json.expandCount || 0 );\r }\r this.table = new Element(\"table\", this.json.tableProperties).inject( this.node );\r this.categoryList.each( function( key, idx ){\r var list = this.categoryJson[key];\r if( list &amp;&amp; list.length ){\r \r var tr = new Element(\"tr\").inject( this.table );\r if( this.expandCount &amp;&amp; (idx + 1) > this.expandCount ){\r tr.setStyle(\"display\",\"none\");\r }\r var text = key;\r if( this.json.category === \"unit\" ){\r text = key.split(\"@\")[0];\r }\r new Element(\"td\", {\r styles : this.json.titleTdStyles,\r text : text\r }).inject( tr );\r \r var td = new Element(\"td\", {\r styles : this.json.contentTdStyles\r }).inject( tr );\r \r var div = new Element(\"div\",{\r styles : this.json.contentDivStyles || {}\r }).inject( td );\r \r var sortedList = list;\r if( this.json.sortTypeInCategory === \"completedTimeAsc\" || this.json.sortTypeInCategory === \"completedTimeDesc\" ){\r sortedList = [];\r list.each( function( log ){\r if (log.taskCompletedList.length) {\r log.taskCompletedList.each(function (t) {\r var copyLog = Object.clone( log );\r copyLog.readList = [];\r copyLog.readCompletedList = [];\r copyLog.taskList = [];\r copyLog.taskCompletedList = [t];\r sortedList.push( copyLog );\r }.bind(this));\r }\r }.bind(this));\r sortedList.sort(function(a, b){\r if( this.json.sortTypeInCategory === \"completedTimeAsc\" ) {\r return Date.parse(a.taskCompletedList[0].completedTime) - Date.parse(b.taskCompletedList[0].completedTime);\r }else if( this.json.sortTypeInCategory === \"completedTimeDesc\" ) {\r return Date.parse(b.taskCompletedList[0].completedTime) - Date.parse(a.taskCompletedList[0].completedTime);\r }\r }.bind(this));\r list.each( function( log ) {\r if (log.taskList.length) {\r log.taskList.each(function (t) {\r var copyLog = Object.clone(log);\r copyLog.readList = [];\r copyLog.readCompletedList = [];\r copyLog.taskCompletedList = [];\r copyLog.taskList = [t];\r sortedList.push(copyLog);\r }.bind(this));\r }\r })\r }\r \r if (this.json.mode===\"table\"){\r this.loadWorkLogTable( sortedList, div );\r }else if (this.json.mode===\"text\"){\r this.loadWorkLogText( sortedList, div );\r }else if (this.json.mode===\"media\"){\r this.loadWorkLogMedia( sortedList, div );\r }else{\r this.loadWorkLogDefault( sortedList, div );\r }\r \r this._loadTableStyles();\r }\r }.bind(this));\r if( this.categoryList.length > this.expandCount ){\r this.loadExpandCollapseNode();\r }\r }\r },\r loadCategoryList : function(m1, m2){\r var category;\r if( this.json.category === \"activity\" ){\r category = \"fromActivityName\";\r this[m1 || \"_loadCategoryList\"]( category );\r }else if( this.json.category === \"unit\" ){\r category = \"unit\";\r this[m2 || \"_loadCategoryLitBySubData\"]( category );\r }else if( this.json.category === \"activityGroup\" ){\r category = \"fromOpinionGroup\";\r this[m1 || \"_loadCategoryList\"]( category );\r }else{\r category = this.json.category;\r this[m1 || \"_loadCategoryList\"]( category );\r }\r },\r // isNumber : function( d ){\r // return parseFloat(d).toString() !== \"NaN\"\r // },\r _loadCategoryList : function( category ){\r this.categoryList = [];\r this.categoryJson = {};\r if( category === \"fromOpinionGroup\" ){\r this.workLog.sort( function( a, b ){\r if( a.fromOpinionGroup &amp;&amp; b.fromOpinionGroup ) {\r var array1 = a.fromOpinionGroup.split(\"#\");\r var array2 = b.fromOpinionGroup.split(\"#\");\r for (var i = 0; i &lt; array1.length; i++) {\r var value1 = array1[i];\r var value2 = array2[i];\r if (this.isNumber(value1) &amp;&amp; this.isNumber(value2)) {\r if (parseFloat(value1) !== parseFloat(value2)) {\r return parseFloat(value1) - parseFloat(value2);\r }else{\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.fromTime) - Date.parse(b.fromTime);\r }\r }\r } else if (!this.isNumber(value1) &amp;&amp; !this.isNumber(value2)) {\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.fromTime) - Date.parse(b.fromTime);\r }\r } else {\r return this.isNumber(value1) ? -1 : 1;\r }\r }\r return Date.parse(a.fromTime) - Date.parse(b.fromTime);\r }else if( a.fromOpinionGroup || b.fromOpinionGroup ){\r return a.fromOpinionGroup ? -1 : 1;\r }else{\r if( this.json.sortTypeInCategory === \"none\" ){\r return 0;\r }else{\r return Date.parse(a.fromTime) - Date.parse(b.fromTime);\r }\r }\r }.bind(this))\r }\r this.workLog.each( function(log, idx){\r var key;\r if( this.json.category === \"activityGroup\" ){\r \r if( log.fromOpinionGroup ){\r var arr = log.fromOpinionGroup.split(\"#\");\r key = arr[arr.length-1]\r }else{\r key = log.fromActivityName;\r }\r }else{\r key = log[category];\r }\r \r if( key &amp;&amp; this.checkShow(log)){\r var flag = false;\r \r for( var i=0; i&lt; log.taskCompletedList.length; i++ ){\r var taskCompleted = log.taskCompletedList[i];\r flag = this.checkListShow(log, taskCompleted);\r if( flag )break;\r }\r if (!flag &amp;&amp; this.json.isTask){\r for( var i=0; i&lt; this.json.isTask.length; i++ ){\r var task = log.taskList[i];\r flag = this.checkListShow(log, task);\r if( flag )break;\r }\r }\r if(flag){\r if( this.categoryList.indexOf( key ) === -1 ){\r this.categoryList.push( key );\r }\r if( !this.categoryJson[key] )this.categoryJson[key] = [];\r this.categoryJson[key].push( log );\r }\r }\r }.bind(this))\r },\r _loadCategoryLitBySubData : function( category ){\r this.categoryList = [];\r this.categoryJson = {};\r this.workLog.each( function(log, idx){\r var key = log[category];\r \r if( this.checkShow(log) ){\r var flag = false;\r \r for( var i=0; i&lt; log.taskCompletedList.length; i++ ){\r var taskCompleted = log.taskCompletedList[i];\r flag = this.checkListShow(log, taskCompleted);\r if( flag )break;\r }\r if (!flag &amp;&amp; this.json.isTask){\r for( var i=0; i&lt; this.json.isTask.length; i++ ){\r var task = log.taskList[i];\r flag = this.checkListShow(log, task);\r if( flag )break;\r }\r }\r if(flag){\r var log_copy = Object.clone(log);\r log_copy.taskCompletedList = [];\r log_copy.taskList = [];\r log_copy.readCompletedList = [];\r log_copy.readList = [];\r \r var sub_categoryList = [];\r var sub_categoryJson = {};\r \r for( var i=0; i&lt; log.taskCompletedList.length; i++ ){\r var d = log.taskCompletedList[i];\r var key = d[category];\r if( key ){\r if( sub_categoryList.indexOf( key ) === -1 ){\r sub_categoryList.push( key );\r }\r if( !sub_categoryJson[key] )sub_categoryJson[key] = Object.clone(log_copy);\r sub_categoryJson[key].taskCompletedList.push( d );\r }\r }\r \r for( var i=0; i&lt; log.taskList.length; i++ ){\r var d = log.taskList[i];\r var key = d[category];\r if( key ){\r if( sub_categoryList.indexOf( key ) === -1 ){\r sub_categoryList.push( key );\r }\r if( !sub_categoryJson[key] )sub_categoryJson[key] = Object.clone(log_copy);\r sub_categoryJson[key].taskList.push( d );\r }\r }\r \r for( var i=0; i&lt; log.readCompletedList.length; i++ ){\r var d = log.readCompletedList[i];\r var key = d[category];\r if( key ){\r if( sub_categoryList.indexOf( key ) === -1 ){\r sub_categoryList.push( key );\r }\r if( !sub_categoryJson[key] )sub_categoryJson[key] = Object.clone(log_copy);\r sub_categoryJson[key].readCompletedList.push( d );\r }\r }\r \r for( var i=0; i&lt; log.readList.length; i++ ){\r var d = log.readList[i];\r var key = d[category];\r if( key ){\r if( sub_categoryList.indexOf( key ) === -1 ){\r sub_categoryList.push( key );\r }\r if( !sub_categoryJson[key] )sub_categoryJson[key] = Object.clone(log_copy);\r sub_categoryJson[key].readList.push( d );\r }\r }\r \r sub_categoryList.each( function(key){\r if( this.categoryList.indexOf( key ) === -1 ){\r this.categoryList.push( key );\r }\r }.bind(this));\r \r for( var key in sub_categoryJson ){\r if( !this.categoryJson[key] )this.categoryJson[key] = [];\r this.categoryJson[key].push( sub_categoryJson[key] );\r }\r }\r }\r \r }.bind(this))\r },\r _loadTableBorderStyle: function(){\r if (this.json.tableStyles &amp;&amp; this.json.tableStyles.border){\r this.table.set(\"cellspacing\", \"0\");\r this.table.setStyles({\r \"border-top\": this.json.tableStyles.border,\r \"border-left\": this.json.tableStyles.border\r });\r var ths = this.table.getElements(\"th\");\r if( ths &amp;&amp; ths.length ){\r ths.setStyles({\r \"border-bottom\": this.json.tableStyles.border,\r \"border-right\": this.json.tableStyles.border\r });\r }\r \r var tds = this.table.getElements(\"td\");\r if( tds &amp;&amp; tds.length ) {\r tds.setStyles({\r \"border-bottom\": this.json.tableStyles.border,\r \"border-right\": this.json.tableStyles.border\r });\r }\r }\r },\r _loadTableStyles: function(){\r Object.each(this.json.tableStyles || {}, function(value, key){\r var reg = /^border\\w*/ig;\r if (!key.test(reg)){\r this.table.setStyle(key, value);\r }\r }.bind(this));\r this._loadTableBorderStyle();\r },\r loadExpandCollapseNode : function(){\r if( this.json.expand &amp;&amp; this.json.expand === \"enable\" ){\r if( this.json.expandHTML ){\r this.expandNode = new Element(\"div\",{\r \"html\" : this.json.expandHTML\r }).inject( this.node, \"bottom\" );\r this.expandNode.addEvent(\"click\", function(){\r if( !this.json.category || this.json.category === \"none\" ){\r \r }else{\r this.table.getElements(\"tr\").setStyle(\"display\",\"\");\r this.expandNode.setStyle(\"display\",\"none\");\r this.collapseNode.setStyle(\"display\",\"\");\r }\r }.bind(this))\r }\r if( this.json.collapseHTML ){\r this.collapseNode = new Element(\"div\",{\r \"html\" : this.json.collapseHTML,\r \"styles\" : { \"display\" : \"none\" }\r }).inject( this.node, \"bottom\" );\r this.collapseNode.addEvent(\"click\", function(){\r if( !this.json.category || this.json.category === \"none\" ){\r \r }else{\r var trs = this.table.getElements(\"tr\");\r for( var i=0; i&lt;trs.length; i++ ){\r if( i >= this.expandCount ){\r trs[i].setStyle(\"display\",\"none\");\r }\r }\r this.expandNode.setStyle(\"display\",\"\");\r this.collapseNode.setStyle(\"display\",\"none\");\r }\r }.bind(this))\r }\r }\r },\r \r \r loadWorkLogMedia: function(list, container){\r if( list ){\r list.each(function(log, idx){\r this.loadWorkLogLine_media(log, idx, container);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkShow(log)) this.loadWorkLogLine_media(log, idx, container);\r }.bind(this));\r }\r \r },\r loadWorkLogLine_media: function(log, idx, container){\r if (log.taskCompletedList.length){\r log.taskCompletedList.each(function(taskCompleted){\r if (this.checkListShow(log, taskCompleted)) this.loadTaskLine_media(taskCompleted, log, container);\r }.bind(this));\r }\r },\r loadTaskLine_media: function(task, log, container){\r if (task.mediaOpinion){\r var mediaIds = task.mediaOpinion.split(\",\");\r var atts = [];\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r var node = new Element(\"div\").inject( container || this.node );\r if (atts.length) this.loadMediaOpinion_show(atts, task, node);\r \r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"atts\" : atts,\r \"node\" : node,\r \"log\" : this,\r \"type\" : !!task.completedTime ? \"taskCompleted\" : \"task\"\r }]);\r }\r },\r loadMediaOpinion_show: function(atts, task, container, noName){\r atts.each(function(att){\r //if (!att.contentType) att.contentType = \"image\";\r if (att.type){\r if (att.type.indexOf(\"image\")!==-1){\r this.loadMediaOpinion_image_show(att, task, container, noName);\r }else if(att.type.indexOf(\"video\")!==-1){\r this.loadMediaOpinion_video_show(att, task, container);\r }else if(att.type.indexOf(\"audio\")!==-1){\r this.loadMediaOpinion_voice_show(att, task, container);\r }else{\r this.loadMediaOpinion_voice_show(att, task, container);\r }\r }\r }.bind(this));\r },\r loadMediaOpinion_image_show: function(att, task, container, noName){\r var url = this.getMediaOpinionUrl(att);\r var node = new Element(\"div\", {\"styles\": {\"overflow\": \"hidden\"}}).inject( container || this.node);\r if (!noName){\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"28px\",\r \"height\": \"28px\"\r },\r \"text\": task.person.substring(0, task.person.indexOf(\"@\"))+\"(\"+task.completedTime+\")\"\r }).inject(node);\r }\r \r //var img = new Element(\"img\", {\"src\": url, \"styles\": {\"background-color\": \"#ffffff\"}}).inject(node);\r //\r //var height = 200;\r //var width = 300;\r //if (layout.mobile){\r // var size = img.getSize();\r // width = 200;\r // height = 200*(size.y/size.x);\r //}\r //img.setStyles({\"width\": \"\"+width+\"px\", \"height\": \"\"+height+\"px\"});\r \r \r var imgNode = new Element(\"div\").inject(node);\r var width;\r if (layout.mobile){\r width = 200;\r }else{\r var pNode = node.getParent();\r var offset = imgNode.getPosition( pNode );\r //width = Math.min( pNode.getSize().x - offset.x - 2, 800 );\r width = pNode.getSize().x - offset.x - 42;\r }\r \r var img = new Element(\"img\", {\r \"src\": url,\r \"styles\" : { width : width+\"px\" },\r \"events\" : {\r load : function(ev){\r var nh=ev.target.naturalHeight;\r var nw = ev.target.naturalWidth;\r if( !layout.mobile &amp;&amp; ( this.isNumber( this.json.handwritingWidth ) || this.isNumber( this.json.handwritingHeight ) ) ){\r var size = this.getImageSize( nw, nh );\r img.setStyles(size);\r imgNode.setStyles(size);\r }else{\r var x = Math.min(nw, width);\r img.setStyles({\"width\": \"\"+ x +\"px\"});\r imgNode.setStyles({\"width\": \"\"+ x +\"px\"});\r }\r }.bind(this)\r }\r }).inject(imgNode);\r \r // var size = img.getSize();\r // var x_y = size.x/size.y;\r // if (size.y>260){\r // var y = 260;\r // var x = 260*x_y;\r // img.setStyles({\"width\": \"\"+x+\"px\", \"height\": \"\"+y+\"px\"})\r // }\r },\r isNumber : function( d ){\r return parseFloat(d).toString() !== \"NaN\"\r },\r getImageSize : function(naturalWidth, naturalHeight ){\r var ww = this.json.handwritingWidth;\r var wh = this.json.handwritingHeight;\r if( this.isNumber(ww) &amp;&amp; !this.isNumber(wh) ){\r return {\r width : Math.min( naturalWidth, parseInt( ww ) ) + \"px\",\r height : \"auto\"\r }\r }else if( !this.isNumber(ww) &amp;&amp; this.isNumber(wh) ){\r return {\r width : \"auto\",\r height : Math.min( naturalHeight, parseInt( wh ) ) + \"px\"\r }\r }else if( this.isNumber(ww) &amp;&amp; this.isNumber(wh) ){\r var flag = ( naturalWidth / parseInt(ww) ) > ( naturalHeight / parseInt(wh) );\r if( flag ){\r return {\r width : Math.min( naturalWidth, parseInt( ww ) ) + \"px\",\r height : \"auto\"\r }\r }else{\r return {\r width : \"auto\",\r height : Math.min( naturalHeight, parseInt( wh ) ) + \"px\"\r }\r }\r }\r },\r loadMediaOpinion_video_show: function(att, task, container){\r \r },\r loadMediaOpinion_voice_show: function(att, task, container){\r //var node = new Element(\"audio\").inject(this.node);\r var url = this.getMediaOpinionUrl(att);\r var div = new Element(\"div\", {\"styles\": {\"overflow\": \"hidden\"}}).inject(container || this.node);\r var textNode = new Element(\"div\", {\r \"styles\": {\r \"line-height\": \"28px\",\r \"height\": \"28px\"\r },\r \"text\": task.person.substring(0, task.person.indexOf(\"@\"))+\"(\"+task.completedTime+\")\"\r }).inject(div);\r \r var node = new Element(\"audio\", {\"loop\": false, \"controls\": true}).inject(div);\r node.set(\"src\", url);\r //this.audioNode.play();\r },\r \r loadWorkLogTable: function( list, container ){\r if( list ){\r list.each(function(log, idx){\r this.loadWorkLogLine_table(log, idx, container );\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkShow(log)) this.loadWorkLogLine_table(log, idx, container );\r }.bind(this));\r }\r },\r loadWorkLogLine_table: function(log, idx, container){\r if (!log.readList) log.readList = [];\r if (!log.readCompletedList) log.readCompletedList = [];\r if (log.taskCompletedList.length || log.readList.length || log.readCompletedList.length || (this.json.isTask &amp;&amp; log.taskList.length)){\r var logActivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityNode}).inject( container || this.node);\r var titleNode = new Element(\"div\", {\"styles\": this.form.css.logActivityTitleNode}).inject(logActivityNode);\r var childNode = new Element(\"div\", {\"styles\": this.form.css.logActivityChildNode}).inject(logActivityNode);\r \r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logActivityIconNode}).inject(titleNode);\r var fromAvtivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityFromNode}).inject(titleNode);\r var arrowNode = new Element(\"div\", {\"styles\": this.form.css.logActivityArrowNode}).inject(titleNode);\r var arrivedAvtivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityArrivedNode}).inject(titleNode);\r \r var timeNode = new Element(\"div\", {\"styles\": this.form.css.logActivityTimeNode}).inject(titleNode);\r \r if (log.connected){\r iconNode.setStyle(\"background-image\", \"url(\"+\"../x_component_process_Xform/$Form/\"+this.form.options.style+\"/icon/ok14.png)\");\r }else{\r iconNode.setStyle(\"background-image\", \"url(\"+\"../x_component_process_Xform/$Form/\"+this.form.options.style+\"/icon/rightRed.png)\");\r }\r fromAvtivityNode.set(\"html\", \"&lt;b>\"+log.fromActivityName+\"&lt;/b>\");\r if (log.arrivedActivityName){\r arrowNode.setStyle(\"background-image\", \"url(\"+\"../x_component_process_Xform/$Form/\"+this.form.options.style+\"/icon/right.png)\");\r arrivedAvtivityNode.set(\"html\", \"&lt;b>\"+log.arrivedActivityName+\"&lt;/b>\");\r timeNode.set(\"html\", \"&lt;b>\"+MWF.xApplication.process.Xform.LP.begin+\": &lt;/b>\"+log.fromTime+\"&lt;br/>&lt;b>\"+MWF.xApplication.process.Xform.LP.end+\": &lt;/b>\"+log.arrivedTime)\r \r }else{\r timeNode.set(\"html\", \"&lt;b>\"+MWF.xApplication.process.Xform.LP.begin+\": &lt;/b>\"+log.fromTime)\r }\r \r if ((idx % 2)===0){\r logActivityNode.setStyles(this.form.css.logActivityNode_even);\r titleNode.setStyles(this.form.css.logActivityTitleNode_even);\r }\r \r \r var taskTable = new Element(\"table\", {\r \"styles\": this.form.css.logTableTask,\r \"border\": \"0\",\r \"cellSpacing\": \"0\",\r \"cellpadding\": \"3px\",\r \"width\": \"100%\"\r }).inject(childNode);\r var tr = taskTable.insertRow(0).setStyles(this.form.css.logTableTaskTitleLine);\r \r var td = tr.insertCell(0).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.person);\r td = tr.insertCell(1).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.department);\r td = tr.insertCell(2).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.startTime);\r td = tr.insertCell(3).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.completedTime);\r td = tr.insertCell(4).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.route);\r td = tr.insertCell(5).setStyles(this.form.css.logTableTaskTitle);\r td.set(\"text\", MWF.xApplication.process.Xform.LP.opinion);\r \r log.taskCompletedList.each(function(taskCompleted){\r if (this.checkListShow(log, taskCompleted)) this.loadTaskLine_table(taskCompleted, taskTable, log, false);\r }.bind(this));\r \r if (this.json.isShowRead!==false){\r var readNames = [];\r var readCompletedNames = [];\r if (log.readList &amp;&amp; log.readList.length){\r log.readList.each(function(read){\r readNames.push(MWF.name.cn(read.person));\r });\r }\r if (log.readCompletedList &amp;&amp; log.readCompletedList.length){\r log.readCompletedList.each(function(read){\r readCompletedNames.push(MWF.name.cn(read.person));\r });\r }\r this.loadReadLine_default(readNames, readCompletedNames, childNode);\r }\r \r if (this.json.isTask){\r log.taskList.each(function(task){\r if (this.checkListShow(log, task)) this.loadTaskLine_table(task, taskTable, log, true);\r }.bind(this));\r }\r }\r \r },\r loadTaskLine_table: function(task, table, log, isTask){\r var style = \"logTableTaskLine\";\r if (isTask) style = \"logTableTaskLine_task\";\r var tr = table.insertRow(table.rows.length);\r var td = tr.insertCell(0).setStyles(this.form.css[style]);\r td.set(\"text\", task.person.substring(0, task.person.indexOf(\"@\")) || \"\");\r td = tr.insertCell(1).setStyles(this.form.css[style]);\r td.set(\"text\", task.unit.substring(0, task.unit.indexOf(\"@\")) || \"\");\r td = tr.insertCell(2).setStyles(this.form.css[style]);\r td.set(\"text\", task.startTime || \"\");\r td = tr.insertCell(3).setStyles(this.form.css[style]);\r td.set(\"text\", task.completedTime || \"\");\r td = tr.insertCell(4).setStyles(this.form.css[style]);\r td.set(\"text\", (task.processingType==\"empower\") ? \"授权\" : task.routeName || \"\");\r td = tr.insertCell(5).setStyles(this.form.css[style]);\r opinion = (task.processingType==\"empower\") ? \"授权给\"+ o2.name.cn(task.empowerToIdentity || \"\") : \"&lt;div style='line-height: 28px; float:left'>\" + (task.opinion || \"\")+\"&lt;/div>\";\r td.set(\"html\", opinion);\r \r \r var atts = [];\r if (task.mediaOpinion){\r var mediaIds = task.mediaOpinion.split(\",\");\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r if (atts.length) this.loadMediaOpinion(atts, td.getFirst(), \"table\");\r }\r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"atts\" : atts,\r \"node\" : tr,\r \"log\" : this,\r \"type\" : isTask ? \"task\" : \"taskCompleted\"\r }]);\r },\r \r \r \r loadWorkLogText: function(list, container){\r this.lineClass = \"logTaskNode\";\r if( list ){\r list.each(function(log, idx){\r this.loadWorkLogLine_text(log, idx, container);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkShow(log)) this.loadWorkLogLine_text(log, idx, container);\r }.bind(this));\r }\r },\r loadWorkLogLine_text: function(log, idx, container){\r log.taskCompletedList.each(function(taskCompleted){\r if (this.checkListShow(log, taskCompleted)) this.loadTaskLine_text(taskCompleted, container || this.node, log, false);\r }.bind(this));\r \r if (this.json.isTask){\r log.taskList.each(function(task){\r if (this.checkListShow(log, task)) this.loadTaskLine_text(task, container || this.node, log, true);\r }.bind(this));\r }\r },\r loadTaskLine_text: function(task, node, log, isTask){\r this.loadTaskLine_default(task, node, log, isTask, \"0px\", false, true, true);\r },\r \r checkShow: function(log){\r var flag = true;\r if (this.json.filterScript &amp;&amp; this.json.filterScript.code){\r this.form.Macro.environment.log = log;\r this.form.Macro.environment.list = null;\r flag = this.form.Macro.exec(this.json.filterScript.code, this);\r }else{\r if (this.json.filterActivity &amp;&amp; this.json.filterActivity.length){\r filterActivitys = this.json.filterActivity;\r flag = (filterActivitys.indexOf(log.fromActivityName)!==-1);\r }\r if (this.json.filterActivityAlias){\r if (this.json.filterActivityAlias.length){\r filterActivityAlias = this.json.filterActivityAlias;\r flag = ((log.fromActivityAlias) &amp;&amp; filterActivityAlias.indexOf(log.fromActivityAlias)!==-1);\r }\r }\r if (this.json.filterPerson &amp;&amp; this.json.filterPerson.length){\r flag = false;\r filterPersons = this.json.filterPerson;\r var tmpTaskCompletedList = [];\r log.taskCompletedList.each(function(taskCompleted){\r if ((filterPersons.indexOf(taskCompleted.person)!==-1) || (filterPersons.indexOf(taskCompleted.identity)!==-1)){\r tmpTaskCompletedList.push(taskCompleted);\r }\r }.bind(this));\r if (tmpTaskCompletedList.length){\r //log.taskCompletedList = [];\r //log.taskCompletedList = tmpTaskCompletedList;\r flag = true;\r }\r }\r if (this.json.filterRoute &amp;&amp; this.json.filterRoute.length){\r filterRoutes = this.json.filterRoute;\r flag = (filterRoutes.indexOf(log.routeName)!==-1);\r }\r }\r return flag;\r },\r checkListShow: function(log, list){\r var flag = true;\r if (this.json.filterScript &amp;&amp; this.json.filterScript.code){\r this.form.Macro.environment.log = log;\r this.form.Macro.environment.list = list;\r flag = this.form.Macro.exec(this.json.filterScript.code, this);\r }else{\r if (this.json.filterPerson &amp;&amp; this.json.filterPerson.length){\r flag = ((filterPersons.indexOf(list.person)!==-1)|| (filterPersons.indexOf(list.identity)!==-1));\r }\r }\r return flag;\r },\r \r loadWorkLogDefault: function(list, container){\r //var text = this.json.textStyle;\r if( list ){\r list.each(function(log, idx){\r this.loadWorkLogLine_default(log, idx, container);\r }.bind(this));\r }else{\r this.workLog.each(function(log, idx){\r if (this.checkShow(log)) this.loadWorkLogLine_default(log, idx, container);\r }.bind(this));\r }\r },\r loadWorkLogLine_default: function(log, idx, container){\r if (!log.readList) log.readList = [];\r if (!log.readCompletedList) log.readCompletedList = [];\r if (log.taskCompletedList.length || log.readList.length || log.readCompletedList.length || (this.json.isTask &amp;&amp; log.taskList.length)) {\r var logActivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityNode}).inject(container || this.node);\r var titleNode = new Element(\"div\", {\"styles\": this.form.css.logActivityTitleNode}).inject(logActivityNode);\r var childNode = new Element(\"div\", {\"styles\": this.form.css.logActivityChildNode}).inject(logActivityNode);\r \r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logActivityIconNode}).inject(titleNode);\r var fromAvtivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityFromNode}).inject(titleNode);\r var arrowNode = new Element(\"div\", {\"styles\": this.form.css.logActivityArrowNode}).inject(titleNode);\r var arrivedAvtivityNode = new Element(\"div\", {\"styles\": this.form.css.logActivityArrivedNode}).inject(titleNode);\r \r var readActionNode = new Element(\"div\", {\"styles\": this.form.css.logActivityReadActionNode}).inject(titleNode);\r \r var timeNode = new Element(\"div\", {\"styles\": this.form.css.logActivityTimeNode}).inject(titleNode);\r \r if (log.connected) {\r iconNode.setStyle(\"background-image\", \"url(../x_component_process_Xform/$Form/\" + this.form.options.style + \"/icon/ok14.png)\");\r } else {\r iconNode.setStyle(\"background-image\", \"url(../x_component_process_Xform/$Form/\" + this.form.options.style + \"/icon/rightRed.png)\");\r }\r fromAvtivityNode.set(\"html\", \"&lt;b>\" + log.fromActivityName + \"&lt;/b>\");\r if (log.arrivedActivityName) {\r arrowNode.setStyle(\"background-image\", \"url(../x_component_process_Xform/$Form/\" + this.form.options.style + \"/icon/right.png)\");\r arrivedAvtivityNode.set(\"html\", \"&lt;b>\" + log.arrivedActivityName + \"&lt;/b>\");\r timeNode.set(\"html\", \"&lt;b>\" + MWF.xApplication.process.Xform.LP.begin + \": &lt;/b>\" + log.fromTime + \"&lt;br/>&lt;b>\" + MWF.xApplication.process.Xform.LP.end + \": &lt;/b>\" + log.arrivedTime)\r \r } else {\r timeNode.set(\"html\", \"&lt;b>\" + MWF.xApplication.process.Xform.LP.begin + \": &lt;/b>\" + log.fromTime)\r }\r \r // if ((log.readList &amp;&amp; log.readList.length) || (log.readCompletedList &amp;&amp; log.readCompletedList.length)){\r // readActionNode.set(\"text\", MWF.xApplication.process.Xform.LP.worklogRead);\r // }\r \r if ((idx % 2) === 0) {\r logActivityNode.setStyles(this.form.css.logActivityNode_even);\r titleNode.setStyles(this.form.css.logActivityTitleNode_even);\r }\r \r log.taskCompletedList.each(function (taskCompleted) {\r if (this.checkListShow(log, taskCompleted)) this.loadTaskLine_default(taskCompleted, childNode, log, false);\r }.bind(this));\r \r if (this.json.isShowRead!==false){\r var readNames = [];\r var readCompletedNames = [];\r if (log.readList &amp;&amp; log.readList.length){\r log.readList.each(function(read){\r readNames.push(MWF.name.cn(read.person));\r });\r }\r if (log.readCompletedList &amp;&amp; log.readCompletedList.length){\r log.readCompletedList.each(function(read){\r readCompletedNames.push(MWF.name.cn(read.person));\r });\r }\r //if (readCompletedNames.length)\r this.loadReadLine_default(readNames, readCompletedNames, childNode);\r }\r \r if (this.json.isTask) {\r log.taskList.each(function (task) {\r if (this.checkListShow(log, task)) this.loadTaskLine_default(task, childNode, log, true);\r }.bind(this));\r }\r }\r },\r loadReadLine_default: function(readNames, readCompletedNames, node){\r var html = \"\";\r var logReadNode = new Element(\"div\", {\"styles\": this.form.css.logReadTextNode}).inject(node);\r if (readNames.length){\r var readStrTitle = readNames.join(\", \");\r var readStr = (readNames.length>20) ? (readNames.slice(0,20).join(\", \") + MWF.xApplication.process.Xform.LP.andSoForth ): readStrTitle;\r html = \"&lt;span style='color: #0000ff'>\"+(this.json.showReadTitle || MWF.xApplication.process.Xform.LP.showReadTitle)+\": &lt;/span>\"+readStr+\"&lt;span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span>\";\r \r //var logReadPersonNode = new Element(\"div\", {\"styles\": this.form.css.logReadTextNode}).inject(logReadNode);\r }\r if (readCompletedNames.length){\r var readCompletedStrTitle = readCompletedNames.join(\", \");\r var readCompletedStr = (readCompletedNames.length>20) ? (readCompletedNames.slice(0,20).join(\", \") + MWF.xApplication.process.Xform.LP.andSoForth ): readCompletedStrTitle;\r html += \"&lt;span style='color: #0000ff'>\"+(this.json.showReadCompletedTitle || MWF.xApplication.process.Xform.LP.showReadCompletedTitle)+\": &lt;/span>\"+readCompletedStr+\"&lt;span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span>\";\r }\r if (html) logReadNode.set(\"html\", html);\r },\r loadTaskLine_default: function(task, node, log, isTask, margin, isZebra, nodeStyle, noIconNode){\r var style = \"logTaskNode\";\r var textStyle = \"logTaskFloatTextNode\";\r if (nodeStyle){\r style = \"logTaskTextNode\";\r textStyle = \"logTaskTextNode\";\r }\r var logTaskNode = new Element(\"div\", {\"styles\": this.form.css[style]}).inject(node);\r var iconNode;\r if( !noIconNode ){\r iconNode = new Element(\"div\", {\"styles\": this.form.css.logTaskIconNode}).inject(logTaskNode);\r }\r var textNode = new Element(\"div\", {\"styles\": this.form.css[textStyle]}).inject(logTaskNode);\r \r if (isZebra){\r logTaskNode.setStyles(this.form.css[this.lineClass]);\r if (this.lineClass === \"logTaskNode\"){\r this.lineClass = \"logTaskNode_even\";\r }else{\r this.lineClass = \"logTaskNode\";\r }\r }\r \r var left = 28;\r if( iconNode ){\r if (margin) iconNode.setStyle(\"margin-left\", margin);\r left = iconNode.getStyle(\"margin-left\").toInt();\r left = left + 28;\r }\r if( !nodeStyle ){\r textNode.setStyle(\"margin-left\",left+\"px\");\r }\r var html;\r var company = \"\";\r var atts = [];\r if (!isTask){\r company = (task.unitList) ? task.unitList[task.unitList.length-1] : \"\";\r var html = this.json.textStyle;\r if (task.processingType==\"empower\") html = \"&lt;font style='color:#ff5400;'>{person}&lt;/font>（{department}）授权给&lt;font style='color:#ff5400;'>{empowerTo}&lt;/font>处理。（{time}）&lt;/font>\";\r \r var nextTaskText = \"\";\r if (task.processingType==\"empower\"){\r var nextTaskParts = [];\r if (task.nextTaskIdentityListText){\r var nestIds = task.nextTaskIdentityListText.split(\",\");\r nextTaskParts = o2.name.cns(nestIds);\r }else{\r // var nextTasks = o2.name.cns(log.nextTaskIdentityList).join(\", \");\r // var nextTaskCompleteds = o2.name.cns(log.nextTaskCompletedIdentityList).join(\", \");\r var nextTasks = (log.nextTaskIdentityList &amp;&amp; log.nextTaskIdentityList.length) ? o2.name.cns(log.nextTaskIdentityList).join(\", \") : \"\";\r var nextTaskCompleteds = (log.nextTaskCompletedIdentityList &amp;&amp; log.nextTaskCompletedIdentityList.length) ? o2.name.cns(log.nextTaskCompletedIdentityList).join(\", \") : \"\";\r \r if (nextTasks) nextTaskParts.push(nextTasks);\r if (nextTaskCompleteds) nextTaskParts.push(nextTaskCompleteds);\r }\r nextTaskText = nextTaskParts.join(\", \");\r }else{\r nextTaskText = (task.empowerToIdentity) ? o2.name.cn(task.empowerToIdentity) : \"\";\r }\r \r \r \r if (this.json.textStyleScript &amp;&amp; this.json.textStyleScript.code){\r this.form.Macro.environment.log = log;\r this.form.Macro.environment.list = null;\r html = this.form.Macro.exec(this.json.textStyleScript.code, this);\r }\r \r var person = task.person.substring(0, task.person.indexOf(\"@\"));\r if( task.processingType !== \"empower\" &amp;&amp; task.empowerFromIdentity){\r person = person+\" 代 \"+o2.name.cn(task.empowerFromIdentity||\"\");\r }\r html = html.replace(/\\{person\\}/g, person );\r html = html.replace(/\\{department\\}/g, task.unit.substring(0, task.unit.indexOf(\"@\")));\r html = html.replace(/\\{route\\}/g, task.routeName);\r html = html.replace(/\\{time\\}/g, task.completedTime);\r html = html.replace(/\\{date\\}/g, new Date().parse(task.completedTime).format(\"%Y-%m-%d\"));\r html = html.replace(/\\{opinion\\}/g, task.opinion || \"\");\r html = html.replace(/\\{company\\}/g, company.substring(0, company.indexOf(\"@\")));\r html = html.replace(/\\{startTime\\}/g, task.startTime);\r html = html.replace(/\\{startDate\\}/g, new Date().parse(task.startTime).format(\"%Y-%m-%d\"));\r html = html.replace(/\\{activity\\}/g, log.fromActivityName);\r html = html.replace(/\\{arrivedActivity\\}/g, log.arrivedActivityName);\r html = html.replace(/\\{img\\}/g, \"&lt;span class='mwf_log_img'>&lt;/span>\");\r html = html.replace(/\\{empowerTo\\}/g, ((task.empowerToIdentity) ? o2.name.cn(task.empowerToIdentity) : \"\"));\r \r html = html.replace(/\\{nextTask\\}/g, nextTasks);\r html = html.replace(/\\{nextTaskCompleted\\}/g, nextTaskCompleteds);\r html = html.replace(/\\{next\\}/g, nextTaskText);\r \r //var html = MWF.xApplication.process.Xform.LP.nextUser + task.person+\"(\"+task.department+\")\" +\", \"+\r // MWF.xApplication.process.Xform.LP.selectRoute + \": [\" + task.routeName + \"], \" +\r // MWF.xApplication.process.Xform.LP.submitAt + \": \" + task.completedTime+ \", \" +\r // MWF.xApplication.process.Xform.LP.idea + \": &lt;font style=\\\"color: #00F\\\">\" + (task.opinion || \"\")+\"&lt;/font>\";\r \r textNode.set(\"html\", html);\r var imgNode = textNode.getElement(\".mwf_log_img\");\r if (task.mediaOpinion){\r var mediaIds = task.mediaOpinion.split(\",\");\r // var atts = [];\r if (this.form.businessData.attachmentList){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===\"$mediaOpinion\"){\r if (mediaIds.indexOf(att.id)!==-1) atts.push(att);\r }\r }.bind(this));\r }\r if (atts.length){\r if (imgNode){\r this.loadMediaOpinion_show(atts, task, imgNode, true);\r // atts.each(function(att){\r // this.loadMediaOpinion_image_show(att, task, imgNode);\r // }.bind(this));\r \r }else{\r this.loadMediaOpinion(atts, textNode, \"default\");\r }\r }\r }\r }else{\r //company = task.unitList[task.unitList.length-1];\r html = task.person.substring(0, task.person.indexOf(\"@\"))+\"(\"+task.unit.substring(0, task.unit.indexOf(\"@\"))+\")\" + MWF.xApplication.process.Xform.LP.processing+\", \"+\r MWF.xApplication.process.Xform.LP.comeTime + \": \" + task.startTime;\r textNode.set(\"html\", html);\r if(iconNode)iconNode.setStyle(\"background-image\", \"url(\"+\"../x_component_process_Xform/$Form/\"+this.form.options.style+\"/icon/rightRed.png)\");\r }\r this.fireEvent(\"postLoadLine\",[{\r \"data\" : task,\r \"node\" : logTaskNode,\r \"atts\" : atts,\r \"log\" : this,\r \"type\" : isTask ? \"task\" : \"taskCompleted\"\r }]);\r },\r loadMediaOpinion: function(atts, node, type){\r atts.each(function(att){\r if (!att.type) att.type = \"image\";\r if (att.type.indexOf(\"image\")!==-1){\r if( this.json.handwritingExpanded ){\r this.loadMediaOpinion_image_show(att, null, node, true)\r }else if( type === \"table\" &amp;&amp; !layout.mobile ){\r this.loadMediaOpinion_image_tooltip(att, node);\r }else{\r this.loadMediaOpinion_image(att, node);\r }\r }else if(att.type.indexOf(\"video\")!==-1){\r this.loadMediaOpinion_video(att, node);\r }else if(att.type.indexOf(\"audio\")!==-1){\r this.loadMediaOpinion_voice(att, node);\r }else {\r if (this.json.handwritingExpanded){\r this.loadMediaOpinion_image_show(att, null, node, true)\r }else if( type === \"table\" &amp;&amp; !layout.mobile ){\r this.loadMediaOpinion_image_tooltip(att, node);\r }else{\r this.loadMediaOpinion_image(att, node);\r }\r }\r }.bind(this));\r },\r getMediaOpinionUrl: function(att){\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r var url = action.action.actions[\"getAttachmentStream\"].uri;\r if (this.form.businessData.workCompleted){\r url = action.action.actions[\"getWorkcompletedAttachmentStream\"].uri;\r url = url.replace(\"{id}\", att.id);\r url = url.replace(\"{workCompletedId}\", this.form.businessData.workCompleted.id);\r }else{\r url = url.replace(\"{id}\", att.id);\r url = url.replace(\"{workid}\", this.form.businessData.work.id);\r }\r url = action.action.address+url;\r return o2.filterUrl(url);\r },\r loadMediaOpinion_image_tooltip : function(att, node){\r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logMediaIcon}).inject(node.getParent());\r iconNode.setStyle(\"background-image\", \"url('\"+this.form.path+this.form.options.style+\"/icon/image.png')\");\r iconNode.set(\"title\", MWF.xApplication.process.Xform.LP.mediaOpinion_image);\r if( !this.MTooltipsLoaded )o2.xDesktop.requireApp(\"Template\", \"MTooltips\", null, false);\r this.MTooltipsLoaded = true;\r var tooltip = new MTooltips(this.form.app.content, iconNode, this.form.app, null, {\r axis : \"y\", \"delay\" : 350,\r nodeStyles : {\r \"max-width\" : \"800px\"\r }\r });\r tooltip.contentNode = new Element(\"div\",{\r styles : { width : \"100%\" , height : \"100%\" }\r });\r var img = new Element(\"img\", {\r \"src\": this.getMediaOpinionUrl(att),\r \"events\" : {\r load : function(ev){\r var nh = ev.target.naturalHeight;\r var nw = ev.target.naturalWidth;\r if( this.isNumber( this.json.handwritingWidth ) || this.isNumber( this.json.handwritingHeight ) ){\r var size = this.getImageSize( nw, nh );\r ev.target.setStyles(size);\r }else{\r var x = Math.min(nw, 800);\r ev.target.setStyles({\"width\": \"\"+ x +\"px\"});\r }\r }.bind(this)\r }\r }).inject(tooltip.contentNode);\r },\r loadMediaOpinion_image: function(att, node){\r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logMediaIcon}).inject(node.getParent());\r iconNode.setStyle(\"background-image\", \"url('\"+this.form.path+this.form.options.style+\"/icon/image.png')\");\r iconNode.set(\"title\", MWF.xApplication.process.Xform.LP.mediaOpinion_image);\r iconNode.addEvents({\r \"click\": function(e){\r if (e.target.mediaOpinionContentNode) return \"\";\r var url = this.getMediaOpinionUrl(att);\r // if (this.mediaOpinionContentNode){\r // this.mediaOpinionContentNode.destroy();\r // this.mediaOpinionContentNode = null;\r // }\r \r var imgNode = new Element(\"div\", {\"styles\": this.form.css.logMediaOpinionContent}).inject(node.getParent(),\"after\");\r if (!layout.mobile) imgNode.setStyle(\"margin-left\", \"40px\");\r //this.mediaOpinionContentNode = imgNode;\r e.target.mediaOpinionContentNode = imgNode;\r \r var imgCloseNode = new Element(\"div\", {\"styles\": this.form.css.logMediaOpinionContentClose}).inject(imgNode);\r imgCloseNode.addEvent(\"click\", function(){ imgNode.destroy(); e.target.mediaOpinionContentNode = \"\";});\r \r var imgAreaNode = new Element(\"div\", {\"styles\": this.form.css.logMediaOpinionContentArea}).inject(imgNode);\r \r // var height = 260;\r // var width = 390;\r var width;\r //var height;\r if (layout.mobile){\r width = node.getParent().getParent().getSize().x-2;\r //height = width*2/3;\r }else{\r var pNode = node.getParent().getParent();\r var offset = imgNode.getPosition( pNode );\r width = Math.min( pNode.getSize().x - offset.x - 42, 800 );\r }\r \r var img = new Element(\"img\", {\r \"src\": url,\r \"styles\" : { width : width+\"px\" },\r \"events\" : {\r load : function(ev){\r var nh = ev.target.naturalHeight;\r var nw = ev.target.naturalWidth;\r if( !layout.mobile &amp;&amp; ( this.isNumber( this.json.handwritingWidth ) || this.isNumber( this.json.handwritingHeight ) ) ){\r var size = this.getImageSize( nw, nh );\r img.setStyles(size);\r imgNode.setStyles(size);\r }else{\r var x = Math.min(nw, width);\r img.setStyles({\"width\": \"\"+ x +\"px\"});\r imgNode.setStyles({\"width\": \"\"+ x +\"px\"});\r }\r }.bind(this)\r }\r }).inject(imgAreaNode);\r \r //img.setStyles({\"width\": \"\"+width+\"px\"});\r //imgNode.setStyles({\"width\": \"\"+width+\"px\"});\r \r //img.setStyles({\"width\": \"\"+width+\"px\", \"height\": \"\"+height+\"px\"});\r //imgNode.setStyles({\"width\": \"\"+width+\"px\", \"height\": \"\"+height+\"px\"});\r \r \r // var size = img.getSize();\r // var x_y = size.x/size.y;\r //if (size.y>260){\r \r //}\r \r // var p = iconNode.getPosition(this.form.app.content);\r // var s = iconNode.getSize();\r // var size = (layout.mobile) ? {\"x\": width, \"y\": height}: imgNode.getSize();\r // var contentSize = this.form.app.content.getSize();\r // var contentScroll = (layout.mobile) ? document.body.getFirst().getScroll() : {\"x\": 0, \"y\": 0};\r // var y = p.y-size.y;\r // var x = p.x+s.x/2-size.x/2;\r //\r // if (x&lt;10) x = 10;\r // if (x+size.x>contentSize.x-10) x = contentSize.x-size.x-20;\r // if (y+size.y>contentSize.y-10) y = contentSize.y-size.y-20;\r // if (y&lt;10) y = 10;\r // y=y+contentScroll.y;\r //\r // if (layout.mobile){\r // x = 0;\r // }\r // imgNode.setStyles({\r // \"top\": \"\"+y+\"px\",\r // \"left\": \"\"+x+\"px\"\r // });\r \r \r \r // this.hideMediaOpinionNodeFun = this.hideMediaOpinionNode.bind(this);\r // this.form.node.addEvent(\"mousedown\", this.hideMediaOpinionNodeFun);\r \r e.stopPropagation();\r }.bind(this)\r });\r },\r hideMediaOpinionNode: function(){\r if (this.mediaOpinionContentNode){\r this.mediaOpinionContentNode.destroy();\r this.mediaOpinionContentNode = null;\r }\r // if (this.hideMediaOpinionNodeFun) this.form.node.removeEvent(\"click\", this.hideMediaOpinionNodeFun);\r },\r loadMediaOpinion_video: function(att, node){\r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logMediaIcon}).inject(node.getParent());\r iconNode.setStyle(\"background-image\", \"url('\"+this.form.path+this.form.options.style+\"/icon/video.png')\");\r iconNode.set(\"title\", MWF.xApplication.process.Xform.LP.mediaOpinion_video);\r },\r loadMediaOpinion_voice: function(att, node){\r // this.form.css.logMediaIcon.width = \"60px\";\r // var iconNode = new Element(\"audio\", {\r // \"styles\": this.form.css.logMediaIcon,\r // \"controls\": true,\r // \"html\": \"&lt;source src='\"+url+\"' type='audio/wav'>&lt;/source>\"\r // }).inject(node.getParent());\r \r var iconNode = new Element(\"div\", {\"styles\": this.form.css.logMediaIcon}).inject(node.getParent());\r iconNode.setStyle(\"background-image\", \"url('\"+this.form.path+this.form.options.style+\"/icon/voice.png')\");\r iconNode.set(\"title\", MWF.xApplication.process.Xform.LP.mediaOpinion_voice);\r \r iconNode.addEvents({\r \"click\": function(e){\r var url = this.getMediaOpinionUrl(att);\r \r this.audioNode = new Element(\"audio\", {\"loop\": false});\r this.audioNode.set(\"src\", url);\r this.audioNode.play();\r \r e.stopPropagation();\r }.bind(this)\r });\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Monitor.js.html":{"url":"x_component_process_Xform_Monitor.js.html","title":"x_component_process_Xform/Monitor.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Monitor.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Monitor.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.xDesktop.requireApp(\"process.Xform\", \"widget.Monitor\", null, false);\r /** @class Monitor 流程图组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var attachment = this.form.get(\"name\"); //获取组件\r * //方法2\r * var attachment = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Monitor = MWF.APPMonitor = new Class(\r /** @lends MWF.xApplication.process.Xform.Monitor# */\r {\r Extends: MWF.APP$Module,\r \r _loadUserInterface: function(){\r this.node.empty();\r \r MWF.xDesktop.requireApp(\"process.Xform\", \"widget.Monitor\", function(){\r // debugger;\r var process = (this.form.businessData.work) ? this.form.businessData.work.process : this.form.businessData.workCompleted.process;\r /**\r * @summary 流程图对象，是一个 MWF.xApplication.process.Xform.widget.Monitor 类实例\r */\r this.monitor = new MWF.xApplication.process.Xform.widget.Monitor(this.node, this.form.businessData.workLogList, process,{\r \"onPostLoad\" : function(){\r this.fireEvent(\"postLoad\");\r }.bind(this)\r });\r }.bind(this), false);\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Number.js.html":{"url":"x_component_process_Xform_Number.js.html","title":"x_component_process_Xform/Number.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Number.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Number.js MWF.xDesktop.requireApp(\"process.Xform\", \"Textfield\", null, false);\r /** @class Number 数字输入组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"name\"); //获取组件\r * //方法2\r * var field = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.Textfield\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Number = MWF.APPNumber = new Class({\r Implements: [Events],\r Extends: MWF.APPTextfield,\r iconStyle: \"numberIcon\",\r isEmpty : function(){\r return !this.getData();\r },\r getInputData: function(){\r if (this.node.getFirst()){\r var v = this.node.getElement(\"input\").get(\"value\");\r var n = v.toFloat();\r return (isNaN(n)) ? 0 : n;\r }else{\r return this._getBusinessData();\r }\r return v;\r },\r // getInputData: function(){\r // var n = this.node.getElement(\"input\").get(\"value\").toFloat();\r // if ((isNaN(n))) {this.setData('0')};\r // return (isNaN(n)) ? 0 : n;\r // },\r \r formatNumber: function(str){\r var v = str.toFloat();\r if (v){\r if (this.json.decimals &amp;&amp; (this.json.decimals!=\"*\")){\r \r var decimals = this.json.decimals.toInt();\r \r var p = Math.pow(10,decimals);\r var f_x = Math.round(v*p)/p;\r str = f_x.toString();\r \r if (decimals>0){\r var pos_decimal = str.indexOf('.');\r if (pos_decimal &lt; 0){\r pos_decimal = str.length;\r str += '.';\r }\r decimalStr = (str).substr(pos_decimal+1, (str).length);\r while (decimalStr.length &lt; decimals){\r str += '0';\r decimalStr += 0;\r }\r }\r }\r }\r return str;\r },\r \r validationFormat: function(){\r debugger;\r if( !this.node.getElement(\"input\") )return true;\r var n = this.node.getElement(\"input\").get(\"value\");\r if (isNaN(n)) {\r this.notValidationMode(MWF.xApplication.process.Xform.LP.notValidation_number);\r return false;\r }\r \r this.node.getFirst().set(\"value\", this.formatNumber(n));\r \r // var v = n.toFloat();\r // if (v){\r // if (this.json.decimals &amp;&amp; (this.json.decimals!=\"*\")){\r //\r // var decimals = this.json.decimals.toInt();\r //\r // var p = Math.pow(10,decimals);\r // var f_x = Math.round(v*p)/p;\r // var s_x = f_x.toString();\r //\r // if (decimals>0){\r // var pos_decimal = s_x.indexOf('.');\r // if (pos_decimal &lt; 0){\r // pos_decimal = s_x.length;\r // s_x += '.';\r // }\r // decimalStr = (s_x).substr(pos_decimal+1, (s_x).length);\r // while (decimalStr.length &lt; decimals){\r // s_x += '0';\r // decimalStr += 0;\r // }\r // }\r //\r // this.node.getFirst().set(\"value\", s_x);\r // }\r // }\r return true;\r },\r validationConfigItem: function(routeName, data){\r \r var flag = (data.status==\"all\") ? true: (routeName == data.decision);\r if (flag){\r var n = this.getInputData();\r var v = (data.valueType==\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v &amp;&amp; v.toString()!=='0'){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r validationConfig: function(routeName, opinion){\r if (this.json.validationConfig){\r if (this.json.validationConfig.length){\r for (var i=0; i&lt;this.json.validationConfig.length; i++) {\r var data = this.json.validationConfig[i];\r if (!this.validationConfigItem(routeName, data)) return false;\r }\r }\r return true;\r }\r return true;\r },\r \r validation: function(routeName, opinion){\r if (!this.readonly &amp;&amp; !this.json.isReadonly){\r if (!this.validationFormat()) return false;\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (!this.json.validation) return true;\r if (!this.json.validation.code) return true;\r this.currentRouteName = routeName;\r var flag = this.form.Macro.exec(this.json.validation.code, this);\r this.currentRouteName = \"\";\r if (!flag) flag = MWF.xApplication.process.Xform.LP.notValidation;\r if (flag.toString() != \"true\") {\r this.notValidationMode(flag);\r return false;\r }\r }\r return true;\r },\r \r _resetNodeEdit: function(){\r var input = new Element(\"input\", {\r \"styles\": {\r \"background\": \"transparent\",\r \"width\": \"100%\",\r \"border\": \"0px\"\r }\r });\r \r var node = new Element(\"div\", {\"styles\": {\r \"overflow\": \"hidden\",\r \"position\": \"relative\",\r \"margin-right\": \"20px\",\r \"padding-right\": \"4px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r \r this.node.destroy();\r this.node = node;\r },\r \r _loadNodeEdit: function(){\r if (!this.json.preprocessing) this._resetNodeEdit();\r var input = this.node.getFirst();\r input.set(this.json.properties);\r \r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type,\r \"events\": {\r \"click\": this.clickSelect.bind(this)\r }\r });\r if (this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon) {\r this.iconNode = new Element(\"div\", {\r \"styles\": this.form.css[this.iconStyle]\r }).inject(this.node, \"before\");\r }else if( this.form.json.nodeStyleWithhideModuleIcon ){\r this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon)\r }\r \r this.node.getFirst().addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r }.bind(this));\r \r this.node.getFirst().addEvent(\"blur\", function(){\r this.validation();\r }.bind(this));\r this.node.getFirst().addEvent(\"keyup\", function(){\r this.validationMode();\r }.bind(this));\r },\r _computeValue: function(value){\r return (this.json.defaultValue &amp;&amp; this.json.defaultValue.code) ? this.form.Macro.exec(this.json.defaultValue.code, this): (value || \"0\");\r },\r getValue: function(){\r if (this.moduleValueAG) return this.moduleValueAG;\r var value = this._getBusinessData();\r if (!value) value = this._computeValue();\r value = this.formatNumber(value);\r return value || \"0\";\r },\r __setValue: function(value){\r this._setBusinessData(value);\r if (this.node.getFirst()) this.node.getFirst().set(\"value\", value || \"0\");\r if (this.readonly || this.json.isReadonly) this.node.set(\"text\", value);\r this.moduleValueAG = null;\r return value;\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Office.js.html":{"url":"x_component_process_Xform_Office.js.html","title":"x_component_process_Xform/Office.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Office.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Office.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Office Office控件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var attachment = this.form.get(\"name\"); //获取组件\r * //方法2\r * var attachment = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Office = MWF.APPOffice = new Class(\r /** @lends MWF.xApplication.process.Xform.Office# */\r {\r \tExtends: MWF.APP$Module,\r \tisActive: false,\r options:{\r \"ProductCaption\": \"O2\",\r \"ProductKey\": \"EDCC626CB85C9A1D3E0D7BDDDC2637753C596725\",\r \"makerCaption\": \"浙江兰德纵横网络技术股份有限公司\",\r \"makerKey\": \"E138DABB4AC26C2D8E09FAE59AB3BDE87AFB9D7B\",\r \"version\": \"5.0.4.0\",\r \"clsid\": \"A64E3073-2016-4baf-A89D-FFE1FAA10EC0\",\r \"codeBase\": \"../o2_lib/officecontrol/5040/OfficeControl.cab\",\r \r \"clsid64\": \"A64E3073-2016-4baf-A89D-FFE1FAA10EE1\",\r \"codeBase64\": \"../o2_lib/officecontrol/5040/ofctnewclsid.cab\",\r \r \"pdfType\": \"PDF.NtkoDocument\",\r \"pdfVersion\": \"4.0.0.3\",\r \"pdfCodeBase\": \"../o2_lib/officecontrol/5040/ntkooledocall.cab\",\r \"pdfCodeBase64\": \"../o2_lib/officecontrol/5040/ntkooledocall64.cab\",\r \r \"files\": [\"doc\",\"docx\",\"dotx\",\"dot\",\"xls\",\"xlsx\",\"xlsm\",\"xlt\",\"xltx\",\"pptx\",\"ppt\",\"pot\",\"potx\",\"potm\",\"pdf\"],\r /**\r * @event MWF.xApplication.process.Xform.Office#queryLoad\r * @ignore\r */\r /**\r * @event MWF.xApplication.process.Xform.Office#postLoad\r * @ignore\r */\r /**\r * 点击套红按钮触发。\r * @event MWF.xApplication.process.Xform.Office#redFile\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 点击盖章按钮触发。\r * @event MWF.xApplication.process.Xform.Office#seal\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * Ntko控件执行AfterOpenFromURL事件（BeginOpenFromURL方法执行完毕之后被触发）时执行。&lt;/br>\r * 本事件可以通过this.event获取当前打开的文档对象。比如，对于一个Word文档，第二个参数是一个Word.Document对象。\r * @event MWF.xApplication.process.Xform.Office#afterOpen\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * Ntko控件执行OnDocumentOpened事件（Office文档打开完毕）时触发。&lt;br/>\r * 本事件可以通过this.event获取以下内容\r * &lt;pre>&lt;code>\r {\r url : url, //Office文档路径或者URL\r doc : doc //Office文档的自动化接口，比如，对于一个Word文档，第二个参数是一个Word.Document对象。\r }\r &lt;/pre>&lt;/code>\r * @event MWF.xApplication.process.Xform.Office#afterOpenOffice\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 在新建Office文档后触发。\r * @event MWF.xApplication.process.Xform.Office#afterCreate\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 在保存Office文档前触发。\r * @event MWF.xApplication.process.Xform.Office#beforeSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 在保存Office文档后触发。\r * @event MWF.xApplication.process.Xform.Office#afterSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 在关闭Office文档时执行。\r * @event MWF.xApplication.process.Xform.Office#afterCloseOffice\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"redFile\",\r \"afterOpen\",\r \"afterOpenOffice\",\r \"afterCreate\",\r \"seal\",\r \"beforeSave\",\r \"afterSave\",\r \"afterCloseOffice\",\r \"load\"\r ]\r },\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r this.openedAttachment = null;\r },\r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r \t\tthis.node.setStyles({\r \t\t\t\"min-height\": \"100px\"\r \t\t});\r // this.isActive = true;\r //if (Browser.name===\"ie\" || Browser.name===\"chrome\" || Browser.name===\"firefox\"){\r \t\tif (Browser.name===\"ie\"){\r this.isActive = true;\r this.file = null;\r if (!this.form.officeList) this.form.officeList=[];\r this.form.officeList.push(this);\r }\r \t},\r \t\r \t_afterLoaded: function(){\r if (!this.json.isNotLoadNow){\r this.loadOffice();\r }\r //this.fireEvent(\"load\");\r \t},\r loadOffice: function(file){\r \t if (!this.officeLoaded){\r if (!this.isActive){\r this.loadOfficeNotActive();\r }else{\r MWF.getJSON(\"../o2_lib/officecontrol/config.json\", function(json){\r this.officeConfig = json;\r }.bind(this), false);\r this.loadOfficeContorl(file);\r }\r this.officeLoaded = true;\r }else{\r if (this.officeOCX) this.officeOCX.BeginOpenFromURL(file, true, this.readonly);\r }\r },\r getProgID: function(){\r switch (this.json.officeType){\r case \"word\":\r return \"Word.Document\";\r case \"excel\":\r return \"Excel.Sheet\";\r case \"ppt\":\r return \"PowerPoint.Show\";\r }\r return \"Word.Document\"\r },\r \tdefaultParam: function(readonly){\r \t\tvar o = {\r \t\t\t\"ProductCaption\": this.json.productCaption || this.options.ProductCaption,\r \"ProductKey\": this.json.productKey || this.options.ProductKey,\r \"MakerCaption\": this.officeConfig.makerCaption || this.json.makerCaption || this.options.makerCaption,\r \"MakerKey\": this.officeConfig.makerKey || this.options.makerKey || this.options.MakerKey,\r \t\t\t\"Titlebar\": \"0\",\r \t\t\t\"Menubar\": \"0\",\r \t\t\t\"ToolBars\": (readonly) ? \"0\" : \"1\",\r \t\t\t\"Statusbar\": \"0\",\r \"IsUseUTF8URL\": \"1\",\r \"IsUseUTF8Data\": \"1\",\r \t\t\t\"BorderStyle\": (readonly) ? \"0\" : \"0\",\r \t\t\t\"IsNoCopy\": \"0\",\r \"IsResetToolbarsOnOpen\": \"1\",\r \"FileNew\": \"0\",\r \"FileOpen\": \"1\",\r \"FileClose\": \"0\",\r \"FileSave\": \"0\",\r \"FileProperties\": \"0\"\r \t\t};\r return o;\r \t},\r loadOfficeContorl: function(file){\r if (this.node.getSize().y&lt;800) this.node.setStyle(\"height\", \"800px\");\r \r if (!layout.desktop.offices) layout.desktop.offices = {};\r layout.desktop.offices[this.getOfficeObjectId()] = this;\r \r if (this.readonly){\r this.loadOfficeRead(file);\r }else if (this.json.isReadonly){\r this.readonly = true;\r this.loadOfficeRead(file);\r }else{\r if (this.json.readScript &amp;&amp; this.json.readScript.code){\r var flag = this.form.Macro.exec(this.json.readScript.code, this);\r if (flag){\r this.readonly = true;\r this.loadOfficeRead(file);\r }else{\r this.loadOfficeEdit(file);\r }\r }else{\r this.loadOfficeEdit(file);\r }\r }\r \t},\r loadOfficeSpacer: function(){\r \t\tvar size = this.node.getSize();\r \r this.officeNode = new Element(\"div#officeNode\", {\r \"styles\": this.form.css.officeAreaNode\r }).inject(this.node);\r var y = size.y-40;\r this.officeNode.setStyle(\"height\", \"\"+y+\"px\");\r \r this.form.app.addEvent(\"uncurrent\", function(){\r var display = this.officeNode.getStyle(\"display\");\r this.officeNode.store(\"officeDisplay\", display);\r this.officeNode.setStyle(\"display\", \"none\");\r \t\t}.bind(this));\r this.form.app.addEvent(\"current\", function(){\r var display = this.officeNode.retrieve(\"officeDisplay\");\r if (display) this.officeNode.setStyle(\"display\", display);\r if (this.officeOCX) this.officeOCX.Activate(true);\r }.bind(this));\r \r this.form.app.addEvent(\"queryClose\", function(){\r this.fireEvent(\"queryClose\");\r var id = this.getOfficeObjectId();\r layout.desktop.offices[id] = null;\r delete layout.desktop.offices[id];\r }.bind(this));\r \t},\r hide: function(){\r if (this.officeNode.getStyle(\"display\")!=\"none\"){\r var display = this.officeNode.getStyle(\"display\");\r this.officeNode.store(\"officeDisplay\", display);\r this.officeNode.setStyle(\"display\", \"none\");\r }\r },\r show: function(){\r if ((layout.desktop.currentApp &amp;&amp; layout.desktop.currentApp.appId===this.form.app.appId) || this.form.app.inBrowser){\r var display = this.officeNode.retrieve(\"officeDisplay\");\r if (display) this.officeNode.setStyle(\"display\", display);\r if (this.officeOCX) this.officeOCX.Activate(true);\r }\r },\r isCover: function(node){\r \r },\r \r getFormId: function(){\r var id = (!this.form.businessData.workCompleted) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r return \"form\"+this.json.id+id;\r },\r getFileName: function(){\r var ename = \"docx\";\r switch (this.json.officeType){\r case \"word\":\r ename = \"docx\";\r break;\r case \"excel\":\r ename = \"xlsx\";\r break;\r case \"ppt\":\r ename = \"pptx\";\r }\r var id = (!this.form.businessData.workCompleted) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r return \"file\"+this.json.id+id+\".\"+ename;\r },\r getOfficeObjectId: function(){\r var id = (!this.form.businessData.workCompleted) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r return \"NTKOOCX\"+this.json.id+id;\r },\r getFileInputName: function(){\r var id = (!this.form.businessData.workCompleted) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r return \"fileInput\"+this.json.id+id;\r },\r getTempleteUrl: function(){\r //return \"../x_desktop/temp/杭州城管委文件.doc\";\r if (this.json.template){\r var root = \"\";\r var flag = this.json.template.substr(0,1);\r if (flag===\"/\"){\r root = this.json.template.substr(1, this.json.template.indexOf(\"/\", 1)-1);\r }else{\r root = this.json.template.substr(0, this.json.template.indexOf(\"/\"));\r }\r if ([\"x_processplatform_assemble_surface\", \"x_portal_assemble_surface\"].indexOf(root.toLowerCase())!==-1){\r var host = MWF.Actions.getHost(root);\r return (flag===\"/\") ? host+this.json.template : host+\"/\"+this.json.template\r }\r }\r return this.json.template;\r },\r getFile: function(site){\r var file = null;\r atts = this.form.businessData.attachmentList;\r for (var i=0; i&lt;atts.length; i++){\r //if ((atts[i].name===fileName) || (atts[i].site===this.json.id)){\r //if (atts[i].site===this.json.id){\r if (atts[i].site===site){\r file = atts[i];\r break;\r }\r }\r return file\r },\r getOfficeFileUrl: function(){\r var fileName = this.getFileName();\r \r this.readSite = this.json.id;\r if (this.json.fileSite &amp;&amp; this.json.fileSite.code){\r this.readSite = this.form.Macro.exec(this.json.fileSite.code, this);\r }\r var file = this.getFile(this.readSite);\r if (!file) if (this.readSite !== this.json.id) file = this.getFile(this.json.id);\r \r if (file){\r this.file = file;\r var url = \"\";\r if (!this.form.businessData.workCompleted){\r url = this.form.workAction.action.actions.getAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(file.id));\r return this.form.workAction.action.address+url.replace(\"{workid}\", encodeURIComponent(this.form.businessData.work.id));\r }else{\r url = this.form.workAction.action.actions.getWorkcompletedAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(file.id));\r return this.form.workAction.action.address+url.replace(\"{workCompletedId}\", encodeURIComponent(this.form.businessData.workCompleted.id));\r }\r }else{\r return this.getTempleteUrl();\r }\r },\r /**\r * @summary 允许编辑Office文档\r * @example\r * this.form.get(\"fieldId\").editEnabled();\r */\r editEnabled: function(){\r try {\r this.officeOCX.ActiveDocument.Unprotect();\r }catch(e){}\r },\r /**\r * @summary 设置Office文档为只读\r * @example\r * this.form.get(\"fieldId\").docReadonly();\r */\r docReadonly: function(){\r this.protect(3);\r },\r /**\r * @summary 设置Office文档状态\r * @example\r * this.form.get(\"fieldId\").protect(1);\r * @param {Number} type 1(批注),2(填写窗体),3(只读),0(修订),-1(限制编辑样式)\r */\r protect: function(type){\r // wdAllowOnlyComments = 1 //批注\r // wdAllowOnlyFormFields = 2 //填写窗体\r // wdAllowOnlyReading = 3 //只读\r // wdAllowOnlyRevisions = 0 //修订\r // wdNoProtection = -1 //限制编辑样式\r try {\r this.officeOCX.ActiveDocument.Protect(type);\r }catch(e){}\r },\r /**\r * @summary 设置Office文档保留痕迹\r */\r startRevisions: function(){\r if (this.officeOCX &amp;&amp; (this.officeOCX.DocType==1 || this.officeOCX.DocType==6)){\r this.officeOCX.ActiveDocument.Application.UserName = layout.desktop.session.user.name;\r this.officeOCX.ActiveDocument.Application.UserInitials = layout.desktop.session.user.name;\r \r if (!this.isNew){\r this.officeOCX.ActiveDocument.TrackRevisions = true;\r this.officeOCX.ActiveDocument.showRevisions = false;\r }else{\r this.officeOCX.ActiveDocument.TrackRevisions = false;\r this.officeOCX.ActiveDocument.showRevisions = false;\r }\r this.officeOCX.ActiveDocument.Application.UserName = layout.desktop.session.user.name;\r \r if( this.officeOCX.ActiveDocument &amp;&amp; this.officeOCX.ActiveDocument.Application ){\r if(15==this.officeOCX.getOfficeVer()){//如果是OFFICE 2013则设置Options.UseLocalUserInfo属性为true,TANGER_OCX_OBJ为文档控件对象\r this.officeOCX.ActiveDocument.Application.Options.UseLocalUserInfo=true;\r this.officeOCX.WebUserName= layout.desktop.session.user.name;\r }\r }\r }\r //this.officeOCX.FullScreenMode = true;\r },\r /**\r * @summary 设置Office文档取消保留痕迹\r */\r stopRevisions: function(accept){\r this.officeOCX.ActiveDocument.TrackRevisions = false;\r this.officeOCX.ActiveDocument.showRevisions = false;\r if (accept) this.officeOCX.ActiveDocument.AcceptAllRevisions();\r },\r createMenuAction: function(id, title, img){\r var title = title || MWF.xApplication.process.Xform.LP[id];\r return new Element(\"div\", {\r \"MWFnodeid\": id,\r \"MWFnodetype\": \"MWFToolBarButton\",\r \"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+img,\r \"title\": title,\r \"MWFButtonAction\": \"menuAction\",\r \"MWFButtonText\": title\r }).inject(this.menuNode);\r },\r createMenuActionMenu: function(id, title, img){\r var title = title || MWF.xApplication.process.Xform.LP[id];\r return new Element(\"div\", {\r \"MWFnodeid\": id,\r \"MWFnodetype\": \"MWFToolBarMenu\",\r \"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+img,\r \"title\": title,\r \"MWFButtonAction\": \"menuAction\",\r \"MWFButtonText\": title\r }).inject(this.menuNode);\r },\r createMenuActionMenuItem: function(id, title, img, action){\r return new Element(\"div\", {\r \"MWFnodeid\": id,\r \"MWFnodetype\": \"MWFToolBarMenuItem\",\r \"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+img,\r \"title\": title,\r \"MWFButtonAction\": action,\r \"MWFButtonText\": title\r }).inject(this.menuNode);\r },\r menuAction: function(button){\r switch (button.buttonID){\r case \"menu_new\":\r this.officeOCX.CreateNew(this.getProgID());\r break;\r case \"menu_openfile\":\r this.officeOCX.ShowDialog(1);\r break;\r case \"menu_savefile\":\r this.officeOCX.ShowDialog(3);\r break;\r case \"revisions\":\r this.toggleRevisions(button);\r break;\r case \"menu_fullscreen\":\r this.officeOCX.FullScreenMode = true;\r break;\r case \"toolbar\":\r var text = (this.officeOCX.ToolBars) ? MWF.xApplication.process.Xform.LP.menu_toolbar_show : MWF.xApplication.process.Xform.LP.menu_toolbar_hide;\r button.setText(text);\r this.officeOCX.ToolBars = !this.officeOCX.ToolBars;\r break;\r case \"menu_preview\":\r this.officeOCX.PrintPreview();\r break;\r case \"menu_showHistory\":\r this.showHistory(button);\r break;\r case \"menu_redfile\":\r this.redFile();\r break;\r case \"menu_seal\":\r this.seal();\r break;\r case \"menu_att\":\r button.menu.clearItems();\r button._loadMenuItem(this.createMenuActionMenuItem(\"\", MWF.xApplication.process.Xform.LP.menu_file, \"109.png\", \"openFile\"));\r button._loadMenuLine();\r \r var attcs = this.json.attachmentIds.split(/,\\s*|;\\s*|，\\s*|；\\s*/g);\r attcs.each(function(att){\r this.form.businessData.attachmentList.each(function (attachement) {\r if(attachement.site===att){\r if (attachement.control.allowEdit){\r if (this.options.files.indexOf(attachement.extension.toLowerCase())!==-1){\r button._loadMenuItem(this.createMenuActionMenuItem(attachement.id, attachement.name, \"14.png\", \"openAttachment:\"+attachement.id+\":\"+att+\":\"+attachement.name));\r }\r }\r }\r }.bind(this));\r /*var attc = this.form.all[att];\r if (attc){\r attc.attachmentController.attachments.each(function(a){\r if (a.data.control.allowEdit){\r if (this.options.files.indexOf(a.data.extension.toLowerCase())!==-1){\r button._loadMenuItem(this.createMenuActionMenuItem(a.data.id, a.data.name, \"14.png\", \"openAttachment:\"+a.data.id+\":\"+att+\":\"+a.data.name));\r }\r }\r }.bind(this));\r }*/\r }.bind(this));\r }\r },\r openFile: function(bt, e, item){\r if (this.openedAttachment){\r this.save();\r this.loadOfficeEdit();\r }\r },\r openAttachment: function(id, site, name){\r if (!this.openedAttachment || this.openedAttachment.id!==id){\r this.save();\r if (this.form.businessData.workCompleted){\r MWF.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentWorkcompletedUrl(id, this.form.businessData.workCompleted.id, function(url){\r this.openedAttachment = {\"id\": id, \"site\": site, \"name\": name};\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly || this.json.isAttReadonly );\r }.bind(this));\r }else{\r MWF.Actions.get(\"x_processplatform_assemble_surface\").getAttachmentUrl(id, this.form.businessData.work.id, function(url){\r this.openedAttachment = {\"id\": id, \"site\": site, \"name\": name};\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly || this.json.isAttReadonly);\r }.bind(this));\r }\r }\r },\r loadMenu: function(){\r if (!this.isMenuLoad){\r if (this.json.menuEditButtons &amp;&amp; this.json.menuEditButtons.length){\r this.menuNode = new Element(\"div\", {\"styles\": this.form.css.officeMenuNode}).inject(this.node, \"top\");\r MWF.require(\"MWF.widget.Toolbar\", function(){\r this.toolbarWidget = new MWF.widget.Toolbar(this.menuNode, {\"style\": \"xform_blue_simple\"}, this);\r \r if (this.json.menuEditButtons.indexOf(\"new\")!==-1){\r this.newItem = this.createMenuAction(\"menu_new\", \"\", \"99.png\");\r }\r \r if (this.json.menuEditButtons.indexOf(\"open\")!==-1){\r this.openItem = this.createMenuAction(\"menu_openfile\", \"\", \"77.png\");\r }\r \r if (this.json.menuEditButtons.indexOf(\"save\")!==-1){\r this.saveItem = this.createMenuAction(\"menu_savefile\", \"\", \"67.png\");\r }\r \r if (this.json.menuEditButtons.indexOf(\"revisions\")!==-1){\r var text = MWF.xApplication.process.Xform.LP.menu_revisions_show;\r try {\r if (this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup !== 0){\r text = MWF.xApplication.process.Xform.LP.menu_revisions_hide;\r }\r }catch(e){}\r \r this.revisionsItem = this.createMenuAction(\"revisions\", text, \"76.png\");\r }\r if (this.json.menuEditButtons.indexOf(\"fullscreen\")!==-1){\r this.fullscreenItem = this.createMenuAction(\"menu_fullscreen\", \"\", \"4.png\");\r }\r if (this.json.menuEditButtons.indexOf(\"toolbar\")!==-1){\r if (!this.readonly){\r var text = MWF.xApplication.process.Xform.LP.menu_toolbar_show;\r if (this.officeOCX.ToolBars){\r text = MWF.xApplication.process.Xform.LP.menu_toolbar_hide;\r }\r this.toolbarItem = this.createMenuAction(\"toolbar\", text, \"91.png\");\r }\r \r }\r if (this.json.menuEditButtons.indexOf(\"preview\")!==-1){\r this.fullscreenItem = this.createMenuAction(\"menu_preview\", \"\", \"21.png\");\r }\r if (this.json.menuEditButtons.indexOf(\"showHistory\")!==-1){\r atts = this.form.businessData.attachmentList;\r if (atts.some(function(att){\r return att.site == this.json.id+\"history\";\r }.bind(this))){\r \r this.historyItem = this.createMenuAction(\"menu_showHistory\", \"\", \"115.png\");\r }\r }\r if (this.json.menuEditButtons.indexOf(\"redfile\")!==-1){\r if (!this.readonly) this.redItem = this.createMenuAction(\"menu_redfile\", \"\", \"12.png\");\r }\r if (this.json.menuEditButtons.indexOf(\"seal\")!==-1){\r if (!this.readonly) this.sealItem = this.createMenuAction(\"menu_seal\", \"\", \"84.png\");\r }\r \r if (this.json.isOpenAttachment){\r if (this.json.attachmentIds){\r this.sealItem = this.createMenuActionMenu(\"menu_att\", \"\", \"14.png\");\r }\r }\r \r this.toolbarWidget.load();\r \r }.bind(this));\r \r }\r this.isMenuLoad = true;\r }\r },\r showHistory: function(button){\r if (this.historyItem.get(\"text\") == MWF.xApplication.process.Xform.LP.menu_hideHistory){\r var url = this.getOfficeFileUrl();\r if (url){\r var id = this.getOfficeObjectId();\r this.addOfficeEvent(id, \"OnDocumentOpened(url, doc)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].OnDocumentOpened(url, doc);\");\r this.addOfficeEvent(id, \"AfterOpenFromURL(doc, statusCode)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].AfterOpenFromURL(doc, statusCode);\");\r \r button.setText(MWF.xApplication.process.Xform.LP.menu_showHistory);\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r this.historyMode = false;\r }\r }else{\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var width = 680;\r var height = 500;\r var p = MWF.getCenterPosition(this.form.app.content, width, height);\r \r var _self = this;\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": MWF.xApplication.process.Xform.LP.menu_showHistory,\r //\"style\": \"work\",\r \"style\" : this.form.json.dialogStyle || \"user\",\r \"top\": p.y-100,\r \"left\": p.x,\r \"fromTop\": p.y-100,\r \"fromLeft\": p.x,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div>&lt;/div>\",\r \"container\": this.form.app.content,\r \"isClose\": true,\r \"buttonList\": [\r {\r \"text\": MWF.xApplication.process.Xform.LP.close,\r \"action\": function(){this.close();}\r }\r ],\r \"onPostShow\": function(){\r this.showHistoryContent(dlg, button)\r }.bind(this)\r });\r dlg.show();\r }.bind(this));\r }\r },\r showHistoryContent: function(dlg, button){\r dlg.content.setStyle(\"overflow\", \"auto\");\r atts = this.form.businessData.attachmentList;\r var site = this.json.id+\"history\";\r for (var i=0; i&lt;atts.length; i++){\r if ((atts[i].site===site)){\r //for (var x=0; x&lt;31; x++){\r file = atts[i];\r var div = new Element(\"div\", {\r \"styles\": {\r \"margin\": \"20px auto 0px auto\",\r \"height\": \"30px\",\r \"line-height\": \"30px\",\r \"width\": \"80%\",\r \"font-size\": \"16px\",\r \"color\": \"#666666\",\r \"border-bottom\": \"1px solid #CCCCCC\"\r },\r \"value\": file.id\r }).inject(dlg.content);\r var fileNameNode = new Element(\"div\", {\r \"styles\": {\"float\": \"left\"},\r \"text\": file.name\r }).inject(div);\r var buttonNode = new Element(\"input\", {\r \"type\": \"button\",\r \"styles\": {\"float\": \"right\"},\r \"value\": \"查看版本\",\r \"events\": {\r \"click\": function(e){\r this.openOfficeHistory(e, dlg, button);\r }.bind(this)\r }\r }).inject(div);\r //}\r }\r }\r },\r openOfficeHistory: function(e, dlg, button){\r var fileName = e.target.getParent().get(\"value\");\r if (!this.form.businessData.workCompleted){\r url = this.form.workAction.action.actions.getAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(fileName));\r url = this.form.workAction.action.address+url.replace(\"{workid}\", encodeURIComponent(this.form.businessData.work.id));\r }else{\r url = this.form.workAction.action.actions.getWorkcompletedAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(fileName));\r url = this.form.workAction.action.address+url.replace(\"{workCompletedId}\", encodeURIComponent(this.form.businessData.workCompleted.id));\r }\r dlg.close();\r this.save();\r \r this.officeOCX.BeginOpenFromURL(url, true, true);\r this.historyMode = true;\r \r if (button){\r button.setText(MWF.xApplication.process.Xform.LP.menu_hideHistory)\r }\r },\r /**\r * @summary 盖章\r */\r seal: function(){\r this.fireEvent(\"seal\");\r },\r /**\r * @summary 套红\r */\r redFile: function(){\r // try {\r if (this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter){\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup = 0;\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.View = 0;\r }\r \r this.officeOCX.ActiveDocument.showRevisions = false;\r this.stopRevisions(true);\r \r this.fireEvent(\"redFile\");\r // this.officeOCX.ActiveDocument.Application.Selection.WholeStory();\r // this.officeOCX.ActiveDocument.Application.Selection.Font.Name = \"仿宋\";\r // this.officeOCX.ActiveDocument.Application.Selection.Font.Size = 14;\r // this.officeOCX.ActiveDocument.Application.Selection.Cut();\r //\r // this.officeOCX.OpenFromUrl(\"../x_desktop/temp/1.doc\", false);\r //\r // var mark = this.officeOCX.ActiveDocument.Bookmarks(\"bodyCw\");\r //\r // mark.Range.PasteSpecial(false, false, 0, false, 2);\r //mark.Range.Paste();\r // }catch(e){\r // throw e;\r // }\r },\r /**\r * @summary 显示痕迹\r */\r showRevisions: function(){\r try {\r if (this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter) {\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup = 2;\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.View = 0;\r }\r this.officeOCX.ActiveDocument.showRevisions = true;\r }catch(e){}\r },\r /**\r * @summary 隐藏痕迹\r */\r hideRevisions: function(){\r try {\r if (this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter) {\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup = 0;\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.View = 0;\r }\r this.officeOCX.ActiveDocument.showRevisions = false;\r }catch(e){}\r },\r toggleRevisions: function(button){\r var t = this.revisionsItem.get(\"text\");\r if (t===MWF.xApplication.process.Xform.LP.menu_revisions_show){\r button.setText(MWF.xApplication.process.Xform.LP.menu_revisions_hide);\r \r try {\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup = 2;\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.View = 0;\r }catch(e){}\r try {\r this.officeOCX.ActiveDocument.showRevisions = true;\r }catch(e){}\r }else{\r button.setText(MWF.xApplication.process.Xform.LP.menu_revisions_show);\r \r try {\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.Markup = 0;\r this.officeOCX.ActiveDocument.ActiveWindow.View.RevisionsFilter.View = 0;\r }catch(e){}\r try {\r this.officeOCX.ActiveDocument.showRevisions = false;\r }catch(e){}\r }\r },\r afterOpen: function(){\r // this.officeOCX.AddCustomButtonOnMenu(0,\"按钮0\",false);\r // this.officeOCX.AddCustomButtonOnMenu(1,\"按钮1\",true,1);\r // this.officeOCX.AddCustomButtonOnMenu(2,\"按钮2\",true,2);\r // this.officeOCX.AddCustomButtonOnMenu(3,\"按钮3\",false,3);\r //\r //\r // this.officeOCX.AddCustomToolButton(\"预览(0)\", 10);\r //\r // alert(111);\r \r if (this.readonly) this.docReadonly();\r if (this.json.trackRevisions===\"1\") this.startRevisions();\r \r var scale = (this.readonly) ? this.json.readScale : this.json.editScale;\r if (scale) scale = scale.toInt();\r if (scale){\r this.officeOCX.ActiveDocument.ActiveWindow.ActivePane.View.Zoom.Percentage = scale;\r }\r \r var display = this.officeNode.getStyle(\"display\");\r //window.setTimeout(function(){\r this.officeOCX.Activate(false);\r this.officeNode.setStyle(\"display\", \"none\");\r window.setTimeout(function(){\r this.officeNode.setStyle(\"display\", display);\r this.officeOCX.Activate(true);\r }.bind(this), 10);\r //}.bind(this), 10);\r \r \r //if (this.officeOCX) this.officeOCX.Activate(true);\r \r // this.officeNode.scrollIntoView();\r // this.form.app.node.scrollTo(0);\r \r },\r \r loadOfficeEditFirefox: function(file){\r if (!this.officeOCX){\r this.loadOfficeSpacer();\r this.node.setStyle(\"pisition\", \"absolute\");\r \r var codeBase = this.json.codeBase || this.options.codeBase;\r var version = this.json.version || this.options.version;\r var classid = this.json.clsid || this.options.clsid;\r \r var objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id='\"+this.getOfficeObjectId()+\"' \" +\r \"type='application/ntko-plug' \" +\r \"style='HEIGHT: 99%; WIDTH: 100%' \" +\r \"height='99%' width='100%' \" +\r \"codeBase='\"+codeBase+\"#version=\"+version+\"' \" +\r \"classid='{\"+classid+\"}' \";\r \r objectHtml += \"ForOnSaveToURL='OnComplete2' \";\r objectHtml += \"ForOnBeginOpenFromURL='OnComplete' \";\r objectHtml += \"ForOndocumentopened='OnComplete3' \";\r objectHtml += \"ForOnpublishAshtmltourl='publishashtml' \";\r \r var pars = this.defaultParam();\r pars = Object.merge(pars, this.json.ntkoEditProperties);\r pars = Object.merge(pars, this.json.editProperties);\r \r Object.each(pars, function(p, key){\r objectHtml += \"_\"+key+\"='\"+p+\"'\";\r });\r objectHtml += \">\";\r objectHtml += \"&lt;SPAN STYLE='color:red'>尚未安装NTKO Web Chrome跨浏览器插件。请点击&lt;a href=\\\"../o2_lib/officecontrol/ntkoplugins.xpi\\\">安装组件&lt;/a>&lt;/SPAN>\";\r \r objectHtml += \"&lt;/OBJECT>&lt;input type='hidden' value='\"+this.json.id+\"' name='site'>&lt;input style='display:none' name=\\\"file\\\" type=\\\"file\\\"/>&lt;/form>\";\r this.officeNode.appendHTML(objectHtml);\r this.officeForm = this.officeNode.getFirst();\r this.officeOCX = this.officeNode.getFirst().getFirst();\r \r this.doOfficeOCXEvents();\r }\r \r var url = this.getOfficeFileUrl();\r if (url){\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }else{\r this.officeOCX.CreateNew(this.getProgID());\r this.fireEvent(\"afterCreate\");\r }\r },\r loadOfficeEditChrome: function(file){\r if (!this.officeOCX){\r this.loadOfficeSpacer();\r this.node.setStyle(\"pisition\", \"absolute\");\r \r var codeBase = this.officeConfig.codeBase || this.json.codeBase || this.options.codeBase;\r var version = this.officeConfig.version || this.json.version || this.options.version;\r var classid = this.officeConfig.classid || this.json.clsid || this.options.clsid;\r var codeBase64 = this.officeConfig.codeBase64 || this.json.codeBase64 || this.options.codeBase64;\r var classid64 = this.officeConfig.classid64 || this.json.clsid64 || this.options.clsid64;\r var pdfType = this.officeConfig.pdfType || this.json.pdfType || this.options.pdfType;\r var pdfVersion = this.officeConfig.pdfVersion || this.json.pdfVersion || this.options.pdfVersion;\r var pdfCodeBase = this.officeConfig.pdfCodeBase || this.json.pdfCodeBase || this.options.pdfCodeBase;\r var pdfCodeBase64 = this.officeConfig.pdfCodeBase64 || this.json.pdfCodeBase64 || this.options.pdfCodeBase64;\r \r var objectHtml = \"\";\r \r if(window.navigator.platform==\"Win64\"){\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id='\"+this.getOfficeObjectId()+\"' \" +\r \"style='HEIGHT: 99%; WIDTH: 100%' \" +\r \"codeBase='\"+codeBase64+\"#version=\"+version+\"' \" +\r \"classid='{\"+classid64+\"}'>\";\r }else{\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id='\"+this.getOfficeObjectId()+\"' \" +\r \"style='HEIGHT: 99%; WIDTH: 100%' \" +\r \"codeBase='\"+codeBase+\"#version=\"+version+\"' \" +\r \"classid='{\"+classid+\"}'\";\r }\r \r objectHtml += \"ForOnSaveToURL='OnComplete2' \";\r objectHtml += \"ForOnBeginOpenFromURL='OnComplete' \";\r objectHtml += \"ForOndocumentopened='OnComplete3' \";\r objectHtml += \"ForOnpublishAshtmltourl='publishashtml' \";\r \r var pars = this.defaultParam();\r pars = Object.merge(pars, this.json.ntkoEditProperties);\r pars = Object.merge(pars, this.json.editProperties);\r \r Object.each(pars, function(p, key){\r objectHtml += \"_\"+key+\"='\"+p+\"'\";\r });\r objectHtml += \">\";\r objectHtml += \"&lt;SPAN STYLE='color:red'>尚未安装NTKO Web Chrome跨浏览器插件。请点击&lt;a href=\\\"../o2_lib/officecontrol/ntkoplugins.crx\\\">安装组件&lt;/a>&lt;/SPAN>\";\r \r objectHtml += \"&lt;/OBJECT>&lt;input type='hidden' value='\"+this.json.id+\"' name='site'>&lt;input style='display:none' name=\\\"file\\\" type=\\\"file\\\"/>&lt;/form>\";\r this.officeNode.appendHTML(objectHtml);\r this.officeForm = this.officeNode.getFirst();\r this.officeOCX = this.officeNode.getFirst().getFirst();\r \r if(window.navigator.platform==\"Win64\"){\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase64,51,true);\r }else{\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase,51,true);\r }\r \r //this.doOfficeOCXEvents();\r }\r \r var url = this.getOfficeFileUrl();\r if (url){\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }else{\r this.officeOCX.CreateNew(this.getProgID());\r this.fireEvent(\"afterCreate\");\r }\r },\r loadOfficeEdit: function(file){\r if (Browser.name===\"chrome\"){\r this.loadOfficeEditChrome(file);\r }else if (Browser.name===\"firefox\") {\r this.loadOfficeEditFirefox(file);\r }else{\r this.loadOfficeEditIE(file);\r }\r this.openedAttachment = null\r },\r getAutoSavedAttachments: function(){\r this.autoSavedAttachments = [];\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===this.json.id+\"autosave\") this.autoSavedAttachments.push(att);\r }.bind(this));\r },\r loadOfficeEditIE: function(file){\r if (!this.officeOCX){\r this.loadOfficeSpacer();\r //this.loadMenu();\r this.node.setStyle(\"pisition\", \"absolute\");\r \r var codeBase = this.officeConfig.codeBase || this.json.codeBase || this.options.codeBase;\r var version = this.officeConfig.version || this.json.version || this.options.version;\r var classid = this.officeConfig.classid || this.json.clsid || this.options.clsid;\r var codeBase64 = this.officeConfig.codeBase64 || this.json.codeBase64 || this.options.codeBase64;\r var classid64 = this.officeConfig.classid64 || this.json.clsid64 || this.options.clsid64;\r var pdfType = this.officeConfig.pdfType || this.json.pdfType || this.options.pdfType;\r var pdfVersion = this.officeConfig.pdfVersion || this.json.pdfVersion || this.options.pdfVersion;\r var pdfCodeBase = this.officeConfig.pdfCodeBase || this.json.pdfCodeBase || this.options.pdfCodeBase;\r var pdfCodeBase64 = this.officeConfig.pdfCodeBase64 || this.json.pdfCodeBase64 || this.options.pdfCodeBase64;\r \r var objectHtml = \"\";\r \r if(window.navigator.platform==\"Win64\"){\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id=\\\"\"+this.getOfficeObjectId()+\"\\\" \" +\r \"style=\\\"HEIGHT: 99%; WIDTH: 100%\\\" \" +\r \"codeBase=\\\"\"+codeBase64+\"#version=\"+version+\"\\\" \" +\r \"classid=\\\"clsid:\"+classid64+\"\\\">\";\r }else{\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id=\\\"\"+this.getOfficeObjectId()+\"\\\" \" +\r \"style=\\\"HEIGHT: 99%; WIDTH: 100%\\\" \" +\r \"codeBase=\\\"\"+codeBase+\"#version=\"+version+\"\\\" \" +\r \"classid=\\\"clsid:\"+classid+\"\\\">\";\r }\r \r var pars = this.defaultParam();\r pars = Object.merge(pars, this.json.ntkoEditProperties);\r pars = Object.merge(pars, this.json.editProperties);\r \r Object.each(pars, function(p, key){\r objectHtml += \"&lt;PARAM NAME=\\\"\"+key+\"\\\" value=\\\"\"+p+\"\\\">\";\r });\r \r //objectHtml += \"&lt;div style=\\\"color:red; position:relative; top:-800px; background:#eeeeee; height:760px; padding:20px; text-align:center; font-size:18px; cursor: pointer \\\">如果不能自动安装控件，请将在点击此处下载并安装签章客户端。&lt;/div>\";\r objectHtml += \"&lt;/OBJECT>&lt;input type='hidden' value='\"+this.json.id+\"' name='site'>&lt;input type='hidden' value='' name='fileName'>&lt;input style='display:none' name=\\\"file\\\" type=\\\"file\\\"/>&lt;/form>\";\r this.officeNode.appendHTML(objectHtml);\r this.officeForm = this.officeNode.getFirst();\r this.officeOCX = this.officeNode.getFirst().getFirst();\r \r if(window.navigator.platform==\"Win64\"){\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase64,51,true);\r }else{\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase,51,true);\r }\r \r //TANGER_OCX_OBJ.CreateNew(\"word.document\");\r \r //this.officeOCX.AddDocTypePlugin(\".pdf\",\"PDF.NtkoDocument\",\"4.0.0.7\",\"../x_desktop/res/framework/officecontrol/ntkooledocall.cab\",51,true);\r \r this.doOfficeOCXEvents();\r }\r \r this.getAutoSavedAttachments();\r if (this.autoSavedAttachments &amp;&amp; this.autoSavedAttachments.length){\r this.openRecoverAutoSaveDlg();\r }else{\r this.openOfficeFile(file);\r }\r },\r openOfficeFile: function(file){\r var url = file || this.getOfficeFileUrl();\r if (url){\r //layout.desktop.tmpOffice = this;\r this.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }else{\r this.isNew = true;\r this.officeOCX.CreateNew(this.getProgID());\r this.fireEvent(\"afterCreate\");\r }\r \r //begin auto save\r if (this.json.isAutoSave){\r if (!this.autoSaveTimerID){\r this.autoSave();\r this.form.app.addEvent(\"queryClose\", function(){\r if (this.autoSaveTimerID) window.clearInterval(this.autoSaveTimerID);\r }.bind(this));\r }\r }\r },\r \r clearAutoSaveAttachments: function(){\r this.form.businessData.attachmentList.each(function(att){\r if (att.site===this.json.id+\"autosave\") o2.Actions.get(\"x_processplatform_assemble_surface\").deleteAttachment(att.id, this.form.businessData.work.id);\r }.bind(this));\r this.autoSavedAttachments = [];\r },\r getRecoverItems: function(recoverItemNode){\r var css = this.form.css;\r var _self = this;\r this.autoSavedAttachments.each(function(att){\r var node = new Element(\"div\", {\"styles\": css.officeRecoverItemNode}).inject(recoverItemNode);\r var actionNode = new Element(\"div\", {\"styles\": css.officeRecoverItemActionNode}).inject(node);\r var titleNode = new Element(\"div\", {\"styles\": css.officeRecoverItemTitleNode, \"text\": att.name}).inject(node);\r node.store(\"att\", att);\r \r actionNode.addEvent(\"click\", function(e){\r var n = this.getParent();\r var att = n.retrieve(\"att\");\r _self.form.workAction.getAttachmentData(att.id, _self.form.businessData.work.id);\r e.stopPropagation();\r });\r node.addEvents({\r \"mouseover\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(css.officeRecoverItemNode_over);\r },\r \"mouseout\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(css.officeRecoverItemNode)\r },\r \"click\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (isSelected){\r this.setStyles(css.officeRecoverItemNode);\r this.getFirst().setStyles(css.officeRecoverItemActionNode);\r this.store(\"isSelected\", false);\r }else{\r var items = recoverItemNode.getChildren();\r items.each(function(item){\r item.setStyles(css.officeRecoverItemNode);\r item.getFirst().setStyles(css.officeRecoverItemActionNode);\r item.store(\"isSelected\", false);\r });\r this.setStyles(css.officeRecoverItemNode_current);\r this.getFirst().setStyles(css.officeRecoverItemActionNode_current);\r this.store(\"isSelected\", true);\r }\r }\r });\r \r }.bind(this));\r },\r openRecoverAutoSaveDlg: function(){\r var node = new Element(\"div\", {\"styles\": {\"overflow\": \"hidden\", \"padding\": \"0 30px\"}});\r var html = \"&lt;div style=\\\"line-height: 30px; height: 30px; color: #333333; overflow: hidden\\\">请选择要恢复的正文版本：&lt;/div>\";\r html += \"&lt;div style=\\\"max-height: 300px; margin-bottom:10px; margin-top:10px; overflow-y:auto;\\\">&lt;/div>\";\r node.set(\"html\", html);\r var recoverItemNode = node.getLast();\r this.getRecoverItems(recoverItemNode);\r node.inject(this.form.app.content);\r \r var _self = this;\r var dlg = o2.DL.open({\r \"title\": \"恢复正文\",\r //\"style\": \"work\",\r \"isResize\": false,\r \"content\": node,\r \"width\": 600,\r \"onPostClose\": function(){\r _self.clearAutoSaveAttachments();\r },\r \"buttonList\": [\r {\r \"text\": MWF.xApplication.process.Xform.LP.recover,\r \"action\": function(d, e){\r this.doRecoverFile(node, e, dlg);\r }.bind(this)\r },\r {\r \"text\": MWF.xApplication.process.Xform.LP.notRecover,\r \"action\": function(d, e){\r this.doNotRecoverFile(node, e, dlg);\r }.bind(this)\r }\r ]\r });\r },\r doNotRecoverFile: function(node, e, dlg){\r var _self = this;\r this.form.app.confirm(\"infor\", e, this.form.app.lp.notRecoverFileConfirmTitle, this.form.app.lp.notRecoverFileConfirmContent, 450, 120, function(){\r this.close();\r dlg.close();\r _self.openOfficeFile();\r }, function(){\r this.close();\r }, null, null, this.form.json.confirmStyle);\r },\r \r doRecoverFile: function(node, e, dlg){\r var recoverItemNode = node.getLast();\r var items = recoverItemNode.getChildren();\r var _self = this;\r for (var i=0; i&lt;items.length; i++){\r if (items[i].retrieve(\"isSelected\")){\r var text = this.form.app.lp.recoverFileConfirmContent;\r var att = items[i].retrieve(\"att\");\r text = text.replace(\"{att}\", att.name);\r this.form.app.confirm(\"infor\", e, this.form.app.lp.recoverFileConfirmTitle, text, 450, 120, function(){\r this.close();\r dlg.close();\r _self.form.workAction.getAttachmentUrl(att.id, _self.form.businessData.work.id, function(file){\r _self.openOfficeFile(file);\r dlg.close();\r });\r }, function(){\r this.close();\r }, null, null, this.form.json.confirmStyle);\r break;\r }\r }\r },\r checkAutoSaveNumber: function(callback){\r if (!this.autoSavedAttachments) this.autoSavedAttachments = [];\r if (!this.json.autoSaveNumber) this.json.autoSaveNumber = 3;\r if (this.autoSavedAttachments.length >= this.json.autoSaveNumber.toInt()){\r //delete first att\r var att = this.autoSavedAttachments.shift();\r o2.Actions.get(\"x_processplatform_assemble_surface\").deleteAttachment(att.id, this.form.businessData.work.id, function(){\r this.checkAutoSaveNumber(callback);\r }.bind(this));\r }else{\r if (callback) callback();\r }\r },\r getAutoSaveFileName: function(){\r var ename = \"docx\";\r switch (this.json.officeType){\r case \"word\":\r ename = \"docx\";\r break;\r case \"excel\":\r ename = \"xlsx\";\r break;\r case \"ppt\":\r ename = \"pptx\";\r }\r var d = Date.parse(new Date());\r var dText = d.format(\"%Y-%m-%d %H:%M:%S\");\r return MWF.xApplication.process.Xform.LP.autosave+\"(\"+dText+\").\"+ename;\r },\r autoSave: function(){\r var interval = (this.json.autoSaveTime) ? this.json.autoSaveTime.toInt()*60*1000 : (5*60*1000);\r this.autoSaveTimerID = window.setInterval(function(){\r if (!this.openedAttachment){\r this.checkAutoSaveNumber(function(){\r try{\r var fileName = this.getAutoSaveFileName();\r this.officeForm.getElement(\"input\").set(\"value\", this.json.id+\"autosave\");\r url = this.form.workAction.action.actions.uploadAttachment.uri;\r url = this.form.workAction.action.address+url.replace(\"{id}\", this.form.businessData.work.id);\r this.officeOCX.SaveToURL(url, \"file\", \"\", fileName, this.getFormId());\r \r this.form.workAction.listAttachments(this.form.businessData.work.id, function(json){\r this.form.businessData.attachmentList = json.data;\r for (var i=0; i&lt;json.data.length; i++){\r var att = json.data[i];\r if (att.name===fileName){\r this.autoSavedAttachments.push(att);\r break;\r }\r }\r }.bind(this), null, false);\r }catch(e){}\r }.bind(this));\r }\r }.bind(this), interval);\r \r },\r doOfficeOCXEvents: function(){\r var id = this.getOfficeObjectId();\r this.addOfficeEvent(id, \"AfterOpenFromURL(doc, statusCode)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].AfterOpenFromURL(doc, statusCode);\");\r this.addOfficeEvent(id, \"OnDocumentOpened(url, doc)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].OnDocumentOpened(url, doc);\");\r this.addOfficeEvent(id, \"OnDocumentClosed()\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].OnDocumentClosed();\");\r },\r OnDocumentClosed: function(){\r this.fireEvent(\"afterCloseOffice\");\r },\r OnDocumentOpened: function(url, doc){\r this.afterOpen();\r this.loadMenu();\r \r this.fireEvent(\"afterOpenOffice\", {\r url : url,\r doc : doc\r });\r },\r AfterOpenFromURL: function(doc, statusCode){\r this.fireEvent(\"afterOpen\", [doc, statusCode]);\r },\r addOfficeEvent: function(id, event, code){\r var script = document.createElement(\"script\");\r script.setAttribute(\"for\", id);\r script.setAttribute(\"event\", event);\r script.innerText = code;\r this.officeForm.appendChild(script);\r },\r \r loadOfficeRead: function(file){\r this.loadOfficeSpacer();\r this.node.setStyle(\"pisition\", \"absolute\");\r \r // var codeBase = this.json.codeBase || this.options.codeBase;\r // var version = this.json.version || this.options.version;\r // var classid = this.json.clsid || this.options.clsid;\r var codeBase = this.officeConfig.codeBase || this.json.codeBase || this.options.codeBase;\r var version = this.officeConfig.version || this.json.version || this.options.version;\r var classid = this.officeConfig.classid || this.json.clsid || this.options.clsid;\r var codeBase64 = this.officeConfig.codeBase64 || this.json.codeBase64 || this.options.codeBase64;\r var classid64 = this.officeConfig.classid64 || this.json.clsid64 || this.options.clsid64;\r var pdfType = this.officeConfig.pdfType || this.json.pdfType || this.options.pdfType;\r var pdfVersion = this.officeConfig.pdfVersion || this.json.pdfVersion || this.options.pdfVersion;\r var pdfCodeBase = this.officeConfig.pdfCodeBase || this.json.pdfCodeBase || this.options.pdfCodeBase;\r var pdfCodeBase64 = this.officeConfig.pdfCodeBase64 || this.json.pdfCodeBase64 || this.options.pdfCodeBase64;\r \r // var objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id=\\\"\"+this.getOfficeObjectId()+\"\\\"\"+\r // \"style=\\\"HEIGHT: 99%; WIDTH: 100%\\\" \" +\r // \"codeBase=\\\"\"+codeBase+\"#version=\"+version+\"\\\" \" +\r // \"classid=\\\"clsid:\"+classid+\"\\\">\";\r var objectHtml = \"\";\r if(window.navigator.platform==\"Win64\"){\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id=\\\"\"+this.getOfficeObjectId()+\"\\\" \" +\r \"style=\\\"HEIGHT: 99%; WIDTH: 100%\\\" \" +\r \"codeBase=\\\"\"+codeBase64+\"#version=\"+version+\"\\\" \" +\r \"classid=\\\"clsid:\"+classid64+\"\\\">\";\r }else{\r objectHtml = \"&lt;form id='\"+this.getFormId()+\"' style='height:100%'>&lt;OBJECT id=\\\"\"+this.getOfficeObjectId()+\"\\\" \" +\r \"style=\\\"HEIGHT: 99%; WIDTH: 100%\\\" \" +\r \"codeBase=\\\"\"+codeBase+\"#version=\"+version+\"\\\" \" +\r \"classid=\\\"clsid:\"+classid+\"\\\">\";\r }\r \r var pars = this.defaultParam(true);\r pars = Object.merge(pars, this.json.ntkoReadProperties);\r pars = Object.merge(pars, this.json.readProperties);\r Object.each(pars, function(p, key){\r objectHtml += \"&lt;PARAM NAME=\\\"\"+key+\"\\\" value=\\\"\"+p+\"\\\">\";\r });\r objectHtml += \"&lt;/object>&lt;/form>\";\r \r this.officeNode.set(\"html\", objectHtml);\r this.officeForm = this.officeNode.getFirst();\r /**\r @summary Ntko Office 控件对象, 第三方控件\r @see {@link http://ieoffice.ntko.com/pro/show/mid/1_8/pid/2731|NTKO官网 }\r @example\r var officeOCX = this.form.get(\"fieldId\").officeOCX;\r var activeDocument = officeOCX.ActiveDocument //返回一个Office Document 对象，该对象代表活动文档。\r */\r this.officeOCX = this.officeNode.getFirst().getFirst();\r \r if(window.navigator.platform==\"Win64\"){\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase64,51,true);\r }else{\r this.officeOCX.AddDocTypePlugin(\".pdf\",pdfType,pdfVersion,pdfCodeBase,51,true);\r }\r //this.officeOCX.AddDocTypePlugin(\".pdf\",\"PDF.NtkoDocument\",\"4.0.0.3\",\"../x_desktop/res/framework/officecontrol/ntkooledocall.cab\",51,true);\r \r var url = file || this.getOfficeFileUrl();\r if (url){\r var id = this.getOfficeObjectId();\r this.addOfficeEvent(id, \"OnDocumentOpened(url, doc)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].OnDocumentOpened(url, doc);\");\r this.addOfficeEvent(id, \"AfterOpenFromURL(doc, statusCode)\", \"if (layout.desktop.offices[\\\"\"+id+\"\\\"]) layout.desktop.offices[\\\"\"+id+\"\\\"].AfterOpenFromURL(doc, statusCode);\");\r \r this.officeOCX.BeginOpenFromURL(url, true, this.readonly);\r }\r },\r createUploadFileNode: function(){\r this.uploadFileAreaNode = new Element(\"div\", {\"styles\": {\"display\": \"none\"}});\r var html = \"&lt;input name=\\\"file\\\" type=\\\"file\\\"/>\";\r this.uploadFileAreaNode.set(\"html\", html);\r this.fileUploadNode = this.uploadFileAreaNode.getFirst();\r this.uploadFileAreaNode.inject(this.officeForm);\r },\r isEmpty : function(){\r var data = this.getData();\r return !data.trim();\r },\r getData: function(){\r if (this.officeOCX &amp;&amp; (this.officeOCX.DocType==1 || this.officeOCX.DocType==6)){\r this.officeOCX.ActiveDocument.Application.Selection.WholeStory();\r var content = this.officeOCX.ActiveDocument.Application.Selection.Text;\r return content;\r }else{\r return this._getBusinessData();\r }\r },\r setData: function(){},\r /**\r * @summary 保存Office文档到后台\r * @param {Boolean} history - 是否生产保留痕迹文件\r */\r save: function(history){\r //if (!this.uploadFileAreaNode) this.createUploadFileNode();\r if (!this.readonly){\r if (this.historyMode) return true;\r if (!this.officeForm) return true;\r \r this.fireEvent(\"beforeSave\");\r try{\r if (this.openedAttachment){\r this.officeForm.getElement(\"input\").set(\"value\", this.openedAttachment.site);\r \r url = this.form.workAction.action.actions.replaceAttachment.uri;\r url = url.replace(\"{id}\", this.openedAttachment.id);\r url = this.form.workAction.action.address+url.replace(\"{workid}\", this.form.businessData.work.id);\r \r this.officeOCX.SaveToURL(url, \"file\", \"\", this.openedAttachment.name, this.getFormId());\r \r }else{\r if (history){\r if (this.json.isHistory) this.saveHistory();\r }\r \r this.clearAutoSaveAttachments();\r \r // if (this.autoSavedAttachments &amp;&amp; this.autoSavedAttachments.length){\r // this.autoSavedAttachments.each(function(att){\r // o2.Actions.get(\"x_processplatform_assemble_surface\").deleteAttachment(att.id, this.form.businessData.work.id);\r // }.bind(this));\r // this.autoSavedAttachments = [];\r // }\r //this.saveHTML();\r this.officeForm.getElement(\"input\").set(\"value\", this.json.id);\r var url = \"\";\r if (this.file){\r url = this.form.workAction.action.actions.replaceAttachment.uri;\r url = url.replace(\"{id}\", this.file.id);\r url = this.form.workAction.action.address+url.replace(\"{workid}\", this.form.businessData.work.id);\r \r this.officeOCX.SaveToURL(url, \"file\", \"\", this.getFileName(), this.getFormId());\r }else{\r url = this.form.workAction.action.actions.uploadAttachment.uri;\r url = this.form.workAction.action.address+url.replace(\"{id}\", this.form.businessData.work.id);\r \r this.officeOCX.SaveToURL(url, \"file\", \"\", this.getFileName(), this.getFormId());\r this.form.workAction.getWorkContent(this.form.businessData.work.id, function(json){\r this.form.businessData.attachmentList = json.data.attachmentList;\r this.getOfficeFileUrl();\r }.bind(this));\r }\r }\r }catch (e){}\r this.fireEvent(\"afterSave\");\r }\r },\r getHistoryFileName: function(){\r var ename = \"docx\";\r switch (this.json.officeType){\r case \"word\":\r ename = \"docx\";\r break;\r case \"excel\":\r ename = \"xlsx\";\r break;\r case \"ppt\":\r ename = \"pptx\";\r }\r //var id = (this.form.businessData.work) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r var activity = (this.form.businessData.work) ? this.form.businessData.work.activityName : MWF.xApplication.process.Xform.LP.completed;\r var name = MWF.name.cn(layout.session.user.name);\r var d = Date.parse(new Date());\r var dText = d.format(\"%Y-%m-%d %H:%M\");\r return activity+\"(\"+name+\")-\"+dText+\".\"+ename;\r },\r saveHistory: function(){\r var fileName = this.getHistoryFileName();\r this.officeForm.getElement(\"input\").set(\"value\", this.json.id+\"history\");\r url = this.form.workAction.action.actions.uploadAttachment.uri;\r url = this.form.workAction.action.address+url.replace(\"{id}\", this.form.businessData.work.id);\r this.officeOCX.SaveToURL(url, \"file\", \"\", fileName, this.getFormId());\r },\r getHTMLFileName: function(){\r //var id = (this.form.businessData.work) ? this.form.businessData.work.id : this.form.businessData.workCompleted.id;\r var id = (!this.form.businessData.workCompleted) ? this.form.businessData.work.id : this.form.businessData.workCompleted.workId;\r return id+this.json.id+\".mht\";\r },\r saveHTML: function(){\r this.officeForm.getElement(\"input\").set(\"value\", this.json.id+\"$view\");\r \r var file = null;\r for (var i=0; i&lt;this.form.businessData.attachmentList.length; i++){\r var att = this.form.businessData.attachmentList[i];\r if (att.site==this.json.id+\"$view\"){\r file = att;\r }\r }\r \r var fileName = (file) ? file.name : this.getHTMLFileName();\r this.officeForm.getElement(\"input\").getNext().set(\"value\", fileName);\r if (file){\r url = this.form.workAction.action.actions.replaceAttachment.uri;\r url = url.replace(\"{id}\", file.id);\r url = this.form.workAction.action.address+url.replace(\"{workid}\", this.form.businessData.work.id);\r }else{\r url = this.form.workAction.action.actions.uploadAttachment.uri;\r url = this.form.workAction.action.address+url.replace(\"{id}\", this.form.businessData.work.id);\r }\r \r //this.officeOCX.PublishAsHTMLToURL(url, \"file\", \"\", fileName, this.getFormId());\r this.officeOCX.SaveAsOtherFormatToURL(1, url, \"file\", \"\", fileName, this.getFormId());\r //this.officeOCX.PublishAsPDFToURL(url, \"file\", \"\", fileName, this.getFormId());\r },\r \r getHTMLFileUrl: function(name){\r var fileName = name || this.getHTMLFileName();\r \r var file = null;\r atts = this.form.businessData.attachmentList;\r for (var i=0; i&lt;atts.length; i++){\r if ((atts[i].name===fileName) || (atts[i].site===this.json.id+\"$view\")){\r file = atts[i];\r break;\r }\r }\r if (file){\r //this.file = file;\r var url = \"\";\r if (!this.form.businessData.workCompleted){\r url = this.form.workAction.action.actions.getAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(file.id));\r return this.form.workAction.action.address+url.replace(\"{workid}\", encodeURIComponent(this.form.businessData.work.id));\r }else{\r url = this.form.workAction.action.actions.getWorkcompletedAttachmentData.uri;\r url = url.replace(\"{id}\", encodeURIComponent(file.id));\r return this.form.workAction.action.address+url.replace(\"{workCompletedId}\", encodeURIComponent(this.form.businessData.workCompleted.id));\r }\r }else{\r return this.getTempleteUrl();\r }\r },\r \r validationMode: function(){},\r validation: function(){return true},\r \tloadOfficeNotActive: function(){\r var fileName = this.getFileName();\r var htmlName = \"\";\r \r var isHtml = false;\r for (var i=0; i&lt;this.form.businessData.attachmentList.length; i++){\r var att = this.form.businessData.attachmentList[i];\r if (att.site==this.json.id+\"$view\"){\r htmlName = att.name;\r }\r }\r if (false){\r this.node.setStyles({\r \"min-height\": \"600px\",\r \"padding\": \"0px\",\r \"border\": \"0px solid #999999\",\r \"background-color\": \"#e6e6e6\",\r \"overflow\": \"hidden\"\r });\r if (this.node.getSize().y&lt;800) this.node.setStyle(\"height\", \"800px\");\r //this.node.setStyles(this.json.styles);\r var wordNode = new Element(\"div\", {\r \"styles\": {\r \"padding\": \"40px\",\r \"border\": \"1px solid #999999\",\r \"background-color\": \"#e6e6e6\",\r \"overflow\": \"auto\"\r }\r }).inject(this.node);\r var size = this.node.getSize();\r var y = (size.y-80-80);\r wordNode.setStyle(\"height\", \"\"+y+\"px\");\r \r var node = new Element(\"div\", {\r \"styles\": {\r \"width\": \"90%\",\r \"height\": \"1900px\",\r \"margin\": \"auto\",\r \"background-color\": \"#ffffff\"\r }\r }).inject(wordNode);\r \r var iframe = new Element(\"iframe\", {\r \"styles\": {\r \"width\": \"100%\",\r \"height\": \"100%\",\r \"min-height\": \"600px\",\r \"overflow\": \"auto\",\r \"border\": \"1px solid #cccccc\"\r }\r //\"src\": this.getHTMLFileUrl(htmlName)\r }).inject(node);\r //alert(iframe.contentWindow.document.body.firstChild);\r iframe.contentWindow.document.addEventListener(\"readystatechange\", function(){\r alert(\"onreadystatechange\"+ this.readyState );\r alert(this.body.firstChild);\r this.body.style.padding = \"20px 40px\";\r });\r // iframe.contentWindow.document.onreadystatechange = function(){\r // alert(\"onreadystatechange\"+ this.readyState );\r // alert(this.body.firstChild);\r // this.body.style.padding = \"20px 40px\";\r // };\r iframe.set(\"src\", this.getHTMLFileUrl(htmlName));\r \r // iframe.contentWindow.document.body.firstChild.style.paddingTop = \"20px\";\r // iframe.contentWindow.document.body.firstChild.style.paddingBottom = \"20px\";\r // iframe.contentWindow.document.body.firstChild.style.paddingLeft = \"40px\";\r // iframe.contentWindow.document.body.firstChild.style.paddingRight = \"40px\";\r \r \r }else{\r if (this.json.isShowSummary!==false){\r this.node.setStyles({\r \"overflow\": \"hidden\",\r \"background-color\": \"#f3f3f3\",\r \"min-height\": \"24px\",\r \"padding\": \"18px\"\r });\r \r var str = this.getData();\r if (layout.mobile || COMMON.Browser.Platform.isMobile){\r if (str.length>300) str = str.substr(0,300)+\"……\";\r }\r \r var text = new Element(\"div\", {\r \"text\": str\r }).inject(this.node);\r }\r }\r var text = MWF.xApplication.process.Xform.LP.openOfficeInfor;\r text = text.replace(\"{type}\", this.json.officeType);\r var icon = new Element(\"div\", {\r \"styles\": {\r \"width\": \"200px\",\r \"height\": \"24px\",\r \"margin\": \"auto\",\r \"margin-top\": \"18px\",\r \"padding-left\": \"30px\",\r \"font-size\": \"16px\",\r \"font-weight\": \"bold\",\r \"color\": \"#2b5797\",\r \"font-family\": \"Gadugi\",\r \"cursor\": \"pointer\",\r \"background\": \"url(\"+this.form.path+\"\"+this.form.options.style+\"/icon/\"+this.json.officeType+\".png\"+\") no-repeat left center\"\r },\r \"text\": text\r }).inject(this.node);\r \r var url = this.getOfficeFileUrl();\r if (!url){\r this.node.setStyle(\"display\", \"none\");\r }\r icon.addEvent(\"click\", function(){\r var url = this.getOfficeFileUrl();\r if (url){\r if (window.o2android){\r window.o2android.openDocument(url);\r }else if(window.webkit){\r window.webkit.messageHandlers.openDocument.postMessage(url);\r }else{\r window.open(o2.filterUrl(url));\r }\r }\r }.bind(this));\r \r \t}\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Opinion.js.html":{"url":"x_component_process_Xform_Opinion.js.html","title":"x_component_process_Xform/Opinion.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Opinion.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Opinion.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r MWF.xDesktop.requireApp(\"process.Work\", \"lp.\"+o2.language, null, false);\r /** @class Opinion 意见输入框。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Opinion = MWF.APPOpinion = new Class(\r /** @lends MWF.xApplication.process.Xform.Opinion# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \t\r \t_loadUserInterface: function(){\r \r \t\tthis._loadNode();\r if (this.json.compute == \"show\"){\r this._setValue(this._computeValue());\r }else{\r this._loadValue();\r }\r \t},\r _loadNode: function(){\r if (this.readonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r this.node.setStyle(\"display\", \"none\");\r },\r validationConfigItem: function(routeName, data){\r var flag = (data.status===\"all\") ? true: (routeName === data.decision);\r if (flag){\r var n = this.getInputData();\r var v = (data.valueType===\"value\") ? n : n.length;\r switch (data.operateor){\r case \"isnull\":\r if (!v &amp;&amp; !(this.handwritingFile &amp;&amp; this.handwritingFile[layout.session.user.distinguishedName])){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notnull\":\r if (v){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"gt\":\r if (v>data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"lt\":\r if (v&lt;data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"equal\":\r if (v==data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"neq\":\r if (v!=data.value){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"contain\":\r if (v.indexOf(data.value)!=-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r case \"notcontain\":\r if (v.indexOf(data.value)==-1){\r this.notValidationMode(data.prompt);\r return false;\r }\r break;\r }\r }\r return true;\r },\r \r _resetNodeEdit: function(){\r var input = new Element(\"textarea\", {\"styles\": {\r \"background\": \"transparent\",\r \"width\": \"100%\",\r \"border\": \"0px\"\r }});\r input.set(this.json.properties);\r \r var node = new Element(\"div\", {\"styles\": {\r \"ovwrflow\": \"hidden\",\r \"position\": \"relative\",\r \"padding-right\": \"2px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r this.node.destroy();\r this.node = node;\r },\r _loadNodeEdit: function(){\r if (!this.json.preprocessing) this._resetNodeEdit();\r var input = this.node.getFirst();\r input.set(this.json.properties);\r \r \t\t//this.node = input;\r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type\r \t\t});\r \t\tthis.input = input;\r \r this.mediaActionArea = new Element(\"div\", {\"styles\": this.form.css.inputOpinionMediaActionArea}).inject(this.node);\r \r if (this.json.isHandwriting!==\"no\"){\r /**\r * @summary 手写意见按钮按钮。\r * @member {Element}\r */\r this.handwritingAction = new Element(\"div\", {\"styles\": this.form.css.inputOpinionHandwritingAction, \"text\": MWF.xApplication.process.Work.LP.handwriting}).inject(this.mediaActionArea);\r this.handwritingAction.addEvent(\"click\", function(){\r this.handwriting();\r }.bind(this));\r }\r \r if (this.json.isAudio!==\"no\"){\r if (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia){\r /**\r * @summary 音频按钮.在浏览器支持HTML5的getUserMedia才可用。\r * @member {Element}\r */\r this.audioRecordAction = new Element(\"div\", {\"styles\": this.form.css.inputOpinionAudioRecordAction, \"text\": MWF.xApplication.process.Work.LP.audioRecord}).inject(this.mediaActionArea);\r this.audioRecordAction.addEvent(\"click\", function(){\r this.audioRecord();\r }.bind(this));\r }\r }\r \r this.node.addEvent(\"change\", function(){\r this._setBusinessData(this.getInputData());\r }.bind(this));\r \r this.node.getFirst().addEvent(\"blur\", function(){\r this.validation();\r this.hideSelectOpinionNode();\r }.bind(this));\r this.node.getFirst().addEvent(\"keyup\", function(){\r this.validationMode();\r }.bind(this));\r \r this.node.getFirst().addEvent(\"keydown\", function(e){\r if (this.selectOpinionNode &amp;&amp; (this.selectOpinionNode.getStyle(\"display\")!=\"none\") &amp;&amp; this.selectOpinionNode.getFirst()){\r if (e.code == 38){ //up\r if (this.selectedOpinionNode){\r var node = this.selectedOpinionNode.getPrevious();\r if (!node) node = this.selectOpinionNode.getLast();\r this.unselectedOpinion(this.selectedOpinionNode);\r this.selectedOpinion(node)\r }else{\r node = this.selectOpinionNode.getLast();\r this.selectedOpinion(node)\r }\r }\r if (e.code == 40){ //down\r if (this.selectedOpinionNode){\r var node = this.selectedOpinionNode.getNext();\r if (!node) node = this.selectOpinionNode.getFirst();\r this.unselectedOpinion(this.selectedOpinionNode);\r this.selectedOpinion(node)\r }else{\r node = this.selectOpinionNode.getFirst();\r this.selectedOpinion(node)\r }\r }\r if (e.code == 27){ //esc\r this.hideSelectOpinionNode();\r e.preventDefault();\r }\r if (e.code == 32 || e.code == 13){ //space\r if (this.selectedOpinionNode){\r this.setOpinion(this.selectedOpinionNode.get(\"text\"));\r e.preventDefault();\r }\r }\r }\r }.bind(this));\r \r if( !this.form.json.notLoadUserOpinion ){\r MWF.UD.getDataJson(\"userOpinion\", function(json){\r this.userOpinions = json;\r }.bind(this), false);\r }\r this.node.getFirst().addEvent(\"input\", function(e){\r this.startSearchOpinion();\r }.bind(this));\r this.node.getFirst().addEvent(\"focus\", function(){\r this.startSearchOpinion();\r }.bind(this));\r \r \t},\r \r audioRecord: function(){\r if (!this.audioRecordNode) this.createAudioRecordNode();\r this.audioRecordNode.show();\r this.audioRecordNode.position({\r \"relativeTo\": this.node,\r \"position\": \"center\",\r \"edge\": \"center\"\r });\r var p = this.audioRecordNode.getPosition(this.form.app.content);\r var top = p.y;\r var left = p.x;\r if (p.y&lt;0) top = 10;\r if (p.x&lt;0) left = 10;\r this.audioRecordNode.setStyles({\r \"top\": \"\"+top+\"px\",\r \"left\": \"\"+left+\"px\"\r });\r \r this.soundFile = {};\r MWF.require(\"MWF.widget.AudioRecorder\", function () {\r /**\r * @summary 音频意见组件.\r * @member {o2.widget.AudioRecorder}\r */\r this.audioRecorder = new MWF.widget.AudioRecorder(this.audioRecordNode, {\r \"onSave\" : function(audioFile){\r this.soundFile[layout.session.user.distinguishedName] = audioFile;\r if (this.previewNode){\r this.previewNode.destroy();\r this.previewNode = null;\r }\r this.previewNode = new Element(\"audio\", {\"controls\": true, \"src\": window.URL.createObjectURL(audioFile)}).inject(this.node);\r this.audioRecordNode.hide();\r // this.page.get(\"div_image\").node.set(\"src\",base64Image);\r }.bind(this),\r \"onCancel\": function(){\r this.soundFile[layout.session.user.distinguishedName] = null;\r delete this.soundFile[layout.session.user.distinguishedName];\r if (this.previewNode){\r this.previewNode.destroy();\r this.previewNode = null;\r }\r this.audioRecordNode.hide();\r }.bind(this)\r }, null );\r }.bind(this));\r },\r createAudioRecordNode: function(){\r this.audioRecordNode = new Element(\"div\", {\"styles\": this.form.css.handwritingNode}).inject(this.node, \"after\");\r var size = this.node.getSize();\r var y = Math.max(size.y, 320);\r var x = Math.max(size.x, 400);\r x = Math.min(x, 600);\r y = 320;\r x = 500;\r var zidx = this.node.getStyle(\"z-index\").toInt() || 0;\r zidx = (zidx&lt;1000) ? 1000 : zidx;\r this.audioRecordNode.setStyles({\r \"height\": \"\"+y+\"px\",\r \"width\": \"\"+x+\"px\",\r \"z-index\": zidx+1\r });\r // this.audioRecordNode.position({\r // \"relativeTo\": this.node,\r // \"position\": \"center\",\r // \"edge\": \"center\"\r // });\r },\r handwriting: function(){\r if (!this.handwritingNode) this.createHandwriting();\r this.handwritingNode.show();\r this.handwritingNode.position({\r \"relativeTo\": this.node,\r \"position\": \"center\",\r \"edge\": \"center\"\r });\r //var p = this.handwritingNode.getPosition(this.form.app.content);\r var p = this.handwritingNode.getPosition(this.handwritingNode.getOffsetParent());\r var top = p.y;\r var left = p.x;\r if (p.y&lt;0) top = 10;\r if (p.x&lt;0) left = 10;\r this.handwritingNode.setStyles({\r \"top\": \"\"+top+\"px\",\r \"left\": \"\"+left+\"px\"\r });\r },\r createHandwriting: function(){\r /**\r * @summary 手写板容器.\r * @member {Element}\r */\r this.handwritingNode = new Element(\"div\", {\"styles\": this.form.css.handwritingNode}).inject(this.node, \"after\");\r var size = this.node.getSize();\r var x = Math.max( this.json.tabletWidth || size.x , 500);\r var y = Math.max(this.json.tabletHeight ? (parseInt(this.json.tabletHeight) + 110) : size.y, 320);\r //x = Math.min(x, 600);\r //y = 320;\r //x = 500;\r var zidx = this.node.getStyle(\"z-index\").toInt() || 0;\r zidx = (zidx&lt;1000) ? 1000 : zidx;\r this.handwritingNode.setStyles({\r \"height\": \"\"+y+\"px\",\r \"width\": \"\"+x+\"px\",\r \"z-index\": zidx+1\r });\r this.handwritingNode.position({\r \"relativeTo\": this.node,\r \"position\": \"center\",\r \"edge\": \"center\"\r });\r this.handwritingAreaNode = new Element(\"div\", {\"styles\": this.form.css.handwritingAreaNode}).inject(this.handwritingNode);\r this.handwritingActionNode = new Element(\"div\", {\"styles\": this.form.css.handwritingActionNode, \"text\": MWF.xApplication.process.Work.LP.saveWrite}).inject(this.handwritingNode);\r var h = this.handwritingActionNode.getSize().y+this.handwritingActionNode.getStyle(\"margin-top\").toInt()+this.handwritingActionNode.getStyle(\"margin-bottom\").toInt();\r h = y - h;\r this.handwritingAreaNode.setStyle(\"height\", \"\"+h+\"px\");\r \r this.handwritingFile = {};\r MWF.require(\"MWF.widget.Tablet\", function () {\r /**\r * @summary 手写板组件.\r * @member {o2.widget.Tablet}\r */\r this.tablet = new MWF.widget.Tablet(this.handwritingAreaNode, {\r \"style\": \"default\",\r \"contentWidth\" : this.json.tabletWidth || 0,\r \"contentHeight\" : this.json.tabletHeight || 0,\r \"onSave\" : function( base64code, base64Image, imageFile ){\r this.handwritingFile[layout.session.user.distinguishedName] = imageFile;\r if (this.previewNode){\r this.previewNode.destroy();\r this.previewNode = null;\r }\r if(this.json.isHandwritingPreview!==\"no\") this.previewNode = new Element(\"img\", {\"src\": base64Image}).inject(this.node);\r this.handwritingNode.hide();\r // this.page.get(\"div_image\").node.set(\"src\",base64Image);\r }.bind(this),\r \"onCancel\": function(){\r this.handwritingFile[layout.session.user.distinguishedName] = null;\r delete this.handwritingFile[layout.session.user.distinguishedName];\r if (this.previewNode){\r this.previewNode.destroy();\r this.previewNode = null;\r }\r this.handwritingNode.hide();\r }.bind(this)\r }, null );\r this.tablet.load();\r }.bind(this));\r \r this.handwritingActionNode.addEvent(\"click\", function(){\r //this.handwritingNode.hide();\r if (this.tablet) this.tablet.save();\r }.bind(this));\r },\r \r unselectedOpinion: function(node){\r node.setStyle(\"background-color\", \"#ffffff\");\r this.selectedOpinionNode = null;\r },\r selectedOpinion: function(node){\r node.setStyle(\"background-color\", \"#d2ddf5\");\r this.selectedOpinionNode = node;\r },\r startSearchOpinion: function(){\r var t = this.input.get(\"value\");\r var arr = t.split(/(,\\s*){1}|(;\\s*){1}|\\s+/g);\r t = arr[arr.length-1];\r if (t.length){\r this.clearSearcheOpinionId();\r this.searcheOpinionId = window.setTimeout(function(){\r this.searchOpinions(t);\r }.bind(this), 500);\r }else{\r this.clearSearcheOpinionId();\r }\r },\r clearSearcheOpinionId: function(){\r if (this.searcheOpinionId) {\r window.clearTimeout(this.searcheOpinionId);\r this.searcheOpinionId = \"\";\r }\r },\r searchOpinions: function(t) {\r var value = this.input.get(\"value\");\r var arr = value.split(/[\\n\\r]/g);\r lines = arr.length;\r value = arr[arr.length - 1];\r var offsetValue = value;\r //var offsetValue = value.substr(0, value.length-t.length);\r \r if (this.userOpinions){\r var ops = this.userOpinions.filter(function (v, i) {\r return v.contains(t) &amp;&amp; (v != t);\r }.bind(this));\r if (ops.length) {\r this.showSelectOpinionNode(ops, offsetValue, lines);\r } else {\r this.hideSelectOpinionNode(ops);\r }\r }\r },\r hideSelectOpinionNode: function(){\r if (this.selectOpinionNode) this.selectOpinionNode.setStyle(\"display\", \"none\");\r },\r showSelectOpinionNode: function(ops, offsetValue, lines){\r if (!this.selectOpinionNode) this.createSelectOpinionNode();\r this.selectOpinionNode.empty();\r ops.each(function(op){\r this.createSelectOpinionOption(op);\r }.bind(this));\r \r var inputSize = this.input.getSize();\r var size = MWF.getTextSize(offsetValue, this.json.inputStyles);\r var offY = ((size.y-3)*lines)+3;\r if (offY>inputSize.y) offY = inputSize.y;\r \r this.selectOpinionNode.setStyle(\"display\",\"block\");\r this.selectOpinionNode.position({\r \"relativeTo\": this.node,\r \"position\": \"leftTop\",\r \"edge\": \"leftTop\",\r \"offset\": {\"x\": size.x, \"y\": offY}\r });\r },\r createSelectOpinionNode: function(){\r this.selectOpinionNode = new Element(\"div\", {\"styles\": this.form.css.opinionSelectNode}).inject(this.node);\r },\r createSelectOpinionOption: function(op){\r var option = new Element(\"div\", {\"styles\": this.form.css.opinionSelectOption, \"text\": op}).inject(this.selectOpinionNode);\r if (this.json.selectItemStyles) option.setStyles(this.json.selectItemStyles);\r option.addEvents({\r \"mouseover\": function(){this.setStyle(\"background-color\", \"#d2ddf5\")},\r \"mouseout\": function(){this.setStyle(\"background-color\", \"#ffffff\")},\r \"mousedown\": function(){this.setOpinion(op)}.bind(this)\r });\r },\r setOpinion: function(op){\r var v = this.input.get(\"value\");\r var arr = v.split(/(,\\s*){1}|(;\\s*){1}|\\s+/g);\r t = arr[arr.length-1];\r var leftStr = v.substr(0, v.length-t.length);\r this.input.set(\"value\", leftStr+op);\r this.hideSelectOpinionNode();\r this._setBusinessData(this.getInputData());\r },\r \r \t_afterLoaded: function(){\r if (!this.readonly){\r this.loadDescription();\r }\r \t},\r loadDescription: function(){\r if (this.readonly || this.json.isReadonly)return;\r var v = this._getBusinessData();\r if (!v){\r if (this.json.description){\r var size = this.node.getFirst().getSize();\r var w = size.x - 3\r if( this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ) {\r w = size.x - 23;\r }\r this.descriptionNode = new Element(\"div\", {\"styles\": this.form.css.descriptionNode, \"text\": this.json.description}).inject(this.node);\r this.descriptionNode.setStyles({\r \"width\": \"\"+w+\"px\",\r \"height\": \"\"+size.y+\"px\",\r \"line-height\": \"\"+size.y+\"px\"\r });\r this.setDescriptionEvent();\r }\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r if (COMMON.Browser.Platform.name===\"ios\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }else if (COMMON.Browser.Platform.name===\"android\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }else{\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }\r this.node.getFirst().addEvents({\r \"focus\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r }.bind(this),\r \"blur\": function(){\r if (!this.node.getFirst().get(\"value\")) this.descriptionNode.setStyle(\"display\", \"block\");\r }.bind(this)\r });\r }\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Org.js.html":{"url":"x_component_process_Xform_Org.js.html","title":"x_component_process_Xform/Org.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Org.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Org.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r MWF.xDesktop.requireApp(\"Selector\", \"package\", null, false);\r MWF.require(\"MWF.widget.O2Identity\", null, false);\r /** @class Org 人员组织组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Org = MWF.APPOrg = new Class(\r /** @lends MWF.xApplication.process.Xform.Org# */\r {\r Implements: [Events],\r Extends: MWF.APP$Input,\r options: {\r /**\r * 组件加载前触发。\r * @event MWF.xApplication.process.Xform.Org#queryLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载时触发.\r * @event MWF.xApplication.process.Xform.Org#load\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 组件加载后触发.\r * @event MWF.xApplication.process.Xform.Org#postLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 当组件值改变时触发。\r * @event MWF.xApplication.process.Xform.Org#change\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 当组件不允许输入（使用人员选择框）时，完成选择人员，并且给组件赋值后执行。\r * @event MWF.xApplication.process.Xform.Org#select\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"change\", \"select\"],\r /**\r * 人员选择框事件：加载前执行。this.target指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#queryLoadSelector\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：加载后执行，由于选择项为异步加载，此时选择项并未加载完成。this.target指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#postLoadSelector\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：加载选择框容器节点前执行。this.target指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#queryLoadCategory\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：加载选择框容器节点后执行。this.target指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#postLoadContent\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \r /**\r * 人员选择框事件：加载分类前执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#queryLoadCategory\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：加载分类后执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#postLoadCategory\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#selectCategory\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：取消选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#unselectCategory\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：展开分类后执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#expand\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：折叠分类后执行。this.target指向分类，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#collapse\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \r /**\r * 人员选择框事件：加载选择项前执行。this.target指向选择项，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#queryLoadItem\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：加载选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#postLoadItem\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#selectItem\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 人员选择框事件：取消选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。\r * @event MWF.xApplication.process.Xform.Org#unselectItem\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"selectorEvents\" : [\"queryLoadSelector\",\"postLoadSelector\",\"queryLoadContent\",\"postLoadContent\",\"queryLoadCategory\",\"postLoadCategory\",\r \"selectCategory\", \"unselectCategory\",\"queryLoadItem\",\"postLoadItem\",\"selectItem\", \"unselectItem\",\"change\",\"expand\",\"collapse\"],\r \"readonly\": true\r },\r \r iconStyle: \"orgIcon\",\r \r getTextData: function(){\r //var value = this.node.get(\"value\");\r //var text = this.node.get(\"text\");\r var value = this.getValue();\r //var text = (this.node.getFirst()) ? this.node.getFirst().get(\"text\") : this.node.get(\"text\");\r var text = [];\r if( typeOf( value ) === \"object\" )value = [value];\r if( typeOf( value ) === \"array\" ){\r value.each(function(v){\r if( typeOf(v) === \"string\" ){\r text.push(v);\r }else{\r text.push(v.name+((v.unitName) ? \"(\"+v.unitName+\")\" : \"\"));\r }\r }.bind(this));\r return {\"value\": value || \"\", \"text\": [text.join(\",\")]};\r }else{\r return {\"value\": [\"\"], \"text\": [\"\"]};\r }\r },\r \r loadDescription: function(){\r if (this.readonly || this.json.isReadonly)return;\r var v = this._getBusinessData();\r if (!v || !v.length){\r if (this.json.description){\r var size = this.node.getFirst().getSize();\r var w = size.x-3;\r if( this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ) {\r if (COMMON.Browser.safari) w = w - 20;\r }\r this.descriptionNode = new Element(\"div\", {\"styles\": this.form.css.descriptionNode, \"text\": this.json.description}).inject(this.node);\r this.descriptionNode.setStyles({\r \"width\": \"\"+w+\"px\",\r \"height\": \"\"+size.y+\"px\",\r \"line-height\": \"\"+size.y+\"px\"\r });\r this.setDescriptionEvent();\r }\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r this.descriptionNode.addEvents({\r \"mousedown\": function( ev ){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.clickSelect( ev );\r }.bind(this)\r });\r }\r },\r _loadNode: function(){\r this.field = true;\r if (this.readonly || this.json.isReadonly){\r this._loadNodeRead();\r }else{\r this._getOrgOptions();\r if (this.json.isInput){\r this._loadNodeInputEdit();\r }else{\r this._loadNodeEdit();\r }\r \r }\r },\r _getOrgOptions: function(){\r this.selectTypeList = typeOf( this.json.selectType ) == \"array\" ? this.json.selectType : [this.json.selectType];\r if( this.selectTypeList.contains( \"identity\" ) ) {\r this.identityOptions = new MWF.APPOrg.IdentityOptions(this.form, this.json);\r }\r if( this.selectTypeList.contains( \"unit\" ) ) {\r this.unitOptions = new MWF.APPOrg.UnitOptions(this.form, this.json);\r }\r if( this.selectTypeList.contains( \"group\" ) ){\r this.groupOptions = new MWF.APPOrg.GroupOptions( this.form, this.json );\r }\r \r //this.selectUnits = this.getSelectRange();\r //if (this.json.selectType==\"identity\"){\r // this.selectDutys = this.getSelectRangeDuty();\r //}\r },\r \r _valueMerge: function(values, v){\r if (o2.typeOf(v)==\"function\"){\r return v.then(function(re){\r this._valueMerge(values, re)\r }.bind(this), function(){});\r }else{\r return values.concat(v);\r }\r },\r _computeValue: function(){\r \r var simple = this.json.storeRange === \"simple\";\r var values = [];\r if (this.json.identityValue) {\r this.json.identityValue.each(function(v){\r if (v) values.push(MWF.org.parseOrgData(v, true, simple))\r });\r }\r if (this.json.unitValue) {\r this.json.unitValue.each(function(v){ if (v) values.push(MWF.org.parseOrgData(v, true, simple))});\r }\r if (this.json.dutyValue) {\r var dutys = JSON.decode(this.json.dutyValue);\r var par;\r if (dutys.length){\r dutys.each(function(duty){\r if (duty.code) par = this.form.Macro.exec(duty.code, this);\r if (par){\r var pars = (o2.typeOf(par)==\"array\") ? par : [par];\r var promise = Promise.all(pars).then(function(p){\r var uName = p.distinguishedName || p;\r if (o2.typeOf(p)==\"array\") uName = p[0].distinguishedName || p[0];\r var code = \"return this.org.getDuty(\\\"\"+duty.name+\"\\\", \\\"\"+uName+\"\\\", true)\";\r var r = (!!uName) ? this.form.Macro.exec(code, this) : \"\";\r \r var m = (o2.typeOf(r)==\"array\") ? \"all\" : \"resolve\";\r return Promise[m](r).then(function(d){\r if (typeOf(d)!==\"array\") d = (d) ? [d.toString()] : [];\r var arr = [];\r d.each(function(dd){\r if (dd) arr.push(MWF.org.parseOrgData(dd, true, simple));\r });\r return arr;\r }.bind(this)).catch(function(){\r console.log(\"catch error : can not get duty : \" + duty.name, + \"-\" + uName);\r });\r }.bind(this), function(){});\r values.push(promise);\r }\r }.bind(this));\r }\r }\r if (this.json.defaultValue &amp;&amp; this.json.defaultValue.code){\r var fd = this.form.Macro.exec(this.json.defaultValue.code, this);\r if (o2.typeOf(fd)==\"array\"){\r fd.each(function(v){values.push(v);});\r }else{\r values.push(fd);\r }\r \r // if (fd &amp;&amp; fd.isAG){\r // values.push(fd);\r // }else{\r // if (typeOf(fd)!==\"array\") fd = (fd) ? [fd] : [];\r // fd.each(function(fdd){\r // if (fdd){\r // if (typeOf(fdd)===\"string\"){\r // var data;\r // this.getOrgAction()[this.getValueMethod(fdd)](function(json){ data = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), null, fdd, false);\r // values.push(data);\r // }else{\r // values.push(fdd);\r // }\r // }\r // }.bind(this));\r // }\r }\r // if (this.json.count>0){\r // return values.slice(0, this.json.count);\r // }\r return values;\r //return (this.json.defaultValue.code) ? this.form.Macro.exec(this.json.defaultValue.code, this): (value || \"\");\r },\r __computeValue: function(){\r var simple = this.json.storeRange === \"simple\";\r var values = [];\r if (this.json.identityValue) {\r this.json.identityValue.each(function(v){\r if (v) values.push(MWF.org.parseOrgData(v, true, simple))\r });\r }\r if (this.json.unitValue) {\r this.json.unitValue.each(function(v){ if (v) values.push(MWF.org.parseOrgData(v, true, simple))});\r }\r if (this.json.dutyValue) {\r var dutys = JSON.decode(this.json.dutyValue);\r var par;\r if (dutys.length){\r dutys.each(function(duty){\r if (duty.code) par = this.form.Macro.exec(duty.code, this);\r if (par &amp;&amp; par.isAG){\r var ag = o2.AG.all(par).then(function(p){\r var uName = \"\";\r if (p &amp;&amp; p.length) uName = p[0].distinguishedName || p[0];\r var code = \"return this.org.getDuty(\\\"\"+duty.name+\"\\\", \\\"\"+uName+\"\\\", true)\";\r var r = this.form.Macro.exec(code, this);\r \r o2.AG.all(r).then(function(d) {\r //var d = rd[0];\r if (typeOf(d)!==\"array\") d = (d) ? [d.toString()] : [];\r var arr = [];\r d.each(function(dd){\r if (dd) arr.push(MWF.org.parseOrgData(dd, true, simple));\r });\r return arr;\r }.bind(this));\r }.bind(this));\r values.push(ag);\r }else{\r var code = \"return this.org.getDuty(\\\"\"+duty.name+\"\\\", \\\"\"+par+\"\\\", true)\";\r var r = this.form.Macro.exec(code, this);\r var ag = o2.AG.all(r).then(function(d) {\r //var d = rd[0];\r if (typeOf(d)!==\"array\") d = (d) ? [d.toString()] : [];\r var arr = [];\r d.each(function(dd){\r if (dd) arr.push(MWF.org.parseOrgData(dd, true, simple));\r });\r return arr;\r }.bind(this));\r values.push(ag);\r \r // if (typeOf(d)!==\"array\") d = (d) ? [d.toString()] : [];\r // d.each(function(dd){if (dd) values.push(MWF.org.parseOrgData(dd, true, simple));});\r }\r \r }.bind(this));\r }\r }\r if (this.json.defaultValue &amp;&amp; this.json.defaultValue.code){\r var fd = this.form.Macro.exec(this.json.defaultValue.code, this);\r \r if (fd &amp;&amp; fd.isAG){\r // value.addResolve(function(v){\r // this._setBusinessData(v);\r // if (this.node.getFirst()) this.node.getFirst().set(\"value\", v || \"\");\r // if (this.readonly || this.json.isReadonly) this.node.set(\"text\", v);\r // }.bind(this));\r values.push(fd);\r // fd.then(function(v){\r // return this._valueMerge(values, v);\r // }.bind(this));\r // return fd;\r }else{\r if (typeOf(fd)!==\"array\") fd = (fd) ? [fd] : [];\r fd.each(function(fdd){\r if (fdd){\r if (typeOf(fdd)===\"string\"){\r var data;\r this.getOrgAction()[this.getValueMethod(fdd)](function(json){ data = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), null, fdd, false);\r values.push(data);\r }else{\r values.push(fdd);\r }\r }\r }.bind(this));\r }\r }\r if (this.json.count>0){\r return values.slice(0, this.json.count);\r }\r return values;\r //return (this.json.defaultValue.code) ? this.form.Macro.exec(this.json.defaultValue.code, this): (value || \"\");\r },\r \r getOrgAction: function(){\r if (!this.orgAction) this.orgAction = MWF.Actions.get(\"x_organization_assemble_control\");\r //if (!this.orgAction) this.orgAction = new MWF.xApplication.Selector.Actions.RestActions();\r return this.orgAction;\r },\r \r getOptions: function(){\r \r var _self = this;\r \r if( this.selectTypeList.length === 0 )return false;\r \r var values = this.getInputData() || [];\r \r var exclude = [];\r if( this.json.exclude ){\r var v = this.form.Macro.exec(this.json.exclude.code, this);\r exclude = typeOf(v)===\"array\" ? v : [v];\r }\r \r //var count = (this.json.count) ? this.json.count : 0;\r \r var identityOpt;\r if( this.identityOptions ){\r identityOpt = this.identityOptions.getOptions();\r if (this.json.identityRange!==\"all\"){\r if ( !identityOpt.noUnit &amp;&amp; (!identityOpt.units || !identityOpt.units.length) ){\r this.form.notice(MWF.xApplication.process.Xform.LP.noIdentitySelectRange, \"error\", this.node);\r identityOpt.disabled = true;\r // return false;\r }\r }\r if ( !identityOpt.noUnit &amp;&amp; this.json.dutyRange &amp;&amp; this.json.dutyRange!==\"all\"){\r if (!identityOpt.dutys || !identityOpt.dutys.length){\r this.form.notice(MWF.xApplication.process.Xform.LP.noIdentityDutySelectRange, \"error\", this.node);\r identityOpt.disabled = true;\r // return false;\r }\r }\r identityOpt.values = (this.json.isInput) ? [] : values;\r identityOpt.exclude = exclude;\r if( this.form.json.selectorStyle )identityOpt = Object.merge( identityOpt, this.form.json.selectorStyle );\r }\r \r var unitOpt;\r if( this.unitOptions ){\r unitOpt = this.unitOptions.getOptions();\r if (this.json.unitRange!==\"all\"){\r if ( !unitOpt.units || !unitOpt.units.length){\r this.form.notice(MWF.xApplication.process.Xform.LP.noUnitSelectRange, \"error\", this.node);\r unitOpt.disabled = true;\r // return false;\r }\r }\r unitOpt.values = (this.json.isInput) ? [] : values;\r unitOpt.exclude = exclude;\r if( this.form.json.selectorStyle )unitOpt = Object.merge( unitOpt, this.form.json.selectorStyle );\r }\r \r var groupOpt;\r if( this.groupOptions ){\r groupOpt = this.groupOptions.getOptions();\r groupOpt.values = (this.json.isInput) ? [] : values;\r groupOpt.exclude = exclude;\r if( this.form.json.selectorStyle )groupOpt = Object.merge( groupOpt, this.form.json.selectorStyle );\r }\r \r //var selectUnits = this.getSelectRange();\r //if (this.json.selectType==\"identity\"){\r // var selectDutys = this.getSelectRangeDuty();\r //}\r \r //if (this.json.range!==\"all\"){\r // if (!selectUnits.length){\r // this.form.notice(MWF.xApplication.process.Xform.LP.noSelectRange, \"error\", this.node);\r // return false;\r // }\r //}\r //if (this.json.selectType==\"identity\"){\r // if ((this.json.dutyRange) &amp;&amp; this.json.dutyRange!==\"all\"){\r // if (!selectDutys || !selectDutys.length){\r // this.form.notice(MWF.xApplication.process.Xform.LP.noSelectRange, \"error\", this.node);\r // return false;\r // }\r // }\r //}\r \r var defaultOpt = {};\r \r if( this.json.events &amp;&amp; typeOf(this.json.events) === \"object\" ){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.selectorEvents.indexOf(key)!==-1){\r if( key === \"postLoadSelector\" ) {\r this.addEvent(\"loadSelector\", function (selector) {\r return this.form.Macro.fire(e.code, selector);\r }.bind(this))\r }else if( key === \"queryLoadSelector\"){\r defaultOpt[\"onQueryLoad\"] = function(target){\r return this.form.Macro.fire(e.code, target);\r }.bind(this)\r }else{\r defaultOpt[\"on\"+key.capitalize()] = function(target){\r return this.form.Macro.fire(e.code, target);\r }.bind(this)\r }\r }\r }\r }.bind(this));\r }\r \r if( this.selectTypeList.length === 1 ){\r return Object.merge( {\r \"type\": this.selectTypeList[0],\r \"onComplete\": function(items){\r this.selectOnComplete(items);\r }.bind(this),\r \"onCancel\": this.selectOnCancel.bind(this),\r // \"onLoad\": this.selectOnLoad.bind(this),\r \"onLoad\": function(){\r //this 为 selector\r _self.selectOnLoad(this, this.selector );\r },\r \"onClose\": this.selectOnClose.bind(this)\r }, defaultOpt, identityOpt || unitOpt || groupOpt )\r }else if( this.selectTypeList.length > 1 ){\r var options = {\r \"type\" : \"\",\r \"types\" : this.selectTypeList,\r \"onComplete\": function(items){\r this.selectOnComplete(items);\r }.bind(this),\r \"onCancel\": this.selectOnCancel.bind(this),\r // \"onLoad\": this.selectOnLoad.bind(this),\r \"onLoad\": function(){\r //this 为 selector\r _self.selectOnLoad(this)\r },\r \"onClose\": this.selectOnClose.bind(this)\r };\r if( this.form.json.selectorStyle ){\r options = Object.merge( options, this.form.json.selectorStyle );\r }\r if( identityOpt )options.identityOptions = Object.merge( {}, defaultOpt, identityOpt );\r if( unitOpt )options.unitOptions = Object.merge( {}, defaultOpt, unitOpt );\r if( groupOpt )options.groupOptions = Object.merge( {}, defaultOpt, groupOpt );\r return options;\r }\r \r //return {\r // \"type\": this.json.selectType,\r // \"unitType\": (this.json.selectUnitType===\"all\") ? \"\" : this.json.selectUnitType,\r // \"values\": (this.json.isInput) ? [] : values,\r // \"count\": count,\r // \"units\": selectUnits,\r // \"dutys\": (this.json.selectType==\"identity\") ? selectDutys : [],\r // \"exclude\" : exclude,\r // \"expandSubEnable\" : (this.json.expandSubEnable==\"no\") ? false : true,\r // \"categoryType\": this.json.categoryType || \"unit\",\r // \"onComplete\": function(items){\r // this.selectOnComplete(items);\r // }.bind(this),\r // \"onCancel\": this.selectOnCancel.bind(this),\r // \"onLoad\": this.selectOnLoad.bind(this),\r // \"onClose\": this.selectOnClose.bind(this)\r //};\r },\r selectOnComplete: function(items){\r var array = [];\r items.each(function(item){\r array.push(item.data);\r }.bind(this));\r \r var simple = this.json.storeRange === \"simple\";\r \r this.checkEmpower( array, function( data ){\r var values = [];\r data.each(function(d){\r values.push(MWF.org.parseOrgData(d, true, simple));\r }.bind(this));\r \r if (this.json.isInput){\r this.addData(values);\r }else{\r this.setData(values);\r }\r //this._setBusinessData(values);\r this.validationMode();\r this.validation();\r var p = this.getValue();\r if (p.then){\r p.then(function(){\r this.fireEvent(\"select\");\r }.bind(this), function(){});\r }else{\r this.fireEvent(\"select\");\r }\r \r }.bind(this))\r },\r selectOnCancel: function(){\r this.validation();\r },\r selectOnLoad: function( selector ){\r if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"none\");\r this.fireEvent(\"loadSelector\", [selector])\r },\r selectOnClose: function(){\r v = this._getBusinessData();\r if (!v || !v.length) if (this.descriptionNode) this.descriptionNode.setStyle(\"display\", \"block\");\r },\r \r /**\r * @summary 弹出选择界面.\r * @example\r * this.form.get('org').clickSelect();\r */\r clickSelect: function( ev ){\r if (this.readonly)return;\r if( layout.mobile ){\r setTimeout( function(){ //如果有输入法界面，这个时候页面的计算不对，所以等100毫秒\r var options = this.getOptions();\r if(options){\r if( this.selector &amp;&amp; this.selector.loading ) {\r }else if( this.selector &amp;&amp; this.selector.selector &amp;&amp; this.selector.selector.active ){\r }else{\r /**\r * @summary 人员选择框package的对象\r * @member {o2.O2Selector}\r * @example\r * //可以在脚本中获取该组件\r * var selector = this.form.get(\"fieldId\").selector.selector; //获取人员选择框对象\r * var options = selector.options; //获取人员选择框的选项\r */\r this.selector = new MWF.O2Selector(this.form.app.content, options);\r }\r }\r }.bind(this), 100 )\r }else{\r var options = this.getOptions();\r if(options){\r if( this.selector &amp;&amp; this.selector.loading ) {\r }else if( this.selector &amp;&amp; this.selector.selector &amp;&amp; this.selector.selector.active ){\r }else {\r this.selector = new MWF.O2Selector(this.form.app.content, options);\r }\r }\r }\r },\r resetData: function(){\r \r var v = this.getValue();\r //this.setData((v) ? v.join(\", \") : \"\");\r this.setData(v);\r },\r isEmpty: function(){\r var data = this.getData();\r if( typeOf(data) !== \"array\" )return true;\r if( data.length === 0 )return true;\r return false;\r },\r \r getInputData: function(){\r if (this.json.isInput){\r if (this.combox)return this.combox.getData();\r //return this._getBusinessData();\r return this.node.retrieve(\"data\");\r }else{\r //return this._getBusinessData();\r return this.node.retrieve(\"data\");\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r var node = new Element(\"div\").inject(this.node);\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r },\r _searchConfirmPerson: function(item){\r var inforNode = item.inforNode || new Element(\"div\");\r \r var simple = this.json.storeRange === \"simple\";\r \r if (item.data){\r \r var data = item.data;\r if( this.selectTypeList.contains(\"identity\") &amp;&amp; this.json.identityResultType === \"person\"){\r var dn = data.distinguishedName || data;\r if( dn.substr( dn.length-1, 1).toLowerCase() === \"i\" ){\r MWF.Actions.get(\"x_organization_assemble_express\").listPersonWithIdentity({\r identityList : [dn]\r }, function(json){\r if( json.data.length > 0 ){\r if( data[\"person\"] )json.data[0].id = data[\"person\"];\r item.data = MWF.org.parseOrgData( json.data[0], true, simple );\r item.value = this.getDataText( item.data );\r if(item.node)item.node.set(\"text\", item.value);\r }\r }.bind(this), null, false)\r }\r }\r if( item.data &amp;&amp; ( item.data.createTime || item.data.updateTime ) ){\r item.data = MWF.org.parseOrgData( item.data, true, simple );\r }\r \r var text = \"\";\r var flag = item.data.distinguishedName.substr(item.data.distinguishedName.length-2, 2);\r switch (flag.toLowerCase()){\r case \"@i\":\r text = item.data.name+\"(\"+item.data.unitName+\")\";\r break;\r case \"@p\":\r text = item.data.name+(item.data.employee ? \"(\"+item.data.employee+\")\" : \"\");\r break;\r case \"@u\":\r text = item.data.levelName;\r break;\r case \"@g\":\r text = item.data.name;\r break;\r default:\r text = item.data.name;\r }\r inforNode.set({\r \"styles\": {\"font-size\": \"14px\", \"color\": \"\"},\r \"text\": text\r });\r }else{\r inforNode.set({\r \"styles\": {\"font-size\": \"14px\", \"color\": \"#bd0000\"},\r \"text\": MWF.xApplication.process.Xform.LP.noOrgObject\r });\r }\r if (!item.inforNode){\r new mBox.Tooltip({\r content: inforNode,\r setStyles: {content: {padding: 15, lineHeight: 20}},\r attach: item.node,\r transition: 'flyin'\r });\r item.inforNode = inforNode;\r }\r \r },\r getSearchOptions: function(){\r \r if( this.selectTypeList.length === 0 )return false;\r \r var identityOpt;\r if( this.identityOptions ){\r identityOpt = this.identityOptions.getSearchOptions();\r //if (this.json.identityRange!==\"all\"){\r // if ( !identityOpt.units || !identityOpt.units.length){\r // this.form.notice(MWF.xApplication.process.Xform.LP.noIdentitySelectRange, \"error\", this.node);\r // return false;\r // }\r //}\r //if ((this.json.dutyRange) &amp;&amp; this.json.dutyRange!==\"all\"){\r // if (!identityOpt.dutys || !identityOpt.dutys.length){\r // this.form.notice(MWF.xApplication.process.Xform.LP.noIdentityDutySelectRange, \"error\", this.node);\r // return false;\r // }\r //}\r }\r \r var unitOpt;\r if( this.unitOptions ){\r unitOpt = this.unitOptions.getSearchOptions();\r //if (this.json.unitRange!==\"all\"){\r // if ( !unitOpt.units || !unitOpt.units.length){\r // this.form.notice(MWF.xApplication.process.Xform.LP.noUnitSelectRange, \"error\", this.node);\r // return false;\r // }\r //}\r }\r \r var groupOpt;\r if( this.groupOptions ){\r groupOpt = this.groupOptions.getOptions();\r }\r \r if( this.selectTypeList.length === 1 ){\r return Object.merge( {\r \"type\": this.selectTypeList[0]\r }, identityOpt || unitOpt || groupOpt )\r }else if( this.selectTypeList.length > 1 ){\r var options = {\r \"type\" : \"\",\r \"types\" : this.selectTypeList\r };\r if( identityOpt )options.identityOptions = identityOpt;\r if( unitOpt )options.unitOptions = unitOpt;\r if( groupOpt )options.groupOptions = groupOpt;\r return options;\r }\r \r //return {\r // \"type\": this.json.selectType,\r // \"unitType\": (this.json.selectUnitType===\"all\") ? \"\" : this.json.selectUnitType,\r // \"values\": (this.json.isInput) ? [] : values,\r // \"count\": count,\r // \"units\": selectUnits,\r // \"dutys\": (this.json.selectType==\"identity\") ? selectDutys : [],\r // \"exclude\" : exclude,\r // \"expandSubEnable\" : (this.json.expandSubEnable==\"no\") ? false : true,\r // \"categoryType\": this.json.categoryType || \"unit\",\r // \"onComplete\": function(items){\r // this.selectOnComplete(items);\r // }.bind(this),\r // \"onCancel\": this.selectOnCancel.bind(this),\r // \"onLoad\": this.selectOnLoad.bind(this),\r // \"onClose\": this.selectOnClose.bind(this)\r //};\r },\r _searchOptions: function(value, callback){\r //var options = {\r // \"type\": this.json.selectType,\r // \"unitType\": (this.json.selectUnitType===\"all\") ? \"\" : this.json.selectUnitType,\r // \"units\": this.selectUnits,\r // \"dutys\": (this.json.selectType==\"identity\") ? this.selectDutys : []\r //};\r var options = this.getSearchOptions();\r if (!this.comboxFilter) this.comboxFilter = new MWF.O2SelectorFilter(value, options);\r this.comboxFilter.filter(value, function(data){\r data.map(function(d){\r var value = Object.clone(d);\r d.value = value;\r var flag = d.distinguishedName.substr(d.distinguishedName.length-2, 2);\r switch (flag.toLowerCase()){\r case \"@i\":\r d.text = d.name+\"(\"+d.unitName+\")\";\r break;\r case \"@p\":\r d.text = d.name+(d.employee ? \"(\"+d.employee+\")\" : \"\");\r break;\r case \"@u\":\r d.text = d.name;\r break;\r case \"@g\":\r d.text = d.name;\r break;\r default:\r d.text = d.name;\r }\r });\r if (callback) callback(data);\r });\r },\r \r _resetNodeInputEdit: function(){\r var node = new Element(\"div\", {\r \"styles\": {\r \"overflow\": \"hidden\",\r //\"position\": \"relative\",\r \"margin-right\": \"20px\"\r }\r }).inject(this.node, \"after\");\r this.node.destroy();\r this.node = node;\r },\r _loadNodeInputEdit: function(){\r \r this.node.setStyle(\"overflow\",\"visible\");\r var input=null;\r MWF.require(\"MWF.widget.Combox\", function(){\r this.combox = input = new MWF.widget.Combox({\r \"count\": this.json.count || 0,\r \"splitShow\": this.json.splitShow || \", \",\r \"onCommitInput\": function(item){\r this._searchConfirmPerson(item);\r //this.fireEvent(\"change\");\r }.bind(this),\r \"onChange\": function(){\r this.node.store(\"data\", this.getInputData());\r this._setBusinessData(this.getInputData());\r this.fireEvent(\"change\");\r }.bind(this),\r \"optionsMethod\": this._searchOptions.bind(this)\r \r });\r }.bind(this), false);\r input.setStyles({\r \"background\": \"transparent\",\r \"border\": \"0px\"\r });\r input.set(this.json.properties);\r \r if (!this.json.preprocessing) this._resetNodeInputEdit();\r \r this.node.empty();\r input.inject(this.node);\r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type\r });\r if (this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon) {\r this.iconNode = new Element(\"div\", {\r \"styles\": this.form.css[this.iconStyle],\r \"events\": {\r \"click\": function (ev) {\r this.clickSelect(ev);\r }.bind(this)\r //this.clickSelect.bind(this)\r }\r }).inject(this.node, \"before\");\r }else if( this.form.json.nodeStyleWithhideModuleIcon ){\r this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon)\r }\r \r this.combox.addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()){\r this.node.store(\"data\", this.getInputData());\r this._setBusinessData(this.getInputData(\"change\"));\r }\r }.bind(this));\r },\r \r _resetNodeEdit: function(){\r var input = new Element(\"div\", {\r \"styles\": {\r \"background\": \"transparent\",\r \"border\": \"0px\",\r \"min-height\": \"24px\"\r }\r });\r var node = new Element(\"div\", {\"styles\": {\r \"overflow\": \"hidden\",\r \"position\": \"relative\",\r \"margin-right\": \"20px\",\r \"min-height\": \"24px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r this.node.destroy();\r this.node = node;\r },\r _loadNodeEdit: function(){\r if (!this.json.preprocessing) this._resetNodeEdit();\r var input = this.node.getFirst();\r input.set(this.json.properties);\r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type,\r \"events\": {\r \"click\": function (ev) {\r this.clickSelect(ev);\r }.bind(this)\r //this.clickSelect.bind(this)\r }\r });\r if (this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon) {\r this.iconNode = new Element(\"div\", {\r \"styles\": this.form.css[this.iconStyle],\r \"events\": {\r \"click\": function (ev) {\r this.clickSelect(ev);\r }.bind(this)\r //this.clickSelect.bind(this)\r }\r }).inject(this.node, \"before\");\r }else if( this.form.json.nodeStyleWithhideModuleIcon ){\r this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon)\r }\r \r this.node.getFirst().setStyle(\"height\", \"auto\");\r this.node.getFirst().addEvent(\"change\", function(){\r this.validationMode();\r if (this.validation()){\r this.node.store(\"data\", this.getInputData());\r this._setBusinessData(this.getInputData(\"change\"));\r }\r }.bind(this));\r },\r getDataText: function(data){\r if (typeOf(data)==\"string\") return data;\r var text = \"\";\r var flag = data.distinguishedName.substr(data.distinguishedName.length-2, 2);\r switch (flag.toLowerCase()){\r case \"@i\":\r text = data.name+\"(\"+data.unitName+\")\";\r break;\r case \"@p\":\r text = data.name+ (data.employee ? (\"(\"+data.employee+\")\") : \"\");\r break;\r case \"@u\":\r text = data.name;\r break;\r case \"@g\":\r text = data.name;\r break;\r default:\r text = data.name;\r }\r return text;\r },\r addData: function(value){\r if (!value) return false;\r var simple = this.json.storeRange === \"simple\";\r value.each(function(v){\r var vtype = typeOf(v);\r if (vtype===\"string\"){\r var data;\r this.getOrgAction()[this.getValueMethod(v)](function(json){ data = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), null, v, false);\r if (data) this.combox.addNewValue(this.getDataText(data), data);\r }\r if (vtype===\"object\"){\r var d = MWF.org.parseOrgData(v, true, simple);\r this.combox.addNewValue(this.getDataText(d), d);\r }\r }.bind(this));\r },\r checkChange: function(oldValues, values){\r var change = false;\r if (!values) values = [];\r if (oldValues.length &amp;&amp; (values &amp;&amp; values.length)){\r if (oldValues.length === values.length){\r for (var i=0; i&lt;oldValues.length; i++){\r if ((oldValues[i].distinguishedName!==values[i].distinguishedName) || (oldValues[i].name!==values[i].name) || (oldValues[i].unique!==values[i].unique)){\r change = true;\r break;\r }\r }\r }else{\r change = true;\r }\r }else if (values.length || oldValues.length) {\r change = true;\r }\r if (change) this.fireEvent(\"change\");\r },\r setData: function(value){\r if (!value) return false;\r var oldValues = this.getData();\r if (value.length==1 &amp;&amp; !(value[0])) value=[];\r \r var promise = this._setValue(value);\r promise.then(function(values){\r o2.promiseAll(values).then(function(v){\r this.checkChange(oldValues, v)\r }.bind(this), function(){});\r \r // if (values &amp;&amp; values.isAG){\r // values.then(function(v){\r // this.checkChange(oldValues, v)\r // }.bind(this));\r // }else{\r // this.checkChange(oldValues, values)\r // }\r }.bind(this), function(){});\r },\r // __setData: function(value){\r // if (!value) return false;\r // var oldValues = this.getData();\r // var values = [];\r // var comboxValues = [];\r //\r // var simple = this.json.storeRange === \"simple\";\r //\r // var type = typeOf(value);\r // if (type===\"array\"){\r // value.each(function(v){\r // var vtype = typeOf(v);\r // var data = null;\r // if (vtype===\"string\"){\r // var error = (this.json.isInput) ? function(){ comboxValues.push(v); } : null;\r // this.getOrgAction()[this.getValueMethod(v)](function(json){ data = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), error, v, false);\r // }\r // if (vtype===\"object\") {\r // data = MWF.org.parseOrgData(v, true, simple);\r // if(data.woPerson)delete data.woPerson;\r // }\r // if (data){\r // values.push(data);\r // comboxValues.push({\"text\": this.getDataText(data),\"value\": data});\r // }\r // }.bind(this));\r // }\r // if (type===\"string\"){\r // var vData;\r // var error = (this.json.isInput) ? function(){ comboxValues.push(value); } : null;\r // this.getOrgAction()[this.getValueMethod(value)](function(json){ vData = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), error, value, false);\r // if (vData){\r // values.push(vData);\r // comboxValues.push({\"text\": this.getDataText(vData),\"value\": vData});\r // }\r // }\r // if (type===\"object\"){\r // var vData = MWF.org.parseOrgData(value, true, simple);\r // if(vData.woPerson)delete vData.woPerson;\r // values.push( vData );\r // comboxValues.push({\"text\": this.getDataText(value),\"value\": vData});\r // }\r //\r // var change = false;\r // if (oldValues.length &amp;&amp; values.length){\r // if (oldValues.length === values.length){\r // for (var i=0; i&lt;oldValues.length; i++){\r // if ((oldValues[i].distinguishedName!==values[i].distinguishedName) || (oldValues[i].name!==values[i].name) || (oldValues[i].unique!==values[i].unique)){\r // change = true;\r // break;\r // }\r // }\r // }else{\r // change = true;\r // }\r // }else if (values.length || oldValues.length) {\r // change = true;\r // }\r // this._setBusinessData(values);\r // if (change) this.fireEvent(\"change\");\r //\r // if (this.json.isInput){\r // if (this.combox){\r // this.combox.clear();\r // this.combox.addNewValues(comboxValues);\r // }else{\r // var node = this.node.getFirst();\r // if (node){\r // node.empty();\r // comboxValues.each(function(v, i){\r // this.creteShowNode(v, (i===comboxValues.length-1)).inject(node);\r // }.bind(this));\r // }\r // }\r // }else{\r // if (this.node.getFirst()){\r // var node = this.node.getFirst();\r // node.empty();\r // this.loadOrgWidget(values, node)\r // }else{\r // this.node.empty();\r // this.loadOrgWidget(values, this.node);\r // }\r // }\r // },\r creteShowNode: function(data, islast){\r var nodeText = (data.text) ? data.text : data;\r if (!islast) nodeText = nodeText + (this.json.splitShow || \", \");\r \r var node = new Element(\"div\", {\r \"styles\": {\r \"float\": \"left\",\r \"margin-right\": \"5px\"\r },\r \"text\": nodeText\r });\r var text = \"\";\r if (data.value){\r var flag = data.value.distinguishedName.substr(data.value.distinguishedName.length-2, 2);\r switch (flag.toLowerCase()){\r case \"@i\":\r text = data.value.name+\"(\"+data.value.unitName+\")\";\r break;\r case \"@p\":\r text = data.value.name+ (data.value.employee ? \"(\"+data.value.employee+\")\" : \"\");\r break;\r case \"@u\":\r text = data.value.levelName;\r break;\r case \"@g\":\r text = data.value.name;\r break;\r default:\r text = data.value.name;\r }\r var inforNode = new Element(\"div\").set({\r \"styles\": {\"font-size\": \"14px\", \"color\": \"\"},\r \"text\": text\r });\r \r new mBox.Tooltip({\r content: inforNode,\r setStyles: {content: {padding: 15, lineHeight: 20}},\r attach: node,\r transition: 'flyin'\r });\r }\r return node;\r },\r _setValue: function(value){\r var values = [];\r var ags = [];\r var simple = this.json.storeRange === \"simple\";\r var flag = false;\r if (typeOf(value)!==\"array\") value = (!!value) ? [value] : [];\r //value = (value.flat) ? value.flat() : value.flatten();\r \r var p = o2.promiseAll(value).then(function(d){\r if (typeOf(d)!==\"array\") d = (!!d) ? [d] : [];\r d.each(function(da){\r if (typeOf(da)!==\"array\") da = (!!da) ? [da] : [];\r da.each(function(dd){\r if (dd){\r if (typeOf(dd)===\"string\"){\r var pp = this.getOrgAction()[this.getValueMethod(dd)](function(json){\r return MWF.org.parseOrgData(json.data, true, simple);\r }.bind(this), null, dd, true).catch(function(e){\r console.log(\"error:\" + e);\r console.log(e);\r });\r ags.push(pp);\r }else{\r values.push(dd);\r }\r }\r }.bind(this));\r }.bind(this));\r if (ags.length){\r return o2.promiseAll(ags).then(function(data){\r values = values.concat(data);\r flag = true;\r this.__setValue(values);\r return values;\r }.bind(this), function(){});\r }else{\r flag = true;\r this.__setValue(values);\r return values\r }\r }.bind(this), function(){});\r \r this.moduleValueAG = p;\r if (p &amp;&amp; p.then) p.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r return p;\r \r // var ag = o2.AG.all(value).then(function(d) {\r // if (typeOf(d)!==\"array\") d = (d) ? [d.toString()] : [];\r //\r // d.each(function(dd){\r // //if (dd) arr.push(MWF.org.parseOrgData(dd, true, simple));\r // if (dd){\r // if (typeOf(dd)===\"string\"){\r // ags.push(this.getOrgAction()[this.getValueMethod(dd)](function(json){\r // return MWF.org.parseOrgData(json.data, true, simple);\r // }.bind(this).ag(), null, dd, true));\r // }else{\r // values.push(dd);\r // }\r // }\r // }.bind(this));\r // if (ags.length){\r // return o2.AG.all(ags).then(function(data){\r // values = values.concat(data);\r // flag = true;\r // this.__setValue(values);\r // return values;\r // }.bind(this));\r // }else{\r // flag = true;\r // this.__setValue(values);\r // return values\r // }\r // }.bind(this));\r //\r // this.moduleValueAG = ag;\r // if (ag) ag.then(function(){\r // this.moduleValueAG = null;\r // }.bind(this));\r // return ag;\r },\r __setValue: function(value){\r this.moduleValueAG = null;\r if (value.length==1 &amp;&amp; !(value[0])) value=[];\r \r if (this.json.count>0){\r value = value.slice(0, this.json.count);\r }\r \r var values = [];\r var comboxValues = [];\r var type = typeOf(value);\r var simple = this.json.storeRange === \"simple\";\r if (type===\"array\"){\r value.each(function(v){\r var data=null;\r var vtype = typeOf(v);\r if (vtype===\"string\"){\r var error = (this.json.isInput) ? function(){ comboxValues.push(v); } : null;\r this.getOrgAction()[this.getValueMethod(v)](function(json){ data = MWF.org.parseOrgData(json.data, true, simple); }.bind(this), error, v, false);\r }\r if (vtype===\"object\") data = v;\r if (data){\r var d = MWF.org.parseOrgData(data, true, simple)\r values.push(d);\r comboxValues.push({\"text\": this.getDataText(d),\"value\": d});\r }\r }.bind(this));\r }\r if (type===\"string\"){\r var vData;\r var error = (this.json.isInput) ? function(){ comboxValues.push(value); } : null;\r this.getOrgAction()[this.getValueMethod(value)](function(json){ vData = MWF.org.parseOrgData(json.data, true,simple); }.bind(this), error, value, false);\r if (vData){\r values.push(vData);\r comboxValues.push({\"text\": this.getDataText(vData),\"value\": vData});\r }\r }\r if (type===\"object\"){\r var v = MWF.org.parseOrgData(value, true, simple)\r values.push(v);\r comboxValues.push({\"text\": this.getDataText(v),\"value\": v});\r }\r \r this.node.store(\"data\", values);\r this._setBusinessData(values);\r \r if (this.json.isInput){\r \r if (this.combox){\r this.combox.clear();\r this.combox.addNewValues(comboxValues);\r \r // values.each(function(v){\r // if (typeOf(v)==\"string\"){\r // this.combox.addNewValue(v);\r // }else{\r // this.combox.addNewValue(this.getDataText(v), v);\r // }\r // }.bind(this));\r }else{\r var node = this.node.getFirst();\r if (node){\r node.empty();\r comboxValues.each(function(v, i){\r this.creteShowNode(v, (i===comboxValues.length-1)).inject(node);\r }.bind(this));\r }\r }\r \r }else{\r if (this.node.getFirst()){\r var node = this.node.getFirst();\r node.empty();\r this.loadOrgWidget(values, node)\r }else{\r this.node.empty();\r this.loadOrgWidget(values, this.node);\r }\r }\r \r //if (this.readonly) this.loadOrgWidget(values, this.node)\r //this.node.set(\"text\", value);\r },\r getValueMethod: function(value){\r if (value){\r var flag = value.substr(value.length-2, 2);\r switch (flag.toLowerCase()){\r case \"@i\":\r return \"getIdentity\";\r case \"@p\":\r return \"getPerson\";\r case \"@u\":\r return \"getUnit\";\r case \"@g\":\r return \"getGroup\";\r default:\r return (this.json.selectType===\"unit\") ? \"getUnit\" : \"getIdentity\";\r }\r }\r return (this.json.selectType===\"unit\") ? \"getUnit\" : \"getIdentity\";\r },\r loadOrgWidget: function(value, node){\r var disableInfor = layout.mobile ? true : false;\r if( this.json.showCard === \"no\" )disableInfor = true;\r var height = node.getStyle(\"height\").toInt();\r if (node.getStyle(\"overflow\")===\"visible\" &amp;&amp; !height) node.setStyle(\"overflow\", \"hidden\");\r if (value &amp;&amp; value.length){\r value.each(function(data){\r var flag = data.distinguishedName.substr(data.distinguishedName.length-2, 2);\r var copyData = Object.clone(data);\r if( this.json.displayTextScript &amp;&amp; this.json.displayTextScript.code ){\r this.currentData = copyData;\r var displayName = this.form.Macro.exec(this.json.displayTextScript.code, this);\r if( displayName ){\r copyData.displayName = displayName;\r }\r this.currentData = null;\r }\r \r var widget;\r switch (flag.toLowerCase()){\r case \"@i\":\r widget = new MWF.widget.O2Identity(copyData, node, {\"style\": \"xform\",\"lazy\":true,\"disableInfor\" : disableInfor});\r break;\r case \"@p\":\r widget = new MWF.widget.O2Person(copyData, node, {\"style\": \"xform\",\"lazy\":true,\"disableInfor\" : disableInfor});\r break;\r case \"@u\":\r widget = new MWF.widget.O2Unit(copyData, node, {\"style\": \"xform\",\"lazy\":true,\"disableInfor\" : disableInfor});\r break;\r case \"@g\":\r widget = new MWF.widget.O2Group(copyData, node, {\"style\": \"xform\",\"lazy\":true,\"disableInfor\" : disableInfor});\r break;\r default:\r widget = new MWF.widget.O2Other(copyData, node, {\"style\": \"xform\",\"lazy\":true,\"disableInfor\" : disableInfor});\r }\r widget.field = this;\r if( layout.mobile ){\r widget.node.setStyles({\r \"float\" : \"none\"\r })\r }\r }.bind(this));\r }\r },\r _loadStyles: function(){\r if (this.readonly || this.json.isReadonly){\r if (this.json.styles) this.node.setStyles(this.json.styles);\r }else{\r if (this.json.styles) this.node.setStyles(this.json.styles);\r if (this.json.inputStyles) if (this.node.getFirst()) this.node.getFirst().setStyles(this.json.inputStyles);\r if (this.iconNode &amp;&amp; this.iconNode.offsetParent !== null ){\r var size = this.node.getSize();\r this.iconNode.setStyle(\"height\", \"\"+size.y+\"px\");\r }\r }\r },\r \r checkEmpower : function( data, callback ){\r if( typeOf(data)===\"array\" &amp;&amp; this.identityOptions &amp;&amp; this.json.isCheckEmpower &amp;&amp; this.json.identityResultType === \"identity\" ) {\r var empowerChecker = new MWF.APPOrg.EmpowerChecker(this.form, this.json);\r empowerChecker.load(data, callback);\r }else{\r if( callback )callback( data );\r }\r }\r \r });\r \r MWF.APPOrg.EmpowerChecker = new Class({\r Implements: [Events],\r initialize: function (form, json) {\r this.form = form;\r this.json = json;\r this.css = this.form.css;\r this.checkedAllItems = true;\r },\r load : function( data, callback, container ){\r if( typeOf(data)===\"array\" &amp;&amp; this.json.isCheckEmpower &amp;&amp; this.json.identityResultType === \"identity\" ){\r var array = [];\r data.each( function( d ){\r if( d.distinguishedName ){\r var flag = d.distinguishedName.substr(d.distinguishedName.length-1, 1).toLowerCase();\r if( flag === \"i\" ){\r array.push( d.distinguishedName )\r }\r }\r }.bind(this));\r if( array.length > 0 ){\r o2.Actions.get(\"x_organization_assemble_express\").listEmpowerWithIdentity({\r \"application\" : (this.form.businessData.work || this.form.businessData.workCompleted).application,\r \"process\" : (this.form.businessData.work || this.form.businessData.workCompleted).process,\r \"work\" : (this.form.businessData.work || this.form.businessData.workCompleted).id,\r \"identityList\" : array\r }, function( json ){\r var arr = [];\r json.data.each( function(d){\r if(d.fromIdentity !== d.toIdentity )arr.push(d);\r });\r if( arr.length > 0 ){\r this.openSelectEmpowerDlg( arr, data, callback, container );\r }else{\r if( callback )callback( data );\r }\r }.bind(this), function(){\r if( callback )callback( data );\r }.bind(this))\r }else{\r if( callback )callback( data );\r }\r }else{\r if( callback )callback( data );\r }\r },\r getIgnoreEmpowerArray : function( callback ){\r var array = [];\r if( this.empowerSelectNodes &amp;&amp; this.empowerSelectNodes.length ){\r this.empowerSelectNodes.each(function(node){\r if( !node.retrieve(\"isSelected\") ){\r var d = node.retrieve(\"data\");\r array.push( d.fromIdentity );\r }\r }.bind(this));\r }\r if( callback )callback( array );\r return array;\r },\r setIgnoreEmpowerFlag : function(data, callback){\r \r var ignoreList = this.getIgnoreEmpowerArray();\r for( var i=0; i&lt;data.length; i++ ){\r var d = data[i];\r if( ignoreList.indexOf( d.distinguishedName ) > -1 ){\r d.ignoreEmpower = true;\r }else if( d.ignoreEmpower ){\r delete d.ignoreEmpower;\r }\r }\r if( callback )callback( data );\r },\r replaceEmpowerIdentity : function(data, callback){\r \r var empowerData = {};\r this.empowerSelectNodes.each(function(node){\r if( node.retrieve(\"isSelected\") ){\r var d = node.retrieve(\"data\");\r empowerData[ d.fromIdentity ] = d;\r }\r }.bind(this));\r \r if( Object.keys(empowerData).length === 0 ){\r callback( data );\r }else{\r var identityList = [];\r for( var key in empowerData ){\r identityList.push( empowerData[key].toIdentity );\r }\r o2.Actions.get(\"x_organization_assemble_express\").listIdentity({ \"identityList\" : identityList }, function(json){\r var newData = data.clone();\r var d = {};\r json.data.each( function(j){\r d[j.distinguishedName] = j;\r });\r for( var i=0; i&lt;newData.length; i++ ){\r var nd = newData[i];\r if( nd.distinguishedName &amp;&amp; empowerData[nd.distinguishedName]){\r if( d[empowerData[nd.distinguishedName].toIdentity] ){\r newData[i] = d[empowerData[nd.distinguishedName].toIdentity]\r }\r }\r }\r callback( newData );\r },function(){\r callback( data );\r });\r }\r },\r openSelectEmpowerDlg : function( data, orginData, callback, container ){\r if( layout.mobile ){\r this.openSelectEmpowerDlg_mobile(data, orginData, callback, container);\r }else{\r this.openSelectEmpowerDlg_pc(data, orginData, callback, container);\r }\r },\r openSelectEmpowerDlg_mobile : function( data, orginData, callback, container ){\r \r \r \r var that = this;\r \r //处理json\r var subItemList = [];\r // var empowerMap = {};\r \r // var selectableItems = [];\r var valueList = [];\r \r data.each( function( d ){\r subItemList.push({\r \"name\" : d.fromIdentity.split(\"@\")[0] + \" 授权给 \" + d.toIdentity.split(\"@\")[0],\r \"id\" : d.fromIdentity + \"#\" + d.toIdentity\r })\r valueList.push({\r \"name\" : d.fromIdentity.split(\"@\")[0] + \" 授权给 \" + d.toIdentity.split(\"@\")[0],\r \"id\" : d.fromIdentity + \"#\" + d.toIdentity\r })\r // empowerMap[ d.fromIdentity ] = d.toIdentity;\r }.bind(this));\r \r if( subItemList.length === 0 ){\r callback();\r return;\r }\r var empowerList = Array.clone(subItemList);\r \r // selectableItems.push({\r // \"empowerMap\" : empowerMap,\r // \"subItemList\" : subItemList\r // });\r \r // if( selectableItems.length === 0 ){\r // callback();\r // return;\r // }\r // var empowerList = Array.clone(selectableItems);\r o2.xDesktop.requireApp(\"Template\", \"Selector.Custom\", function () {\r var options = {\r \"count\": 0,\r \"title\": MWF.xApplication.process.Xform.LP.selectEmpower,\r \"selectAllEnable\" : true,\r \"selectableItems\": subItemList,\r \"expand\": false,\r \"category\": false,\r \"values\": valueList,\r \"zIndex\" : 3001,\r \"closeOnclickOk\" : true,\r \"onComplete\": function (items) {\r \r var arr = [];\r items.each(function (item) {\r arr.push( item.data.id )\r }.bind(this));\r \r var ignoreList = [];\r empowerList.each( function (obj) {\r if( arr.indexOf( obj.id ) === -1 )ignoreList.push( obj.id.split(\"#\")[0] )\r });\r \r for( var i=0; i&lt;orginData.length; i++ ){\r var d = orginData[i];\r if( ignoreList.indexOf( d.distinguishedName ) > -1 ){\r d.ignoreEmpower = true;\r }else if( d.ignoreEmpower ){\r delete d.ignoreEmpower;\r }\r }\r if( callback )callback( orginData );\r \r // empowerList.each( function(obj){\r // var list = obj.subItemList.filter(function(item, index){\r // return !arr.contains( item.id );\r // }.bind(this));\r // ignoreList = ignoreList.map(function(item,index){\r // return item.id.split(\"#\")[1];\r // })\r // });\r \r // empowerList.each( function(obj){\r // var org = that.orgItemsObject[obj.orgId];\r // // if( obj.ignoreList.length > 0 ){\r // var data = org.getData();\r // for( var i=0; i&lt;data.length; i++ ){\r // var d = data[i];\r // if( obj.ignoreList.indexOf( d.distinguishedName ) > -1 ){\r // d.ignoreEmpower = true;\r // }else if( d.ignoreEmpower ){\r // delete d.ignoreEmpower;\r // }\r // }\r // org.setData( data );\r // }\r \r // if( obj.empowerMap ){\r // var data = org.getValue();\r // for( var i=0; i&lt;data.length; i++ ){\r // var d = data[i];\r // if( obj.empowerMap[ d.distinguishedName ] ){\r // d.empowerToIdentity = obj.empowerMap[ d.distinguishedName ];\r // }\r // }\r // org.empowerData = Array.clone(data);\r // }\r \r // if(callback)callback();\r // })\r }.bind(this)\r };\r if( this.form.json.selectorStyle ){\r Object.merge(options, this.form.json.selectorStyle );\r }\r options.flatCategory = false;\r var selector = new o2.xApplication.Template.Selector.Custom($(document.body), options);\r selector.load();\r }.bind(this))\r },\r openSelectEmpowerDlg_pc : function( data, orginData, callback, container ){\r var node = new Element(\"div\", {\"styles\": this.css.empowerAreaNode});\r var html = \"&lt;div style=\\\"line-height: 20px; color: #333333; overflow: hidden\\\">\"+MWF.xApplication.process.Xform.LP.empowerDlgText+\"&lt;/div>\";\r html += \"&lt;div style=\\\"margin-bottom:10px; margin-top:10px; overflow-y:auto;\\\">&lt;/div>\";\r node.set(\"html\", html);\r var itemNode = node.getLast();\r this.getEmpowerItems(itemNode, data);\r node.inject( container || this.form.app.content);\r \r var dlg = o2.DL.open({\r \"title\": MWF.xApplication.process.Xform.LP.selectEmpower,\r \"style\": this.form.json.dialogStyle || \"user\",\r \"isResize\": true,\r \"content\": node,\r \"width\": 630,\r //\"height\" : 500,\r \"buttonList\": [\r {\r \"type\" : \"ok\",\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(d, e){\r //this.replaceEmpowerIdentity( orginData, callback ); //直接替换已授权的人，已废弃\r this.setIgnoreEmpowerFlag( orginData, callback ); //然后设置忽略的人的标志\r dlg.close();\r }.bind(this)\r },\r {\r \"type\" : \"cancel\",\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){dlg.close();}\r }\r ],\r \"onPostShow\": function(){\r var selectNode = this.createSelectAllEmpowerNode();\r selectNode.inject( dlg.button );\r if( layout.mobile ){\r dlg.node.inject( $(document.body) );\r dlg.node.setStyles({\r \"width\":\"100%\",\r \"height\": \"100%\",\r \"top\" : \"0px\",\r \"left\" : \"0px\"\r });\r var y = dlg.node.getSize().y - 190;\r itemNode.setStyle(\"height\",y+\"px\");\r \r dlg.options.contentHeight = dlg.node.getSize().y - 100 ; //+100;\r dlg.setContentSize();\r }else{\r dlg.content.setStyle(\"overflow\",\"hidden\");\r \r var y = Math.min(300, itemNode.getSize().y);\r var marginTop = itemNode.getStyle(\"margin-top\");\r var marginBottom = itemNode.getStyle(\"margin-bottom\");\r itemNode.setStyle(\"height\",y+\"px\");\r \r dlg.options.contentHeight = y + 30 + 20 ; //+100;\r dlg.setContentSize();\r dlg.node.setStyles({\r \"height\": \"\"+(dlg.options.height) +\"px\"\r });\r dlg.reCenter();\r }\r \r }.bind(this)\r });\r },\r getEmpowerItems: function(itemNode, data){\r var _self = this;\r this.empowerSelectNodes = [];\r var count = 1;\r var node;\r data.each(function( d ){\r if(d.fromIdentity == d.toIdentity )return;\r if( count % 2 === 1 ){\r node = new Element(\"div\", {\"styles\": this.css.empowerItemOddNode}).inject(itemNode);\r node.store(\"nodeType\",\"Odd\");\r //node.setStyle(\"margin-right\",\"10px\");\r }else{\r node = new Element(\"div\", {\"styles\": this.css.empowerItemEvenNode}).inject(itemNode);\r node.store(\"nodeType\",\"Even\");\r }\r count++;\r this.empowerSelectNodes.push( node );\r node.store(\"data\", d);\r var iconNode = new Element(\"div.empowerItemIconNode\", {\"styles\": this.css.empowerItemIconNode}).inject(node);\r node.store(\"iconNode\",iconNode);\r var contentNode = new Element(\"div.empowerItemContentNode\", {\"styles\": this.css.empowerItemContentNode}).inject(node);\r \r var formIdentityNode = new Element(\"div.empowerItemPersonNode\", {\"styles\": this.css.empowerItemPersonNode, text : d.fromIdentity.split(\"@\")[0] }).inject(contentNode);\r var titleNode = new Element(\"div.empowerItemTitleNode\", {\"styles\": this.css.empowerItemTitleNode, text : MWF.xApplication.process.Xform.LP.empowerTo }).inject(contentNode);\r var toIdentityNode = new Element(\"div.empowerItemPersonNode\", {\"styles\": this.css.empowerItemPersonNode, text : d.toIdentity.split(\"@\")[0] }).inject(contentNode);\r \r node.addEvents({\r \"mouseover\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected){\r this.setStyles(_self.css[ \"empowerItem\"+this.retrieve(\"nodeType\")+\"Node_over\" ]);\r if( _self.css.empowerItemIconNode_over ){\r var iconNode = this.retrieve(\"iconNode\");\r if(iconNode)iconNode.setStyles(_self.css.empowerItemIconNode_over);\r }\r }\r },\r \"mouseout\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected){\r this.setStyles(_self.css[ \"empowerItem\"+this.retrieve(\"nodeType\")+\"Node\" ])\r if( _self.css.empowerItemIconNode_over ){\r var iconNode = this.retrieve(\"iconNode\");\r if(iconNode)iconNode.setStyles(_self.css.empowerItemIconNode);\r }\r }\r },\r \"click\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (isSelected){\r _self.unselectEmpowerItem( this)\r }else{\r _self.selectEmpowerItem(this)\r }\r }\r });\r if( this.checkedAllItems )node.click();\r }.bind(this));\r },\r unselectEmpowerItem : function( itemNode ){\r itemNode.store(\"isSelected\", false);\r itemNode.setStyles( this.css[ \"empowerItem\"+itemNode.retrieve(\"nodeType\")+\"Node\" ] );\r itemNode.getElements(\"div\").each( function( div ){\r var className = div.get(\"class\");\r if( className &amp;&amp; this.css[className] )div.setStyles( this.css[className] )\r }.bind(this))\r },\r selectEmpowerItem : function( itemNode ){\r itemNode.store(\"isSelected\", true);\r itemNode.setStyles( this.css[ \"empowerItem\"+itemNode.retrieve(\"nodeType\")+\"Node_selected\" ] );\r itemNode.getElements(\"div\").each( function( div ){\r var className = div.get(\"class\");\r if( className &amp;&amp; this.css[className+\"_selected\"] )div.setStyles( this.css[className+\"_selected\"] )\r }.bind(this))\r },\r createSelectAllEmpowerNode : function(){\r var _self = this;\r var node = new Element(\"div\", {\r styles : this.css.empowerSelectAllItemNode,\r text : MWF.xApplication.process.Xform.LP.selectAll\r });\r node.addEvents({\r \"mouseover\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(_self.css.empowerSelectAllItemNode_over);\r },\r \"mouseout\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (!isSelected) this.setStyles(_self.css.empowerSelectAllItemNode)\r },\r \"click\": function(){\r var isSelected = this.retrieve(\"isSelected\");\r if (isSelected){\r this.store(\"isSelected\", false);\r this.setStyles( _self.css.empowerSelectAllItemNode );\r _self.empowerSelectNodes.each( function(itemNode){\r _self.unselectEmpowerItem(itemNode)\r }.bind(this))\r }else{\r this.store(\"isSelected\", true);\r this.setStyles( _self.css.empowerSelectAllItemNode_selected );\r _self.empowerSelectNodes.each( function(itemNode){\r _self.selectEmpowerItem(itemNode)\r }.bind(this))\r }\r }\r });\r if( this.checkedAllItems ){\r node.store(\"isSelected\", true);\r node.setStyles( _self.css.empowerSelectAllItemNode_selected );\r }\r return node;\r }\r });\r \r MWF.APPOrg.GroupOptions = new Class({\r Implements: [Events],\r initialize: function (form, json) {\r this.form = form;\r this.json = json;\r this.orgAction = MWF.Actions.get(\"x_organization_assemble_control\");\r },\r getOptions: function(){\r var count = (this.json.groupCount) ? this.json.groupCount : 0;\r if( this.json.groupRange===\"group\" ){\r return {\r \"count\": count,\r \"storeRange\" : this.json.storeRange,\r \"include\": this.getSelectRange( true )\r }\r }else{\r return {\r \"count\": count,\r \"storeRange\" : this.json.storeRange\r }\r }\r },\r getSearchOptions : function(){\r return {};\r },\r getSelectRange : function( refresh ){\r if( !this.selectRange || refresh){\r this.selectRange = this._getSelectRange();\r }\r return this.selectRange;\r },\r _getSelectRange : function(){\r var rangeValues = [];\r if (this.json.groupRangeKey &amp;&amp; this.json.groupRangeKey.code){\r var v = this.form.Macro.exec(this.json.groupRangeKey.code, this);\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r rangeValues = v;\r //v.each(function(d){\r // if (d){\r // if (typeOf(d)===\"string\"){\r // var data;\r // this.orgAction.getGroup(function(json){ data = json.data }.bind(this), null, d, false);\r // rangeValues.push(data);\r // }else{\r // rangeValues.push(d);\r // }\r // }\r //}.bind(this));\r }\r return rangeValues;\r }\r });\r \r MWF.APPOrg.UnitOptions = new Class({\r Implements: [Events],\r initialize : function( form, json ){\r this.form = form;\r this.json = json;\r this.orgAction = MWF.Actions.get(\"x_organization_assemble_control\");\r },\r getOptions: function(){\r \r var count = (this.json.unitCount) ? this.json.unitCount : 0;\r var selectUnits = this.getSelectRange( true );\r \r return {\r \"count\": count,\r \"units\": selectUnits,\r \"unitType\": (this.json.selectUnitType===\"all\") ? \"\" : this.json.selectUnitType,\r \"storeRange\" : this.json.storeRange,\r \"expandSubEnable\" : (this.json.unitExpandSubEnable==\"no\") ? false : true\r };\r },\r getSearchOptions : function(){\r var selectUnits = this.getSelectRange( true );\r return {\r \"units\": selectUnits,\r \"unitType\": (this.json.selectUnitType===\"all\") ? \"\" : this.json.selectUnitType\r };\r },\r getSelectRange : function( refresh ){\r if( !this.selectRange || refresh){\r this.selectRange = this._getSelectRange();\r }\r return this.selectRange;\r },\r _getSelectRange : function(){\r if (this.json.unitRange===\"unit\"){\r return this.getScriptSelectUnit();\r }\r if (this.json.unitRange===\"draftUnit\"){\r var dn = (this.form.businessData.work || this.form.businessData.workCompleted).creatorIdentityDn;\r if (!dn){\r if ( layout.session.user.identityList &amp;&amp; layout.session.user.identityList.length){\r var ids = [];\r layout.session.user.identityList.each(function(id){ ids.push(id.id); });\r return this.getNextSelectUnit(ids);\r }else{\r return [];\r }\r }else{\r return this.getNextSelectUnit((this.form.businessData.work || this.form.businessData.workCompleted).creatorIdentityDn);\r }\r }\r if (this.json.unitRange===\"currentUnit\"){\r if (this.form.app.currentTask){\r return this.getNextSelectUnit(this.form.app.currentTask.identityDn);\r }else{\r if (this.form.app.taskList &amp;&amp; this.form.app.taskList.length){\r var ids = [];\r this.form.app.taskList.each(function(task){ ids.push(task.identity); });\r return this.getNextSelectUnit(ids);\r }else{\r if ( layout.session.user.identityList &amp;&amp; layout.session.user.identityList.length){\r var ids = [];\r layout.session.user.identityList.each(function(id){ ids.push(id.id); });\r return this.getNextSelectUnit(ids);\r }else{\r return [];\r }\r }\r }\r }\r return [];\r },\r getScriptSelectUnit: function(){\r var rangeValues = [];\r if (this.json.unitRangeUnit &amp;&amp; this.json.unitRangeUnit.length){\r this.json.unitRangeUnit.each(function(unit){\r //var unitFlag = unit.distinguishedName || unit.id || unit.unique || unit.levelName;\r //if (unitFlag) rangeValues.push(unitFlag);\r rangeValues.push(unit);\r }.bind(this));\r }\r if (this.json.unitRangeField &amp;&amp; this.json.unitRangeField.length){\r this.json.unitRangeField.each(function(field){\r var n = (typeOf(field)==\"object\") ? field.name : field;\r var v = this.form.businessData.data[n];\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d){\r // if (typeOf(d)===\"string\"){\r // var data;\r // this.orgAction.getUnit(function(json){ data = json.data }.bind(this), null, d, false);\r // rangeValues.push(data);\r // }else{\r rangeValues.push(d);\r // }\r }\r }.bind(this));\r }.bind(this));\r }\r if (this.json.unitRangeKey &amp;&amp; this.json.unitRangeKey.code){\r var v = this.form.Macro.exec(this.json.unitRangeKey.code, this);\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d){\r // if (typeOf(d)===\"string\"){\r // var data;\r // this.orgAction.getUnit(function(json){ data = json.data }.bind(this), null, d, false);\r // rangeValues.push(data);\r // }else{\r rangeValues.push(d);\r // }\r }\r }.bind(this));\r }\r return rangeValues;\r },\r getNextSelectUnit: function(id){\r var ids = typeOf(id)===\"array\" ? id : [id];\r var data;\r var units = [];\r ids.each( function(i){\r if (this.json.unitRangeNext === \"direct\"){\r this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, i, false);\r if (data &amp;&amp; data.woUnit) units.push(data.woUnit);\r }else if(this.json.unitRangeNext===\"level\"){\r this.orgAction.getUnitWithIdentityWithLevel(i, this.json.unitRangeNextLevel, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r if (data) units.push(data);\r }else if (this.json.unitRangeNext===\"type\"){\r if (this.json.unitRangeNextUnitType===\"all\"){\r this.orgAction.getUnitWithIdentityWithLevel(i, 1, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r }else{\r this.orgAction.getUnitWithIdentityWithType(i, this.json.unitRangeNextUnitType, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r }\r if (data) units.push(data);\r }\r data = null;\r }.bind(this));\r return units;\r //if (this.json.unitRangeNext === \"direct\"){\r // if (typeOf(id)===\"array\"){\r // var units = [];\r // id.each(function(i){\r // this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, i, false);\r // if (data &amp;&amp; data.woUnit) units.push(data.woUnit);\r // data = null;\r // }.bind(this));\r // return units;\r // }else{\r // this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, id, false);\r // return (data.woUnit) ? [data.woUnit] : [];\r // }\r //}\r //if (this.json.unitRangeNext===\"level\"){\r // this.orgAction.getUnitWithIdentityWithLevel(id, this.json.unitRangeNextLevel, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // //this.json.rangeNextLevel\r // return (data) ? [data] : [];\r //}\r //if (this.json.unitRangeNext===\"type\"){\r // if (this.json.unitRangeNextUnitType===\"all\"){\r // this.orgAction.getUnitWithIdentityWithLevel(id, 1, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // }else{\r // this.orgAction.getUnitWithIdentityWithType(id, this.json.unitRangeNextUnitType, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // }\r //\r // return (data) ? [data] : [];\r //}\r \r }\r });\r \r MWF.APPOrg.IdentityOptions = new Class({\r Implements: [Events],\r initialize : function( form, json ){\r this.form = form;\r this.json = json;\r this.orgAction = MWF.Actions.get(\"x_organization_assemble_control\");\r },\r getOptions: function(){\r var count = (this.json.identityCount) ? this.json.identityCount : 0;\r if( this.json.identityOnlyUseInclude ){\r return {\r \"noUnit\" : true,\r \"count\": count,\r \"resultType\" : this.json.identityResultType,\r \"storeRange\" : this.json.storeRange,\r \"include\" : this._getInclude()\r };\r }else{\r var selectUnits = this.getSelectRange( true );\r var selectDutys = this.getSelectRangeDuty( true );\r return {\r \"count\": count,\r \"units\": selectUnits,\r \"dutys\": selectDutys,\r \"expandSubEnable\" : (this.json.identityExpandSubEnable==\"no\") ? false : true,\r \"resultType\" : this.json.identityResultType,\r \"categoryType\": this.json.categoryType || \"unit\",\r \"dutyUnitLevelBy\" : this.json.dutyUnitLevelBy || \"duty\",\r \"storeRange\" : this.json.storeRange,\r \"include\" : this._getInclude()\r };\r }\r },\r getSearchOptions : function(){\r var selectUnits = this.getSelectRange( true );\r var selectDutys = this.getSelectRangeDuty( true );\r return {\r \"units\": selectUnits,\r \"dutys\": selectDutys,\r \"resultType\" : this.json.identityResultType\r };\r },\r getSelectRange : function( refresh ){\r if( !this.selectRange || refresh ){\r this.selectRange = this._getSelectRange();\r }\r return this.selectRange;\r },\r _getInclude : function(){\r var include = [];\r if( this.json.identityIncludeKey ){\r var v = this.form.Macro.exec(this.json.identityIncludeKey.code, this);\r if( v )include = typeOf(v)===\"array\" ? v : [v];\r }\r return include;\r },\r _getSelectRange : function(){\r if (this.json.identityRange===\"unit\"){\r return this.getScriptSelectUnit();\r }\r if (this.json.identityRange===\"draftUnit\"){\r var dn = (this.form.businessData.work || this.form.businessData.workCompleted).creatorIdentityDn;\r if (!dn){\r if ( layout.session.user.identityList &amp;&amp; layout.session.user.identityList.length){\r var ids = [];\r layout.session.user.identityList.each(function(id){ ids.push(id.id); });\r return this.getNextSelectUnit(ids);\r }else{\r return [];\r }\r }else{\r return this.getNextSelectUnit((this.form.businessData.work || this.form.businessData.workCompleted).creatorIdentityDn);\r }\r }\r if (this.json.identityRange===\"currentUnit\"){\r if (this.form.app.currentTask){\r return this.getNextSelectUnit(this.form.app.currentTask.identityDn);\r }else{\r if (this.form.app.taskList &amp;&amp; this.form.app.taskList.length){\r var ids = [];\r this.form.app.taskList.each(function(task){ ids.push(task.identity); });\r return this.getNextSelectUnit(ids);\r }else{\r if ( layout.session.user.identityList &amp;&amp; layout.session.user.identityList.length){\r var ids = [];\r layout.session.user.identityList.each(function(id){ ids.push(id.id); });\r return this.getNextSelectUnit(ids);\r }else{\r return [];\r }\r }\r }\r }\r return [];\r },\r getScriptSelectUnit: function(){\r var rangeValues = [];\r if (this.json.identityRangeUnit &amp;&amp; this.json.identityRangeUnit.length){\r this.json.identityRangeUnit.each(function(unit){\r //var unitFlag = unit.distinguishedName || unit.id || unit.unique || unit.levelName ;\r //if (unitFlag) rangeValues.push(unitFlag);\r rangeValues.push(unit);\r }.bind(this));\r }\r if (this.json.identityRangeField &amp;&amp; this.json.identityRangeField.length){\r this.json.identityRangeField.each(function(field){\r var n = (typeOf(field)==\"object\") ? field.name : field;\r var v = this.form.businessData.data[n];\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d){\r // if (typeOf(d)===\"string\"){\r // var data;\r // this.orgAction.getUnit(function(json){ data = json.data }.bind(this), null, d, false);\r // rangeValues.push(data);\r // }else{\r rangeValues.push(d);\r // }\r }\r }.bind(this));\r }.bind(this));\r }\r if (this.json.identityRangeKey &amp;&amp; this.json.identityRangeKey.code){\r var v = this.form.Macro.exec(this.json.identityRangeKey.code, this);\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d){\r // if (typeOf(d)===\"string\"){\r // var data;\r // this.orgAction.getUnit(function(json){ data = json.data }.bind(this), null, d, false);\r // rangeValues.push(data);\r // }else{\r rangeValues.push(d);\r // }\r }\r }.bind(this));\r }\r return rangeValues;\r },\r getNextSelectUnit: function(id){\r var ids = typeOf(id)===\"array\" ? id : [id];\r var data;\r var units = [];\r ids.each(function(i){\r if (this.json.identityRangeNext === \"direct\"){\r this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, i, false);\r if (data &amp;&amp; data.woUnit) units.push(data.woUnit);\r }else if (this.json.identityRangeNext===\"level\"){\r this.orgAction.getUnitWithIdentityWithLevel(i, this.json.identityRangeNextLevel, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r if (data) units.push(data);\r }else if (this.json.identityRangeNext===\"type\"){\r if (this.json.identityRangeNextUnitType===\"all\"){\r this.orgAction.getUnitWithIdentityWithLevel(i, 1, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r }else{\r this.orgAction.getUnitWithIdentityWithType(i, this.json.identityRangeNextUnitType, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r }\r if (data) units.push(data);\r }\r data = null;\r }.bind(this));\r return units;\r \r //if (this.json.identityRangeNext === \"direct\"){\r //if (typeOf(id)===\"array\"){\r // var units = [];\r // id.each(function(i){\r // this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, i, false);\r // if (data &amp;&amp; data.woUnit) units.push(data.woUnit);\r // data = null;\r // }.bind(this));\r // return units;\r //}else{\r // this.orgAction.getIdentity(function(json){ data = json.data }.bind(this), function(){data={\"woUnit\": null}}, id, false);\r // return (data.woUnit) ? [data.woUnit] : [];\r //}\r //}\r //if (this.json.identityRangeNext===\"level\"){\r // this.orgAction.getUnitWithIdentityWithLevel(id, this.json.identityRangeNextLevel, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // return (data) ? [data] : [];\r // //this.json.rangeNextLevel\r //}\r //if (this.json.identityRangeNext===\"type\"){\r // if (this.json.identityRangeNextUnitType===\"all\"){\r // this.orgAction.getUnitWithIdentityWithLevel(id, 1, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // }else{\r // this.orgAction.getUnitWithIdentityWithType(id, this.json.identityRangeNextUnitType, function(json){ data = json.data }.bind(this), function(){data=null;}, false);\r // }\r // return (data) ? [data] : [];\r //}\r \r },\r \r getSelectRangeDuty: function( refresh ){\r if( !this.selectRangeDuty || refresh ){\r this.selectRangeDuty = this._getSelectRangeDuty();\r }\r return this.selectRangeDuty;\r },\r _getSelectRangeDuty: function(){\r if (this.json.dutyRange===\"duty\"){\r return this.getScriptSelectDuty();\r }\r return [];\r },\r getScriptSelectDuty: function(){\r var rangeValues = [];\r if( this.json.rangeDuty &amp;&amp; this.json.rangeDuty.length ){\r var rangeDuty = this.json.rangeDuty;\r if( typeOf(rangeDuty) === \"string\" ){\r rangeDuty = JSON.parse( rangeDuty );\r }\r if( typeOf(rangeDuty) === \"array\" ){\r rangeDuty.each(function(unit){\r var unitFlag = typeOf(unit) === \"string\" ? unit : (unit.id || unit.name);\r if (unitFlag) rangeValues.push(unitFlag);\r }.bind(this));\r }\r }\r //if (this.json.rangeDuty &amp;&amp; this.json.rangeDuty.length){\r // this.json.rangeDuty.each(function(unit){\r // var unitFlag = unit.id || unit.name;\r // if (unitFlag) rangeValues.push(unitFlag);\r // }.bind(this));\r //}\r if (this.json.rangeDutyField &amp;&amp; this.json.rangeDutyField.length){\r this.json.rangeDutyField.each(function(field){\r var n = (typeOf(field)==\"object\") ? field.name : field;\r var v = this.form.businessData.data[n];\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d) rangeValues.push(d);\r }.bind(this));\r }.bind(this));\r }\r if (this.json.rangeDutyKey &amp;&amp; this.json.rangeDutyKey.code){\r var v = this.form.Macro.exec(this.json.rangeDutyKey.code, this);\r if (typeOf(v)!==\"array\") v = (v) ? [v.toString()] : [];\r v.each(function(d){\r if (d) rangeValues.push(d);\r }.bind(this));\r }\r return rangeValues;\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Radio.js.html":{"url":"x_component_process_Xform_Radio.js.html","title":"x_component_process_Xform/Radio.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Radio.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Radio.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r MWF.require(\"MWF.widget.UUID\", null, false);\r /** @class Radio 单选按钮。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Radio = MWF.APPRadio = new Class(\r /** @lends MWF.xApplication.process.Xform.Radio# */\r {\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r /**\r * @ignore\r * @member {Element} descriptionNode\r * @memberOf MWF.xApplication.process.Xform.Radio#\r */\r loadDescription: function(){},\r _loadNode: function(){\r if (this.readonly || this.json.isReadonly ){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r var radioValues = this.getOptions();\r var value = this.getValue();\r if (value){\r var texts = \"\";\r for (var i=0; i&lt;radioValues.length; i++){\r var item = radioValues[i];\r var tmps = item.split(\"|\");\r var t = tmps[0];\r var v = tmps[1] || t;\r \r // if (value.indexOf(v)!=-1){\r // texts = t;\r // break;\r // }\r if (value == v){\r texts = t;\r break;\r }\r }\r this.node.set(\"text\", texts);\r }\r },\r _resetNodeEdit: function(){\r var div = new Element(\"div\");\r div.set(this.json.properties);\r div.inject(this.node, \"after\");\r \r this.node.destroy();\r this.node = div;\r },\r _loadNodeEdit: function(){\r \t\t//this.container = new Element(\"select\");\r if (!this.json.preprocessing) this._resetNodeEdit();\r \r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type,\r \t\t\t\"styles\": {\r \t\t\t\t\"display\": \"inline\"\r \t\t\t}\r \t\t});\r \t\tthis.setOptions();\r \t},\r _loadDomEvents: function(){\r },\r _loadEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!=-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }else{\r //this.node.addEvent(key, function(event){\r // return this.form.Macro.fire(e.code, this, event);\r //}.bind(this));\r }\r }\r }.bind(this));\r },\r addModuleEvent: function(key, fun){\r if (this.options.moduleEvents.indexOf(key)!==-1){\r this.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }else{\r var inputs = this.node.getElements(\"input\");\r inputs.each(function(input){\r input.addEvent(key, function(event){\r return (fun) ? fun(this, event) : null;\r }.bind(this));\r }.bind(this));\r }\r },\r /**\r * @summary 刷新选择项，如果选择项是脚本，重新计算。\r * @example\r * this.form.get('fieldId').resetOption();\r */\r resetOption: function(){\r this.node.empty();\r this.setOptions();\r },\r /**\r * @summary 获取选择项。\r * @return {Array} 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：&lt;pre>&lt;code class='language-js'>[\r * \"女|female\",\r * \"男|male\"\r * ]&lt;/code>&lt;/pre>\r * @example\r * this.form.get('fieldId').getOptions();\r */\r \tgetOptions: function(){\r \t\tif (this.json.itemType == \"values\"){\r \t\t\treturn this.json.itemValues;\r \t\t}else{\r \t\t\treturn this.form.Macro.exec(this.json.itemScript.code, this);\r \t\t}\r \t\treturn [];\r \t},\r \r /**\r * @summary 获取整理后的选择项。\r * @return {Object} 返回整理后的选择项，如：\r * &lt;pre>&lt;code class='language-js'>{\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]}\r * &lt;/code>&lt;/pre>\r * @example\r * var optionData = this.form.get('fieldId').getOptionsObj();\r */\r getOptionsObj : function(){\r var textList = [];\r var valueList = [];\r var optionItems = this.getOptions();\r if (!optionItems) optionItems = [];\r if (o2.typeOf(optionItems)===\"array\"){\r optionItems.each(function(item){\r var tmps = item.split(\"|\");\r textList.push( tmps[0] );\r valueList.push( tmps[1] || tmps[0] );\r }.bind(this));\r }\r return { textList : textList, valueList : valueList };\r },\r \r setOptions: function(){\r var optionItems = this.getOptions();\r this._setOptions(optionItems);\r },\r \r \t_setOptions: function(optionItems){\r var p = o2.promiseAll(optionItems).then(function(radioValues){\r this.moduleSelectAG = null;\r \r if (!radioValues) radioValues = [];\r if (o2.typeOf(radioValues)===\"array\"){\r var flag = (new MWF.widget.UUID).toString();\r radioValues.each(function(item){\r var tmps = item.split(\"|\");\r var text = tmps[0];\r var value = tmps[1] || text;\r \r var radio = new Element(\"input\", {\r \"type\": \"radio\",\r \"name\": (this.json.properties &amp;&amp; this.json.properties.name) ? this.json.properties.name : flag+this.json.id,\r \"value\": value,\r \"showText\": text,\r \"styles\": this.json.buttonStyles\r }).inject(this.node);\r //radio.appendText(text, \"after\");\r \r var textNode = new Element( \"span\", {\r \"text\" : text,\r \"styles\" : { \"cursor\" : \"default\" }\r }).inject(this.node);\r textNode.addEvent(\"click\", function( ev ){\r if( this.radio.get(\"disabled\") === true || this.radio.get(\"disabled\") === \"true\" )return;\r this.radio.checked = true;\r this.radio.fireEvent(\"change\");\r this.radio.fireEvent(\"click\");\r }.bind( {radio : radio} ) );\r \r radio.addEvent(\"click\", function(){\r this.validationMode();\r if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r }.bind(this));\r \r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!=-1){\r }else{\r radio.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r }.bind(this));\r }\r }.bind(this), function(){\r this.moduleSelectAG = null;\r }.bind(this));\r this.moduleSelectAG = p;\r if (p) p.then(function(){\r this.moduleSelectAG = null;\r }.bind(this), function(){\r this.moduleSelectAG = null;\r }.bind(this));\r \r // this.moduleSelectAG = o2.AG.all(optionItems).then(function(radioValues){\r // this.moduleSelectAG = null;\r //\r // if (!radioValues) radioValues = [];\r // if (o2.typeOf(radioValues)===\"array\"){\r // var flag = (new MWF.widget.UUID).toString();\r // radioValues.each(function(item){\r // var tmps = item.split(\"|\");\r // var text = tmps[0];\r // var value = tmps[1] || text;\r //\r // var radio = new Element(\"input\", {\r // \"type\": \"radio\",\r // \"name\": (this.json.properties &amp;&amp; this.json.properties.name) ? this.json.properties.name : flag+this.json.id,\r // \"value\": value,\r // \"showText\": text,\r // \"styles\": this.json.buttonStyles\r // }).inject(this.node);\r // //radio.appendText(text, \"after\");\r //\r // var textNode = new Element( \"span\", {\r // \"text\" : text,\r // \"styles\" : { \"cursor\" : \"default\" }\r // }).inject(this.node);\r // textNode.addEvent(\"click\", function( ev ){\r // if( this.radio.get(\"disabled\") === true || this.radio.get(\"disabled\") === \"true\" )return;\r // this.radio.checked = true;\r // this.radio.fireEvent(\"change\");\r // this.radio.fireEvent(\"click\");\r // }.bind( {radio : radio} ) );\r //\r // radio.addEvent(\"click\", function(){\r // this.validationMode();\r // if (this.validation()) this._setBusinessData(this.getInputData(\"change\"));\r // }.bind(this));\r //\r // Object.each(this.json.events, function(e, key){\r // if (e.code){\r // if (this.options.moduleEvents.indexOf(key)!=-1){\r // }else{\r // radio.addEvent(key, function(event){\r // return this.form.Macro.fire(e.code, this, event);\r // }.bind(this));\r // }\r // }\r // }.bind(this));\r // }.bind(this));\r // }\r // }.bind(this))\r // if (this.moduleSelectAG) this.moduleSelectAG.then(function(){\r // this.moduleSelectAG = null;\r // }.bind(this));\r \t},\r \r _setValue: function(value, m){\r var mothed = m || \"__setValue\";\r \t if (!!value){\r var p = o2.promiseAll(value).then(function(v){\r if (o2.typeOf(v)==\"array\") v = v[0];\r if (this.moduleSelectAG){\r this.moduleValueAG = this.moduleSelectAG;\r this.moduleSelectAG.then(function(){\r this[mothed](v);\r return v;\r }.bind(this), function(){});\r }else{\r this[mothed](v)\r }\r return v;\r }.bind(this), function(){});\r \r this.moduleValueAG = p;\r if (this.moduleValueAG) this.moduleValueAG.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r }else{\r this[mothed](value);\r }\r \r \r // this.moduleValueAG = o2.AG.all(value).then(function(v){\r // if (o2.typeOf(v)==\"array\") v = v[0];\r // if (this.moduleSelectAG){\r // this.moduleValueAG = this.moduleSelectAG;\r // this.moduleSelectAG.then(function(){\r // this.__setValue(v);\r // }.bind(this));\r // }else{\r // this.__setValue(v)\r // }\r // return v;\r // }.bind(this));\r //\r // if (this.moduleValueAG) this.moduleValueAG.then(function(){\r // this.moduleValueAG = null;\r // }.bind(this));\r },\r \r __setValue: function(value){\r this._setBusinessData(value);\r \t\tvar radios = this.node.getElements(\"input\");\r \t\tfor (var i=0; i&lt;radios.length; i++){\r \t\t\tvar radio = radios[i];\r \t\t\tif (radio.value==value){\r \t\t\t\tradio.checked = true;\r \t\t\t\tbreak;\r \t\t\t}\r \t\t}\r \t},\r /**\r * @summary 获取选中项的value和text。\r * @return {Object} 返回选中项的value和text，如：\r * &lt;pre>&lt;code class='language-js'>{\"value\": [\"male\"], \"text\": [\"男\"]}\r * {\"value\": [\"\"], \"text\": [\"\"]}\r * &lt;/code>&lt;/pre>\r * @example\r * var data = this.form.get('fieldId').getTextData();\r * var text = data.text[0] //获取选中项的文本\r */\r \tgetTextData: function(){\r \t\tvar inputs = this.node.getElements(\"input\");\r \t\tvar value = \"\";\r \t\tvar text = \"\";\r \t\tif (inputs.length){\r \t\t\tfor (var i=0; i&lt;inputs.length; i++){\r \t\t\t\tvar input = inputs[i];\r \t\t\t\tif (input.checked){\r \t\t\t\t\tvalue = input.get(\"value\");\r \t\t\t\t\ttext = input.get(\"showText\");\r \t\t\t\t\tbreak;\r \t\t\t\t}\r \t\t\t}\r \t\t}\r \t\treturn {\"value\": [value] || \"\", \"text\": [text || value || \"\"]};\r \t},\r getInputData: function(){\r if (this.readonly || this.json.isReadonly ){\r return this._getBusinessData();\r }else{\r var inputs = this.node.getElements(\"input\");\r var value = \"\";\r if (inputs.length){\r for (var i=0; i&lt;inputs.length; i++){\r var input = inputs[i];\r if (input.checked){\r value = input.get(\"value\");\r break;\r }\r }\r }\r return value;\r }\r \t},\r resetData: function(){\r this.setData(this.getValue());\r },\r \r /**\r * @summary 获取选中的Dom对象。\r * @return {Element} 返回选中的Dom对象\r * @example\r * var input = this.form.get('fieldId').getSelectedInput();\r */\r getSelectedInput: function(){\r var inputs = this.node.getElements(\"input\");\r if (inputs.length){\r for (var i=0; i&lt;inputs.length; i++){\r if (inputs[i].checked) return inputs[i];\r }\r }\r return null;\r },\r \r setData: function(data){\r return this._setValue(data, \"__setData\");\r // if (data &amp;&amp; data.isAG){\r // this.moduleValueAG = o2.AG.all(data).then(function(v){\r // if (o2.typeOf(v)==\"array\") v = v[0];\r // this.__setData(v);\r // }.bind(this));\r // }else{\r // this.__setData(data);\r // }\r \r // if (data &amp;&amp; data.isAG){\r // this.moduleValueAG = data;\r // data.addResolve(function(v){\r // this.setData(v);\r // }.bind(this));\r // }else{\r // this.__setData(data);\r // this.moduleValueAG = null;\r // }\r },\r \r __setData: function(data){\r this._setBusinessData(data);\r \t\tvar inputs = this.node.getElements(\"input\");\r \t\t\r \t\tif (inputs.length){\r \t\t\tfor (var i=0; i&lt;inputs.length; i++){\r \t\t\t\tif (data==inputs[i].get(\"value\")){\r \t\t\t\t\tinputs[i].set(\"checked\", true);\r \t\t\t\t}else{\r \t\t\t\t\tinputs[i].set(\"checked\", false);\r \t\t\t\t}\r \t\t\t}\r this.validationMode();\r \t\t}\r this.fireEvent(\"setData\");\r \t},\r \r notValidationMode: function(text){\r if (!this.isNotValidationMode){\r this.isNotValidationMode = true;\r this.node.store(\"background\", this.node.getStyles(\"background\"));\r this.node.setStyle(\"background\", \"#ffdcdc\");\r \r this.errNode = this.createErrorNode(text);\r if (this.iconNode){\r this.errNode.inject(this.iconNode, \"after\");\r }else{\r this.errNode.inject(this.node, \"after\");\r }\r this.showNotValidationMode(this.node);\r \r if (!this.node.isIntoView()) this.node.scrollIntoView();\r }\r },\r \r validationMode: function(routeName, opinion){\r if (!this.validationConfig(routeName, opinion)) return false;\r \r if (this.isNotValidationMode){\r this.isNotValidationMode = false;\r this.node.setStyles(this.node.retrieve(\"background\"));\r if (this.errNode){\r this.errNode.destroy();\r this.errNode = null;\r }\r }\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Select.js.html":{"url":"x_component_process_Xform_Select.js.html","title":"x_component_process_Xform/Select.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Select.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Select.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r /** @class Select 下拉选择组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Select = MWF.APPSelect = new Class(\r \t/** @lends MWF.xApplication.process.Xform.Select# */\r \t{\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \ticonStyle: \"selectIcon\",\r \r \t/**\r \t * @ignore\r \t * @member {Element} descriptionNode\r \t * @memberOf MWF.xApplication.process.Xform.Select#\r \t */\r initialize: function(node, json, form, options){\r this.node = $(node);\r this.node.store(\"module\", this);\r this.json = json;\r this.form = form;\r this.field = true;\r },\r _loadNode: function(){\r if (this.readonly|| this.json.isReadonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r \t\tthis.node.set({\r \t\t\t\"nodeId\": this.json.id,\r \t\t\t\"MWFType\": this.json.type\r \t\t});\r var optionItems = this.getOptions();\r var value = this.getValue();\r if (value){\r if (typeOf(value)!==\"array\") value = [value];\r var texts = [];\r optionItems.each(function(item){\r var tmps = item.split(\"|\");\r var t = tmps[0];\r var v = tmps[1] || t;\r \r if (v){\r \r if (value.indexOf(v)!=-1){\r texts.push(t);\r }\r }\r \r });\r this.node.set(\"text\", texts.join(\", \"));\r }\r },\r \t_loadDomEvents: function(){\r \t\tObject.each(this.json.events, function(e, key){\r \t\t\tif (e.code){\r \t\t\t\tif (this.options.moduleEvents.indexOf(key)===-1){\r \t\t\t\t\tthis.node.addEvent(key, function(event){\r \t\t\t\t\t\treturn this.form.Macro.fire(e.code, this, event);\r \t\t\t\t\t}.bind(this));\r \t\t\t\t}\r \t\t\t}\r \t\t}.bind(this));\r \t},\r _loadEvents: function(){\r Object.each(this.json.events, function(e, key){\r if (e.code){\r if (this.options.moduleEvents.indexOf(key)!=-1){\r this.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }else{\r this.node.addEvent(key, function(event){\r return this.form.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }.bind(this));\r },\r \taddModuleEvent: function(key, fun){\r \t\tif (this.options.moduleEvents.indexOf(key)!==-1){\r \t\t\tthis.addEvent(key, function(event){\r \t\t\t\treturn (fun) ? fun(this, event) : null;\r \t\t\t}.bind(this));\r \t\t}else{\r \t\t\tthis.node.addEvent(key, function(event){\r \t\t\t\treturn (fun) ? fun(this, event) : null;\r \t\t\t}.bind(this));\r \t\t}\r \t},\r _loadStyles: function(){\r \tif (this.areaNode){\r if (this.json.styles) if (this.areaNode) this.areaNode.setStyles(this.json.styles);\r if (this.json.inputStyles) this.node.setStyles(this.json.inputStyles);\r \t\t}else{\r if (this.json.styles) this.node.setStyles(this.json.styles);\r \t\t}\r },\r \t_resetNodeEdit: function(){\r \t\tthis.node.empty();\r \t\tvar select = new Element(\"select\");\r \t\tselect.set(this.json.properties);\r \t\tselect.inject(this.node);\r \t},\r _loadNodeEdit: function(){\r \t\tif (!this.json.preprocessing) this._resetNodeEdit();\r \r \t\tvar select = this.node.getFirst();\r \t\tthis.areaNode = this.node;\r \t\tthis.node = select;\r \r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type,\r \t\t\t\"styles\": {\r \t\t\t\t\"margin-right\": \"12px\"\r \t\t\t}\r \t\t});\r \t\t\r \t\tthis.setOptions();\r this.node.addEvent(\"change\", function(){\r \t\t\tvar v = this.getInputData(\"change\");\r \t\t\tthis._setBusinessData(v);\r this.validationMode();\r if (this.validation()) this._setBusinessData(v);\r }.bind(this));\r \r \t},\r \t/**\r \t * @summary 刷新选择项，如果选择项是脚本，重新计算。\r \t * @example\r \t * this.form.get('fieldId').resetOption();\r \t */\r resetOption: function(){\r this.node.empty();\r this.setOptions();\r \t\tthis.fireEvent(\"resetOption\")\r },\r \t/**\r \t * @summary 获取选择项。\r \t * @return {Array} 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：&lt;pre>&lt;code class='language-js'>[\r \t * \"女|female\",\r \t * \"男|male\"\r \t * ]&lt;/code>&lt;/pre>\r \t * @example\r \t * this.form.get('fieldId').getOptions();\r \t */\r \tgetOptions: function(){\r \t\tif (this.json.itemType == \"values\"){\r \t\t\treturn this.json.itemValues;\r \t\t}else{\r \t\t\treturn this.form.Macro.exec(((this.json.itemScript) ? this.json.itemScript.code : \"\"), this);\r \t\t}\r \t\treturn [];\r \t},\r \r \t/**\r \t * @summary 获取整理后的选择项。\r \t * @return {Object} 返回整理后的选择项，如：\r \t * &lt;pre>&lt;code class='language-js'>{\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]}\r \t * &lt;/code>&lt;/pre>\r \t * @example\r \t * var optionData = this.form.get('fieldId').getOptionsObj();\r \t */\r \tgetOptionsObj : function(){\r \t\tvar textList = [];\r \t\tvar valueList = [];\r \t\tvar optionItems = this.getOptions();\r \t\tif (!optionItems) optionItems = [];\r \t\tif (o2.typeOf(optionItems)===\"array\"){\r \t\t\toptionItems.each(function(item){\r \t\t\t\tvar tmps = item.split(\"|\");\r \t\t\t\ttextList.push( tmps[0] );\r \t\t\t\tvalueList.push( tmps[1] || tmps[0] );\r \t\t\t}.bind(this));\r \t\t}\r \t\treturn { textList : textList, valueList : valueList };\r \t},\r \r \tsetOptions: function(){\r \t\tvar optionItems = this.getOptions();\r \t\tthis._setOptions(optionItems);\r \t},\r \t_setOptions: function(optionItems){\r \t\tvar p = o2.promiseAll(optionItems).then(function(options){\r \t\t\tthis.moduleSelectAG = null;\r \t\t\tif (!options) options = [];\r \t\t\tif (o2.typeOf(options)===\"array\"){\r \t\t\t\toptions.each(function(item){\r \t\t\t\t\tvar tmps = item.split(\"|\");\r \t\t\t\t\tvar text = tmps[0];\r \t\t\t\t\tvar value = tmps[1] || text;\r \r \t\t\t\t\tvar option = new Element(\"option\", {\r \t\t\t\t\t\t\"value\": value,\r \t\t\t\t\t\t\"text\": text\r \t\t\t\t\t}).inject(this.node);\r \t\t\t\t}.bind(this));\r \t\t\t\tthis.fireEvent(\"setOptions\", [options])\r \t\t\t}\r \t\t}.bind(this), function(){\r \t\t\tthis.moduleSelectAG = null;\r \t\t}.bind(this));\r \t\tthis.moduleSelectAG = p;\r \t\tif (p) p.then(function(){\r \t\t\tthis.moduleSelectAG = null;\r \t\t}.bind(this), function(){\r \t\t\tthis.moduleSelectAG = null;\r \t\t}.bind(this));\r \r \t\t// this.moduleSelectAG = o2.AG.all(optionItems).then(function(options){\r \t\t// \tthis.moduleSelectAG = null;\r \t\t// \tif (!options) options = [];\r \t\t// \tif (o2.typeOf(options)===\"array\"){\r \t\t// \t\toptions.each(function(item){\r \t\t// \t\t\tvar tmps = item.split(\"|\");\r \t\t// \t\t\tvar text = tmps[0];\r \t\t// \t\t\tvar value = tmps[1] || text;\r \t\t//\r \t\t// \t\t\tvar option = new Element(\"option\", {\r \t\t// \t\t\t\t\"value\": value,\r \t\t// \t\t\t\t\"text\": text\r \t\t// \t\t\t}).inject(this.node);\r \t\t// \t\t}.bind(this));\r \t\t// \t\tthis.fireEvent(\"setOptions\", [options])\r \t\t// \t}\r \t\t// }.bind(this));\r \t\t// if (this.moduleSelectAG) this.moduleSelectAG.then(function(){\r \t\t// \tthis.moduleSelectAG = null;\r \t\t// }.bind(this));\r \t},\r \t// __setOptions: function(){\r \t// \tvar optionItems = this.getOptions();\r // if (!optionItems) optionItems = [];\r // if (o2.typeOf(optionItems)===\"array\"){\r \t// \t\toptionItems.each(function(item){\r \t// \t\t\tvar tmps = item.split(\"|\");\r \t// \t\t\tvar text = tmps[0];\r \t// \t\t\tvar value = tmps[1] || text;\r \t//\r \t// \t\t\tvar option = new Element(\"option\", {\r \t// \t\t\t\t\"value\": value,\r \t// \t\t\t\t\"text\": text\r \t// \t\t\t}).inject(this.node);\r \t// \t\t}.bind(this));\r \t// \t\tthis.fireEvent(\"setOptions\", [optionItems])\r \t// \t}\r \t// },\r \taddOption: function(text, value){\r var option = new Element(\"option\", {\r \"value\": value || text,\r \"text\": text\r }).inject(this.node);\r \t\tthis.fireEvent(\"addOption\", [text, value])\r \t},\r \r \t_setValue: function(value, m){\r \t\tvar mothed = m || \"__setValue\";\r \t\tif (!!value){\r \t\t\tvar p = o2.promiseAll(value).then(function(v){\r \t\t\t\tif (o2.typeOf(v)==\"array\") v = v[0];\r \t\t\t\tif (this.moduleSelectAG){\r \t\t\t\t\tthis.moduleValueAG = this.moduleSelectAG;\r \t\t\t\t\tthis.moduleSelectAG.then(function(){\r \t\t\t\t\t\tthis[mothed](v);\r \t\t\t\t\t\treturn v;\r \t\t\t\t\t}.bind(this), function(){});\r \t\t\t\t}else{\r \t\t\t\t\tthis[mothed](v)\r \t\t\t\t}\r \t\t\t\treturn v;\r \t\t\t}.bind(this), function(){});\r \r \t\t\tthis.moduleValueAG = p;\r \t\t\tif (this.moduleValueAG) this.moduleValueAG.then(function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this), function(){\r \t\t\t\tthis.moduleValueAG = null;\r \t\t\t}.bind(this));\r \t\t}else{\r \t\t\tthis[mothed](value);\r \t\t}\r \r \r \t\t// this.moduleValueAG = o2.AG.all(value).then(function(v){\r \t\t// \tif (o2.typeOf(v)==\"array\") v = v[0];\r \t\t// \tif (this.moduleSelectAG){\r \t\t// \t\tthis.moduleValueAG = this.moduleSelectAG;\r \t\t// \t\tthis.moduleSelectAG.then(function(){\r \t\t// \t\t\tthis.__setValue(v);\r \t\t// \t\t}.bind(this));\r \t\t// \t}else{\r \t\t// \t\tthis.__setValue(v)\r \t\t// \t}\r \t\t// \treturn v;\r \t\t// }.bind(this));\r \r \t\t// if (value &amp;&amp; value.isAG){\r \t\t// \tthis.moduleValueAG = o2.AG.all(value),then(function(v){\r \t\t// \t\tthis._setValue(v);\r \t\t// \t}.bind(this));\r \t\t// \t// this.moduleValueAG = value;\r \t\t// \t// value.addResolve(function(v){\r \t\t// \t// \tthis._setValue(v);\r \t\t// \t// }.bind(this));\r \t\t// }else{\r \t\t//\r \t\t// }\r \t},\r \t__setValue: function(value){\r \t\tif (!this.readonly &amp;&amp; !this.json.isReadonly ) {\r \t\t\tthis._setBusinessData(value);\r \t\t\tfor (var i=0; i&lt;this.node.options.length; i++){\r \t\t\t\tvar option = this.node.options[i];\r \t\t\t\tif (option.value==value){\r \t\t\t\t\toption.selected = true;\r \t\t\t\t\t//\tbreak;\r \t\t\t\t}else{\r \t\t\t\t\toption.selected = false;\r \t\t\t\t}\r \t\t\t}\r \t\t}\r \t\tthis.moduleValueAG = null;\r \t},\r \r \t// _setValue: function(value){\r \t// \tif (!this.readonly &amp;&amp; !this.json.isReadonly ) {\r // this._setBusinessData(value);\r // for (var i=0; i&lt;this.node.options.length; i++){\r // var option = this.node.options[i];\r // if (option.value==value){\r // option.selected = true;\r // //\tbreak;\r // }else{\r // option.selected = false;\r // }\r // }\r // }\r \t// \t//this.node.set(\"value\", value);\r \t// },\r \r \t/**\r \t * @summary 获取选中项的value和text。\r \t * @return {Object} 返回选中项的value和text，如：\r \t * &lt;pre>&lt;code class='language-js'>{\"value\": [\"male\"], \"text\": [\"男\"]}\r \t * {\"value\": [\"\"], \"text\": [\"\"]}\r \t * &lt;/code>&lt;/pre>\r \t * @example\r \t * var data = this.form.get('fieldId').getTextData();\r \t * var text = data.text[0] //获取选中项的文本\r \t */\r \tgetTextData: function(){\r \t\tvar value = [];\r \t\tvar text = [];\r \t\tif (this.readonly|| this.json.isReadonly){\r \t\t\tvar ops = this.getOptionsObj();\r \t\t\tvar data = this._getBusinessData();\r \t\t\tvar d = typeOf(data) === \"array\" ? data : [data];\r \t\t\td.each( function (v) {\r \t\t\t\tvar idx = ops.valueList.indexOf( v );\r \t\t\t\tvalue.push( v || \"\" );\r \t\t\t\ttext.push( idx > -1 ? ops.textList[idx] : (v || \"\") );\r \t\t\t});\r \t\t}else{\r \t\t\tvar ops = this.node.getElements(\"option\");\r \t\t\tops.each(function(op){\r \t\t\t\tif (op.selected){\r \t\t\t\t\tvar v = op.get(\"value\");\r \t\t\t\t\tvar t = op.get(\"text\");\r \t\t\t\t\tvalue.push(v || \"\");\r \t\t\t\t\ttext.push(t || v || \"\");\r \t\t\t\t}\r \t\t\t});\r \t\t}\r \t\tif (!value.length) value = [\"\"];\r \t\tif (!text.length) text = [\"\"];\r \t\treturn {\"value\": value, \"text\": text};\r \t},\r getInputData: function(){\r \t\tif( this.readonly || this.json.isReadonly ){\r \t\t\treturn this._getBusinessData();\r \t\t}else{\r \t\t\tvar ops = this.node.getElements(\"option\");\r \t\t\tvar value = [];\r \t\t\tops.each(function(op){\r \t\t\t\tif (op.selected){\r \t\t\t\t\tvar v = op.get(\"value\");\r \t\t\t\t\tif (v) value.push(v);\r \t\t\t\t}\r \t\t\t});\r \t\t\tif (!value.length) return null;\r \t\t\treturn (value.length==1) ? value[0] : value;\r \t\t}\r \t},\r resetData: function(){\r \r this.setData(this.getValue());\r },\r \r \tsetData: function(data){\r \t\treturn this._setValue(data, \"__setData\");\r \t\t// if (data &amp;&amp; data.isAG){\r \t\t// \tthis.moduleValueAG = o2.AG.all(data).then(function(v){\r \t\t// \t\tif (o2.typeOf(v)==\"array\") v = v[0];\r \t\t// \t\tthis.__setData(v);\r \t\t// \t}.bind(this));\r \t\t// }else{\r \t\t// \tthis.__setData(data);\r \t\t// }\r \t\t// if (data &amp;&amp; data.isAG){\r \t\t// \tthis.moduleValueAG = data;\r \t\t// \tdata.addResolve(function(v){\r \t\t// \t\tthis.setData(v);\r \t\t// \t}.bind(this));\r \t\t// }else{\r \t\t// \tthis.__setData(data);\r \t\t// \tthis.moduleValueAG = null;\r \t\t// }\r \t},\r \r \t__setData: function(data){\r this._setBusinessData(data);\r \t\tif (this.readonly|| this.json.isReadonly){\r \t\t\tvar d = typeOf(data) === \"array\" ? data : [data];\r \t\t\tvar ops = this.getOptionsObj();\r \t\t\tvar result = [];\r \t\t\td.each( function (v) {\r \t\t\t\tvar idx = ops.valueList.indexOf( v );\r \t\t\t\tresult.push( idx > -1 ? ops.textList[idx] : v);\r \t\t\t})\r \t\t\tthis.node.set(\"text\", result.join(\",\"));\r \t\t}else{\r \t\t\tvar ops = this.node.getElements(\"option\");\r \t\t\tops.each(function(op){\r \t\t\t\tif (typeOf(data)==\"array\"){\r \t\t\t\t\tif (data.indexOf(op.get(\"value\"))!=-1){\r \t\t\t\t\t\top.set(\"selected\", true);\r \t\t\t\t\t}else{\r \t\t\t\t\t\top.set(\"selected\", false);\r \t\t\t\t\t}\r \t\t\t\t}else{\r \t\t\t\t\tif (data == op.get(\"value\")){\r \t\t\t\t\t\top.set(\"selected\", true);\r \t\t\t\t\t}else{\r \t\t\t\t\t\top.set(\"selected\", false);\r \t\t\t\t\t}\r \t\t\t\t}\r \t\t\t});\r \t\t\tthis.validationMode();\r \t\t}\r \t\tthis.fireEvent(\"setData\", [data]);\r \t}\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Sidebar.js.html":{"url":"x_component_process_Xform_Sidebar.js.html","title":"x_component_process_Xform/Sidebar.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Sidebar.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Sidebar.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.require(\"MWF.widget.Tree\", null, false);\r /** @class Sidebar 侧边操作条。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var sidebar = this.form.get(\"fieldId\"); //获取侧边操作条\r * //方法2\r * var sidebar = this.target; //在侧边操作条和操作本身的事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Sidebar = MWF.APPSidebar = new Class(\r /** @lends MWF.xApplication.process.Xform.Sidebar# */\r {\r \tExtends: MWF.APP$Module,\r \r _loadUserInterface: function(){\r this.node.setStyles(this.form.css.sidebar);\r this.toolbarNode = this.node.getFirst(\"div\");\r this.toolbarNode.empty();\r \r if (this.form.businessData.task){\r MWF.require(\"MWF.widget.Toolbar\", function(){\r var toolbars = [];\r //this.form.businessData.task.routeNameList.each(function(route, i){\r // if (!this.json.defaultTools) this.json.defaultTools = [];\r // var o= {\r // \"type\": \"MWFToolBarButton\",\r // \"img\": \"submit.png\",\r // \"title\": route,\r // \"action\": \"processWork:\"+route,\r // \"text\": route,\r // \"id\": \"action_processWork\",\r // \"control\": \"allowProcessing\",\r // \"condition\": \"\",\r // \"read\": false\r // };\r // toolbars.push(o);\r //}.bind(this));\r ( this.getRouteNameList() || [] ).each(function(route, i){\r if (!this.json.defaultTools) this.json.defaultTools = [];\r var o= {\r \"type\": \"MWFToolBarButton\",\r \"img\": \"submit.png\",\r \"title\": route.displayName,\r \"action\": \"processWork:\"+route.routeName,\r \"text\": route.displayName,\r \"id\": \"action_processWork\",\r \"control\": \"allowProcessing\",\r \"condition\": \"\",\r \"read\": false\r };\r toolbars.push(o);\r }.bind(this));\r this.json.defaultTools = toolbars.concat(this.json.defaultTools);\r //this.json.defaultTools.unshift(o);\r \r /**\r * @summary Toolbar组件，平台使用该组件生成操作条。\r * @member {o2.widget.Toolbar}\r * @example\r * //可以在脚本中获取该组件\r * var toolbarWidget = this.form.get(\"fieldId\").toolbarWidget; //获取组件对象\r */\r this.toolbarWidget = new MWF.widget.Toolbar(this.toolbarNode, {\"style\": this.json.style}, this);\r //alert(this.readonly)\r \r if (this.json.hideSystemTools){\r if (this.json.tools.length){\r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }else{\r this.toolbarNode.setStyle(\"display\", \"none\");\r }\r }else{\r if (this.json.defaultTools.length || this.json.tools.length){\r if (this.json.defaultTools){\r this.setToolbars(this.json.defaultTools, this.toolbarNode, this.readonly);\r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }else{\r MWF.getJSON(this.form.path+\"toolbars.json\", function(json){\r this.setToolbars(json, this.toolbarNode, this.readonly, true);\r this.setCustomToolbars(this.json.tools, this.toolbarNode);\r this.toolbarWidget.load();\r }.bind(this), false);\r }\r }else{\r this.toolbarNode.setStyle(\"display\", \"none\");\r }\r }\r if (this.toolbarWidget.children.length){\r //this.form.app.addEvent(\"resize\", this.loadPosition.bind(this));\r this.node.setStyle(\"display\", \"none\");\r window.setTimeout(this.loadPosition.bind(this), 500);\r var _self = this;\r this.form.app.content.getFirst().addEvent(\"scroll\", function(e){\r _self.loadPosition(this);\r });\r this.form.app.addEvent(\"resize\", function(e){\r _self.loadPosition(this);\r });\r }else{\r this.toolbarNode.setStyle(\"display\", \"none\");\r }\r }.bind(this));\r }\r },\r loadPosition: function(){\r // this.node.setStyle(\"display\", \"block\");\r // var parent = this.node.getParent();\r // while(parent &amp;&amp; (!parent.get(\"MWFtype\"))) parent = parent.getParent();\r //\r // var top = this.json.styles.top;\r // this.sideNode = parent || this.form.node;\r //\r // var size = this.form.app.content.getSize();\r // var scroll = this.form.app.content.getScroll();\r // var sideSize = this.sideNode.getSize();\r //\r // var y = (scroll.y+size.y/2)-sideSize.y/2;\r // var x = 5;\r //\r // var position = \"centerRight\";\r // var edge = \"centerLeft\";\r // if (!parent){\r // edge = \"centerRight\";\r // x = 5;\r // }\r //\r // if (this.json.barPosition==\"left\"){\r // position = \"centerLeft\";\r // edge = \"centerRight\";\r // x = -5;\r // if (!parent){\r // edge = \"centerLeft\";\r // x = 5;\r // }\r // }\r //\r // this.node.position({\r // \"relativeTo\": this.sideNode,\r // \"position\": position,\r // \"edge\": edge,\r // \"offset\" : {\"y\": y, \"x\": x}\r // });\r // this.json.styles.top = top;\r // if (top) this.node.setStyle(\"top\", top);\r \r this.node.setStyle(\"display\", \"block\");\r var parent = this.node.getParent();\r while(parent &amp;&amp; (!parent.get(\"MWFtype\"))) parent = parent.getParent();\r this.sideNode = parent || this.form.node;\r var size = this.form.app.content.getSize();\r //var scroll = this.form.designer.designNode.getScroll();\r var sideSize = this.sideNode.getSize();\r var sidePosition = this.sideNode.getPosition(this.sideNode.getOffsetParent());\r var nodeSize = this.node.getSize();\r \r if (sideSize.y>size.y){\r var center = (size.y/2-nodeSize.y/2);\r if (center&lt;sidePosition.y){\r this.node.setStyle(\"top\", \"\"+sidePosition.y+\"px\");\r }else if (center>(sidePosition.y+sideSize.y)){\r var tmp = (sidePosition.y+sideSize.y)-nodeSize.y;\r this.node.setStyle(\"top\", \"\"+tmp+\"px\");\r }else{\r this.node.setStyle(\"top\", \"\"+center+\"px\");\r }\r }else{\r var top = sidePosition.y+sideSize.y/2-nodeSize.y/2;\r if (top>size.y){\r if (sidePosition.y+nodeSize.y>size.y){\r this.node.setStyle(\"top\", \"\"+sidePosition.y+\"px\");\r }else{\r var tmp = size.y-nodeSize.y;\r this.node.setStyle(\"top\", \"\"+tmp+\"px\");\r }\r }else if(top&lt;=0){\r if(sidePosition.y+sideSize.y&lt;nodeSize.y){\r var tmp = sidePosition.y+sideSize.y-nodeSize.y;\r this.node.setStyle(\"top\", \"\"+tmp+\"px\");\r }else{\r this.node.setStyle(\"top\", \"45px\");\r }\r }else{\r this.node.setStyle(\"top\", \"\"+top+\"px\");\r }\r }\r \r \r var left = sideSize.x+sidePosition.x+5;\r this.node.setStyle(\"left\", \"\"+left+\"px\");\r this.node.setStyle(\"position\", \"absolute\");\r \r \r this.node.setStyles({\"right\": \"auto\", \"bottom\": \"auto\"});\r \r // this.json.styles = this.node.getStyles([\"top\", \"left\", \"bottom\", \"right\", \"position\"]);\r //\r // var p = this.sideNode.getPosition();\r // var s = this.sideNode.getSize();\r // this.sidePosition = {\"p\": p, \"s\": s};\r \r },\r setCustomToolbars: function(tools, node){\r var path = \"../x_component_process_FormDesigner/Module/Actionbar/\";\r tools.each(function(tool){\r var flag = true;\r if (this.readonly){\r flag = tool.readShow;\r }else{\r flag = tool.editShow;\r }\r if (flag){\r flag = true;\r if (tool.control){\r flag = this.form.businessData.control[tool.control]\r }\r if (tool.condition){\r var hideFlag = this.form.Macro.exec(tool.condition, this);\r flag = !hideFlag;\r }\r if (flag){\r var actionNode = new Element(\"div\", {\r \"id\": tool.id,\r \"MWFnodetype\": tool.type,\r //\"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+tool.img,\r \"MWFButtonImage\": path+(this.form.options.style||\"default\") +\"/custom/\"+tool.img,\r \"title\": tool.title,\r \"MWFButtonAction\": \"runCustomAction\",\r \"MWFButtonText\": tool.text\r }).inject(node);\r if (tool.actionScript){\r actionNode.store(\"script\", tool.actionScript);\r }\r if (tool.sub){\r var subNode = node.getLast();\r this.setCustomToolbars(tool.sub, subNode);\r }\r }\r }\r }.bind(this));\r },\r setToolbars: function(tools, node, readonly, noCondition){\r var path = \"../x_component_process_FormDesigner/Module/Actionbar/\";\r tools.each(function(tool){\r var flag = true;\r if (tool.control){\r flag = this.form.businessData.control[tool.control]\r }\r if (!noCondition) if (tool.condition){\r var hideFlag = this.form.Macro.exec(tool.condition, this);\r flag = !hideFlag;\r }\r if (tool.id == \"action_processWork\"){\r if (!this.form.businessData.task){\r flag = false;\r }\r }\r if (readonly) if (!tool.read) flag = false;\r if (flag){\r var actionNode = new Element(\"div\", {\r \"id\": tool.id,\r \"MWFnodetype\": tool.type,\r //\"MWFButtonImage\": this.form.path+\"\"+this.form.options.style+\"/actionbar/\"+tool.img,\r \"MWFButtonImage\": path+(this.form.options.style||\"default\") +\"/tools/default/\"+tool.img,\r \"title\": tool.title,\r \"MWFButtonAction\": tool.action,\r \"MWFButtonText\": tool.text\r }).inject(node);\r if (tool.sub){\r var subNode = node.getLast();\r this.setToolbars(tool.sub, subNode, readonly, noCondition);\r }\r }\r }.bind(this));\r },\r getRouteNameList: function( routeList ){\r var _self = this;\r \r var list = [];\r if( !routeList )routeList = this.getRouteDataList();\r routeList.each(function(route, i){\r if( route.hiddenScriptText &amp;&amp; this.form &amp;&amp; this.form.Macro ){\r if( this.form.Macro.exec(route.hiddenScriptText, this).toString() === \"true\" )return;\r }\r var routeName = route.name;\r if( route.displayNameScriptText &amp;&amp; this.form &amp;&amp; this.form.Macro ){\r routeName = this.form.Macro.exec(route.displayNameScriptText, this);\r }\r \r list.push({\r \"routeId\" : route.id,\r \"displayName\" : routeName,\r \"routeName\" : route.name\r })\r }.bind(this));\r return list;\r },\r getRouteDataList : function(){\r if( !this.routeDataList ){\r o2.Actions.get(\"x_processplatform_assemble_surface\").listRoute( {\"valueList\":this.form.businessData.task.routeList} , function( json ){\r json.data.each( function(d){\r d.selectConfigList = JSON.parse( d.selectConfig || \"[]\" );\r }.bind(this));\r this.routeDataList = json.data;\r }.bind(this), null, false );\r }\r return this.routeDataList;\r },\r getRouteData : function( routeId ){\r var routeList = this.getRouteDataList();\r for( var i=0; i&lt;routeList.length; i++ ){\r if( routeList[i].id === routeId ){\r return routeList[i];\r }\r }\r },\r runCustomAction: function(bt){\r var script = bt.node.retrieve(\"script\");\r this.form.Macro.exec(script, this);\r },\r saveWork: function(){\r this.form.saveWork();\r },\r closeWork: function(){\r this.form.closeWork();\r },\r processWork: function(route){\r opinion = this.form.getOpinion();\r if (!this.form.formCustomValidation()){\r this.form.app.content.unmask();\r // if (callback) callback();\r return false;\r }\r this.form.submitWork(route, opinion.opinion, opinion.medias)\r \r // var opinionField = this.json.opinion || \"opinion\";\r // var data = this.form.getData();\r // var opinion = data[opinionField];\r // data[opinionField] = \"\";\r // this.form.submitWork(route, opinion, null, null, data);\r },\r resetWork: function(){\r this.form.resetWork();\r },\r retractWork: function(e, ev){\r this.form.retractWork(e, ev);\r },\r rerouteWork: function(e, ev){\r this.form.rerouteWork(e, ev);\r },\r deleteWork: function(){\r this.form.deleteWork();\r },\r printWork: function(){\r this.form.printWork();\r }\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Source.js.html":{"url":"x_component_process_Xform_Source.js.html","title":"x_component_process_Xform/Source.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Source.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Source.js MWF.xDesktop.requireApp(\"process.Xform\", \"Div\", null, false);\r \r /** @class Source 数据源组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var source = this.form.get(\"fieldId\"); //获取数据源组件\r * //方法2\r * var source = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.Div\r * @o2category FormComponents\r * @o2range {Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Source = MWF.APPSource = new Class(\r /** @lends MWF.xApplication.process.Xform.Source# */\r {\r \tExtends: MWF.APPDiv,\r options: {\r /**\r * 加载数据后执行，但这时还未加载下属组件，可以可以使用this.target.data获取数据进行修改。\r * @event MWF.xApplication.process.Xform.Source#postLoadData\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 加载数据、下属组件后执行。\r * @event MWF.xApplication.process.Xform.Source#loadData\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"queryLoad\",\"postLoad\",\"load\", \"postLoadData\", \"loadData\"]\r },\r \r \t_loadUserInterface: function(){\r this.data = null;\r if (this.json.path){\r if (this.json.sourceType==\"o2\"){\r if (this.json.path) this._getO2Source();\r }\r }\r \t},\r _getO2Address: function(){\r try {\r this.json.service = JSON.parse(this.json.contextRoot);\r }catch(e){\r this.json.service = {\"root\": this.json.contextRoot, \"action\":\"\", \"method\": \"\", \"url\": \"\"};\r }\r var addressObj = layout.serviceAddressList[this.json.service.root];\r \r if (addressObj){\r this.address = layout.config.app_protocol+\"//\"+addressObj.host+(addressObj.port==80 ? \"\" : \":\"+addressObj.port)+addressObj.context;\r }else{\r var host = layout.desktop.centerServer.host || window.location.hostname;\r var port = layout.desktop.centerServer.port;\r this.address = layout.config.app_protocol+\"//\"+host+(port==\"80\" ? \"\" : \":\"+port)+\"/x_program_center\";\r }\r },\r //_getConfigParameters: function(){\r //\r // return pars;\r //},\r _getO2Uri: function(){\r //var uri = this.json.path || this.json.selectPath;\r var uri = this.json.path;\r var pars = {};\r if (this.json.parameters){\r Object.each(this.json.parameters, function(v, key){\r if (uri.indexOf(\"{\"+key+\"}\")!=-1){\r var reg = new RegExp(\"{\"+key+\"}\", \"g\");\r uri = uri.replace(reg, encodeURIComponent((v &amp;&amp; v.code) ? (this.form.Macro.exec(v.code, this) || \"\") : v));\r }else{\r pars[key] = v;\r }\r }.bind(this));\r }\r \r var data = null;\r if (this.json.requestBody){\r if (this.json.requestBody.code){\r data = this.form.Macro.exec(this.json.requestBody.code, this)\r }\r }\r \r if (this.json.httpMethod==\"GET\" || this.json.httpMethod==\"OPTIONS\" || this.json.httpMethod==\"HEAD\" || this.json.httpMethod==\"DELETE\"){\r var tag = \"?\";\r if (uri.indexOf(\"?\")!=-1) tag = \"&amp;\";\r Object.each(pars, function(v, k){\r var value = (v &amp;&amp; v.code) ? (this.form.Macro.exec(v.code, this) || \"\") : v;\r uri = uri+tag+k+\"=\"+value;\r }.bind(this));\r }else{\r Object.each(pars, function(v, k){\r if (!data) data = {};\r var value = (v &amp;&amp; v.code) ? (this.form.Macro.exec(v.code, this) || \"\") : v;\r data[k] = value;\r }.bind(this));\r }\r this.body = data;\r this.uri = this.address+uri;\r },\r _getO2Source: function(){\r this._getO2Address();\r this._getO2Uri();\r \r this._invoke(function(){\r this._loadSub(this.node);\r this.fireEvent(\"loadData\");\r }.bind(this));\r },\r _invoke: function(callback){\r MWF.restful(this.json.httpMethod, this.uri, JSON.encode(this.body), function(json){\r this.data = json;\r this.fireEvent(\"postLoadData\");\r if (callback) callback();\r }.bind(this), true, true);\r \r },\r setBody: function(data){\r this.body = data;\r },\r /**\r * @summary 替换全部的url参数，但不刷新组件\r * @param {Object} url参数\r * @example\r * //如，原来的组件url参数为：\r * { \"page\" : 1, \"count\" : 10 }\r *\r * this.form.get(\"fieldId\").setParameters({\"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"});\r *\r * //执行后变为\r * {\"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"}\r */\r setParameters: function(json){\r this.json.parameters = json;\r this._getO2Address();\r this._getO2Uri();\r },\r /**\r * @summary 新增url参数，但不刷新组件。如果该参数key已经存在，则覆盖\r * @param {Object} url参数\r * @example\r * * //如，原来的组件url参数为：\r * { \"page\" : 1, \"count\" : 10 }\r *\r * this.form.get(\"fieldId\").addParameters({\r * \"page\" : 2,\r * \"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"\r * });\r *\r * //执行后变为\r * {\r * \"page\" : 2,\r * \"count\" : 10\r * \"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"\r * }\r */\r addParameters: function(json){\r if (!this.json.parameters) this.json.parameters={};\r Object.each(json, function(v, k){\r this.json.parameters[k] = v;\r }.bind(this));\r this._getO2Address();\r this._getO2Uri();\r },\r /**\r * @summary 重新加载组件。会触发loadData事件\r * @param {Boolean} notInit - false表示不重新初始化子数据源和数据文本，true表示重新初始化，默认为false\r * @param {Function} callback 加载完成后的回调\r * @example\r * this.form.get(\"fieldId\").reload(); //重新加载组件\r */\r reload: function(notInit, callback){\r \t this._getO2Uri();\r this._invoke(function(){\r this._loadSub(this.node, notInit);\r this.fireEvent(\"loadData\");\r if (callback) callback();\r }.bind(this));\r },\r _loadSub: function(dom, notInit){\r var subDom = dom.getFirst();\r var module = null;\r while (subDom){\r module = null;\r \r module = subDom.retrieve(\"module\", null);\r if (module){\r if (module._loadJsonData) module._loadJsonData(notInit);\r }else{\r this._loadSub(subDom);\r }\r \r //var type = subDom.get(\"MWFtype\");\r //if (type){\r // if (type==\"sourceText\"){\r // module = subDom.retrieve(\"module\");\r // module._loadData();\r // }else if (type==\"subSource\"){\r // module = subDom.retrieve(\"module\");\r // module._loadData();\r // }else{\r // this._loadSub(subDom);\r // }\r //}else{\r // this._loadSub(subDom);\r //}\r subDom = subDom.getNext();\r }\r }\r \r \r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_SourceText.js.html":{"url":"x_component_process_Xform_SourceText.js.html","title":"x_component_process_Xform/SourceText.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/SourceText.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/SourceText.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class SourceText 数据文本组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var sourceText = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var sourceText = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.SourceText = MWF.APPSourceText = new Class({\r Extends: MWF.APP$Module,\r \r \t_loadUserInterface: function(){\r this._loadJsonData();\r \t},\r _getSource: function(){\r var parent = this.node.getParent();\r while(parent &amp;&amp; (parent.get(\"MWFtype\")!=\"source\" &amp;&amp; parent.get(\"MWFtype\")!=\"subSource\" &amp;&amp; parent.get(\"MWFtype\")!=\"subSourceItem\")) parent = parent.getParent();\r return (parent) ? parent.retrieve(\"module\") : null;\r },\r _loadJsonData: function(){\r this.node.set(\"text\", \"\");\r this.source = this._getSource();\r if (this.source){\r if (this.source.data){\r COMMON.AjaxModule.load(\"JSONTemplate\", function(){\r \r this.template = new Template();\r this.text = this.template.substitute(\"{\"+this.json.jsonPath+\"}\", this.source.data);\r \r if (this.json.jsonText){\r if (this.json.jsonText.code){\r this.text = this.form.Macro.exec(this.json.jsonText.code, this);\r if( typeOf(this.text) === \"string\" )this.node.set(\"text\", this.text);\r }else{\r this.node.set(\"text\", this.text);\r }\r }else{\r this.node.set(\"text\", this.text);\r }\r \r }.bind(this));\r }\r }\r }\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Stat.js.html":{"url":"x_component_process_Xform_Stat.js.html","title":"x_component_process_Xform/Stat.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Stat.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Stat.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", null, false);\r \r /** @class Stat 统计组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var stat = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var stat = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Stat = MWF.APPStat = new Class(\r /** @lends MWF.xApplication.process.Xform.Stat# */\r {\r \tExtends: MWF.APP$Module,\r options: {\r /**\r * 组件异步加载完成触发.\r * @event MWF.xApplication.process.Xform.Stat#loadStat\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"loadStat\"]\r },\r \r _loadUserInterface: function(){\r this.node.empty();\r },\r _afterLoaded: function(){\r this.node.setStyle(\"min-height\", \"100px\");\r this.loadStat();\r },\r active: function(){\r if (this.stat) this.stat.loadStatData();\r },\r reload: function(){\r \t this.active();\r },\r loadStat: function(){\r \t if (this.json.queryStat){\r var viewJson = {\r \"application\": this.json.queryStat.appName,\r \"statName\": this.json.queryStat.name,\r \"isChart\": (this.json.isChart!=\"no\"),\r \"isLegend\": (this.json.isLegend!=\"no\"),\r \"isTable\": (this.json.isTable!=\"no\")\r };\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Statistician\", function(){\r /**\r * @summary Statistician组件，平台使用该组件执行统计的逻辑\r * @member {MWF.xApplication.query.Query.Statistician}\r * @example\r * //可以在脚本中获取该组件\r * var field = this.form.get(\"fieldId\").stat; //获取组件对象\r */\r this.stat = new MWF.xApplication.query.Query.Statistician(this.form.app, this.node, viewJson, {\r \"resizeNode\": (this.node.getStyle(\"height\").toString().toLowerCase()!==\"auto\" &amp;&amp; this.node.getStyle(\"height\").toInt()>0),\r \"onLoaded\": function(){\r this.fireEvent(\"loadStat\");\r }.bind(this)\r });\r }.bind(this));\r }\r },\r /**\r * @summary 获取统计数据。\r * @return {Ojbect} 统计数据.\r * @example\r * var data = this.form.get(\"fieldId\").getData();\r * @return {Boolean} 是否通过校验\r */\r getData: function(){\r if (!this.stat) return null;\r if (!this.stat.stat) return null;\r return this.stat.stat.data;\r }\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Statement.js.html":{"url":"x_component_process_Xform_Statement.js.html","title":"x_component_process_Xform/Statement.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Statement.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Statement.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", null, false);\r /** @class Statement 查询视图组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var statement = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var statement = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Statement = MWF.APPStatement = new Class(\r /** @lends MWF.xApplication.process.Xform.Statement# */\r {\r \tExtends: MWF.APP$Module,\r options: {\r /**\r * 异步加载查询视图后完成。\r * @event MWF.xApplication.process.Xform.Statement#loadView\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 选中查询视图中的一条记录后执行。\r * @event MWF.xApplication.process.Xform.Statement#select\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 打开查询视图中的一条记录后执行。\r * @event MWF.xApplication.process.Xform.Statement#openDocument\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"loadView\", \"queryLoad\", \"postLoad\", \"select\", \"openDocument\"]\r },\r \r _loadUserInterface: function(){\r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", null, false);\r this.node.empty();\r },\r _afterLoaded: function(){\r if (this.json.queryStatement){\r this.loadView();\r }\r },\r /**\r * @summary 重新加载查询视图\r * @example\r * this.form.get(\"fieldId\").reload()\r */\r reload: function(){\r if (this.view){\r if (this.view.loadViewRes &amp;&amp; this.view.loadViewRes.res) if (this.view.loadViewRes.res.isRunning()) this.view.loadViewRes.res.cancel();\r if (this.view.getViewRes &amp;&amp; this.view.getViewRes.res) if (this.view.getViewRes.res.isRunning()) this.view.getViewRes.res.cancel();\r }\r this.node.empty();\r this.loadView();\r },\r /**\r * @summary 当查询视图被设置为延迟加载（未立即载入），通过active方法激活\r * @example\r * this.form.get(\"fieldId\").active()\r */\r active: function(){\r if (this.view){\r if (!this.view.loadingAreaNode) this.view.loadView();\r }else{\r this.loadView();\r }\r },\r loadView: function(){\r if (!this.json.queryStatement) return \"\";\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r \r \r \r //var data = JSON.parse(this.json.data);\r var viewJson = {\r \"application\": (this.json.queryStatement) ? this.json.queryStatement.appName : this.json.application,\r \"statementName\": (this.json.queryStatement) ? this.json.queryStatement.name : this.json.statementName,\r \"statementId\": (this.json.queryStatement) ? this.json.queryStatement.id : this.json.statementId,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"none\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter,\r \"defaultSelectedScript\" : this.json.defaultSelectedScript ? this.json.defaultSelectedScript.code : null,\r \"selectedAbleScript\" : this.json.selectedAbleScript ? this.json.selectedAbleScript.code : null\r };\r \r //MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r /**\r * @summary Statement组件，平台使用该组件实现查询视图的功能\r * @member {MWF.xApplication.query.Query.Statement}\r * @example\r * //可以在脚本中获取该组件\r * var view = this.form.get(\"fieldId\").view; //获取组件对象\r */\r this.view = new MWF.xApplication.query.Query.Statement(this.node, viewJson, {\r \"isload\": (this.json.loadView!==\"no\"),\r \"resizeNode\": (this.node.getStyle(\"height\").toString().toLowerCase()!==\"auto\" &amp;&amp; this.node.getStyle(\"height\").toInt()>0),\r \"onLoadView\": function(){\r this.fireEvent(\"loadView\");\r }.bind(this),\r \"onSelect\": function(){\r this.fireEvent(\"select\");\r }.bind(this),\r \"onOpenDocument\": function(options, item){\r this.openOptions = {\r \"options\": options,\r \"item\": item\r };\r this.fireEvent(\"openDocument\");\r this.openOptions = null;\r }.bind(this)\r }, this.form.app, this.form.Macro);\r //}.bind(this));\r },\r /**\r * @summary 获取查询视图被选中行的数据\r * @return {Object[]} 被选中行的数据\r * @example\r * var data = this.form.get(\"fieldId\").getData();\r */\r getData: function(){\r if (this.view.selectedItems.length){\r var arr = [];\r this.view.selectedItems.each(function(item){\r arr.push(item.data);\r });\r return arr;\r }else{\r return [];\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_StatementSelector.js.html":{"url":"x_component_process_Xform_StatementSelector.js.html","title":"x_component_process_Xform/StatementSelector.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/StatementSelector.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/StatementSelector.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.xDesktop.requireApp(\"process.Xform\", \"ViewSelector\", null, false);\r /** @class ViewSelector 查询视图选择组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var statementSelector = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var statementSelector = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.ViewSelector\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.StatementSelector = MWF.APPStatementSelector = new Class({\r \tImplements: [Events],\r \tExtends: MWF.xApplication.process.Xform.ViewSelector,\r doResult: function(data){\r if (this.json.result === \"script\"){\r this.selectedData = data;\r return (this.json.selectedScript.code) ? this.form.Macro.exec(this.json.selectedScript.code, this) : \"\";\r }else{\r Object.each(this.json.selectedSetValues, function(v, k){\r var value = \"\";\r data.each(function(d, idx){\r // Object.each(d, function(dv, dk){\r // if (dk===v) value = (value) ? (value+\", \"+dv) : dv;\r // }.bind(this));\r \r var pathList = v.split(\".\");\r for( var i=0; i&lt;pathList.length; i++ ){\r var p = pathList[i];\r if( (/(^[1-9]\\d*$)/.test(p)) )p = p.toInt();\r if( d[ p ] ){\r d = d[ p ];\r }else{\r d = \"\";\r break;\r }\r }\r \r if( typeOf(d) === \"array\" || typeOf(d) === \"object\" ) {\r d = JSON.stringify(d);\r }\r \r value = (value) ? (value+\", \"+d) : d;\r \r }.bind(this));\r \r var field = this.form.all[k];\r if (field){\r field.setData(value);\r if (value){\r if (field.descriptionNode) field.descriptionNode.setStyle(\"display\", \"none\");\r }else{\r if (field.descriptionNode) field.descriptionNode.setStyle(\"display\", \"block\");\r }\r }\r }.bind(this));\r }\r },\r selectView: function(callback){\r var viewData = this.json.queryStatement;\r \r if (viewData){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r \r var viewJson = {\r \"application\": viewData.appName,\r \"statementName\": viewData.name,\r \"statementId\": viewData.id,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"single\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter,\r \"defaultSelectedScript\" : this.json.defaultSelectedScript ? this.json.defaultSelectedScript.code : null,\r \"selectedAbleScript\" : this.json.selectedAbleScript ? this.json.selectedAbleScript.code : null\r };\r var options = {};\r var width = options.width || \"850\";\r var height = options.height || \"700\";\r \r if (layout.mobile){\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = this.form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.json.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"\",\r \"maskNode\": layout.mobile?$(document.body) : this.form.app.content,\r \"container\": layout.mobile?$(document.body) : this.form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r \r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ],\r \"onPostShow\": function(){\r if(layout.mobile){\r dlg.node.setStyle(\"z-index\",200);\r }\r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", function(){\r this.view = new MWF.xApplication.query.Query.Statement(dlg.content, viewJson, {\"style\": \"select\"}, this.form.app, this.form.Macro );\r }.bind(this));\r }.bind(this)\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r // MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", function(){\r // this.view = new MWF.xApplication.process.Xform.widget.View(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // }.bind(this));\r // MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r // this.view = new MWF.xApplication.query.Query.Viewer(dlg.content, viewJson, {\"style\": \"select\"});\r // }.bind(this));\r }.bind(this));\r }\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Subform.js.html":{"url":"x_component_process_Xform_Subform.js.html","title":"x_component_process_Xform/Subform.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Subform.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Subform.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Subform 子表单组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var subform = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var subform = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Subform = MWF.APPSubform = new Class(\r /** @lends MWF.xApplication.process.Xform.Subform# */\r {\r Extends: MWF.APP$Module,\r \r _loadUserInterface: function () {\r this.node.empty();\r if (this.json.isDelay) {\r if (this.form.subformLoadedCount) {\r this.form.subformLoadedCount++;\r } else {\r this.form.subformLoadedCount = 1\r }\r this.form.checkSubformLoaded();\r this.checked = true;\r } else {\r \r this.getSubform(function () {\r this.loadSubform();\r }.bind(this));\r }\r },\r /**\r * @summary 当子表单被设置为延迟加载，通过active方法激活\r * @param {Function} callback\r * @example\r * var subform = this.form.get(\"fieldId\");\r * subform.active(function(){\r * //do someting\r * })\r */\r active: function (callback) {\r if (!this.loaded) {\r this.reload(callback)\r } else {\r if (callback) callback();\r }\r },\r /**\r * @summary 重新加载子表单\r * @param {Function} callback\r * @example\r * this.form.get(\"fieldId\").reload(function(){\r * //do someting\r * })\r */\r reload: function (callback) {\r this.node.empty();\r this.getSubform(function () {\r this.loadSubform();\r if (callback) callback();\r }.bind(this));\r },\r loadCss: function () {\r if (this.subformData.json.css &amp;&amp; this.subformData.json.css.code) {\r var cssText = this.form.parseCSS(this.subformData.json.css.code);\r var rex = new RegExp(\"(.+)(?=\\\\{)\", \"g\");\r var match;\r var id = this.form.json.id.replace(/\\-/g, \"\");\r while ((match = rex.exec(cssText)) !== null) {\r var prefix = \".css\" + id + \" \";\r var rule = prefix + match[0];\r cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r rex.lastIndex = rex.lastIndex + prefix.length;\r }\r \r var styleNode = $(\"style\" + this.form.json.id);\r if (!styleNode) {\r var styleNode = document.createElement(\"style\");\r styleNode.setAttribute(\"type\", \"text/css\");\r styleNode.id = \"style\" + this.form.json.id;\r styleNode.inject(this.form.container, \"before\");\r }\r \r if (styleNode.styleSheet) {\r var setFunc = function () {\r styleNode.styleSheet.cssText += cssText;\r };\r if (styleNode.styleSheet.disabled) {\r setTimeout(setFunc, 10);\r } else {\r setFunc();\r }\r } else {\r var cssTextNode = document.createTextNode(cssText);\r styleNode.appendChild(cssTextNode);\r }\r }\r },\r checkSubformNested: function (id) {\r if (!id) return true;\r if (this.parentformIdList) {\r return !this.parentformIdList.contains(id);\r } else {\r return ![this.form.json.id].contains(id);\r }\r },\r checkSubformUnique: function (id) {\r if (!id) return true;\r if (!this.form.subformLoaded) return true;\r return !this.form.subformLoaded.contains(id);\r },\r getParentformIdList: function () {\r var parentformIdList;\r if (this.parentformIdList) {\r parentformIdList = Array.clone(this.parentformIdList);\r parentformIdList.push(this.subformData.json.id)\r } else {\r parentformIdList = [this.form.json.id, this.subformData.json.id];\r }\r return parentformIdList;\r },\r loadSubform: function () {\r if (this.subformData) {\r if (!this.checkSubformNested(this.subformData.json.id)) {\r this.form.notice(MWF.xApplication.process.Xform.LP.subformNestedError, \"error\");\r } else if (!this.checkSubformUnique(this.subformData.json.id)) {\r this.form.notice(MWF.xApplication.process.Xform.LP.subformUniqueError, \"error\");\r } else {\r //this.form.addEvent(\"postLoad\", function(){\r \r this.loadCss();\r \r this.node.set(\"html\", this.subformData.html);\r Object.each(this.subformData.json.moduleList, function (module, key) {\r var formKey = key;\r if (this.form.json.moduleList[key]) {\r formKey = this.json.id + \"_\" + key;\r var moduleNode = this.node.getElement(\"#\" + key);\r if (moduleNode) moduleNode.set(\"id\", formKey);\r module.id = formKey;\r }\r this.form.json.moduleList[formKey] = module;\r }.bind(this));\r \r var moduleNodes = this.form._getModuleNodes(this.node);\r moduleNodes.each(function (node) {\r if (node.get(\"MWFtype\") !== \"form\") {\r var _self = this;\r var json = this.form._getDomjson(node);\r //if( json.type === \"Subform\" || json.moduleName === \"subform\" )this.form.subformCount++;\r var module = this.form._loadModule(json, node, function () {\r this.parentformIdList = _self.getParentformIdList();\r });\r this.form.modules.push(module);\r }\r }.bind(this));\r \r this.form.subformLoaded.push(this.subformData.json.id);\r \r //}.bind(this));\r }\r }\r if (!this.checked) {\r if (this.form.subformLoadedCount) {\r this.form.subformLoadedCount++;\r } else {\r this.form.subformLoadedCount = 1\r }\r this.form.checkSubformLoaded();\r }\r //console.log( \"add subformLoadedCount , this.form.subformLoadedCount = \"+ this.form.subformLoadedCount)\r this.loaded = true;\r this.checked = true;\r },\r getSubform: function (callback) {\r var method = (this.form.json.mode !== \"Mobile\" &amp;&amp; !layout.mobile) ? \"getForm\" : \"getFormMobile\";\r \r if (this.json.subformType === \"script\") {\r if (this.json.subformScript &amp;&amp; this.json.subformScript.code) {\r var data = this.form.Macro.exec(this.json.subformScript.code, this);\r if (data) {\r var formName, app;\r if (typeOf(data) === \"string\") {\r formName = data;\r } else {\r if (data.application) app = data.application;\r if (data.subform) formName = data.subform;\r }\r if (formName) {\r if (!app) app = (this.form.businessData.work || this.form.businessData.workCompleted).application;\r MWF.Actions.get(\"x_processplatform_assemble_surface\")[method](formName, app, function (json) {\r this.getSubformData(json.data);\r if (callback) callback();\r }.bind(this));\r } else {\r if (callback) callback();\r }\r } else {\r if (callback) callback();\r }\r }\r } else {\r if (this.json.subformSelected &amp;&amp; this.json.subformSelected !== \"none\") {\r var subformData = (this.form.app.relatedFormMap) ? this.form.app.relatedFormMap[this.json.subformSelected] : null;\r if (subformData) {\r this.getSubformData({\"data\": subformData.data});\r if (callback) callback();\r } else {\r var app;\r if (this.json.subformAppSelected) {\r app = this.json.subformAppSelected;\r } else {\r app = (this.form.businessData.work || this.form.businessData.workCompleted).application;\r }\r MWF.Actions.get(\"x_processplatform_assemble_surface\")[method](this.json.subformSelected, app, function (json) {\r this.getSubformData(json.data);\r if (callback) callback();\r }.bind(this));\r }\r } else {\r if (callback) callback();\r }\r }\r },\r getSubformData: function (data) {\r if (!data || typeOf(data) !== \"object\") return;\r var subformDataStr = null;\r // if ( this.form.json.mode !== \"Mobile\" &amp;&amp; !layout.mobile){\r // subformDataStr = data.data;\r // }else{\r // subformDataStr = data.mobileData;\r // }\r subformDataStr = data.data;\r this.subformData = null;\r if (subformDataStr) {\r this.subformData = JSON.decode(MWF.decodeJsonString(subformDataStr));\r this.subformData.updateTime = data.updateTime;\r }\r }\r });\r \r \r MWF.xApplication.process.Xform.SubmitForm = MWF.APPSubmitform = new Class({\r Extends: MWF.APPSubform,\r _loadUserInterface: function () {\r // this.node.empty();\r this.getSubform(function () {\r this.loadSubform();\r }.bind(this));\r },\r reload: function () {\r // this.node.empty();\r this.getSubform(function () {\r this.loadSubform();\r }.bind(this));\r },\r show: function () {\r if (this.json.submitScript &amp;&amp; this.json.submitScript.code) {\r this.form.Macro.exec(this.json.submitScript.code, this);\r }\r // this.fireSubFormEvent(\"load\");\r },\r // fireSubFormEvent : function( name ){\r // var events = this.subformData.json.events;\r // if( events &amp;&amp; events[name] &amp;&amp; events[name][\"code\"] ){\r // this.form.Macro.exec(events[name][\"code\"], this);\r // }\r // },\r loadSubform: function () {\r if (this.subformData) {\r if (!this.checkSubformUnique(this.subformData.json.id)) { //如果提交表单已经嵌入到表单中，那么把这个表单弹出来\r // this.form.notice(MWF.xApplication.process.Xform.LP.subformUniqueError, \"error\");\r this.isEmbedded = true;\r this.fireEvent(\"afterModulesLoad\");\r } else if (!this.checkSubformNested(this.subformData.json.id)) {\r this.form.notice(MWF.xApplication.process.Xform.LP.subformNestedError, \"error\");\r } else {\r //this.form.addEvent(\"postLoad\", function(){\r \r // this.fireSubFormEvent(\"queryLoad\");\r this.loadCss();\r \r this.node.set(\"html\", this.subformData.html);\r Object.each(this.subformData.json.moduleList, function (module, key) {\r var formKey = key;\r if (this.form.json.moduleList[key]) {\r formKey = this.json.id + \"_\" + key;\r var moduleNode = this.node.getElement(\"#\" + key);\r if (moduleNode) moduleNode.set(\"id\", formKey);\r module.id = formKey;\r }\r this.form.json.moduleList[formKey] = module;\r }.bind(this));\r \r var moduleNodes = this.form._getModuleNodes(this.node);\r moduleNodes.each(function (node) {\r if (node.get(\"MWFtype\") !== \"form\") {\r var _self = this;\r var json = this.form._getDomjson(node);\r //if( json.type === \"Subform\" || json.moduleName === \"subform\" )this.form.subformCount++;\r var module = this.form._loadModule(json, node, function () {\r this.parentformIdList = _self.getParentformIdList();\r });\r this.form.modules.push(module);\r }\r }.bind(this));\r \r this.form.subformLoaded.push(this.subformData.json.id);\r this.fireEvent(\"afterModulesLoad\");\r // this.fireSubFormEvent(\"postLoad\");\r // this.fireSubFormEvent(\"load\");\r // this.fireSubFormEvent(\"afterLoad\");\r }\r }\r // if( this.form.subformLoadedCount ){\r // this.form.subformLoadedCount++;\r // }else{\r // this.form.subformLoadedCount = 1\r // }\r // this.form.checkSubformLoaded();\r },\r getSubform: function (callback) {\r var method = (this.form.json.mode !== \"Mobile\" &amp;&amp; !layout.mobile) ? \"getForm\" : \"getFormMobile\";\r if (this.json.submitFormType === \"script\") {\r if (this.json.submitFormScript &amp;&amp; this.json.submitFormScript.code) {\r var data = this.form.Macro.exec(this.json.submitFormScript.code, this);\r if (data) {\r var formName, app;\r if (typeOf(data) === \"string\") {\r formName = data;\r } else {\r if (data.application) app = data.application;\r if (data.form) formName = data.form;\r }\r if (formName) {\r if (!app) app = (this.form.businessData.work || this.form.businessData.workCompleted).application;\r MWF.Actions.get(\"x_processplatform_assemble_surface\")[method](formName, app, function (json) {\r this.getSubformData(json.data);\r if (callback) callback();\r }.bind(this));\r } else {\r if (callback) callback();\r }\r } else {\r if (callback) callback();\r }\r }\r } else {\r if (this.json.submitFormSelected &amp;&amp; this.json.submitFormSelected !== \"none\") {\r var app;\r if (this.json.submitFormAppSelected) {\r app = this.json.submitFormAppSelected;\r } else {\r app = (this.form.businessData.work || this.form.businessData.workCompleted).application;\r }\r MWF.Actions.get(\"x_processplatform_assemble_surface\")[method](this.json.submitFormSelected, app, function (json) {\r this.getSubformData(json.data);\r if (callback) callback();\r }.bind(this));\r } else {\r if (callback) callback();\r }\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_SubSource.js.html":{"url":"x_component_process_Xform_SubSource.js.html","title":"x_component_process_Xform/SubSource.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/SubSource.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/SubSource.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //COMMON.AjaxModule.load(\"JSONTemplate\", null, false);\r /** @class SubSource 子数据源。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var subSource = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var subSource = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.SubSource = MWF.APPSubSource = new Class(\r /** @lends MWF.xApplication.process.Xform.Subform# */\r {\r Extends: MWF.APP$Module,\r options: {\r /**\r * 加载数据后执行，但这时还未加载下属组件，可以可以使用this.target.data获取数据进行修改。\r * @event MWF.xApplication.process.Xform.SubSource#postLoadData\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 加载数据、下属组件后执行。\r * @event MWF.xApplication.process.Xform.SubSource#loadData\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"queryLoad\",\"postLoad\",\"load\", \"postLoadData\", \"loadData\"]\r },\r load: function(){\r this._loadModuleEvents();\r this._queryLoaded();\r this._loadUserInterface();\r //this._loadStyles();\r //this._loadEvents();\r this._loadDomEvents();\r \r this._afterLoaded();\r },\r _loadUserInterface: function(){\r this.loopNodes = [];\r this.subSourceItems = [];\r var node = new Element(\"div\").inject(this.node, \"before\");\r this.node.inject(node);\r this.loopNode = this.node.dispose();\r this.node = node;\r var id = node.get(\"id\");\r node.set(\"id\", \"\");\r this.node.set({\r \"id\": id,\r \"mwftype\": node.get(\"mwftype\")\r });\r this.node.store(\"module\", this);\r this._loadJsonData();\r },\r _getSource: function(){\r var parent = this.node.getParent();\r while(parent &amp;&amp; (parent.get(\"MWFtype\")!=\"source\" &amp;&amp; parent.get(\"MWFtype\")!=\"subSource\" &amp;&amp; parent.get(\"MWFtype\")!=\"subSourceItem\")) parent = parent.getParent();\r return (parent) ? parent.retrieve(\"module\") : null;\r },\r _getSourceData: function(sourceData){\r var data = sourceData;\r if (this.json.jsonPath!=\".\"){\r var paths = this.json.jsonPath.split(\".\");\r paths.each(function(p){\r data = data[p];\r }.bind(this));\r }\r this.data = data;\r },\r _loopSub: function(dom, i){\r var moduleNodes = this.form._getModuleNodes(dom);\r moduleNodes.each(function(node){\r var json = this.form._getDomjson(node);\r var subJson = Object.clone(json);\r subJson.id = subJson.id+\"_\"+i;\r node.set(\"id\", subJson.id);\r \r var module = this.form._loadModule(subJson, node);\r //this.modules.push(module);\r }.bind(this));\r },\r _loopData: function(){\r this.data.each(function(d, i){\r var node = this.loopNode.clone(true, true);\r node.inject(this.node);\r var json = Object.clone(this.json);\r json.id = json.id+\"_\"+i;\r json.type = \"SubSourceItem\";\r node.set({\r \"id\": json.id,\r \"mwftype\": \"subSourceItem\"\r });\r \r var module = this.form._loadModule(json, node, function(){\r this.data = d;\r this.position = i;\r });\r this.subSourceItems.push(module);\r this.loopNodes.push(node);\r \r this._loopSub(node, i);\r \r }.bind(this));\r },\r _initSubSource: function(){\r if (this.loopNode){\r var moduleNodes = this.form._getModuleNodes(this.node);\r moduleNodes.each(function(node){\r var module = node.retrieve(\"module\");\r if (module){\r if (module.json.type==\"SubSource\"){\r module._initSubSource();\r }else{\r MWF.release(module);\r }\r }\r }.bind(this));\r this.node.empty();\r }\r this.loopNodes = [];\r this.subSourceItems = [];\r },\r _loadJsonData: function(notInit){\r if (!notInit) this._initSubSource();\r this.source = this._getSource();\r if (this.source){\r if (this.source.data){\r this._getSourceData(this.source.data);\r this.fireEvent(\"postLoadData\");\r if (typeOf(this.data)!==\"array\") this.data = [this.data];\r if (typeOf(this.data)==\"array\"){\r this._loopData();\r this.fireEvent(\"loadData\");\r }else{\r this.form._loadModules(this.node);\r }\r \r //this.tmpDiv = new Element(\"div\");\r //var html = \"{loop:\"+this.json.jsonPath+\"}\"+this.node.outerHTML+\"{/loop:\"+this.json.jsonPath+\"}\";\r ////this.template = new Template();\r ////var loopHtml = this.template.substitute(\"{\"+this.json.jsonPath+\"}\", this.source.data);\r //this.node.set(\"text\", this.text);\r \r }\r }\r }\r });\r \r MWF.xApplication.process.Xform.SubSourceItem = MWF.APPSubSourceItem = new Class({\r Extends: MWF.APP$Module,\r _loadUserInterface: function(){\r this.loopNodes = [];\r this.subSourceItems = [];\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Tab.js.html":{"url":"x_component_process_Xform_Tab.js.html","title":"x_component_process_Xform/Tab.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Tab.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Tab.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.require(\"MWF.widget.Tab\", null, false);\r /** @class Tab 分页组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var tab = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var tab = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Tab = MWF.APPTab = new Class(\r /** @lends MWF.xApplication.process.Xform.Tab# */\r {\r \tExtends: MWF.APP$Module,\r \r \t_loadUserInterface: function(){\r this.elements = [];\r this.containers = [];\r \r var style = \"form\";\r if (layout.mobile) style = \"mobileForm\";\r \r /**\r * @summary tab组件，平台使用该组件实现分页组件的功能\r * @member {MWF.widget.Tab}\r * @example\r * //可以在脚本中获取该组件\r * var tab = this.form.get(\"fieldId\").tab; //获取组件对象\r * var pages = tab.pages //获取每个分页\r * pages[1].addEvent(\"queryShow\", function(){\r * //添加显示分页前事件\r * })\r * pages[1].addEvent(\"postShow\", function(){\r * //添加显示分页后事件\r * })\r * pages[1]._showTab(); //显示第2个分页\r */\r \t\tthis.tab = new MWF.widget.Tab(this.node, {\"style\": style});\r \t\t\r \t\tthis._setTabWidgetStyles();\r \r \t\tthis.tab.tabNodeContainer = this.node.getFirst(\"div\");\r \t\tthis.tab.contentNodeContainer = this.tab.tabNodeContainer.getNext(\"div\");\r \r \t\tvar lastNode = this.tab.tabNodeContainer.getLast();\r \t\tvar tabs;\r \t\tif (lastNode &amp;&amp; lastNode.hasClass(\"tabNodeContainerLeft\")){\r this.tab.tabNodeContainerRight = this.tab.tabNodeContainer.getFirst();\r this.tab.tabNodeContainerLeft = lastNode;\r this.tab.tabNodeContainerArea = lastNode.getFirst();\r \r var menuNode = this.node.getElement(\".MWFMenu\");\r if (menuNode) menuNode.destroy();\r this.tab.load();\r tabs = this.tab.tabNodeContainerArea.getChildren(\"div\");\r }else{\r tabs = this.tab.tabNodeContainer.getChildren(\"div\");\r this.tab.load();\r }\r \r \t\tvar contents = this.tab.contentNodeContainer.getChildren(\"div\");\r \t\ttabs.each(function(tab, idx){\r \t\t\tthis.tab.rebuildTab(contents[idx], contents[idx].getFirst(), tab);\r \t\t}.bind(this));\r \t\t\r \t\tthis.tab.pages[0]._showTab();\r this.loadSubModule();\r \t},\r loadSubModule: function(){\r this.tab.pages.each(function(page){\r var node = page.tabNode;\r var json = this.form._getDomjson(node);\r var tab = this;\r var module = this.form._loadModule(json, node, function(){\r this.tab = tab;\r });\r this.elements.push(module);\r this.form.modules.push(module);\r \r if (page.isShow){\r this.showContentModule.call(page, this);\r }else{\r if (this.json.isDelay){\r var _self = this;\r page.showContentModuleFun = function(){_self.showContentModule.call(page, _self)};\r page.addEvent(\"show\", page.showContentModuleFun);\r }else{\r this.showContentModule.call(page, this);\r }\r }\r }.bind(this));\r },\r showContentModule: function(_self){\r var node = this.contentNode;\r node.isLoadModule = true;\r json = _self.form._getDomjson(node);\r tab = _self;\r module = _self.form._loadModule(json, node, function(){\r this.tab = tab;\r });\r _self.containers.push(module);\r _self.form.modules.push(module);\r \r if (this.showContentModuleFun) this.removeEvent(\"show\", this.showContentModuleFun);\r },\r \r \t_setTabWidgetStyles: function(){\r if (this.json.tabNodeContainer) this.tab.css.tabNodeContainer = Object.clone(this.json.tabNodeContainer);\r if (this.json.contentNodeContainer) this.tab.css.contentNodeContainer = Object.clone(this.json.contentNodeContainer);\r \t\tthis.tab.css.tabNode = Object.clone(this.json.tabStyles);\r \t\tthis.tab.css.tabTextNode = Object.clone(this.json.tabTextStyles);\r \t\tthis.tab.css.tabNodeCurrent = Object.clone(this.json.tabCurrentStyles);\r \t\tthis.tab.css.tabTextNodeCurrent = Object.clone(this.json.tabTextCurrentStyles);\r \t}\r });\r MWF.xApplication.process.Xform.tab$Page = MWF.APPTab$Page = new Class({\r Extends: MWF.APP$Module\r });\r MWF.xApplication.process.Xform.tab$Content = MWF.APPTab$Content = new Class({\r Extends: MWF.APP$Module,\r _loadUserInterface: function(){\r this.form._loadModules(this.node);\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Table.js.html":{"url":"x_component_process_Xform_Table.js.html","title":"x_component_process_Xform/Table.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Table.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Table.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Table 表格组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var table = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var table = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Table = MWF.APPTable = new Class(\r /** @lends MWF.xApplication.process.Xform.Table# */\r {\r \tExtends: MWF.APP$Module,\r \t_afterLoaded: function(){\r /**\r * @summary table，DOM对象\r * @member {Element} table\r * @memberOf MWF.xApplication.process.Xform.Table#\r * @example\r * //可以在脚本中获取该组件\r * var table = this.form.get(\"fieldId\").table; //获取组件对象\r */\r if (!this.table) this.table = this.node.getElement(\"table\");\r \t\t//var tds = this.node.getElements(\"td\");\r \t\tvar rows = this.table.rows;\r \t\tfor (var i=0; i&lt;rows.length; i++){\r \t\t var row = rows[i];\r for (var j=0; j&lt;row.cells.length; j++){\r var td = row.cells[j];\r \r var json = this.form._getDomjson(td);\r if (json){\r var table = this;\r var module = this.form._loadModule(json, td, function(){\r this.table = table;\r });\r }\r \r \r this.form.modules.push(module);\r }\r }\r \r // this.table.rows.each(function(row){\r // row.cells.each(function(td){\r // var json = this.form._getDomjson(td);\r // var table = this;\r // var module = this.form._loadModule(json, td, function(){\r // this.table = table;\r // });\r //\r // this.form.modules.push(module);\r // }.bind(this));\r // }.bind(this));\r \r \r \t\t// tds.each(function(td){\r \t\t// \tvar json = this.form._getDomjson(td);\r // var table = this;\r \t\t// \tvar module = this.form._loadModule(json, td, function(){\r // this.table = table;\r // });\r //\r \t\t// \tthis.form.modules.push(module);\r \t\t// }.bind(this));\r \t},\r _loadBorderStyle: function(){\r if (this.json.styles &amp;&amp; this.json.styles.border){\r if (!this.table) this.table = this.node.getElement(\"table\");\r if( this.json.styles[\"table-layout\"] ){\r this.table.setStyle(\"table-layout\",this.json.styles[\"table-layout\"]);\r }\r this.table.set(\"cellspacing\", \"0\");\r this.table.setStyles({\r \"border-top\": this.json.styles.border,\r \"border-left\": this.json.styles.border\r });\r var ths = this.table.getElements(\"th\");\r ths.setStyles({\r \"border-bottom\": this.json.styles.border,\r \"border-right\": this.json.styles.border\r });\r var tds = this.table.getElements(\"td\");\r tds.setStyles({\r \"border-bottom\": this.json.styles.border,\r \"border-right\": this.json.styles.border,\r //\"background\": \"transparent\"\r });\r }\r },\r _loadStyles: function(){\r Object.each(this.json.styles, function(value, key){\r var reg = /^border\\w*/ig;\r if (!key.test(reg)){\r this.node.setStyle(key, value);\r }\r }.bind(this));\r if (this.form.json[\"$version\"]!==\"5.2\") this._loadBorderStyle();\r }\r });\r /** @class Table$Td 单元格组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var td = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var td = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Table$Td = MWF.APPTable$Td = new Class({\r \tExtends: MWF.APP$Module,\r _queryLoaded: function(){\r \r },\r _afterLoaded: function(){\r //this.form._loadModules(this.node);\r },\r _loadStyles: function(){\r \r var addStyles = {};\r if (this.json.cellType==\"title\"){\r addStyles = this.table.json.titleTdStyles;\r }\r if (this.json.cellType==\"content\"){\r addStyles = this.table.json.contentTdStyles;\r }\r if (this.json.cellType==\"layout\"){\r addStyles = this.table.json.layoutTdStyles;\r }\r Object.each(addStyles, function(value, key){\r if ((value.indexOf(\"x_processplatform_assemble_surface\")!==-1 || value.indexOf(\"x_portal_assemble_surface\")!==-1)){\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r if (value.indexOf(\"/x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"/x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }else if (value.indexOf(\"x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }\r if (value.indexOf(\"/x_portal_assemble_surface\")!==-1){\r value = value.replace(\"/x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }else if (value.indexOf(\"x_portal_assemble_surface\")!==-1){\r value = value.replace(\"x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }\r value = o2.filterUrl(value);\r this.node.setStyle(key, value);\r }else{\r if (!this.json.preprocessing) this.node.setStyle(key, value);\r }\r \r }.bind(this));\r \r Object.each(this.json.styles, function(value, key){\r if ((value.indexOf(\"x_processplatform_assemble_surface\")!==-1 || value.indexOf(\"x_portal_assemble_surface\")!==-1)){\r var host1 = MWF.Actions.getHost(\"x_processplatform_assemble_surface\");\r var host2 = MWF.Actions.getHost(\"x_portal_assemble_surface\");\r if (value.indexOf(\"/x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"/x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }else if (value.indexOf(\"x_processplatform_assemble_surface\")!==-1){\r value = value.replace(\"x_processplatform_assemble_surface\", host1+\"/x_processplatform_assemble_surface\");\r }\r if (value.indexOf(\"/x_portal_assemble_surface\")!==-1){\r value = value.replace(\"/x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }else if (value.indexOf(\"x_portal_assemble_surface\")!==-1){\r value = value.replace(\"x_portal_assemble_surface\", host2+\"/x_portal_assemble_surface\");\r }\r value = o2.filterUrl(value);\r }\r this.node.setStyle(key, value);\r }.bind(this));\r \r if (this.json.cellType==\"content\"){\r this.form.addEvent(\"postLoad\", function(){\r var inputs = this.node.getElements(\"input\");\r inputs.each(function(input){\r var inputType = input.get(\"type\").toLowerCase();\r if (inputType!=\"radio\" &amp;&amp; inputType!=\"checkbox\" &amp;&amp; inputType!=\"submit\" &amp;&amp; inputType!=\"buttom\" &amp;&amp; inputType!=\"image\"){\r input.setStyle(\"width\", \"100%\");\r }\r }.bind(this));\r var textareas = this.node.getElements(\"textarea\");\r textareas.each(function(textarea){\r textarea.setStyle(\"width\", \"100%\");\r }.bind(this));\r \r }.bind(this))\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Textarea.js.html":{"url":"x_component_process_Xform_Textarea.js.html","title":"x_component_process_Xform/Textarea.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Textarea.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Textarea.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r /** @class Textarea 多行文本组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Textarea = MWF.APPTextarea = new Class({\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \t\r \t_loadUserInterface: function(){\r \t\tthis._loadNode();\r if (this.json.compute == \"show\"){\r this._setValue(this._computeValue());\r }else{\r this._loadValue();\r }\r \t},\r _loadNode: function(){\r if (this.readonly || this.json.isReadonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r },\r \r \r _setValue: function(value){\r \t if (!value) value = \"\";\r var p = o2.promiseAll(value).then(function(v){\r if (o2.typeOf(v)==\"array\") v = v[0];\r this._setBusinessData(v);\r if (this.node.getFirst()) this.node.getFirst().set(\"value\", v || \"\");\r if (this.readonly || this.json.isReadonly){\r var reg = new RegExp(\"\\n\",\"g\");\r var reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r var reg3 = new RegExp(\"\\u003e\",\"g\");\r var text = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r this.node.set(\"html\", text);\r }\r //this.__setValue(v);\r }.bind(this), function(){});\r this.moduleValueAG = p;\r p.then(function(){\r this.moduleValueAG = null;\r }.bind(this), function(){\r this.moduleValueAG = null;\r }.bind(this));\r \r // this.moduleValueAG = o2.AG.all(value).then(function(v){\r // this.moduleValueAG = null;\r // if (o2.typeOf(v)==\"array\") v = v[0];\r // this._setBusinessData(v);\r // if (this.node.getFirst()) this.node.getFirst().set(\"value\", v || \"\");\r // if (this.readonly || this.json.isReadonly){\r // var reg = new RegExp(\"\\n\",\"g\");\r // var reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r // var reg3 = new RegExp(\"\\u003e\",\"g\");\r // var text = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r // this.node.set(\"html\", text);\r // }\r // }.bind(this));\r //\r // if (this.moduleValueAG) this.moduleValueAG.then(function(){\r // this.moduleValueAG = null;\r // }.bind(this));\r \r return value;\r \r // if (value &amp;&amp; value.isAG){\r // this.moduleValueAG = value;\r // value.addResolve(function(v){\r // this._setValue(v);\r // }.bind(this));\r // }else{\r // this._setBusinessData(value);\r // if (this.node.getFirst()) this.node.getFirst().set(\"value\", value || \"\");\r // if (this.readonly || this.json.isReadonly){\r // var reg = new RegExp(\"\\n\",\"g\");\r // var reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r // var reg3 = new RegExp(\"\\u003e\",\"g\");\r // var text = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r // this.node.set(\"html\", text);\r // }\r // return value;\r // }\r },\r \r // _setValue: function(value){\r // this._setBusinessData(value);\r // if (this.node.getFirst()) this.node.getFirst().set(\"value\", value || \"\");\r // if (this.readonly || this.json.isReadonly){\r // var reg = new RegExp(\"\\n\",\"g\");\r // var reg2 = new RegExp(\"\\u003c\",\"g\"); //尖括号转义，否则内容会截断\r // var reg3 = new RegExp(\"\\u003e\",\"g\");\r // var text = value.replace(reg2,\"&amp;lt\").replace(reg3,\"&amp;gt\").replace(reg,\"&lt;br/>\");\r // this.node.set(\"html\", text);\r // }\r // },\r _resetNodeEdit: function(){\r var input = new Element(\"textarea\", {\"styles\": {\r \"background\": \"transparent\",\r \"width\": \"100%\",\r \"border\": \"0px\"\r }});\r var node = new Element(\"div\", {\"styles\": {\r \"ovwrflow\": \"hidden\",\r \"position\": \"relative\",\r \"padding-right\": \"2px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r this.node.destroy();\r this.node = node;\r },\r _loadNodeEdit: function(){\r if (!this.json.preprocessing) this._resetNodeEdit();\r var input = this.node.getFirst();\r input.set(this.json.properties);\r \r if( this.form.json.textareaDisableResize )input.setStyle(\"resize\",\"none\");\r \r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"MWFType\": this.json.type\r \t\t});\r this.node.addEvent(\"change\", function(){\r this._setBusinessData(this.getInputData());\r }.bind(this));\r \r this.node.getFirst().addEvent(\"blur\", function(){\r this.validation();\r }.bind(this));\r this.node.getFirst().addEvent(\"keyup\", function(){\r this.validationMode();\r }.bind(this));\r \t},\r \t_afterLoaded: function(){\r if (!this.readonly){\r this.loadDescription();\r }\r \t},\r loadDescription: function(){\r if (this.readonly || this.json.isReadonly)return;\r var v = this._getBusinessData();\r if (!v){\r if (this.json.description){\r var size = this.node.getFirst().getSize();\r var w = size.x-3;\r if( this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ){\r w = size.x-23;\r }\r this.descriptionNode = new Element(\"div\", {\"styles\": this.form.css.descriptionNode, \"text\": this.json.description}).inject(this.node);\r this.descriptionNode.setStyles({\r \"width\": \"\"+w+\"px\",\r \"height\": \"\"+size.y+\"px\",\r \"line-height\": \"\"+size.y+\"px\"\r });\r this.setDescriptionEvent();\r }\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r if (COMMON.Browser.Platform.name===\"ios\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }else if (COMMON.Browser.Platform.name===\"android\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }else{\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r }.bind(this)\r });\r }\r this.node.getFirst().addEvents({\r \"focus\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r }.bind(this),\r \"blur\": function(){\r if (!this.node.getFirst().get(\"value\")) this.descriptionNode.setStyle(\"display\", \"block\");\r }.bind(this)\r });\r }\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Textfield.js.html":{"url":"x_component_process_Xform_Textfield.js.html","title":"x_component_process_Xform/Textfield.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Textfield.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Textfield.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Input\", null, false);\r /** @class Textfield 文本输入框。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.$Input\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Textfield = MWF.APPTextfield = new Class({\r \tImplements: [Events],\r \tExtends: MWF.APP$Input,\r \ticonStyle: \"textFieldIcon\",\r \t\r \t_loadUserInterface: function(){\r \t\tthis._loadNode();\r if (this.json.compute === \"show\"){\r this._setValue(this._computeValue());\r }else{\r this._loadValue();\r }\r \t},\r _loadNode: function(){\r if (this.readonly || this.json.isReadonly){\r this._loadNodeRead();\r }else{\r this._loadNodeEdit();\r }\r },\r loadDescription: function(){\r if (this.readonly || this.json.isReadonly)return;\r var v = this._getBusinessData();\r if (!v){\r if (this.json.description){\r var size = this.node.getFirst().getSize();\r var w = size.x-3;\r if( this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon ){\r if (COMMON.Browser.safari) w = w-20;\r }\r this.descriptionNode = new Element(\"div\", {\"styles\": this.form.css.descriptionNode, \"text\": this.json.description}).inject(this.node);\r this.descriptionNode.setStyles({\r \"width\": \"\"+w+\"px\",\r \"height\": \"\"+size.y+\"px\",\r \"line-height\": \"\"+size.y+\"px\"\r });\r this.setDescriptionEvent();\r }\r }\r },\r setDescriptionEvent: function(){\r if (this.descriptionNode){\r if (COMMON.Browser.Platform.name===\"ios\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r this.node.getFirst().fireEvent(\"click\");\r }.bind(this)\r });\r }else if (COMMON.Browser.Platform.name===\"android\"){\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r this.node.getFirst().fireEvent(\"click\");\r }.bind(this)\r });\r }else{\r this.descriptionNode.addEvents({\r \"click\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r this.node.getFirst().focus();\r this.node.getFirst().fireEvent(\"click\");\r }.bind(this)\r });\r }\r \r this.node.getFirst().addEvents({\r \"focus\": function(){\r this.descriptionNode.setStyle(\"display\", \"none\");\r }.bind(this),\r \"blur\": function(){\r if (!this.node.getFirst().get(\"value\")) this.descriptionNode.setStyle(\"display\", \"block\");\r }.bind(this)\r });\r }\r },\r _loadNodeRead: function(){\r this.node.empty();\r this.node.set({\r \"nodeId\": this.json.id,\r \"MWFType\": this.json.type\r });\r },\r \r _resetNodeEdit: function(){\r var input = new Element(\"input\", {\r \"styles\": {\r \"background\": \"transparent\",\r \"width\": \"100%\",\r \"display\": \"block\",\r \"border\": \"0px\"\r }\r });\r \r var node = new Element(\"div\", {\"styles\": {\r \"overflow\": \"hidden\",\r \"position\": \"relative\",\r \"margin-right\": \"20px\",\r \"padding-right\": \"4px\"\r }}).inject(this.node, \"after\");\r input.inject(node);\r \r this.node.destroy();\r this.node = node;\r },\r \r _loadNodeEdit: function(){\r if (!this.json.preprocessing) this._resetNodeEdit();\r var input = this.node.getFirst();\r input.set(this.json.properties);\r this.node.set({\r \"id\": this.json.id,\r \"MWFType\": this.json.type,\r \"events\": {\r \"click\": this.clickSelect.bind(this)\r }\r });\r if (this.json.showIcon!='no' &amp;&amp; !this.form.json.hideModuleIcon){\r this.iconNode = new Element(\"div\", {\r \"styles\": this.form.css[this.iconStyle]\r }).inject(this.node, \"before\");\r }else if( this.form.json.nodeStyleWithhideModuleIcon ){\r this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon);\r }\r \r this.node.getFirst().addEvent(\"change\", function(){\r var v = this.getInputData(\"change\");\r this._setBusinessData(v);\r this.validationMode();\r if (this.validation()) this._setBusinessData(v);\r }.bind(this));\r if (this.json.ANNModel){\r this.node.getFirst().addEvent(\"focus\", function(){\r o2.Actions.get(\"x_query_assemble_surface\").calculateNeural(this.json.ANNModel, this.form.businessData.work.id, function(json){\r var arr = json.data.filter(function(d){\r var value = this.node.getFirst().get(\"value\");\r return d.score>0.1 &amp;&amp; (value.indexOf(d.value)===-1)\r }.bind(this));\r if (arr.length){\r if (!this.modelNode) this.createModelNode();\r this.modelNode.getLast().empty();\r this.modelNode.show();\r this.modelNode.position({ \"relativeTo\": this.node, \"position\": \"bottomLeft\", \"edge\": 'upperLeft' });\r \r arr.each(function(v){\r var node = new Element(\"div\", {\"text\": v.value, \"styles\": this.form.css.modelItemNode}).inject(this.modelNode.getLast());\r node.addEvents({\r \"mouseover\": function(){this.setStyle(\"color\", \"#0000ff\");},\r \"mouseout\": function(){this.setStyle(\"color\", \"#a31515\");},\r \"mousedown\": function(e){\r var str = this.node.getFirst().get(\"value\")\r this.node.getFirst().set(\"value\", ((str) ? str+\", \"+e.target.get(\"text\") : e.target.get(\"text\")));\r this.modelNode.hide();\r }.bind(this)\r });\r }.bind(this));\r }\r }.bind(this));\r }.bind(this));\r \r this.node.getFirst().addEvent(\"blur\", function(){\r if (this.modelNode) this.modelNode.hide();\r }.bind(this));\r }\r \r this.node.getFirst().addEvent(\"blur\", function(){\r this.validation();\r }.bind(this));\r this.node.getFirst().addEvent(\"keyup\", function(){\r this.validationMode();\r }.bind(this));\r \t},\r createModelNode: function(){\r this.modelNode = new Element(\"div\", {\"styles\": this.form.css.modelNode}).inject(this.node, \"after\");\r new Element(\"div\", {\"styles\": this.form.css.modelNodeTitle, \"text\": MWF.xApplication.process.Xform.LP.ANNInput}).inject(this.modelNode);\r new Element(\"div\", {\"styles\": this.form.css.modelNodeContent, \"text\": MWF.xApplication.process.Xform.LP.ANNInput}).inject(this.modelNode);\r },\r \r \r getInputData: function(){\r if (this.node.getFirst()){\r var v = this.node.getElement(\"input\").get(\"value\");\r if (this.json.dataType==\"number\"){\r var n = v.toFloat();\r return (isNaN(n)) ? 0 : n;\r }\r }else{\r return this._getBusinessData();\r }\r return v;\r }\r \r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Tree.js.html":{"url":"x_component_process_Xform_Tree.js.html","title":"x_component_process_Xform/Tree.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Tree.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Tree.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /**树组件数据结构\r * @typedef {Object} TreeData\r * @example\r * [\r * {\r * \"expand\": true, //是否默认展开\r * \"title\": \"\", //鼠标移上叶子节点的文字\r * \"text\": \"根节点\", //叶子节点的文字\r * \"action\": \"\", //执行的脚本\r * \"default\": true, //是否默认选中\r * \"icon\": \"folder.png\", //图标\r * \"sub\": [ //该节点的子节点\r * {\r * \"expand\": true,\r * \"title\": \"\",\r * \"text\": \"[none]\",\r * \"action\": \"\",\r * \"default\": false,\r * \"icon\": \"folder.png\",\r * \"sub\": []\r * },\r * ...\r * ]\r * }\r * ]\r */\r \r /** @class Tree 树组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var datagrid = this.form.get(\"name\"); //获取组件\r * //方法2\r * var datagrid = this.target; //在组件事件脚本中获取\r * @see {@link TreeData|树组件数据结构}\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Tree = MWF.APPTree = new Class(\r \t/** @lends MWF.xApplication.process.Xform.Tree# */\r {\r \tExtends: MWF.APP$Module,\r \toptions: {\r \t\t/**\r \t\t * 异步加载树前执行。this.target指向当前组件。\r \t\t * @event MWF.xApplication.process.Xform.Tree#beforeLoadTree\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 异步加载树后执行。this.target指向当前组件。\r \t\t * @event MWF.xApplication.process.Xform.Tree#afterLoadTree\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 加载树的叶子前执行。this.target指向加载的叶子。\r \t\t * @event MWF.xApplication.process.Xform.Tree#beforeLoadTreeNode\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 加载树的叶子后执行。this.target指向加载的叶子。\r \t\t * @event MWF.xApplication.process.Xform.Tree#afterLoadTreeNode\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 加载树的叶子后执行。this.target指向加载的叶子。\r \t\t * @event MWF.xApplication.process.Xform.Tree#expand\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 折叠节点的时候执行。this.target指向被折叠的节点。\r \t\t * @event MWF.xApplication.process.Xform.Tree#collapse\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 选中节点前执行。此时原来被选中的节点还未取消。this.target指向选中的节点。\r \t\t * @event MWF.xApplication.process.Xform.Tree#beforeSelect\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t/**\r \t\t * 选中节点后执行。this.target指向选中的节点。\r \t\t * @event MWF.xApplication.process.Xform.Tree#afterSelect\r \t\t * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r \t\t */\r \t\t\"moduleEvents\": [\"load\", \"queryLoad\", \"postLoad\", \"beforeLoadTree\", \"afterLoadTree\", \"beforeLoadTreeNode\", \"afterLoadTreeNode\", \"expand\", \"collapse\", \"beforeSelect\", \"afterSelect\"]\r \t},\r \r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r \r \t\tMWF.require(\"MWF.widget.Tree\", function(){\r \t\t\tvar options = {\"style\":\"form\"};\r \t\t\tif( this.json.events &amp;&amp; typeOf(this.json.events) === \"object\" ){\r \t\t\t\t[\r \t\t\t\t\t{ \"beforeLoadTree\" : \"onQueryLoad\" },\r \t\t\t\t\t{ \"afterLoadTree\" : \"onPostLoad\" },\r \t\t\t\t\t{ \"beforeLoadTreeNode\" : \"onBeforeLoadTreeNode\" },\r \t\t\t\t\t{ \"afterLoadTreeNode\" : \"onAfterLoadTreeNode\" },\r \t\t\t\t\t{ \"expand\" : \"onPostExpand\" },\r \t\t\t\t\t{ \"collapse\" : \"onPostCollapse\" },\r \t\t\t\t\t{ \"beforeSelect\" : \"onBeforeSelect\" },\r \t\t\t\t\t{ \"afterSelect\" : \"onAfterSelect\" }\r \t\t\t\t].each( function (obj) {\r \t\t\t\t\tvar moduleEvent = Object.keys(obj)[0];\r \t\t\t\t\tvar treeEvent = obj[moduleEvent];\r \t\t\t\t\tif( this.json.events[moduleEvent] &amp;&amp; this.json.events[moduleEvent].code ){\r \t\t\t\t\t\toptions[treeEvent] = function( target ){\r \t\t\t\t\t\t\treturn this.form.Macro.fire(this.json.events[moduleEvent].code, target || this);\r \t\t\t\t\t\t}.bind(this)\r \t\t\t\t\t}\r \t\t\t\t}.bind(this));\r \t\t\t}\r \r \t\t\t/**\r \t\t\t * @summary 树组件，平台使用该组件实现树的功能，该组件为异步加载\r \t\t\t * @member {o2.widget.Tree}\r \t\t\t * @example\r \t\t\t * //可以在脚本中获取该组件\r \t\t\t * var tree = this.form.get(\"fieldId\").tree; //获取组件对象\r \t\t\t * var children = tree.children[]; //获取第一层树叶\r \t\t\t * tree.reLoad( json ); //给整颗树重新赋数据，并重新加载\r \t\t\t */\r \t\t\tthis.tree = new MWF.widget.Tree(this.node, options);\r \t\t\tthis.tree.form = this.form;\r \r \t\t\tthis._setTreeWidgetStyles();\r \r \r \t\t\tvar treeData = this.json.data;\r \t\t\tif (this.json.dataType == \"script\") treeData = this.form.Macro.exec(((this.json.dataScript) ? this.json.dataScript.code : \"\"), this);\r \r \t\t\tthis.tree.load(treeData);\r \t\t}.bind(this));\r \t},\r \t_setTreeWidgetStyles: function(){\r \t\tthis.tree.css.areaNode = this.json.areaNodeStyle;\r \t\tthis.tree.css.treeItemNode = this.json.treeItemNodeStyle;\r \t\tthis.tree.css.textDivNode = this.json.textDivNodeStyle;\r \t\tthis.tree.css.textDivNodeSelected = this.json.textDivNodeSelectedStyle;\r \t}\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_View.js.html":{"url":"x_component_process_Xform_View.js.html","title":"x_component_process_Xform/View.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/View.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/View.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r //MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", null, false);\r /** @class View 视图组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var view = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var view = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Process|CMS|Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.View = MWF.APPView = new Class(\r /** @lends MWF.xApplication.process.Xform.View# */\r {\r \tExtends: MWF.APP$Module,\r options: {\r /**\r * 异步加载视图后完成。\r * @event MWF.xApplication.process.Xform.View#loadView\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 选中视图中的一条记录后执行。\r * @event MWF.xApplication.process.Xform.View#select\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r /**\r * 打开视图中的一条记录后执行。\r * @event MWF.xApplication.process.Xform.View#openDocument\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"moduleEvents\": [\"load\", \"loadView\", \"queryLoad\", \"postLoad\", \"select\", \"openDocument\"]\r },\r \r _loadUserInterface: function(){\r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", null, false);\r this.node.empty();\r },\r _afterLoaded: function(){\r if (this.json.queryView){\r this.loadView();\r }else{\r if (this.json.selectViewType===\"cms\"){\r this.loadCMSView();\r }else if (this.json.selectViewType===\"process\"){\r this.loadPrcessView();\r }else{\r this.loadView();\r }\r }\r },\r /**\r * @summary 重新加载视图\r * @example\r * this.form.get(\"fieldId\").reload()\r */\r reload: function(){\r if (this.view){\r if (this.view.loadViewRes &amp;&amp; this.view.loadViewRes.res) if (this.view.loadViewRes.res.isRunning()) this.view.loadViewRes.res.cancel();\r if (this.view.getViewRes &amp;&amp; this.view.getViewRes.res) if (this.view.getViewRes.res.isRunning()) this.view.getViewRes.res.cancel();\r }\r this.node.empty();\r this.loadView();\r },\r /**\r * @summary 当视图被设置为延迟加载（未立即载入），通过active方法激活\r * @example\r * this.form.get(\"fieldId\").active()\r */\r active: function(){\r if (this.view){\r if (!this.view.loadingAreaNode) this.view.loadView();\r }else{\r this.loadView();\r }\r },\r loadView: function(){\r if (!this.json.queryView || !this.json.queryView.name || !this.json.queryView.appName) return \"\";\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r \r \r \r //var data = JSON.parse(this.json.data);\r var viewJson = {\r \"application\": (this.json.queryView) ? this.json.queryView.appName : this.json.application,\r \"viewName\": (this.json.queryView) ? this.json.queryView.name : this.json.viewName,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"none\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter,\r \"defaultSelectedScript\" : this.json.defaultSelectedScript ? this.json.defaultSelectedScript.code : null,\r \"selectedAbleScript\" : this.json.selectedAbleScript ? this.json.selectedAbleScript.code : null\r };\r \r //MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r this.view = new MWF.xApplication.query.Query.Viewer(this.node, viewJson, {\r \"isload\": (this.json.loadView!==\"no\"),\r \"resizeNode\": (this.node.getStyle(\"height\").toString().toLowerCase()!==\"auto\" &amp;&amp; this.node.getStyle(\"height\").toInt()>0),\r \"onLoadView\": function(){\r this.fireEvent(\"loadView\");\r }.bind(this),\r \"onSelect\": function(){\r this.fireEvent(\"select\");\r }.bind(this),\r \"onOpenDocument\": function(options, item){\r this.openOptions = {\r \"options\": options,\r \"item\": item\r };\r this.fireEvent(\"openDocument\");\r this.openOptions = null;\r }.bind(this)\r }, this.form.app, this.form.Macro);\r //}.bind(this));\r },\r \r loadPrcessView: function(){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r var viewJson = {\r \"application\": this.json.processView.application,\r \"viewName\": this.json.processView.name,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"none\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter\r };\r MWF.xDesktop.requireApp(\"process.Application\", \"Viewer\", function(){\r this.view = new MWF.xApplication.process.Application.Viewer(this.node, viewJson, {\r \"resizeNode\": (this.node.getStyle(\"height\").toString().toLowerCase()!==\"auto\" &amp;&amp; this.node.getStyle(\"height\").toInt()>0),\r \"onSelect\": function(){\r this.fireEvent(\"select\");\r }.bind(this)\r });\r }.bind(this));\r },\r loadCMSView: function(){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r var viewJson = {\r \"application\": this.json.cmsView.appId,\r \"viewName\": this.json.cmsView.name,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"none\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter\r };\r \r MWF.xDesktop.requireApp(\"process.Application\", \"Viewer\", function(){\r /**\r * @summary view组件，平台使用该组件实现视图的功能\r * @member {MWF.xApplication.process.Application.Viewer}\r * @example\r * //可以在脚本中获取该组件\r * var view = this.form.get(\"fieldId\").view; //获取组件对象\r */\r this.view = new MWF.xApplication.process.Application.Viewer(this.node, viewJson, {\r \"actions\": {\r \"lookup\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\":\"PUT\"},\r \"getView\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\"}\r },\r \"actionRoot\": \"x_cms_assemble_control\",\r \"resizeNode\": (this.node.getStyle(\"height\").toString().toLowerCase()!==\"auto\" &amp;&amp; this.node.getStyle(\"height\").toInt()>0),\r \"onSelect\": function(){\r this.fireEvent(\"select\");\r }.bind(this)\r });\r }.bind(this));\r },\r /**\r * @summary 获取视图被选中行的数据\r * @return {Object[]} 被选中行的数据\r * @example\r * var data = this.form.get(\"fieldId\").getData();\r */\r getData: function(){\r if (this.view.selectedItems.length){\r var arr = [];\r this.view.selectedItems.each(function(item){\r arr.push(item.data);\r });\r return arr;\r }else{\r return [];\r }\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_ViewSelector.js.html":{"url":"x_component_process_Xform_ViewSelector.js.html","title":"x_component_process_Xform/ViewSelector.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/ViewSelector.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/ViewSelector.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.xDesktop.requireApp(\"process.Xform\", \"Button\", null, false);\r /** @class ViewSelector 视图选择组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var sourceText = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var sourceText = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.Button\r * @o2category FormComponents\r * @o2range {Process|CMS}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.ViewSelector = MWF.APPViewSelector = new Class({\r \tImplements: [Events],\r \tExtends: MWF.xApplication.process.Xform.Button,\r \r \t_loadUserInterface: function(){\r var button = this.node.getElement(\"button\");\r \t\tif (!button) button = new Element(\"button\");\r \t\tbutton.inject(this.node, \"after\");\r \t\tthis.node.destroy();\r \t\tthis.node = button;\r \t\tthis.node.set({\r \t\t\t\"id\": this.json.id,\r \t\t\t\"text\": this.json.name || this.json.id,\r \t\t\t\"styles\": this.form.css.buttonStyles,\r \t\t\t\"MWFType\": this.json.type\r \t\t});\r this.node.addEvent(\"click\", function(){\r this.selectedData = null;\r this.selectView(function(data){\r this.doResult(data);\r }.bind(this));\r }.bind(this));\r \t},\r doResult: function(data){\r if (this.json.result === \"script\"){\r this.selectedData = data;\r return (this.json.selectedScript.code) ? this.form.Macro.exec(this.json.selectedScript.code, this) : \"\";\r }else{\r Object.each(this.json.selectedSetValues, function(v, k){\r var value = \"\";\r data.each(function(d, idx){\r Object.each(d.data, function(dv, dk){\r if (dk===v) value = (value) ? (value+\", \"+dv) : dv;\r }.bind(this));\r }.bind(this));\r \r var field = this.form.all[k];\r if (field){\r field.setData(value);\r if (value){\r if (field.descriptionNode) field.descriptionNode.setStyle(\"display\", \"none\");\r }else{\r if (field.descriptionNode) field.descriptionNode.setStyle(\"display\", \"block\");\r }\r }\r }.bind(this));\r }\r },\r \r selectCMSView: function(callback){\r var viewData = this.json.cmsViewName;\r if (viewData){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r var viewJson = {\r \"application\": viewData.appId,\r \"viewName\": viewData.name,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"single\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter\r };\r var options = {};\r var width = options.width || \"800\";\r var height = options.height || \"450\";\r \r var size;\r if (layout.mobile){\r size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r size = this.form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.json.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div>&lt;/div>\",\r \"maskNode\": this.form.app.content,\r \"container\": this.form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r // MWF.xDesktop.requireApp(\"process.Xform\", \"widget.CMSView\", function(){\r // this.view = new MWF.xApplication.process.Xform.widget.CMSView(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // }.bind(this));\r \r MWF.xDesktop.requireApp(\"process.Application\", \"Viewer\", function(){\r this.view = new MWF.xApplication.process.Application.Viewer(dlg.content, viewJson, {\r \"actions\": {\r \"lookup\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\":\"PUT\"},\r \"getView\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\"}\r },\r \"actionRoot\": \"x_cms_assemble_control\"\r });\r }.bind(this));\r }.bind(this));\r }\r },\r selectProcessView: function(callback){\r var viewData = this.json.processViewName;\r if (viewData){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r \r var viewJson = {\r \"application\": viewData.application,\r \"viewName\": viewData.name,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"single\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter\r };\r var options = {};\r var width = options.width || \"800\";\r var height = options.height || \"600\";\r \r var size;\r if (layout.mobile){\r size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r size = this.form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.json.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"\",\r \"maskNode\": this.form.app.content,\r \"container\": this.form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r // MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", function(){\r // this.view = new MWF.xApplication.process.Xform.widget.View(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // }.bind(this));\r \r MWF.xDesktop.requireApp(\"process.Application\", \"Viewer\", function(){\r this.view = new MWF.xApplication.process.Application.Viewer(dlg.content, viewJson);\r }.bind(this));\r }.bind(this));\r }\r },\r \r selectQueryView: function(callback){\r var viewData = this.json.queryView;\r \r if (viewData){\r var filter = null;\r if (this.json.filterList &amp;&amp; this.json.filterList.length){\r filter = [];\r this.json.filterList.each(function(entry){\r entry.value = this.form.Macro.exec(entry.code.code, this);\r //delete entry.code;\r filter.push(entry);\r }.bind(this));\r }\r \r var viewJson = {\r \"application\": viewData.appName,\r \"viewName\": viewData.name,\r \"viewId\": viewData.id,\r \"isTitle\": this.json.isTitle || \"yes\",\r \"select\": this.json.select || \"single\",\r \"titleStyles\": this.json.titleStyles,\r \"itemStyles\": this.json.itemStyles,\r \"isExpand\": this.json.isExpand || \"no\",\r \"showActionbar\" : this.json.actionbar === \"show\",\r \"filter\": filter,\r \"defaultSelectedScript\" : this.json.defaultSelectedScript ? this.json.defaultSelectedScript.code : null,\r \"selectedAbleScript\" : this.json.selectedAbleScript ? this.json.selectedAbleScript.code : null\r };\r var options = {};\r var width = options.width || \"850\";\r var height = options.height || \"700\";\r \r if (layout.mobile){\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = this.form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": this.json.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"\",\r \"maskNode\": layout.mobile?$(document.body) : this.form.app.content,\r \"container\": layout.mobile?$(document.body) : this.form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ],\r \"onPostShow\": function(){\r if(layout.mobile){\r dlg.node.setStyle(\"z-index\",200);\r }\r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r this.view = new MWF.xApplication.query.Query.Viewer(dlg.content, viewJson, {\"style\": \"select\"}, this.form.app, this.form.Macro );\r }.bind(this));\r }.bind(this)\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r // MWF.xDesktop.requireApp(\"process.Xform\", \"widget.View\", function(){\r // this.view = new MWF.xApplication.process.Xform.widget.View(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // }.bind(this));\r // MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r // this.view = new MWF.xApplication.query.Query.Viewer(dlg.content, viewJson, {\"style\": \"select\"});\r // }.bind(this));\r }.bind(this));\r }\r },\r selectView: function(callback){\r if (this.json.queryView){\r this.selectQueryView(callback);\r }else{\r if (this.json.selectViewType===\"cms\"){\r this.selectCMSView(callback);\r }else{\r this.selectProcessView(callback);\r }\r }\r }\r \t\r }); \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_process_Xform_Widget.js.html":{"url":"x_component_process_Xform_Widget.js.html","title":"x_component_process_Xform/Widget.js","kind":"source","body":" O2OA WebAPI: x_component_process_Xform/Widget.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_process_Xform/Widget.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r /** @class Widget 门户的部件组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var widget = this.form.get(\"fieldId\"); //获取组件\r * //方法2\r * var widget = this.target; //在组件本身的脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {Portal}\r * @hideconstructor\r */\r MWF.xApplication.process.Xform.Widget = MWF.APPWidget = new Class(\r /** @lends MWF.xApplication.process.Xform.Widget# */\r {\r Extends: MWF.APP$Module,\r \r _loadUserInterface: function(){\r \r this.node.empty();\r this.getWidget(function(){\r this.loadWidget();\r }.bind(this));\r },\r /**\r * @summary 重新加载部件\r * @example\r * this.form.get(\"fieldId\").reload()\r */\r reload: function(){\r this.node.empty();\r this.getWidget(function(){\r this.loadWidget();\r }.bind(this));\r },\r loadCss: function(){\r if (this.widgetData.json.css &amp;&amp; this.widgetData.json.css.code){\r var cssText = this.form.parseCSS(this.widgetData.json.css.code);\r var rex = new RegExp(\"(.+)(?=\\\\{)\", \"g\");\r var match;\r var id = this.form.json.id.replace(/\\-/g, \"\");\r while ((match = rex.exec(cssText)) !== null) {\r var prefix = \".css\" + id + \" \";\r var rule = prefix + match[0];\r cssText = cssText.substring(0, match.index) + rule + cssText.substring(rex.lastIndex, cssText.length);\r rex.lastIndex = rex.lastIndex + prefix.length;\r }\r \r var styleNode = $(\"style\"+this.form.json.id);\r if (!styleNode){\r var styleNode = document.createElement(\"style\");\r styleNode.setAttribute(\"type\", \"text/css\");\r styleNode.id=\"style\"+this.form.json.id;\r styleNode.inject(this.form.container, \"before\");\r }\r \r if(styleNode.styleSheet){\r var setFunc = function(){\r styleNode.styleSheet.cssText += cssText;\r };\r if(styleNode.styleSheet.disabled){\r setTimeout(setFunc, 10);\r }else{\r setFunc();\r }\r }else{\r var cssTextNode = document.createTextNode(cssText);\r styleNode.appendChild(cssTextNode);\r }\r }\r },\r checkWidgetNested : function( id ){\r if( this.parentpageIdList ){\r return !this.parentpageIdList.contains( id );\r }else{\r return ![ this.form.json.id ].contains( id );\r }\r },\r getParentpageIdList : function(){\r var parentpageIdList;\r if( this.parentpageIdList ){\r parentpageIdList = Array.clone( this.parentpageIdList );\r parentpageIdList.push( this.widgetData.json.id )\r }else{\r parentpageIdList = [ this.form.json.id, this.widgetData.json.id ];\r }\r return parentpageIdList;\r },\r loadWidget: function(){\r if (this.widgetData ){\r if( this.checkWidgetNested( this.widgetData.json.id ) ){\r //this.form.addEvent(\"postLoad\", function(){\r \r this.loadCss();\r \r this.form.widgetModules = this.form.widgetModules || {};\r var widgetModules = this.form.widgetModules[ this.json.id ] = {};\r \r var params = this.getPageParamenters();\r if( typeOf(params) === \"object\" &amp;&amp; this.form.Macro &amp;&amp; this.form.Macro.environment ){\r var environment = this.form.Macro.environment;\r environment.widgetParameters = environment.widgetParameters || {};\r environment.widgetParameters[ this.json.id ] = params;\r }\r \r this.node.set(\"html\", this.widgetData.html);\r Object.each(this.widgetData.json.moduleList, function(module, key){\r var formKey = key;\r if (this.form.json.moduleList[key]){\r formKey = this.json.id+\"_\"+key;\r var moduleNode = this.node.getElement(\"#\"+key);\r if (moduleNode) moduleNode.set(\"id\", formKey);\r module.orgiginalId = key;\r module.id = formKey;\r }\r this.form.json.moduleList[formKey] = module;\r }.bind(this));\r \r var moduleNodes = this.form._getModuleNodes(this.node);\r moduleNodes.each(function(node){\r if (node.get(\"MWFtype\")!==\"form\"){\r var _self = this;\r var json = this.form._getDomjson(node);\r var module = this.form._loadModule(json, node, function(){\r this.widget = _self;\r this.parentpageIdList = _self.getParentpageIdList();\r });\r this.form.modules.push(module);\r widgetModules[ json.orgiginalId || json.id ] = module;\r }\r }.bind(this));\r //}.bind(this));\r }else{\r this.form.notice(MWF.xApplication.process.Xform.LP.widgetNestedError, \"error\");\r }\r }\r if( this.form.widgetLoadedCount ){\r this.form.widgetLoadedCount++;\r }else{\r this.form.widgetLoadedCount = 1\r }\r this.form.checkSubformLoaded();\r },\r getWidget: function(callback){\r var method = (this.form.options.mode !== \"Mobile\" &amp;&amp; !layout.mobile) ? \"getWidgetByName\" : \"getWidgetByNameMobile\";\r if (this.json.widgetType===\"script\"){\r if (this.json.widgetScript &amp;&amp; this.json.widgetScript.code){\r var formNome = this.form.Macro.exec(this.json.widgetScript.code, this);\r if (formNome){\r var app = this.form.businessData.pageInfor.portal;\r o2.Actions.get(\"x_portal_assemble_surface\")[method](formNome, app, function(json){\r this.getWidgetData(json.data);\r if (callback) callback();\r }.bind(this));\r }else{\r if (callback) callback();\r }\r }\r }else{\r if (this.json.widgetSelected &amp;&amp; this.json.widgetSelected!==\"none\"){\r \r var widgetData = (this.form.app.relatedFormMap) ? this.form.app.relatedFormMap[this.json.widgetSelected] : null;\r if (widgetData){\r this.getWidgetData({\"data\": widgetData.data});\r if (callback) callback();\r \r }else{\r var app = this.form.businessData.pageInfor.portal;\r o2.Actions.get(\"x_portal_assemble_surface\")[method](this.json.widgetSelected, app, function(json){\r this.getWidgetData(json.data);\r if (callback) callback();\r }.bind(this));\r }\r }else{\r if (callback) callback();\r }\r }\r },\r getWidgetData: function(data){\r var widgetDataStr = null;\r //if (this.form.options.mode !== \"Mobile\" &amp;&amp; !layout.mobile){\r // widgetDataStr = data.data;\r //}else{\r // widgetDataStr = data.mobileData;\r //}\r widgetDataStr = data.data;\r this.widgetData = null;\r if (widgetDataStr){\r this.widgetData = JSON.decode(MWF.decodeJsonString(widgetDataStr));\r this.widgetData.updateTime = data.updateTime;\r }\r },\r /**\r * @summary 获取设计部件时设置的参数\r * @return 设置的参数\r * @example\r * var param = this.form.get(\"fieldId\").getPageParamenters()\r */\r getPageParamenters : function(){\r var params = null;\r if( this.json.parameterType === \"map\" ){\r params = this.json.parametersMapList;\r }else if( this.json.parameterType === \"script\" ){\r var code = (this.json.parametersScript) ? this.json.parametersScript.code : \"\";\r if (code){\r params = this.form.Macro.exec(code, this);\r }\r }\r return params;\r }\r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_cms_Xform_Author.js.html":{"url":"x_component_cms_Xform_Author.js.html","title":"x_component_cms_Xform/Author.js","kind":"source","body":" O2OA WebAPI: x_component_cms_Xform/Author.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_cms_Xform/Author.js MWF.xDesktop.requireApp(\"cms.Xform\", \"Org\", null, false);\r /** @class Author 作者组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.Org\r * @o2category FormComponents\r * @o2range {CMS}\r * @hideconstructor\r */\r MWF.xApplication.cms.Xform.Author = MWF.CMSAuthor = new Class({\r \tExtends: MWF.CMSOrg,\r \ticonStyle: \"authorIcon\"\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_cms_Xform_Comment.js.html":{"url":"x_component_cms_Xform_Comment.js.html","title":"x_component_cms_Xform/Comment.js","kind":"source","body":" O2OA WebAPI: x_component_cms_Xform/Comment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_cms_Xform/Comment.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.xDesktop.requireApp(\"cms.Xform\", \"widget.Comment\", null, false);\r /** @class Comment 评论组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var datagrid = this.form.get(\"name\"); //获取组件\r * //方法2\r * var datagrid = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {CMS}\r * @hideconstructor\r */\r MWF.xApplication.cms.Xform.Comment = MWF.CMSComment = new Class(\r /** @lends MWF.xApplication.process.Xform.Comment# */\r {\r \tExtends: MWF.APP$Module,\r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r this.node.setStyle(\"-webkit-user-select\", \"text\");\r \r debugger;\r \r var config = {};\r if(this.json.editorProperties){\r config = Object.clone(this.json.editorProperties);\r }\r if (this.json.config){\r if (this.json.config.code){\r var obj = this.form.Macro.exec(this.json.config.code, this);\r Object.each(obj, function(v, k){\r config[k] = v;\r });\r }\r }\r \r /**\r * @summary 评论组件使用this.comment实现功能\r * @member {MWF.xApplication.cms.Xform.widget.Comment}\r * @example\r * //可以在脚本中获取该组件\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * var items = field.comment.editor; //获取评论的编辑器对象\r */\r this.comment = new MWF.xApplication.cms.Xform.widget.Comment( this.form.app, this.node, {\r \"documentId\" : this.form.businessData.document.id,\r \"countPerPage\" : this.json.countPerPage || 10,\r \"isAllowModified\" : this.json.isAllowModified,\r \"isAllowPublish\" : this.json.isAllowPublish,\r \"isAdmin\" : this.form.app.isAdmin,\r \"editorProperties\" : config\r });\r this.comment.load();\r \t}\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_cms_Xform_Form.js.html":{"url":"x_component_cms_Xform_Form.js.html","title":"x_component_cms_Xform/Form.js","kind":"source","body":" O2OA WebAPI: x_component_cms_Xform/Form.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_cms_Xform/Form.js MWF.xApplication.cms = MWF.xApplication.cms || {};\r MWF.xApplication.cms.Xform = MWF.xApplication.cms.Xform || {};\r \r MWF.require(\"MWF.widget.Common\", null, false);\r // MWF.require(\"MWF.xAction.org.express.RestActions\", null, false);\r MWF.xDesktop.requireApp(\"Selector\", \"package\", null, false);\r MWF.xDesktop.requireApp(\"process.Xform\", \"Form\", null, false);\r MWF.require(\"MWF.widget.O2Identity\", null, false);\r \r MWF.xDesktop.requireApp(\"cms.Xform\", \"Package\", null, false);\r \r /** @class CMSForm 内容管理表单。\r * @o2category FormComponents\r * @o2range {CMS}\r * @alias CMSForm\r * @example\r * //可以在脚本中获取表单\r * //方法1：\r * var form = this.form.getApp().appForm; //获取表单\r * //方法2\r * var form = this.target; //在表单本身的事件脚本中获取\r * @hideconstructor\r */\r MWF.xApplication.cms.Xform.Form = MWF.CMSForm = new Class(\r /** @lends CMSForm# */\r {\r Implements: [Options, Events],\r Extends: MWF.APPForm,\r options: {\r \"style\": \"default\",\r \"readonly\": false,\r \"cssPath\": \"\",\r \"autoSave\": false,\r \"saveOnClose\": false,\r \"showAttachment\": true,\r \"moduleEvents\": [\r /**\r * 表单加载前触发。表单html已经就位。\r * @event CMSForm#queryLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"queryLoad\",\r /**\r * 表单加载前触发。数据(businessData)已经就绪。\r * @event CMSForm#beforeLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeLoad\",\r /**\r * 表单的所有组件加载前触发，此时表单的样式和js head已经加载。\r * @event CMSForm#beforeModulesLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeModulesLoad\",\r /**\r * 表单加载后触发。\r * @event CMSForm#postLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"postLoad\",\r /**\r * 表单的所有组件加载后触发。\r * @event CMSForm#afterModulesLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterModulesLoad\",\r /**\r * 表单加载后触发。\r * @event CMSForm#afterLoad\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterLoad\",\r /**\r * 保存前触发。\r * @event CMSForm#beforeSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeSave\",\r /**\r * 数据已经整理完成，但还未保存到后台时触发。this.event指向整理完成的数据\r * @event CMSForm#afterSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"postSave\",\r /**\r * 数据保存到后台后触发。\r * @event CMSForm#afterSave\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterSave\",\r /**\r * 关闭前触发。\r * @event CMSForm#beforeClose\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeClose\",\r /**\r * 发布前触发。\r * @event CMSForm#beforePublish\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforePublish\",\r /**\r * 数据已经整理完成，但还未调用服务发布触发。this.event指向整理完成的数据\r * @event CMSForm#postPublish\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"postPublish\",\r /**\r * 执行后台服务发布后触发。\r * @event CMSForm#afterPublish\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterPublish\",\r /**\r * 删除前触发。\r * @event CMSForm#beforeDelete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"beforeDelete\",\r /**\r * 删除后触发。\r * @event CMSForm#afterDelete\r * @see {@link https://www.yuque.com/o2oa/ixsnyt/hm5uft#i0zTS|组件事件说明}\r */\r \"afterDelete\",\r \"resize\"\r ]\r },\r /**\r * @summary 获取表单的所有数据.\r * @method getData\r * @memberof CMSForm\r * @example\r * var data = this.form.getApp().appForm.getData();\r * @return {Object}\r */\r initialize: function (node, data, options) {\r this.setOptions(options);\r \r /**\r * @summary 表单容器\r * @see https://mootools.net/core/docs/1.6.0/Element/Element\r * @member {Element}\r * @example\r * //可以在脚本中获取表单容器\r * var formContainer = this.form.getApp().appForm.container;\r */\r this.container = $(node);\r this.container.setStyle(\"-webkit-user-select\", \"text\");\r this.data = data;\r \r /**\r * @summary 表单的配置信息，比如表单名称等等.\r * @member {Object}\r * @example\r * //可以在脚本中获取表单配置信息\r * var json = this.form.getApp().appForm.json; //表单配置信息\r * var name = json.name; //表单名称\r */\r this.json = data.json;\r this.html = data.html;\r \r this.path = \"../x_component_cms_Xform/$Form/\";\r this.cssPath = this.options.cssPath || \"../x_component_cms_Xform/$Form/\" + this.options.style + \"/css.wcss\";\r this._loadCss();\r \r /**\r * @summary 表单中的所有组件数组.\r * @member {Array}\r * @example\r * //下面的样例对表单组件进行循环，并且判断是输入类型的组件\r * var modules = this.form.getApp().appForm.modules; //获取所有表单组件\r * for( var i=0; i&lt;modules.length; i++ ){ //循环处理组件\r * //获取组件的类型\r var moduleName = module.json.moduleName;\r if( !moduleName ){\r moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r }\r if( [\"calendar\",\"combox\",\"number\",\"textfield\"].contains( moduleName )){ //输入类型框\r //do something\r }\r * }\r */\r this.modules = [];\r \r /**\r * 该对象的key是组件标识，value是组件对象，可以使用该对象根据组件标识获取组件。&lt;br/>\r * 需要注意的是，在子表单中嵌入不绑定数据的组件（比如div,common,button等等），系统允许重名。&lt;br/>\r * 在打开表单的时候，系统会根据重名情况，自动在组件的标识后跟上 \"_1\", \"_2\"。\r * @summary 表单中的所有组件对象.\r * @member {Object}\r * @example\r * var moduleAll = this.form.getApp().appForm.all; //获取组件对象\r * var subjectField = moduleAll[\"subject\"] //获取名称为subject的组件\r */\r this.all = {};\r this.forms = {};\r \r //if (!this.personActions) this.personActions = new MWF.xAction.org.express.RestActions();\r },\r load: function (callback) {\r if (this.app) {\r if (this.app.formNode) this.app.formNode.setStyles(this.json.styles);\r if (this.app.addEvent) this.app.addEvent(\"resize\", function () {\r this.fireEvent(\"resize\");\r }.bind(this))\r }\r //if (!this.businessData.control.allowSave) this.setOptions({\"readonly\": true});\r \r this.Macro = new MWF.CMSMacro.CMSFormContext(this);\r \r this.container.set(\"html\", this.html);\r this.node = this.container.getFirst();\r \r this._loadEvents();\r this.loadRelatedScript();\r \r if (this.fireEvent(\"queryLoad\")) {\r \r MWF.xDesktop.requireApp(\"cms.Xform\", \"lp.\" + MWF.language, null, false);\r //\t\tthis.container.setStyles(this.css.container);\r this._loadBusinessData();\r this.fireEvent(\"beforeLoad\");\r if (this.app) if (this.app.fireEvent) this.app.fireEvent(\"beforeLoad\");\r \r this.loadContent(callback)\r }\r },\r loadRelatedScript: function () {\r if (this.json.includeScripts &amp;&amp; this.json.includeScripts.length) {\r var includeScriptText = \"\";\r var includedIds = [];\r this.json.includeScripts.each(function (s) {\r if (this.app.relatedScriptMap &amp;&amp; this.app.relatedScriptMap[s.id]) {\r includeScriptText += \"\\n\" + this.app.relatedScriptMap[s.id].text;\r includedIds.push(s.id);\r }\r }.bind(this));\r \r if (includeScriptText) this.Macro.exec(includeScriptText, this);\r }\r },\r loadContent: function (callback) {\r this.subformCount = 0;\r this.subformLoadedCount = 0;\r this.subformLoaded = [this.json.id];\r \r this._loadHtml();\r this._loadForm();\r this.fireEvent(\"beforeModulesLoad\");\r this._loadModules(this.node);\r \r if (!this.options.readonly) {\r if (this.options.autoSave) this.autoSave();\r this.app.addEvent(\"queryClose\", function () {\r if (this.options.saveOnClose &amp;&amp; this.businessData.document.docStatus == \"draft\") this.saveDocument(null, true);\r //if (this.autoSaveTimerID) window.clearInterval(this.autoSaveTimerID);\r Object.each(this.forms, function (module, id) {\r if (module.json.type == \"Htmleditor\" &amp;&amp; module.editor) {\r //if(CKEDITOR.currentImageDialog)CKEDITOR.currentImageDialog.destroy();\r //CKEDITOR.currentImageDialog = null;\r CKEDITOR.remove(module.editor);\r delete module.editor\r }\r });\r }.bind(this));\r }\r this.fireEvent(\"afterModulesLoad\");\r this.fireEvent(\"postLoad\");\r this.fireEvent(\"afterLoad\");\r if (this.app &amp;&amp; this.app.fireEvent) {\r this.app.fireEvent(\"afterModulesLoad\");\r this.app.fireEvent(\"postLoad\");\r this.app.fireEvent(\"afterLoad\");\r }\r // 告诉移动端表单加载完成\r if (this.app &amp;&amp; this.app.mobile) {\r if (callback) callback();\r }\r },\r autoSave: function () {\r //this.autoSaveTimerID = window.setInterval(function(){\r // this.saveDocument();\r //}.bind(this), 300000);\r },\r _loadBusinessData: function () {\r if (!this.businessData) {\r this.businessData = {\r \"data\": {}\r };\r }\r },\r \r _loadEvents: function () {\r Object.each(this.json.events, function (e, key) {\r if (e.code) {\r if (this.options.moduleEvents.indexOf(key) != -1) {\r this.addEvent(key, function (event) {\r return this.Macro.fire(e.code, this, event);\r }.bind(this));\r } else {\r if (key == \"load\") {\r this.addEvent(\"postLoad\", function () {\r return this.Macro.fire(e.code, this);\r }.bind(this));\r } else if (key == \"submit\") {\r this.addEvent(\"beforePublish\", function () {\r return this.Macro.fire(e.code, this);\r }.bind(this));\r } else {\r this.node.addEvent(key, function (event) {\r return this.Macro.fire(e.code, this, event);\r }.bind(this));\r }\r }\r }\r }.bind(this));\r },\r \r \r \r _loadModules: function (dom) {\r //var subDom = this.node.getFirst();\r //while (subDom){\r // if (subDom.get(\"MWFtype\")){\r // var json = this._getDomjson(subDom);\r // var module = this._loadModule(json, subDom);\r // this.modules.push(module);\r // }\r // subDom = subDom.getNext();\r //}\r \r var moduleNodes = this._getModuleNodes(dom);\r \r moduleNodes.each(function (node) {\r var json = this._getDomjson(node);\r if (!this.options.showAttachment &amp;&amp; json.type == \"Attachment\") {\r return;\r }\r //移动端去掉操作栏\r if (this.app.mobile &amp;&amp; json.type === \"Actionbar\") {\r return;\r }\r var module = this._loadModule(json, node);\r this.modules.push(module);\r }.bind(this));\r },\r _loadModule: function (json, node, beforeLoad) {\r if (!json) return;\r if (!MWF[\"CMS\" + json.type]) {\r MWF.xDesktop.requireApp(\"cms.Xform\", json.type, null, false);\r }\r var module = new MWF[\"CMS\" + json.type](node, json, this);\r if (beforeLoad) beforeLoad.apply(module);\r if (!this.all[json.id]) this.all[json.id] = module;\r if (module.field) {\r if (!this.forms[json.id]) this.forms[json.id] = module;\r }\r module.readonly = this.options.readonly;\r module.load();\r return module;\r },\r //getData: function(){\r // var data= Object.clone(this.businessData.data);\r // Object.each(this.forms, function(module, id){\r // debugger;\r // if (module.json.section==\"yes\"){\r // data[id] = this.getSectionData(module, data[id]);\r // }else{\r // data[id] = module.getData();\r // }\r // }.bind(this));\r //\r // this.businessData.data = data;\r // this.Macro.environment.setData(this.businessData.data);\r // return data;\r //},\r trim: function (array) {\r var arr = [];\r array.each(function (v) {\r if (v) arr.push(v);\r });\r return arr;\r },\r transportPermissionData: function (array, t) {\r var result = [];\r array.each(function (data) {\r var dn = typeOf(data) === \"string\" ? data : data.distinguishedName;\r if (dn) {\r var flag = dn.substr(dn.length - 1, 1);\r var type;\r switch (flag.toLowerCase()) {\r case \"i\":\r type = \"人员\"; //\"身份\";\r break;\r case \"p\":\r type = \"人员\";\r break;\r case \"u\":\r type = \"组织\";\r break;\r case \"g\":\r type = \"群组\";\r break;\r case \"r\":\r type = \"角色\";\r break;\r default:\r type = \"\";\r //result.push( data );\r }\r if (type) {\r var name;\r if( typeOf(data) === \"object\" &amp;&amp; data.name ){\r name = data.name;\r }else if( MWF.name &amp;&amp; MWF.name.cn ){\r name = MWF.name.cn( dn );\r }else{\r name = dn.split(\"@\")[0];\r }\r result.push({\r permission: t == \"author\" ? \"作者\" : \"阅读\",\r permissionObjectType: type,\r permissionObjectName: name,\r permissionObjectCode: dn\r })\r }\r }\r });\r return result.length > 0 ? result : null;\r },\r getSpecialData: function () {\r var data = this.businessData.data;\r var readers = [];\r var authors = [];\r var pictures = [];\r var cloudPictures = [];\r var summary = \"\";\r Object.each(this.forms, function (module, id) {\r if (module.json.type == \"Readerfield\" || module.json.type == \"Reader\") {\r if (module.json.section == \"yes\") {\r readers = readers.concat(this.getSectionData(module, data[id]));\r } else {\r readers = readers.concat(module.getData());\r }\r }\r if (module.json.type == \"Authorfield\" || module.json.type == \"Author\") {\r if (module.json.section == \"yes\") {\r authors = authors.concat(this.getSectionData(module, data[id]));\r } else {\r authors = authors.concat(module.getData());\r }\r }\r if (module.json.type == \"ImageClipper\") {\r var d = module.getData();\r if (d) pictures.push(d);\r }\r if (module.json.type == \"Htmleditor\") {\r var text = module.getText();\r summary = text.substr(0, 80);\r \r cloudPictures = cloudPictures.concat(module.getImageIds());\r }\r });\r if (data.processOwnerList &amp;&amp; typeOf(data.processOwnerList) == \"array\") { //如果是流程中发布的\r var owner = { personValue: [] };\r data.processOwnerList.each(function (p) {\r owner.personValue.push({\r name: p,\r type: \"person\"\r });\r });\r readers = readers.concat(owner);\r }\r return {\r readers: this.transportPermissionData(readers, \"reader\"),\r authors: this.transportPermissionData(authors, \"author\"),\r pictures: pictures,\r summary: summary,\r cloudPictures: cloudPictures\r };\r },\r getDocumentData: function (formData) {\r var data = Object.clone(this.businessData.document);\r if (formData.subject) {\r data.title = formData.subject;\r data.subject = formData.subject;\r this.businessData.document.title = formData.subject;\r this.businessData.document.subject = formData.subject;\r }\r data.isNewDocument = false;\r return data;\r },\r saveDocument: function (callback, sync) {\r this.fireEvent(\"beforeSave\");\r if (this.businessData.document.docStatus == \"published\") {\r if (!this.formValidation(\"publish\")) {\r this.app.content.unmask();\r //if (callback) callback();\r return false;\r }\r }\r if (!this.formSaveValidation()) {\r this.app.content.unmask();\r if (callback) callback();\r return false;\r }\r var data = this.getData();\r var specialData = this.getSpecialData();\r var documentData = this.getDocumentData(data);\r documentData.readerList = specialData.readers;\r documentData.authorList = specialData.authors;\r documentData.pictureList = specialData.pictures;\r documentData.summary = specialData.summary;\r documentData.cloudPictures = specialData.cloudPictures;\r documentData.docData = data;\r delete documentData.attachmentList;\r this.fireEvent(\"postSave\", [documentData]);\r if (this.officeList) {\r this.officeList.each(function (module) {\r module.save();\r });\r }\r this.documentAction.saveDocument(documentData, function () {\r //this.documentAction.saveData(function(json){\r this.app.notice(MWF.xApplication.cms.Xform.LP.dataSaved, \"success\");\r this.businessData.data.isNew = false;\r this.fireEvent(\"afterSave\");\r if (callback) callback();\r //}.bind(this), null, this.businessData.document.id, data, !sync );\r }.bind(this), null, !sync);\r },\r closeDocument: function () {\r this.fireEvent(\"beforeClose\");\r if (this.app) {\r this.app.close();\r }\r },\r printDocument: function (form) {\r var form = form;\r if (!form) {\r form = this.json.id;\r if (this.json.printForm &amp;&amp; this.json.printForm !== \"none\") form = this.json.printForm;\r }\r window.open(o2.filterUrl(\"../x_desktop/printcmsdoc.html?documentid=\" + this.businessData.document.id + \"&amp;form=\" + form));\r },\r \r formValidation: function (status) {\r if (this.options.readonly) return true;\r var flag = true;\r //flag = this.validation();\r Object.each(this.forms, function (field, key) {\r field.validationMode();\r if (!field.validation(status)) {\r flag = false;\r }\r }.bind(this));\r return flag;\r },\r formSaveValidation: function () {\r if (!this.json.validationSave) return true;\r if (!this.json.validationSave.code) return true;\r var flag = this.Macro.exec(this.json.validationSave.code, this);\r if (!flag) flag = MWF.xApplication.cms.Xform.LP.notValidation;\r if (typeOf(flag) === \"string\") {\r if (flag !== \"true\") {\r this.app.notice(flag, \"error\");\r return false;\r }\r } else if (flag.toString() != \"true\") {\r return false;\r }\r return true;\r },\r formPublishValidation: function () {\r if (!this.json.validationPublish) return true;\r if (!this.json.validationPublish.code) return true;\r var flag = this.Macro.exec(this.json.validationPublish.code, this);\r if (!flag) flag = MWF.xApplication.cms.Xform.LP.notValidation;\r if (typeOf(flag) === \"string\") {\r if (flag !== \"true\") {\r this.app.notice(flag, \"error\");\r return false;\r }\r } else if (flag.toString() != \"true\") {\r return false;\r }\r return true;\r },\r publishDocument: function (callback) {\r this.fireEvent(\"beforePublish\");\r this.app.content.mask({\r \"destroyOnHide\": true,\r \"style\": this.app.css.maskNode\r });\r if (!this.formValidation(\"publish\")) {\r this.app.content.unmask();\r //if (callback) callback();\r return false;\r }\r if (!this.formPublishValidation()) {\r this.app.content.unmask();\r if (callback) callback();\r return false;\r }\r \r var data = this.getData();\r var specialData = this.getSpecialData();\r //this.documentAction.saveData(function(json){\r var documentData = this.getDocumentData(data);\r documentData.readerList = specialData.readers;\r documentData.authorList = specialData.authors;\r documentData.pictureList = specialData.pictures;\r documentData.summary = specialData.summary;\r documentData.cloudPictures = specialData.cloudPictures;\r documentData.docData = data;\r delete documentData.attachmentList;\r //this.documentAction.saveDocument(documentData, function(){\r this.fireEvent(\"postPublish\", [documentData]);\r if (this.app) if (this.app.fireEvent) this.app.fireEvent(\"postPublish\",[documentData]);\r if (this.officeList) {\r this.officeList.each(function (module) {\r module.save();\r });\r }\r this.documentAction.publishDocumentComplex(documentData, function (json) {\r this.businessData.data.isNew = false;\r this.fireEvent(\"afterPublish\", [this, json.data]);\r if (this.app) if (this.app.fireEvent) this.app.fireEvent(\"afterPublish\",[this, json.data]);\r if (callback) callback();\r if (this.app.mobile) {\r this.app.content.unmask();\r console.log('这里是移动端');\r } else {\r if (this.businessData.document.title) {\r this.app.notice(MWF.xApplication.cms.Xform.LP.documentPublished + \": “\" + this.businessData.document.title + \"”\", \"success\");\r } else {\r this.app.notice(MWF.xApplication.cms.Xform.LP.documentPublished, \"success\");\r }\r this.options.saveOnClose = false;\r }\r debugger;\r if( layout.inBrowser ){\r try{\r if( window.opener &amp;&amp; window.opener.o2RefreshCMSView ){\r window.opener.o2RefreshCMSView();\r }\r }catch (e) {}\r window.setTimeout(function () {\r this.app.close();\r }.bind(this), 1500)\r }else{\r this.app.close();\r }\r }.bind(this));\r \r //}.bind(this))\r //}.bind(this), null, this.businessData.document.id, data);\r },\r //publishDocument_bak: function(callback){\r // this.fireEvent(\"beforePublish\");\r // this.app.content.mask({\r // \"destroyOnHide\": true,\r // \"style\": this.app.css.maskNode\r // });\r // if (!this.formValidation(\"publish\")){\r // this.app.content.unmask();\r // if (callback) callback();\r // return false;\r // }\r //\r // var data = this.getData();\r // var specialData = this.getSpecialData();\r // this.documentAction.saveData(function(json){\r // this.businessData.data.isNew = false;\r // var documentData = this.getDocumentData(data);\r // documentData.permissionList = specialData.readers;\r // documentData.pictureList = specialData.pictures;\r // documentData.summary = specialData.summary;\r // delete documentData.attachmentList;\r // this.documentAction.saveDocument(documentData, function(){\r // this.documentAction.publishDocument(documentData, function(json){\r // this.fireEvent(\"afterPublish\");\r // this.fireEvent(\"postPublish\");\r // if (callback) callback();\r // this.app.notice(MWF.xApplication.cms.Xform.LP.documentPublished+\": “\"+this.businessData.document.title+\"”\", \"success\");\r // this.options.saveOnClose = false;\r // this.app.close();\r // //this.close();\r // }.bind(this) );\r // }.bind(this))\r // }.bind(this), null, this.businessData.document.id, data);\r //},\r \r deleteDocumentForMobile: function () {\r if (this.app.mobile) {\r this.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r \r this.fireEvent(\"beforeDelete\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"beforeDelete\");\r \r this.documentAction.removeDocument(this.businessData.document.id, function (json) {\r this.fireEvent(\"afterDelete\");\r if (this.app &amp;&amp; this.app.fireEvent) this.app.fireEvent(\"afterDelete\");\r this.app.notice(MWF.xApplication.cms.Xform.LP.documentDelete + \": “\" + this.businessData.document.title + \"”\", \"success\");\r this.options.autoSave = false;\r this.options.saveOnClose = false;\r this.fireEvent(\"postDelete\");\r this.app.close();\r }.bind(this));\r }\r },\r \r /**\r * @summary 弹出删除文档确认框.\r * @method deleteDocument\r * @memberof CMSForm\r * @example\r * this.form.getApp().appForm.deleteDocument();\r */\r deleteDocument: function () {\r var _self = this;\r var p = MWF.getCenterPosition(this.app.content, 380, 150);\r var event = {\r \"event\": {\r \"x\": p.x,\r \"y\": p.y - 200,\r \"clientX\": p.x,\r \"clientY\": p.y - 200\r }\r };\r this.app.confirm(\"infor\", event, MWF.xApplication.cms.Xform.LP.deleteDocumentTitle, MWF.xApplication.cms.Xform.LP.deleteDocumentText, 380, 120, function () {\r _self.app.content.mask({\r \"style\": {\r \"background-color\": \"#999\",\r \"opacity\": 0.6\r }\r });\r \r _self.fireEvent(\"beforeDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"beforeDelete\");\r \r _self.documentAction.removeDocument(_self.businessData.document.id, function (json) {\r _self.fireEvent(\"afterDelete\");\r if (_self.app &amp;&amp; _self.app.fireEvent) _self.app.fireEvent(\"afterDelete\");\r _self.app.notice(MWF.xApplication.cms.Xform.LP.documentDelete + \": “\" + _self.businessData.document.title + \"”\", \"success\");\r _self.options.autoSave = false;\r _self.options.saveOnClose = false;\r _self.fireEvent(\"postDelete\");\r _self.app.close();\r this.close();\r }.bind(this));\r //this.close();\r }, function () {\r this.close();\r });\r },\r \r /**\r * @summary 编辑文档.\r * @method editDocument\r * @memberof CMSForm\r * @example\r * this.form.getApp().appForm.editDocument();\r */\r editDocument: function () {\r if (this.app.inBrowser) {\r this.modules.each(function (module) {\r MWF.release(module);\r });\r //MWF.release(this);\r this.app.node.destroy();\r \r this.app.options.readonly = false;\r \r this.app.loadApplication();\r } else {\r var options = { \"documentId\": this.businessData.document.id, \"readonly\": false }; //this.explorer.app.options.application.allowControl};\r if (this.app.options.formEditId) options.formEditId = this.app.options.formEditId;\r this.app.desktop.openApplication(null, \"cms.Document\", options);\r this.app.close();\r }\r },\r \r //2019-11-29 移动端 开启编辑模式\r /**\r * @summary 移动端开启编辑模式.\r * @method editDocumentForMobile\r * @memberof CMSForm\r * @example\r * this.form.getApp().appForm.editDocumentForMobile();\r */\r editDocumentForMobile: function () {\r if (this.app.mobile) {\r this.app.options.readonly = false;\r this.app.loadDocument(this.app.options);\r }\r },\r \r /**\r * @summary 弹出设置热点的界面.\r * @method setPopularDocument\r * @memberof CMSForm\r * @example\r * this.form.getApp().appForm.setPopularDocument();\r */\r setPopularDocument: function () {\r this.app.setPopularDocument();\r },\r \r printWork: function (app, form) {\r var application = app || this.businessData.work.application;\r var form = form;\r if (!form) {\r form = this.json.id;\r if (this.json.printForm) form = this.json.printForm;\r }\r window.open(o2.filterUrl(\"../x_desktop/printWork.html?workid=\" + this.businessData.work.id + \"&amp;app=\" + this.businessData.work.application + \"&amp;form=\" + form));\r },\r openWindow: function (form, app) {\r var form = form;\r if (!form) {\r form = this.json.id;\r }\r if (this.businessData.document) {\r //var application = app;\r //window.open(\"../x_desktop/printWork.html?workCompletedId=\"+this.businessData.workCompleted.id+\"&amp;app=\"+application+\"&amp;form=\"+form);\r }\r },\r \r /**\r * @summary 将新上传的附件在指定的附件组件中展现.\r * @method uploadedAttachment\r * @memberof CMSForm\r * @param {String} site - 附件组件的标识\r * @param {String} id - 新上传的附件id\r * @example\r * this.form.getApp().appForm.uploadedAttachment(site, id);\r */\r uploadedAttachment: function (site, id) {\r this.documentAction.getAttachment(id, this.businessData.document.id, function (json) {\r var att = this.all[site];\r if (att) {\r if (json.data) att.attachmentController.addAttachment(json.data);\r att.attachmentController.checkActions();\r att.fireEvent(\"upload\", [json.data]);\r }\r }.bind(this));\r },\r replacedAttachment: function (site, id) {\r this.documentAction.getAttachment(id, this.businessData.document.id, function (json) {\r \r var att = this.all[site];\r if (att) {\r var attachmentController = att.attachmentController;\r var attachment = null;\r for (var i = 0; i &lt; attachmentController.attachments.length; i++) {\r if (attachmentController.attachments[i].data.id === id) {\r attachment = attachmentController.attachments[i];\r break;\r }\r }\r attachment.data = json.data;\r attachment.reload();\r attachmentController.checkActions();\r }\r }.bind(this))\r }\r \r \r \r });\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_cms_Xform_Log.js.html":{"url":"x_component_cms_Xform_Log.js.html","title":"x_component_cms_Xform/Log.js","kind":"source","body":" O2OA WebAPI: x_component_cms_Xform/Log.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_cms_Xform/Log.js MWF.xDesktop.requireApp(\"process.Xform\", \"$Module\", null, false);\r MWF.xDesktop.requireApp(\"cms.Xform\", \"widget.Log\", null, false);\r /** @class CMSLog 文档查看日志组件。\r * @alias CMSLog\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var datagrid = this.form.get(\"name\"); //获取组件\r * //方法2\r * var datagrid = this.target; //在组件事件脚本中获取\r * @extends MWF.xApplication.process.Xform.$Module\r * @o2category FormComponents\r * @o2range {CMS}\r * @hideconstructor\r */\r MWF.xApplication.cms.Xform.Log = MWF.CMSLog = new Class(\r /** @lends CMSLog# */\r {\r \tExtends: MWF.APP$Module,\r \t_loadUserInterface: function(){\r \t\tthis.node.empty();\r this.node.setStyle(\"-webkit-user-select\", \"text\");\r /**\r * @summary log组件使用this.log实现功能\r * @member {MWF.xApplication.cms.Xform.widget.Log}\r * @example\r * //可以在脚本中获取该组件\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * var items = field.log.items; //获取日志的行对象\r */\r this.log = new MWF.xApplication.cms.Xform.widget.Log( this.form.app, this.node, {\r \"documentId\" : this.form.businessData.document.id,\r \"mode\" : this.json.mode,\r \"textStyle\" : this.json.textStyle\r });\r this.log.load();\r \t}\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_component_cms_Xform_Reader.js.html":{"url":"x_component_cms_Xform_Reader.js.html","title":"x_component_cms_Xform/Reader.js","kind":"source","body":" O2OA WebAPI: x_component_cms_Xform/Reader.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_component_cms_Xform/Reader.js MWF.xDesktop.requireApp(\"cms.Xform\", \"Org\", null, false);\r /** @class Reader 读者组件。\r * @example\r * //可以在脚本中获取该组件\r * //方法1：\r * var field = this.form.get(\"fieldId\"); //获取组件对象\r * //方法2\r * var field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r *\r * var data = field.getData(); //获取值\r * field.setData(\"字符串值\"); //设置值\r * field.hide(); //隐藏字段\r * var id = field.json.id; //获取字段标识\r * var flag = field.isEmpty(); //字段是否为空\r * field.resetData(); //重置字段的值为默认值或置空\r * @extends MWF.xApplication.process.Xform.Org\r * @o2category FormComponents\r * @o2range {CMS}\r * @hideconstructor\r */\r MWF.xApplication.cms.Xform.Reader = MWF.CMSReader = new Class({\r \tExtends: MWF.CMSOrg,\r \ticonStyle: \"readerIcon\"\r }); Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"o2_core_o2_xScript_CMSEnvironment.js.html":{"url":"o2_core_o2_xScript_CMSEnvironment.js.html","title":"o2_core/o2/xScript/CMSEnvironment.js","kind":"source","body":" O2OA WebAPI: o2_core/o2/xScript/CMSEnvironment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source o2_core/o2/xScript/CMSEnvironment.js MWF.xScript = MWF.xScript || {};\r MWF.xScript.CMSEnvironment = function(ev){\r \r var _data = ev.data;\r var _form = ev.form;\r var _forms = ev.forms;\r \r this.library = COMMON;\r //this.library.version = \"4.0\";\r \r //data\r var getJSONData = function(jData){\r return new MWF.xScript.CMSJSONData(jData, function(data, key, _self){\r var p = {\"getKey\": function(){return key;}, \"getParent\": function(){return _self;}};\r while (p &amp;&amp; !_forms[p.getKey()]) p = p.getParent();\r if (p) if (p.getKey()) if (_forms[p.getKey()]) _forms[p.getKey()].resetData();\r });\r };\r this.setData = function(data){\r this.data = getJSONData(data);\r this.data.save = function(callback){\r _form.documentAction.saveData(function(json){if (callback) callback();}.bind(this), null, ev.document.id, data);\r }\r };\r this.setData(_data);\r //task\r //this.task = ev.task;\r //this.task.process = function(routeName, opinion, callback){\r // _form.submitWork(routeName, opinion, callback);\r //};\r //inquiredRouteList\r //this.inquiredRouteList = null;\r \r //workContext\r /**\r * 您可以通过documentContext获取内容管理实例相关的对象数据。\r * @module documentContext\r * @o2range {CMS}\r * @o2ordernumber 30\r * @example\r * //您可以在内容管理表单中，通过this来获取当前实例的documentContext对象，如下：\r * var context = this.documentContext;\r */\r this.documentContext = {\r /**\r * 获取当前内容管理实例的文档对象：document对象。\r * @method getDocument\r * @static\r * @return {Document} 文档对象.\r * @o2ActionOut x_cms_assemble_control.WoDocument|ignoreNoDescr=true|example=Document\r * @o2syntax\r * var doc = this.documentContext.getDocument();\r */\r \"getDocument\": function(){return ev.document },\r /**\r * 获取当前人对文档的权限。\r * @method getControl\r * @static\r * @return {DocumentControl} 当前人对文档所拥有的权限.\r * &lt;pre>&lt;code class='language-js'>{\r * \"allowRead\": true, //是否允许阅读文档\r * \"allowPublishDocument\": true, //是否允许发布文档\r * \"allowSave\": true, //是否允许保存文档\r * \"allowPopularDocument\": true, //是否允许设置为热点\r * \"allowEditDocument\": true, //是否允许编辑文档\r * \"allowDeleteDocument\": true //是否允许删除文档\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * var control = this.documentContext.getControl();\r */\r \"getControl\": function(){return ev.control;},\r /**\r * 获取当前文档的附件对象列表。\r * @method getAttachmentList\r * @static\r * @return {DocumentFileInfo[]} 当前文档的附件对象列表.\r * @o2ActionOut x_cms_assemble_control.FileInfoAction.get|example=Attachment\r * @o2syntax\r * var attachmentList = this.documentContext.getAttachmentList();\r */\r \"getAttachmentList\": function(){return ev.attachmentList;}\r //\"setTitle\": function(title){\r // if (!this.workAction){\r // MWF.require(\"MWF.xScript.Actions.WorkActions\", null, false);\r // this.workAction = new MWF.xScript.Actions.WorkActions();\r // }\r // this.workAction.setTitle(ev.work.id, {\"title\": title});\r //}\r };\r \r //dict\r this.Dict = MWF.xScript.createCMSDict(_form.json.application);\r //org\r var orgActions = null;\r var getOrgActions = function(){\r // if (!orgActions){\r // MWF.xDesktop.requireApp(\"Org\", \"Actions.RestActions\", null, false);\r // orgActions = new MWF.xApplication.Org.Actions.RestActions ();\r // }\r if (!orgActions){\r MWF.require(\"MWF.xScript.Actions.UnitActions\", null, false);\r orgActions = new MWF.xScript.Actions.UnitActions();\r }\r };\r var getNameFlag = function(name){\r var t = typeOf(name);\r if (t===\"array\"){\r var v = [];\r name.each(function(id){\r v.push((typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id);\r });\r return v;\r }else{\r return [(t===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name];\r }\r };\r this.org = {\r //群组***************\r //获取群组--返回群组的对象数组\r getGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r \r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listGroup(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级群组--返回群组的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubGroup: function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data;\r // return v;\r // }.ag().catch(function(json){ return json; });\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listSubGroupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listSubGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // var v = null;\r // if (nested){\r // orgActions.listSubGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSubGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //查询上级群组--返回群组的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupGroup:function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r if (nested){\r var promise = orgActions.listSupGroupNested(data, cb, null, !!async);\r }else{\r var promise = orgActions.listSupGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r // var v = null;\r // if (nested){\r // orgActions.listSupGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSupGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //人员所在群组（嵌套）--返回群组的对象数组\r listGroupWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroupWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listGroupWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r //群组是否拥有角色--返回true, false\r groupHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"group\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.groupHasRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.groupHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r \r //角色***************\r //获取角色--返回角色的对象数组\r getRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listRole(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //人员所有角色（嵌套）--返回角色的对象数组\r listRoleWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listRoleWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r \r //人员***************\r //人员是否拥有角色--返回true, false\r personHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"person\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.personHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r //获取人员--返回人员的对象数组\r getPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listPerson(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级人员--返回人员的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询上级人员--返回人员的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //获取群组的所有人员--返回人员的对象数组\r listPersonWithGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取角色的所有人员--返回人员的对象数组\r listPersonWithRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r promise = orgActions.listPersonWithRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组\r listPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组或人员对象\r getPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员的人员--返回人员的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listPersonWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonWithUnitNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonWithUnitDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的对象数组\r //name string 属性名\r //value string 属性值\r listPersonWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的全称数组\r //name string 属性名\r //value string 属性值\r listPersonNameWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data.personList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttributeValue(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //人员属性************\r //添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r },\r //设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.setPersonAttribute(data, cb, null, !!async);\r },\r //获取人员属性值\r getPersonAttribute: function(person, attr, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"name\":attr,\"person\":personFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getPersonAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所有属性的名称\r listPersonAttributeName: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的所有属性\r listPersonAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //身份**********\r //获取身份\r getIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的身份\r listIdentityWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentityWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员身份--返回身份的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listIdentityWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r \r // var cb = function(json){\r // v = json.data;\r // if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r // return v;\r // }.ag().catch(function(json){ return json; });\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var method = (nested) ? \"listIdentityWithUnitNested\" : \"listIdentityWithUnitDirect\";\r var promise = orgActions[method](data, cb, null, !!async);\r promise.name = \"org\";\r \r //\r // if (nested){\r // orgActions.listIdentityWithUnitNested(data, cb, null, !!async);\r // }else{\r // orgActions.listIdentityWithUnitDirect(data, cb, null, !!async);\r // }\r return (!!async) ? promise : v;\r },\r \r //组织**********\r //获取组织\r getUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织的下级--返回组织的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询组织的上级--返回组织的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r //async 布尔 true异步请求\r listSupUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // if (callback){\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }\r // }else{\r // var v = null;\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r // }\r },\r //根据个人身份获取组织\r //flag 数字 表示获取第几层的组织\r // 字符串 表示获取指定类型的组织\r // 空 表示获取直接所在的组织\r getUnitByIdentity: function(name, flag, async){\r getOrgActions();\r var getUnitMethod = \"current\";\r var v;\r if (flag){\r if (typeOf(flag)===\"string\") getUnitMethod = \"type\";\r if (typeOf(flag)===\"number\") getUnitMethod = \"level\";\r }\r \r var cb;\r var promise;\r switch (getUnitMethod){\r case \"current\":\r var data = {\"identityList\":getNameFlag(name)};\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v; return v;\r // }.ag().catch(function(json){ return json; });\r \r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r \r promise = orgActions.listUnitWithIdentity(data, cb, null, !!async);\r break;\r case \"type\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"type\":flag};\r \r cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndType(data, cb, null, !!async);\r break;\r case \"level\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"level\":flag};\r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndLevel(data, cb, null, !!async);\r break;\r }\r return (!!async) ? promise : v;\r },\r //列出身份所在组织的所有上级组织\r listAllSupUnitWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取人员所在的所有组织\r listUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所在组织的所有上级组织\r listAllSupUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织属性，获取所有符合的组织\r listUnitWithAttribute: function(name, attribute, async){\r getOrgActions();\r var data = {\"name\":name,\"attribute\":attribute};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r promise = orgActions.listUnitWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织职务，获取所有符合的组织\r listUnitWithDuty: function(name, id, async){\r getOrgActions();\r var data = {\"name\":name,\"identity\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织职务***********\r //获取指定的组织职务的身份\r getDuty: function(duty, id, async){\r getOrgActions();\r var data = {\"name\":duty,\"unit\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有职务名称\r listDutyNameWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务名称\r listDutyNameWithUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务\r listUnitAllDuty: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出顶层组织\r listTopUnit: function(async){\r var action = MWF.Actions.get(\"x_organization_assemble_control\");\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = action.listTopUnit(cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织属性**************\r //添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r \r // orgActions.appendUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r orgActions.setUnitAttribute(data, cb, null, !!async);\r \r // orgActions.setUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //获取组织属性值\r getUnitAttribute: function(unit, attr, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"name\":attr,\"unit\":unitFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getUnitAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织所有属性的名称\r listUnitAttributeName: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织的所有属性\r listUnitAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r }\r };\r \r this.Action = (function(){\r var actions = [];\r return function(root, json){\r var action = actions[root] || (actions[root] = new MWF.xDesktop.Actions.RestActions(\"\", root, \"\"));\r action.getActions = function(callback){\r if (!this.actions) this.actions = {};\r Object.merge(this.actions, json);\r if (callback) callback();\r };\r this.invoke = function(option){\r action.invoke(option)\r }\r }\r })();\r \r this.service = {\r \"jaxwsClient\": {},\r \"jaxrsClient\":{}\r };\r \r var lookupAction = null;\r var getLookupAction = function(callback){\r if (!lookupAction){\r MWF.require(\"MWF.xDesktop.Actions.RestActions\", function(){\r lookupAction = new MWF.xDesktop.Actions.RestActions(\"\", \"x_cms_assemble_control\", \"\");\r lookupAction.getActions = function(actionCallback){\r this.actions = {\r \"lookup\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\":\"PUT\"},\r \"getView\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\"}\r };\r if (actionCallback) actionCallback();\r }\r if (callback) callback();\r }.bind(this));\r }else{\r if (callback) callback();\r }\r };\r \r this.view = {\r \"lookup\": function(view, callback, async){\r var filterList = {\"filterList\": (view.filter || null)};\r MWF.Actions.get(\"x_query_assemble_surface\").loadView(view.view, view.application, filterList, function(json){\r var data = {\r \"grid\": json.data.grid || json.data.groupGrid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }, null, async);\r },\r \r \"lookupV1\": function(view, callback){\r getLookupAction(function(){\r lookupAction.invoke({\"name\": \"lookup\",\"async\": true, \"parameter\": {\"view\": view.view, \"application\": view.application},\"success\": function(json){\r var data = {\r \"grid\": json.data.grid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }.bind(this)});\r }.bind(this));\r },\r \"select\": function(view, callback, options){\r if (view.view){\r var viewJson = {\r \"application\": view.application || _form.json.application,\r \"viewName\": view.view || \"\",\r \"isTitle\": (view.isTitle===false) ? \"no\" : \"yes\",\r \"select\": (view.isMulti===false) ? \"single\" : \"multi\",\r \"filter\": view.filter\r };\r if (!options) options = {};\r options.width = view.width;\r options.height = view.height;\r options.title = view.caption;\r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile){\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r this.view = new MWF.xApplication.query.Query.Viewer(dlg.content.getFirst(), viewJson, {\"style\": \"select\"}, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r this.statement = {\r \"execute\": function (statement, callback, async) {\r var parameter = this.parseParameter(statement.parameter);\r var filterList = this.parseFilter(statement.filter, parameter);\r var obj = {\r \"filterList\": filterList,\r \"parameter\" : parameter\r };\r MWF.Actions.load(\"x_query_assemble_surface\").StatementAction.executeV2(\r statement.name, statement.mode || \"data\", statement.page || 1, statement.pageSize || 20, obj,\r function (json) {\r if (callback) callback(json);\r }, null, async);\r },\r parseFilter : function( filter, parameter ){\r if( typeOf(filter) !== \"array\" )return [];\r var filterList = [];\r ( filter || [] ).each( function (d) {\r var parameterName = d.path.replace(/\\./g, \"_\");\r var value = d.value;\r if( d.comparison === \"like\" || d.comparison === \"notLike\" ){\r if( value.substr(0, 1) !== \"%\" )value = \"%\"+value;\r if( value.substr(value.length-1,1) !== \"%\" )value = value+\"%\";\r parameter[ parameterName ] = value; //\"%\"+value+\"%\";\r }else{\r if( d.formatType === \"dateTimeValue\" || d.formatType === \"datetimeValue\"){\r value = \"{ts '\"+value+\"'}\"\r }else if( d.formatType === \"dateValue\" ){\r value = \"{d '\"+value+\"'}\"\r }else if( d.formatType === \"timeValue\" ){\r value = \"{t '\"+value+\"'}\"\r }\r parameter[ parameterName ] = value;\r }\r d.value = parameterName;\r \r filterList.push( d );\r }.bind(this));\r return filterList;\r },\r parseParameter : function( obj ){\r if( typeOf(obj) !== \"object\" )return {};\r var parameter = {};\r //传入的参数\r for( var p in obj ){\r var value = obj[p];\r if( typeOf( value ) === \"date\" ){\r value = \"{ts '\"+value.format(\"db\")+\"'}\"\r }\r parameter[ p ] = value;\r }\r return parameter;\r },\r \"select\": function (statement, callback, options) {\r if (statement.name) {\r // var parameter = this.parseParameter(statement.parameter);\r // var filterList = this.parseFilter(statement.filter, parameter);\r var statementJson = {\r \"statementId\": statement.name || \"\",\r \"isTitle\": (statement.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (statement.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": statement.filter,\r \"parameter\": statement.parameter\r };\r if (!options) options = {};\r options.width = statement.width;\r options.height = statement.height;\r options.title = statement.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select statement view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.statement.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.statement.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", function () {\r this.statement = new MWF.xApplication.query.Query.Statement(dlg.content.getFirst(), statementJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r \r //var lookupAction = null;\r //var getLookupAction = function(callback){\r // if (!lookupAction){\r // MWF.require(\"MWF.xDesktop.Actions.RestActions\", function(){\r // lookupAction = new MWF.xDesktop.Actions.RestActions(\"\", \"x_cms_assemble_control\", \"\");\r // lookupAction.getActions = function(actionCallback){\r // this.actions = {\r // \"lookup\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\":\"PUT\"},\r // \"getView\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\"}\r // };\r // if (actionCallback) actionCallback();\r // }\r // if (callback) callback();\r // }.bind(this));\r // }else{\r // if (callback) callback();\r // }\r //};\r //\r //this.view = {\r // \"lookup\": function(view, callback){\r // getLookupAction(function(){\r // lookupAction.invoke({\"name\": \"lookup\",\"async\": true, \"parameter\": {\"view\": view.view, \"application\": view.application},\"success\": function(json){\r // var data = {\r // \"grid\": json.data.grid,\r // \"groupGrid\": json.data.groupGrid\r // };\r // if (callback) callback(data);\r // }.bind(this)});\r // }.bind(this));\r // },\r // \"select\": function(view, callback, options){\r // if (view.view){\r // var viewJson = {\r // \"application\": view.application || \"\",\r // \"viewName\": view.view || \"\",\r // \"isTitle\": view.isTitle || \"yes\",\r // \"select\": view.select || \"multi\",\r // \"title\": view.title || \"Select View\"\r // };\r // if (!options) options = {};\r // var width = options.width || \"700\";\r // var height = options.height || \"400\";\r //\r // if (layout.mobile){\r // var size = document.body.getSize();\r // width = size.x;\r // height = size.y;\r // options.style = \"viewmobile\";\r // }\r // width = width.toInt();\r // height = height.toInt();\r //\r // var size = _form.app.content.getSize();\r // var x = (size.x-width)/2;\r // var y = (size.y-height)/2;\r // if (x&lt;0) x = 0;\r // if (y&lt;0) y = 0;\r // if (layout.mobile){\r // x = 20;\r // y = 0;\r // }\r //\r // var _self = this;\r // MWF.require(\"MWF.xDesktop.Dialog\", function(){\r // var dlg = new MWF.xDesktop.Dialog({\r // \"title\": options.title || \"select View\",\r // \"style\": options.style || \"view\",\r // \"top\": y,\r // \"left\": x-20,\r // \"fromTop\":y,\r // \"fromLeft\": x-20,\r // \"width\": width,\r // \"height\": height,\r // \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r // \"maskNode\": _form.app.content,\r // \"container\": _form.app.content,\r // \"buttonList\": [\r // {\r // \"text\": MWF.LP.process.button.ok,\r // \"action\": function(){\r // //if (callback) callback(_self.view.selectedItems);\r // if (callback) callback(_self.view.getData());\r // this.close();\r // }\r // },\r // {\r // \"text\": MWF.LP.process.button.cancel,\r // \"action\": function(){this.close();}\r // }\r // ]\r // });\r // dlg.show();\r // if (layout.mobile){\r // var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r // var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r // if (backAction) backAction.addEvent(\"click\", function(e){\r // dlg.close();\r // }.bind(this));\r // if (okAction) okAction.addEvent(\"click\", function(e){\r // //if (callback) callback(this.view.selectedItems);\r // if (callback) callback(this.view.getData());\r // dlg.close();\r // }.bind(this));\r // }\r //\r // // MWF.xDesktop.requireApp(\"cms.Xform\", \"widget.View\", function(){\r // // this.view = new MWF.xApplication.cms.Xform.widget.View(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // // }.bind(this));\r // MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r // this.view = new MWF.xApplication.query.Query.Viewer(dlg.content.getFirst(), viewJson, {\"style\": \"select\"});\r // }.bind(this));\r // }.bind(this));\r // }\r // }\r //};\r \r \r //include 引用脚本\r //optionsOrName : {\r // type : \"\", 默认为cms, 可以为 portal process cms\r // application : \"\", 门户/流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\" // 脚本名称/别名/id\r //}\r //或者name: \"\" // 脚本名称/别名/id\r // if( !window.includedScripts ){\r // var includedScripts = window.includedScripts = [];\r // }else{\r // var includedScripts = window.includedScripts;\r // }\r var includedScripts = [];\r this.include = function( optionsOrName , callback ){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"cms\";\r var application = options.application || _form.json.application;\r var key = type +\"-\" + application + \"-\" + name;\r if (includedScripts.indexOf( key )> -1){\r if (callback) callback.apply(this);\r return;\r }\r //if (includedScripts.indexOf( name )> -1){\r // if (callback) callback.apply(this);\r // return;\r //}\r var scriptAction;\r switch ( type ){\r case \"portal\" :\r if( this.scriptActionPortal ){\r scriptAction = this.scriptActionPortal;\r }else{\r MWF.require(\"MWF.xScript.Actions.PortalScriptActions\", null, false);\r scriptAction = this.scriptActionPortal = new MWF.xScript.Actions.PortalScriptActions();\r }\r break;\r case \"process\" :\r if( this.scriptActionProcess ){\r scriptAction = this.scriptActionProcess;\r }else{\r MWF.require(\"MWF.xScript.Actions.ScriptActions\", null, false);\r scriptAction = this.scriptActionProcess = new MWF.xScript.Actions.ScriptActions();\r }\r break;\r case \"cms\" :\r if( this.scriptActionCMS ){\r scriptAction = this.scriptActionCMS;\r }else{\r MWF.require(\"MWF.xScript.Actions.CMSScriptActions\", null, false);\r scriptAction = this.scriptActionCMS = new MWF.xScript.Actions.CMSScriptActions();\r }\r break;\r }\r scriptAction.getScriptByName( application, name, includedScripts, function(json){\r if (json.data){\r includedScripts.push( key );\r \r //名称、别名、id\r json.data.importedList.each( function ( flag ) {\r if( type === \"portal\" ){\r includedScripts.push( type + \"-\" + json.data.portal + \"-\" + flag );\r if( json.data.portalName )includedScripts.push( type + \"-\" + json.data.portalName + \"-\" + flag );\r if( json.data.portalAlias )includedScripts.push( type + \"-\" + json.data.portalAlias + \"-\" + flag );\r }else if( type === \"cms\" ){\r includedScripts.push( type + \"-\" + json.data.appId + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }else if( type === \"process\" ){\r includedScripts.push( type + \"-\" + json.data.application + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }\r });\r \r includedScripts = includedScripts.concat(json.data.importedList);\r MWF.CMSMacro.exec(json.data.text, this);\r if (callback) callback.apply(this);\r }else{\r if (callback) callback.apply(this);\r }\r }.bind(this), null, false);\r };\r //var includedScripts = [];\r //this.include = function(name, callback){\r // if (includedScripts.indexOf(name)==-1){\r // if (!this.scriptAction){\r // MWF.require(\"MWF.xScript.Actions.CMSScriptActions\", null, false);\r // this.scriptAction = new MWF.xScript.Actions.CMSScriptActions();\r // }\r // this.scriptAction.getScriptByName(_form.json.application, name, includedScripts, function(json){\r // includedScripts = includedScripts.concat(json.data.importedList);\r // MWF.CMSMacro.exec(json.data.text, this);\r // if (callback) callback.apply(this);\r // }.bind(this), null, false);\r // }else{\r // if (callback) callback.apply(this);\r // }\r //}.bind(this);\r \r this.define = function(name, fun, overwrite){\r var over = true;\r if (overwrite===false) over = false;\r var o = {};\r o[name] = {\"value\": fun, \"configurable\": over};\r MWF.defineProperties(this, o);\r }.bind(this);\r //如果前端事件有异步调用，想要在异步调用结束后继续运行页面加载，\r //可在调用前执行 var resolve = this.wait();\r //在异步调用结束后 执行 resolve.cb()；\r //目前只有表单的queryload事件支持此方法。\r this.wait = function(){\r resolve = {};\r var setResolve = function(callback){\r resolve.cb = callback;\r }.bind(this);\r this.target.event_resolve = setResolve;\r return resolve;\r };\r //和this.wait配合使用，\r //如果没有异步，则resolve.cb方法不存在，\r //所以在回调中中使用this.goon();使表单继续加载\r this.goon = function(){\r this.target.event_resolve = null;\r };\r \r //仅前台对象-----------------------------------------\r //form\r this.form = {\r \"getInfor\": function(){return ev.formInfor;},\r \"infor\": ev.formInfor,\r \"getApp\": function(){return _form.app;},\r \"app\": _form.app,\r \"node\": function(){return _form.node;},\r \"readonly\": _form.options.readonly,\r \"get\": function(name){return (_form.all) ? _form.all[name] : null;},\r \"getField\": function(name){return _forms[name];},\r \"getAction\": function(){return _form.documentAction},\r \"getData\": function(){return new MWF.xScript.CMSJSONData(_form.getData());},\r \"save\": function(callback){\r _form.saveDocument(callback);\r },\r \"close\": function(){_form.closeDocument();},\r \r /**发布当前文档。&lt;b>（仅内容管理表单中可用）&lt;/b>\r * @method publish\r * @memberOf module:form\r * @param {Function} callback - 发布后的回调方法\r * @o2syntax\r this.form.publish( callback );\r */\r \"publish\": function(callback){\r _form.publishDocument(callback)\r },\r //\"archive\": function(option){\r // _form.archiveDocument()\r //},\r //\"redraft\": function(option){\r // _form.redraftDocument()\r //},\r \"confirm\": function(type, title, text, width, height, ok, cancel, callback, mask, style){\r // var p = MWF.getCenter({\"x\": width, \"y\": height});\r // e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r // _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r if ((arguments.length&lt;=1) || o2.typeOf(arguments[1])===\"string\"){\r var p = MWF.getCenter({\"x\": width, \"y\": height});\r e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }else{\r e = (arguments.length>1) ? arguments[1] : null;\r title = (arguments.length>2) ? arguments[2] : null;\r text = (arguments.length>3) ? arguments[3] : null;\r width = (arguments.length>4) ? arguments[4] : null;\r height = (arguments.length>5) ? arguments[5] : null;\r ok = (arguments.length>6) ? arguments[6] : null;\r cancel = (arguments.length>7) ? arguments[7] : null;\r callback = (arguments.length>8) ? arguments[8] : null;\r mask = (arguments.length>9) ? arguments[9] : null;\r style = (arguments.length>10) ? arguments[10] : null;\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }\r },\r //\"confirm\": function(type, e, title, text, width, height, ok, cancel, callback){\r // _form.confirm(type, e, title, text, width, height, ok, cancel, callback);\r //},\r \"notice\": function(content, type, target, where, offset, option){\r _form.notice(content, type, target, where, offset, option);\r },\r \"addEvent\": function(e, f){_form.addEvent(e, f);},\r \"openWork\": function(id, completedId, title, options){\r var op = options || {};\r op.workId = id;\r op.workCompletedId = completedId;\r op.docTitle = title;\r op.appId = \"process.Work\"+(op.workId || op.workCompletedId);\r return layout.desktop.openApplication(this.event, \"process.Work\", op);\r },\r \"openJob\": function(id, choice, options){\r var workData = null;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listWorkByJob(id, function(json){\r if (json.data) workData = json.data;\r }.bind(this), null, false);\r \r if (workData){\r var len = workData.workList.length + workData.workCompletedList.length;\r if (len){\r if (len>1 &amp;&amp; choice){\r var node = new Element(\"div\", {\"styles\": {\"padding\": \"20px\", \"width\": \"500px\"}}).inject(_form.node);\r workData.workList.each(function(work){\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\"+o2.LP.widget.open+\"&lt;/div>&lt;/div>\"+\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\"+work.title+\"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.activityName+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.activityArrivedTime+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+(work.manualTaskIdentityText || \"\")+\"&lt;/div>&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function(e){\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(work.id, null, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r workData.workCompletedList.each(function(work){\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\"+o2.LP.widget.open+\"&lt;/div>&lt;/div>\"+\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\"+work.title+\"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+o2.LP.widget.workcompleted+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.completedTime+\"&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function(e){\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(null, work.id, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r var height = node.getSize().y+20;\r if (height>600) height = 600;\r \r var dlg = o2.DL.open({\r \"title\": o2.LP.widget.choiceWork,\r \"style\" : \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\" : \"cancel\",\r \"text\": o2.LP.widget.close,\r \"action\": function(){dlg.close();}\r }\r ]\r });\r }else{\r if (workData.workList.length){\r var work = workData.workList[0];\r return this.openWork(work.id, null, work.title, options);\r }else{\r var work = workData.workCompletedList[0];\r return this.openWork(null, work.id, work.title, options);\r }\r }\r }\r }\r },\r \"openDocument\": function(id, title, options){\r var op = options || {};\r op.documentId = id;\r op.docTitle = title;\r layout.desktop.openApplication(this.event, \"cms.Document\", op);\r },\r \"openPortal\": function (name, page, par) {\r var action = MWF.Actions.get(\"x_portal_assemble_surface\");\r action.getApplication(name, function (json) {\r if (json.data) {\r if (page) {\r action.getPageByName(page, json.data.id, function (pageJson) {\r var pageId = (pageJson.data) ? pageJson.data.id : \"\";\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"pageId\": pageId,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id + pageId)\r })\r });\r } else {\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id)\r })\r }\r }\r \r });\r },\r \"openCMS\": function(name){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r action.getColumn(name, function(json){\r if (json.data){\r layout.desktop.openApplication(null, \"cms.Module\", {\r \"columnId\": json.data.id,\r \"appId\": \"cms.Module\"+json.data.id\r });\r }\r });\r },\r \"openProcess\": function(name){\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r action.getApplication(name, function(json){\r if (json.data){\r layout.desktop.openApplication(null, \"process.Application\", {\r \"id\": json.data.id,\r \"appId\": \"process.Application\"+json.data.id\r });\r }\r });\r },\r \"openApplication\":function(name, options){\r layout.desktop.openApplication(null, name, options);\r },\r \"createDocument\": function (columnOrOptions, category, data, identity, callback, target, latest, selectColumnEnable, ignoreTitle) {\r var column = columnOrOptions;\r var onAfterPublish, onPostPublish;\r if (typeOf(columnOrOptions) == \"object\") {\r column = columnOrOptions.column;\r category = columnOrOptions.category;\r data = columnOrOptions.data;\r identity = columnOrOptions.identity;\r callback = columnOrOptions.callback;\r target = columnOrOptions.target;\r latest = columnOrOptions.latest;\r selectColumnEnable = columnOrOptions.selectColumnEnable;\r ignoreTitle = columnOrOptions.ignoreTitle;\r onAfterPublish = columnOrOptions.onAfterPublish;\r onPostPublish = columnOrOptions.onPostPublish;\r }\r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r layout.app.content.empty();\r layout.app = null;\r }\r }\r \r MWF.xDesktop.requireApp(\"cms.Index\", \"Newer\", function () {\r var starter = new MWF.xApplication.cms.Index.Newer(null, null, _form.app, null, {\r \"documentData\": data,\r \"identity\": identity,\r \r \"ignoreTitle\": ignoreTitle === true,\r \"ignoreDrafted\": latest === false,\r \"selectColumnEnable\": !category || selectColumnEnable === true,\r \"restrictToColumn\": !!category &amp;&amp; selectColumnEnable !== true,\r \r \"categoryFlag\": category, //category id or name\r \"columnFlag\": column, //column id or name,\r \"onStarted\": function (documentId, data) {\r if (callback) callback();\r },\r \"onPostPublish\": function () {\r if(onPostPublish)onPostPublish();\r },\r \"onAfterPublish\": function () {\r if(onAfterPublish)onAfterPublish();\r }\r });\r starter.load();\r })\r },\r \"startProcess\": function(app, process, data, identity, callback, target, latest){\r if (arguments.length>2){\r for (var i=2; i&lt;arguments.length; i++){\r if (typeOf(arguments[i])==\"boolean\"){\r target = arguments[i];\r break;\r }\r }\r }\r if (target){\r if (layout.app &amp;&amp; layout.app.inBrowser){\r //layout.app.content.empty();\r layout.app.$openWithSelf = true;\r }\r }\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\").getProcessByName(process, app, function(json){\r if (json.data){\r MWF.xDesktop.requireApp(\"process.TaskCenter\", \"ProcessStarter\", function(){\r var starter = new MWF.xApplication.process.TaskCenter.ProcessStarter(json.data, _form.app, {\r \"workData\": data,\r \"identity\": identity,\r \"latest\": latest,\r \"onStarted\": function(data, title, processName){\r if (data.work){\r var work = data.work;\r var options = {\"draft\": work, \"appId\": \"process.Work\"+(new o2.widget.UUID).toString(), \"desktopReload\": false};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{\r var currentTask = [];\r data.each(function(work){\r if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r }.bind(this));\r \r if (currentTask.length==1){\r var options = {\"workId\": currentTask[0], \"appId\": currentTask[0]};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{}\r }\r \r // var currentTask = [];\r // data.each(function(work){\r // if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r // }.bind(this));\r //\r // if (currentTask.length==1){\r // var options = {\"workId\": currentTask[0], \"appId\": currentTask[0]};\r // layout.desktop.openApplication(null, \"process.Work\", options);\r // }else{}\r \r if (callback) callback(data);\r }.bind(this)\r });\r starter.load();\r }.bind(this));\r }\r });\r }\r };\r \r this.target = ev.target;\r this.event = ev.event;\r this.status = ev.status;\r this.session = layout.desktop.session;\r this.Actions = o2.Actions;\r \r this.query = function(option){\r // options = {\r // \"name\": \"statementName\",\r // \"data\": \"json data\",\r // \"firstResult\": 1,\r // \"maxResults\": 100,\r // \"success\": function(){},\r // \"error\": function(){},\r // \"async\": true or false, default is true\r // }\r if (option){\r var json = (option.data) || {};\r if (option.firstResult) json.firstResult = option.firstResult.toInt();\r if (option.maxResults) json.maxResults = option.maxResults.toInt();\r o2.Actions.get(\"x_query_assemble_surface\").executeStatement(option.name, json, success, error, options.async);\r }\r };\r this.Table = MWF.xScript.createTable();\r };\r MWF.xScript.createTable = function(){\r return function(name){\r this.name = name;\r this.action = o2.Actions.get(\"x_query_assemble_surface\");\r \r this.listRowNext = function(id, count, success, error, async){\r this.action.listRowNext(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowSelectWhere = function(where, success, error, async){\r this.action.listRowSelectWhere(this.name, where, success, error, async);\r };\r this.listRowCountWhere = function(where, success, error, async){\r this.action.listRowCountWhere(this.name, where, success, error, async);\r };\r this.deleteRow = function(id, success, error, async){\r this.action.deleteRow(this.name, id, success, error, async);\r };\r this.deleteAllRow = function(success, error, async){\r this.action.deleteAllRow(this.name, success, error, async);\r };\r this.getRow = function(id, success, error, async){\r this.action.getRow(this.name, id, success, error, async);\r };\r this.insertRow = function(data, success, error, async){\r this.action.insertRow(this.name, data, success, error, async);\r };\r this.updateRow = function(id, data, success, error, async){\r this.action.updateRow(this.name, id, data, success, error, async);\r };\r }\r };\r MWF.xScript.CMSJSONData = function(data, callback, key, parent){\r var getter = function(data, callback, k, _self){\r return function(){return ([\"array\",\"object\"].indexOf(typeOf(data[k]))===-1) ? data[k] : new MWF.xScript.CMSJSONData(data[k], callback, k, _self);};\r };\r var setter = function(data, callback, k, _self){\r return function(v){\r data[k] = v;\r //debugger;\r //this.add(k, v, true);\r if (callback) callback(data, k, _self);\r }\r };\r var define = function(){\r var o = {};\r for (var k in data) o[k] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, k, this]),\"set\": setter.apply(this, [data, callback, k, this])};\r o[\"length\"] = {\"get\": function(){return Object.keys(data).length;}};\r o[\"some\"] = {\"get\": function(){return data.some;}};\r MWF.defineProperties(this, o);\r \r var methods = {\r \"getKey\": {\"value\": function(){ return key; }},\r \"getParent\": {\"value\": function(){ return parent; }},\r \"toString\": {\"value\": function() { return data.toString();}},\r \"add\": {\"value\": function(newKey, newValue, overwrite){\r var flag = true;\r var type = typeOf(data);\r if (type===\"array\"){\r if (arguments.length&lt;2){\r data.push(newKey);\r newValue = newKey;\r newKey = data.length-1;\r }else{\r if (!newKey &amp;&amp; newKey!==0){\r data.push(newValue);\r newKey = data.length-1;\r }else{\r flag = false;\r }\r }\r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else if (type===\"object\"){\r if (!this.hasOwnProperty(newKey)){\r data[newKey] = newValue;\r \r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else{\r if (overwrite) this[newKey] = newValue;\r }\r }\r \r return this[newKey];\r }},\r \"del\": {\"value\": function(delKey){\r if (!this.hasOwnProperty(delKey)) return null;\r delete data[delKey];\r delete this[delKey];\r return this;\r }}\r };\r MWF.defineProperties(this, methods);\r \r \r \r \r //this.getKey = function(){ return key; };\r //this.getParent = function(){ return parent; };\r //this.toString = function() { return data.toString();};\r //this.add = function(newKey, newValue, overwrite){\r // var flag = true;\r // var type = typeOf(data);\r // if (!this.hasOwnProperty(newKey)){\r // if (type==\"array\"){\r // if (arguments.length&lt;2){\r // data.push(newKey);\r // newValue = newKey;\r // newKey = data.length-1;\r // }else{\r // debugger;\r // if (!newKey &amp;&amp; newKey!=0){\r // data.push(newValue);\r // newKey = data.length-1;\r // }else{\r // flag == false;\r // }\r // }\r // }else{\r // data[newKey] = newValue;\r // }\r // //var valueType = typeOf(newValue);\r // //var newValueData = newValue;\r // //if (valueType==\"object\" || valueType==\"array\") newValueData = new MWF.xScript.JSONData(newValue, callback, newKey, this);\r // //if (valueType==\"null\") newValueData = new MWF.xScript.JSONData({}, callback, newKey, this);\r // if (flag){\r // var o = {};\r // o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r // MWF.defineProperties(this, o);\r // }\r // this[newKey] = newValue;\r // }else{\r // if (overwrite) this[newKey] = newValue;\r // }\r //\r // //var valueType = typeOf(newValue);\r // //var newValueData = newValue;\r // //if (valueType==\"object\" || valueType==\"array\") newValueData = new MWF.xScript.JSONData(newValue, callback, newKey, this);\r // //if (valueType==\"null\") newValueData = new MWF.xScript.JSONData({}, callback, newKey, this);\r // //\r // //this[newKey] = newValueData;\r //\r // return this[newKey];\r //};\r //this.del = function(delKey){\r // if (!this.hasOwnProperty(delKey)) return null;\r // delete data[newKey];\r // delete this[newKey];\r // return this;\r //};\r };\r var type = typeOf(data);\r if (type===\"object\" || type===\"array\") define.apply(this);\r };\r \r //MWF.xScript.CMSJSONData = function(data, callback, key, parent){\r // var getter = function(data, callback, k, _self){\r // return function(){return ([\"array\",\"object\"].indexOf(typeOf(data[k]))==-1) ? data[k] : new MWF.xScript.CMSJSONData(data[k], callback, k, _self);};\r // }\r // var setter = function(data, callback, k, _self){\r // return function(v){\r // data[k] = v;\r // if (callback) callback(data, k, _self);\r // }\r // }\r // var define = function(){\r // var o = {};\r // for (var k in data) o[k] = {\r // \"configurable\": true,\r // \"get\": getter.apply(this, [data, callback, k, this]),\r // \"set\": setter.apply(this, [data, callback, k, this])\r // };\r // o[\"length\"] = {\"get\": function(){return Object.keys(data).length;}};\r // MWF.defineProperties(this, o);\r // this.getKey = function(){ return key; };\r // this.getParent = function(){ return parent; };\r // this.toString = function() { return data.toString();};\r // this.add = function(newKey, newValue){\r // var type = typeOf(data);\r // if (!this.hasOwnProperty(newKey)){\r // if (type==\"array\"){\r // data.push(newValue || {});\r // newKey = data.length-1;\r // }else{\r // data[newKey] = newValue || {};\r // }\r // var o = {};\r // o[newKey] = {\"configurable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r // MWF.defineProperties(this, o);\r // }\r // this[newKey] = newValue;\r // return this;\r // };\r // this.del = function(delKey){\r // if (!this.hasOwnProperty(delKey)) return null;\r // delete data[newKey];\r // delete this[newKey];\r // return this;\r // };\r // }\r // var type = typeOf(data);\r // if (type==\"object\" || type==\"array\") define.apply(this);\r //};\r \r //MWF.xScript.createCMSDict = function(application){\r // return function(name){\r // var applicationId = application;\r // this.name = name;\r // MWF.require(\"MWF.xScript.Actions.CMSDictActions\", null, false);\r // var action = new MWF.xScript.Actions.CMSDictActions();\r //\r // this.get = function(path, success, failure){\r // var value = null;\r // if( path ){\r // var arr = path.split(/\\./g);\r // var ar = arr.map(function(v){\r // return encodeURIComponent(v);\r // });\r // //var p = path.replace(/\\./g, \"/\");\r // var p = ar.join(\"/\");\r // action.getDict(applicationId, encodeURIComponent(this.name), p, function(json){\r // value = json.data;\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r // }else{\r // action.getDictWhole(applicationId, encodeURIComponent(this.name), function(json){\r // value = json.data;\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r // }\r // return value;\r // };\r //\r // this.set = function(path, value, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.setDict(applicationId, encodeURIComponent(this.name), p, value, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this.add = function(path, value, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.addDict(applicationId, encodeURIComponent(this.name), p, value, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this[\"delete\"] = function(path, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.deleteDict(applicationId, encodeURIComponent(this.name), p, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this.destory = this[\"delete\"];\r // }\r //};\r \r if( !MWF.xScript.dictLoaded )MWF.xScript.dictLoaded = {};\r \r MWF.xScript.addDictToCache = function ( options, path, json ) {\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var type = options.appType || \"process\";\r var enableAnonymous = options.enableAnonymous || false;\r \r var appFlagList = [];\r if( options.application )appFlagList.push( options.application );\r if( options.appId )appFlagList.push( options.appId );\r if( options.appName )appFlagList.push( options.appName );\r if( options.appAlias )appFlagList.push( options.appAlias );\r \r var dictFlagList = [];\r if( options.id )dictFlagList.push( options.id );\r if( options.name )dictFlagList.push( options.name );\r if( options.alias )dictFlagList.push( options.alias );\r \r var cache = {};\r cache[path] = json;\r \r for( var i=0; i&lt;appFlagList.length; i++ ){\r for( var j=0; j&lt;dictFlagList.length; j++ ){\r var k = dictFlagList[j] + type + appFlagList[i] + enableAnonymous;\r if( !MWF.xScript.dictLoaded[k] ){\r MWF.xScript.dictLoaded[k] = cache; //指向同一个对象\r // MWF.xScript.dictLoaded[k][path] = json; //指向不同的对象\r }else if( i===0 &amp;&amp; j===0 ){\r MWF.xScript.setDictToCache( k, path ,json );\r var arr = path.split(/\\./g);\r var p;\r var cache = MWF.xScript.dictLoaded[k];\r for( var l=0 ; l&lt;arr.length; l++ ){\r p = l === 0 ? arr[0] : ( p + \".\" + arr[l] );\r if( cache[ p ] )break;\r }\r if( p ){\r var mathP = p+\".\";\r Object.keys( cache ).each( function( path, idx){\r if( path.indexOf( mathP ) === 0 )delete cache[path];\r })\r }\r }\r }\r }\r };\r \r MWF.xScript.getMatchedDict = function(key, path){\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var arr = path.split(/\\./g);\r if( MWF.xScript.dictLoaded[key] ){\r var dicts = MWF.xScript.dictLoaded[key];\r var list = Array.clone(arr);\r var p;\r var dict;\r for( var i=0 ; i&lt;arr.length; i++ ){\r p = i === 0 ? arr[0] : ( p + \".\" + arr[i] );\r list.shift();\r if( dicts[ p ] ){\r dict = dicts[ p ];\r break;\r }\r }\r return {\r dict : dict,\r unmatchedPathList : list\r }\r }\r return {\r dict : null,\r unmatchedPathList : list\r }\r };\r \r MWF.xScript.insertDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r var lastPath = list[list.length-1];\r if( !dict[lastPath] ){\r dict[lastPath] = json;\r }else if( typeOf( dict[lastPath] ) === \"array\" ){\r dict[lastPath].push( json );\r }\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r \r MWF.xScript.setDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r dict[list[list.length-1]] = json;\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r MWF.xScript.getDictFromCache = function( key, path ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( dict ){\r for( var j=0; j&lt;list.length; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return null;\r }\r return dict;\r }\r return null;\r };\r \r MWF.xScript.deleteDictToCache = function(key, path){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r \r if( dict){\r for( var j=0; j&lt;list.length-1; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return;\r }\r delete dict[list[list.length-1]];\r }\r };\r \r \r MWF.xScript.createCMSDict = function(application){\r //optionsOrName : {\r // type : \"\", //默认为process, 可以为 process cms\r // application : \"\", //流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\", // 数据字典名称/别名/id\r // enableAnonymous : false //允许在未登录的情况下读取CMS的数据字典\r //}\r //或者name: \"\" // 数据字典名称/别名/id\r return function(optionsOrName){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = this.name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"cms\";\r var applicationId = options.application || application;\r var enableAnonymous = options.enableAnonymous || false;\r \r var opt = {\r \"appType\" : type,\r \"name\" : name,\r \"appId\" : applicationId,\r \"enableAnonymous\" : enableAnonymous\r };\r \r var key = name+type+applicationId+enableAnonymous;\r // if (!dictLoaded[key]) dictLoaded[key] = {};\r // this.dictData = dictLoaded[key];\r \r //MWF.require(\"MWF.xScript.Actions.DictActions\", null, false);\r if( type == \"cms\" ){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r }else{\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r }\r \r var encodePath = function( path ){\r var arr = path.split(/\\./g);\r var ar = arr.map(function(v){\r return encodeURIComponent(v);\r });\r return ar.join(\"/\");\r };\r \r this.get = function(path, success, failure, async, refresh){\r var value = null;\r \r if (success===true) async=true;\r if (failure===true) async=true;\r \r if (!refresh ){\r var data = MWF.xScript.getDictFromCache( key, path );\r if( data ){\r if (success &amp;&amp; o2.typeOf(success)==\"function\") success( data );\r if( !!async ){\r return Promise.resolve( data );\r }else{\r return data;\r }\r }\r }\r \r \r // var cb = function(json){\r // value = json.data;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r // return value;\r // }.ag().catch(function(xhr, text, error){ if (failure &amp;&amp; o2.typeOf(failure)==\"function\") return failure(xhr, text, error); });\r \r var cb = function(json){\r value = json.data;\r MWF.xScript.addDictToCache(opt, path, value);\r if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r return value;\r };\r \r var promise;\r if (path){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, cb, null, !!async, false);\r }else{\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, cb, null, !!async, false);\r }\r return (!!async) ? promise : value;\r \r // if (path){\r // var p = encodePath( path );\r // //var p = path.replace(/\\./g, \"/\");\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, function(json){\r // value = json.data;\r // // this.dictData[path] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }else{\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, function(json){\r // value = json.data;\r // // this.dictData[\"root\"] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }\r \r //return value;\r };\r \r this.set = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.setDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.setDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.add = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.addDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.insertDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this[\"delete\"] = function(path, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.deleteDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r MWF.xScript.deleteDictToCache(key, path);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.destory = this[\"delete\"];\r }\r };\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"o2_core_o2_xScript_Environment.js.html":{"url":"o2_core_o2_xScript_Environment.js.html","title":"o2_core/o2/xScript/Environment.js","kind":"source","body":" O2OA WebAPI: o2_core/o2/xScript/Environment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source o2_core/o2/xScript/Environment.js MWF.xScript = MWF.xScript || {};\r MWF.xScript.Environment = function(ev){\r var _data = ev.data;\r var _form = ev.form;\r var _forms = ev.forms;\r \r this.library = COMMON;\r //this.library.version = \"4.0\";\r \r this.power = {\r \"isManager\": MWF.AC.isProcessManager() || _form.businessData.control.allowReroute,\r \"isReseter\": _form.businessData.control.allowReset,\r \"isDelete\": _form.businessData.control.allowDeleteWork,\r \"isPront\": true,\r \"isPrint\": true\r };\r //data\r var getJSONData = function(jData){\r return new MWF.xScript.JSONData(jData, function(data, key, _self){\r var p = {\"getKey\": function(){return key;}, \"getParent\": function(){return _self;}};\r while (p &amp;&amp; !_forms[p.getKey()]) p = p.getParent();\r if (p) if (p.getKey()) if (_forms[p.getKey()]) _forms[p.getKey()].resetData();\r }, \"\", null, _form);\r };\r \r \r this.setData = function(data){\r \r /**\r * data对象是流程平台中，流程实例的业务数据；以及内容管理平台中，文档实例的业务数据。&lt;br/>\r * 这些数据一般情况下是通过您创建的表单收集而来的，也可以通过脚本进行创建和增删改查操作。&lt;br/>\r * data对象基本上是一个JSON对象，您可以用访问JSON对象的方法访问data对象的所有数据，但增加和删除数据时略有不同。\r * @module data\r * @o2ordernumber 10\r * @example\r * //您可以在表单或流程的各个嵌入脚本中，通过this来获取当前实例的业务数据，如下：\r * var data = this.data;\r */\r this.data = getJSONData(data);\r \r /**\r * 访问或修改data对象的数据。&lt;br/>&lt;br/>\r * data数据用于存储表单获取的数据，所有属性都是动态的，其格式和访问方式都和JSON类似。&lt;br/>\r * 在表单脚本中使用data对象，实现了data和表单可编辑元素的双向绑定。&lt;br/>\r * 改变data对象，会自动更新表单元素，修改表单可编辑元素，也会自动修改data对象。\r * @member {String|Number} [[property]]\r * @memberOf module:data\r * @instance\r * @example\r * var value = this.data.subject; //获取名为subject的数据值\r *\r * //将subject的值修改为'123'。\r * //需要注意的是，用这种方式创建新字段，必须要在当前表单上有一个名为‘subject’的字段组件。\r * //如果表单上没有该组件，可以使用this.data.add('subject','123',true)。给已有字段赋值则没有这个限制。\r * this.data.subject = '123';\r *\r * @example\r * &lt;caption>\r * &lt;b>获取流程文档中的数据网格的值&lt;/b>：&lt;br/>\r * 如有以下数据网格：\r * &lt;img src=\"img/module/data/datagrid.jpg\">\r * 其数据网格设计如下(数据网格id为：datagrid)：\r * &lt;img src=\"img/module/data/datagridDesign.jpg\">\r * &lt;/caption>\r * //获取流程文档中的数据网格的值\r * var data = this.data.datagrid;\r *\r * //获取到的data值格式如下：\r * {\r * \"data\": [\r * {\r * \"amountCol\": { \"amount\": \"12000\" },\r * \"countCol\": { \"number\": \"10\" },\r * \"nameCol\": { \"name\": \"手机\" },\r * \"priceCol\": { \"price\": \"1200\" }\r * },\r * {\r * \"amountCol\": { \"amount\": \"15000\" },\r * \"countCol\": { \"number\": \"5\" },\r * \"nameCol\": { \"name\": \"电脑\" },\r * \"priceCol\": { \"price\": \"3000\" }\r * }\r * ],\r * \"total\": {\r * \"amountCol\": \"27000\",\r * \"countCol\": \"15\"\r * }\r * }\r *\r *\r * //获取到数据网格中的其他数据：\r *\r * //获取数据网格中的第一条数据\r * var data = this.data.datagrid.data[0];\r *\r * //获取数据网格中的第一条数据的 nameCol 列的值\r * var data = this.data.datagrid.data[0].nameCol.name;\r *\r * //获取数据网格中的 amountCol 列的总计值\r * var data = this.data.datagrid.total.amountCol;\r *\r *@example\r * &lt;caption>\r * &lt;b>修改数据网格中的数据&lt;/b>&lt;/br>\r * 经过本样例修改后，数据网格将变为：&lt;/br>\r * &lt;img src=\"img/module/data/datagrid2.jpg\">\r * &lt;/caption>\r * //修改数据网格中的第一条数据的 nameCol 列的值\r * this.data.datagrid.data[0].nameCol.name='平板电脑';\r */\r \r /**\r * 为data对象添加一个数据节点。\r * @instance\r * @method add\r * @memberOf module:data\r * @param {(String|Number)} key - 要添加的新的数据节点名称或数组索引号。\r * @param {(String|Number|Array|JsonObject)} value - 新的数据节点的值。\r * @param {Boolean} [overwrite] - 如果要添加的节点已经存在，是否覆盖。默认为 false。\r * @return {(String|Number|Array|JsonObject)} 新添加的数据节点或原有的同名节点。\r * @o2syntax\r * var newData = this.data.add(key, value, overwrite);\r * @example\r * //为data添加一个名为\"remark\"值为\"I am remark\"的数据\r * this.data.add(\"remark\", \"I am remark\");\r * @example\r * //为data添加一个名为\"person\"的Object对象数据\r * var person = this.data.add(\"person\", {});\r * person.add(\"name\", \"Tom\");\r * person.add(\"age\", 23);\r *\r * //或者可以这样\r * var person = this.data.add(\"person\", {name: \"Tom\", \"age\": \"23\"});\r * @example\r * //为data添加一个名为\"orders\"的数组对象数据\r * var orders = this.data.add(\"orders\", []);\r * orders.add({name: \"phone\", count: 5});\r * orders.add({name: \"computer\", count: 10});\r * orders[0].add(\"count\", 10, true); //将第一条数据的count修改为10\r *\r * //或者可以这样\r * var orders = this.data.add(\"orders\", [\r * {name: \"phone\", count: 5},\r * {name: \"computer\", count: 10}\r * ]);\r * //将第一条数据修改为name为mobile; count为10\r * orders.add(0, {name: \"mobile\", count: 10}, true);\r */\r \r /**保存data对象。不触发事件\r * @method save\r * @static\r * @memberOf module:data\r * @param {Function} [callback] - 保存成功后的回调函数。\r * @o2syntax\r * this.data.save(callback);\r * @example\r * this.data.save(function(json){\r * this.form.notice(\"save success!\", \"success\")\r *});\r */\r this.data.save = function(callback){\r _form.saveFormData(callback)\r // var formData = {\r // \"data\": data,\r // \"sectionList\": _form.getSectionList()\r // };\r // _form.workAction.saveSectionData(function(){if (callback) callback();}.bind(this), null, (ev.work.id || ev.workCompleted.id), formData);\r }\r };\r this.setData(_data);\r //task\r //this.task = ev.task;\r //this.task.process = function(routeName, opinion, callback){\r // _form.submitWork(routeName, opinion, callback);\r //};\r //inquiredRouteList\r //this.inquiredRouteList = null;\r \r //workContext\r \r /**\r * 您可以通过workContext获取和流程相关的流程实例对象数据。\r * @module workContext\r * @o2range {Process}\r * @o2ordernumber 20\r * @o2syntax\r * //您可以在表单或流程的各个嵌入脚本中，通过this来获取当前流程实例数据，如下：\r * var context = this.workContext;\r */\r this.workContext = {\r /**\r * 获取当前流程实例对象：work对象或workCompleted对象。\r * @method getWork\r * @static\r * @return {(Work|WorkCompleted)} 流程实例对象；如果流程已结束，返回已结束的流程实例对象.\r * @o2ActionOut x_processplatform_assemble_surface.WorkAction.manageGet|example=Work|ignoreNoDescr=true|ignoreProps=[properties]|Work对象:\r * @o2ActionOut x_processplatform_assemble_surface.WorkCompletedAction.get|example=WorkCompleted|ignoreProps=[properties]|WorkCompleted对象:\r * @o2syntax\r * var work = this.workContext.getWork();\r */\r \"getWork\": function(){return ev.work || ev.workCompleted;},\r /**\r * 获取当前流程实例所在的活动节点对象：activity对象。\r * @method getActivity\r * @static\r * @return {(Activity|Null)} 当前流程实例所在的活动节点对象，如果当前流程实例已流转完成，则返回null.\r * &lt;pre>&lt;code class='language-js'>{\r * \"id\": \"801087c5-a4e6-4b91-bf4d-a81cdaa04471\", //节点ID\r * \"name\": \"办理\", //节点名称\r * \"description\": \"\", //节点描述\r * \"alias\": \"\", //节点别名\r * \"resetRange\": \"department\", //重置处理人范围\r * \"resetCount\": 0, //重置处理人数字\r * \"allowReset\": true, //是否允许重置\r * \"manualMode\": \"single\" //处理方式 单人single, 并行parallel, 串行queue, grab抢办\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * var activity = this.workContext.getActivity();\r */\r \"getActivity\": function(){return ev.activity || null;},\r \r /**\r * 当前流程实例正在流转中，并且当前用户有待办，则返回当前用户的待办对象，否则返回null。\r * @summary 获取当前流程与当前用户相关的待办对象：task对象。\r * @o2ActionOut x_processplatform_assemble_surface.TaskAction.get|example=Task\r * @method getTask\r * @static\r * @return {(Task|Null)} 当前用户的待办任务对象：task。当前用户没有对此流程实例的待办时，或流程实例已经流转结束，返回null.\r * @o2syntax\r * var task = this.workContext.getTask();\r */\r \"getTask\": function(){return ev.task || null;},\r \r /**\r * 获取当前流程实例的所有待办对象。如果流程实例已流转完成，则返回一个空数组。\r * @method getTaskList\r * @o2ActionOut x_processplatform_assemble_surface.TaskAction.listWithWork|example=Task\r * @static\r * @param {Function} [callback] 正确获取待办数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取待办数组出错时的回调。\r * @return {(Task[])} 待办任务列表.\r * @o2syntax\r * //本样例以同步执行\r * var taskList = this.workContext.getTaskList();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getTaskList( function(taskList){\r * //taskList 为待办数组\r * });\r */\r \"getTaskList\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listTaskByWork(ev.work.id, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r /**\r * 根据当前工作的job获取当前流程实例的所有待办对象。如果流程实例已流转完成，则返回一个空数组。\r * @method getTaskListByJob\r * @o2ActionOut x_processplatform_assemble_surface.TaskAction.listWithJob|example=Task\r * @static\r * @param {Function} [callback] 正确获取待办数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取待办数组出错时的回调。\r * @return {(Task[])} 待办任务列表.\r * @o2syntax\r * //本样例以同步执行\r * var taskList = this.workContext.getTaskListByJob();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getTaskListByJob( function(taskList){\r * //taskList 为待办数组\r * });\r */\r \"getTaskListByJob\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listTaskByJob(ev.work.job, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r \r /**\r * 获取当前流程实例的所有已办对象。如果流程实例没有任何人处理过，则返回一个空数组。\r * @method getTaskCompletedList\r * @static\r * @param {Function} [callback] 正确获取已办数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取已办数组出错时的回调。\r * @return {(TaskCompleted[])} 已办任务列表.\r * @o2ActionOut x_processplatform_assemble_surface.TaskCompletedAction.listWithWork|example=Task\r * @o2syntax\r * //本样例以同步执行\r * var taskCompletedList = this.workContext.getTaskCompletedList();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getTaskCompletedList( function(taskCompletedList){\r * //taskCompletedList 为已办数组\r * });\r */\r \"getTaskCompletedList\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listTaskCompletedByWork(ev.work.id, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r \r /**\r * 根据当前工作的job获取当前流程实例的所有已办对象。如果流程实例没有任何人处理过，则返回一个空数组。\r * @method getTaskCompletedListByJob\r * @static\r * @param {Function} [callback] 正确获取已办数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取已办数组出错时的回调。\r * @return {(TaskCompleted[])} 已办任务列表.\r * @o2ActionOut x_processplatform_assemble_surface.TaskCompletedAction.listWithJob|example=Task\r * @o2syntax\r * //本样例以同步执行\r * var taskCompletedList = this.workContext.getTaskCompletedListByJob();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getTaskCompletedListByJob( function(taskCompletedList){\r * //taskCompletedList 为已办数组\r * });\r */\r \"getTaskCompletedListByJob\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listTaskCompletedByJob(ev.work.job, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r \r /**\r * @summary 获取当前流程实例的所有待阅对象数组。如果流程实例无待阅，则返回一个空数组。\r * @method getReadList\r * @static\r * @param {Function} [callback] 正确获取待阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取待阅数组出错时的回调。\r * @return {(Read[])} 当前流程实例的所有待阅对象数组.\r * @o2ActionOut x_processplatform_assemble_surface.ReadAction.get|example=Read\r * @o2syntax\r * //本样例以同步执行\r * var readList = this.workContext.getReadList();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getReadList( function(readList){\r * //readList 为待阅数组\r * });\r */\r \"getReadList\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listReadByWork(ev.work.id, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r /**\r * @summary 根据当前工作的job获取当前流程实例的所有待阅对象。如果流程实例无待阅，则返回一个空数组。\r * @method getReadListByJob\r * @static\r * @param {Function} [callback] 正确获取待阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取待阅数组出错时的回调。\r * @return {(Read[])} 当前流程实例的所有待阅对象数组.\r * @o2ActionOut x_processplatform_assemble_surface.ReadAction.listWithJob|example=Read\r * @o2syntax\r * //本样例以同步执行\r * var readList = this.workContext.getReadListByJob();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getReadListByJob( function(readList){\r * //readList 为待阅数组\r * });\r */\r \"getReadListByJob\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listReadByJob(ev.work.job, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r \r /**\r * @summary 获取当前流程实例的所有已阅对象。如果流程实例没有已阅，则返回一个空数组。\r * @method getReadCompletedList\r * @static\r * @param {Function} [callback] 正确获取已阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取已阅数组出错时的回调。\r * @return {(ReadCompleted[])} 当前流程实例的所有已阅对象数组.\r * @o2ActionOut x_processplatform_assemble_surface.ReadCompletedAction.listWithWork|example=Read\r * @o2syntax\r * //本样例以同步执行\r * var readCompletedList = this.workContext.getReadCompletedList();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getReadCompletedList( function(readCompletedList){\r * //readCompletedList 为已阅数组\r * });\r */\r \"getReadCompletedList\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listReadCompletedByWork(ev.work.id, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r /**\r * @summary 根据当前工作的job获取当前流程实例的所有已阅对象。如果流程实例没有已阅，则返回一个空数组。\r * @method getReadCompletedListByJob\r * @static\r * @param {Function} [callback] 正确获取已阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行\r * @param {Function} [error] 获取已阅数组出错时的回调。\r * @return {(ReadCompleted[])} 当前流程实例的所有已阅对象数组.\r * @o2ActionOut x_processplatform_assemble_surface.ReadCompletedAction.listWithJob|example=Read\r * @o2syntax\r * //本样例以同步执行\r * var readCompletedList = this.workContext.getReadCompletedListByJob();\r * @o2syntax\r * //本样例以异步执行\r * this.workContext.getReadCompletedListByJob( function(readCompletedList){\r * //readCompletedList 为已阅数组\r * });\r */\r \"getReadCompletedListByJob\": function(callback, error){\r var cb = (callback &amp;&amp; o2.typeOf(callback)===\"function\") ? callback : null;\r var ecb = (error &amp;&amp; o2.typeOf(error)===\"function\") ? error : null;\r var list;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listReadCompletedByJob(ev.work.job, function(json){\r list = json.data;\r if (cb) cb(list);\r }, ecb, !!cb);\r return list;\r },\r \"getJobTaskList\": this.getTaskListByJob,\r \"getJobReadList\": this.getReadListByJob,\r \"getJobTaskCompletedList\": this.getTaskCompletedListByJob,\r \"getJobReadCompletedList\": this.getReadCompletedListByJob,\r \r /**\r * @summary 获取当前人对流程实例的权限。\r * @method getControl\r * @static\r * @return {WorkControl} 流程实例权限对象.\r * &lt;pre>&lt;code class='language-js'>{\r * \"allowVisit\": true, //是否允许访问\r * \"allowProcessing\": true, //是否允许流转\r * \"allowReadProcessing\": false, //是否有待阅\r * \"allowSave\": true, //是否允许保存业务数据\r * \"allowReset\": false, //是否允许重置处理人\r * \"allowRetract\": false, //是否允许撤回\r * \"allowReroute\": false, //是否允许调度\r * \"allowDelete\": true, //是否允许删除流程实例\r * \"allowRollback\": false, //是否允许流程回溯\r * \"allowAddSplit\": false, //是否允许增加分支\r * \"allowPress\": false, //是否允许催办\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * var control = this.workContext.getControl();\r */\r \"getControl\": function(){return ev.control;},\r /**\r * @summary 获取当前流程实例的所有流程记录(WorkLog)。\r * @method getWorkLogList\r * @static\r * @return {WorkLog[]} 流程记录对象.\r * @o2ActionOut x_processplatform_assemble_surface.WorkLogAction.listWithJob\r * @o2syntax\r * var workLogList = this.workContext.getWorkLogList();\r */\r \"getWorkLogList\": function(){return ev.workLogList;},\r /**\r * @summary 获取当前流程实例的所有流程记录(Record)。\r * @method getRecordList\r * @o2ActionOut x_processplatform_assemble_surface.RecordAction.listWithJob\r * @static\r * @return {Record[]} 流程记录(Record)对象.\r * @o2syntax\r * var workLogList = this.workContext.getRecordList();\r */\r \"getRecordList\": function(){return ev.recordList;},\r /**\r * @summary 获取当前流程实例的附件对象列表。\r * @method getAttachmentList\r * @static\r * @return {WorkAttachmentData[]} 附件数据.\r * @o2ActionOut x_processplatform_assemble_surface.AttachmentAction.getWithWorkOrWorkCompleted|example=Attachment\r * @o2syntax\r * var attachmentList = this.workContext.getAttachmentList();\r */\r \"getAttachmentList\": function(){return ev.attachmentList;},\r /**\r * @summary 获取当前待办的可选路由。与task对象中的routeNameList取值相同。\r * @method getRouteList\r * @static\r * @return {String[]} 路由字符串数组.\r * @o2syntax\r * var routeList = this.workContext.getRouteList();\r */\r \"getRouteList\": function(){return (ev.task) ? ev.task.routeNameList: null;},\r \"getInquiredRouteList\": function(){return null;},\r /**\r * @summary 重新设置流程实例标题。。\r * @method setTitle\r * @static\r * @param {String} title - 路由字符串数组.\r * @o2syntax\r * this.workContext.setTitle(title);\r * @example\r * this.workContext.setTitle(\"标题\");\r */\r \"setTitle\": function(title){\r if (!this.workAction){\r MWF.require(\"MWF.xScript.Actions.WorkActions\", null, false);\r this.workAction = new MWF.xScript.Actions.WorkActions();\r }\r this.workAction.setTitle(ev.work.id, {\"title\": title});\r }\r };\r this.workContent = this.workContext;\r var _redefineWorkProperties = function(work){\r if (work){\r work.creatorPersonDn = work.creatorPerson ||\"\";\r work.creatorUnitDn = work.creatorUnit ||\"\";\r work.creatorUnitDnList = work.creatorUnitList ||\"\";\r work.creatorIdentityDn = work.creatorIdentity ||\"\";\r var o = {\r \"creatorPerson\": {\"get\": function(){return this.creatorPersonDn.substring(0, this.creatorPersonDn.indexOf(\"@\"));}},\r \"creatorUnit\": {\"get\": function(){return this.creatorUnitDn.substring(0, this.creatorUnitDn.indexOf(\"@\"));}},\r \"creatorDepartment\": {\"get\": function(){return this.creatorUnitDn.substring(0, this.creatorUnitDn.indexOf(\"@\"));}},\r \"creatorIdentity\": {\"get\": function(){return this.creatorIdentityDn.substring(0, this.creatorIdentityDn.indexOf(\"@\"));}},\r // \"creatorUnitList\": {\r // \"get\": function(){\r // var v = [];\r // this.creatorUnitDnList.each(function(dn){\r // v.push(dn.substring(0, dn.indexOf(\"@\")))\r // });\r // return v;\r // }\r // },\r \"creatorCompany\": {\"get\": function(){\r if (this.creatorUnitLevel){\r var level = this.creatorUnitLevel.split(\"/\");\r return level[0];\r }else{\r return this.creatorUnitDn.substring(0, this.creatorUnitDn.indexOf(\"@\"));\r }\r }}\r };\r MWF.defineProperties(work, o);\r }\r return work;\r };\r var _redefineTaskProperties = function(task){\r if (task){\r task.personDn = task.person || \"\";\r task.unitDn = task.unit || \"\";\r task.unitDnList = task.unitList || \"\";\r task.identityDn = task.identity || \"\";\r var o = {\r \"person\": {\"get\": function(){return this.personDn.substring(0, this.personDn.indexOf(\"@\"));}},\r \"unit\": {\"get\": function(){return this.unitDn.substring(0, this.unitDn.indexOf(\"@\"));}},\r \"department\": {\"get\": function(){return this.unitDn.substring(0, this.unitDn.indexOf(\"@\"));}},\r \"identity\": {\"get\": function(){return this.identityDn.substring(0, this.identityDn.indexOf(\"@\"));}},\r // \"unitList\": {\r // \"get\": function(){\r // var v = [];\r // this.unitDnList.each(function(dn){\r // v.push(dn.substring(0, dn.indexOf(\"@\")))\r // });\r // return v;\r // }\r // },\r \"company\": {\"get\": function(){return this.unitList[0];}}\r };\r MWF.defineProperties(task, o);\r }\r return task;\r };\r _redefineWorkProperties(this.workContext.getWork());\r _redefineTaskProperties(_redefineWorkProperties(this.workContext.getTask()));\r \r \r //dict\r this.Dict = MWF.xScript.createDict(_form.json.application);\r \r //unit\r var orgActions = null;\r var getOrgActions = function(){\r // if (!orgActions){\r // MWF.xDesktop.requireApp(\"Org\", \"Actions.RestActions\", null, false);\r // orgActions = new MWF.xApplication.Org.Actions.RestActions ();\r // }\r if (!orgActions){\r MWF.require(\"MWF.xScript.Actions.UnitActions\", null, false);\r orgActions = new MWF.xScript.Actions.UnitActions();\r }\r };\r var getNameFlag = function(name){\r var t = typeOf(name);\r if (t===\"array\"){\r var v = [];\r name.each(function(id){\r v.push((typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id);\r });\r return v;\r }else{\r return [(t===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name];\r }\r };\r \r \r this.org = {\r //群组***************\r //获取群组--返回群组的对象数组\r /**\r 根据群组标识获取对应的群组对象数组：group对象数组\r */\r getGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r \r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listGroup(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级群组--返回群组的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubGroup: function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data;\r // return v;\r // }.ag().catch(function(json){ return json; });\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listSubGroupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listSubGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // var v = null;\r // if (nested){\r // orgActions.listSubGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSubGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //查询上级群组--返回群组的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupGroup:function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r if (nested){\r var promise = orgActions.listSupGroupNested(data, cb, null, !!async);\r }else{\r var promise = orgActions.listSupGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r // var v = null;\r // if (nested){\r // orgActions.listSupGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSupGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //人员所在群组（嵌套）--返回群组的对象数组\r listGroupWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroupWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listGroupWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r //群组是否拥有角色--返回true, false\r groupHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"group\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.groupHasRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.groupHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r \r //角色***************\r //获取角色--返回角色的对象数组\r getRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listRole(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //人员所有角色（嵌套）--返回角色的对象数组\r listRoleWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listRoleWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r \r //人员***************\r //人员是否拥有角色--返回true, false\r personHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"person\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.personHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r //获取人员--返回人员的对象数组\r getPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listPerson(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级人员--返回人员的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询上级人员--返回人员的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //获取群组的所有人员--返回人员的对象数组\r listPersonWithGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取角色的所有人员--返回人员的对象数组\r listPersonWithRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r promise = orgActions.listPersonWithRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组\r listPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组或人员对象\r getPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员的人员--返回人员的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listPersonWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonWithUnitNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonWithUnitDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的对象数组\r //name string 属性名\r //value string 属性值\r listPersonWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的全称数组\r //name string 属性名\r //value string 属性值\r listPersonNameWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data.personList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttributeValue(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //人员属性************\r //添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r },\r //设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.setPersonAttribute(data, cb, null, !!async);\r },\r //获取人员属性值\r getPersonAttribute: function(person, attr, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"name\":attr,\"person\":personFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getPersonAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所有属性的名称\r listPersonAttributeName: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的所有属性\r listPersonAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //身份**********\r //获取身份\r getIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的身份\r listIdentityWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentityWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员身份--返回身份的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listIdentityWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r \r // var cb = function(json){\r // v = json.data;\r // if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r // return v;\r // }.ag().catch(function(json){ return json; });\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var method = (nested) ? \"listIdentityWithUnitNested\" : \"listIdentityWithUnitDirect\";\r var promise = orgActions[method](data, cb, null, !!async);\r promise.name = \"org\";\r \r //\r // if (nested){\r // orgActions.listIdentityWithUnitNested(data, cb, null, !!async);\r // }else{\r // orgActions.listIdentityWithUnitDirect(data, cb, null, !!async);\r // }\r return (!!async) ? promise : v;\r },\r \r //组织**********\r //获取组织\r getUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织的下级--返回组织的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询组织的上级--返回组织的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r //async 布尔 true异步请求\r listSupUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // if (callback){\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }\r // }else{\r // var v = null;\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r // }\r },\r //根据个人身份获取组织\r //flag 数字 表示获取第几层的组织\r // 字符串 表示获取指定类型的组织\r // 空 表示获取直接所在的组织\r getUnitByIdentity: function(name, flag, async){\r getOrgActions();\r var getUnitMethod = \"current\";\r var v;\r if (flag){\r if (typeOf(flag)===\"string\") getUnitMethod = \"type\";\r if (typeOf(flag)===\"number\") getUnitMethod = \"level\";\r }\r \r var cb;\r var promise;\r switch (getUnitMethod){\r case \"current\":\r var data = {\"identityList\":getNameFlag(name)};\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v; return v;\r // }.ag().catch(function(json){ return json; });\r \r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r \r promise = orgActions.listUnitWithIdentity(data, cb, null, !!async);\r break;\r case \"type\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"type\":flag};\r \r cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndType(data, cb, null, !!async);\r break;\r case \"level\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"level\":flag};\r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndLevel(data, cb, null, !!async);\r break;\r }\r return (!!async) ? promise : v;\r },\r //列出身份所在组织的所有上级组织\r listAllSupUnitWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取人员所在的所有组织\r listUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所在组织的所有上级组织\r listAllSupUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织属性，获取所有符合的组织\r listUnitWithAttribute: function(name, attribute, async){\r getOrgActions();\r var data = {\"name\":name,\"attribute\":attribute};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r promise = orgActions.listUnitWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织职务，获取所有符合的组织\r listUnitWithDuty: function(name, id, async){\r getOrgActions();\r var data = {\"name\":name,\"identity\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织职务***********\r //获取指定的组织职务的身份\r getDuty: function(duty, id, async){\r getOrgActions();\r var data = {\"name\":duty,\"unit\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有职务名称\r listDutyNameWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务名称\r listDutyNameWithUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务\r listUnitAllDuty: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出顶层组织\r listTopUnit: function(async){\r var action = MWF.Actions.get(\"x_organization_assemble_control\");\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = action.listTopUnit(cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织属性**************\r //添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r \r // orgActions.appendUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r orgActions.setUnitAttribute(data, cb, null, !!async);\r \r // orgActions.setUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //获取组织属性值\r getUnitAttribute: function(unit, attr, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"name\":attr,\"unit\":unitFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getUnitAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织所有属性的名称\r listUnitAttributeName: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织的所有属性\r listUnitAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r }\r };\r \r this.Action = (function(){\r var actions = [];\r return function(root, json){\r var action = actions[root] || (actions[root] = new MWF.xDesktop.Actions.RestActions(\"\", root, \"\"));\r action.getActions = function(callback){\r if (!this.actions) this.actions = {};\r Object.merge(this.actions, json);\r if (callback) callback();\r };\r this.invoke = function(option){\r action.invoke(option)\r }\r }\r })();\r \r this.service = {\r \"jaxwsClient\":{},\r \"jaxrsClient\":{}\r };\r \r var lookupAction = null;\r var getLookupAction = function(callback){\r if (!lookupAction){\r MWF.require(\"MWF.xDesktop.Actions.RestActions\", function(){\r lookupAction = new MWF.xDesktop.Actions.RestActions(\"\", \"x_processplatform_assemble_surface\", \"\");\r lookupAction.getActions = function(actionCallback){\r this.actions = {\r //\"lookup\": {\"uri\": \"/jaxrs/view/flag/{view}/application/flag/{application}\"},\r //\"getView\": {\"uri\": \"/jaxrs/view/{id}/design\"}\r \"lookup\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\":\"PUT\"},\r \"getView\": {\"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\"}\r };\r if (actionCallback) actionCallback();\r };\r if (callback) callback();\r });\r }else{\r if (callback) callback();\r }\r };\r \r this.view = {\r \"lookup\": function(view, callback, async){\r var filterList = {\"filterList\": (view.filter || null)};\r MWF.Actions.get(\"x_query_assemble_surface\").loadView(view.view, view.application, filterList, function(json){\r var data = {\r \"grid\": json.data.grid || json.data.groupGrid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }, null, async);\r },\r \r \"lookupV1\": function(view, callback){\r getLookupAction(function(){\r lookupAction.invoke({\"name\": \"lookup\",\"async\": true, \"parameter\": {\"view\": view.view, \"application\": view.application},\"success\": function(json){\r var data = {\r \"grid\": json.data.grid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }.bind(this)});\r }.bind(this));\r },\r \"select\": function(view, callback, options){\r if (view.view){\r var viewJson = {\r \"application\": view.application || _form.json.application,\r \"viewName\": view.view || \"\",\r \"isTitle\": (view.isTitle===false) ? \"no\" : \"yes\",\r \"select\": (view.isMulti===false) ? \"single\" : \"multi\",\r \"filter\": view.filter\r };\r if (!options) options = {};\r options.width = view.width;\r options.height = view.height;\r options.title = view.caption;\r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile){\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x-width)/2;\r var y = (size.y-height)/2;\r if (x&lt;0) x = 0;\r if (y&lt;0) y = 0;\r if (layout.mobile){\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function(){\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x-20,\r \"fromTop\":y,\r \"fromLeft\": x-20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function(){\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function(){this.close();}\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile){\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function(e){\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function(e){\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function(){\r this.view = new MWF.xApplication.query.Query.Viewer(dlg.content.getFirst(), viewJson, {\"style\": \"select\"}, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r this.statement = {\r \"execute\": function (statement, callback, async) {\r var parameter = this.parseParameter(statement.parameter);\r var filterList = this.parseFilter(statement.filter, parameter);\r var obj = {\r \"filterList\": filterList,\r \"parameter\" : parameter\r };\r MWF.Actions.load(\"x_query_assemble_surface\").StatementAction.executeV2(\r statement.name, statement.mode || \"data\", statement.page || 1, statement.pageSize || 20, obj,\r function (json) {\r if (callback) callback(json);\r }, null, async);\r },\r parseFilter : function( filter, parameter ){\r if( typeOf(filter) !== \"array\" )return [];\r var filterList = [];\r ( filter || [] ).each( function (d) {\r var parameterName = d.path.replace(/\\./g, \"_\");\r var value = d.value;\r if( d.comparison === \"like\" || d.comparison === \"notLike\" ){\r if( value.substr(0, 1) !== \"%\" )value = \"%\"+value;\r if( value.substr(value.length-1,1) !== \"%\" )value = value+\"%\";\r parameter[ parameterName ] = value; //\"%\"+value+\"%\";\r }else{\r if( d.formatType === \"dateTimeValue\" || d.formatType === \"datetimeValue\"){\r value = \"{ts '\"+value+\"'}\"\r }else if( d.formatType === \"dateValue\" ){\r value = \"{d '\"+value+\"'}\"\r }else if( d.formatType === \"timeValue\" ){\r value = \"{t '\"+value+\"'}\"\r }\r parameter[ parameterName ] = value;\r }\r d.value = parameterName;\r \r filterList.push( d );\r }.bind(this));\r return filterList;\r },\r parseParameter : function( obj ){\r if( typeOf(obj) !== \"object\" )return {};\r var parameter = {};\r //传入的参数\r for( var p in obj ){\r var value = obj[p];\r if( typeOf( value ) === \"date\" ){\r value = \"{ts '\"+value.format(\"db\")+\"'}\"\r }\r parameter[ p ] = value;\r }\r return parameter;\r },\r \"select\": function (statement, callback, options) {\r if (statement.name) {\r // var parameter = this.parseParameter(statement.parameter);\r // var filterList = this.parseFilter(statement.filter, parameter);\r var statementJson = {\r \"statementId\": statement.name || \"\",\r \"isTitle\": (statement.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (statement.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": statement.filter,\r \"parameter\": statement.parameter\r };\r if (!options) options = {};\r options.width = statement.width;\r options.height = statement.height;\r options.title = statement.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select statement view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.statement.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.statement.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", function () {\r this.statement = new MWF.xApplication.query.Query.Statement(dlg.content.getFirst(), statementJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r \r //include 引用脚本\r //optionsOrName : {\r // type : \"\", 默认为process, 可以为 portal process cms\r // application : \"\", 门户/流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\" // 脚本名称/别名/id\r //}\r //或者name: \"\" // 脚本名称/别名/id\r // if( !window.includedScripts ){\r // var includedScripts = window.includedScripts = [];\r // }else{\r // var includedScripts = window.includedScripts;\r // }\r \r /**\r * this.include是一个方法，当您在流程、门户或者内容管理中创建了脚本配置，可以使用this.include()用来引用脚本配置。&lt;br/>\r * &lt;b>（建议使用表单中的预加载脚本，需要判断加载的时候才使用本方法加载脚本，此时建议异步加载有助于表单加载速度。）&lt;/b>&lt;br/>\r * @module include\r * @o2ordernumber 140\r * @param {(String|Object|String[]|Object[])} optionsOrName 可以是脚本标识字符串（数组）或者是对象（数组）。\r * &lt;pre>&lt;code class='language-js'>\r * //如果需要引用本应用的脚本配置，将options设置为String或者String Array。\r * this.include(\"initScript\") //脚本配置的名称、别名或id\r * this.include([\"initScript\",\"initScript2\"]) //可以是字符串数组\r *\r * //如果需要引用其他应用的脚本配置，将options设置为Object或者Object Array;\r * this.include({\r * //type: 应用类型。可以为 portal process cms。\r * //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。\r * //比如在门户的A应用脚本中引用门户B应用的脚本配置，则type可以省略。\r * type : \"portal\",\r * application : \"首页\", // 门户、流程、CMS的名称、别名、id。 默认为当前应用\r * name : \"initScript\" // 脚本配置的名称、别名或id\r * })\r * this.include([ //也可以对象和字符串混合数组\r * {\r * type : \"portal\",\r * application : \"首页\",\r * name : \"initScript\"\r * },\r * \"initScript2\"\r * ])\r * &lt;/code>&lt;/pre>\r * @param {Function} [callback] 加载后执行的回调方法\r * @param {Boolean} [async] 是否异步加载\r * @o2syntax\r * //您可以在表单、流程、视图和查询视图的各个嵌入脚本中，通过this.include()来引用本应用或其他应用的脚本配置，如下：\r * this.include( optionsOrName, callback, async )\r * @example\r * &lt;caption>\r * &lt;b>样例一：&lt;/b>在通用脚本中定义返回当前人员名称的方法，在各个门户应用都使用这个方法显示人员名称。&lt;br/>\r * 1、在门户应用中有一个commonApp的应用，在该应用中创建一个脚本，命名为initScript，并定义方法。\r * &lt;img src='img/module/include/define1.png' />\r * &lt;/caption>\r * //定义一个方法\r * this.define(\"getUserName\", function(){\r * return ( layout.desktop.session.user || layout.user ).name\r * }.bind(this))\r * @example\r * &lt;caption>\r * 2、在门户页面中添加事件'queryLoad',在事件中引入 initScript 脚本配置。\r * &lt;img src='img/module/include/define2.png' style='max-width:700px;'/>\r * &lt;/caption>\r * this.include({\r * type : \"portal\",\r * application : \"commonApp\",\r * name : \"initScript\"\r * })\r *\r * @example\r * &lt;caption>\r * 3、在门户页面的'load'事件中使用方法。&lt;br/>\r * &lt;img src='img/module/include/define3.png' style='max-width:700px;'/>\r * &lt;/caption>\r * var userNameNode = this.page.get(\"userName\").node; //获取Dom对象\r * var urerName = this.getUserName(); //使用initScript脚本中的方法\r * userNameNode.set(\"text\", urerName ); //为DOM对象设置值\r */\r \r var includedScripts = [];\r var _includeSingle = function( optionsOrName , callback, async){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"process\";\r var application = options.application || _form.json.application;\r var key = type +\"-\" + application + \"-\" + name;\r if (includedScripts.indexOf( key )> -1){\r if (callback) callback.apply(this);\r return;\r }\r //if (includedScripts.indexOf( name )> -1){\r // if (callback) callback.apply(this);\r // return;\r //}\r var scriptAction;\r switch ( type ){\r case \"portal\" :\r if( this.scriptActionPortal ){\r scriptAction = this.scriptActionPortal;\r }else{\r MWF.require(\"MWF.xScript.Actions.PortalScriptActions\", null, false);\r scriptAction = this.scriptActionPortal = new MWF.xScript.Actions.PortalScriptActions();\r }\r break;\r case \"process\" :\r if( this.scriptActionProcess ){\r scriptAction = this.scriptActionProcess;\r }else{\r MWF.require(\"MWF.xScript.Actions.ScriptActions\", null, false);\r scriptAction = this.scriptActionProcess = new MWF.xScript.Actions.ScriptActions();\r }\r break;\r case \"cms\" :\r if( this.scriptActionCMS ){\r scriptAction = this.scriptActionCMS;\r }else{\r MWF.require(\"MWF.xScript.Actions.CMSScriptActions\", null, false);\r scriptAction = this.scriptActionCMS = new MWF.xScript.Actions.CMSScriptActions();\r }\r break;\r }\r \r scriptAction.getScriptByName( application, name, includedScripts, function(json){\r if (json.data){\r includedScripts.push( key );\r \r //名称、别名、id\r json.data.importedList.each( function ( flag ) {\r if( type === \"portal\" ){\r includedScripts.push( type + \"-\" + json.data.portal + \"-\" + flag );\r if( json.data.portalName )includedScripts.push( type + \"-\" + json.data.portalName + \"-\" + flag );\r if( json.data.portalAlias )includedScripts.push( type + \"-\" + json.data.portalAlias + \"-\" + flag );\r }else if( type === \"cms\" ){\r includedScripts.push( type + \"-\" + json.data.appId + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }else if( type === \"process\" ){\r includedScripts.push( type + \"-\" + json.data.application + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }\r });\r includedScripts = includedScripts.concat(json.data.importedList);\r \r MWF.Macro.exec(json.data.text, this);\r if (callback) callback.apply(this);\r }else{\r if (callback) callback.apply(this);\r }\r }.bind(this), null, !!async);\r }\r this.include = function( optionsOrName , callback, async){\r if (o2.typeOf(optionsOrName)==\"array\"){\r if (!!async){\r var count = optionsOrName.length;\r var loaded = 0;\r optionsOrName.each(function(option){\r _includeSingle.apply(this, [option, function(){\r loaded++;\r if (loaded>=count) if (callback) callback.apply(this);;\r }.bind(this), true]);\r }.bind(this));\r \r }else{\r optionsOrName.each(function(option){\r _includeSingle.apply(this, [option]);\r }.bind(this));\r if (callback) callback.apply(this);\r }\r }else{\r _includeSingle.apply(this, [optionsOrName , callback, async])\r }\r };\r \r /**\r * this.define是一个方法，您可以在流程、门户或者内容管理中创建脚本配置，在脚本配置中您可以通过this.define()来定义自己的方法。&lt;br/>\r * 通过这种方式定义方法，在不同的应用使用相同的方法名称也不会造成冲突。\r * @module define\r * @o2ordernumber 150\r * @param {(String)} name 定义的方法名称。\r * @param {Function} fun 定义的方法\r * @param {Boolean} [overwrite] 定义的方法是否能被覆盖重写。默认值为true。\r * @o2syntax\r * this.define(name, fun, overwrite)\r * @example\r * &lt;caption>\r * &lt;b>样例：&lt;/b>在通用脚本中定义返回当前人员名称的方法，在各个门户应用都使用这个方法显示人员名称。&lt;br/>\r * 1、在门户应用中有一个commonApp的应用，在该应用中创建一个脚本，命名为initScript，并定义方法。\r * &lt;img src='img/module/include/define1.png' />\r * &lt;/caption>\r * //定义一个方法\r * this.define(\"getUserName\", function(){\r * return ( layout.desktop.session.user || layout.user ).name\r * }.bind(this))\r * @example\r * &lt;caption>\r * 2、在门户页面中添加事件'queryLoad',在事件中引入 initScript 脚本配置。\r * &lt;img src='img/module/include/define2.png' style='max-width:700px;'/>\r * &lt;/caption>\r * this.include({\r * type : \"portal\",\r * application : \"commonApp\",\r * name : \"initScript\"\r * })\r *\r * @example\r * &lt;caption>\r * 3、在门户页面的'load'事件中使用方法。&lt;br/>\r * &lt;img src='img/module/include/define3.png' style='max-width:700px;'/>\r * &lt;/caption>\r * var userNameNode = this.page.get(\"userName\").node; //获取Dom对象\r * var urerName = this.getUserName(); //使用initScript脚本中的方法\r * userNameNode.set(\"text\", urerName ); //为DOM对象设置值\r */\r this.define = function(name, fun, overwrite){\r var over = true;\r if (overwrite===false) over = false;\r var o = {};\r o[name] = {\"value\": fun, \"configurable\": over};\r MWF.defineProperties(this, o);\r }.bind(this);\r \r //如果前端事件有异步调用，想要在异步调用结束后继续运行页面加载，\r //可在调用前执行 var resolve = this.wait();\r //在异步调用结束后 执行 resolve.cb()；\r //目前只有表单的queryload事件支持此方法。\r \r /**\r * this.wait是一个方法，可以用来处理异步调用时的页面加载。&lt;br/>\r * 该方法使用的具体场景：为了加快速度，需要一次性加载全部外部资源（如：数据字典、外部JS、内容管理文档等）后，再进行表单的加载。&lt;br/>\r * this.wait需和this.goon配合使用。&lt;br/>\r * &lt;b>目前只有流程表单的queryload事件支持此方法。&lt;/b>\r * @module wait\r * @o2range {Process}\r * @o2syntax\r * var resolve = this.wait(); //让表单停止加载页面\r *\r * if (resolve &amp;&amp; resolve.cb){\r * resolve.cb(); //通过 resolve.cb() 方法继续执行表单加载\r * }else{\r * //如果没有发生异步，则resolve.cb方法不存在，\r * //所以在回调中中使用this.goon();使表单继续加载\r * this.goon();\r * }\r * @example\r * &lt;caption>需要在加载数据字典，内容管理文档数据，按照条件获取的脚本后，再进行加载表单。&lt;/caption>\r *\r * var resolve = this.wait(); //this.wait()让表单加载等待回调\r * var scriptLoaded = false; //脚本是否加载完成标识，按条件判断的脚本才建议用this.include(),否则使用预加载脚本更快。\r * var documentLoaded = false; //内容管理文档是否加载完成标识\r * var dictLoaded = true; //数据字典是否加载完成标识\r *\r * //检查是否全部资源已加载，如果是继续加载表单\r * var checkLoad = function(){\r * if (scriptLoaded &amp;&amp; documentLoaded &amp;&amp; dictLoaded){ //各种资源以及加载完成\r * if (resolve &amp;&amp; resolve.cb){\r * resolve.cb(); //通过 resolve.cb() 方法继续执行表单加载\r * }else{\r * //如果没有发生异步，则resolve.cb方法不存在，\r * //所以在回调中中使用this.goon();使表单继续加载\r * this.goon();\r * }\r * }\r * }.bind(this);\r *\r * //判断内容管理文档加载\r * if( this.data.documentId ){\r * //异步载入内容管理文档\r * o2.Actions.get(\"x_cms_assemble_control\").getDocument(this.data.documentId, function (json) {\r * this.form.documentJson = json; //将数据存在this.form上，以便其他地方使用\r * documentLoaded = true; //标记内容管理加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }.bind(this), null, true); //true 为异步加载标志\r * }else{\r * documentLoaded = true; ////标记内容管理加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }\r *\r * //判断脚本加载\r * if( this.data.scriptName ){ //假设scriptName为判断条件\r * //加载脚本\r * this.include( this.data.scriptName, function(){ //第二个参数为异步加载后的回调\r * scriptLoaded = true; //标记脚本加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }, true ); //第三个参数表示异步\r * }else{\r * scriptLoaded = true; ////标记脚本加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }\r *\r * //加载数据字典bulletinDictionary的category数据\r * var dict = new Dict(\"bulletinDictionary\");\r * dict.get(\"category\", function(data){ //成功的回调\r * this.form.bulletinCategory = data; //将数据存在this.form上，以便其他地方使用\r * dictLoaded = true; //标记数据字典加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }.bind(this), function(xhr){ //错误的回调\r * dictLoaded = true; ////标记数据字典加载完成\r * checkLoad(); //检查全部资源是否完成加载\r * }, true //异步执行\r * )\r */\r this.wait = function(){\r var _self = this;\r resolve = {\"cb\": _self.goon.bind(_self)};\r var setResolve = function(callback){\r resolve.cb = callback;\r }.bind(this);\r this.target.event_resolve = setResolve;\r return resolve;\r }\r //和this.wait配合使用，\r //如果没有异步，则resolve.cb方法不存在，\r //所以在回调中中使用this.goon();使表单继续加载\r this.goon = function(){\r this.target.event_resolve = null;\r }\r \r \r //仅前台对象-----------------------------------------\r //form\r \r /**\r * form对象可在流程表单或内容管理表单中可用。（仅前端脚本可用）。\r * @module form\r * @o2range {Process|CMS}\r * @o2ordernumber 40\r * @o2syntax\r * //您可以在流程表单和内容管理的前端脚本中，通过this来获取form对象，如下：\r * var form = this.form;\r */\r this.page = this.form = {\r /**\r * 获取当前表单的基本信息。\r * @method getInfor\r * @static\r * @return {Object} 表单的基本信息.\r * &lt;pre>&lt;code class='language-js'>{\r * \"id\": \"db3b2766-93a1-4058-b522-0edb922bd84f\", //表单ID\r * \"name\": \"报销申请表单\", //表单名称\r * \"alias\": \"报销申请表单\", //表单别名\r * \"description\": \"\", //表单描述\r * \"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\", //应用ID\r * \"lastUpdatePerson\": \"XX@huqi@P\", //最后修改人\r * \"lastUpdateTime\": \"2018-09-30 22:46:30\", //最后修改时间\r * \"icon\": \"...\", //表单图标\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * var form = this.form.getInfor();\r */\r \"getInfor\": function(){return ev.formInfor;},\r \r \"infor\": ev.formInfor,\r \r /**\r * 获取打开当前文档的component对象。平台中每一个窗口应用，就是一个component对象。此处获取到的对象为x_component_process_Work。\r * @method getApp\r * @static\r * @return {x_component_process_Work}打开当前文档的component对象.\r * @o2syntax\r * var app = this.form.getApp();\r * @example\r * var app = this.form.getApp();\r //所有component对象都有以下方法。\r app.openInNewWindow(); //在新窗口中打开当前应用\r app.setCurrent(); //将当前应用设置为激活状态\r app.minSize(); //应用窗口最小化\r app.maxSize(); //应用窗口最大化\r app.restoreSize(); //应用窗口还原\r app.refresh(); //刷新应用\r app.close(); //关闭应用\r app.setTitle(str); //设置应用标题\r app.dialog(option); //弹出一个对话框（详见MWF.widget.Dialog）\r \r //显示一个通知消息\r app.notice(content, type, target, where, offset);\r \r //显示一个确认框\r app.confirm(type, e, title, text, width, height, ok, cancel);\r \r //弹出一个信息框\r app.alert(type, e, title, text, width, height);\r \r //为应用绑定一个事件\r app.addEvent(type, fun);\r */\r \"getApp\": function(){return _form.app;},\r \r \"app\": _form.app,\r \r /**\r * 获取Form对应的DOM对象。\r * @method node\r * @static\r * @return {HTMLDivElement} 当前form对应的div对象.\r * @o2syntax\r * var node = this.form.node();\r */\r \"node\": function(){return _form.node;},\r \r /**\r * 获取表单是否可编辑。只读。\r * @member readonly\r * @static\r * @return {Boolean} 是否只读.\r * @o2syntax\r * var readonly = this.form.readonly;\r */\r \"readonly\": _form.options.readonly,\r \r /**\r * 获取表单元素对象。&lt;br/>\r * &lt;table>\r * &lt;tr>&lt;td>Actionbar(操作条)&lt;/td>&lt;td>Address(地址输入框)&lt;/td>&lt;td>Attachment(附件框)&lt;/td>&lt;td>Button(按钮)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Calendar(日期输入框)&lt;/td>&lt;td>Checkbox(多选按钮)&lt;/td>&lt;td>Combox(组合框)&lt;/td>&lt;td>Datagrid(数据网格)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Div(容器)&lt;/td>&lt;td>Htmleditor(富文本编辑框)&lt;/td>&lt;td>Html(内置html)&lt;/td>&lt;td>Iframe(嵌入Iframe)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Image(图片)&lt;/td>&lt;td>Label(文本)&lt;/td>&lt;td>Log(流程意见)&lt;/td>&lt;td>Monitor(流程监控)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Number(数字输入框)&lt;/td>&lt;td>Office(office控件)&lt;/td>&lt;td>Opinion(意见框)&lt;/td>&lt;td>Org(人员组织选择)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Radio(单选按钮)&lt;/td>&lt;td>Select(选择框)&lt;/td>&lt;td>Sidebar(侧边操作条)&lt;/td>&lt;td>Stat(统计组件)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Subform(子表单)&lt;/td>&lt;td>Tab(分页)&lt;/td>&lt;td>Table(表格)&lt;/td>&lt;td>Textarea(多行输入)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Textfield(文本输入框)&lt;/td>&lt;td>Tree(树状控件)&lt;/td>&lt;td>View(视图组件)&lt;/td>&lt;td>ViewSelector(视图选择组件)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Documenteditor(公文编辑器)&lt;/td>&lt;td>ImageClipper(图片编辑器)&lt;/td>&lt;td>&lt;/td>&lt;td>&lt;/td>&lt;/tr>\r * &lt;/table>\r * @method get\r * @static\r * @return {FormComponent} 请查看本文档的Classes导航下的FormComponents。\r * @param {String} name 字段标识\r * @o2syntax\r * var field = this.form.get(name);\r * @example\r * var field = this.form.get(\"subject\");\r */\r \"get\": function(name){return (_form.all) ? _form.all[name] : null;},\r \r /**\r * 获取表单中可输入的字段元素对象。&lt;br/>\r * &lt;table>\r * &lt;tr>&lt;td>Address(地址输入框)&lt;/td>&lt;td>Attachment(附件框)&lt;/td>&lt;td>Calendar(日期输入框)&lt;/td>&lt;td>Checkbox(多选按钮)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Combox(组合框)&lt;/td>&lt;td>Datagrid(数据网格)&lt;/td>&lt;td>Htmleditor(富文本编辑框)&lt;/td>&lt;td>Number(数字输入框)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Org(人员组织选择)&lt;/td>&lt;td>Radio(单选按钮)&lt;/td>&lt;td>Select(选择框)&lt;/td>&lt;td>Textarea(多行输入)&lt;/td>&lt;/tr>\r * &lt;tr>&lt;td>Textfield(文本输入框)&lt;/td>&lt;td>&lt;/td>&lt;td>&lt;/td>&lt;td>&lt;/td>&lt;/tr>\r * &lt;/table>\r * @method getField\r * @static\r * @return {FormComponent} 请查看本文档的Classes导航下的FormComponents。\r * @param {String} name 字段标识\r * @o2syntax\r * var field = this.form.getField(name);\r * @example\r * var field = this.form.getField(\"subject\");\r */\r \"getField\": function(name){return _forms[name];},\r \r \"getAction\": function(){return _form.workAction},\r \"getDesktop\": function(){return _form.app.desktop},\r \r /**获取业务数据\r * @method getData\r * @static\r * @see module:data\r * @o2syntax\r * var data = this.form.getData();\r * @return {Object} 返回表单绑定的业务数据。\r */\r \"getData\": function(){return new MWF.xScript.JSONData(_form.getData());},\r \r /**保存当前表单所绑定的业务数据。&lt;br/>\r * this.form.save()会触发 beforeSave和afterSave事件，因此在beforeSave和afterSave中不允许使用本方法。\r * @method save\r * @static\r * @param {Function} [callback] - 保存后的回调\r * @param {Boolean} [silent] - 是否静默，否提示保存成功，默认为false\r * @o2syntax\r * this.form.save(callback, silent);\r * @example\r * this.form.save(function(){\r * //do someting\r * }, true);\r */\r \"save\": function(callback, silent){_form.saveWork(callback, silent); },\r \r /**\r *关闭当前表单\r * @method close\r * @static\r * @example\r * this.form.close();\r */\r \"close\": function(){_form.closeWork();},\r \r /**\r *挂起当前待办\r * @method pauseTask\r * @static\r * @example\r * this.form.pauseTask();\r */\r \"pauseTask\": function(){_form.pauseTask();},\r \r /**\r *将待办从挂起状态恢复为正常状态\r * @method resumeTask\r * @static\r * @example\r * this.form.resumeTask();\r */\r \"resumeTask\": function(){_form.resumeTask();},\r \r /**本校验不包括校验意见，校验路由；通常用在弹出提交界面时候的校验\r * @summary 根据表单中所有组件的校验设置和“流转校验”脚本进行校验。\r * @method verify\r * @static\r * @o2syntax\r * this.form.verify()\r * @example\r * if( !this.form.verify() ){\r * return false;\r * }\r * @return {Boolean} 是否通过校验\r */\r \"verify\": function(){\r return !(!_form.formCustomValidation(\"\", \"\") || !_form.formValidation(\"\", \"\"));\r },\r \r \r \r /**对当前表单打开的流程实例进行流转。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 可以通过this.workContext.getControl().allowProcessing来判断当前用户是否有权限进行流转。&lt;br/>\r * this.form.process()会触发 beforeSave、afterSave、beforeProcess、afterProcess事件，因此在上述事件中不允许使用本方法。\r * @method process\r * @static\r * @param {Object} [option] - 流程的相关数据，如果不带此参数，则弹出路由选择和意见填写框&lt;br/>\r * 格式如下：\r &lt;pre>&lt;code class=\"language-js\">\r {\r \"routeName\": \"\", //流转到下一步要选择的路由名称\r \"opinion\": \"\", //流转意见\r \"callback\": function(){} //流转完成后的回调方法\r }\r &lt;/code>&lt;/pre>\r * @example\r //不带参数，弹出路由选择和意见填写框\r this.form.process();\r * @example\r //带参数，流转\r this.form.process({\r \"routeName\": \"送审批\",\r \"opinion\": \"同意\",\r \"callback\": function(json){\r this.form.notice(\"process success\", \"success\");\r }.bind(this)\r });\r */\r \"process\": function(option){\r var op = _form.getOpinion();\r var mds = op.medias;\r if (option){\r _form.submitWork(option.routeName, option.opinion, mds, option.callback,\r option.processor, null, option.appendTaskIdentityList, option.processorOrgList, option.callbackBeforeSave );\r }else{\r _form.processWork();\r }\r },\r \r /**对当前文档的待办重新设定处理人。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 可以通过this.workContext.getControl().allowReset来判断当前用户是否有权限重置处理人。&lt;br/>\r * this.form.reset()会触发 beforeReset、afterReset事件，因此在上述事件中不允许使用本方法。\r * @method reset\r * @static\r * @param {Object} [option] - 进行重置处理人的相关参数，如果不带此参数，弹出重置处理人对话框&lt;br/>\r * 格式如下：\r &lt;pre>&lt;code class=\"language-js\">\r {\r \"names\": \"\", //{Array|String} 要重置给哪些身份\r \"opinion\": \"\", //流转意见\r \"success \": function(){}, //重置成功后的回调方法\r \"failure \": function(){} //重置失败后的回调方法\r }\r &lt;/code>&lt;/pre>\r * @example\r //不带参数，弹出重置处理人对话框\r this.form.reset();\r * @example\r //带参数，直接调用后台服务重置\r this.form.reset({\r \"names\": [\"张三(综合部)\"],\r \"opinion\": \"授权处理\",\r \"success\": function(json){\r this.form.notice(\"reset success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"reset failure:\"+error, \"error\");\r }.bind(this)\r });\r */\r \"reset\": function(option){\r if (!option){\r if (_form.businessData.control[\"allowReset\"]) _form.resetWork();\r }else{\r _form.resetWorkToPeson(option.names, option.opinion, option.keep, option.success, option.failure);\r }\r },\r \r /**撤回文档操作，上一个处理人收回已经流转下去的文件。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 这个操作只允许上一个处理人在流转文件之后，下一个处理人未处理的时候执行。&lt;br/>\r * 可以通过this.workContext.getControl().allowRetract来判断当前用户是否有权限撤回。&lt;br/>\r * this.form.retract()会触发 beforeRetract、afterRetract事件，因此在上述事件中不允许使用本方法。\r * @method retract\r * @static\r * @param {Object} [option] - 进行撤回的相关参数，如果不提供option参数，则弹出撤回对话框。&lt;br/>\r * 格式如下：\r &lt;pre>&lt;code class=\"language-js\">\r {\r \"success \": function(){}, //撤回成功后的回调方法\r \"failure \": function(){} //撤回失败后的回调方法\r }\r &lt;/code>&lt;/pre>\r * @example\r //不带参数，则弹出撤回对话框\r this.form.retract();\r * @example\r //带参数，直接调用后台服务撤回\r this.form.retract({\r \"success\": function(json){\r this.form.notice(\"retract success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"retract failure: \"+error, \"error\");\r }.bind(this)\r });\r */\r \"retract\": function(option){\r if (!option){\r if (_form.businessData.control[\"allowRetract\"]) _form.retractWork();\r }else{\r _form.doRetractWork(option.success, option.failure);\r }\r },\r \r /**在已拆分的工作上添加分支。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 可以通过this.workContext.getControl().allowAddSplit来判断当前用户是否有权限。&lt;br/>\r * @method addSplit\r * @static\r * @param {Object} [option] - 添加分支的相关参数，如果不提供option参数，则弹出添加分支对话框。&lt;br/>\r * 格式如下：\r &lt;pre>&lt;code class=\"language-js\">\r {\r \"value\" : [], //splitValueList 添加的拆分值，拆分值取决于流程拆分节点的设置\r \"trimExist\" : true, //排除已经存在的拆分值.\r \"success \": function(){}, //执行成功后的回调方法\r \"failure \": function(){} //执行失败后的回调方法\r }\r &lt;/code>&lt;/pre>\r * @example\r //不带参数，则弹出添加分支对话框\r this.form.addSplit();\r * @example\r //带参数，直接添加分支\r this.form.addSplit({\r \"value\" : [\"开发部@kfb@U\"],\r \"trimExist\" : true,\r \"success\": function(json){\r this.form.notice(\"addSplit success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"addSplit failure: \"+error, \"error\");\r }.bind(this)\r });\r */\r \"addSplit\": function(option){\r if (!option){\r if (_form.businessData.control[\"allowAddSplit\"]) _form.addSplit();\r }else{\r _form.addSplitWork(option.value, option.trimExist, option.success, option.failure);\r }\r },\r \r \r \"rollback\": function(option){\r if (!option){\r if (_form.businessData.control[\"allowRollback\"]) _form.rollback();\r }else{\r _form.doRollbackActionInvoke(option.log, option.flow, option.success, option.failure);\r }\r },\r \r /**删除当前工作文档。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 可以通过this.workContext.getControl().allowDeleteWork来判断当前用户是否有权限删除文档。&lt;br/>\r * @method deleteWork\r * @static\r * @param {Object} [option] - 删除相关参数，如果不提供option参数，则弹出删除对话框。&lt;br/>\r * 格式如下：\r &lt;pre>&lt;code class=\"language-js\">\r {\r \"success \": function(){}, //执行成功后的回调方法\r \"failure \": function(){} //执行失败后的回调方法\r }\r &lt;/code>&lt;/pre>\r * @example\r //不带参数，则弹出删除提示对话框\r this.form.deleteWork();\r * @example\r //带参数，直接调用服务删除\r this.form.deleteWork({\r \"success\": function(json){\r this.form.notice(\"deleteWork success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"deleteWork failure: \"+error, \"error\");\r }.bind(this)\r });\r */\r \"deleteWork\": function(option){\r if (!option){\r if (_form.businessData.control[\"allowDelete\"]) _form.deleteWork();\r }else{\r _form.doDeleteWork(option.success, option.failure);\r }\r },\r \r /**弹出一个确认框，带确认和关闭按钮\r * @method confirm\r * @static\r * @param {String} type - 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告\r * @param {String} title - 确认框标题栏显示文本。\r * @param {String} text - 确认框的内容显示文本。\r * @param {Number} width - 确认框的宽度。\r * @param {String} height - 确认框的高度。\r * @param {Function} ok - 点击“确定”按钮后的回调函数。\r * @param {Function} cancel - 点击“取消”按钮后的回调函数。\r * @example\r this.form.confirm(\"wran\", \"删除确认\", \"您确定要删除吗？\", 300, 100,function(){\r //执行删除代码\r this.close();\r }, function(){\r this.close();\r });\r */\r \"confirm\": function(type, title, text, width, height, ok, cancel, callback, mask, style){\r if ((arguments.length&lt;=1) || o2.typeOf(arguments[1])===\"string\"){\r var p = MWF.getCenter({\"x\": width, \"y\": height});\r e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }else{\r e = (arguments.length>1) ? arguments[1] : null;\r title = (arguments.length>2) ? arguments[2] : null;\r text = (arguments.length>3) ? arguments[3] : null;\r width = (arguments.length>4) ? arguments[4] : null;\r height = (arguments.length>5) ? arguments[5] : null;\r ok = (arguments.length>6) ? arguments[6] : null;\r cancel = (arguments.length>7) ? arguments[7] : null;\r callback = (arguments.length>8) ? arguments[8] : null;\r mask = (arguments.length>9) ? arguments[9] : null;\r style = (arguments.length>10) ? arguments[10] : null;\r \r // var p = MWF.getCenter({\"x\": width, \"y\": height});\r // e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }\r },\r \r /**弹出一个带关闭按钮的信息框\r * @method alert\r * @static\r * @param {String} type - 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告\r * @param {String} title - 信息框标题栏显示文本。\r * @param {String} text - 信息框的内容显示文本。\r * @param {Number} width - 信息框宽度。\r * @param {String} height - 信息框的高度。\r * @example\r this.form.alert(\"wran\", \"必填提醒\", \"请填写标题！\", 300, 100);\r */\r \"alert\": function(type, title, text, width, height){\r _form.alert(type, title, text, width, height);\r },\r \r /**弹出一个提示框\r * @method notice\r * @static\r * @param {String} content - 要显示的信息文本\r * @param {String} [type] - 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告\r * @param {Element} [target] - 信息框显示位置的参考DOM对象。\r * @param {Object} [where] - 信息框显示相对于target的x轴和y轴位置。&lt;br/>\r * 如： {\"x\": \"center\", \"y\": \"center\"}&lt;br/>\r x : &lt;br/>\r 　水平位置，可用“left”、“right”和“center”；可以用数组定义外部（outside）位置和内部（inside）位置，如：['right', 'inside']&lt;br/>\r y :&lt;br/>\r 　垂直位置，可用“top”、“bottom”和“center”；可以用数组定义外部（outside）位置和内部（inside）位置，如：['top', 'outside']。\r * @param {Object} [offset] - 相对位置的偏移量，允许负值。如：{\"x\": 10, \"y\": -10}\r * @param {Object} [option] - 其他选项。如： { delayClose: 5000 } 在5秒后关闭\r * @example\r this.form.notice(\"this is my information\", \"info\");\r */\r \"notice\": function(content, type, target, where, offset, option){\r _form.notice(content, type, target, where, offset, option);\r },\r \r /**给表单添加事件。\r * @method addEvent\r * @static\r * @param {String} type - 事件名称，参考本API Classer->FormComponents->Form的事件\r * @param {Function} event - 事件方法。\r * @example\r this.form.addEvent(\"load\", function(){\r this.form.notice(\"表单载入完成\", \"success\");\r }.bind(this));\r */\r \"addEvent\": function(type, event ){_form.addEvent(type, event );},\r \r /**用一个新的浏览器窗口来打开当前文档，用于打印。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * 如不指定表单，则使用表单设计中指定的打印表单。&lt;br/>\r * @method print\r * @static\r * @param {String} [application] - 指定表单所在的流程应用ID或名称。省略此参数表示当前应用。\r * @param {String} [form] - 指定表单ID或名称。\r * @example\r //在新窗口中使用当前表单中配置的打印表单打开当前文档\r this.form.print();\r * @example\r //在新窗口中使用“订单打印表单”表单打开当前文档\r this.form.print(\"订单打印表单\");\r * @example\r //在新窗口中使用“订单管理”应用中的“订单打印表单”表单打开当前文档\r this.form.print(\"订单管理\", \"订单打印表单\");\r */\r \"print\": function(application, form){\r if (arguments.length){\r var app = (arguments.length>1) ? arguments[0] : null;\r var formName = (arguments.length>1) ? arguments[1] : arguments[0];\r _form.printWork(app, formName);\r }else{\r _form.printWork();\r }\r },\r \r /**同print方法。&lt;b>（仅流程表单中可用）&lt;/b>&lt;br/>\r * @method openWindow\r * @static\r * @see this.form.print()\r * @param {String} [application] - 指定表单所在的流程应用ID或名称。省略此参数表示当前应用。\r * @param {String} [form] - 指定表单ID或名称。\r * @example\r this.form.openWindow();\r */\r \"openWindow\": function(application, form){\r if (arguments.length){\r var app = (arguments.length>1) ? arguments[0] : null;\r var formName = (arguments.length>1) ? arguments[1] : arguments[0];\r _form.openWindow(formName, app);\r }else{\r _form.openWindow();\r }\r },\r \r /**　打开一个在流转或已完成的流程实例。&lt;br/>\r * @method openWork\r * @static\r * @param {String} [workId] - 在流转的流程实例ID。workId和workCompletedId两个参数必须提供其中一个\r * @param {String} [workCompletedId] - 已完成的流程实例ID。\r * @param {String} [title] - 手机端打开时的窗口标题。\r * @example\r this.form.openWork(id, \"\", \"work title\");\r */\r \"openWork\": function(workId, workCompletedId, title, options){\r var op = options || {};\r op.workId = workId;\r op.workCompletedId = workCompletedId;\r op.docTitle = title;\r op.appId = \"process.Work\"+(op.workId || op.workCompletedId);\r return layout.desktop.openApplication(this.event, \"process.Work\", op);\r },\r \r /**　使用流程的jobId打开工作。&lt;br/>\r * @method openJob\r * @static\r * @param {String} id - 流程的jobId，如果流程拆分后，有多个流程实例（workId会有多个），但jobId是唯一的。\r * @param {Boolean} [choice] - 如果有多个流程实例，是否弹出界面选择。如果传入false,则直接打开第一个工作。\r * @example\r this.form.openJob(jobId, true);\r */\r \"openJob\": function(id, choice, options){\r var workData = null;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listWorkByJob(id, function(json){\r if (json.data) workData = json.data;\r }.bind(this), null, false);\r \r if (workData){\r var len = workData.workList.length + workData.workCompletedList.length;\r if (len){\r if (len>1 &amp;&amp; choice){\r var node = new Element(\"div\", {\"styles\": {\"padding\": \"20px\", \"width\": \"500px\"}}).inject(_form.node);\r workData.workList.each(function(work){\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\"+o2.LP.widget.open+\"&lt;/div>&lt;/div>\"+\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\"+work.title+\"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.activityName+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.activityArrivedTime+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+(work.manualTaskIdentityText || \"\")+\"&lt;/div>&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function(e){\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(work.id, null, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r workData.workCompletedList.each(function(work){\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\"+o2.LP.widget.open+\"&lt;/div>&lt;/div>\"+\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\"+work.title+\"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+o2.LP.widget.workcompleted+\"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\"+work.completedTime+\"&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function(e){\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(null, work.id, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r var height = node.getSize().y+20;\r if (height>600) height = 600;\r \r var dlg = o2.DL.open({\r \"title\": o2.LP.widget.choiceWork,\r \"style\" : \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\" : \"cancel\",\r \"text\": o2.LP.widget.close,\r \"action\": function(){dlg.close();}\r }\r ]\r });\r }else{\r if (workData.workList.length){\r var work = workData.workList[0];\r return this.openWork(work.id, null, work.title, options);\r }else{\r var work = workData.workCompletedList[0];\r return this.openWork(null, work.id, work.title, options);\r }\r }\r }\r }\r // var op = options || {};\r // op.workId = id;\r // op.workCompletedId = completedId;\r // op.docTitle = title;\r // op.appId = \"process.Work\"+(op.workId || op.workCompletedId);\r // layout.desktop.openApplication(this.event, \"process.Work\", op);\r },\r \r /**　打开一个内容管理文档。&lt;br/>\r * @method openDocument\r * @static\r * @param {String} id - 内容管理文档实例的ID。\r * @param {Boolean} [title] - 手机APP端打开时的窗口标题。\r * @param {Object} [options] - 其他参数，内容如下&lt;br>\r * &lt;pre>&lt;code class=\"language-js\">{\r * \"readonly\": true, //是否以只读方式打开，默认为true\r * \"forceFormId\": \"xxxxxx\", //不管编辑还是阅读都用此表单id打开，优先使用。6.0版本之前使用 printFormId。\r * \"readFormId\": \"xxxxxx\", //强制的阅读表单id，优先于表单的readFormId。6.0版本之前使用 formId。\r * \"editFormId\": \"xxxxxx\", //强制的编辑表单id，优先于表单的formId。6.0版本之前使用 formEditId。\r * \"saveOnClose\" : true, //关闭的时候是否自动保存\r * \"onPostPublish\" : function( documentData ){ //发布前执行方法，但数据已经准备好\r * //documentData 为文档数据\r * },\r * \"onAfterPublish\" : function( form, documentData ){ //发布后执行的方法\r * //form为内容管理Form对象，documentData 为文档数据\r * },\r * \"onPostDelete\" : function(){ //删除文档后执行的方法\r * }\r * }&lt;/code>&lt;/pre>\r * @example\r this.form.openDocument(id, \"document title\");\r */\r \"openDocument\": function(id, title, options){\r var op = options || {};\r op.documentId = id;\r op.docTitle = title;\r layout.desktop.openApplication(this.event, \"cms.Document\", op);\r },\r \r /**打开一个门户页面。&lt;br/>\r * @method openPortal\r * @static\r * @param {String} portal - 要打开的门户应用名称、别名或ID。\r * @param {String} [page] - 要打开的页面名称、别名或ID。如果忽略，则打开门户的默认首页\r * @param {Object} [par] - 打开页面可以传入参数。&lt;br>在被打开的页面中，可以通过脚本this.page.parameters访问到此参数。\r * @example\r this.form.openPortal(id, \"\", {\"type\": \"my type\"});\r */\r \"openPortal\": function (portal, page, par) {\r var action = MWF.Actions.get(\"x_portal_assemble_surface\");\r action.getApplication(portal, function (json) {\r if (json.data) {\r if (page) {\r action.getPageByName(page, json.data.id, function (pageJson) {\r var pageId = (pageJson.data) ? pageJson.data.id : \"\";\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"pageId\": pageId,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id + pageId)\r })\r });\r } else {\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id)\r })\r }\r }\r \r });\r },\r \r \r /**打开一个内容管理栏目（应用）。&lt;br/>\r * @method openCMS\r * @static\r * @param {String} name - 内容管理栏目的名称、别名或ID。\r * @example\r this.form.openCMS(\"通知公告\");\r */\r \"openCMS\": function(name){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r action.getColumn(name, function(json){\r if (json.data){\r layout.desktop.openApplication(null, \"cms.Module\", {\r \"columnId\": json.data.id,\r \"appId\": \"cms.Module\"+json.data.id\r });\r }\r });\r },\r \r /**打开一个流程应用。&lt;br/>\r * @method openProcess\r * @static\r * @param {String} name - 流程应用的名称、别名或ID。\r * @example\r this.form.openProcess(\"财务审批\");\r */\r \"openProcess\": function(name){\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r action.getApplication(name, function(json){\r if (json.data){\r layout.desktop.openApplication(null, \"process.Application\", {\r \"id\": json.data.id,\r \"appId\": \"process.Application\"+json.data.id\r });\r }\r });\r },\r \r /**打开任意一个component应用。&lt;br/>\r * @method openApplication\r * @static\r * @param {String} name - 要打开的component的名称。component对应的名称可以在“控制面板-系统设置-界面设置-模块部署”中找到（即“组件路径”）。\r * @param {Object} [options] - 打开的component的相关参数\r * @example\r //打开会议管理\r this.form.openApplication(\"Meeting\");\r * @example\r //打开一个流转中的流程实例。与 this.form.openWork(id, \"\", \"work title\");效果相同\r this.form.openApplication(\"process.Work\", {\r \"workId\": id, //流程实例ID\r \"width\": \"1200\", //宽度\r \"height\": \"800\", //高度\r \"docTitle\": \"work title\", //APP端窗口标题\r \"appId\": \"process.Work\"+id //给新打开的component实例一个唯一名称\r });\r */\r \"openApplication\":function(name, options){\r layout.desktop.openApplication(null, name, options);\r },\r \r /**创建一条内容管理文档。\r * @method createDocument\r * @static\r * @param {(String|Object)} [columnOrOptions]\r * 如果不传参数，则弹出范围为平台所有栏目的选择界面。&lt;br/>\r * 当使用String时为内容管理应用（栏目）的名称、别名或ID。&lt;br/>\r * 当使用Object时，本参数后面的参数省略，传入如下格式的内容:\r * &lt;pre>&lt;code class=\"language-js\">{\r * \"column\" : column, //（string）可选，内容管理应用（栏目）的名称、别名或ID\r * \"category\" : category, //（string）可选，要创建的文档所属的分类的名称、别名或ID\r * \"data\" : data, //（json object）可选，创建文档时默认的业务数据\r * \"identity\" : identity, //（string）可选，创建文档所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。\r * \"callback\" : callback, //（funcation）可选，文档创建后的回调函数。\r * \"target\" : target, //（boolean）可选，为true时，在当前页面打开创建的文档；否则打开新窗口。默认false。\r * \"latest\" : latest, //（boolean）可选，为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。\r * \"selectColumnEnable\" : selectColumnEnable, //（boolean）可选，是否可以选择应用和分类进行创建文档。有category参数时为默认false,否则默认为true。\r * \"ignoreTitle\" : ignoreTitle //（boolean）可选，值为false时，创建的时候需要强制填写标题，默认为false。\r * }&lt;/code>&lt;/pre>\r * @param {String} [category] - 要创建的文档所属的分类的名称、别名或ID\r * @param {Object} [data] - 创建文档时默认的业务数据\r * @param {String} [identity] - 可选，创建文档所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。\r * @param {Function} [callback] - 文档创建后的回调函数\r * @param {Boolean} [target] - 为true时，在当前页面打开创建的文档；否则打开新窗口。默认false\r * @param {Boolean} [latest] - 为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。\r * @param {Boolean} [selectColumnEnable] - 为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。\r * @param {Boolean} [ignoreTitle] - 值为false时，创建的时候需要强制填写标题，默认为false。\r * @example\r //启动一个通知公告\r this.form.createDocument(\"\", \"通知公告\");\r * @example\r //启动一个通知公告，标题为：关于XX的通知，启动后提示\r this.form.createDocument(\"\", \"通知公告\", {\"subject\": \"关于XX的通知\"}, function(json){\r this.form.notice(\"创建成功!\", \"success\");\r }.bind(this));\r * @example\r //启动一个通知公告，标题为：关于XX的通知，启动后提示\r this.form.createDocument({\r category : \"通知公告\",\r data : {\"subject\": \"关于XX的通知\"},\r callback : function(json){\r this.form.notice(\"创建成功!\", \"success\");\r }.bind(this)\r });\r */\r \"createDocument\": function (columnOrOptions, category, data, identity, callback, target, latest, selectColumnEnable, ignoreTitle) {\r var column = columnOrOptions;\r var onAfterPublish, onPostPublish;\r if (typeOf(columnOrOptions) == \"object\") {\r column = columnOrOptions.column;\r category = columnOrOptions.category;\r data = columnOrOptions.data;\r identity = columnOrOptions.identity;\r callback = columnOrOptions.callback;\r target = columnOrOptions.target;\r latest = columnOrOptions.latest;\r selectColumnEnable = columnOrOptions.selectColumnEnable;\r ignoreTitle = columnOrOptions.ignoreTitle;\r onAfterPublish = columnOrOptions.onAfterPublish;\r onPostPublish = columnOrOptions.onPostPublish;\r }\r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r layout.app.content.empty();\r layout.app = null;\r }\r }\r \r MWF.xDesktop.requireApp(\"cms.Index\", \"Newer\", function () {\r var starter = new MWF.xApplication.cms.Index.Newer(null, null, _form.app, null, {\r \"documentData\": data,\r \"identity\": identity,\r \r \"ignoreTitle\": ignoreTitle === true,\r \"ignoreDrafted\": latest === false,\r \"selectColumnEnable\": !category || selectColumnEnable === true,\r \"restrictToColumn\": !!category &amp;&amp; selectColumnEnable !== true,\r \r \"categoryFlag\": category, //category id or name\r \"columnFlag\": column, //column id or name,\r \"onStarted\": function (documentId, data) {\r if (callback) callback();\r },\r \"onPostPublish\": function () {\r if(onPostPublish)onPostPublish();\r },\r \"onAfterPublish\": function () {\r if(onAfterPublish)onAfterPublish();\r }\r });\r starter.load();\r })\r },\r \r /**启动一个流程实例。&lt;br/>\r * @method startProcess\r * @static\r * @param {String} app - 流程应用的名称、别名或ID。\r * @param {String} process - 要启动的流程的名称、别名或ID。\r * @param {Object} [data] - 流程启动时默认的业务数据。\r * @param {String} [identity] - 流程启动所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。\r * @param {Function} [callback] - 流程启动后的回调函数。\r * @param {Boolean} [target] - 为true时，在当前页面打开启动的流程实例；否则打开新窗口。默认false。\r * @param {Boolean} [latest] - 为true时，如果当前用户已经创建了此流程的实例，并且没有流转过，直接调用此实例为新流程实例；否则创建一个新实例。默认false。\r * @example\r //启动一个发文管理实例\r this.form.startProcess(\"公文管理\", \"发文管理\");\r * @example\r //启动一个发文管理实例，标题为：my file title，启动后提示\r this.form.startProcess(\"公文管理\", \"发文管理\", {\"title\": \"my file title\"}, function(json){\r this.form.notice(\"create file success!\", \"success\");\r });\r */\r \"startProcess\": function(app, process, data, identity, callback, target, latest){\r if (arguments.length>2){\r for (var i=2; i&lt;arguments.length; i++){\r if (typeOf(arguments[i])==\"boolean\"){\r target = arguments[i];\r break;\r }\r }\r }\r \r if (target){\r if (layout.app &amp;&amp; layout.app.inBrowser){\r //layout.app.content.empty();\r layout.app.$openWithSelf = true;\r }\r }\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\").getProcessByName(process, app, function(json){\r if (json.data){\r MWF.xDesktop.requireApp(\"process.TaskCenter\", \"ProcessStarter\", function(){\r var starter = new MWF.xApplication.process.TaskCenter.ProcessStarter(json.data, _form.app, {\r \"workData\": data,\r \"identity\": identity,\r \"latest\": latest,\r \"onStarted\": function(data, title, processName){\r if (data.work){\r var work = data.work;\r var options = {\"draft\": work, \"appId\": \"process.Work\"+(new o2.widget.UUID).toString(), \"desktopReload\": false};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{\r var currentTask = [];\r data.each(function(work){\r if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r }.bind(this));\r \r if (currentTask.length==1){\r var options = {\"workId\": currentTask[0], \"appId\": currentTask[0]};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{}\r }\r \r if (callback) callback(data);\r }.bind(this)\r });\r starter.load();\r }.bind(this));\r }\r });\r }\r };\r /**\r * 在用户提交的时候，选择的路由。仅在表单的“校验意见”和“校验路由”脚本中可用。只读。&lt;b>（仅流程表单中可用）&lt;/b>。\r * @member currentRouteName\r * @memberOf module:form\r * @static\r * @return {String} 用户选择的路由。\r * @o2syntax\r * var currentRouteName = this.form.currentRouteName;\r */\r this.form.currentRouteName = _form.json.currentRouteName;\r \r /**\r * 在用户提交的时候，输入的意见。仅在表单的“校验意见”和“校验路由”脚本中可用。只读。&lt;b>（仅流程表单中可用）&lt;/b>。\r * @member opinion\r * @memberOf module:form\r * @static\r * @return {String} 用户填写的意见.\r * @o2syntax\r * var opinion = this.form.opinion;\r */\r this.form.opinion = _form.json.opinion;\r \r /**\r * 在提交的时候，用户的手写意见以及录音意见，仅在表单的“校验意见”和“校验路由”脚本中可用。只读。&lt;b>（仅流程表单中可用）&lt;/b>。\r * @member medias\r * @memberOf module:form\r * @static\r * @return {Blob[]} 手写意见以及录音意见数组。手写意见和录音意见都是 HTML5的blob类型文件。\r * @o2syntax\r * var medias = this.form.medias;\r */\r this.form.medias = [];\r \r this.target = ev.target;\r this.event = ev.event;\r this.status = ev.status;\r \r \r this.session = layout.desktop.session;\r this.Actions = o2.Actions;\r \r this.query = function(option){\r // options = {\r // \"name\": \"statementName\",\r // \"data\": \"json data\",\r // \"firstResult\": 1,\r // \"maxResults\": 100,\r // \"success\": function(){},\r // \"error\": function(){},\r // \"async\": true or false, default is true\r // }\r if (option){\r var json = (option.data) || {};\r if (option.firstResult) json.firstResult = option.firstResult.toInt();\r if (option.maxResults) json.maxResults = option.maxResults.toInt();\r o2.Actions.get(\"x_query_assemble_surface\").executeStatement(option.name, json, success, error, options.async);\r }\r }\r this.Table = MWF.xScript.createTable();\r };\r \r MWF.xScript.createTable = function(){\r return function(name){\r this.name = name;\r this.action = o2.Actions.get(\"x_query_assemble_surface\");\r \r this.listRowNext = function(id, count, success, error, async){\r this.action.listRowNext(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowSelectWhere = function(where, success, error, async){\r this.action.listRowSelectWhere(this.name, where, success, error, async);\r };\r this.listRowCountWhere = function(where, success, error, async){\r this.action.listRowCountWhere(this.name, where, success, error, async);\r };\r this.deleteRow = function(id, success, error, async){\r this.action.deleteRow(this.name, id, success, error, async);\r };\r this.deleteAllRow = function(success, error, async){\r this.action.deleteAllRow(this.name, success, error, async);\r };\r this.getRow = function(id, success, error, async){\r this.action.getRow(this.name, id, success, error, async);\r };\r this.insertRow = function(data, success, error, async){\r this.action.insertRow(this.name, data, success, error, async);\r };\r this.updateRow = function(id, data, success, error, async){\r this.action.updateRow(this.name, id, data, success, error, async);\r };\r }\r };\r \r \r MWF.xScript.JSONData = function(data, callback, key, parent, _form){\r var getter = function(data, callback, k, _self){\r return function(){return ([\"array\",\"object\"].indexOf(typeOf(data[k]))===-1) ? data[k] : new MWF.xScript.JSONData(data[k], callback, k, _self, _form);};\r };\r var setter = function(data, callback, k, _self){\r return function(v){\r \r data[k] = v;\r //debugger;\r //this.add(k, v, true);\r if (callback) callback(data, k, _self);\r }\r };\r var define = function(){\r var o = {};\r for (var k in data) o[k] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, k, this]),\"set\": setter.apply(this, [data, callback, k, this])};\r o[\"length\"] = {\"get\": function(){return Object.keys(data).length;}};\r o[\"some\"] = {\"get\": function(){return data.some;}};\r MWF.defineProperties(this, o);\r \r var methods = {\r \"getKey\": {\"value\": function(){ return key; }},\r \"getParent\": {\"value\": function(){ return parent; }},\r \"toString\": {\"value\": function() { return data.toString();}},\r \"setSection\": {\"value\": function(newKey, newValue){\r this.add(newKey, newValue, true);\r try {\r var path = [this.getKey()];\r p = this.getParent();\r while (p &amp;&amp; p.getKey()){\r path.unshift(p.getKey());\r p = p.getParent();\r }\r if (path.length) _form.sectionListObj[path.join(\".\")] = newKey;\r }catch(e){\r \r }\r }},\r \r \"add\": {\"value\": function(newKey, newValue, overwrite){\r var flag = true;\r var type = typeOf(data);\r if (type===\"array\"){\r if (arguments.length&lt;2){\r data.push(newKey);\r newValue = newKey;\r newKey = data.length-1;\r }else{\r if (!newKey &amp;&amp; newKey!==0){\r data.push(newValue);\r newKey = data.length-1;\r }else{\r flag = false;\r }\r }\r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else if (type===\"object\"){\r if (!this.hasOwnProperty(newKey)){\r data[newKey] = newValue;\r \r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else{\r if (overwrite) this[newKey] = newValue;\r }\r }\r \r return this[newKey];\r }},\r \"del\": {\"value\": function(delKey){\r if (!this.hasOwnProperty(delKey)) return null;\r // delete data[delKey];\r // delete this[delKey];\r data[delKey] = \"\";\r this[delKey] = \"\";\r return this;\r }}\r };\r MWF.defineProperties(this, methods);\r \r \r \r \r //this.getKey = function(){ return key; };\r //this.getParent = function(){ return parent; };\r //this.toString = function() { return data.toString();};\r //this.add = function(newKey, newValue, overwrite){\r // var flag = true;\r // var type = typeOf(data);\r // if (!this.hasOwnProperty(newKey)){\r // if (type==\"array\"){\r // if (arguments.length&lt;2){\r // data.push(newKey);\r // newValue = newKey;\r // newKey = data.length-1;\r // }else{\r // debugger;\r // if (!newKey &amp;&amp; newKey!=0){\r // data.push(newValue);\r // newKey = data.length-1;\r // }else{\r // flag == false;\r // }\r // }\r // }else{\r // data[newKey] = newValue;\r // }\r // //var valueType = typeOf(newValue);\r // //var newValueData = newValue;\r // //if (valueType==\"object\" || valueType==\"array\") newValueData = new MWF.xScript.JSONData(newValue, callback, newKey, this);\r // //if (valueType==\"null\") newValueData = new MWF.xScript.JSONData({}, callback, newKey, this);\r // if (flag){\r // var o = {};\r // o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r // MWF.defineProperties(this, o);\r // }\r // this[newKey] = newValue;\r // }else{\r // if (overwrite) this[newKey] = newValue;\r // }\r //\r // //var valueType = typeOf(newValue);\r // //var newValueData = newValue;\r // //if (valueType==\"object\" || valueType==\"array\") newValueData = new MWF.xScript.JSONData(newValue, callback, newKey, this);\r // //if (valueType==\"null\") newValueData = new MWF.xScript.JSONData({}, callback, newKey, this);\r // //\r // //this[newKey] = newValueData;\r //\r // return this[newKey];\r //};\r //this.del = function(delKey){\r // if (!this.hasOwnProperty(delKey)) return null;\r // delete data[newKey];\r // delete this[newKey];\r // return this;\r //};\r };\r var type = typeOf(data);\r if (type===\"object\" || type===\"array\") define.apply(this);\r };\r \r //MWF.xScript.createDict = function(application){\r // return function(name){\r // var applicationId = application;\r // this.name = name;\r // //MWF.require(\"MWF.xScript.Actions.DictActions\", null, false);\r // var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r //\r // this.get = function(path, success, failure){\r // debugger;\r // var value = null;\r // if (path){\r // var arr = path.split(/\\./g);\r // var ar = arr.map(function(v){\r // return encodeURIComponent(v);\r // });\r // //var p = path.replace(/\\./g, \"/\");\r // var p = ar.join(\"/\");\r // action.getDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r // value = json.data;\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r // }else{\r // action.getDictRoot(encodeURIComponent(this.name), applicationId, function(json){\r // value = json.data;\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r // }\r //\r // return value;\r // };\r //\r // this.set = function(path, value, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.setDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this.add = function(path, value, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.addDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this[\"delete\"] = function(path, success, failure){\r // var p = path.replace(/\\./g, \"/\");\r // action.deleteDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r // if (success) success(json.data);\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // });\r // };\r // this.destory = this[\"delete\"];\r // }\r //};\r // var dictLoaded = {};\r if( !MWF.xScript.dictLoaded )MWF.xScript.dictLoaded = {};\r \r MWF.xScript.addDictToCache = function ( options, path, json ) {\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var type = options.appType || \"process\";\r var enableAnonymous = options.enableAnonymous || false;\r \r var appFlagList = [];\r if( options.application )appFlagList.push( options.application );\r if( options.appId )appFlagList.push( options.appId );\r if( options.appName )appFlagList.push( options.appName );\r if( options.appAlias )appFlagList.push( options.appAlias );\r \r var dictFlagList = [];\r if( options.id )dictFlagList.push( options.id );\r if( options.name )dictFlagList.push( options.name );\r if( options.alias )dictFlagList.push( options.alias );\r \r var cache = {};\r cache[path] = json;\r \r for( var i=0; i&lt;appFlagList.length; i++ ){\r for( var j=0; j&lt;dictFlagList.length; j++ ){\r var k = dictFlagList[j] + type + appFlagList[i] + enableAnonymous;\r if( !MWF.xScript.dictLoaded[k] ){\r MWF.xScript.dictLoaded[k] = cache; //指向同一个对象\r // MWF.xScript.dictLoaded[k][path] = json; //指向不同的对象\r }else if( i===0 &amp;&amp; j===0 ){\r MWF.xScript.setDictToCache( k, path ,json );\r var arr = path.split(/\\./g);\r var p;\r var cache = MWF.xScript.dictLoaded[k];\r for( var l=0 ; l&lt;arr.length; l++ ){\r p = l === 0 ? arr[0] : ( p + \".\" + arr[l] );\r if( cache[ p ] )break;\r }\r if( p ){\r var mathP = p+\".\";\r Object.keys( cache ).each( function( path, idx){\r if( path.indexOf( mathP ) === 0 )delete cache[path];\r })\r }\r }\r }\r }\r };\r \r MWF.xScript.getMatchedDict = function(key, path){\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var arr = path.split(/\\./g);\r if( MWF.xScript.dictLoaded[key] ){\r var dicts = MWF.xScript.dictLoaded[key];\r var list = Array.clone(arr);\r var p;\r var dict;\r for( var i=0 ; i&lt;arr.length; i++ ){\r p = i === 0 ? arr[0] : ( p + \".\" + arr[i] );\r list.shift();\r if( dicts[ p ] ){\r dict = dicts[ p ];\r break;\r }\r }\r return {\r dict : dict,\r unmatchedPathList : list\r }\r }\r return {\r dict : null,\r unmatchedPathList : list\r }\r };\r \r MWF.xScript.insertDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r var lastPath = list[list.length-1];\r if( !dict[lastPath] ){\r dict[lastPath] = json;\r }else if( typeOf( dict[lastPath] ) === \"array\" ){\r dict[lastPath].push( json );\r }\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r \r MWF.xScript.setDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r dict[list[list.length-1]] = json;\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r MWF.xScript.getDictFromCache = function( key, path ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( dict ){\r for( var j=0; j&lt;list.length; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return null;\r }\r return dict;\r }\r return null;\r };\r \r MWF.xScript.deleteDictToCache = function(key, path){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r \r if( dict){\r for( var j=0; j&lt;list.length-1; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return;\r }\r delete dict[list[list.length-1]];\r }\r };\r \r \r MWF.xScript.createDict = function(application){\r //optionsOrName : {\r // type : \"\", //默认为process, 可以为 process cms\r // application : \"\", //流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\", // 数据字典名称/别名/id\r // enableAnonymous : false //允许在未登录的情况下读取CMS的数据字典\r //}\r //或者name: \"\" // 数据字典名称/别名/id\r return function(optionsOrName){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = this.name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"process\";\r var applicationId = options.application || application;\r var enableAnonymous = options.enableAnonymous || false;\r \r var opt = {\r \"appType\" : type,\r \"name\" : name,\r \"appId\" : applicationId,\r \"enableAnonymous\" : enableAnonymous\r };\r \r var key = name+type+applicationId+enableAnonymous;\r // if (!dictLoaded[key]) dictLoaded[key] = {};\r // this.dictData = dictLoaded[key];\r \r //MWF.require(\"MWF.xScript.Actions.DictActions\", null, false);\r if( type == \"cms\" ){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r }else{\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r }\r \r var encodePath = function( path ){\r var arr = path.split(/\\./g);\r var ar = arr.map(function(v){\r return encodeURIComponent(v);\r });\r return ar.join(\"/\");\r };\r \r this.get = function(path, success, failure, async, refresh){\r var value = null;\r \r if (success===true) async=true;\r if (failure===true) async=true;\r \r if (!refresh ){\r var data = MWF.xScript.getDictFromCache( key, path );\r if( data ){\r if (success &amp;&amp; o2.typeOf(success)==\"function\") success( data );\r if( !!async ){\r return Promise.resolve( data );\r }else{\r return data;\r }\r }\r }\r \r // var cb = function(json){\r // value = json.data;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r // return value;\r // }.ag().catch(function(xhr, text, error){ if (failure &amp;&amp; o2.typeOf(failure)==\"function\") return failure(xhr, text, error); });\r \r var cb = function(json){\r value = json.data;\r MWF.xScript.addDictToCache(opt, path, value);\r if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r return value;\r };\r \r var promise;\r if (path){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, cb, null, !!async, false);\r }else{\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, cb, null, !!async, false);\r }\r return (!!async) ? promise : value;\r \r // if (path){\r // var p = encodePath( path );\r // //var p = path.replace(/\\./g, \"/\");\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, function(json){\r // value = json.data;\r // // this.dictData[path] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }else{\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, function(json){\r // value = json.data;\r // // this.dictData[\"root\"] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }\r \r //return value;\r };\r \r this.set = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.setDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.setDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.add = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.addDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.insertDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this[\"delete\"] = function(path, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.deleteDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r MWF.xScript.deleteDictToCache(key, path);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.destory = this[\"delete\"];\r }\r };\r \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"o2_core_o2_xScript_PageEnvironment.js.html":{"url":"o2_core_o2_xScript_PageEnvironment.js.html","title":"o2_core/o2/xScript/PageEnvironment.js","kind":"source","body":" O2OA WebAPI: o2_core/o2/xScript/PageEnvironment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source o2_core/o2/xScript/PageEnvironment.js MWF.xScript = MWF.xScript || {};\r MWF.xScript.PageEnvironment = function (ev) {\r var _data = ev.data;\r var _form = ev.form;\r var _forms = ev.forms;\r \r this.library = COMMON;\r //this.library.version = \"4.0\";\r \r //data\r var getJSONData = function (jData) {\r return new MWF.xScript.JSONData(jData, function (data, key, _self) {\r var p = { \"getKey\": function () { return key; }, \"getParent\": function () { return _self; } };\r while (p &amp;&amp; !_forms[p.getKey()]) p = p.getParent();\r if (p) if (p.getKey()) if (_forms[p.getKey()]) _forms[p.getKey()].resetData();\r });\r };\r this.setData = function (data) {\r this.data = getJSONData(data);\r this.data.save = function (callback) {\r var formData = {\r \"data\": data,\r \"sectionList\": _form.getSectionList()\r };\r form.workAction.saveData(function (json) { if (callback) callback(); }.bind(this), null, work.id, jData);\r }\r };\r this.setData(_data);\r \r //workContext\r this.workContext = {\r \"getTask\": function () { return ev.task; },\r \"getWork\": function () { return ev.work || ev.workCompleted; },\r \"getActivity\": function () { return ev.activity; },\r \"getTaskList\": function () { return ev.taskList; },\r \"getControl\": function () { return ev.control; },\r \"getWorkLogList\": function () { return ev.workLogList; },\r \"getAttachmentList\": function () { return ev.attachmentList; },\r \"getRouteList\": function () { return (ev.task) ? ev.task.routeNameList : null; },\r \"getInquiredRouteList\": function () { return null; },\r \"setTitle\": function (title) {\r //if (!this.workAction){\r // MWF.require(\"MWF.xScript.Actions.WorkActions\", null, false);\r // this.workAction = new MWF.xScript.Actions.WorkActions();\r //}\r //this.workAction.setTitle(ev.work.id, {\"title\": title});\r }\r };\r var _redefineWorkProperties = function (work) {\r if (work) {\r work.creatorPersonDn = work.creatorPerson;\r work.creatorUnitDn = work.creatorUnit;\r work.creatorUnitDnList = work.creatorUnitList;\r work.creatorIdentityDn = work.creatorIdentity;\r var o = {\r \"creatorPerson\": { \"get\": function () { return this.creatorPersonDn.substring(0, this.creatorPersonDn.indexOf(\"@\")); } },\r \"creatorUnit\": { \"get\": function () { return this.creatorUnitDn.substring(0, this.creatorUnitDn.indexOf(\"@\")); } },\r \"creatorDepartment\": { \"get\": function () { return this.creatorUnitDn.substring(0, this.creatorUnitDn.indexOf(\"@\")); } },\r \"creatorIdentity\": { \"get\": function () { return this.creatorIdentityDn.substring(0, this.creatorIdentityDn.indexOf(\"@\")); } },\r \"creatorUnitList\": {\r \"get\": function () {\r var v = [];\r this.creatorUnitDnList.each(function (dn) {\r v.push(dn.substring(0, dn.indexOf(\"@\")))\r });\r return v;\r }\r },\r \"creatorCompany\": { \"get\": function () { return this.creatorUnitList[0] } }\r };\r MWF.defineProperties(work, o);\r }\r return work;\r };\r var _redefineTaskProperties = function (task) {\r if (task) {\r task.personDn = task.person;\r task.unitDn = task.unit;\r task.unitDnList = task.unitList;\r task.identityDn = task.identity;\r var o = {\r \"person\": { \"get\": function () { return this.personDn.substring(0, this.personDn.indexOf(\"@\")); } },\r \"unit\": { \"get\": function () { return this.unitDn.substring(0, this.unitDn.indexOf(\"@\")); } },\r \"department\": { \"get\": function () { return this.unitDn.substring(0, this.unitDn.indexOf(\"@\")); } },\r \"identity\": { \"get\": function () { return this.identityDn.substring(0, this.identityDn.indexOf(\"@\")); } },\r \"unitList\": {\r \"get\": function () {\r var v = [];\r this.unitDnList.each(function (dn) {\r v.push(dn.substring(0, dn.indexOf(\"@\")))\r });\r return v;\r }\r },\r \"company\": { \"get\": function () { return this.unitList[0]; } }\r };\r MWF.defineProperties(task, o);\r }\r return task;\r };\r _redefineWorkProperties(this.workContext.getWork());\r _redefineTaskProperties(_redefineWorkProperties(this.workContext.getTask()));\r \r //dict\r this.Dict = MWF.xScript.createDict(_form.json.application);\r //org\r var orgActions = null;\r var getOrgActions = function () {\r if (!orgActions) {\r MWF.require(\"MWF.xScript.Actions.UnitActions\", null, false);\r orgActions = new MWF.xScript.Actions.UnitActions();\r }\r };\r var getNameFlag = function (name) {\r var t = typeOf(name);\r if (t === \"array\") {\r var v = [];\r name.each(function (id) {\r v.push((typeOf(id) === \"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id);\r });\r return v;\r } else {\r return [(t === \"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name];\r }\r };\r this.org = {\r //群组***************\r //获取群组--返回群组的对象数组\r getGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r \r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listGroup(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级群组--返回群组的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubGroup: function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data;\r // return v;\r // }.ag().catch(function(json){ return json; });\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listSubGroupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listSubGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // var v = null;\r // if (nested){\r // orgActions.listSubGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSubGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //查询上级群组--返回群组的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupGroup:function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r if (nested){\r var promise = orgActions.listSupGroupNested(data, cb, null, !!async);\r }else{\r var promise = orgActions.listSupGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r // var v = null;\r // if (nested){\r // orgActions.listSupGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSupGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //人员所在群组（嵌套）--返回群组的对象数组\r listGroupWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroupWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listGroupWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r //群组是否拥有角色--返回true, false\r groupHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"group\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.groupHasRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.groupHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r \r //角色***************\r //获取角色--返回角色的对象数组\r getRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listRole(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //人员所有角色（嵌套）--返回角色的对象数组\r listRoleWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listRoleWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r \r //人员***************\r //人员是否拥有角色--返回true, false\r personHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"person\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.personHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r //获取人员--返回人员的对象数组\r getPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listPerson(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级人员--返回人员的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询上级人员--返回人员的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r listSupPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //获取群组的所有人员--返回人员的对象数组\r listPersonWithGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取角色的所有人员--返回人员的对象数组\r listPersonWithRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r promise = orgActions.listPersonWithRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组\r listPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组或人员对象\r getPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员的人员--返回人员的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listPersonWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonWithUnitNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonWithUnitDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的对象数组\r //name string 属性名\r //value string 属性值\r listPersonWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的全称数组\r //name string 属性名\r //value string 属性值\r listPersonNameWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data.personList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttributeValue(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //人员属性************\r //添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r },\r //设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.setPersonAttribute(data, cb, null, !!async);\r },\r //获取人员属性值\r getPersonAttribute: function(person, attr, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"name\":attr,\"person\":personFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getPersonAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所有属性的名称\r listPersonAttributeName: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的所有属性\r listPersonAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //身份**********\r //获取身份\r getIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的身份\r listIdentityWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentityWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员身份--返回身份的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r listIdentityWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r \r // var cb = function(json){\r // v = json.data;\r // if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r // return v;\r // }.ag().catch(function(json){ return json; });\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var method = (nested) ? \"listIdentityWithUnitNested\" : \"listIdentityWithUnitDirect\";\r var promise = orgActions[method](data, cb, null, !!async);\r promise.name = \"org\";\r \r //\r // if (nested){\r // orgActions.listIdentityWithUnitNested(data, cb, null, !!async);\r // }else{\r // orgActions.listIdentityWithUnitDirect(data, cb, null, !!async);\r // }\r return (!!async) ? promise : v;\r },\r \r //组织**********\r //获取组织\r getUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织的下级--返回组织的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r listSubUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询组织的上级--返回组织的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r //async 布尔 true异步请求\r listSupUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // if (callback){\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }\r // }else{\r // var v = null;\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r // }\r },\r //根据个人身份获取组织\r //flag 数字 表示获取第几层的组织\r // 字符串 表示获取指定类型的组织\r // 空 表示获取直接所在的组织\r getUnitByIdentity: function(name, flag, async){\r getOrgActions();\r var getUnitMethod = \"current\";\r var v;\r if (flag){\r if (typeOf(flag)===\"string\") getUnitMethod = \"type\";\r if (typeOf(flag)===\"number\") getUnitMethod = \"level\";\r }\r \r var cb;\r var promise;\r switch (getUnitMethod){\r case \"current\":\r var data = {\"identityList\":getNameFlag(name)};\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v; return v;\r // }.ag().catch(function(json){ return json; });\r \r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r \r promise = orgActions.listUnitWithIdentity(data, cb, null, !!async);\r break;\r case \"type\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"type\":flag};\r \r cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndType(data, cb, null, !!async);\r break;\r case \"level\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"level\":flag};\r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndLevel(data, cb, null, !!async);\r break;\r }\r return (!!async) ? promise : v;\r },\r //列出身份所在组织的所有上级组织\r listAllSupUnitWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取人员所在的所有组织\r listUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所在组织的所有上级组织\r listAllSupUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织属性，获取所有符合的组织\r listUnitWithAttribute: function(name, attribute, async){\r getOrgActions();\r var data = {\"name\":name,\"attribute\":attribute};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r promise = orgActions.listUnitWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织职务，获取所有符合的组织\r listUnitWithDuty: function(name, id, async){\r getOrgActions();\r var data = {\"name\":name,\"identity\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织职务***********\r //获取指定的组织职务的身份\r getDuty: function(duty, id, async){\r getOrgActions();\r var data = {\"name\":duty,\"unit\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有职务名称\r listDutyNameWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务名称\r listDutyNameWithUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务\r listUnitAllDuty: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出顶层组织\r listTopUnit: function(async){\r var action = MWF.Actions.get(\"x_organization_assemble_control\");\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = action.listTopUnit(cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织属性**************\r //添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个)\r appendUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r \r // orgActions.appendUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个)\r setUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r orgActions.setUnitAttribute(data, cb, null, !!async);\r \r // orgActions.setUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //获取组织属性值\r getUnitAttribute: function(unit, attr, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"name\":attr,\"unit\":unitFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getUnitAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织所有属性的名称\r listUnitAttributeName: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织的所有属性\r listUnitAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r }\r };\r \r this.Action = (function () {\r var actions = [];\r return function (root, json) {\r var action = actions[root] || (actions[root] = new MWF.xDesktop.Actions.RestActions(\"\", root, \"\"));\r action.getActions = function (callback) {\r if (!this.actions) this.actions = {};\r Object.merge(this.actions, json);\r if (callback) callback();\r };\r this.invoke = function (option) {\r action.invoke(option)\r }\r }\r })();\r this.service = {\r \"jaxwsClient\": {},\r \"jaxrsClient\": {}\r };\r \r var lookupAction = null;\r var getLookupAction = function (callback) {\r if (!lookupAction) {\r MWF.require(\"MWF.xDesktop.Actions.RestActions\", function () {\r lookupAction = new MWF.xDesktop.Actions.RestActions(\"\", \"x_processplatform_assemble_surface\", \"\");\r lookupAction.getActions = function (actionCallback) {\r this.actions = {\r //\"lookup\": {\"uri\": \"/jaxrs/view/flag/{view}/application/flag/{application}\"},\r //\"getView\": {\"uri\": \"/jaxrs/view/{id}/design\"}\r \"lookup\": { \"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\": \"PUT\" },\r \"getView\": { \"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\" }\r };\r if (actionCallback) actionCallback();\r }\r if (callback) callback();\r });\r } else {\r if (callback) callback();\r }\r };\r \r this.view = {\r \"lookup\": function (view, callback, async) {\r var filterList = { \"filterList\": (view.filter || null) };\r MWF.Actions.get(\"x_query_assemble_surface\").loadView(view.view, view.application, filterList, function (json) {\r var data = {\r \"grid\": json.data.grid || json.data.groupGrid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }, null, async);\r },\r \r \"lookupV1\": function (view, callback) {\r getLookupAction(function () {\r lookupAction.invoke({\r \"name\": \"lookup\", \"async\": true, \"parameter\": { \"view\": view.view, \"application\": view.application }, \"success\": function (json) {\r var data = {\r \"grid\": json.data.grid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }.bind(this)\r });\r }.bind(this));\r },\r \"select\": function (view, callback, options) {\r if (view.view) {\r var viewJson = {\r \"application\": view.application || _form.json.application,\r \"viewName\": view.view || \"\",\r \"isTitle\": (view.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (view.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": view.filter\r };\r if (!options) options = {};\r options.width = view.width;\r options.height = view.height;\r options.title = view.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function () {\r this.view = new MWF.xApplication.query.Query.Viewer(dlg.content.getFirst(), viewJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r this.statement = {\r \"execute\": function (statement, callback, async) {\r var parameter = this.parseParameter(statement.parameter);\r var filterList = this.parseFilter(statement.filter, parameter);\r var obj = {\r \"filterList\": filterList,\r \"parameter\" : parameter\r };\r MWF.Actions.load(\"x_query_assemble_surface\").StatementAction.executeV2(\r statement.name, statement.mode || \"data\", statement.page || 1, statement.pageSize || 20, obj,\r function (json) {\r if (callback) callback(json);\r }, null, async);\r },\r parseFilter : function( filter, parameter ){\r if( typeOf(filter) !== \"array\" )return [];\r var filterList = [];\r ( filter || [] ).each( function (d) {\r var parameterName = d.path.replace(/\\./g, \"_\");\r var value = d.value;\r if( d.comparison === \"like\" || d.comparison === \"notLike\" ){\r if( value.substr(0, 1) !== \"%\" )value = \"%\"+value;\r if( value.substr(value.length-1,1) !== \"%\" )value = value+\"%\";\r parameter[ parameterName ] = value; //\"%\"+value+\"%\";\r }else{\r if( d.formatType === \"dateTimeValue\" || d.formatType === \"datetimeValue\"){\r value = \"{ts '\"+value+\"'}\"\r }else if( d.formatType === \"dateValue\" ){\r value = \"{d '\"+value+\"'}\"\r }else if( d.formatType === \"timeValue\" ){\r value = \"{t '\"+value+\"'}\"\r }\r parameter[ parameterName ] = value;\r }\r d.value = parameterName;\r \r filterList.push( d );\r }.bind(this));\r return filterList;\r },\r parseParameter : function( obj ){\r if( typeOf(obj) !== \"object\" )return {};\r var parameter = {};\r //传入的参数\r for( var p in obj ){\r var value = obj[p];\r if( typeOf( value ) === \"date\" ){\r value = \"{ts '\"+value.format(\"db\")+\"'}\"\r }\r parameter[ p ] = value;\r }\r return parameter;\r },\r \"select\": function (statement, callback, options) {\r if (statement.name) {\r // var parameter = this.parseParameter(statement.parameter);\r // var filterList = this.parseFilter(statement.filter, parameter);\r var statementJson = {\r \"statementId\": statement.name || \"\",\r \"isTitle\": (statement.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (statement.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": statement.filter,\r \"parameter\": statement.parameter\r };\r if (!options) options = {};\r options.width = statement.width;\r options.height = statement.height;\r options.title = statement.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select statement view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.statement.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.statement.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", function () {\r this.statement = new MWF.xApplication.query.Query.Statement(dlg.content.getFirst(), statementJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r //include 引用脚本\r //optionsOrName : {\r // type : \"\", 默认为portal, 可以为 portal process cms\r // application : \"\", 门户/流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\" // 脚本名称/别名/id\r //}\r //或者name: \"\" // 脚本名称/别名/id\r // if( !window.includedScripts ){\r // var includedScripts = window.includedScripts = [];\r // }else{\r // var includedScripts = window.includedScripts;\r // }\r var includedScripts = [];\r var _includeSingle = function( optionsOrName , callback, async){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"portal\";\r var application = options.application || _form.json.application;\r var key = type +\"-\" + application + \"-\" + name;\r if (includedScripts.indexOf( key )> -1){\r if (callback) callback.apply(this);\r return;\r }\r //if (includedScripts.indexOf( name )> -1){\r // if (callback) callback.apply(this);\r // return;\r //}\r var scriptAction;\r switch ( type ){\r case \"portal\" :\r if( this.scriptActionPortal ){\r scriptAction = this.scriptActionPortal;\r }else{\r MWF.require(\"MWF.xScript.Actions.PortalScriptActions\", null, false);\r scriptAction = this.scriptActionPortal = new MWF.xScript.Actions.PortalScriptActions();\r }\r break;\r case \"process\" :\r if( this.scriptActionProcess ){\r scriptAction = this.scriptActionProcess;\r }else{\r MWF.require(\"MWF.xScript.Actions.ScriptActions\", null, false);\r scriptAction = this.scriptActionProcess = new MWF.xScript.Actions.ScriptActions();\r }\r break;\r case \"cms\" :\r if( this.scriptActionCMS ){\r scriptAction = this.scriptActionCMS;\r }else{\r MWF.require(\"MWF.xScript.Actions.CMSScriptActions\", null, false);\r scriptAction = this.scriptActionCMS = new MWF.xScript.Actions.CMSScriptActions();\r }\r break;\r }\r scriptAction.getScriptByName( application, name, includedScripts, function(json){\r if (json.data){\r includedScripts.push( key );\r \r //名称、别名、id\r json.data.importedList.each( function ( flag ) {\r if( type === \"portal\" ){\r includedScripts.push( type + \"-\" + json.data.portal + \"-\" + flag );\r if( json.data.portalName )includedScripts.push( type + \"-\" + json.data.portalName + \"-\" + flag );\r if( json.data.portalAlias )includedScripts.push( type + \"-\" + json.data.portalAlias + \"-\" + flag );\r }else if( type === \"cms\" ){\r includedScripts.push( type + \"-\" + json.data.appId + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }else if( type === \"process\" ){\r includedScripts.push( type + \"-\" + json.data.application + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }\r });\r \r includedScripts = includedScripts.concat(json.data.importedList);\r MWF.Macro.exec(json.data.text, this);\r if (callback) callback.apply(this);\r }else{\r if (callback) callback.apply(this);\r }\r }.bind(this), null, !!async);\r }\r this.include = function( optionsOrName , callback, async){\r if (o2.typeOf(optionsOrName)==\"array\"){\r if (!!async){\r var count = optionsOrName.length;\r var loaded = 0;\r optionsOrName.each(function(option){\r _includeSingle.apply(this, [option, function(){\r loaded++;\r if (loaded>=count) if (callback) callback.apply(this);;\r }.bind(this), true]);\r }.bind(this));\r \r }else{\r optionsOrName.each(function(option){\r _includeSingle.apply(this, [option]);\r if (callback) callback.apply(this);\r }.bind(this));\r }\r }else{\r _includeSingle.apply(this, [optionsOrName , callback, async])\r }\r };\r \r this.define = function (name, fun, overwrite) {\r var over = true;\r if (overwrite === false) over = false;\r var o = {};\r o[name] = { \"value\": fun, \"configurable\": over };\r MWF.defineProperties(this, o);\r }.bind(this);\r \r //如果前端事件有异步调用，想要在异步调用结束后继续运行页面加载，\r //可在调用前执行 var resolve = this.wait();\r //在异步调用结束后 执行 resolve.cb()；\r //目前只有表单的queryload事件支持此方法。\r this.wait = function(){\r resolve = {};\r var setResolve = function(callback){\r resolve.cb = callback;\r }.bind(this);\r this.target.event_resolve = setResolve;\r return resolve;\r };\r //和this.wait配合使用，\r //如果没有异步，则resolve.cb方法不存在，\r //所以在回调中中使用this.goon();使表单继续加载\r this.goon = function(){\r this.target.event_resolve = null;\r };\r \r //仅前台对象-----------------------------------------\r //form\r /**\r * page对象可在门户页面中可用。它的很多方法与form类似。&lt;b>（仅前端脚本可用）&lt;/b>&lt;br/>\r * @module page\r * @o2range {Portal}\r * @o2ordernumber 50\r * @o2syntax\r * //您可以在门户表单中，通过this来获取page对象，如下：\r * var page = this.page;\r */\r this.page = this.form = {\r /** 跳转到当前门户的指定页面。&lt;b>（仅门户页面脚本可用）&lt;/b>\r * @method toPage\r * @static\r * @param {String} name - 要跳转的页面名称\r * @param {Object} [par] - 要传入被打开页面的数据。在被打开的页面可以用this.page.parameters获取\r * @param {Boolean} [par] - 页面跳转的时候，不往History里增加历史状态，默认为false\r * @o2syntax\r * //跳转到当前门户的指定页面。\r * this.page.toPage( name, par );\r * @example\r * this.page.toPage(\"列表页面\", {\"key\": \"发文列表\"});//打开“列表页面”，并传入一个json数据。\r *\r * //在列表页面中，通过this.page.parameters获取传入的数据。\r * var key = this.page.parameters.key; //key=\"发文列表\"\r */\r \"toPage\": function (name, par, nohis) {\r _form.app.toPage(name, par, nohis);\r },\r \r /** 跳转到指定门户页面。&lt;b>（仅门户页面脚本可用）&lt;/b>\r * @method toPortal\r * @static\r * @param {String} portal - 要跳转的门户名称。\r * @param {String} [page] - 要打开的门户的页面名称。为空则打开指定门户的默认首页。\r * @param {String} [par] - 在被打开的页面可以用this.page.parameters获取。\r * @o2syntax\r * this.page.toPortal( portal, page, par );\r * @example\r * this.page.toPortal(\"公文门户\", \"列表页面\", {\"key\": \"发文列表\"});//打开“公文门户”的“列表页面”，并传入一个json数据。\r *\r * //在列表页面中，通过this.page.parameters获取传入的数据。\r * var key = this.page.parameters.key; //key=\"发文列表\"\r */\r \"toPortal\": function (portal, page, par) {\r _form.app.toPortal(portal, page, par);\r },\r /**获取当前页面的基本信息\r * @method getInfor\r * @static\r * @see module:form.getInfor\r */\r \"getInfor\": function () { return ev.pageInfor; },\r \"infor\": ev.pageInfor,\r /**获取打开当前页面的component对象。\r * @method getApp\r * @static\r * @see module:form.getApp\r */\r \"getApp\": function () { return _form.app; },\r \"app\": _form.app,\r /**获取page对应的DOM对象。\r * @method node\r * @static\r * @see module:form.node\r */\r \"node\": function () { return _form.node; },\r //\"readonly\": _form.options.readonly,\r /**获取页面元素对象。\r * @method get\r * @static\r * @see module:form.get\r */\r \"get\": function (name) { return (_form.all) ? _form.all[name] : null; },\r \r /**获取指定部件元素对象。&lt;br/>\r * @method getWidgetModule\r * @static\r * @param {String} widgetId - 在主页面嵌入部件时用的标识。\r * @param {String} fieldId - 部件内组件标识。\r * @return {FormComponent} 请查看本文档的Classes导航下的FormComponents。\r * @see module:form.get\r * @o2syntax\r * this.page.getWidgetModule( widgetId, fieldId );\r * @example\r * &lt;caption>\r * 1、设计了一个部件，包含一个设计元素subject。&lt;br/>\r * 2、在主页面里两次嵌入1步骤创建的部件，一个标识是widget_1, widget_2。\r * &lt;/caption>\r * var module = this.page.getWidgetModule( \"widget_1\", \"subject\"); //部件widget_1的subject组件\r * var data2 = this.page.getWidgetModule( \"widget_2\", \"subject\").getData(); //部件widget_2的subject组件的值\r */\r \"getWidgetModule\": function (widget, moduleName) {\r if (!_form.widgetModules || !_form.widgetModules[widget]) return null;\r var module = _form.widgetModules[widget][moduleName];\r return module || null;\r },\r /**获取页面中可输入的字段元素对象\r * @method getField\r * @static\r * @see module:form.getField\r */\r \"getField\": function (name) { return _forms[name]; },\r \"getAction\": function () { return _form.workAction },\r \"getDesktop\": function () { return _form.app.desktop },\r \r \"getData\": function () { return new MWF.xScript.JSONData(_form.getData()); },\r //\"save\": function(callback){_form.saveWork(callback);},\r \r /**关闭当前页面\r * @method close\r * @static\r * @see module:form.close\r */\r \"close\": function () { _form.closeWork(); },\r \r \"print\": function (application, form) {\r _form.printWork(application, form);\r },\r \r /**弹出一个确认框\r * @method confirm\r * @static\r * @see module:form.confirm\r */\r \"confirm\": function (type, title, text, width, height, ok, cancel, callback, mask, style) {\r // var p = MWF.getCenter({\"x\": width, \"y\": height});\r // e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r // _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r if ((arguments.length &lt;= 1) || o2.typeOf(arguments[1]) === \"string\") {\r var p = MWF.getCenter({ \"x\": width, \"y\": height });\r e = { \"event\": { \"clientX\": p.x, \"x\": p.x, \"clientY\": p.y, \"y\": p.y } };\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r } else {\r e = (arguments.length > 1) ? arguments[1] : null;\r title = (arguments.length > 2) ? arguments[2] : null;\r text = (arguments.length > 3) ? arguments[3] : null;\r width = (arguments.length > 4) ? arguments[4] : null;\r height = (arguments.length > 5) ? arguments[5] : null;\r ok = (arguments.length > 6) ? arguments[6] : null;\r cancel = (arguments.length > 7) ? arguments[7] : null;\r callback = (arguments.length > 8) ? arguments[8] : null;\r mask = (arguments.length > 9) ? arguments[9] : null;\r style = (arguments.length > 10) ? arguments[10] : null;\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }\r },\r /**显示一个带关闭按钮的信息框\r * @method alert\r * @static\r * @see module:form.alert\r */\r \"alert\": function(type, title, text, width, height){\r _form.alert(type, title, text, width, height);\r },\r \r /**显示一个信息框\r * @method notice\r * @static\r * @see module:form.notice\r */\r \"notice\": function (content, type, target, where, offset, option) {\r _form.notice(content, type, target, where, offset, option);\r },\r /**给页面添加事件。\r * @method addEvent\r * @static\r * @see module:form.addEvent\r */\r \"addEvent\": function (e, f) { _form.addEvent(e, f); },\r \r \"openWindow\": function (form, app) {\r _form.openWindow(form, app);\r },\r \r /**打开一个在流转或已完成的流程实例\r * @method openWork\r * @static\r * @see module:form.openWork\r */\r \"openWork\": function (id, completedId, title, options) {\r var op = options || {};\r op.workId = id;\r op.workCompletedId = completedId;\r op.docTitle = title;\r op.appId = \"process.Work\" + (op.workId || op.workCompletedId);\r return layout.desktop.openApplication(this.event, \"process.Work\", op);\r },\r /**使用流程的jobId打开工作\r * @method openJob\r * @static\r * @see module:form.openJob\r */\r \"openJob\": function (id, choice, options) {\r var workData = null;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listWorkByJob(id, function (json) {\r if (json.data) workData = json.data;\r }.bind(this), null, false);\r \r if (workData) {\r var len = workData.workList.length + workData.workCompletedList.length;\r if (len) {\r if (len > 1 &amp;&amp; choice) {\r var node = new Element(\"div\", { \"styles\": { \"padding\": \"20px\", \"width\": \"500px\" } }).inject(_form.node);\r workData.workList.each(function (work) {\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\" + o2.LP.widget.open + \"&lt;/div>&lt;/div>\" +\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\" + work.title + \"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.activityName + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.activityArrivedTime + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + (work.manualTaskIdentityText || \"\") + \"&lt;/div>&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function (e) {\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(work.id, null, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r workData.workCompletedList.each(function (work) {\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\" + o2.LP.widget.open + \"&lt;/div>&lt;/div>\" +\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\" + work.title + \"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + o2.LP.widget.workcompleted + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.completedTime + \"&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function (e) {\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(null, work.id, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r var height = node.getSize().y + 20;\r if (height > 600) height = 600;\r \r var dlg = o2.DL.open({\r \"title\": o2.LP.widget.choiceWork,\r \"style\": \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\": \"cancel\",\r \"text\": o2.LP.widget.close,\r \"action\": function () { dlg.close(); }\r }\r ]\r });\r } else {\r if (workData.workList.length) {\r var work = workData.workList[0];\r return this.openWork(work.id, null, work.title, options);\r } else {\r var work = workData.workCompletedList[0];\r return this.openWork(null, work.id, work.title, options);\r }\r }\r }\r }\r },\r /**打开一个内容管理文档\r * @method openDocument\r * @static\r * @see module:form.openDocument\r */\r \"openDocument\": function (id, title, options) {\r var op = options || {};\r op.documentId = id;\r op.docTitle = title || \"\";\r layout.desktop.openApplication(this.event, \"cms.Document\", op);\r },\r /**打开一个门户页面\r * @method openPortal\r * @static\r * @see module:form.openPortal\r */\r \"openPortal\": function (name, page, par) {\r var action = MWF.Actions.get(\"x_portal_assemble_surface\");\r action.getApplication(name, function (json) {\r if (json.data) {\r if (page) {\r action.getPageByName(page, json.data.id, function (pageJson) {\r var pageId = (pageJson.data) ? pageJson.data.id : \"\";\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"pageId\": pageId,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id + pageId)\r })\r });\r } else {\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id)\r })\r }\r }\r \r });\r },\r /**打开一个内容管理栏目（应用）\r * @method openCMS\r * @static\r * @see module:form.openCMS\r */\r \"openCMS\": function (name) {\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r action.getColumn(name, function (json) {\r if (json.data) {\r layout.desktop.openApplication(null, \"cms.Module\", {\r \"columnId\": json.data.id,\r \"appId\": \"cms.Module\" + json.data.id\r });\r }\r });\r },\r /**打开一个流程应用\r * @method openProcess\r * @static\r * @see module:form.openProcess\r */\r \"openProcess\": function (name) {\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r action.getApplication(name, function (json) {\r if (json.data) {\r layout.desktop.openApplication(null, \"process.Application\", {\r \"id\": json.data.id,\r \"appId\": \"process.Application\" + json.data.id\r });\r }\r });\r },\r /**打开一个任意一个component应用\r * @method openApplication\r * @static\r * @see module:form.openApplication\r */\r \"openApplication\": function (name, options) {\r layout.desktop.openApplication(null, name, options);\r },\r /**创建一个内容管理文档\r * @method createDocument\r * @static\r * @see module:form.createDocument\r */\r \"createDocument\": function (columnOrOptions, category, data, identity, callback, target, latest, selectColumnEnable, ignoreTitle) {\r var column = columnOrOptions;\r var onAfterPublish, onPostPublish;\r if (typeOf(columnOrOptions) == \"object\") {\r column = columnOrOptions.column;\r category = columnOrOptions.category;\r data = columnOrOptions.data;\r identity = columnOrOptions.identity;\r callback = columnOrOptions.callback;\r target = columnOrOptions.target;\r latest = columnOrOptions.latest;\r selectColumnEnable = columnOrOptions.selectColumnEnable;\r ignoreTitle = columnOrOptions.ignoreTitle;\r onAfterPublish = columnOrOptions.onAfterPublish;\r onPostPublish = columnOrOptions.onPostPublish;\r }\r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r layout.app.content.empty();\r layout.app = null;\r }\r }\r \r MWF.xDesktop.requireApp(\"cms.Index\", \"Newer\", function () {\r var starter = new MWF.xApplication.cms.Index.Newer(null, null, _form.app, null, {\r \"documentData\": data,\r \"identity\": identity,\r \r \"ignoreTitle\": ignoreTitle === true,\r \"ignoreDrafted\": latest === false,\r \"selectColumnEnable\": !category || selectColumnEnable === true,\r \"restrictToColumn\": !!category &amp;&amp; selectColumnEnable !== true,\r \r \"categoryFlag\": category, //category id or name\r \"columnFlag\": column, //column id or name,\r \"onStarted\": function (documentId, data) {\r if (callback) callback();\r },\r \"onPostPublish\": function () {\r if(onPostPublish)onPostPublish();\r },\r \"onAfterPublish\": function () {\r if(onAfterPublish)onAfterPublish();\r }\r });\r starter.load();\r })\r },\r /**启动一个流程实例\r * @method startProcess\r * @static\r * @see module:form.startProcess\r */\r \"startProcess\": function (app, process, data, identity, callback, target, latest) {\r if (arguments.length > 2) {\r for (var i = 2; i &lt; arguments.length; i++) {\r if (typeOf(arguments[i]) == \"boolean\") {\r target = arguments[i];\r break;\r }\r }\r }\r \r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r //layout.app.content.empty();\r layout.app.$openWithSelf = true;\r }\r }\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\").getProcessByName(process, app, function (json) {\r if (json.data) {\r MWF.xDesktop.requireApp(\"process.TaskCenter\", \"ProcessStarter\", function () {\r var starter = new MWF.xApplication.process.TaskCenter.ProcessStarter(json.data, _form.app, {\r \"workData\": data,\r \"identity\": identity,\r \"latest\": latest,\r \"onStarted\": function (data, title, processName) {\r if (data.work){\r var work = data.work;\r var options = {\"draft\": work, \"appId\": \"process.Work\"+(new o2.widget.UUID).toString(), \"desktopReload\": false};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{\r var currentTask = [];\r data.each(function(work){\r if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r }.bind(this));\r \r if (currentTask.length==1){\r var options = {\"workId\": currentTask[0], \"appId\": currentTask[0]};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{}\r }\r \r // var currentTask = [];\r // data.each(function (work) {\r // if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r // }.bind(this));\r //\r // if (currentTask.length == 1) {\r // var options = { \"workId\": currentTask[0], \"appId\": currentTask[0] };\r // layout.desktop.openApplication(null, \"process.Work\", options);\r // } else { }\r \r if (callback) callback(data);\r }.bind(this)\r });\r starter.load();\r }.bind(this));\r }\r });\r },\r \r /**\r * 在打开的页面的任意脚本中，获取传入的参数。\r * @member parameters\r * @static\r * @return {Boolean} 任意数据类型，根据传入的参数决定。\r * @o2syntax\r * var par = this.page.parameters\r * @example\r * //打开页面时传入参数：\r * this.form.openPortal(id, \"\", {\"type\": \"my type\"});\r *\r * //在打开的页面的任意脚本中，可以获取parameters：\r * var par = this.page.parameters;\r * //par的内容：{\"type\": \"my type\"}\r */\r \"parameters\": _form.options.parameters,\r \r /**\r * 在嵌入部件的时候，可以在主页面上传入参数。通过本方法，可以在对应部件或者部件元素的脚本中获取传入的参数。\r * @method getWidgetPrameters\r * @static\r * @return {Object} 任意数据类型，根据传入的参数决定。\r * @o2syntax\r * var par = this.page.getWidgetPrameters();\r * @example\r * //在主页面嵌入部件的地方传入参数：\r * return {\"type\": \"my type\"};\r *\r * //在对应部件脚本中，可以获取parameters：\r * var par = this.page.getWidgetPrameters();\r * //par的内容：{\"type\": \"my type\"}\r */\r \"getWidgetPrameters\": function () {\r if (!this.target) return null;\r if (!this.target.widget) return null;\r if (!this.widgetParameters) return null;\r var pageId = this.target.widget.json.id;\r return this.widgetParameters[pageId];\r }.bind(this)\r //\"app\": _form.app\r };\r this.form.currentRouteName = _form.json.currentRouteName;\r this.form.opinion = _form.json.opinion;\r \r this.target = ev.target;\r this.event = ev.event;\r this.status = ev.status;\r this.session = layout.desktop.session;\r this.Actions = o2.Actions;\r \r this.query = function (option) {\r // options = {\r // \"name\": \"statementName\",\r // \"data\": \"json data\",\r // \"firstResult\": 1,\r // \"maxResults\": 100,\r // \"success\": function(){},\r // \"error\": function(){},\r // \"async\": true or false, default is true\r // }\r if (option) {\r var json = (option.data) || {};\r if (option.firstResult) json.firstResult = option.firstResult.toInt();\r if (option.maxResults) json.maxResults = option.maxResults.toInt();\r o2.Actions.get(\"x_query_assemble_surface\").executeStatement(option.name, json, success, error, options.async);\r }\r };\r this.Table = MWF.xScript.createTable();\r };\r \r MWF.xScript.createTable = function(){\r return function(name){\r this.name = name;\r this.action = o2.Actions.get(\"x_query_assemble_surface\");\r \r this.listRowNext = function(id, count, success, error, async){\r this.action.listRowNext(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowPrev = function(id, count, success, error, async){\r this.action.listRowPrev(this.name, id, count, success, error, async);\r };\r this.listRowSelectWhere = function(where, success, error, async){\r this.action.listRowSelectWhere(this.name, where, success, error, async);\r };\r this.listRowCountWhere = function(where, success, error, async){\r this.action.listRowCountWhere(this.name, where, success, error, async);\r };\r this.deleteRow = function(id, success, error, async){\r this.action.deleteRow(this.name, id, success, error, async);\r };\r this.deleteAllRow = function(success, error, async){\r this.action.deleteAllRow(this.name, success, error, async);\r };\r this.getRow = function(id, success, error, async){\r this.action.getRow(this.name, id, success, error, async);\r };\r this.insertRow = function(data, success, error, async){\r this.action.insertRow(this.name, data, success, error, async);\r };\r this.updateRow = function(id, data, success, error, async){\r this.action.updateRow(this.name, id, data, success, error, async);\r };\r }\r };\r MWF.xScript.JSONData = function(data, callback, key, parent, _form){\r var getter = function(data, callback, k, _self){\r return function(){return ([\"array\",\"object\"].indexOf(typeOf(data[k]))===-1) ? data[k] : new MWF.xScript.JSONData(data[k], callback, k, _self, _form);};\r };\r var setter = function(data, callback, k, _self){\r return function(v){\r data[k] = v;\r //debugger;\r //this.add(k, v, true);\r if (callback) callback(data, k, _self);\r }\r };\r var define = function(){\r var o = {};\r for (var k in data) o[k] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, k, this]),\"set\": setter.apply(this, [data, callback, k, this])};\r o[\"length\"] = {\"get\": function(){return Object.keys(data).length;}};\r o[\"some\"] = {\"get\": function(){return data.some;}};\r MWF.defineProperties(this, o);\r \r var methods = {\r \"getKey\": {\"value\": function(){ return key; }},\r \"getParent\": {\"value\": function(){ return parent; }},\r \"toString\": {\"value\": function() { return data.toString();}},\r \"setSection\": {\"value\": function(newKey, newValue){\r this.add(newKey, newValue, true);\r try {\r var path = [this.getKey()];\r p = this.getParent();\r while (p &amp;&amp; p.getKey()){\r path.unshift(p.getKey());\r p = p.getParent();\r }\r if (path.length) _form.sectionListObj[path.join(\".\")] = newKey;\r }catch(e){\r \r }\r }},\r \"add\": {\"value\": function(newKey, newValue, overwrite){\r var flag = true;\r var type = typeOf(data);\r if (type===\"array\"){\r if (arguments.length&lt;2){\r data.push(newKey);\r newValue = newKey;\r newKey = data.length-1;\r }else{\r if (!newKey &amp;&amp; newKey!==0){\r data.push(newValue);\r newKey = data.length-1;\r }else{\r flag = false;\r }\r }\r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else if (type===\"object\"){\r if (!this.hasOwnProperty(newKey)){\r data[newKey] = newValue;\r \r if (flag){\r var o = {};\r o[newKey] = {\"configurable\": true, \"enumerable\": true, \"get\": getter.apply(this, [data, callback, newKey, this]),\"set\": setter.apply(this, [data, callback, newKey, this])};\r MWF.defineProperties(this, o);\r }\r this[newKey] = newValue;\r }else{\r if (overwrite) this[newKey] = newValue;\r }\r }\r \r return this[newKey];\r }},\r \"del\": {\"value\": function(delKey){\r if (!this.hasOwnProperty(delKey)) return null;\r delete data[delKey];\r delete this[delKey];\r return this;\r }}\r };\r MWF.defineProperties(this, methods);\r };\r var type = typeOf(data);\r if (type===\"object\" || type===\"array\") define.apply(this);\r };\r \r if( !MWF.xScript.dictLoaded )MWF.xScript.dictLoaded = {};\r \r MWF.xScript.addDictToCache = function ( options, path, json ) {\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var type = options.appType || \"process\";\r var enableAnonymous = options.enableAnonymous || false;\r \r var appFlagList = [];\r if( options.application )appFlagList.push( options.application );\r if( options.appId )appFlagList.push( options.appId );\r if( options.appName )appFlagList.push( options.appName );\r if( options.appAlias )appFlagList.push( options.appAlias );\r \r var dictFlagList = [];\r if( options.id )dictFlagList.push( options.id );\r if( options.name )dictFlagList.push( options.name );\r if( options.alias )dictFlagList.push( options.alias );\r \r var cache = {};\r cache[path] = json;\r \r for( var i=0; i&lt;appFlagList.length; i++ ){\r for( var j=0; j&lt;dictFlagList.length; j++ ){\r var k = dictFlagList[j] + type + appFlagList[i] + enableAnonymous;\r if( !MWF.xScript.dictLoaded[k] ){\r MWF.xScript.dictLoaded[k] = cache; //指向同一个对象\r // MWF.xScript.dictLoaded[k][path] = json; //指向不同的对象\r }else if( i===0 &amp;&amp; j===0 ){\r MWF.xScript.setDictToCache( k, path ,json );\r var arr = path.split(/\\./g);\r var p;\r var cache = MWF.xScript.dictLoaded[k];\r for( var l=0 ; l&lt;arr.length; l++ ){\r p = l === 0 ? arr[0] : ( p + \".\" + arr[l] );\r if( cache[ p ] )break;\r }\r if( p ){\r var mathP = p+\".\";\r Object.keys( cache ).each( function( path, idx){\r if( path.indexOf( mathP ) === 0 )delete cache[path];\r })\r }\r }\r }\r }\r };\r \r MWF.xScript.getMatchedDict = function(key, path){\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var arr = path.split(/\\./g);\r if( MWF.xScript.dictLoaded[key] ){\r var dicts = MWF.xScript.dictLoaded[key];\r var list = Array.clone(arr);\r var p;\r var dict;\r for( var i=0 ; i&lt;arr.length; i++ ){\r p = i === 0 ? arr[0] : ( p + \".\" + arr[i] );\r list.shift();\r if( dicts[ p ] ){\r dict = dicts[ p ];\r break;\r }\r }\r return {\r dict : dict,\r unmatchedPathList : list\r }\r }\r return {\r dict : null,\r unmatchedPathList : list\r }\r };\r \r MWF.xScript.insertDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r var lastPath = list[list.length-1];\r if( !dict[lastPath] ){\r dict[lastPath] = json;\r }else if( typeOf( dict[lastPath] ) === \"array\" ){\r dict[lastPath].push( json );\r }\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r \r MWF.xScript.setDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r dict[list[list.length-1]] = json;\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r MWF.xScript.getDictFromCache = function( key, path ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( dict ){\r for( var j=0; j&lt;list.length; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return null;\r }\r return dict;\r }\r return null;\r };\r \r MWF.xScript.deleteDictToCache = function(key, path){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r \r if( dict){\r for( var j=0; j&lt;list.length-1; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return;\r }\r delete dict[list[list.length-1]];\r }\r };\r \r \r MWF.xScript.createDict = function(application){\r //optionsOrName : {\r // type : \"\", //默认为process, 可以为 process cms\r // application : \"\", //流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\", // 数据字典名称/别名/id\r // enableAnonymous : false //允许在未登录的情况下读取CMS的数据字典\r //}\r //或者name: \"\" // 数据字典名称/别名/id\r return function(optionsOrName){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = this.name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"process\";\r var applicationId = options.application || application;\r var enableAnonymous = options.enableAnonymous || false;\r \r var opt = {\r \"appType\" : type,\r \"name\" : name,\r \"appId\" : applicationId,\r \"enableAnonymous\" : enableAnonymous\r };\r \r var key = name+type+applicationId+enableAnonymous;\r // if (!dictLoaded[key]) dictLoaded[key] = {};\r // this.dictData = dictLoaded[key];\r \r //MWF.require(\"MWF.xScript.Actions.DictActions\", null, false);\r if( type == \"cms\" ){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r }else{\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r }\r \r var encodePath = function( path ){\r var arr = path.split(/\\./g);\r var ar = arr.map(function(v){\r return encodeURIComponent(v);\r });\r return ar.join(\"/\");\r };\r \r this.get = function(path, success, failure, async, refresh){\r var value = null;\r \r if (success===true) async=true;\r if (failure===true) async=true;\r \r if (!refresh ){\r var data = MWF.xScript.getDictFromCache( key, path );\r if( data ){\r if (success &amp;&amp; o2.typeOf(success)==\"function\") success( data );\r if( !!async ){\r return Promise.resolve( data );\r }else{\r return data;\r }\r }\r }\r \r // var cb = function(json){\r // value = json.data;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r // return value;\r // }.ag().catch(function(xhr, text, error){ if (failure &amp;&amp; o2.typeOf(failure)==\"function\") return failure(xhr, text, error); });\r \r var cb = function(json){\r value = json.data;\r MWF.xScript.addDictToCache(opt, path, value);\r if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r return value;\r };\r \r var promise;\r if (path){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, cb, null, !!async, false);\r }else{\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, cb, null, !!async, false);\r }\r return (!!async) ? promise : value;\r \r // if (path){\r // var p = encodePath( path );\r // //var p = path.replace(/\\./g, \"/\");\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, function(json){\r // value = json.data;\r // // this.dictData[path] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }else{\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, function(json){\r // value = json.data;\r // // this.dictData[\"root\"] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }\r \r //return value;\r };\r \r this.set = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.setDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.setDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.add = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.addDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.insertDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this[\"delete\"] = function(path, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.deleteDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r MWF.xScript.deleteDictToCache(key, path);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.destory = this[\"delete\"];\r }\r };\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"o2_core_o2_xScript_ViewEnvironment.js.html":{"url":"o2_core_o2_xScript_ViewEnvironment.js.html","title":"o2_core/o2/xScript/ViewEnvironment.js","kind":"source","body":" O2OA WebAPI: o2_core/o2/xScript/ViewEnvironment.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source o2_core/o2/xScript/ViewEnvironment.js /**\r * @readonly\r * @enum {String} ViewFilterDataLogic\r * @property {String} or color for a white square or piece.\r * @property {String} and color for a black square or piece.\r */\r \r /**\r * ViewFilter 视图过滤条件\r * @typedef {Object} ViewFilter\r * @property {String} logic - 可选值：“and”或者“or”，表示和前一个条件的逻辑运算关系。\r * @property {String} path - 要过滤的data数据的路径。\r * @property {String} comparison - 比较运算符，可选值：&lt;br/>\r * &lt;div style='padding-left:150px;'>\r * &lt;b>equals&lt;/b> 或 &lt;b>==&lt;/b> 或：表示等于。&lt;br/>\r * &lt;b>notEquals&lt;/b> 或 &lt;b>!=&lt;/b> ：表示不等于。&lt;br/>\r * &lt;b>greaterThan&lt;/b> 或 &lt;b>>&lt;/b> ：表示大于。&lt;br/>\r * &lt;b>greaterThanOrEqualTo&lt;/b> 或 &lt;b>=>&lt;/b> ：表示大于或等于。&lt;br/>\r * &lt;b>lessThan&lt;/b> 或 &lt;b>&lt;&lt;/b> ：表示小于。&lt;br/>\r * &lt;b>lessThanOrEqualTo&lt;/b> 或 &lt;b>&lt;=&lt;/b> ：表示小于等于。&lt;br/>\r * &lt;b>like&lt;/b> ：表示部分匹配。&lt;br/>\r * &lt;b>notLike&lt;/b> ：表示不匹配。&lt;br/>\r * &lt;b>range&lt;/b> ：表示一定的范围。&lt;br/>\r * &lt;b>in&lt;/b> ：表示在某几个特定的值当中。&lt;br/>\r * &lt;/div>\r * @property {String} formatType - 过滤数据的数据类型，可选值：\r * &lt;div style='padding-left:150px;'>\r * &lt;b>textValue&lt;/b> ：文本。&lt;br/>\r * &lt;b>numberValue&lt;/b> ：数字。&lt;br/>\r * &lt;b>dateTimeValue&lt;/b> ：日期时间。&lt;br/>\r * &lt;b>booleanValue&lt;/b> ：布尔值。&lt;br/>\r * &lt;/div>\r * @property {(String|Number|Boolean)} value - 过滤的值，根据formatType提供匹配的数据类型的值，如果是dateTimeValue数据类型，则提供日期格式的字符串，格式如“YYYY-MM-DD HH:MM:SS”。当comparison值为“range”时，此值表示范围中的第一个值。当comparison值为“in”时，多个值用半角逗号\",\"分开。\r * @property {(String|Number|Boolean)} otherValue - 当comparison值为“range”时，此值表示范围中的第二个值。当comparison值不为“range”时，忽略此值。\r * @example\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r */\r \r /**\r * StatementFilter 查询视图的过滤条件\r * @typedef {Object} StatementFilter\r * @property {String} path - 要过滤的data数据的路径，形式为查询语句中的\"表别名.字段名\"，如\"o.title\"。\r * @property {String} comparison - 比较运算符，可选值：&lt;br/>\r * &lt;div style='padding-left:150px;'>\r * &lt;b>equals&lt;/b> 或 &lt;b>==&lt;/b> 或：表示等于。&lt;br/>\r * &lt;b>notEquals&lt;/b> 或 &lt;b>!=&lt;/b> ：表示不等于。&lt;br/>\r * &lt;b>greaterThan&lt;/b> 或 &lt;b>>&lt;/b> ：表示大于。&lt;br/>\r * &lt;b>greaterThanOrEqualTo&lt;/b> 或 &lt;b>=>&lt;/b> ：表示大于或等于。&lt;br/>\r * &lt;b>lessThan&lt;/b> 或 &lt;b>&lt;&lt;/b> ：表示小于。&lt;br/>\r * &lt;b>lessThanOrEqualTo&lt;/b> 或 &lt;b>&lt;=&lt;/b> ：表示小于等于。&lt;br/>\r * &lt;b>like&lt;/b> ：表示部分匹配。&lt;br/>\r * &lt;b>notLike&lt;/b> ：表示不匹配。&lt;br/>\r * &lt;/div>\r * @property {String} formatType - 过滤数据的数据类型，可选值：\r * &lt;div style='padding-left:150px;'>\r * &lt;b>textValue&lt;/b> ：文本。&lt;br/>\r * &lt;b>numberValue&lt;/b> ：数字。&lt;br/>\r * &lt;b>dateTimeValue&lt;/b> ：日期时间。&lt;br/>\r * &lt;b>booleanValue&lt;/b> ：布尔值。&lt;br/>\r * &lt;/div>\r * @property {(String|Number|Boolean)} value - 过滤的值，根据formatType提供匹配的数据类型的值，如果是dateTimeValue数据类型，则提供日期格式的字符串，格式如“YYYY-MM-DD HH:MM:SS”。\r * @example\r *{\r * \"path\":\"o.title\",\r * \"comparison\":\"like\",\r * \"value\":\"关于\",\r * \"formatType\":\"textValue\"\r *}\r */\r \r /**\r * StatementParameter 查询视图的过滤条件值参数，对查询语句where语句的形如\":person\"的参数部分进行赋值&lt;br/>\r * 有以下规则：&lt;br/>\r * 1、参数名称为下列值时，后台自动赋值：person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)。&lt;br/>\r * 2、如果对比的是日期，需要传入 Date 类型。&lt;br/>\r * 3、如果运算符用的是 like, noLike，模糊查询，值为 \"%{value}%\"。\r * @typedef {Object} StatementParameter\r * @example\r * {\r * \"person\" : \"\",\r * \"startTime\" : (new Date(\"2020-01-01\")),\r * \"applicationName\" : \"%test%\",\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r */\r \r /*********this.org 的 typedef 开始********/\r \r /**\r * 在本API的this.org模块中，当使用群组作为检索参数的时候，允许使用群组的distinguishedName、name、id、unique属性值，或者包含这些属性值的对象。\r * @typedef {(String|Object)} GroupFlag\r * @example\r * //以下均为合法参数\r *\r * //群组属性值\r * \"工作汇报读者@ReportReader@G\" //群组识别名\r * \"cce8bc22-225a-4f85-8132-7374d546886e\" //id\r * \"ReportReader\" //群组unique\r * \"工作汇报读者\" //群组名称\r *\r * //包含下列属性的对象\r * { \"distinguishedName\": \"工作汇报读者@ReportReader@G\" } //群组识别名\r * { \"unique\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //群组id\r * { \"unique\": \"ReportReader\" } //群组unique\r * { \"name\": \"工作汇报读者\" } //群组名称\r */\r \r \r /**\r * 在本API的this.org模块中，当使用人员(个人)作为检索参数的时候，允许使用人员的distinguishedName、name、id、unique属性值或包含这些属性的对象。\r * @typedef {(String|Object)} PersonFlag\r * @example\r * //以下均为合法参数\r *\r * //人员属性值\r * \"李四@lisi@P\" //人员识别名\r * \"cce8bc22-225a-4f85-8132-7374d546886e\" //人员id\r * \"lisi\" //人员unique\r * \"李四\" //人员名称，不重名时才有效\r *\r * //包含下列属性的对象\r * { \"distinguishedName\": \"李四@lisi@P\" } //人员识别名\r * { \"id\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //人员id\r * { \"unique\": \"lisi\" } //人员unique\r * { \"name\": \"李四\" } //人员名称，不重名时才有效\r */\r \r /**\r * 在本API的this.org模块中，当使用角色作为检索参数的时候，允许使用角色的distinguishedName、name、id、unique属性值或包含这些属性的对象。\r * @typedef {(String|Object)} RoleFlag\r * @example\r * //以下均为合法参数\r \r * //角色属性值\r * \"PersonManager@PersonManagerSystemRole@R\" //角色识别名\r * \"85874fbc-9af0-4a07-bc2f-0ab899cc4c7d\" //角色id\r * \"PersonManagerSystemRole\" //角色unique\r * \"PersonManager\" //角色名称\r *\r * //包含下列属性的对象\r * { \"distinguishedName\": \"PersonManager@PersonManagerSystemRole@R\" } //角色识别名\r * { \"id\": \"85874fbc-9af0-4a07-bc2f-0ab899cc4c7d\" } //角色id\r * { \"unique\": \"PersonManagerSystemRole\" } //角色unique\r * { \"name\": \"PersonManager\" } //角色名称\r */\r \r /**\r * 在本API的this.org模块中，当使用身份作为检索参数的时候，允许使用身份的distinguishedName、name、id、unique属性值或包含这些属性的对象。\r * @typedef {(String|Object)} IdentityFlag\r * @example\r * //以下均为合法参数\r \r * //角色属性值\r * \"张三@903dbb04-085c-4bb1-9c24-3009bd5f7372@I\" //身份识别名\r * \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" //身份id\r * \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" //身份unique，系统默认的unique和id一致\r * \"张三\" //身份名称，有可能存在重名，需要精确匹配的请不要使用\r *\r * //包含下列属性的对象\r * { \"distinguishedName\": \"张三@903dbb04-085c-4bb1-9c24-3009bd5f7372@I\" } //身份识别名\r * { \"id\": \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" } //身份id\r * { \"unique\": \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" } //身份unique，系统默认的unique和id一致\r * { \"name\": \"张三\" } //身份名称，有可能存在重名，需要精确匹配的请不要使用\r */\r \r /**\r * 在本API的this.org模块中，当使用组织作为检索参数的时候，允许使用组织的distinguishedName、name、id、unique属性值或包含这些属性的对象。\r * @typedef {(String|Object)} UnitFlag\r * @example\r * //以下均为合法参数\r \r * //组织属性值\r * \"开发部@kfb@U\" //组织标识名\r * \"cce8bc22-225a-4f85-8132-7374d546886e\" //组织id\r * \"kfb\" //组织unique\r * \"开发部\" //组织名称，有可能存在重名，需要精确匹配的请不要使用\r *\r * //包含下列属性的对象\r * { \"distinguishedName\": \"开发部@kfb@U\" } //组织标识名\r * { \"id\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //身份id\r * { \"unique\": \"kfb\" } //组织unique\r * { \"name\": \"开发部\" } //组织名称，有可能存在重名，需要精确匹配的请不要使用\r */\r \r MWF.xScript = MWF.xScript || {};\r MWF.xScript.ViewEnvironment = function (ev) {\r var _form = ev.view;\r \r this.library = COMMON;\r //this.library.version = \"4.0\";\r \r //data\r // var getJSONData = function (jData) {\r // return new MWF.xScript.JSONData(jData, function (data, key, _self) {\r // var p = { \"getKey\": function () { return key; }, \"getParent\": function () { return _self; } };\r // while (p &amp;&amp; !_forms[p.getKey()]) p = p.getParent();\r // if (p) if (p.getKey()) if (_forms[p.getKey()]) _forms[p.getKey()].resetData();\r // });\r // };\r // this.setData = function (data) {\r // this.data = getJSONData(data);\r // this.data.save = function (callback) {\r // var formData = {\r // \"data\": data,\r // \"sectionList\": _form.getSectionList()\r // };\r // form.workAction.saveData(function (json) { if (callback) callback(); }.bind(this), null, work.id, jData);\r // }\r // };\r // this.setData(_data);\r \r //dict\r /**\r * this.Dict是一个工具类，如果您在流程、门户中创建了数据字典，可以使用this.Dict类对数据字典进行增删改查操作。\r * @module Dict\r * @o2ordernumber 120\r * @param {(String|Object)} optionsOrName 数据字典标识字符串或者是对象。\r * &lt;div>如果对本应用的数据字典操作，将optionsOrName设置为string。&lt;/div>\r * &lt;pre>&lt;code class='language-js'>var dict = new this.Dict(\"bulletinDictionary\"); //数据字典的名称、别名或id\r * &lt;/code>&lt;/pre>\r * &lt;div>如果需要对其他应用的数据字典进行操作，将options设置为JsonObject&lt;/div>\r * &lt;pre>&lt;code class='language-js'>var dict = new this.Dict({\r * //type: 应用类型。可以为process cms。\r * //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。\r * //比如在流程的A应用脚本中引用流程B应用的脚本配置，则type可以省略。\r * type : \"cms\",\r * application : \"bulletin\", //流程、CMS的名称、别名、id, 默认为当前应用\r * name : \"bulletinDictionary\", // 数据字典的名称、别名、id\r * enableAnonymous : true //允许用户在未登录的情况下读取cms的数据字典, type为process的时候此参数无效，默认为false\r * });\r * &lt;/code>&lt;/pre>\r * @return {Object} Dict对象\r * @o2syntax\r * //您可以在页面、表单、流程各个嵌入脚本中，通过this.Dict()对本应用或其他应用的数据字典中的数据进行增删改查，如下：\r * var dict = new this.Dict( options )\r */\r \r /**\r * 根据路径获取数据字典中的数据。\r * @method get\r * @methodOf module:Dict\r * @static\r * @param {String} [path] 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。当值为空的时候，表示获取数据字典中的所有数据。\r * @param {Function} [success] 获取数据成功时的回调函数。\r * @param {Function} [failure] 获取数据失败时的回调。\r * @param {Boolean} [async] 是否异步执行，默认为false。\r * @param {Boolean} [refresh] 是否忽略本地缓存直接从服务器获取，默认为false。\r * @return {(Promise|Object|Array|String|Number|Boolean)}\r * 当async为true时返回Promise({@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise说明})；\r * 否则返回数据字典的数据，类型和配置数据字典时候指定的一致。\r * @o2syntax\r * var data = dict.get( path, success, failure, async, refresh )\r * @example\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * //没有参数的时候，表示同步获取获取所有数据\r * var data = dict.get()\r *\r * //同步执行，获取category下key为subCategory的数据\r * var data = dict.get(\"category.subCategory\");\r *\r * //异步执行，使用回调处理数据，如果category为数组，获取第0项数据\r * dict.get(\"category.0\", function(data){\r * //data 是数据字典的数据\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * }, true //异步执行\r * )\r *\r * //异步执行，使用Promise处理结果\r * var promise = dict.get(\"category\", null, null, true);\r * promise.then( function(data){\r * //data 是数据字典的数据\r * })\r * @example\r * &lt;caption>\r * 已经配置好了如下图所示的数据字典\r * &lt;img src='img/module/Dict/dict.png' />\r * &lt;/caption>\r * var dict = new this.Dict({\r * //type: 应用类型。可以为process cms。\r * //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。\r * //比如在流程的A应用脚本中引用流程B应用的脚本配置，则type可以省略。\r * type : \"cms\",\r * application : \"bulletin\", //流程、CMS的名称、别名、id, 默认为当前应用\r * name : \"bulletinDictionary\", // 数据字典的名称、别名、id\r * enableAnonymous : true //允许用户在未登录的情况下读取cms的数据字典, type为process的时候此参数无效，默认为false\r * });\r *\r * var data = dict.get();\r * //data的值为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * }\r * ]\r * }\r *\r * var category = dict.get(\"category\");\r * //category的值为\r * [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * }\r * ]\r *\r * var array0 = dict.get(\"category.0\");\r * //array0 的值为\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * }\r *\r * var enable = dict.get(\"category.0.eanble\");\r * //enable 的值为 true\r */\r \r /**\r * 根据路径新增数据字典的数据。\r * @method add\r * @methodOf module:Dict\r * @instance\r * @param {String} path 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果path在数据字典中已有数据，且原有数据是数组，则数组添加一项；如果原有数据不是数组，则报错。\r * @param {(Object|Array|String|Number|Boolean)} data 需要新增的数据\r * @param {Function} [success] 增加数据成功时的回调函数。\r * @param {Function} [failure] 增加数据错误时的回调函数。\r * @o2syntax\r * dict.add( path, data, success, failure )\r * @example\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.add( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r * //data 形如\r * //{\r * // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r * //}\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * });\r * @example\r * &lt;caption>\r * 对get方法样例的数据字典进行赋值，如下：\r * &lt;/caption>\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.add( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r * //data 形如\r * //{\r * // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r * //}\r * }, function(xhr, text, error){\r * //xhr 为 xmlHttpRequest, text 为错误文本， error为Error对象\r * });\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"text\": \"系统公告\",\r * \"value\": \"system\"\r * }\r * ]\r * }\r *\r * dict.add( \"category.2.sequence\", 3 );\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"sequence\" : 3.0,\r * \"text\": \"系统公告\",\r * \"value\": \"system\"\r * }\r * ]\r * }\r \r * dict.add( \"archiveOptions\", {\r * \"yes\" : \"是\",\r * \"no\" : \"否\"\r * });\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"sequence\" : 3.0,\r * \"text\": \"系统公告\",\r * \"value\": \"system\"\r * }\r *\r * ],\r * \"archiveOptions\" : {\r * \"yes\" : \"是\",\r * \"no\" : \"否\"\r * }\r * }\r * @example\r * &lt;caption>下面是错误的赋值，如下：&lt;/caption>\r * dict.add( \"category.3\", { text : \"系统公告\", value : \"system\" }); //出错，因为不能对数组下标直接赋值\r *\r * dict.add( \"category.1.value\", { text : \"系统公告\" } ); //出错，因为不能对已经存在的非数组路径赋值\r */\r \r /**\r * 根据路径修改数据字典的数据。\r * @method set\r * @methodOf module:Dict\r * @instance\r * @param {String} path 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果数据路径不存在，则报错。\r * @param {(Object|Array|String|Number|Boolean)} data 修改后的数据\r * @param {Function} [success] 设置数据成功时的回调函数。\r * @param {Function} [failure] 设置数据错误时的回调函数。\r * @o2syntax\r * dict.set( path, data, success, failure )\r * @example\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.set( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r * //data 形如\r * //{\r * // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r * //}\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * });\r * @example\r * &lt;caption>\r * 对Example add的数据字典进行赋值，如下：\r * &lt;/caption>\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.set( \"archiveOptions\", [ { text : \"是\" }, { text : \"否\" } ]);\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"sequence\" : 3.0,\r * \"text\": \"系统公告\",\r * \"value\": \"system\"\r * }\r *\r * ],\r * \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r * }\r *\r * dict.set( \"category.2\", { text : \"县级公告\", value : \"county\" }, function(data){\r * //data 形如\r * //{\r * // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r * //}\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * });\r *\r * /数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 2.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"text\": \"县级公告\",\r * \"value\": \"county\"\r * }\r * ],\r * \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r * }\r *\r * dict.set( \"category.1.sequence\", 3 );\r * dict.set( \"category.2.sequence\", 2 );\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 3.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"sequence\": 2.0,\r * \"text\": \"县级公告\",\r * \"value\": \"county\"\r * }\r * ],\r * \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r * }\r * @example\r * &lt;caption>\r * 下面是错误的赋值：\r * &lt;/caption>\r * dict.set( \"category_1\", { text : \"公司公告\" } ); //出错，因为category_1在数据字典中不存在\r */\r \r /**\r * 根据路径删除数据字典的数据。\r * @method delete\r * @methodOf module:Dict\r * @instance\r * @param {String} path 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果数据路径不存在，则报错。\r * @param {Function} [success] 删除数据成功时的回调函数。\r * @param {Function} [failure] 删除数据错误时的回调函数。\r * @o2syntax\r * dict.delete( path, success, failure )\r * @example\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.delete( \"category\", function(){\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * });\r * @example\r * &lt;caption>\r * 对Example set的数据字典进行赋值，如下：\r * &lt;/caption>\r * var dict = new this.Dict(\"bulletinDictionary\");\r *\r * dict.delete( \"archiveOptions\");\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 3.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"sequence\": 2.0,\r * \"text\": \"县级公告\",\r * \"value\": \"county\"\r * }\r * ]\r * }\r *\r * dict.delete( \"category.2.sequence\", function(data){\r * //data 形如\r * //{\r * // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r * //}\r * }, function(xhr){\r * //xhr 为 xmlHttpRequest\r * });\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 3.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * },\r * {\r * \"text\": \"县级公告\",\r * \"value\": \"county\"\r * }\r * ]\r * }\r *\r * dict.delete( \"category.2\");\r * //数据字典的值变为\r * {\r * \"category\": [\r * {\r * \"enable\": true,\r * \"sequence\": 1.0,\r * \"text\": \"公司公告\",\r * \"value\": \"company\"\r * },\r * {\r * \"enable\": \"false\",\r * \"sequence\": 3.0,\r * \"text\": \"部门公告\",\r * \"value\": \"department\"\r * }\r * ]\r * }\r * @example\r * &lt;caption>\r * 下面是错误的删除：\r * &lt;/caption>\r * dict.delete( \"category_1\" ); //出错，因为category_1在数据字典中不存在\r */\r \r this.Dict = MWF.xScript.createDict();\r //org\r var orgActions = null;\r var getOrgActions = function () {\r if (!orgActions) {\r MWF.require(\"MWF.xScript.Actions.UnitActions\", null, false);\r orgActions = new MWF.xScript.Actions.UnitActions();\r }\r };\r var getNameFlag = function (name) {\r var t = typeOf(name);\r if (t === \"array\") {\r var v = [];\r name.each(function (id) {\r v.push((typeOf(id) === \"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id);\r });\r return v;\r } else {\r return [(t === \"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name];\r }\r };\r \r /**\r * 您可以通过this.org获取组织中的人员、人员属性、组织、组织属性、身份、群组和角色。\r * @module org\r * @o2ordernumber 100\r * @o2syntax\r * //您可以在流程表单、内容管理表单、门户页面、视图和查询视图中，通过this来获取当前实例的org对象，如下：\r * var org = this.org;\r */\r this.org = {\r //身份**********\r //获取身份\r /**\r 根据身份标识获取对应的身份对象或数组\r * @method getIdentity\r * @o2membercategory identity\r * @methodOf module:org\r * @static\r * @param {IdentityFlag|IdentityFlag[]} name - 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|IdentityData|IdentityData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回身份，单个是Object，多个是Array。\r * @o2ActionOut x_organization_assemble_express.IdentityAction.listObject|example=Identity|ignoreNoDescr=true|ignoreProps=[woUnitDutyList,woUnit,woGroupList]\r * @o2syntax\r * //同步执行，返回身份，单个是对象，多个是数组。\r * var identityList = this.org.getIdentity( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getIdentity( name, true);\r * promise.then(function(identityList){\r * //identityList 为返回的身份，单个是对象，多个是数组。\r * })\r *\r * //异步执行，在回调方法中获取身份\r * this.org.getIdentity( name, function(identityList){\r * //identityList 为返回的身份，单个是对象，多个是数组。\r * })\r */\r getIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的身份\r /**\r * 根据人员标识获取对应的身份对象数组。\r * @method listIdentityWithPerson\r * @o2membercategory identity\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|IdentityData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回身份对象数组。\r * @o2ActionOut x_organization_assemble_express.IdentityAction.listWithPersonObject|example=Identity\r * @o2syntax\r * //同步执行，返回身份对象数组。\r * var identityList = this.org.listIdentityWithPerson( person );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listIdentityWithPerson( person, true);\r * promise.then(function(identityList){\r * //identityList 返回的身份对象数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listIdentityWithPerson( person, function(identityList){\r * //identityList 返回的身份对象数组。\r * })\r */\r listIdentityWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listIdentityWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员身份--返回身份的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r /**\r * 根据组织标识获取对应的身份对象数组：identity对象数组。\r * @method listIdentityWithUnit\r * @o2membercategory identity\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有身份成员；false直接身份成员；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|IdentityData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回身份对象数组。\r * @o2ActionOut x_organization_assemble_express.IdentityAction.listWithUnitSubNestedObject|example=Identity\r * @o2syntax\r * //同步执行，返回直接组织身份对象数组。\r * var identityList = this.org.listIdentityWithUnit( unit );\r *\r *\r * //同步执行，返回嵌套组织身份对象数组。\r * var identityList = this.org.listIdentityWithUnit( unit, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listIdentityWithUnit( unit, false, true);\r * promise.then(function(identityList){\r * //identityList 返回直接组织身份对象数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listIdentityWithUnit( unit, false, function(identityList){\r * //identityList 返回直接组织身份对象数组。\r * })\r */\r listIdentityWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r \r // var cb = function(json){\r // v = json.data;\r // if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r // return v;\r // }.ag().catch(function(json){ return json; });\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var method = (nested) ? \"listIdentityWithUnitNested\" : \"listIdentityWithUnitDirect\";\r var promise = orgActions[method](data, cb, null, !!async);\r promise.name = \"org\";\r \r //\r // if (nested){\r // orgActions.listIdentityWithUnitNested(data, cb, null, !!async);\r // }else{\r // orgActions.listIdentityWithUnitDirect(data, cb, null, !!async);\r // }\r return (!!async) ? promise : v;\r },\r \r //组织**********\r //获取组织\r /**\r 根据组织标识获取对应的组织：unit对象或数组\r * @method getUnit\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织，单个是Object，多个是Array。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织，单个是对象，多个是数组。\r * var unitList = this.org.getUnit( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getUnit( name, true);\r * promise.then(function(unitList){\r * //unitList 为返回的组织，单个是对象，多个是数组。\r * })\r *\r * //异步执行，在回调方法中获取组织\r * this.org.getUnit( name, function(unitList){\r * //unitList 为返回的组织，单个是对象，多个是数组。\r * })\r */\r getUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织的下级--返回组织的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r /**\r 根据组织标识获取下级组织的对象数组：unit对象数组。\r * @method listSubUnit\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有下级组织；false直接下级组织；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithUnitSubNestedObject|example=Unit\r * @o2syntax\r * //同步执行，返回嵌套下级组织数组。\r * var unitList = this.org.listSubUnit( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSubUnit( name, false, true);\r * promise.then(function(unitList){\r * //unitList 为返回的直接下级组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listSubUnit( name, true, function(unitList){\r * //unitList 为返回嵌套下级组织数组。\r * })\r */\r listSubUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询组织的上级--返回组织的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r //async 布尔 true异步请求\r /**\r 根据组织标识批量获取上级组织的对象数组：unit对象数组。\r * @method listSupUnit\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有上级组织；false直接上级组织；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithUnitSupNestedObject|example=Unit\r * @o2syntax\r * //同步执行，返回嵌套上级组织数组。\r * var unitList = this.org.listSupUnit( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSupUnit( name, false, true);\r * promise.then(function(unitList){\r * //unitList 为返回的直接上级组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listSupUnit( name, true, function(unitList){\r * //unitList 为返回嵌套上级组织数组。\r * })\r */\r listSupUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listUnitSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listUnitSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // if (callback){\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data; o2.runCallback(callback, \"success\", [v], this);});\r // }\r // }else{\r // var v = null;\r // if (nested){\r // orgActions.listUnitSupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listUnitSupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r // }\r },\r //根据个人身份获取组织\r //flag 数字 表示获取第几层的组织\r // 字符串 表示获取指定类型的组织\r // 空 表示获取直接所在的组织\r /**\r 根据个人身份获取组织：unit对象或数组。\r * @method getUnitByIdentity\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {IdentityFlag} name - 身份的distinguishedName、name、id、unique属性值，身份对象。\r * @param {String|Number} [flag] 当值为数字的时候， 表示获取第几层的组织。&lt;br/> 当值为字符串的时候，表示获取指定类型的组织。&lt;br/> 当值为空的时候，表示获取直接所在组织。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回对应组织，单个为对象，多个为数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.getWithIdentityWithLevelObject|example=Unit\r * @o2syntax\r * //同步执行，返回直接所在组织，单个为对象，多个为数组。\r * var unitList = this.org.getUnitByIdentity( name );\r *\r * //同步执行，返回第一层组织，单个为对象，多个为数组。\r * var unitList = this.org.getUnitByIdentity( name, 1 );\r *\r * * //同步执行，返回类型为company的组织，单个为对象，多个为数组。\r * var unitList = this.org.getUnitByIdentity( name, \"company\" );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getUnitByIdentity( name, null, true);\r * promise.then(function(unitList){\r * //unitList 返回直接所在组织，单个为对象，多个为数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.getUnitByIdentity( name, 1, function(unitList){\r * //unitList 返回第一层组织，单个为对象，多个为数组。\r * })\r */\r getUnitByIdentity: function(name, flag, async){\r getOrgActions();\r var getUnitMethod = \"current\";\r var v;\r if (flag){\r if (typeOf(flag)===\"string\") getUnitMethod = \"type\";\r if (typeOf(flag)===\"number\") getUnitMethod = \"level\";\r }\r \r var cb;\r var promise;\r switch (getUnitMethod){\r case \"current\":\r var data = {\"identityList\":getNameFlag(name)};\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v; return v;\r // }.ag().catch(function(json){ return json; });\r \r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r \r promise = orgActions.listUnitWithIdentity(data, cb, null, !!async);\r break;\r case \"type\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"type\":flag};\r \r cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndType(data, cb, null, !!async);\r break;\r case \"level\":\r var data = {\"identity\":(typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name,\"level\":flag};\r \r cb = function(json){\r v = json.data; v=(v&amp;&amp;v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data; return v;\r // }.ag().catch(function(json){ return json; });\r \r promise = orgActions.getUnitWithIdentityAndLevel(data, cb, null, !!async);\r break;\r }\r return (!!async) ? promise : v;\r },\r //列出身份所在组织的所有上级组织\r /**\r * 批量查询身份所在的组织,并递归查找其上级组织对象.\r * @method listAllSupUnitWithIdentity\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {IdentityFlag|IdentityFlag[]} name - 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithIdentitySupNestedObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织数组。\r * var unitList = this.org.listAllSupUnitWithIdentity( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listAllSupUnitWithIdentity( name, true);\r * promise.then(function(unitList){\r * //unitList 返回组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listAllSupUnitWithIdentity( name, function(unitList){\r * //unitList 返回组织数组。\r * })\r */\r listAllSupUnitWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取人员所在的所有组织\r /**\r * 根据个人标识批量获取组织对象成员：Unit对象数组。\r * @method listUnitWithPerson\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithPersonObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织数组。\r * var unitList = this.org.listUnitWithPerson( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitWithPerson( name, true);\r * promise.then(function(unitList){\r * //unitList 返回组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitWithPerson( name, function(unitList){\r * //unitList 返回组织数组。\r * })\r */\r listUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所在组织的所有上级组织\r /**\r * 根据个人标识批量查询所在组织及所有上级组织：Unit对象数组。\r * @method listAllSupUnitWithPerson\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回个人所在组织及所有上级组织。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithPersonSupNestedObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织数组。\r * var unitList = this.org.listAllSupUnitWithPerson( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listAllSupUnitWithPerson( name, true);\r * promise.then(function(unitList){\r * //unitList 返回组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listAllSupUnitWithPerson( name, function(unitList){\r * //unitList 返回组织数组。\r * })\r */\r listAllSupUnitWithPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitSupNestedWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织属性，获取所有符合的组织\r /**\r * 根据组织属性，获取所有符合的组织。\r * @method listUnitWithAttribute\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {String} attributeName 组织属性名称。\r * @param {String} attributeValue 组织属性值。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithUnitAttributeObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织数组。\r * var unitList = this.org.listUnitWithAttribute( attributeName, attributeName );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitWithAttribute( attributeName, attributeName, true);\r * promise.then(function(unitList){\r * //unitList 返回组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitWithAttribute( attributeName, attributeName, function(unitList){\r * //unitList 返回组织数组。\r * })\r */\r listUnitWithAttribute: function(name, attribute, async){\r getOrgActions();\r var data = {\"name\":name,\"attribute\":attribute};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r promise = orgActions.listUnitWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据组织职务，获取所有符合的组织\r /**\r * 根据组织职务，获取所有符合的组织。\r * @method listUnitWithDuty\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {String} dutyName 组织职务名称。\r * @param {IdentityFlag} identity 身份的distinguishedName、name、id、unique属性值，身份对象。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listWithUnitDutyObject|example=Unit\r * @o2syntax\r * //同步执行，返回组织数组。\r * var unitList = this.org.listUnitWithDuty( dutyName, identity );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitWithDuty( dutyName, identity, true);\r * promise.then(function(unitList){\r * //unitList 返回组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitWithDuty( dutyName, identity, function(unitList){\r * //unitList 返回组织数组。\r * })\r */\r listUnitWithDuty: function(name, id, async){\r getOrgActions();\r var data = {\"name\":name,\"identity\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitWithDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r /**\r * 列式所有顶层组织。\r * @method listTopUnit\r * @o2membercategory unit\r * @methodOf module:org\r * @static\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|UnitData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回顶层组织数组。\r * @o2ActionOut x_organization_assemble_express.UnitAction.listObject|example=Unit\r * @o2syntax\r * //同步执行，返回顶层组织数组。\r * var unitList = this.org.listTopUnit();\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listTopUnit(true);\r * promise.then(function(unitList){\r * //unitList 返回顶层组织数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listTopUnit(function(unitList){\r * //unitList 返回顶层组织数组。\r * })\r */\r listTopUnit: function(async){\r var action = MWF.Actions.get(\"x_organization_assemble_control\");\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = action.listTopUnit(cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //人员\r //获取人员--返回人员的对象数组\r /**\r 根据人员标识获取对应的人员对象或数组：person对象或数组\r * @method getPerson\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员，单个是Object，多个是Array。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listObject|example=Person\r * @o2syntax\r * //同步执行，返回人员，单个是对象，多个是数组。\r * var personList = this.org.getPerson( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getPerson( name, true);\r * promise.then(function(personList){\r * //personList 为返回的人员，单个是对象，多个是数组。\r * })\r *\r * //异步执行，在回调方法中获取人员\r * this.org.getPerson( name, function(personList){\r * //personList 为返回的人员，单个是对象，多个是数组。\r * })\r */\r getPerson: function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listPerson(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级人员--返回人员的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r /**\r 根据人员标识获取下级人员的对象数组：person对象数组。该上下级关系被人员的汇报对象值（superior）决定。\r * @method listSubPerson\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有下级人员；false直接下级人员；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithPersonSubDirectObject|example=Person\r * @o2syntax\r * //同步执行，返回嵌套下级人员数组。\r * var personList = this.org.listSubPerson( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSubPerson( name, false, true);\r * promise.then(function(personList){\r * //personList 为返回的直接下级人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listSubPerson( name, true, function(personList){\r * //personList 为返回嵌套下级人员数组。\r * })\r */\r listSubPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSubNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSubDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //查询上级人员--返回人员的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r /**\r *根据人员标识获取上级人员的对象数组：person对象数组。该上下级关系被人员的汇报对象值（superior）决定。\r * @method listSupPerson\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有上级人员；false直接上级人员；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithPersonSupDirectObject|example=Person\r * @o2syntax\r * //同步执行，返回嵌套上级人员数组。\r * var personList = this.org.listSupPerson( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSupPerson( name, false, true);\r * promise.then(function(personList){\r * //personList 为返回的直接上级人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listSupPerson( name, true, function(personList){\r * //personList 为返回嵌套上级人员数组。\r * })\r */\r listSupPerson: function(name, nested, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonSupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonSupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //获取群组的所有人员--返回人员的对象数组\r /**\r * 根据群组标识获取人员对象成员：person对象数组。\r * @method listPersonWithGroup\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {GroupFlag|GroupFlag[]} name - 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员对象数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithGroupObject|example=Person\r * @o2syntax\r * //同步执行，返回人员数组。\r * var personList = this.org.listPersonWithGroup( group );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonWithGroup( group, true);\r * promise.then(function(personList){\r * //personList 为返回的人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonWithGroup( group, function(personList){\r * //personList 为返回的人员数组。\r * })\r */\r listPersonWithGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取角色的所有人员--返回人员的对象数组\r /**\r * 根据角色标识获取人员对象数组：person对象数组。\r * @method listPersonWithRole\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {RoleFlag|RoleFlag[]} name - 角色的distinguishedName、name、id、unique属性值，角色对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员对象数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithRoleObject|example=Person\r * @o2syntax\r * //同步执行，返回人员数组。\r * var personList = this.org.listPersonWithRole( role );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonWithRole( role, true);\r * promise.then(function(personList){\r * //personList 为返回的人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonWithRole( role, function(personList){\r * //personList 为返回的人员数组。\r * })\r */\r listPersonWithRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r promise = orgActions.listPersonWithRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组\r /**\r * 根据身份标识获取人员对象成员：person对象数组。\r * @method listPersonWithIdentity\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {IdentityFlag|IdentityFlag[]} name - 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员对象数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithIdentityObject|example=Person\r * @o2syntax\r * //同步执行，返回人员数组。\r * var personList = this.org.listPersonWithIdentity( identity );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonWithIdentity( identity, true);\r * promise.then(function(personList){\r * //personList 为返回的人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonWithIdentity( identity, function(personList){\r * //personList 为返回的人员数组。\r * })\r */\r listPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有人员--返回人员的对象数组或人员对象\r getPersonWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //查询组织成员的人员--返回人员的对象数组\r //nested 布尔 true嵌套的所有成员；false直接成员；默认false；\r /**\r * 根据组织标识获取人员对象成员：person对象数组。\r * @method listPersonWithUnit\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] 是否嵌套获取组织以及下级组织的人员，true表示嵌套，flase表示获取直接组织。默认为false\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员对象数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithUnitSubDirectObject|example=Person\r * @o2syntax\r * //同步执行，返回组织的直接人员数组。\r * var personList = this.org.listPersonWithUnit( unit );\r *\r * //同步执行，返回组织的以及嵌套下级组织所有的人员数组。\r * var personList = this.org.listPersonWithUnit( unit, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonWithUnit( unit, false, true);\r * promise.then(function(personList){\r * //personList 为返回的组织的直接人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonWithUnit( unit, false, function(personList){\r * //personList 为返回的群组的直接人员数组。\r * })\r */\r listPersonWithUnit: function(name, nested, async){\r getOrgActions();\r var data = {\"unitList\": getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listPersonWithUnitNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listPersonWithUnitDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的对象数组\r //name string 属性名\r //value string 属性值\r /**\r * 根据人员属性名称和属性值获取人员对象成员：person对象数组。\r * @method listPersonWithAttribute\r * @o2membercategory person\r * @methodOf module:org\r * @static\r * @param {String} name 人员属性名称。\r * @param {String} value 人员属性值。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|PersonData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员对象数组。\r * @o2ActionOut x_organization_assemble_express.PersonAction.listWithPersonAttributeObject|example=Person\r * @o2syntax\r * //同步执行，返回拥有对应属性名和属性值人员数组。\r * var personList = this.org.listPersonWithAttribute( name, value );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonWithAttribute( name, value, true);\r * promise.then(function(personList){\r * //personList 返回拥有对应属性名和属性值人员数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonWithAttribute( name, value, function(personList){\r * //personList 返回拥有对应属性名和属性值人员数组。\r * })\r */\r listPersonWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //根据属性查询人员--返回人员的全称数组\r //name string 属性名\r //value string 属性值\r listPersonNameWithAttribute: function(name, value, async){\r getOrgActions();\r var data = {\"name\": name, \"attribute\": value};\r var v = null;\r var cb = function(json){\r v = json.data.personList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonWithAttributeValue(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织职务***********\r //获取指定的组织职务的身份\r /**\r * 根据职务名称和组织名称获取身份。\r * @method getDuty\r * @o2membercategory duty\r * @methodOf module:org\r * @static\r * @param {String} dutyName 组织职务名称。\r * @param {UnitFlag} unit 组织的distinguishedName、name、id、unique属性值，组织对象。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|IdentityData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回身份数组。\r * @o2ActionOut x_organization_assemble_express.UnitDutyAction.getWithUnitWithName|example=Identity\r * @o2syntax\r * //同步执行，返回身份数组。\r * var identityList = this.org.getDuty( dutyName, unit );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getDuty( dutyName, unit, true);\r * promise.then(function(identityList){\r * //identityList 返回身份数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.getDuty( dutyName, unit, function(unitList){\r * //unitList 返回身份数组。\r * })\r */\r getDuty: function(duty, id, async){\r getOrgActions();\r var data = {\"name\":duty,\"unit\":(typeOf(id)===\"object\") ? (id.distinguishedName || id.id || id.unique || id.name) : id};\r var v = null;\r \r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取身份的所有职务名称\r /**\r * 批量获取身份的所有职务名称。\r * @method listDutyNameWithIdentity\r * @o2membercategory duty\r * @methodOf module:org\r * @static\r * @param {IdentityFlag|IdentityFlag[]} identity - 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回职务名称数组。\r * @o2syntax\r * //同步执行，返回职务名称数组。\r * var dutyNameList = this.org.listDutyNameWithIdentity( identity );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listDutyNameWithIdentity( identity, true);\r * promise.then(function(dutyNameList){\r * //dutyNameList 返回职务名称数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listDutyNameWithIdentity( identity, function(dutyNameList){\r * //dutyNameList 返回职务名称数组。\r * })\r */\r listDutyNameWithIdentity: function(name, async){\r getOrgActions();\r var data = {\"identityList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithIdentity(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //批量获取组织的所有职务名称\r /**\r * 批量获取组织的所有职务名称。\r * @method listDutyNameWithUnit\r * @o2membercategory duty\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} unit - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回职务名称数组。\r * @o2syntax\r * //同步执行，返回职务名称数组。\r * var dutyNameList = this.org.listDutyNameWithUnit( unit );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listDutyNameWithUnit( unit, true);\r * promise.then(function(dutyNameList){\r * //dutyNameList 返回职务名称数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listDutyNameWithUnit( unit, function(dutyNameList){\r * //dutyNameList 返回职务名称数组。\r * })\r */\r listDutyNameWithUnit: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listDutyNameWithUnit(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //获取组织的所有职务\r /**\r * 批量获取组织的所有职务。\r * @method listUnitAllDuty\r * @o2membercategory duty\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} unit - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|Object[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回职务数组\r * @o2ActionOut x_organization_assemble_express.UnitDutyAction.listWithUnitObject|example=UnitDuty\r * @o2syntax\r * //同步执行，返回职务数组。\r * var dutyList = this.org.listUnitAllDuty( unit );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitAllDuty( unit, true);\r * promise.then(function(dutyList){\r * //dutyList 返回职务数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitAllDuty( unit, function(dutyList){\r * //dutyList 返回职务数组。\r * })\r */\r listUnitAllDuty: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllDuty(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //群组***************\r //获取群组--返回群组的对象数组\r /**\r 根据群组标识获取对应的群组对象或数组：group对象或数组\r * @method getGroup\r * @o2membercategory group\r * @methodOf module:org\r * @static\r * @param {GroupFlag|GroupFlag[]} name - 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|GroupData|GroupData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回群组，单个是Object，多个是Array。\r * @o2ActionOut x_organization_assemble_express.GroupAction.listObject|example=Group\r * @o2syntax\r * //同步执行，返回群组，单个是Object，多个是Array。\r * var groupList = this.org.getGroup( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getGroup( name, true);\r * promise.then(function(groupList){\r * //groupList 为返回的群组，单个是Object，多个是Array。\r * })\r *\r * //异步执行，在回调方法中获取群组\r * this.org.getGroup( name, function(groupList){\r * //groupList 为返回的群组，单个是Object，多个是Array。\r * })\r */\r getGroup: function(name, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r \r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroup(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listGroup(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //查询下级群组--返回群组的对象数组\r //nested 布尔 true嵌套下级；false直接下级；默认false；\r /**\r 根据群组标识获取下级群组的对象数组：group对象数组。\r * @method listSubGroup\r * @o2membercategory group\r * @methodOf module:org\r * @static\r * @param {GroupFlag|GroupFlag[]} name - 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有下级群组；false直接下级群组；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|GroupData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回群组数组。\r * @o2ActionOut x_organization_assemble_express.GroupAction.listWithGroupSubDirectObject|example=Group\r * @o2syntax\r * //同步执行，返回嵌套下级群组数组。\r * var groupList = this.org.listSubGroup( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSubGroup( name, false, true);\r * promise.then(function(groupList){\r * //groupList 为返回的直接下级群组数组。\r * })\r *\r * //异步执行，在回调方法中获取群组\r * this.org.listSubGroup( name, true, function(groupList){\r * //groupList 为返回嵌套下级群组数组。\r * })\r */\r listSubGroup: function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r // var cb = ((async &amp;&amp; o2.typeOf(async)==\"function\") ? (async.isAG ? async : async.ag()) : null) || function(json){\r // v = json.data;\r // return v;\r // }.ag().catch(function(json){ return json; });\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise;\r if (nested){\r promise = orgActions.listSubGroupNested(data, cb, null, !!async);\r }else{\r promise = orgActions.listSubGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r \r // var v = null;\r // if (nested){\r // orgActions.listSubGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSubGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //查询上级群组--返回群组的对象数组\r //nested 布尔 true嵌套上级；false直接上级；默认false；\r /**\r 根据群组标识获取上级群组的对象数组：group对象数组。\r * @method listSupGroup\r * @o2membercategory group\r * @methodOf module:org\r * @static\r * @param {GroupFlag|GroupFlag[]} name - 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。\r * @param {Boolean} [nested] true嵌套的所有上级群组；false直接上级群组；默认false。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|GroupData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回群组数组。\r * @o2ActionOut x_organization_assemble_express.GroupAction.listWithGroupSupDirectObject|example=Group\r * @o2syntax\r * //同步执行，返回嵌套上级群组数组。\r * var groupList = this.org.listSupGroup( name, true );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listSupGroup( name, false, true);\r * promise.then(function(groupList){\r * //groupList 为返回的直接上级群组数组。\r * })\r *\r * //异步执行，在回调方法中获取群组\r * this.org.listSupGroup( name, true, function(groupList){\r * //groupList 为返回嵌套上级群组数组。\r * })\r */\r listSupGroup:function(name, nested, async){\r getOrgActions();\r var data = {\"groupList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise\r if (nested){\r var promise = orgActions.listSupGroupNested(data, cb, null, !!async);\r }else{\r var promise = orgActions.listSupGroupDirect(data, cb, null, !!async);\r }\r return (!!async) ? promise : v;\r // var v = null;\r // if (nested){\r // orgActions.listSupGroupNested(data, function(json){v = json.data;}, null, false);\r // }else{\r // orgActions.listSupGroupDirect(data, function(json){v = json.data;}, null, false);\r // }\r // return v;\r },\r //人员所在群组（嵌套）--返回群组的对象数组\r /**\r * 根据人员标识获取所有的群组对象数组。如果群组具有群组（group）成员，且群组成员中包含该人员，那么该群组也被返回。\r * @method listGroupWithPerson\r * @o2membercategory group\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|GroupData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回群组对象数组。\r * @o2ActionOut x_organization_assemble_express.GroupAction.listWithPersonObject|example=Group\r * @o2syntax\r * //同步执行，返回群组数组。\r * var groupList = this.org.listGroupWithPerson( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listGroupWithPerson( name, true);\r * promise.then(function(groupList){\r * //groupList 为返回的群组数组。\r * })\r *\r * //异步执行，在回调方法中获取群组\r * this.org.listGroupWithPerson( name, function(groupList){\r * //groupList 为返回的群组数组。\r * })\r */\r listGroupWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listGroupWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listGroupWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r \r //角色***************\r //获取角色--返回角色的对象数组\r /**\r * 根据角色标识获取对应的角色对象或数组。\r * @method getRole\r * @o2membercategory role\r * @methodOf module:org\r * @static\r * @param {RoleFlag|RoleFlag[]} name - 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|RoleData|RoleData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回角色，单个为Object，多个为Array。\r * @o2ActionOut x_organization_assemble_express.RoleAction.listObject|example=Role\r * @o2syntax\r * //同步执行，返回角色，单个为对象，多个为数组。\r * var roleList = this.org.getRole( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getRole( name, true);\r * promise.then(function(roleList){\r * //roleList 为返回的角色，单个为对象，多个为数组。\r * })\r *\r * //异步执行，在回调方法中获取角色，单个为对象，多个为数组\r * this.org.getRole( name, function(roleList){\r * //roleList 为返回判断结果。\r * })\r */\r getRole: function(name, async){\r getOrgActions();\r var data = {\"roleList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r v = (v &amp;&amp; v.length===1) ? v[0] : v;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = null;\r // orgActions.listRole(data, function(json){v = json.data;}, null, false);\r // return (v &amp;&amp; v.length===1) ? v[0] : v;\r },\r //人员所有角色（嵌套）--返回角色的对象数组\r /**\r * 根据人员标识获取所有的角色对象数组。如果角色具有群组（group）成员，且群组中包含该人员，那么该角色也被返回。\r * @method listRoleWithPerson\r * @o2membercategory role\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|RoleData[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回角色对象数组。\r * @o2ActionOut x_organization_assemble_express.RoleAction.listWithPersonObject|example=Role\r * @o2syntax\r * //同步执行，返回角色数组。\r * var roleList = this.org.listRoleWithPerson( name );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listRoleWithPerson( name, true);\r * promise.then(function(roleList){\r * //roleList 为返回的角色数组。\r * })\r *\r * //异步执行，在回调方法中获取角色\r * this.org.listRoleWithPerson( name, function(roleList){\r * //roleList 为返回的角色数组。\r * })\r */\r listRoleWithPerson:function(name, async){\r getOrgActions();\r var data = {\"personList\": getNameFlag(name)};\r \r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r // var v = null;\r // orgActions.listRoleWithPerson(data, function(json){v = json.data;}, null, false);\r // return v;\r },\r \r //人员***************\r //人员是否拥有角色--返回true, false\r /**\r * 人员是否拥有角色。\r * @method personHasRole\r * @o2membercategory role\r * @methodOf module:org\r * @static\r * @param {PersonFlag} name - 人员的distinguishedName、name、id、unique属性值，人员对象。\r * @param {RoleFlag|RoleFlag[]} roleList - 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|Boolean} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则如果人员拥有角色返回true, 否则返回false。\r * @o2syntax\r * //同步执行，返回判断结果。\r * var groupList = this.org.personHasRole( name, roleList );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.personHasRole( name, roleList, true);\r * promise.then(function(flag){\r * //flag 为返回判断结果。\r * })\r *\r * //异步执行，在回调方法中获取判断结果\r * this.org.personHasRole( name, roleList, function(flag){\r * //flag 为返回判断结果。\r * })\r */\r personHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"person\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listRoleWithPerson(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.personHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r //群组是否拥有角色--返回true, false\r /**\r * 群组是否拥有角色。\r * @method groupHasRole\r * @o2membercategory role\r * @methodOf module:org\r * @static\r * @param {GroupFlag} name - 群组的distinguishedName、name、id、unique属性值，群组对象。\r * @param {RoleFlag|RoleFlag[]} roleList - 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Promise|Boolean} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则如果群组拥有角色返回true, 否则返回false。\r * @o2syntax\r * //同步执行，返回判断结果。\r * var groupList = this.org.groupHasRole( name, roleList );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.groupHasRole( name, roleList, true);\r * promise.then(function(flag){\r * //flag 为返回判断结果。\r * })\r *\r * //异步执行，在回调方法中获取判断结果\r * this.org.groupHasRole( name, roleList, function(flag){\r * //flag 为返回判断结果。\r * })\r */\r groupHasRole: function(name, role, async){\r getOrgActions();\r nameFlag = (typeOf(name)===\"object\") ? (name.distinguishedName || name.id || name.unique || name.name) : name;\r var data = {\"group\":nameFlag,\"roleList\":getNameFlag(role)};\r \r var v = false;\r var cb = function(json){\r v = json.data.value;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.groupHasRole(data, cb, null, !!async);\r return (!!async) ? promise : v;\r \r // var v = false;\r // orgActions.groupHasRole(data, function(json){v = json.data.value;}, null, false);\r // return v;\r },\r \r //人员属性************\r //添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个)\r /**\r * 添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个)\r * @method appendPersonAttribute\r * @o2membercategory personAttribute\r * @methodOf module:org\r * @static\r * @param {PersonFlag} person - 人员的distinguishedName、name、id、unique属性值，人员对象。\r * @param {String} attr 属性名称。\r * @param {String[]} values 属性值，必须为数组。\r * @param {Function} [success] 执行成功的回调。\r * @param {Function} [failure] 执行失败的回调。\r * @param {(Boolean)} [async] 当参数为boolean，表示是否异步执行，默认为false。\r * @o2syntax\r * //同步执行\r * this.org.appendPersonAttribute( person, attribute, valueArray);\r *\r * //异步执行\r * this.org.appendPersonAttribute( person, attribute, valueArray, function(){\r * //执行成功的回调\r * }, null, true);\r */\r appendPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r },\r //设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个)\r /**\r * 设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个)\r * @method setPersonAttribute\r * @o2membercategory personAttribute\r * @methodOf module:org\r * @static\r * @param {PersonFlag} person - 人员的distinguishedName、name、id、unique属性值，人员对象。\r * @param {String} attr 属性名称。\r * @param {String[]} values 属性值，必须为数组。\r * @param {Function} [success] 执行成功的回调。\r * @param {Function} [failure] 执行失败的回调。\r * @param {(Boolean)} [async] 当参数为boolean，表示是否异步执行，默认为false。\r * @o2syntax\r * //同步执行\r * this.org.setPersonAttribute( person, attribute, valueArray);\r *\r * //异步执行\r * this.org.setPersonAttribute( person, attribute, valueArray, function(){\r * //执行成功的回调\r * }, null, true);\r */\r setPersonAttribute: function(person, attr, values, success, failure, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"attributeList\":values,\"name\":attr,\"person\":personFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.setPersonAttribute(data, cb, null, !!async);\r },\r //获取人员属性值\r /**\r 根据人员和属性名称获取属性值数组。\r * @method getPersonAttribute\r * @o2membercategory personAttribute\r * @methodOf module:org\r * @static\r * @param {PersonFlag} person - 人员的distinguishedName、name、id、unique属性值，人员对象。\r * @param {String} attr 属性名称。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回属性值数组，\r * 如：&lt;pre>&lt;code class='language-js'>[ value1, value2 ]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回该人员的属性值数组。\r * var attributeList = this.org.getPersonAttribute( person, attr );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getPersonAttribute( person, attr, true);\r * promise.then(function(attributeList){\r * //attributeList 为返回该人员的属性值数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.getPersonAttribute( person, attr, function(attributeList){\r * //attributeList 为返回该人员的属性值数组。\r * })\r */\r getPersonAttribute: function(person, attr, async){\r getOrgActions();\r var personFlag = (typeOf(person)===\"object\") ? (person.distinguishedName || person.id || person.unique || person.name) : person;\r var data = {\"name\":attr,\"person\":personFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getPersonAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员所有属性的名称\r /**\r 列出人员所有属性的名称数组。\r * @method listPersonAttributeName\r * @o2membercategory personAttribute\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员属性名称数组，\r * 如：&lt;pre>&lt;code class='language-js'>[ attributeName1, attributeName2 ]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回人员所有属性的名称数组。\r * var attributeNameList = this.org.listPersonAttributeName( person );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonAttributeName( person, true);\r * promise.then(function(attributeNameList){\r * //attributeNameList 为人员所有属性的名称数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonAttributeName( person, function(attributeNameList){\r * //attributeNameList 为人员所有属性的名称数组。\r * })\r */\r listPersonAttributeName: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出人员的所有属性\r /**\r 列出人员的所有属性对象数组。\r * @method listPersonAllAttribute\r * @o2membercategory personAttribute\r * @methodOf module:org\r * @static\r * @param {PersonFlag|PersonFlag[]} name - 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Object[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回人员属性对象数组，如：\r * &lt;pre>&lt;code class='language-js'>[{\r * \"name\": \"住址\",\r * \"person\": \"张三@zhangsan@P\",\r * \"attributeList\": [\r * \"杭州市\",\"绍兴市\"\r * ]\r * }]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回人员所有属性的对象数组。\r * var attributeObjectList = this.org.listPersonAllAttribute( person );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listPersonAllAttribute( person, true);\r * promise.then(function(attributeObjectList){\r * //attributeObjectList 为人员所有属性的对象数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listPersonAllAttribute( person, function(attributeObjectList){\r * //attributeObjectList 为人员所有属性的对象数组。\r * })\r */\r listPersonAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"personList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listPersonAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r \r //组织属性**************\r //添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个)\r /**\r * 添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个)\r * @method appendUnitAttribute\r * @o2membercategory unitAttribute\r * @methodOf module:org\r * @static\r * @param {UnitFlag} unit - 组织的distinguishedName、name、id、unique属性值，组织对象。\r * @param {String} attribute 属性名称。\r * @param {String[]} valueArray 属性值，必须为数组。\r * @param {Function} [success] 执行成功的回调。\r * @param {Function} [failure] 执行失败的回调。\r * @param {(Boolean)} [async] 当参数为boolean，表示是否异步执行，默认为false。\r * @o2syntax\r * //同步执行\r * this.org.appendUnitAttribute( unit, attribute, valueArray);\r *\r * //异步执行\r * this.org.appendUnitAttribute( unit, attribute, valueArray, function(){\r * //执行成功的回调\r * }, null, true);\r */\r appendUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r \r orgActions.appendPersonAttribute(data, cb, null, !!async);\r \r // orgActions.appendUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个)\r /**\r * 设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个)\r * @method setUnitAttribute\r * @o2membercategory unitAttribute\r * @methodOf module:org\r * @static\r * @param {UnitFlag} unit - 组织的distinguishedName、name、id、unique属性值，组织对象。\r * @param {String} attribute 属性名称。\r * @param {String[]} valueArray 属性值，必须为数组。\r * @param {Function} [success] 执行成功的回调。\r * @param {Function} [failure] 执行失败的回调。\r * @param {(Boolean)} [async] 当参数为boolean，表示是否异步执行，默认为false。\r * @o2syntax\r * //同步执行\r * this.org.setUnitAttribute( unit, attribute, valueArray);\r *\r * //异步执行\r * this.org.setUnitAttribute( unit, attribute, valueArray, function(){\r * //执行成功的回调\r * }, null, true);\r */\r setUnitAttribute: function(unit, attr, values, success, failure, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"attributeList\":values,\"name\":attr,\"unit\":unitFlag};\r \r var cb = function(json){\r if (success) return success(json);\r }.ag().catch(function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r });\r orgActions.setUnitAttribute(data, cb, null, !!async);\r \r // orgActions.setUnitAttribute(data, function(json){\r // if (json.data.value){\r // if (success) success();\r // }else{\r // if (failure) failure(null, \"\", \"append values failed\");\r // }\r // }, function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, false);\r },\r //获取组织属性值\r /**\r 根据组织标识和属性名称获取对应属性值。\r * @method getUnitAttribute\r * @o2membercategory unitAttribute\r * @methodOf module:org\r * @static\r * @param {UnitFlag} unit - 组织的distinguishedName、name、id、unique属性值，组织对象。\r * @param {String} attr 属性名称。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回属性值数组，\r * 如：&lt;pre>&lt;code class='language-js'>[ value1, value2 ]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回该组织的属性值数组。\r * var attributeList = this.org.getUnitAttribute( unit, attr );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.getUnitAttribute( unit, attr, true);\r * promise.then(function(attributeList){\r * //attributeList 为返回该组织的属性值数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.getUnitAttribute( unit, attr, function(attributeList){\r * //attributeList 为返回该组织的属性值数组。\r * })\r */\r getUnitAttribute: function(unit, attr, async){\r getOrgActions();\r var unitFlag = (typeOf(unit)===\"object\") ? (unit.distinguishedName || unit.id || unit.unique || unit.name) : unit;\r var data = {\"name\":attr,\"unit\":unitFlag};\r var v = null;\r var cb = function(json){\r v = json.data.attributeList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.getUnitAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织所有属性的名称\r /**\r 列出组织所有属性的名称数组。\r * @method listUnitAttributeName\r * @o2membercategory unitAttribute\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {String[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织属性名称数组，\r * 如：&lt;pre>&lt;code class='language-js'>[ attributeName1, attributeName2 ]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回组织所有属性的名称数组。\r * var attributeNameList = this.org.listUnitAttributeName( unit );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitAttributeName( unit, true);\r * promise.then(function(attributeNameList){\r * //attributeNameList 为组织所有属性的名称数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitAttributeName( unit, function(attributeNameList){\r * //attributeNameList 为组织所有属性的名称数组。\r * })\r */\r listUnitAttributeName: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data.nameList;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAttributeName(data, cb, null, !!async);\r return (!!async) ? promise : v;\r },\r //列出组织的所有属性\r /**\r 列出组织的所有属性对象数组。\r * @method listUnitAllAttribute\r * @o2membercategory unitAttribute\r * @methodOf module:org\r * @static\r * @param {UnitFlag|UnitFlag[]} name - 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。\r * @param {(Boolean|Function)} [asyncOrCallback] 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。\r * @return {Object[]} 当async为true时，返回\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise}。\r * 否则返回组织属性对象数组，如：\r * &lt;pre>&lt;code class='language-js'>[{\r * \"name\": \"部门类别\",\r * \"unit\": \"开发部@kfb@U\",\r * \"attributeList\": [\r * \"生产部门\",\r * \"二级部门\"\r * ]\r * }]&lt;/code>&lt;/pre>\r * @o2syntax\r * //同步执行，返回组织所有属性的对象数组。\r * var attributeObjectList = this.org.listUnitAllAttribute( unit );\r *\r * //异步执行，返回Promise对象\r * var promise = this.org.listUnitAllAttribute( unit, true);\r * promise.then(function(attributeObjectList){\r * //attributeObjectList 为组织所有属性的对象数组。\r * })\r *\r * //异步执行，在回调方法中获取\r * this.org.listUnitAllAttribute( unit, function(attributeObjectList){\r * //attributeObjectList 为组织所有属性的对象数组。\r * })\r */\r listUnitAllAttribute: function(name, async){\r getOrgActions();\r var data = {\"unitList\":getNameFlag(name)};\r var v = null;\r var cb = function(json){\r v = json.data;\r if (async &amp;&amp; o2.typeOf(async)==\"function\") return async(v);\r return v;\r };\r \r var promise = orgActions.listUnitAllAttribute(data, cb, null, !!async);\r return (!!async) ? promise : v;\r }\r };\r \r this.Action = (function () {\r var actions = [];\r return function (root, json) {\r var action = actions[root] || (actions[root] = new MWF.xDesktop.Actions.RestActions(\"\", root, \"\"));\r action.getActions = function (callback) {\r if (!this.actions) this.actions = {};\r Object.merge(this.actions, json);\r if (callback) callback();\r };\r this.invoke = function (option) {\r action.invoke(option)\r }\r }\r })();\r this.service = {\r \"jaxwsClient\": {},\r \"jaxrsClient\": {}\r };\r \r var lookupAction = null;\r var getLookupAction = function (callback) {\r if (!lookupAction) {\r MWF.require(\"MWF.xDesktop.Actions.RestActions\", function () {\r lookupAction = new MWF.xDesktop.Actions.RestActions(\"\", \"x_processplatform_assemble_surface\", \"\");\r lookupAction.getActions = function (actionCallback) {\r this.actions = {\r //\"lookup\": {\"uri\": \"/jaxrs/view/flag/{view}/application/flag/{application}\"},\r //\"getView\": {\"uri\": \"/jaxrs/view/{id}/design\"}\r \"lookup\": { \"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute\", \"method\": \"PUT\" },\r \"getView\": { \"uri\": \"/jaxrs/queryview/flag/{view}/application/flag/{application}\" }\r };\r if (actionCallback) actionCallback();\r }\r if (callback) callback();\r });\r } else {\r if (callback) callback();\r }\r };\r \r /**\r * 您可以通过view对象，获取视图数据或选择视图数据。&lt;br/>\r * @module view\r * @o2ordernumber 70\r * @o2syntax\r * //您可以在流程表单、内容管理表单或门户页面中，通过this来获取view对象，如下：\r * var view = this.view;\r */\r this.view = {\r /**\r * 获取指定视图的数据。\r * @method lookup\r * @static\r * @param {Object} view - 要访问的视图信息。数据格式如下：&lt;br/>\r * &lt;caption>以下的filter参数参考&lt;a href='global.html#ViewFilter'>ViewFilter&lt;/a>&lt;/caption>\r * &lt;pre>&lt;code class='language-js'>\r * {\r * \"view\" : \"testView\", //（String）必选，视图的名称、别名或ID\r * \"application\" : \"test数据中心应用\", //（String）必选，视图所在数据应用的名称、别名或ID\r * \"filter\": [ //（Array of Object）可选，对视图进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件。\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r * ]\r * }\r * &lt;/code>&lt;/pre>\r * @param {Function} callback - 访问成功后的回调函数\r * @param {Boolean} [async] - 同步或异步调用。true：异步；false：同步。默认为true。\r * @o2syntax\r * this.view.lookup(view, callback, async);\r * @example\r * //获取“财务管理”应用中“报销审批数据”视图中的数据\r * //过滤条件为标题（$work.title）包含包含（like））“7月”。\r * this.view.lookup({\r * \"view\": \"报销审批数据\",\r * \"application\": \"财务管理\",\r * \"filter\": [\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r * ]\r *}, function(data){\r * var result = data.grid; //得到过滤后的数据\r * //......\r *});\r * @example\r * //获取“财务管理”应用中“报销审批数据”视图中的数据\r * //过滤条件为标题（$work.title）包含包含（like））“7月”，并且总金额大于500小于5000\r * this.view.lookup({\r * \"view\": \"报销审批数据\",\r * \"application\": \"财务管理\",\r * \"filter\": [\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * },\r * {\r * \"logic\":\"and\",\r * \"path\":\"amount\",\r * \"comparison\":\"range\",\r * \"value\":500,\r * \"otherValue\":5000,\r * \"formatType\":\"numberValue\"\r * },\r * ]\r *}, function(data){\r * var result = data.grid; //得到过滤后的数据\r * //......\r *});\r */\r \"lookup\": function (view, callback, async) {\r var filterList = { \"filterList\": (view.filter || null) };\r MWF.Actions.get(\"x_query_assemble_surface\").loadView(view.view, view.application, filterList, function (json) {\r var data = {\r \"grid\": json.data.grid || json.data.groupGrid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }, null, async);\r },\r \r \"lookupV1\": function (view, callback) {\r getLookupAction(function () {\r lookupAction.invoke({\r \"name\": \"lookup\", \"async\": true, \"parameter\": { \"view\": view.view, \"application\": view.application }, \"success\": function (json) {\r var data = {\r \"grid\": json.data.grid,\r \"groupGrid\": json.data.groupGrid\r };\r if (callback) callback(data);\r }.bind(this)\r });\r }.bind(this));\r },\r \r /**\r * 通过视图进行数据选择。\r * @method select\r * @static\r * @param {Object} view - 要访问的视图信息。数据格式如下：&lt;br/>\r * &lt;caption>以下的filter参数参考&lt;a href='global.html#ViewFilter'>ViewFilter&lt;/a>&lt;/caption>\r * &lt;pre>&lt;code class='language-js'>\r * {\r * \"view\" : \"testView\", //（String）必选，视图的名称、别名或ID\r * \"application\" : \"test数据中心应用\", //（String）必选，视图所在数据应用的名称、别名或ID\r * \"isTitle\" : true, //（Boolean）可选，是否显示视图标题。默认true\r * \"isMulti\" : true, //（Boolean）可选，是否允许多选。默认true\r * \"width\" : 700, //（Number）可选，选择框的宽度。默认700\r * \"height\" : 400, //（Number）可选，选择框的高度。默认400\r * \"caption\" : \"标题\", //（String）可选，选择框的标题\r * \"filter\": [ //（Array of Object）可选，对视图进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件。\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r * ]\r * }\r * &lt;/code>&lt;/pre>\r * @param {Function} callback - 必选，当选择完成，点击“确定”之后的回调函数。\r * @o2syntax\r * this.view.select(view, callback);\r * @example\r * this.view.select({\r * \"application\": \"物业材料\", //数据中心中的应用\r * \"view\": \"物业材料视图\", //视图的名称\r * \"isMulti\": false, //只允许单选\r * }, function(items) {\r * //如果选择了某个数据，将数据赋值给表单输入框\r * if (items.length) {\r * //物料名称，表单中输入框名为“materialName”， 视图中列的名称为“ylmc”\r * this.data.materialName = items[0].data.ylmc;\r * //规格，表单中输入框名为“specification”， 视图中列的名称为“gg”\r * this.data.specification = items[0].data.gg;\r * //单价，表单中输入框名为“price”， 视图中列的名称为“dj”\r * this.data.price = items[0].data.dj;\r * }\r * }.bind(this));\r */\r \"select\": function (view, callback, options) {\r if (view.view) {\r var viewJson = {\r \"application\": view.application || _form.json.application,\r \"viewName\": view.view || \"\",\r \"isTitle\": (view.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (view.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": view.filter\r };\r if (!options) options = {};\r options.width = view.width;\r options.height = view.height;\r options.title = view.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.view.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.view.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Viewer\", function () {\r this.view = new MWF.xApplication.query.Query.Viewer(dlg.content.getFirst(), viewJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r /**\r * 您可以通过statement对象，获取执行查询语句或者对查询结果进行选择。&lt;br/>\r * @module statement\r * @o2ordernumber 90\r * @o2syntax\r * //您可以在流程表单、内容管理表单、门户页面或视图中，通过this来获取statement对象，如下：\r * var statement = this.statement;\r */\r this.statement = {\r /**\r * 执行指定的查询语句。\r * @method execute\r * @static\r * @param {Object} statement - 要执行的查询语句的信息。数据格式如下：\r * &lt;div>以下的filter参数参考&lt;a href='global.html#StatementFilter'>StatementFilter&lt;/a>,\r * parameter参数参考&lt;a href='global.html#StatementParameter'>StatementParameter&lt;/a>&lt;/div>\r * &lt;pre>&lt;code class='language-js'>\r * {\r * \"name\" : \"tesStatement\", //（String）必选，查询配置的名称、别名或ID\r * \"mode\" : \"all\", //（String）必选，“all”、“data”或者“count”，all表示同时执行查询语句和总数语句，data表示执行查询语句，count表示执行总数语句\r * \"page\" : 1, //（number）可选，当前页码，默认为1\r * \"pageSize\" : 20, //（number）可选，每页的数据条数，默认为20\r * \"filter\": [ //（Array）可选，对查询进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件，每个元素数据格式如下：\r * {\r * \"path\":\"o.title\",\r * \"comparison\":\"like\",\r * \"value\":\"关于\",\r * \"formatType\":\"textValue\"\r * }\r * ],\r * parameter : {\r * \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r * \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r * \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r * }\r * &lt;/code>&lt;/pre>\r * @param {Function} callback - 访问成功后的回调函数\r * @param {Boolean} [async] - 同步或异步调用。true：异步；false：同步。默认为true。\r * @o2syntax\r * this.statement.execute(statement, callback, async);\r * @example\r * //获取“task”查询中的数据\r * //查询语句为 select o from Task o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)\r * //总数语句为 select count(o.id) from Task o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)\r * //过滤条件为标题o.title包含包含（like））“7月”。\r * this.statement.execute({\r * \"name\": \"task\",\r * \"mode\" : \"all\",\r * \"filter\": [\r * {\r * \"path\":\"o.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r * ],\r * \"parameter\" : {\r * \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r * \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r * \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r * }, function(json){\r * var count = json.count; //总数语句执行后返回的数字\r * var list = json.data; //查询语句后返回的数组\r * //......\r * });\r */\r \"execute\": function (statement, callback, async) {\r var parameter = this.parseParameter(statement.parameter);\r var filterList = this.parseFilter(statement.filter, parameter);\r var obj = {\r \"filterList\": filterList,\r \"parameter\" : parameter\r };\r MWF.Actions.load(\"x_query_assemble_surface\").StatementAction.executeV2(\r statement.name, statement.mode || \"data\", statement.page || 1, statement.pageSize || 20, obj,\r function (json) {\r if (callback) callback(json);\r }, null, async);\r },\r parseFilter : function( filter, parameter ){\r if( typeOf(filter) !== \"array\" )return [];\r var filterList = [];\r ( filter || [] ).each( function (d) {\r var parameterName = d.path.replace(/\\./g, \"_\");\r var value = d.value;\r if( d.comparison === \"like\" || d.comparison === \"notLike\" ){\r if( value.substr(0, 1) !== \"%\" )value = \"%\"+value;\r if( value.substr(value.length-1,1) !== \"%\" )value = value+\"%\";\r parameter[ parameterName ] = value; //\"%\"+value+\"%\";\r }else{\r if( d.formatType === \"dateTimeValue\" || d.formatType === \"datetimeValue\"){\r value = \"{ts '\"+value+\"'}\"\r }else if( d.formatType === \"dateValue\" ){\r value = \"{d '\"+value+\"'}\"\r }else if( d.formatType === \"timeValue\" ){\r value = \"{t '\"+value+\"'}\"\r }\r parameter[ parameterName ] = value;\r }\r d.value = parameterName;\r \r filterList.push( d );\r }.bind(this));\r return filterList;\r },\r parseParameter : function( obj ){\r if( typeOf(obj) !== \"object\" )return {};\r var parameter = {};\r //传入的参数\r for( var p in obj ){\r var value = obj[p];\r if( typeOf( value ) === \"date\" ){\r value = \"{ts '\"+value.format(\"db\")+\"'}\"\r }\r parameter[ p ] = value;\r }\r return parameter;\r },\r \r /**\r * 如果查询的类型是\"select\"，并且配置了查询视图，可以通过本方法进行数据选择。\r * @method select\r * @static\r * @param {Object} statement - 要访问的查询配置的信息。数据格式如下：\r * &lt;div>以下的filter参数参考&lt;a href='global.html#StatementFilter'>StatementFilter&lt;/a>,\r * parameter参数参考&lt;a href='global.html#StatementParameter'>StatementParameter&lt;/a>&lt;/div>\r * &lt;pre>&lt;code class='language-js'>\r * {\r * \"name\" : \"tesStatement\", //（String）必选，查询配置的名称、别名或ID\r * \"isTitle\" : true, //（Boolean）可选，是否显示视图标题。默认true\r * \"isMulti\" : true, //（Boolean）可选，是否允许多选。默认true\r * \"width\" : 700, //（Number）可选，选择框的宽度。默认700\r * \"height\" : 400, //（Number）可选，选择框的高度。默认400\r * \"caption\" : \"标题\", //（String）可选，选择框的标题\r * \"filter\": [ //（Array）可选，对查询进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件，每个元素数据格式如下：\r * {\r * \"path\":\"o.title\",\r * \"comparison\":\"like\",\r * \"value\":\"关于\",\r * \"formatType\":\"textValue\"\r * }\r * ],\r * parameter : {\r * \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r * \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r * \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r * }\r * &lt;/code>&lt;/pre>\r * @param {Function} callback - 访问成功后的回调函数\r * @o2syntax\r * this.statement.select(statement, callback);\r * @example\r * this.statement.select({\r * \"name\": \"物业材料查询\", //查询的名称\r * \"isMulti\": false, //只允许单选\r * }, function(items) {\r * //如果选择了某个数据，将数据赋值给表单输入框\r * if (items.length) {\r * //物料名称，表单中输入框名为“materialName”， 查询语句返回的字段名为“ylmc”\r * this.data.materialName = items[0].ylmc;\r * //规格，表单中输入框名为“specification”， 查询语句返回的字段名为“gg”\r * this.data.specification = items[0].gg;\r * //单价，表单中输入框名为“price”， 查询语句返回的字段名为“dj”\r * this.data.price = items[0].dj;\r * }\r * }.bind(this));\r */\r \"select\": function (statement, callback, options) {\r if (statement.name) {\r // var parameter = this.parseParameter(statement.parameter);\r // var filterList = this.parseFilter(statement.filter, parameter);\r var statementJson = {\r \"statementId\": statement.name || \"\",\r \"isTitle\": (statement.isTitle === false) ? \"no\" : \"yes\",\r \"select\": (statement.isMulti === false) ? \"single\" : \"multi\",\r \"filter\": statement.filter,\r \"parameter\": statement.parameter\r };\r if (!options) options = {};\r options.width = statement.width;\r options.height = statement.height;\r options.title = statement.caption;\r \r var width = options.width || \"700\";\r var height = options.height || \"400\";\r \r if (layout.mobile) {\r var size = document.body.getSize();\r width = size.x;\r height = size.y;\r options.style = \"viewmobile\";\r }\r width = width.toInt();\r height = height.toInt();\r \r var size = _form.app.content.getSize();\r var x = (size.x - width) / 2;\r var y = (size.y - height) / 2;\r if (x &lt; 0) x = 0;\r if (y &lt; 0) y = 0;\r if (layout.mobile) {\r x = 20;\r y = 0;\r }\r \r var _self = this;\r MWF.require(\"MWF.xDesktop.Dialog\", function () {\r var dlg = new MWF.xDesktop.Dialog({\r \"title\": options.title || \"select statement view\",\r \"style\": options.style || \"view\",\r \"top\": y,\r \"left\": x - 20,\r \"fromTop\": y,\r \"fromLeft\": x - 20,\r \"width\": width,\r \"height\": height,\r \"html\": \"&lt;div style='height: 100%;'>&lt;/div>\",\r \"maskNode\": _form.app.content,\r \"container\": _form.app.content,\r \"buttonList\": [\r {\r \"text\": MWF.LP.process.button.ok,\r \"action\": function () {\r //if (callback) callback(_self.view.selectedItems);\r if (callback) callback(_self.statement.getData());\r this.close();\r }\r },\r {\r \"text\": MWF.LP.process.button.cancel,\r \"action\": function () { this.close(); }\r }\r ]\r });\r dlg.show();\r \r if (layout.mobile) {\r var backAction = dlg.node.getElement(\".MWF_dialod_Action_back\");\r var okAction = dlg.node.getElement(\".MWF_dialod_Action_ok\");\r if (backAction) backAction.addEvent(\"click\", function (e) {\r dlg.close();\r }.bind(this));\r if (okAction) okAction.addEvent(\"click\", function (e) {\r //if (callback) callback(this.view.selectedItems);\r if (callback) callback(this.statement.getData());\r dlg.close();\r }.bind(this));\r }\r \r MWF.xDesktop.requireApp(\"query.Query\", \"Statement\", function () {\r this.statement = new MWF.xApplication.query.Query.Statement(dlg.content.getFirst(), statementJson, { \"style\": \"select\" }, _form.app, _form.Macro);\r }.bind(this));\r }.bind(this));\r }\r }\r };\r \r //include 引用脚本\r //optionsOrName : {\r // type : \"\", 默认为portal, 可以为 portal process cms\r // application : \"\", 门户/流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\" // 脚本名称/别名/id\r //}\r //或者name: \"\" // 脚本名称/别名/id\r // if( !window.includedScripts ){\r // var includedScripts = window.includedScripts = [];\r // }else{\r // var includedScripts = window.includedScripts;\r // }\r var includedScripts = [];\r this.include = function (optionsOrName, callback) {\r var options = optionsOrName;\r if (typeOf(options) == \"string\") {\r options = { name: options };\r }\r var name = options.name;\r var type = (options.type &amp;&amp; options.application) ? options.type : \"portal\";\r var application = options.application || _form.json.application;\r var key = type + \"-\" + application + \"-\" + name;\r if (includedScripts.indexOf(key) > -1) {\r if (callback) callback.apply(this);\r return;\r }\r //if (includedScripts.indexOf( name )> -1){\r // if (callback) callback.apply(this);\r // return;\r //}\r var scriptAction;\r switch (type) {\r case \"portal\":\r if (this.scriptActionPortal) {\r scriptAction = this.scriptActionPortal;\r } else {\r MWF.require(\"MWF.xScript.Actions.PortalScriptActions\", null, false);\r scriptAction = this.scriptActionPortal = new MWF.xScript.Actions.PortalScriptActions();\r }\r break;\r case \"process\":\r if (this.scriptActionProcess) {\r scriptAction = this.scriptActionProcess;\r } else {\r MWF.require(\"MWF.xScript.Actions.ScriptActions\", null, false);\r scriptAction = this.scriptActionProcess = new MWF.xScript.Actions.ScriptActions();\r }\r break;\r case \"cms\":\r if (this.scriptActionCMS) {\r scriptAction = this.scriptActionCMS;\r } else {\r MWF.require(\"MWF.xScript.Actions.CMSScriptActions\", null, false);\r scriptAction = this.scriptActionCMS = new MWF.xScript.Actions.CMSScriptActions();\r }\r break;\r }\r scriptAction.getScriptByName(application, name, includedScripts, function (json) {\r if (json.data) {\r includedScripts.push(key);\r \r //名称、别名、id\r json.data.importedList.each( function ( flag ) {\r if( type === \"portal\" ){\r includedScripts.push( type + \"-\" + json.data.portal + \"-\" + flag );\r if( json.data.portalName )includedScripts.push( type + \"-\" + json.data.portalName + \"-\" + flag );\r if( json.data.portalAlias )includedScripts.push( type + \"-\" + json.data.portalAlias + \"-\" + flag );\r }else if( type === \"cms\" ){\r includedScripts.push( type + \"-\" + json.data.appId + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }else if( type === \"process\" ){\r includedScripts.push( type + \"-\" + json.data.application + \"-\" + flag );\r if( json.data.appName )includedScripts.push( type + \"-\" + json.data.appName + \"-\" + flag );\r if( json.data.appAlias )includedScripts.push( type + \"-\" + json.data.appAlias + \"-\" + flag );\r }\r });\r \r includedScripts = includedScripts.concat(json.data.importedList);\r MWF.Macro.exec(json.data.text, this);\r if (callback) callback.apply(this);\r } else {\r if (callback) callback.apply(this);\r }\r }.bind(this), null, false);\r };\r \r this.define = function (name, fun, overwrite) {\r var over = true;\r if (overwrite === false) over = false;\r var o = {};\r o[name] = { \"value\": fun, \"configurable\": over };\r MWF.defineProperties(this, o);\r }.bind(this);\r \r \r //仅前台对象-----------------------------------------\r //form\r \r /**\r * 当查询设计中使用了select语句，并且配置了视图，可以在查询视图中使用本章API。&lt;br/>\r * queryStatement对象在查询视图中可用。它的很多方法与queryView类似。&lt;b>（仅前端脚本可用）&lt;/b>&lt;br/>\r * @module queryStatement\r * @o2range {QueryStatement}\r * @o2ordernumber 80\r * @borrows module:queryView.confirm as confirm\r * @borrows module:queryView.alert as alert\r * @borrows module:queryView.notice as notice\r * @borrows module:queryView.addEvent as addEvent\r * @borrows module:queryView.openWork as openWork\r * @borrows module:queryView.openJob as openJob\r * @borrows module:queryView.openDocument as openDocument\r * @borrows module:queryView.openPortal as openPortal\r * @borrows module:queryView.openCMS as openCMS\r * @borrows module:queryView.openProcess as openProcess\r * @borrows module:queryView.openApplication as openApplication\r * @borrows module:queryView.createDocument as createDocument\r * @borrows module:queryView.startProcess as startProcess\r * @o2syntax\r * //您可以在查询视图中，通过this来获取queryStatement对象，如下：\r * var queryStatement = this.queryStatement;\r */\r \r /**\r * 当查询视图被嵌入到门户页面、流程表单或内容管理表单的时候，可以通过这个方法来获取页面或表单的上下文。\r * @method getParentEnvironment\r * @memberOf module:queryStatement\r * @static\r * @return {MWF.xScript.Environment|MWF.xScript.CMSEnvironment} 页面或表单的上下文.\r * @o2syntax\r * this.queryStatement.getParentEnvironment();\r * @example\r * var env = this.queryStatement.getParentEnvironment(); //当视图被嵌入到页面的时候，可以在视图里获取页面的上下文\r * env.page.toPortal( \"公文门户\" ); //调用page的toPage() 跳转到其他门户\r */\r \r /**\r * 获取查询视图当前页的基本信息。\r * @method getPageInfor\r * @memberOf module:queryStatement\r * @static\r * @return {Object} 当前页的信息，格式如下:\r *&lt;pre>&lt;code class='language-js'>{\r * \"pages\": 3, //总页数\r * \"perPageCount\": 50, //每页的条数\r * \"currentPageNumber\": 1 // 当前页数\r * }\r * &lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryStatement.getPageInfor();\r */\r \r /**\r * 获取当前页的数据。\r * @method getPageData\r * @memberOf module:queryStatement\r * @static\r * @return {Object[]|Array[]} 当前页数据。\r * &lt;div>数据格式和 jpql 语句的写法有关&lt;/div>\r * 如: \"select o from table o\" 返回 json数组\r *&lt;pre>&lt;code class='language-js'>[\r {\r \"id\" : \"id1\",\r \"title\" : \"title1\"\r },\r {\r \"id\" : \"id2\",\r \"title\" : \"title2\"\r },\r ...\r *]\r * &lt;/code>&lt;/pre>\r * 如：\"select id, title from table o\" 返回 二维数组：\r *&lt;pre>&lt;code class='language-js'>[\r [\"id1\", \"title1\"],\r [\"id2\", \"title2\"],\r ...\r *]\r *&lt;/code>&lt;/pre>\r * @o2syntax\r * var data = this.queryStatement.getPageData();\r */\r \r /**\r * 跳转到指定的页面。\r * @method toPage\r * @memberOf module:queryStatement\r * @static\r * @param {Number} pageNumber - 需要跳转的页码。\r * @param {Function} [callback ] - 跳转的页面数据加载完成以后的回调方法。\r * @o2syntax\r * var data = this.queryStatement.toPage( pageNumber, callback );\r * @example\r * //　跳转到第2页并且获取该页的数据。\r * this.queryStatement.toPage( 2, function(){\r * var data = this.queryStatement.getPageData();\r * }.bind(this) )\r */\r \r /**\r * 当查询视图设置了允许多选的时候，可以通过这个方法全部选中当前页面的条目。\r * @method selectAll\r * @memberOf module:queryStatement\r * @static\r * @o2syntax\r * this.queryStatement.selectAll();\r */\r \r /**\r * 当查询视图设置了允许多选的时候，可以通过这个方法取消选中的条目。\r * @method unSelectAll\r * @memberOf module:queryStatement\r * @static\r * @o2syntax\r * this.queryStatement.unSelectAll();\r */\r \r /**\r * 获取选中的条目的数据。\r * @method getSelectedData\r * @memberOf module:queryStatement\r * @static\r * @return {Object[]|Array[]} 选中的条目的数据。\r * &lt;div>数据格式和 jpql 语句的写法有关&lt;/div>\r * 如: \"select o from table o\" 返回 json数组\r *&lt;pre>&lt;code class='language-js'>[\r {\r \"id\" : \"id1\",\r \"title\" : \"title1\"\r },\r {\r \"id\" : \"id2\",\r \"title\" : \"title2\"\r },\r ...\r *]\r * &lt;/code>&lt;/pre>\r * 如：\"select id, title from table o\" 返回 二维数组：\r *&lt;pre>&lt;code class='language-js'>[\r [\"id1\", \"title1\"],\r [\"id2\", \"title2\"],\r ...\r *]\r *&lt;/code>&lt;/pre>\r * @o2syntax\r * var data = this.queryStatement.getSelectedData();\r */\r \r /**获取queryStatement对应的DOM对象。\r * @method node\r * @static\r * @methodOf module:queryStatement\r * @see module:form.node\r */\r \r \r /**\r * queryView对象可在视图中可用。它的很多方法与form类似。&lt;b>（仅前端脚本可用）&lt;/b>&lt;br/>\r * @module queryView\r * @o2range {QueryView}\r * @o2ordernumber 60\r * @o2syntax\r * //您可以在视图中，通过this来获取queryView对象，如下：\r * var queryView = this.queryView;\r */\r this.page = this.form = this.queryView = this.queryStatement = {\r /**\r * 当视图被嵌入到门户页面、流程表单或内容管理表单的时候，可以通过这个方法来获取页面或表单的上下文。\r * @method getParentEnvironment\r * @static\r * @return {MWF.xScript.Environment|MWF.xScript.CMSEnvironment} 页面或表单的上下文.\r * @o2syntax\r * this.queryView.getParentEnvironment();\r * @example\r * var env = this.queryView.getParentEnvironment(); //当视图被嵌入到页面的时候，可以在视图里获取页面的上下文\r * env.page.toPortal( \"公文门户\" ); //调用page的toPage() 跳转到其他门户\r */\r \"getParentEnvironment\" : function () { return _form.getParentEnvironment(); }, //视图嵌入的表单或页面的上下文\r \r /**\r * 获取查询的配置信息。\r * @method getStatementInfor\r * @memberOf module:queryStatement\r * @static\r * @return {Object} 查询的配置信息.\r * &lt;pre>&lt;code class='language-js'>{\r * \"query\": \"26d21c71-5114-4496-8ca1-a69e56324841\", //所属应用id\r * \"id\": \"ee334220-66d3-4f78-afce-8ccf6b995c8c\", //查询id\r * \"name\": \"测试查询\", //名称\r * \"alias\": \"\", //别名\r * \"description\": \"\", //描述\r * \"table\": \"\", //自建表的id\r * \"entityClassName\": \"com.x.processplatform.core.entity.content.Task\", //系统表表名\r * \"entityCategory\": \"official\", //表类型 official(系统表) 或 dynamic(自建表)\r * \"format\": \"jpql\", //语句类型,jpql 或者 script(脚本)\r * \"type\": \"select\", //select/update/delete\r * \"data\": \"SELECT o FROM Task o where o.person = :person\", //查询语句\r * \"countData\": \"SELECT count(o.id) FROM Task o where o.person = :person\", //总数语句\r * \"countScriptText\" : \"\", //总数语句脚本\r * \"scriptText\" : \"\", //查询语句脚本\r * \"viewJson\": { ... } //视图相关信息\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryStatement.getStatementInfor();\r */\r \"getStatementInfor\" : function () { return _form.getStatementInfor ? _form.getStatementInfor() : null; },\r \r /**\r * 获取查询的配置信息。\r * @method getViewInfor\r * @memberOf module:queryView\r * @static\r * @return {Object} 视图的配置信息.\r * &lt;pre>&lt;code class='language-js'>{\r * \"application\": \"db9fc893-7dbc-4e0f-a617-99089d2c6323\", //视图所在应用\r * \"query\": \"db9fc893-7dbc-4e0f-a617-99089d2c6323\", //视图所在应用，同application\r * \"name\": \"视图自定义测试\", //视图名称\r * \"viewName\": \"视图自定义测试\", //视图名称，同name\r * \"isExpand\": \"no\", //如果有分类，默认是否展开开\r * \"id\": \"705ce967-2f9c-425c-8873-3bd729249e1d\", //视图id\r * \"alias\": \"\", //视图别名\r * \"description\": \"\", //视图描述\r * \"display\": true, //视图是否显示\r * \"type\": \"cms\", //视图嵌入的数据类型, cms 或 process\r * \"count\": 2000, //最多返回2000条\r * \"pageSize\": 20, //每页的条数\r * \"createTime\": \"2019-09-02 10:18:27\",\r * \"updateTime\": \"2020-03-26 15:53:03\"\r * }&lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryView.getViewInfor();\r */\r \"getViewInfor\" : function () { return _form.getViewInfor(); },\r \r /**\r * 获取视图当前页的基本信息。\r * @method getPageInfor\r * @memberOf module:queryView\r * @static\r * @return {Object} 当前页的信息，格式如下:\r *&lt;pre>&lt;code class='language-js'>{\r * \"pages\": 3, //总页数\r * \"perPageCount\": 50, //每页的条数\r * \"currentPageNumber\": 1 // 当前页数\r * }\r * &lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryView.getPageInfor();\r */\r \"getPageInfor\" : function () { return _form.getPageInfor(); },\r \r /**\r * 获取当前页的数据。\r * @method getPageData\r * @memberOf module:queryView\r * @static\r * @return {Object[]} 当前页数据。\r * &lt;div>没有分类时候，数据格式如下：&lt;/div>\r *&lt;pre>&lt;code class='language-js'>[\r * {\r * \"bundle\": \"099ed3c9-dfbc-4094-a8b7-5bfd6c5f7070\", //cms 的 documentId, process 的 jobId\r * \"data\": { //视图中配置的数据\r * \"title\": \"考勤管理-配置-统计周期设置\", //列名称及列值\r * \"time\": \"2018-08-25 11:29:45\"\r * }\r * },\r * ...\r *]\r * &lt;/code>&lt;/pre>\r * 有分类的时候，数据格式如下：\r *&lt;pre>&lt;code class='language-js'>[\r * {\r * \"group\": \"工作日志\", //分类1\r * \"list\": [ //分类下的数据\r * {\r * \"bundle\": \"001257be-725a-43cf-9679-3892bbab696a\", //cms 的 documentId, process 的 jobId\r * \"data\": { //视图中配置的数据\r * \"title\": \"标题\", //列名称及列值\r * \"time\": \"2018-07-31 15:39:13\",\r * \"category\": \"工作日志\"\r * }\r * },\r * ...\r * ]\r * },\r * ...\r *]\r *&lt;/code>&lt;/pre>\r * @o2syntax\r * var data = this.queryView.getPageData();\r */\r \"getPageData\" : function () { return _form.getPageData(); },\r \r /**\r * 跳转到指定的页面。\r * @method toPage\r * @memberOf module:queryView\r * @static\r * @param {Number} pageNumber - 需要跳转的页码。\r * @param {Function} [callback ] - 跳转的页面数据加载完成以后的回调方法。\r * @o2syntax\r * var data = this.queryView.toPage( pageNumber, callback );\r * @example\r * //　跳转到第2页并且获取该页的数据。\r * this.queryView.toPage( 2, function(){\r * var data = this.queryView.getPageData();\r * }.bind(this) )\r */\r \"toPage\" : function ( pageNumber, callback ) { return _form.toPage(pageNumber, callback); },\r \r /**\r * 当视图设置了允许多选的时候，可以通过这个方法全部选中当前页面的条目。\r * @method selectAll\r * @memberOf module:queryView\r * @static\r * @o2syntax\r * this.queryView.selectAll();\r */\r \"selectAll\" : function () { return _form.selectAll(); },\r \r /**\r * 当视图设置了允许多选的时候，可以通过这个方法取消选中的条目。\r * @method unSelectAll\r * @memberOf module:queryView\r * @static\r * @o2syntax\r * this.queryView.unSelectAll();\r */\r \"unSelectAll\" : function () { return _form.unSelectAll(); },\r \r /**\r * 获取选中的条目的数据。\r * @method getSelectedData\r * @memberOf module:queryView\r * @static\r * @return {Object[]} 选中的条目的数据。\r * &lt;div>格式如下：&lt;/div>\r * &lt;pre>&lt;code class='language-js'>\r * [\r {\r \"bundle\": \"099ed3c9-dfbc-4094-a8b7-5bfd6c5f7070\", //cms 的 documentId, process 的 jobId\r \"data\": { //视图中配置的数据\r \"title\": \"考勤管理-配置-统计周期设置\", //列名称及列值\r \"time\": \"2018-08-25 11:29:45\"\r }\r },\r ...\r * ]\r &lt;/code>&lt;/pre>\r * @o2syntax\r * var data = this.queryView.getSelectedData();\r */\r \"getSelectedData\" : function () { return _form.getSelectedData(); },\r \r /**\r * 设置视图的过滤条件，该方法不能修改视图中默认的过滤条件（在开发视图的时候添加的过滤条件），而是在这上面新增。\r * @method setFilter\r * @memberOf module:queryView\r * @static\r * @param {(ViewFilter[]|ViewFilter|Null)} [filter] 过滤条件。&lt;br/>\r * 当不传参数、参数为null或为空数组的情况下，表示清空非视图默认的过滤条件。&lt;br/>\r * 如果传入对象或者非空数组的时候，参数如下：\r * &lt;pre>&lt;code class='language-js'>[\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r *]\r * &lt;/code>&lt;/pre>\r * @param {Function} [callback] 过滤完成并重新加载数据后的回调方法。\r * @o2syntax\r * this.queryView.setFilter( filter );\r */\r \"setFilter\" : function ( filter, callback ) { return _form.setFilter(filter, callback); },\r \r /**\r * 增加查询语句where子句的过滤条件。\r * @method setStatementFilter\r * @memberOf module:queryStatement\r * @static\r * @param {(StatementFilter[]|Null)} [filter] 过滤条件。&lt;br/>\r * 过滤条件。当不传参数、参数为null或为空数组的情况下，表示清空非视图默认的过滤条件。&lt;br/>\r * 如果传入非空数组的时候，参数如下：\r * &lt;pre>&lt;code class='language-js'>[\r * {\r * \"path\":\"o.title\",\r * \"comparison\":\"like\",\r * \"value\":\"关于\",\r * \"formatType\":\"textValue\"\r * }\r *]\r * &lt;/code>&lt;/pre>\r * @param {StatementParameter} [parameter] 过滤条件。对查询语句where子句的形如\":person\"的参数部分进行赋值，参数如下：\r * &lt;pre>&lt;code class='language-js'>\r * //假设语句为 select count(o.id) from Read o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)。\r * //那么可能的参数如下：\r * {\r * \"person\" : \"\", //出于安全考虑参数名称为下列值时，不需要填写参数值，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r * \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r * \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r * &lt;/code>&lt;/pre>\r * @param {Function} [callback] 过滤完成并重新加载数据后的回调方法。\r * @o2syntax\r * this.queryStatement.setStatementFilter( filter, parameter, callback );\r */\r \"setStatementFilter\" : function ( filter , parameter, callback) { return _form.setFilter(filter, parameter, callback); },\r \r /**\r * 把当前视图切换成另外一个视图。\r * @method switchView\r * @memberOf module:queryView\r * @static\r * @param {Object} options 需要跳转的参数配置。参数说明如下：\r * &lt;div>下列说明的filter属性参考&lt;a href='global.html#ViewFilter'>ViewFilter&lt;/a>&lt;/div>\r * &lt;pre>&lt;code class='language-js'>{\r * \"application\": application, //必选，视图的所在应用id\r * \"viewName\": viewName, //必选，视图的名称\r * \"filter\": [\r * {\r * \"logic\":\"and\",\r * \"path\":\"$work.title\",\r * \"comparison\":\"like\",\r * \"value\":\"7月\",\r * \"formatType\":\"textValue\"\r * }\r * ], //可选，增加视图的过滤条件（ViewFilter），如果不传，则使用原视图的配置；如果需要去掉原视图的配置，则传入空数组 []\r * \"isTitle\": \"yes\", //可选，是否显示t视图的标题行，可选值有:yes no\r * \"select\": \"none\", //可选，是否允许新视图选择，如果不传，则使用原视图的配置, 可选值有： 不允许选择 none, 单选 single，多选 multi\r * \"titleStyles\": {\r * \"color\" : \"red\",\r * \"font-size\" : \"14px\"\r * }, //可选，标题行样式，如果不传，则使用原视图的配置\r * \"itemStyles\": {\r * \"color\" : \"#333\",\r * \"font-size\" : \"12px\"\r * }, //可选，内容行样式，如果不传，则使用原视图的配置\r * \"isExpand\": \"no\", //可选，默认是否展开分类，如果不传，则使用原视图的配置, 可选值有:yes no\r * }\r * &lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryView.switchView( options );\r */\r \"switchView\" : function ( options ) { return _form.switchView(options); },\r \r /**\r * 把当前查询视图切换成另外一个查询视图。\r * @method switchStatement\r * @memberOf module:queryStatement\r * @static\r * @param {Object} options 需要跳转的参数配置。参数说明如下：\r * &lt;div>下列说明的filter属性参考&lt;a href='global.html#StatementFilter'>StatementFilter&lt;/a>，\r * parameter属性参考&lt;a href='global.html#StatementParameter'>StatementParameter&lt;/a>&lt;/div>\r * &lt;pre>&lt;code class='language-js'>this.queryStatement.switchStatement({\r * \"statementId\": statementId, //必选，查询的名称、别名、id\r * \"isTitle\": \"yes\", //可选，是否显示视图的标题行，可选值有:yes no\r * \"select\": \"multi\", //可选，是否允许新视图选择，如果不传，则使用原视图的配置, 可选值有： 不允许选择 none, 单选 single，多选 multi\r * \"showActionbar\": false, //可选，是否显示操作条\r * \"filter\": [ //可选，增加查询语句where子句的过滤条件\r * {\r * \"path\": \"o.title\",\r * \"title\": \"标题\",\r * \"type\": \"filter\",\r * \"comparison\": \"like\",\r * \"formatType\": \"textValue\",\r * \"value\": \"测试\"\r * }\r * ],\r * //假设语句为 select count(o.id) from Read o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)\r * \"parameter\" : { //可选，对查询语句where语句的形如\":person\"的参数部分进行赋值\r * \"person\" : \"\", //出于安全考虑参数名称为下列值时，不需要填写参数值，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r * \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r * \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r * \"processName\" : \"test流程\" //其他写确定的值\r * }\r * })\r * &lt;/code>&lt;/pre>\r * @o2syntax\r * this.queryStatement.switchStatement( options );\r */\r \"switchStatement\" : function ( options ) { if(_form.switchStatement)_form.switchStatement(options) ; },\r \r /**\r * 重新加载视图。\r * @method reload\r * @methodOf module:queryView\r * @static\r * @o2syntax\r * this.queryView.reload();\r */\r \"reload\" : function () { _form.reload(); },\r \r // \"getInfor\": function () { return ev.pageInfor; },\r // \"infor\": ev.pageInfor,\r // \"getApp\": function () { return _form.app; },\r // \"app\": _form.app,\r \r /**获取queryView对应的DOM对象。\r * @method node\r * @static\r * @methodOf module:queryView\r * @see module:form.node\r */\r \"node\": function () { return _form.node; },\r \r // \"get\": function (name) { return (_form.all) ? _form.all[name] : null; },\r // \"getWidgetModule\": function (widget, moduleName) {\r // if (!_form.widgetModules || !_form.widgetModules[widget]) return null;\r // var module = _form.widgetModules[widget][moduleName];\r // return module || null;\r // },\r // \"getField\": function (name) { return _forms[name]; },\r // \"getAction\": function () { return _form.workAction },\r \"getDesktop\": function () { return _form.app ? _form.app.desktop : null},\r // \"getData\": function () { return new MWF.xScript.JSONData(_form.getData()); },\r //\"save\": function(callback){_form.saveWork(callback);},\r // \"close\": function () { _form.closeWork(); },\r \r // \"print\": function (application, form) {\r // _form.printWork(application, form);\r // },\r \r /**弹出一个确认框。\r * @method confirm\r * @static\r * @methodOf module:queryView\r * @see module:form.confirm\r */\r \"confirm\": function (type, title, text, width, height, ok, cancel, callback, mask, style) {\r // var p = MWF.getCenter({\"x\": width, \"y\": height});\r // e = {\"event\": {\"clientX\": p.x,\"x\": p.x,\"clientY\": p.y,\"y\": p.y}};\r // _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r if ((arguments.length &lt;= 1) || o2.typeOf(arguments[1]) === \"string\") {\r var p = MWF.getCenter({ \"x\": width, \"y\": height });\r e = { \"event\": { \"clientX\": p.x, \"x\": p.x, \"clientY\": p.y, \"y\": p.y } };\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r } else {\r e = (arguments.length > 1) ? arguments[1] : null;\r title = (arguments.length > 2) ? arguments[2] : null;\r text = (arguments.length > 3) ? arguments[3] : null;\r width = (arguments.length > 4) ? arguments[4] : null;\r height = (arguments.length > 5) ? arguments[5] : null;\r ok = (arguments.length > 6) ? arguments[6] : null;\r cancel = (arguments.length > 7) ? arguments[7] : null;\r callback = (arguments.length > 8) ? arguments[8] : null;\r mask = (arguments.length > 9) ? arguments[9] : null;\r style = (arguments.length > 10) ? arguments[10] : null;\r _form.confirm(type, e, title, text, width, height, ok, cancel, callback, mask, style);\r }\r },\r \r /**显示一个带关闭按钮的信息框。\r * @method alert\r * @static\r * @methodOf module:queryView\r * @see module:form.alert\r */\r \"alert\": function(type, title, text, width, height){\r _form.alert(type, title, text, width, height);\r },\r \r /**显示一个信息框。\r * @method notice\r * @static\r * @methodOf module:queryView\r * @see module:form.notice\r */\r \"notice\": function (content, type, target, where, offset, option) {\r _form.notice(content, type, target, where, offset, option);\r },\r \r /**　给视图添加事件。\r * @method addEvent\r * @static\r * @methodOf module:queryView\r * @see module:form.addEvent\r */\r \"addEvent\": function (e, f) { _form.addEvent(e, f); },\r \r // \"openWindow\": function (form, app) {\r // _form.openWindow(form, app);\r // },\r // \"toPage\": function (name, par, nohis) {\r // _form.app.toPage(name, par, nohis);\r // },\r // \"toPortal\": function (portal, page, par) {\r // _form.app.toPortal(portal, page, par);\r // },\r \r /**打开一个在流转或已完成的流程实例。\r * @method openWork\r * @static\r * @methodOf module:queryView\r * @see module:form.openWork\r */\r \"openWork\": function (id, completedId, title, options) {\r var op = options || {};\r op.workId = id;\r op.workCompletedId = completedId;\r op.docTitle = title;\r op.appId = \"process.Work\" + (op.workId || op.workCompletedId);\r return layout.desktop.openApplication(this.event, \"process.Work\", op);\r },\r \r /**根据流程的jobId打开工作。\r * @method openJob\r * @static\r * @methodOf module:queryView\r * @see module:form.openJob\r */\r \"openJob\": function (id, choice, options) {\r var workData = null;\r o2.Actions.get(\"x_processplatform_assemble_surface\").listWorkByJob(id, function (json) {\r if (json.data) workData = json.data;\r }.bind(this), null, false);\r \r if (workData) {\r var len = workData.workList.length + workData.workCompletedList.length;\r if (len) {\r if (len > 1 &amp;&amp; choice) {\r var node = new Element(\"div\", { \"styles\": { \"padding\": \"20px\", \"width\": \"500px\" } }).inject(_form.node);\r workData.workList.each(function (work) {\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\" + o2.LP.widget.open + \"&lt;/div>&lt;/div>\" +\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\" + work.title + \"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.activityName + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.activityArrivedTime + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + (work.manualTaskIdentityText || \"\") + \"&lt;/div>&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function (e) {\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(work.id, null, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r workData.workCompletedList.each(function (work) {\r var workNode = new Element(\"div\", {\r \"styles\": {\r \"background\": \"#ffffff\",\r \"border-radius\": \"10px\",\r \"clear\": \"both\",\r \"margin-bottom\": \"10px\",\r \"height\": \"40px\",\r \"padding\": \"10px 10px\"\r }\r }).inject(node);\r var html = \"&lt;div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'>&lt;/div>\" +\r \"&lt;div style='height: 40px; width: 40px; float: right'>&lt;div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>\" + o2.LP.widget.open + \"&lt;/div>&lt;/div>\" +\r \"&lt;div style='height: 20px; line-height: 20px; margin: 0px 40px'>\" + work.title + \"&lt;/div>\" +\r \"&lt;div style='margin: 0px 40px'>&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + o2.LP.widget.workcompleted + \"&lt;/div>\" +\r \"&lt;div style='color:#999999; float: left; margin-right: 10px'>\" + work.completedTime + \"&lt;/div>\";\r workNode.set(\"html\", html);\r var action = workNode.getElement(\".MWFAction\");\r action.store(\"work\", work);\r action.addEvent(\"click\", function (e) {\r var work = e.target.retrieve(\"work\");\r if (work) this.openWork(null, work.id, work.title, options);\r dlg.close();\r }.bind(this));\r \r }.bind(this));\r var height = node.getSize().y + 20;\r if (height > 600) height = 600;\r \r var dlg = o2.DL.open({\r \"title\": o2.LP.widget.choiceWork,\r \"style\": \"user\",\r \"isResize\": false,\r \"content\": node,\r \"buttonList\": [\r {\r \"type\": \"cancel\",\r \"text\": o2.LP.widget.close,\r \"action\": function () { dlg.close(); }\r }\r ]\r });\r } else {\r if (workData.workList.length) {\r var work = workData.workList[0];\r return this.openWork(work.id, null, work.title, options);\r } else {\r var work = workData.workCompletedList[0];\r return this.openWork(null, work.id, work.title, options);\r }\r }\r }\r }\r },\r \r /**打开一个内容管理文档。\r * @method openDocument\r * @static\r * @methodOf module:queryView\r * @see module:form.openDocument\r */\r \"openDocument\": function (id, title, options) {\r var op = options || {};\r op.documentId = id;\r op.docTitle = title || \"\";\r layout.desktop.openApplication(this.event, \"cms.Document\", op);\r },\r \r /**打开一个门户页面。\r * @method openPortal\r * @static\r * @methodOf module:queryView\r * @see module:form.openPortal\r */\r \"openPortal\": function (name, page, par) {\r var action = MWF.Actions.get(\"x_portal_assemble_surface\");\r action.getApplication(name, function (json) {\r if (json.data) {\r if (page) {\r action.getPageByName(page, json.data.id, function (pageJson) {\r var pageId = (pageJson.data) ? pageJson.data.id : \"\";\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"pageId\": pageId,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id + pageId)\r })\r });\r } else {\r layout.desktop.openApplication(null, \"portal.Portal\", {\r \"portalId\": json.data.id,\r \"parameters\": par,\r \"appId\": (par &amp;&amp; par.appId) || (\"portal.Portal\" + json.data.id)\r })\r }\r }\r \r });\r },\r \r /**打开一个内容管理栏目。\r * @method openCMS\r * @static\r * @methodOf module:queryView\r * @see module:form.openCMS\r */\r \"openCMS\": function (name) {\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r action.getColumn(name, function (json) {\r if (json.data) {\r layout.desktop.openApplication(null, \"cms.Module\", {\r \"columnId\": json.data.id,\r \"appId\": \"cms.Module\" + json.data.id\r });\r }\r });\r },\r \r /**打开一个流程应用。\r * @method openProcess\r * @static\r * @methodOf module:queryView\r * @see module:form.openProcess\r */\r \"openProcess\": function (name) {\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r action.getApplication(name, function (json) {\r if (json.data) {\r layout.desktop.openApplication(null, \"process.Application\", {\r \"id\": json.data.id,\r \"appId\": \"process.Application\" + json.data.id\r });\r }\r });\r },\r \r /**打开一个任意一个component应用。\r * @method openApplication\r * @static\r * @methodOf module:queryView\r * @see module:form.openApplication\r */\r \"openApplication\": function (name, options) {\r layout.desktop.openApplication(null, name, options);\r },\r \r /**创建一个内容管理文档。\r * @method createDocument\r * @static\r * @methodOf module:queryView\r * @see module:form.createDocument\r */\r \"createDocument\": function (columnOrOptions, category, data, identity, callback, target, latest, selectColumnEnable, ignoreTitle) {\r var column = columnOrOptions;\r var onAfterPublish, onPostPublish;\r if (typeOf(columnOrOptions) == \"object\") {\r column = columnOrOptions.column;\r category = columnOrOptions.category;\r data = columnOrOptions.data;\r identity = columnOrOptions.identity;\r callback = columnOrOptions.callback;\r target = columnOrOptions.target;\r latest = columnOrOptions.latest;\r selectColumnEnable = columnOrOptions.selectColumnEnable;\r ignoreTitle = columnOrOptions.ignoreTitle;\r onAfterPublish = columnOrOptions.onAfterPublish;\r onPostPublish = columnOrOptions.onPostPublish;\r }\r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r layout.app.content.empty();\r layout.app = null;\r }\r }\r \r MWF.xDesktop.requireApp(\"cms.Index\", \"Newer\", function () {\r var starter = new MWF.xApplication.cms.Index.Newer(null, null, _form.app, null, {\r \"documentData\": data,\r \"identity\": identity,\r \r \"ignoreTitle\": ignoreTitle === true,\r \"ignoreDrafted\": latest === false,\r \"selectColumnEnable\": !category || selectColumnEnable === true,\r \"restrictToColumn\": !!category &amp;&amp; selectColumnEnable !== true,\r \r \"categoryFlag\": category, //category id or name\r \"columnFlag\": column, //column id or name,\r \"onStarted\": function (documentId, data) {\r if (callback) callback();\r },\r \"onPostPublish\": function () {\r if(onPostPublish)onPostPublish();\r },\r \"onAfterPublish\": function () {\r if(onAfterPublish)onAfterPublish();\r }\r });\r starter.load();\r })\r },\r \r /**　启动一个流程实例。\r * @method startProcess\r * @static\r * @methodOf module:queryView\r * @see module:form.startProcess\r */\r \"startProcess\": function (app, process, data, identity, callback, target, latest) {\r \r if (arguments.length > 2) {\r for (var i = 2; i &lt; arguments.length; i++) {\r if (typeOf(arguments[i]) == \"boolean\") {\r target = arguments[i];\r break;\r }\r }\r }\r \r if (target) {\r if (layout.app &amp;&amp; layout.app.inBrowser) {\r //layout.app.content.empty();\r layout.app.$openWithSelf = true;\r }\r }\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\").getProcessByName(process, app, function (json) {\r if (json.data) {\r MWF.xDesktop.requireApp(\"process.TaskCenter\", \"ProcessStarter\", function () {\r var starter = new MWF.xApplication.process.TaskCenter.ProcessStarter(json.data, _form.app, {\r \"workData\": data,\r \"identity\": identity,\r \"latest\": latest,\r \"onStarted\": function (data, title, processName) {\r if (data.work){\r var work = data.work;\r var options = {\"draft\": work, \"appId\": \"process.Work\"+(new o2.widget.UUID).toString(), \"desktopReload\": false};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{\r var currentTask = [];\r data.each(function(work){\r if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r }.bind(this));\r \r if (currentTask.length==1){\r var options = {\"workId\": currentTask[0], \"appId\": currentTask[0]};\r layout.desktop.openApplication(null, \"process.Work\", options);\r }else{}\r }\r \r // var currentTask = [];\r // data.each(function (work) {\r // if (work.currentTaskIndex != -1) currentTask.push(work.taskList[work.currentTaskIndex].work);\r // }.bind(this));\r //\r // if (currentTask.length == 1) {\r // var options = { \"workId\": currentTask[0], \"appId\": currentTask[0] };\r // layout.desktop.openApplication(null, \"process.Work\", options);\r // } else { }\r \r if (callback) callback(data);\r }.bind(this)\r });\r starter.load();\r }.bind(this));\r }\r });\r }\r //\"app\": _form.app\r };\r // this.form.currentRouteName = _form.json.currentRouteName;\r // this.form.opinion = _form.json.opinion;\r \r this.target = ev.target;\r this.event = ev.event;\r this.status = ev.status;\r \r /**\r * 在前端脚本中，可以通过this.session.user来获取当前用户信息。&lt;br/>\r * @module session\r * @o2ordernumber 110\r * @o2syntax\r * var user = this.session.user;\r * @example\r * //获取当前用户信息\r * var user = this.session.user\r * @return {Object} 当前用户信息，内容和格式如下：\r * &lt;pre>&lt;code class='language-js'>{\r * \"id\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\", //人员ID\r * \"genderType\": \"m\", //性别\r * \"icon\": \"...\", //头像\r * \"signature\": \"\", //个人签名\r * \"name\": \"胡起\", //姓名\r * \"employee\": \"huqi\", //员工号\r * \"unique\": \"huqi\", //唯一标识\r * \"distinguishedName\": \"xx@huqi@P\", //人员全称\r * \"superior\": \"\", //上级人员id\r * \"changePasswordTime\": \"2017-03-13\", //修改密码时间\r * \"lastLoginTime\": \"2019-01-02\", //最后登录时间\r * \"mail\": \"huqi@zoneland.net\", //邮件地址\r * \"weixin\": \"\", //微信号\r * \"qq\": \"\", //QQ\r * \"mobile\": \"18057190078\", //手机号码\r * \"officePhone\": \"\", //办公电话\r * \"createTime\": \"2017-03-13 12:27:04\", //人员创建时间\r * \"updateTime\": \"2019-01-02 13:00:04\", //人员修改时间\r * \"token\": \"...\", //当前用户token\r * \"roleList\": [ //人员角色\r * \"ProcessPlatformCreator@ProcessPlatformCreatorSystemRole@R\",\r * \"ProcessPlatformManager@ProcessPlatformManagerSystemRole@R\",\r * \"Manager@ManagerSystemRole@R\"\r * ],\r * \"identityList\": [ //人员身份列表\r * {\r * \"id\": \"709328c8-44a0-4f5d-a3fa-3c31208232d5\", //身份ID\r * \"name\": \"xx\", //身份名称\r * \"unique\": \"709328c8-44a0-4f5d-a3fa-3c31208232d5\", //身份唯一标识\r * \"distinguishedName\": \"xx@709328c8-44a0-4f5d-a3fa-3c31208232d5@I\", //身份全称\r * \"person\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\", //人员ID\r * \"unit\": \"d5356fd4-6675-45ad-9a00-5eff20b83dfa\", //所属组织ID\r * \"unitName\": \"开发部\", //所属组织名称\r * \"unitLevel\": 2, //所属组织层级\r * \"unitLevelName\": \"兰德纵横/开发部\", //所属组织层次名\r * \"major\": true //是否是主身份\r * },\r * {\r * \"id\": \"343510af-57c2-4a55-a1f2-f30d7af6d284\",\r * \"description\": \"\",\r * \"name\": \"xx\",\r * \"unique\": \"343510af-57c2-4a55-a1f2-f30d7af6d284\",\r * \"distinguishedName\": \"xx@343510af-57c2-4a55-a1f2-f30d7af6d284@I\",\r * \"person\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\",\r * \"unit\": \"108b1b7c-cc78-49ab-9ab1-e67073bd6541\",\r * \"unitName\": \"开发部\",\r * \"unitLevel\": 2,\r * \"unitLevelName\": \"浙江兰德纵横/开发部\",\r * \"major\": false\r * }\r * ]\r * }\r * &lt;/code>&lt;/pre>\r */\r this.session = layout.desktop.session;\r \r \r \r /**\r * 本文档说明如何在前台脚本中使用Actions调用平台的RESTful服务。&lt;br/>\r * 通过访问以下地址来查询服务列表：http://server:20030/x_program_center/jest/list.html\r * @module Actions\r * @o2ordernumber 130\r * @o2syntax\r * //获取Actions\r * this.Actions\r * //或者\r * o2.Actions\r */\r \r /**\r * 本平台不同的服务根可能对应不同的域名或端口，您可以使用this.Actions.getHost来获取服务跟对应的host。\r * @method getHost\r * @methodOf module:Actions\r * @static\r * @param {String} root 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。\r *如:&lt;pre>&lt;code class='language-js'>\r * \"x_processplatform_assemble_surface\" //流程平台相关服务根\r * &lt;/code>&lt;/pre>\r * @return {String} 对应服务跟对应的host。如：http://127.0.0.1:20020\r * @o2syntax\r * var actions = this.Actions.getHost( root );\r */\r \r /**\r * 平台预置了Actions对象用于调用平台提供的服务，您可以使用this.Actions.load来获取这些方法。\r * @method load\r * @methodOf module:Actions\r * @instance\r * @param {String} root 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。\r * 如:\r *&lt;pre>&lt;code class='language-js'>\r * \"x_processplatform_assemble_surface\" //流程平台相关服务根\r * &lt;/code>&lt;/pre>\r * @return {Object} 返回action对象，用于后续服务调用\r * @o2syntax\r * var actions = o2.Actions.load( root );\r * //或\r * var actions = this.Actions.load( root );\r * @o2syntax\r * //获取流程平台服务对象。\r * var processAction = this.Actions.load(\"x_processplatform_assemble_surface\");\r * @o2syntax\r * &lt;caption>\r * 通过this.Actions.load(root)方法得到action对象，就可以访问此服务下的方法了。&lt;br/>\r * 访问方法的规则如下：\r * &lt;/caption>\r * var promise = this.Actions.load( root )[actionName][methodName]( arguements );\r *\r * promise : Promise对象，可以通过promise.then接收返回数据\r * promise.then(\r * function(json){\r * //json为返回的数据\r * }\r * )\r *\r * root : 平台服务根名称，如果 x_processplatform_assemble_surface\r *\r * actionName : 服务下的Action分类名称，如 TaskAction\r *\r * methodName : Action分类下的方法名称，如 get\r *\r * arguements : 需调用的RESTful服务的相关参数。这些参数需要按照先后顺序传入。根据实际情况可以省略某些参数。参数序列分别是:\r *\r * uri的参数, data/formData(Post, Put方法), file(附件), success, failure, async。\r *\r * uri参数：如果有uri有多个参数，需要按先后顺序传入。\r *\r * data（formData）参数：提交到后台的数据，如果是上传附件，传入formData。POST 和 PUT 方法需要传入，GET方法和DELETE方法省略。\r *\r * file参数：POST 或者 PUT方法中有效，当需要上传附件时传入,否则可以省略。\r *\r * success参数：服务执行成功时的回调方法，形如 function(json){\r * json为后台服务传回的数据\r * }。\r *\r * failure 参数：服务执行失败时的回调方法，形如 function(xhr){\r * xhr XmlHttpRequest对象，服务器请求失败时有值\r * }\r * 此参数可以省略，如果省略，系统会自动弹出错误信息。\r *\r * async : 方法同步或者异步执行，默认为true。\r * @o2syntax\r * &lt;caption>\r * 处理返回的数据有两种方式，二选一即可：&lt;br/>\r * 1、该方法return的结果是Promise对象，可以通过 promise.then() 方法来处理。&lt;br/>\r * {@link https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise|Promise说明}&lt;br/>\r * 2、通过success方法作为第一个参数来处理结果\r * &lt;/caption>\r * promise.then(\r * function(json){\r * //json为返回的数据\r * }\r * )\r *\r * //success：arguements中的第一个function对象\r * function(json){\r * //json为后台服务传回的数据\r * }\r * @example\r * &lt;caption>\r * &lt;b>样例1:&lt;/b>\r * 根据x_processplatform_assemble_surface服务获取当前用户的待办列表：&lt;br/>\r * 可以通过对应服务的查询页面，http://server:20020/x_processplatform_assemble_surface/jest/index.html&lt;br/>\r * 可以看到以下界面：&lt;img src=\"img/module/Actions/Actions.png\"/>\r * 我们可以找到TaskAction的V2ListPaging服务是列式当前用户待办的服务。&lt;br/>\r * 该服务有以下信息：&lt;br/>\r * 1、actionName是：TaskAction&lt;br/>\r * 2、methodName是：V2ListPaging&lt;br/>\r * 3、有两个url参数，分别是 page(分页), size(每页数量)&lt;br/>\r * 4、有一系列的body参数&lt;br/>\r * 5、该服务方法类型是POST&lt;br/>\r * 根据这些信息我们可以组织出下面的方法：\r * &lt;/caption>\r * var processAction = this.Actions.load(\"x_processplatform_assemble_surface\"); //获取action\r * var method = processAction.TaskAction.V2ListPaging; //获取列式方法\r * //执行方法1\r * method(\r * 1, //uri 第1个参数，如果无uri参数，可以省略\r * 20, //uri 第2个参数，如果无uri参数，可以省略，如果还有其他uri参数，可以用逗号, 分隔\r * { //body 参数，对POST和PUT请求，该参数必须传，可以为空对象\r * processList : [xxx] //具体参数\r * },\r * function(json){ //正确调用的回调\r * //json.data得到服务返回数据\r * },\r * function(xhr){ //可选，错误调用的回调\r * //xhr为XmlHttpRequest对象，服务器请求失败时有值\r * var responseJSON = JSON.parse( xhr.responseText ) //xhr.responseText {String}是后台返回的出错信息\r * //responseJSON见下面的说明\r *\r * var message = responseJSON.message; //message为错误提示文本\r * },\r * true //可选，true为异步调用，false为同步调用，默认为true\r * );\r *\r * //执行方法2\r * var promise = method( 1, 20, {processList : [xxx]} )\r * promise.then( function(json){\r * //json.data得到服务返回数据\r * })\r * @example\r * &lt;caption>出错信息responseJSON的格式&lt;/caption>\r * {\r * \"type\": \"error\", //类型为错误\r * \"message\": \"标识为:343434 的 Task 对象不存在.\", //提示文本\r * \"date\": \"2020-12-29 17:02:13\", //出错时间\r * \"prompt\": \"com.x.base.core.project.exception.ExceptionEntityNotExist\" //后台错误类\r *}\r * @example\r * &lt;caption>\r * &lt;b>样例2:&lt;/b>\r * 已知流程实例的workid，在脚本中获取数据，修改后进行保存。\r * &lt;/caption>\r * //查询服务列表找到获取data数据服务为DataAction的getWithWork方法\r * //查询服务列表找到更新data数据服务为DataAction的updateWithWork方法\r *\r * var workid = \"cce8bc22-225a-4f85-8132-7374d546886e\";\r * var data;\r * this.Actions.load(\"x_processplatform_assemble_surface\").DataAction.getWithWork( //平台封装好的方法\r * workid, //uri的参数\r * function( json ){ //服务调用成功的回调函数, json为服务传回的数据\r * data = json.data; //为变量data赋值\r * }.bind(this),\r * false //同步执行\r * )\r *\r * data.subject = \"新标题\"; //修改数据\r * this.Actions.load(\"x_processplatform_assemble_surface\").DataAction.updateWithWork(\r * workid, //uri的参数\r * data, //保存的数据\r * function(){ //服务调用成功的回调函数\r * o2.xDesktop.notice(\"success\", {\"y\":\"top\", \"x\": \"right\"}, \"保存成功\"); //提示，{\"y\":\"top\", \"x\": \"right\"}指提示框在顶部右边\r * }.bind(this)\r * );\r */\r \r /**\r * &lt;b>已过时。&lt;/b>平台预置了Action的调用方法，您可以使用o2.Actions.get来获取这些方法。RESTful配置文件在{服务器目录}/webServer/o2_core/o2/xAction/services下。\r * @method get\r * @deprecated\r * @methodOf module:Actions\r * @instance\r * @param {String} root 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。\r *如:&lt;pre>&lt;code class='language-js'>\r * \"x_processplatform_assemble_surface\" //流程平台相关服务根\r * &lt;/code>&lt;/pre>\r * @return {String} 对应服务根的host。如：http://127.0.0.1:20020\r * @o2syntax\r * var actions = o2.Actions.get( root );\r * actions[ methodName ]( arguements );\r *\r * or\r *\r * o2.Actions.get( root )[methodName]( arguements );\r * @o2syntax\r * methodName :（string）方法名称。\r * arguements : 见load方法的arguements说明\r * @example\r * &lt;caption>&lt;b>样例一:&lt;/b>已知流程实例的workid，在脚本中获取数据，修改后进行保存。&lt;/caption>\r * //现已知获取数据的方法名称是 getWorkData uri为： /jaxrs/data/work/{workid}\r * //已知更新数据的方法名称是 saveData uri为： /jaxrs/data/work/{workid}\r * var workid = \"cce8bc22-225a-4f85-8132-7374d546886e\";\r * var action = o2.Actions.get(\"x_processplatform_assemble_surface\");\r * var data;\r * action.getWorkData( //平台封装好的方法\r * workid, //uri的参数\r * function( json ){ //服务调用成功的回调函数, json为服务传回的数据\r * data = json.data; //为变量data赋值\r * }.bind(this),\r * false //同步执行\r * );\r \r * data.subject = \"新标题\"; //修改数据\r * action.saveData(\r * workid, //uri的参数\r * data, //保存的数据\r * function(){ //服务调用成功的回调函数\r * o2.xDesktop.notice(\"success\", {\"y\":\"top\", \"x\": \"right\"}, \"保存成功\"); //提示，{\"y\":\"top\", \"x\": \"right\"}指提示框在顶部右边\r * }.bind(this)\r * );\r * @example\r * &lt;caption>&lt;b>样例二:&lt;/b>已知流程应用的workid，分页列式出流程实例。&lt;/caption>\r * //现已知获取数据的方法名称是 listWorkNext uri为： {\"uri\": \"/jaxrs/work/list/{id}/next/{count}/application/{applicationId}\"},\r * var id = \"(0)\"; //如果是第一页id是(0)，否则传上一页最后一个流程实例的id\r * var count = 10;\r * var applicationId = \"dde8bc22-225a-4f85-8132-7374d546886e\";\r * o2.Actions.get(\"x_processplatform_assemble_surface\").listWorkNext(\r * id, //listWorkNext服务有3个uri参数，要按先后顺序列出\r * count,\r * applicationId,\r * function( json ){\r * //json.data\r * }.bind(this)\r * );\r */\r this.Actions = o2.Actions;\r \r this.query = function (option) {\r // options = {\r // \"name\": \"statementName\",\r // \"data\": \"json data\",\r // \"firstResult\": 1,\r // \"maxResults\": 100,\r // \"success\": function(){},\r // \"error\": function(){},\r // \"async\": true or false, default is true\r // }\r if (option) {\r var json = (option.data) || {};\r if (option.firstResult) json.firstResult = option.firstResult.toInt();\r if (option.maxResults) json.maxResults = option.maxResults.toInt();\r o2.Actions.get(\"x_query_assemble_surface\").executeStatement(option.name, json, success, error, options.async);\r }\r };\r // this.Table = MWF.xScript.createTable();\r };\r \r \r if( !MWF.xScript.dictLoaded )MWF.xScript.dictLoaded = {};\r \r if( !MWF.xScript.createDict ){\r MWF.xScript.addDictToCache = function ( options, path, json ) {\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var type = options.appType || \"process\";\r var enableAnonymous = options.enableAnonymous || false;\r \r var appFlagList = [];\r if( options.application )appFlagList.push( options.application );\r if( options.appId )appFlagList.push( options.appId );\r if( options.appName )appFlagList.push( options.appName );\r if( options.appAlias )appFlagList.push( options.appAlias );\r \r var dictFlagList = [];\r if( options.id )dictFlagList.push( options.id );\r if( options.name )dictFlagList.push( options.name );\r if( options.alias )dictFlagList.push( options.alias );\r \r var cache = {};\r cache[path] = json;\r \r for( var i=0; i&lt;appFlagList.length; i++ ){\r for( var j=0; j&lt;dictFlagList.length; j++ ){\r var k = dictFlagList[j] + type + appFlagList[i] + enableAnonymous;\r if( !MWF.xScript.dictLoaded[k] ){\r MWF.xScript.dictLoaded[k] = cache; //指向同一个对象\r // MWF.xScript.dictLoaded[k][path] = json; //指向不同的对象\r }else if( i===0 &amp;&amp; j===0 ){\r MWF.xScript.setDictToCache( k, path ,json );\r var arr = path.split(/\\./g);\r var p;\r var cache = MWF.xScript.dictLoaded[k];\r for( var l=0 ; l&lt;arr.length; l++ ){\r p = l === 0 ? arr[0] : ( p + \".\" + arr[l] );\r if( cache[ p ] )break;\r }\r if( p ){\r var mathP = p+\".\";\r Object.keys( cache ).each( function( path, idx){\r if( path.indexOf( mathP ) === 0 )delete cache[path];\r })\r }\r }\r }\r }\r };\r \r MWF.xScript.getMatchedDict = function(key, path){\r if( !path )path = \"root\";\r if( path.indexOf(\"root\") !== 0 )path = \"root.\" + path ;\r \r var arr = path.split(/\\./g);\r if( MWF.xScript.dictLoaded[key] ){\r var dicts = MWF.xScript.dictLoaded[key];\r var list = Array.clone(arr);\r var p;\r var dict;\r for( var i=0 ; i&lt;arr.length; i++ ){\r p = i === 0 ? arr[0] : ( p + \".\" + arr[i] );\r list.shift();\r if( dicts[ p ] ){\r dict = dicts[ p ];\r break;\r }\r }\r return {\r dict : dict,\r unmatchedPathList : list\r }\r }\r return {\r dict : null,\r unmatchedPathList : list\r }\r };\r \r MWF.xScript.insertDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r var lastPath = list[list.length-1];\r if( !dict[lastPath] ){\r dict[lastPath] = json;\r }else if( typeOf( dict[lastPath] ) === \"array\" ){\r dict[lastPath].push( json );\r }\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r \r MWF.xScript.setDictToCache = function(key, path, json){\r if( MWF.xScript.dictLoaded[key] ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( !dict ){\r MWF.xScript.dictLoaded[key][path] = json;\r }else{\r for( var j=0; j&lt;list.length-1; j++ ){\r if( !dict[ list[j] ] ){\r dict[ list[j] ] = {};\r }\r dict = dict[ list[j] ];\r }\r dict[list[list.length-1]] = json;\r }\r }else{\r MWF.xScript.dictLoaded[key] = {};\r MWF.xScript.dictLoaded[key][path] = json;\r }\r };\r \r MWF.xScript.getDictFromCache = function( key, path ){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r if( dict ){\r for( var j=0; j&lt;list.length; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return null;\r }\r return dict;\r }\r return null;\r };\r \r MWF.xScript.deleteDictToCache = function(key, path){\r var matchedDict = MWF.xScript.getMatchedDict( key, path );\r var dict = matchedDict.dict;\r var list = matchedDict.unmatchedPathList;\r \r if( dict){\r for( var j=0; j&lt;list.length-1; j++ ){\r dict = dict[ list[j] ];\r if( !dict )return;\r }\r delete dict[list[list.length-1]];\r }\r };\r \r \r MWF.xScript.createDict = function(application){\r //optionsOrName : {\r // type : \"\", //默认为process, 可以为 process cms\r // application : \"\", //流程/CMS的名称/别名/id, 默认为当前应用\r // name : \"\", // 数据字典名称/别名/id\r // enableAnonymous : false //允许在未登录的情况下读取CMS的数据字典\r //}\r //或者name: \"\" // 数据字典名称/别名/id\r return function(optionsOrName){\r var options = optionsOrName;\r if( typeOf( options ) == \"string\" ){\r options = { name : options };\r }\r var name = this.name = options.name;\r var type = ( options.type &amp;&amp; options.application ) ? options.type : \"process\";\r var applicationId = options.application || application;\r var enableAnonymous = options.enableAnonymous || false;\r \r var opt = {\r \"appType\" : type,\r \"name\" : name,\r \"appId\" : applicationId,\r \"enableAnonymous\" : enableAnonymous\r };\r \r var key = name+type+applicationId+enableAnonymous;\r // if (!dictLoaded[key]) dictLoaded[key] = {};\r // this.dictData = dictLoaded[key];\r \r //MWF.require(\"MWF.xScript.Actions.DictActions\", null, false);\r if( type == \"cms\" ){\r var action = MWF.Actions.get(\"x_cms_assemble_control\");\r }else{\r var action = MWF.Actions.get(\"x_processplatform_assemble_surface\");\r }\r \r var encodePath = function( path ){\r var arr = path.split(/\\./g);\r var ar = arr.map(function(v){\r return encodeURIComponent(v);\r });\r return ar.join(\"/\");\r };\r \r this.get = function(path, success, failure, async, refresh){\r var value = null;\r \r if (success===true) async=true;\r if (failure===true) async=true;\r \r if (!refresh ){\r var data = MWF.xScript.getDictFromCache( key, path );\r if( data ){\r if (success &amp;&amp; o2.typeOf(success)==\"function\") success( data );\r if( !!async ){\r return Promise.resolve( data );\r }else{\r return data;\r }\r }\r }\r \r // var cb = function(json){\r // value = json.data;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r // return value;\r // }.ag().catch(function(xhr, text, error){ if (failure &amp;&amp; o2.typeOf(failure)==\"function\") return failure(xhr, text, error); });\r \r var cb = function(json){\r value = json.data;\r MWF.xScript.addDictToCache(opt, path, value);\r if (success &amp;&amp; o2.typeOf(success)==\"function\") value = success(json.data);\r return value;\r };\r \r var promise;\r if (path){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, cb, null, !!async, false);\r }else{\r promise = action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, cb, null, !!async, false);\r }\r return (!!async) ? promise : value;\r \r // if (path){\r // var p = encodePath( path );\r // //var p = path.replace(/\\./g, \"/\");\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictDataAnonymous\" : \"getDictData\" ) ](encodeURIComponent(this.name), applicationId, p, function(json){\r // value = json.data;\r // // this.dictData[path] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }else{\r // action[ ( (enableAnonymous &amp;&amp; type == \"cms\") ? \"getDictRootAnonymous\" : \"getDictRoot\" ) ](this.name, applicationId, function(json){\r // value = json.data;\r // // this.dictData[\"root\"] = value;\r // MWF.xScript.addDictToCache(opt, path, value);\r // if (success) success(json.data);\r // }.bind(this), function(xhr, text, error){\r // if (failure) failure(xhr, text, error);\r // }, !!async);\r // }\r \r //return value;\r };\r \r this.set = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.setDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.setDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.add = function(path, value, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.addDictData(encodeURIComponent(this.name), applicationId, p, value, function(json){\r MWF.xScript.insertDictToCache(key, path, value);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this[\"delete\"] = function(path, success, failure){\r var p = encodePath( path );\r //var p = path.replace(/\\./g, \"/\");\r return action.deleteDictData(encodeURIComponent(this.name), applicationId, p, function(json){\r MWF.xScript.deleteDictToCache(key, path);\r if (success) return success(json.data);\r }, function(xhr, text, error){\r if (failure) return failure(xhr, text, error);\r }, false, false);\r };\r this.destory = this[\"delete\"];\r }\r };\r }\r \r \r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"x_desktop_js_o2m.api.js.html":{"url":"x_desktop_js_o2m.api.js.html","title":"x_desktop/js/o2m.api.js","kind":"source","body":" O2OA WebAPI: x_desktop/js/o2m.api.js | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag source x_desktop/js/o2m.api.js /** ***** BEGIN LICENSE BLOCK *****\r * |------------------------------------------------------------------------------|\r * | O2OA 活力办公 创意无限 o2m.api.js |\r * |------------------------------------------------------------------------------|\r * | Distributed under the AGPL license: |\r * |------------------------------------------------------------------------------|\r * | Copyright © 2018, o2oa.net, o2server.io O2 Team |\r * | All rights reserved. |\r * |------------------------------------------------------------------------------|\r *\r * This file is part of O2OA.\r *\r * O2OA is free software: you can redistribute it and/or modify\r * it under the terms of the GNU Affero General Public License as published by\r * the Free Software Foundation, either version 3 of the License, or\r * (at your option) any later version.\r *\r * O2OA is distributed in the hope that it will be useful,\r * but WITHOUT ANY WARRANTY; without even the implied warranty of\r * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r * GNU Affero General Public License for more details.\r *\r * You should have received a copy of the GNU General Public License\r * along with Foobar. If not, see &lt;https://www.gnu.org/licenses/>.\r *\r * ***** END LICENSE BLOCK ******/\r \r \r \r /**\r * &lt;b>o2m&lt;/b> 是O2OA移动端APP提供的调用原生控件的能力，帮助开发者高效使用拍照、定位等手机系统的能力，同时可以直接使用扫一扫、打开原生应用、选择时间，人员，组织等业务的能力，带给门户接近原生代码的体验\r * &lt;br/>\r * &lt;b>o2m&lt;/b> 只有在O2OA移动端APP中才能提供能力\r * @module o2m\r * @o2ordernumber 160\r * @o2range {流程表单|门户}\r * @o2syntax\r * // 可以在移动端 流程表单、门户 上使用\r * this.o2m\r * \r */\r (function () {\r this.o2m = {\r version: {\r v: \"1.1.0\",\r build: \"2021.01.20\",\r info: \"O2OA 活力办公 创意无限. Copyright © 2021, o2oa.net O2 Team All rights reserved.\"\r },\r log: function (message) {\r window.o2android &amp;&amp; window.o2android.o2mLog ? window.o2android.o2mLog(message) : window.webkit.messageHandlers.o2mLog.postMessage(message);\r }\r };\r \r /** ***** BEGIN NOTIFICATION BLOCK *****\r notification 模块 \r alert\r confirm\r prompt\r vibrate\r toast\r actionSheet\r showLoading\r hideLoading\r * ***** END NOTIFICATION BLOCK ******/\r \r this.o2m.notification = {};\r \r var _notification_post = function (body, onFail) {\r if (body == null) {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"参数异常！\");\r return\r }\r }\r var message = JSON.stringify(body);\r if ((window.o2mNotification &amp;&amp; window.o2mNotification.postMessage) || (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.o2mNotification)) {\r window.o2mNotification &amp;&amp; window.o2mNotification.postMessage ? window.o2mNotification.postMessage(message) : window.webkit.messageHandlers.o2mNotification.postMessage(message);\r } else {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"请在O2OA移动端使用！\");\r return\r }\r }\r };\r \r \r this.o2m.notification.alertSuccess = function () {\r console.log(\"notification alert back\");\r };\r var _o2m_n_alert = function (alert) {\r var message = alert &amp;&amp; alert.message ? alert.message : \"\";\r var title = alert &amp;&amp; alert.title ? alert.title : \"\";\r var buttonName = alert &amp;&amp; alert.buttonName ? alert.buttonName : \"\";\r var onSuccess = alert &amp;&amp; alert.onSuccess ? alert.onSuccess : null;\r var onFail = alert &amp;&amp; alert.onFail ? alert.onFail : null;\r if (message === \"\") {\r if (typeof onFail === \"function\") { onFail(\"消息内容不能为空！\"); }\r return;\r }\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.alertSuccess = onSuccess;\r }\r var body = {\r type: \"alert\",\r callback: \"o2m.notification.alertSuccess\",\r data: {\r message: message,\r title: title,\r buttonName: buttonName,\r }\r };\r _notification_post(body, onFail);\r };\r /**\r * 原生Alert提示弹出窗\r * @method alert\r * @o2membercategory notification\r * @static\r * @param {Object} obj 提示窗传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"title\": \"提示\", //消息标题，可为空\r * \"message\": \"这里是消息内容\", //消息内容\r * \"buttonName\": \"确定\", //确定按钮名称\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/notification_alert.jpeg\">\r * &lt;/caption>\r * o2m.notification.alert({\r * message: \"亲爱的\",\r * title: \"提示\",//可传空\r * buttonName: \"收到\",\r * onSuccess : function() {//onSuccess将在点击button之后回调},\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.alert = _o2m_n_alert;\r \r //notification.confirm\r this.o2m.notification.confirmSuccess = function (index) {\r console.log(\"notification confirm back, click button index: \" + index);\r };\r var _o2m_n_confirm = function (c) {\r var buttonLabels = c &amp;&amp; c.buttonLabels ? c.buttonLabels : [\"确定\", \"取消\"];\r var message = c &amp;&amp; c.message ? c.message : \"\";\r var title = c &amp;&amp; c.title ? c.title : \"\";\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (message === \"\") {\r if (typeof onFail === \"function\") { onFail(\"消息内容message不能为空！\"); }\r return;\r }\r if (buttonLabels.length != 2) {\r if (typeof onFail === \"function\") { onFail(\"按钮名称数组长度只能是2！\"); }\r return;\r }\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.confirmSuccess = onSuccess;\r }\r var body = {\r type: \"confirm\",\r callback: \"o2m.notification.confirmSuccess\",\r data: {\r message: message,\r title: title,\r buttonLabels: buttonLabels,\r }\r };\r _notification_post(body, onFail);\r }\r /**\r * 原生confirm提示弹出窗\r * @method confirm\r * @o2membercategory notification\r * @static\r * @param {Object} obj 提示窗传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"title\": \"提示\", //消息标题，可为空\r * \"message\": \"这里是消息内容\", //消息内容\r * \"buttonLabels\": [\"确定\", \"取消\"], //按钮名称 Array[String]\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/notification_confirm.jpeg\">\r * &lt;/caption>\r * o2m.notification.confirm({\r * message: \"你爱我吗\",\r * title: \"提示\",//可传空\r * buttonLabels: ['爱', '不爱'],\r * onSuccess : function(buttonIndex) {\r * //onSuccess将在点击button之后回调\r * //buttonIndex: 0 被点击按钮的索引值，Number类型，从0开始\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.confirm = _o2m_n_confirm;\r \r //notification.prompt\r this.o2m.notification.promptSuccess = function (result) {\r console.log(\"notification prompt back, click button result: \" + result);\r };\r var _o2m_n_prompt = function (c) {\r var buttonLabels = c &amp;&amp; c.buttonLabels ? c.buttonLabels : [\"确定\", \"取消\"];\r var message = c &amp;&amp; c.message ? c.message : \"\";\r var title = c &amp;&amp; c.title ? c.title : \"\";\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (message === \"\") {\r if (typeof onFail === \"function\") { onFail(\"消息内容message不能为空！\"); }\r return;\r }\r if (buttonLabels.length != 2) {\r if (typeof onFail === \"function\") { onFail(\"按钮名称数组长度只能是2！\"); }\r return;\r }\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.promptSuccess = onSuccess;\r }\r var body = {\r type: \"prompt\",\r callback: \"o2m.notification.promptSuccess\",\r data: {\r message: message,\r title: title,\r buttonLabels: buttonLabels,\r }\r };\r _notification_post(body, onFail);\r }\r /**\r * 原生prompt提示弹出窗\r * @method prompt\r * @o2membercategory notification\r * @static\r * @param {Object} obj prompt需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"title\": \"提示\", //消息标题，可为空\r * \"message\": \"这里是消息内容\", //消息内容\r * \"buttonLabels\": ['继续', '不玩了'], //按钮名称 Array[String]\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/notification_prompt.jpeg\">\r * &lt;/caption>\r * o2m.notification.prompt({\r * message: \"再说一遍？\",\r * title: \"提示\",//可传空\r * buttonLabels: ['继续', '不玩了'],\r * onSuccess : function(result) {\r * //result是一个字符串，格式是json格式，内容如下：\r * //{\r * // buttonIndex: 0, //被点击按钮的索引值，Number类型，从0开始\r * // value: '' //输入的值\r * //}\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.prompt = _o2m_n_prompt;\r \r \r //notification.vibrate\r this.o2m.notification.vibrateSuccess = function () {\r console.log(\"notification vibrate back, click button\");\r };\r var _o2m_n_vibrate = function (c) {\r var duration = c &amp;&amp; c.duration ? c.duration : 300;\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r \r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.vibrateSuccess = onSuccess;\r }\r var body = {\r type: \"vibrate\",\r callback: \"o2m.notification.vibrateSuccess\",\r data: {\r duration: duration\r }\r };\r _notification_post(body, onFail);\r };\r \r /**\r * 手机震动\r * @method vibrate\r * @o2membercategory notification\r * @static\r * @param {Object} obj 震动需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"duration\": 300, //震动时间，android可配置 iOS忽略\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.notification.vibrate({\r * duration: 300, \r * onSuccess : function() {\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.vibrate = _o2m_n_vibrate;\r \r //notification.toast\r this.o2m.notification.toastSuccess = function () {\r console.log(\"notification toast back, click button\");\r };\r var _o2m_n_toast = function (c) {\r var duration = c &amp;&amp; c.duration ? c.duration : 300;\r var message = c &amp;&amp; c.message ? c.message : \"\";\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (message === \"\") {\r if (typeof onFail === \"function\") { onFail(\"消息内容message不能为空！\"); }\r return;\r }\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.toastSuccess = onSuccess;\r }\r var body = {\r type: \"toast\",\r callback: \"o2m.notification.toastSuccess\",\r data: {\r duration: duration,\r message: message\r }\r };\r _notification_post(body, onFail);\r };\r \r /**\r * toast提示\r * @method toast\r * @o2membercategory notification\r * @static\r * @param {Object} obj toast需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"message\": \"这里是提示信息\",\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.notification.toast({\r * message: \"提示消息内容\", \r * onSuccess : function() {\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.toast = _o2m_n_toast;\r \r //notification.actionSheet\r this.o2m.notification.actionSheetSuccess = function (buttonIndex) {\r console.log(\"notification actionSheet back, click button:\" + buttonIndex);\r };\r var _o2m_n_actionSheet = function (c) {\r var title = c &amp;&amp; c.title ? c.title : \"\";\r var cancelButton = c &amp;&amp; c.cancelButton ? c.cancelButton : \"取消\";\r var otherButtons = c &amp;&amp; c.otherButtons ? c.otherButtons : [];\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (title === \"\") {\r if (typeof onFail === \"function\") { onFail(\"title标题不能为空！\"); }\r return;\r }\r if (otherButtons.length &lt; 1) {\r if (typeof onFail === \"function\") { onFail(\"其他按钮列表不能为空！\"); }\r return;\r }\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.actionSheetSuccess = onSuccess;\r }\r var body = {\r type: \"actionSheet\",\r callback: \"o2m.notification.actionSheetSuccess\",\r data: {\r title: title,\r cancelButton: cancelButton,\r otherButtons: otherButtons\r }\r };\r _notification_post(body, onFail);\r };\r /**\r * 底部弹出菜单\r * @method actionSheet\r * @o2membercategory notification\r * @static\r * @param {Object} obj actionSheet需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"title\": \"谁是最棒哒？\",//标题\r * \"cancelButton\": '取消', //取消按钮文本\r * \"otherButtons\": [\"孙悟空\",\"猪八戒\",\"唐僧\",\"沙和尚\"], //其他选项按钮名称\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/notification_action_sheet.jpeg\">\r * &lt;/caption>\r * o2m.notification.actionSheet({\r * title: \"谁是最棒哒？\", //标题\r * cancelButton: '取消', //取消按钮文本\r * otherButtons: [\"孙悟空\",\"猪八戒\",\"唐僧\",\"沙和尚\"],\r * onSuccess : function(buttonIndex) {\r * //buttonIndex: 0 被点击按钮的索引值，Number，从0开始, 取消按钮为-1\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.actionSheet = _o2m_n_actionSheet;\r \r //notification.showLoading\r this.o2m.notification.showLoadingSuccess = function () {\r console.log(\"notification showLoading back\");\r };\r var _o2m_n_showLoading = function (c) {\r var text = c &amp;&amp; c.text ? c.text : \"\";\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.showLoadingSuccess = onSuccess;\r }\r var body = {\r type: \"showLoading\",\r callback: \"o2m.notification.showLoadingSuccess\",\r data: {\r text: text\r }\r };\r _notification_post(body, onFail);\r };\r /**\r * 显示Loading浮层，请和hideLoading配合使用\r * @method showLoading\r * @o2membercategory notification\r * @static\r * @param {Object} obj showLoading需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * text: \"使劲加载中..\", //loading显示的字符，空表示不显示文字\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/notification_showLoading.jpeg\">\r * &lt;/caption>\r * o2m.notification.showLoading({\r * text: \"使劲加载中..\", //loading显示的字符，空表示不显示文字\r * onSuccess : function() {\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.showLoading = _o2m_n_showLoading;\r \r //notification.hideLoading\r this.o2m.notification.hideLoadingSuccess = function () {\r console.log(\"notification hideLoading back\");\r };\r var _o2m_n_hideLoading = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.notification.hideLoadingSuccess = onSuccess;\r }\r var body = {\r type: \"hideLoading\",\r callback: \"o2m.notification.hideLoadingSuccess\",\r data: {\r }\r };\r _notification_post(body, onFail);\r }\r /**\r * 隐藏Loading浮层\r * @method hideLoading\r * @o2membercategory notification\r * @static\r * @param {Object} obj hideLoading需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.notification.hideLoading({\r * onSuccess : function() {\r * },\r * onFail : function(err) {}\r * });\r * \r */\r this.o2m.notification.hideLoading = _o2m_n_hideLoading;\r \r \r \r \r \r /** ***** BEGIN UTIL BLOCK *****\r util 模块 \r date\r o2m.util.date.datePicker\r o2m.util.date.timePicker\r o2m.util.date.dateTimePicker\r calendar\r o2m.util.calendar.chooseOneDay\r o2m.util.calendar.chooseDateTime\r o2m.util.calendar.chooseInterval\r device\r o2m.util.device.getPhoneInfo\r o2m.util.device.scan\r o2m.util.deveice.location\r navigation\r o2m.util.navigation.setTitle\r o2m.util.navigation.close\r o2m.util.navigation.goBack\r \r \r \r * ***** END UTIL BLOCK ******/\r \r this.o2m.util = {\r date: {},\r calendar: {},\r device: {},\r navigation: {}\r };\r \r var _util_post = function (body, onFail) {\r if (body == null) {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"参数异常！\");\r return;\r }\r }\r var message = JSON.stringify(body);\r if ((window.o2mUtil &amp;&amp; window.o2mUtil.postMessage) || (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.o2mUtil)) {\r window.o2mUtil &amp;&amp; window.o2mUtil.postMessage ? window.o2mUtil.postMessage(message) : window.webkit.messageHandlers.o2mUtil.postMessage(message);\r } else {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"请在O2OA移动端使用！\");\r }\r }\r };\r \r //o2m.util.date.datePicker\r this.o2m.util.date.datePickerSuccess = function (result) {\r console.log(\"util date datePicker back, result:\" + result);\r };\r var _o2m_u_date_datePicker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var value = c &amp;&amp; c.value ? c.value : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.date.datePickerSuccess = onSuccess;\r }\r var body = {\r type: \"date.datePicker\",\r callback: \"o2m.util.date.datePickerSuccess\",\r data: {\r value: value\r }\r };\r _util_post(body, onFail);\r };\r \r /**\r * 日期选择器\r * @method datePicker\r * @o2membercategory util.date\r * @static\r * @param {Object} obj datePicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * value: '2019-04-17', //默认显示日期\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_date_picker.jpeg\">\r * &lt;/caption>\r * o2m.util.date.datePicker({\r * value: '2019-04-17', //默认显示日期\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * value: \"2019-02-10\"\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.date.datePicker = _o2m_u_date_datePicker;\r \r //o2m.util.date.timePicker\r this.o2m.util.date.timePickerSuccess = function (result) {\r console.log(\"util date timePicker back, result:\" + result);\r };\r var _o2m_u_date_timePicker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var value = c &amp;&amp; c.value ? c.value : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.date.timePickerSuccess = onSuccess;\r }\r var body = {\r type: \"date.timePicker\",\r callback: \"o2m.util.date.timePickerSuccess\",\r data: {\r value: value\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 时间选择器\r * @method timePicker\r * @o2membercategory util.date\r * @static\r * @param {Object} obj timePicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * value: '14:00', //默认显示时间\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_time_picker.jpeg\">\r * &lt;/caption>\r * o2m.util.date.timePicker({\r * value: '14:00', //默认显示时间\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * value: \"18:10\"\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.date.timePicker = _o2m_u_date_timePicker;\r \r \r \r //o2m.util.date.dateTimePicker\r this.o2m.util.date.dateTimePickerSuccess = function (result) {\r console.log(\"util date dateTimePicker back, result:\" + result);\r };\r var _o2m_u_date_dateTimePicker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var value = c &amp;&amp; c.value ? c.value : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.date.dateTimePickerSuccess = onSuccess;\r }\r var body = {\r type: \"date.dateTimePicker\",\r callback: \"o2m.util.date.dateTimePickerSuccess\",\r data: {\r value: value\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 日期时间选择器\r * @method dateTimePicker\r * @o2membercategory util.date\r * @static\r * @param {Object} obj dateTimePicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * value: '2019-05-05 14:00', //默认显示时间\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_date_time_picker.jpeg\">\r * &lt;/caption>\r * o2m.util.date.dateTimePicker({\r * value: '2019-05-05 14:00', //默认显示时间\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * value: \"2019-03-18 18:10\"\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.date.dateTimePicker = _o2m_u_date_dateTimePicker;\r \r \r \r //o2m.util.calendar.chooseOneDay\r this.o2m.util.calendar.chooseOneDaySuccess = function (result) {\r console.log(\"util calendar chooseOneDay back, result:\" + result);\r };\r var _o2m_u_calendar_chooseOneDay = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var value = c &amp;&amp; c.value ? c.value : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.calendar.chooseOneDaySuccess = onSuccess;\r }\r var body = {\r type: \"calendar.chooseOneDay\",\r callback: \"o2m.util.calendar.chooseOneDaySuccess\",\r data: {\r value: value\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 月历日期选择器\r * @method chooseOneDay\r * @o2membercategory util.date\r * @static\r * @param {Object} obj chooseOneDay需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * value: '2019-05-05', //默认显示日期\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_choose_one_day.jpeg\">\r * &lt;/caption>\r * o2m.util.date.chooseOneDay({\r * value: '2019-05-05', //默认显示日期\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * value: \"2019-03-18\"\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.calendar.chooseOneDay = _o2m_u_calendar_chooseOneDay;\r \r \r //o2m.util.calendar.chooseDateTime\r this.o2m.util.calendar.chooseDateTimeSuccess = function (result) {\r console.log(\"util calendar chooseDateTime back, result:\" + result);\r };\r var _o2m_u_calendar_chooseDateTime = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var value = c &amp;&amp; c.value ? c.value : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.calendar.chooseDateTimeSuccess = onSuccess;\r }\r var body = {\r type: \"calendar.chooseDateTime\",\r callback: \"o2m.util.calendar.chooseDateTimeSuccess\",\r data: {\r value: value\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 月历日期时间选择器\r * @method chooseDateTime\r * @o2membercategory util.date\r * @static\r * @param {Object} obj chooseDateTime需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * value: '2019-05-05 11:00', //默认显示时间\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_choose_date_time.jpeg\">\r * &lt;/caption>\r * o2m.util.date.chooseDateTime({\r * value: '2019-05-05 11:00', //默认显示时间\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * value: \"2019-03-18 18:45\"\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.calendar.chooseDateTime = _o2m_u_calendar_chooseDateTime;\r \r \r //o2m.util.calendar.chooseInterval\r this.o2m.util.calendar.chooseIntervalSuccess = function (result) {\r console.log(\"util calendar chooseInterval back, result:\" + result);\r };\r var _o2m_u_calendar_chooseInterval = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var startDate = c &amp;&amp; c.startDate ? c.startDate : \"\";\r var endDate = c &amp;&amp; c.endDate ? c.endDate : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.calendar.chooseIntervalSuccess = onSuccess;\r }\r var body = {\r type: \"calendar.chooseInterval\",\r callback: \"o2m.util.calendar.chooseIntervalSuccess\",\r data: {\r startDate: startDate,\r endDate: endDate\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 月历日期区间选择器\r * @method chooseInterval\r * @o2membercategory util.date\r * @static\r * @param {Object} obj chooseInterval需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * startDate: '2019-05-05',\r * endDate: '2019-05-06',\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/util_choose_interval.jpeg\">\r * &lt;/caption>\r * o2m.util.date.chooseInterval({\r * value: '2019-05-05 11:00', //默认显示时间\r * onSuccess : function(result) {\r * //onSuccess将在点击完成之后回调\r * {\r * startDate: \"2019-05-05\", \r endDate: \"2019-05-06\",\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.calendar.chooseInterval = _o2m_u_calendar_chooseInterval;\r \r \r //o2m.util.device.getPhoneInfo\r this.o2m.util.device.getPhoneInfoSuccess = function (result) {\r console.log(\"util calendar chooseInterval back, result:\" + result);\r };\r var _o2m_u_device_getPhoneInfo = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.device.getPhoneInfoSuccess = onSuccess;\r }\r var body = {\r type: \"device.getPhoneInfo\",\r callback: \"o2m.util.device.getPhoneInfoSuccess\",\r data: {\r \r }\r };\r _util_post(body, onFail);\r };\r /**\r * 获取手机基础信息\r * @method getPhoneInfo\r * @o2membercategory util.device\r * @static\r * @param {Object} obj getPhoneInfo需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.util.device.getPhoneInfo({\r * onSuccess : function(result) {\r * {\r * screenWidth: 1080, // 手机屏幕宽度\r * screenHeight: 1920, // 手机屏幕高度\r * brand:'Mi'， // 手机品牌\r * model:'Note4', // 手机型号\r * version:'7.0'. // 版本\r * netInfo:'wifi' , // 网络类型 wifi／4g／3g \r * operatorType :'xx' // 运营商信息\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.device.getPhoneInfo = _o2m_u_device_getPhoneInfo;\r \r \r //o2m.util.device.scan\r this.o2m.util.device.scanSuccess = function (result) {\r console.log(\"util device scan back, result:\" + result);\r };\r var _o2m_u_device_scan = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.device.scanSuccess = onSuccess;\r }\r var body = {\r type: \"device.scan\",\r callback: \"o2m.util.device.scanSuccess\",\r data: {\r \r }\r };\r _util_post(body, onFail);\r };\r /**\r * 扫二维码\r * @method scan\r * @o2membercategory util.device\r * @static\r * @param {Object} obj scan需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.util.device.scan({\r * onSuccess : function(result) {\r * { 'text': '扫码内容'}\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.device.scan = _o2m_u_device_scan;\r \r \r //o2m.util.device.location\r this.o2m.util.device.locationSuccess = function (result) {\r console.log(\"util device location back, result:\" + result);\r };\r var _o2m_u_device_location = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.device.locationSuccess = onSuccess;\r }\r var body = {\r type: \"device.location\",\r callback: \"o2m.util.device.locationSuccess\",\r data: {\r \r }\r };\r _util_post(body, onFail);\r };\r /**\r * 单次定位\r * @method location\r * @o2membercategory util.device\r * @static\r * @param {Object} obj location需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.util.device.location({\r * onSuccess : function(result) {\r * //这里返回百度坐标系的定位信息 \r * { \r * 'latitude': 39.903578, // 纬度\r * 'longitude': 116.473565, // 经度\r * 'address': '地址描述'\r * }\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.device.location = _o2m_u_device_location;\r \r \r //o2m.util.navigation.setTitle\r this.o2m.util.navigation.setTitleSuccess = function (result) {\r console.log(\"util calendar chooseInterval back, result:\" + result);\r };\r var _o2m_u_navigation_setTitle = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r var title = c &amp;&amp; c.title ? c.title : \"\";\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.navigation.setTitleSuccess = onSuccess;\r }\r var body = {\r type: \"navigation.setTitle\",\r callback: \"o2m.util.navigation.setTitleSuccess\",\r data: {\r title: title\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 设置原生页面标题\r * @method setTitle\r * @o2membercategory util.navigation\r * @static\r * @param {Object} obj setTitle需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * title : '导航标题', \r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * o2m.util.navigation.setTitle({\r * title : '导航标题', \r * onSuccess : function() {\r * },\r * onFail : function(err) {}\r *});\r */\r this.o2m.util.navigation.setTitle = _o2m_u_navigation_setTitle;\r \r \r //o2m.util.navigation.close\r this.o2m.util.navigation.closeSuccess = function (result) {\r console.log(\"util calendar chooseInterval back, result:\" + result);\r };\r var _o2m_u_navigation_close = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.navigation.closeSuccess = onSuccess;\r }\r var body = {\r type: \"navigation.close\",\r callback: \"o2m.util.navigation.closeSuccess\",\r data: {\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 关闭当前原生页面\r * @method close\r * @o2membercategory util.navigation\r * @static\r * @example\r * o2m.util.navigation.close();\r */\r this.o2m.util.navigation.close = _o2m_u_navigation_close;\r \r \r //o2m.util.navigation.goBack\r this.o2m.util.navigation.goBackSuccess = function (result) {\r console.log(\"util calendar chooseInterval back, result:\" + result);\r };\r var _o2m_u_navigation_goBack = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.util.navigation.goBackSuccess = onSuccess;\r }\r var body = {\r type: \"navigation.goBack\",\r callback: \"o2m.util.navigation.goBackSuccess\",\r data: {\r }\r };\r _util_post(body, onFail);\r };\r /**\r * 返回上级原生页面\r * @method goBack\r * @o2membercategory util.navigation\r * @static\r * @example\r * o2m.util.navigation.goBack();\r */\r this.o2m.util.navigation.goBack = _o2m_u_navigation_goBack;\r \r \r \r \r /** ***** BEGIN BIZ BLOCK *****\r biz 模块\r contact\r o2m.biz.contact.PersonPicker\r o2m.biz.contact.IdentityPicker\r o2m.biz.contact.departmentsPicker\r o2m.biz.contact.ComplexPicker\r o2m.biz.contact.GroupPicker\r \r * ***** END UTIL BLOCK ******/\r \r this.o2m.biz = {\r contact: {}\r };\r \r var _biz_post = function (body, onFail) {\r if (body == null) {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"参数异常！\");\r return;\r }\r }\r var message = JSON.stringify(body);\r if ((window.o2mBiz &amp;&amp; window.o2mBiz.postMessage) || (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.o2mBiz)) {\r window.o2mBiz &amp;&amp; window.o2mBiz.postMessage ? window.o2mBiz.postMessage(message) : window.webkit.messageHandlers.o2mBiz.postMessage(message);\r } else {\r if (onFail &amp;&amp; typeof onFail === \"function\") {\r onFail(\"请在O2OA移动端使用！\");\r }\r }\r };\r \r //o2m.biz.workClose()\r var _o2m_b_work_close = function () {\r if (window.o2android &amp;&amp; window.o2android.closeWork) {\r window.o2android.closeWork(\"\");\r } else if (window.webkit &amp;&amp; window.webkit.messageHandlers &amp;&amp; window.webkit.messageHandlers.closeWork) {\r window.webkit.messageHandlers.closeWork.postMessage(\"\");\r } else {\r console.log(\"请在O2OA移动端使用, workClose\");\r }\r }\r /**\r * 关闭当前工作页面，&lt;b>只能在工作表单中可以使用&lt;/b>\r * @method workClose\r * @o2membercategory biz\r * @static\r * @example\r * o2m.biz.workClose();\r */\r this.o2m.biz.workClose = _o2m_b_work_close;\r \r \r //o2m.biz.contact.departmentsPicker\r this.o2m.biz.contact.departmentsPickerSuccess = function (result) {\r console.log(\"biz contact departmentsPicker back, result:\" + result);\r };\r var _o2m_b_contact_department_picker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.biz.contact.departmentsPickerSuccess = onSuccess;\r }\r var topList = c &amp;&amp; c.topList ? c.topList : [];\r var orgType = c &amp;&amp; c.orgType ? c.orgType : \"\";\r var multiple = c &amp;&amp; c.multiple ? c.multiple : false;\r var maxNumber = c &amp;&amp; c.maxNumber ? c.maxNumber : 0;\r var pickedDepartments = c &amp;&amp; c.pickedDepartments ? c.pickedDepartments : [];\r var body = {\r type: \"contact.departmentPicker\",\r callback: \"o2m.biz.contact.departmentsPickerSuccess\",\r data: {\r topList: topList,\r orgType: orgType,\r multiple: multiple,\r maxNumber: maxNumber,\r pickedDepartments: pickedDepartments,\r }\r };\r _biz_post(body, onFail);\r };\r /**\r * 通讯录选部门\r * @method departmentsPicker\r * @o2membercategory biz\r * @static\r * @param {Object} obj departmentsPicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * topList: [],//Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织\r * orgType: \"\",//String 可选择的组织类别。为空就是全部组织类型都可以\r * multiple:true, //是否多选\r * maxNumber: 0, //Int 当multiple为true的时候，最多可选择的部门数\r * pickedDepartments:[],//Array[String] 已经选择的部门distinguishedName列表\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/biz_dept_choose.png\">\r * &lt;/caption>\r * o2m.biz.contact.departmentsPicker({\r * topList: [],//不传或者空列表，显示全部组织\r * orgType: \"\",//可传空 只显示某种类型的组织\r * multiple:true, //是否多选\r * maxNumber: 0, //最大选择数量\r * pickedDepartments:[],//已选部门\r * onSuccess : function(result) {\r * //返回结果样例\r * {\r * departments:[{\r * \"id\":\"xxxx\",\r * \"name\":\"部门名称\", \r * \"unique\":\"xxxx\",\r * \"distinguishedName\":\"部门@xxxx@U\",\r * \"typeList\":[\"xxxx\"],\r * \"shortName\":\"xxxx\",\r * \"level\": 0,\r * \"levelName\":\"xxxx\",\r * }]\r * }\r * \r * },\r * onFail : function(err) {}\r * });\r */\r this.o2m.biz.contact.departmentsPicker = _o2m_b_contact_department_picker;\r \r \r //o2m.biz.contact.IdentityPicker\r this.o2m.biz.contact.IdentityPickerSuccess = function (result) {\r console.log(\"biz contact IdentityPicker back, result:\" + result);\r };\r var _o2m_b_contact_identity_picker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.biz.contact.IdentityPickerSuccess = onSuccess;\r }\r var topList = c &amp;&amp; c.topList ? c.topList : [];\r var multiple = c &amp;&amp; c.multiple ? c.multiple : false;\r var maxNumber = c &amp;&amp; c.maxNumber ? c.maxNumber : 0;\r var pickedIdentities = c &amp;&amp; c.pickedIdentities ? c.pickedIdentities : [];\r var duty = c &amp;&amp; c.duty ? c.duty : [];\r var body = {\r type: \"contact.identityPicker\",\r callback: \"o2m.biz.contact.IdentityPickerSuccess\",\r data: {\r topList: topList,\r multiple: multiple,\r maxNumber: maxNumber,\r pickedIdentities: pickedIdentities,\r duty: duty,\r }\r };\r _biz_post(body, onFail);\r };\r /**\r * 通讯录选身份\r * @method IdentityPicker\r * @o2membercategory biz\r * @static\r * @param {Object} obj IdentityPicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * topList: [],//Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织\r * multiple:true, //Boolean 是否多选\r * maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数\r * pickedIdentities:[],//Array[String] 已经选择的身份distinguishedName列表\r * duty: [],//Array[String] 可选择的人员职责\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/biz_identity_choose.png\">\r * &lt;/caption>\r * o2m.biz.contact.IdentityPicker({\r * topList: [],//不传或者空列表，显示全部组织\r * multiple:true, //是否多选\r * maxNumber: 0, //最大选择数量\r * pickedIdentities:[],//已选身份列表\r * duty: [],//人员职责\r * onSuccess : function(result) {\r * //返回结果样例\r * {\r * identities:[{\r * \"id\":\"xxxx\",\r * \"name\":\"姓名\", \r * \"distinguishedName\":\"姓名@xxxx@I\",\r * \"person\":\"xxx\", \r * \"unique\":\"xxxx\",\r * \"unit\":\"xxx\",\r * \"unitName\":\"xxxx\",\r * \"unitLevel\": 0,\r * \"unitLevelName\":\"xxxx\",\r * \"personName\":\"xxxx\",\r * \"personUnique\":\"xxx\",\r * \"personDn\":\"xxx\"\r * }]\r * }\r * \r * },\r * onFail : function(err) {}\r * });\r */\r this.o2m.biz.contact.IdentityPicker = _o2m_b_contact_identity_picker;\r \r \r \r //o2m.biz.contact.GroupPicker\r this.o2m.biz.contact.GroupPickerSuccess = function (result) {\r console.log(\"biz contact GroupPicker back, result:\" + result);\r };\r var _o2m_b_contact_group_picker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.biz.contact.GroupPickerSuccess = onSuccess;\r }\r var multiple = c &amp;&amp; c.multiple ? c.multiple : false;\r var maxNumber = c &amp;&amp; c.maxNumber ? c.maxNumber : 0;\r var pickedGroups = c &amp;&amp; c.pickedGroups ? c.pickedGroups : [];\r var body = {\r type: \"contact.groupPicker\",\r callback: \"o2m.biz.contact.GroupPickerSuccess\",\r data: {\r multiple: multiple,\r maxNumber: maxNumber,\r pickedGroups: pickedGroups,\r }\r };\r _biz_post(body, onFail);\r };\r /**\r * 群组选择\r * @method GroupPicker\r * @o2membercategory biz\r * @static\r * @param {Object} obj GroupPicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * multiple:true, //Boolean 是否多选\r * maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数\r * pickedGroups:[],//Array[String] 已经选择的群组distinguishedName列表\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/biz_group_choose.png\">\r * &lt;/caption>\r * o2m.biz.contact.GroupPicker({\r * multiple:true, //是否多选\r * maxNumber: 0, //最大选择数量\r * pickedGroups:[],//已选群组列表\r * onSuccess : function(result) {\r * //返回结果样例\r * {\r * groups:[{\r * \"id\":\"xxxx\", \r * \"name\":\"群组名称\", \r * \"distinguishedName\":\"群组名称@xxxx@G\"\r * \"unique\":\"xxxx\", \r * }]\r * }\r * \r * },\r * onFail : function(err) {}\r * });\r */\r this.o2m.biz.contact.GroupPicker = _o2m_b_contact_group_picker;\r \r \r //o2m.biz.contact.PersonPicker\r this.o2m.biz.contact.PersonPickerSuccess = function (result) {\r console.log(\"biz contact PersonPicker back, result:\" + result);\r };\r var _o2m_b_contact_person_picker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.biz.contact.PersonPickerSuccess = onSuccess;\r }\r var multiple = c &amp;&amp; c.multiple ? c.multiple : false;\r var maxNumber = c &amp;&amp; c.maxNumber ? c.maxNumber : 0;\r var pickedUsers = c &amp;&amp; c.pickedUsers ? c.pickedUsers : [];\r var body = {\r type: \"contact.personPicker\",\r callback: \"o2m.biz.contact.PersonPickerSuccess\",\r data: {\r multiple: multiple,\r maxNumber: maxNumber,\r pickedUsers: pickedUsers,\r }\r };\r _biz_post(body, onFail);\r };\r /**\r * 人员选择\r * @method PersonPicker\r * @o2membercategory biz\r * @static\r * @param {Object} obj PersonPicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * multiple:true, //Boolean 是否多选\r * maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数\r * pickedUsers:[],//Array[String] 已经选择的人员distinguishedName列表\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/biz_person_choose.png\">\r * &lt;/caption>\r * o2m.biz.contact.PersonPicker({\r * multiple:true, //是否多选\r * maxNumber: 0, //最大选择数量\r * pickedUsers:[],//已选人员列表\r * onSuccess : function(result) {\r * //返回结果样例\r * {\r * users:[{\r * \"id\":\"xxx\", \r * \"name\":\"姓名\", \r * \"unique\":\"xxx\", \r * \"distinguishedName\":\"姓名@xxxx@P\"\r * \"genderType\":\"xxx\", \r * \"employee\":\"xxx\", \r * \"mail\":\"xxx\", \r * \"weixin\":\"xxx\", \r * \"qq\":\"xxx\", \r * \"mobile\":\"xxx\", \r * \"officePhone\":\"xxx\"\r * }]\r * }\r * \r * },\r * onFail : function(err) {}\r * });\r */\r this.o2m.biz.contact.PersonPicker = _o2m_b_contact_person_picker;\r \r \r //o2m.biz.contact.ComplexPicker\r this.o2m.biz.contact.ComplexPickerSuccess = function (result) {\r console.log(\"biz contact ComplexPicker back, result:\" + result);\r };\r var _o2m_b_contact_complex_picker = function (c) {\r var onSuccess = c &amp;&amp; c.onSuccess ? c.onSuccess : null;\r var onFail = c &amp;&amp; c.onFail ? c.onFail : null;\r if (onSuccess &amp;&amp; typeof onSuccess === \"function\") {\r o2m.biz.contact.ComplexPickerSuccess = onSuccess;\r }\r var pickMode = c &amp;&amp; c.pickMode ? c.pickMode : [];\r var multiple = c &amp;&amp; c.multiple ? c.multiple : false;\r var maxNumber = c &amp;&amp; c.maxNumber ? c.maxNumber : 0;\r var topList = c &amp;&amp; c.topList ? c.topList : [];\r var orgType = c &amp;&amp; c.orgType ? c.orgType : \"\";\r var duty = c &amp;&amp; c.duty ? c.duty : [];\r var pickedGroups = c &amp;&amp; c.pickedGroups ? c.pickedGroups : [];\r var pickedUsers = c &amp;&amp; c.pickedUsers ? c.pickedUsers : [];\r var pickedIdentities = c &amp;&amp; c.pickedIdentities ? c.pickedIdentities : [];\r var pickedDepartments = c &amp;&amp; c.pickedDepartments ? c.pickedDepartments : [];\r var body = {\r type: \"contact.complexPicker\",\r callback: \"o2m.biz.contact.ComplexPickerSuccess\",\r data: {\r pickMode: pickMode,\r multiple: multiple,\r maxNumber: maxNumber,\r topList: topList,\r orgType: orgType,\r duty: duty,\r pickedGroups: pickedGroups,\r pickedUsers: pickedUsers,\r pickedIdentities: pickedIdentities,\r pickedDepartments: pickedDepartments,\r }\r };\r _biz_post(body, onFail);\r };\r /**\r * 复合选择器，可配置选择多种数据\r * @method ComplexPicker\r * @o2membercategory biz\r * @static\r * @param {Object} obj ComplexPicker需要传入对象\r * &lt;pre>&lt;code class='language-js'>{\r * pickMode: [\"departmentPicker\", \"identityPicker\"], //Array[String] 选择器类型，可传入值：departmentPicker、identityPicker、groupPicker、personPicker\r * topList：Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织\r * duty: Array[String] 可选择的人员职责\r * orgType：String 可选择的组织类别。为空就是全部组织类型都可以\r * multiple:true, //Boolean 是否多选\r * maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数\r * pickedDepartments：Array[String] 已经选择的部门distinguishedName列表\r * pickedIdentities：Array[String] 已经选择的身份distinguishedName列表\r * pickedGroups： Array[String] 已经选择的群组distinguishedName列表\r * pickedUsers:[],//Array[String] 已经选择的人员distinguishedName列表\r * \"onSuccess\": function, //成功回调\r * \"onFail\": function, //失败回调\r * }&lt;/code>&lt;/pre>\r * @example\r * &lt;caption>\r * 样例效果：&lt;br/>\r * &lt;img src=\"img/module/o2m/biz_complex_choose.png\">\r * &lt;/caption>\r * o2m.biz.contact.ComplexPicker({\r * pickMode: [\"departmentPicker\", \"identityPicker\"], //选择器类型\r * topList: [],//不传或者空列表，显示全部组织\r * orgType: \"\",//可传空 只显示某种类型的组织\r * duty: [],//人员职责\r * multiple:true, //是否多选\r * maxNumber: 0, //最大选择数量\r * pickedDepartments:[],//已选部门\r * pickedIdentities:[],//已选身份列表\r * pickedGroups:[],//已选群组列表\r * pickedUsers:[],//已选人员列表\r * onSuccess : function(result) {\r * //返回结果样例\r * {\r * departments:[{\r * \"id\":\"xxxx\",\r * \"name\":\"部门名称\", \r * \"unique\":\"xxxx\",\r * \"distinguishedName\":\"部门@xxxx@U\",\r * \"typeList\":[\"xxxx\"],\r * \"shortName\":\"xxxx\",\r * \"level\": 0,\r * \"levelName\":\"xxxx\",\r * }],\r * identities:[{\r * \"id\":\"xxxx\",\r * \"name\":\"姓名\", \r * \"distinguishedName\":\"姓名@xxxx@I\",\r * \"person\":\"xxx\", \r * \"unique\":\"xxxx\",\r * \"unit\":\"xxx\",\r * \"unitName\":\"xxxx\",\r * \"unitLevel\": 0,\r * \"unitLevelName\":\"xxxx\",\r * \"personName\":\"xxxx\",\r * \"personUnique\":\"xxx\",\r * \"personDn\":\"xxx\"\r * }],\r * groups:[{\r * \"id\":\"xxxx\", \r * \"name\":\"群组名称\", \r * \"distinguishedName\":\"群组名称@xxxx@G\"\r * \"unique\":\"xxxx\", \r * }],\r * users:[{\r * \"id\":\"xxx\", \r * \"name\":\"姓名\", \r * \"unique\":\"xxx\", \r * \"distinguishedName\":\"姓名@xxxx@P\"\r * \"genderType\":\"xxx\", \r * \"employee\":\"xxx\", \r * \"mail\":\"xxx\", \r * \"weixin\":\"xxx\", \r * \"qq\":\"xxx\", \r * \"mobile\":\"xxx\", \r * \"officePhone\":\"xxx\"\r * }]\r * }\r * },\r * onFail : function(err) {}\r * });\r */\r this.o2m.biz.contact.ComplexPicker = _o2m_b_contact_complex_picker;\r \r \r \r })();\r Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"global.html":{"url":"global.html","title":"Global","kind":"","body":" O2OA WebAPI: Global | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag Global --> Type Definitions DatagridData 数据网格数据结构. Type Object Properties data Array 数据网格列表数据 total Object 统计数据 Example {\r \t \"data\": [ //数据网格条目\r \t\t{\r \t\t \"datagrid_datagrid$Title\": { //数据网格第1列title标识\r \t\t\t\"org_20\": { //数据网格第1列字段标识，人员组件单个对象，存的是对象\r \t\t\t \"distinguishedName\": \"张三@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"张三\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t}\r \t\t },\r \t\t \"datagrid_datagrid$Title1\": { //数据网格第2列title标识\r \t\t\t\"org_21\": [{ //数据网格第2列字段标识，人员组件多个对象，存的是数组\r \t\t\t \"distinguishedName\": \"张三@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"张三\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t},{\r \t\t\t \"distinguishedName\": \"李四@bf007525-99a3-4178-a474-32865bdddec8@I\",\r \t\t\t \"id\": \"bf007525-99a3-4178-a474-32865bdddec8\",\r \t\t\t \"name\": \"李四\",\r \t\t\t \"person\": \"0c828550-d8ab-479e-9880-09a59332f1ed\",\r \t\t\t \"unit\": \"9e6ce205-86f6-4d84-96e1-83147567aa8d\",\r \t\t\t \"unitLevelName\": \"兰德纵横/市场营销部\",\r \t\t\t \"unitName\": \"市场营销部\"\r \t\t\t}]\r \t\t },\r \t\t \"datagrid_datagrid$Title_2\": { //数据网格第2列title标识\r \t\t\t\"number\": \"111\" //数据网格第3列字段标识和值\r \t\t },\r \t\t \"datagrid_datagrid$Title_3\": { //数据网格第3列title标识\r \t\t\t\"textfield_2\": \"杭州\" //数据网格第4列字段标识和值\r \t\t },\r \t\t \"datagrid_datagrid$Title_4\": { //数据网格第4列title标识\r \t\t\t\"attachment_1\": [ //数据网格第5列字段标识\r \t\t\t {\r \t\t\t\t\"activityName\": \"拟稿\",\r \t\t\t\t\"extension\": \"jpg\",\r \t\t\t\t\"id\": \"9514758e-9e28-4bfe-87d7-824f2811f173\",\r \t\t\t\t\"lastUpdateTime\": \"2020-12-09 21:48:03\",\r \t\t\t\t\"length\": 452863.0,\r \t\t\t\t\"name\": \"111.jpg\",\r \t\t\t\t\"person\": \"李四@lisi@P\"\r \t\t\t }\r \t\t\t]\r \t\t }\r \t\t},\r \t\t...\r \t ],\r \t \"total\": { //统计数据，列title设置了总计\r \t\t\"datagrid_datagrid$Title_2\": \"333\", //总计列2\r \t\t\"datagrid_datagrid$Title_3\": \"2\" //总计列3\r \t }\r \t} Source x_component_process_Xform/DatagridPC.js, line 1 TreeData 树组件数据结构 Type Object Example [\r{\r \"expand\": true, //是否默认展开\r \"title\": \"\", //鼠标移上叶子节点的文字\r \"text\": \"根节点\", //叶子节点的文字\r \"action\": \"\", //执行的脚本\r \"default\": true, //是否默认选中\r \"icon\": \"folder.png\", //图标\r \"sub\": [ //该节点的子节点\r {\r \"expand\": true,\r \"title\": \"\",\r \"text\": \"[none]\",\r \"action\": \"\",\r \"default\": false,\r \"icon\": \"folder.png\",\r \"sub\": []\r },\r ...\r ]\r }\r] Source x_component_process_Xform/Tree.js, line 2 ViewFilter ViewFilter 视图过滤条件 Type Object Properties logic String 可选值：“and”或者“or”，表示和前一个条件的逻辑运算关系。 path String 要过滤的data数据的路径。 comparison String 比较运算符，可选值： equals 或 == 或：表示等于。 notEquals 或 != ：表示不等于。 greaterThan 或 > ：表示大于。 greaterThanOrEqualTo 或 => ：表示大于或等于。 lessThan 或 ：表示小于。 lessThanOrEqualTo 或 ：表示小于等于。 like ：表示部分匹配。 notLike ：表示不匹配。 range ：表示一定的范围。 in ：表示在某几个特定的值当中。 formatType String 过滤数据的数据类型，可选值： textValue ：文本。 numberValue ：数字。 dateTimeValue ：日期时间。 booleanValue ：布尔值。 value String | Number | Boolean 过滤的值，根据formatType提供匹配的数据类型的值，如果是dateTimeValue数据类型，则提供日期格式的字符串，格式如“YYYY-MM-DD HH:MM:SS”。当comparison值为“range”时，此值表示范围中的第一个值。当comparison值为“in”时，多个值用半角逗号&quot;,&quot;分开。 otherValue String | Number | Boolean 当comparison值为“range”时，此值表示范围中的第二个值。当comparison值不为“range”时，忽略此值。 Example {\r \"logic\":\"and\",\r \"path\":\"$work.title\",\r \"comparison\":\"like\",\r \"value\":\"7月\",\r \"formatType\":\"textValue\"\r} Source o2_core/o2/xScript/ViewEnvironment.js, line 8 StatementFilter StatementFilter 查询视图的过滤条件 Type Object Properties path String 要过滤的data数据的路径，形式为查询语句中的&quot;表别名.字段名&quot;，如&quot;o.title&quot;。 comparison String 比较运算符，可选值： equals 或 == 或：表示等于。 notEquals 或 != ：表示不等于。 greaterThan 或 > ：表示大于。 greaterThanOrEqualTo 或 => ：表示大于或等于。 lessThan 或 ：表示小于。 lessThanOrEqualTo 或 ：表示小于等于。 like ：表示部分匹配。 notLike ：表示不匹配。 formatType String 过滤数据的数据类型，可选值： textValue ：文本。 numberValue ：数字。 dateTimeValue ：日期时间。 booleanValue ：布尔值。 value String | Number | Boolean 过滤的值，根据formatType提供匹配的数据类型的值，如果是dateTimeValue数据类型，则提供日期格式的字符串，格式如“YYYY-MM-DD HH:MM:SS”。 Example {\r \"path\":\"o.title\",\r \"comparison\":\"like\",\r \"value\":\"关于\",\r \"formatType\":\"textValue\"\r} Source o2_core/o2/xScript/ViewEnvironment.js, line 45 StatementParameter StatementParameter 查询视图的过滤条件值参数，对查询语句where语句的形如&quot;:person&quot;的参数部分进行赋值 有以下规则： 1、参数名称为下列值时，后台自动赋值：person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)。 2、如果对比的是日期，需要传入 Date 类型。 3、如果运算符用的是 like, noLike，模糊查询，值为 &quot;%{value}%&quot;。 Type Object Example {\r \"person\" : \"\",\r \"startTime\" : (new Date(\"2020-01-01\")),\r \"applicationName\" : \"%test%\",\r \"processName\" : \"test流程\" //其他写确定的值\r} Source o2_core/o2/xScript/ViewEnvironment.js, line 77 GroupFlag 在本API的this.org模块中，当使用群组作为检索参数的时候，允许使用群组的distinguishedName、name、id、unique属性值，或者包含这些属性值的对象。 Type String | Object Example //以下均为合法参数\r\r//群组属性值\r\"工作汇报读者@ReportReader@G\" //群组识别名\r\"cce8bc22-225a-4f85-8132-7374d546886e\" //id\r\"ReportReader\" //群组unique\r\"工作汇报读者\" //群组名称\r\r//包含下列属性的对象\r{ \"distinguishedName\": \"工作汇报读者@ReportReader@G\" } //群组识别名\r{ \"unique\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //群组id\r{ \"unique\": \"ReportReader\" } //群组unique\r{ \"name\": \"工作汇报读者\" } //群组名称 Source o2_core/o2/xScript/ViewEnvironment.js, line 95 PersonFlag 在本API的this.org模块中，当使用人员(个人)作为检索参数的时候，允许使用人员的distinguishedName、name、id、unique属性值或包含这些属性的对象。 Type String | Object Example //以下均为合法参数\r\r//人员属性值\r\"李四@lisi@P\" //人员识别名\r\"cce8bc22-225a-4f85-8132-7374d546886e\" //人员id\r\"lisi\" //人员unique\r\"李四\" //人员名称，不重名时才有效\r\r//包含下列属性的对象\r{ \"distinguishedName\": \"李四@lisi@P\" } //人员识别名\r{ \"id\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //人员id\r{ \"unique\": \"lisi\" } //人员unique\r{ \"name\": \"李四\" } //人员名称，不重名时才有效 Source o2_core/o2/xScript/ViewEnvironment.js, line 115 RoleFlag 在本API的this.org模块中，当使用角色作为检索参数的时候，允许使用角色的distinguishedName、name、id、unique属性值或包含这些属性的对象。 Type String | Object Example //以下均为合法参数\r//角色属性值\r\"PersonManager@PersonManagerSystemRole@R\" //角色识别名\r\"85874fbc-9af0-4a07-bc2f-0ab899cc4c7d\" //角色id\r\"PersonManagerSystemRole\" //角色unique\r\"PersonManager\" //角色名称\r\r//包含下列属性的对象\r{ \"distinguishedName\": \"PersonManager@PersonManagerSystemRole@R\" } //角色识别名\r{ \"id\": \"85874fbc-9af0-4a07-bc2f-0ab899cc4c7d\" } //角色id\r{ \"unique\": \"PersonManagerSystemRole\" } //角色unique\r{ \"name\": \"PersonManager\" } //角色名称 Source o2_core/o2/xScript/ViewEnvironment.js, line 134 IdentityFlag 在本API的this.org模块中，当使用身份作为检索参数的时候，允许使用身份的distinguishedName、name、id、unique属性值或包含这些属性的对象。 Type String | Object Example //以下均为合法参数\r//角色属性值\r\"张三@903dbb04-085c-4bb1-9c24-3009bd5f7372@I\" //身份识别名\r\"903dbb04-085c-4bb1-9c24-3009bd5f7372\" //身份id\r\"903dbb04-085c-4bb1-9c24-3009bd5f7372\" //身份unique，系统默认的unique和id一致\r\"张三\" //身份名称，有可能存在重名，需要精确匹配的请不要使用\r\r//包含下列属性的对象\r{ \"distinguishedName\": \"张三@903dbb04-085c-4bb1-9c24-3009bd5f7372@I\" } //身份识别名\r{ \"id\": \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" } //身份id\r{ \"unique\": \"903dbb04-085c-4bb1-9c24-3009bd5f7372\" } //身份unique，系统默认的unique和id一致\r{ \"name\": \"张三\" } //身份名称，有可能存在重名，需要精确匹配的请不要使用 Source o2_core/o2/xScript/ViewEnvironment.js, line 153 UnitFlag 在本API的this.org模块中，当使用组织作为检索参数的时候，允许使用组织的distinguishedName、name、id、unique属性值或包含这些属性的对象。 Type String | Object Example //以下均为合法参数\r//组织属性值\r\"开发部@kfb@U\" //组织标识名\r\"cce8bc22-225a-4f85-8132-7374d546886e\" //组织id\r\"kfb\" //组织unique\r\"开发部\" //组织名称，有可能存在重名，需要精确匹配的请不要使用\r\r//包含下列属性的对象\r{ \"distinguishedName\": \"开发部@kfb@U\" } //组织标识名\r{ \"id\": \"cce8bc22-225a-4f85-8132-7374d546886e\" } //身份id\r{ \"unique\": \"kfb\" } //组织unique\r{ \"name\": \"开发部\" } //组织名称，有可能存在重名，需要精确匹配的请不要使用 Source o2_core/o2/xScript/ViewEnvironment.js, line 172 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"index.html":{"url":"index.html","title":"","kind":"","body":" O2OA WebAPI: | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag O2OA前台API 简介 O2OA 是一个高度可定制化的企业级办公平台，您可以通过脚本语言扩展平台功能。 O2OA 前端脚本基于您使用的浏览器的Javascript引擎，使用Javascript语法。 本API是O2OA前台脚本的编写说明，您可以通过脚本访问和操作平台内的各种对象。 API总览 Modules 为脚本封装的对象、方法和类 业务数据 - data 流程实例 - workContext 内容管理实例 - documentContext 组织查询 - org 流程及内容管理表单 - form 门户页面 - page 视图 - queryView 视图执行 - view 数据字典 - Dict 查询视图 - queryStatement 查询视图执行 - statement 服务调用 - Actions 脚本引用 - include 方法定义 - define 当前用户 - session 平台移动APP API - o2m 表单等待 - wait FormComponent FormComponent为表单组件，可以通过this.form.get(&quot;fieldId&quot;)获取。 Process 流程表单组件 表单 - Form 文本 - Label 文本字段 - Textfield 数字字段 - Number 人员组织 - Org 日期选择 - Calendar 多行文本 - Textarea 下拉框 - Select 单选框 - Radio 多选框 - Checkbox 组合框 - Combox 意见框 - Opinion 按钮 - Button 地址 - Address 操作条 - Actionbar 侧边操作条 - Sidebar 图片 - Image 图片编辑 - ImageClipper 附件 - Attachment 容器 - Div 表格 - Table 单元格 - Table$Td 数据网格PC端 - DatagridPC 数据网格移动端 - DatagridMobile 子表单 - Subform 选择视图 - ViewSelector 嵌入视图 - View 嵌入统计 - Stat 通用元素 - Common 分页 - Tab 树 - Tree 流程记录 - Log 流程监控 - Monitor Iframe - Iframe 公文编辑器 - Documenteditor HTML编辑器 - Htmleditor Office控件 - Office 选择查询视图 - StatementSelector 嵌入查询视图 - Statement CMS 内容管理表单组件 内容管理表单 - CMSForm 文本 - Label 文本字段 - Textfield 数字字段 - Number 人员组织 - Org 读者 - Reader 作者 - Author 日期选择 - Calendar 多行文本 - Textarea 下拉框 - Select 单选框 - Radio 多选框 - Checkbox 组合框 - Combox 按钮 - Button 地址 - Address 操作条 - Actionbar 图片 - Image 图片编辑 - ImageClipper 附件 - Attachment 容器 - Div 表格 - Table 单元格 - Table$Td 数据网格PC端 - DatagridPC 数据网格移动端 - DatagridMobile 子表单 - Subform 选择视图 - ViewSelector 嵌入视图 - View 嵌入统计 - Stat 通用元素 - Common 分页 - Tab 树 - Tree Iframe - Iframe HTML编辑器 - Htmleditor 阅读记录 - CMSLog Office控件 - Office 评论 - Comment 选择查询视图 - StatementSelector 嵌入查询视图 - Statement Portal 门户页面组件 页面 - PortalPage 容器 - Div 文本 - Label 数据源 - Source 子数据源 - SubSource 数据文本 - SourceText 表格 - Table 单元格 - Table$Td 分页 - Tab 图片 - Image 按钮 - Button Iframe - Iframe 通用元素 - Common 树 - Tree 嵌入视图 - View 嵌入统计 - Stat 文本字段 - Textfield 人员组织 - Org 日期选择 - Calendar 多行文本 - Textarea 下拉框 - Select 单选框 - Radio 多选框 - Checkbox 部件 - Widget 嵌入查询视图 - Statement 服务 服务是O2OA后台提供的一系列restful服务。 x_processplatform_assemble_surface 流程平台相关服务 x_portal_assemble_surface 门户平台相关服务 x_cms_assemble_control 内容管理平台相关服务 x_query_assemble_surface 数据平台相关服务 x_organization_assemble_express 组织架构相关服务 x_file_assemble_control 云文件相关服务 x_meeting_assemble_control 会议管理相关服务 x_bbs_assemble_control 论坛相关服务 x_calendar_assemble_control 日程管理相关服务 x_hotpic_assemble_control 热点信息相关服务 x_mind_assemble_control 脑图模块相关服务 x_organization_assemble_personal 个人设置相关服务 x_attendance_assemble_control 考勤模块相关服务 使用范围 O2OA 可在多个位置嵌入脚本代码，用于扩展平台和实现自定义功能。嵌入脚本代码分为前端执行代码和服务端执行代码，两者语法一致，本文档指前台脚本。 脚本: 流程平台、门户平台和内容管理平台中，都有脚本设计元素，可以在此创建自己的脚本库。如下图： 表单、页面、视图、查询视图及其组件事件： 流程平台和内容平台的表单、门户平台的页面、数据平台的视图和查询视图中，每个设计组件包含多种事件，包括DOM对象原生事件和O2平台扩展事件。如下图： 表单、页面可编辑组件默认值： 流程平台和内容平台的表单和门户平台的页面中，可编辑组件或文本组件的默认值可以通过脚本指定。如下图： 表单、页面、视图、查询视图的部分属性： 流程平台和内容平台的表单、门户平台的页面、数据平台的视图和查询视图中，有许多组件的相关属性可以通过脚本来定义。 如：下拉框、单选多选按钮的可选值、人员字段的选择范围、区段依据等。如下图： 表单及可编辑组件校验： 流程平台和内容管理的表单中，可编辑的字段可以通过脚本进行有效性校验，校验通过返回true，不通过返回提示信息。如下图： 流程路由属性的扩展附签和选择附签下的脚本： 样例 这是一个简单的样例，用于展现脚本如何编写和运行。 本例中我们要实现一个表单中，两个下拉框从配置数据中获取可选数据，以及实现联动。 我们需要创建一个流程应用，一个表单以及一个数据字典。在表单中创建两个下拉列表框。 先在表单中创建两个下拉框 在category1和category2两个下拉框的属性中，选择通过“脚本”编辑可选值。 category1脚本: category2脚本: 在category1和category2两个下拉框的可选值脚本如下： category1的可选值脚本: var dict = new this.Dict(&quot;category&quot;); //获取名为category的数据字典 var categoryList = dict.get(); //获取数据字典 var options = Object.keys(categoryList); //获取大类，赋值给options变量 options.unshift(&quot;(请选择大类)|&quot;); //在options数组首位插入提示选项，并将“”作为value，“(请选择大类)”作为text return options; //返回列表，作为列表框的可选值 category2的可选值脚本: var dict = new this.Dict(&quot;category&quot;); //获取名为category的数据字典 var categoryList = dict.get(this.data.category1); //获取数据字典,以下拉框category1的值为关键字的数据值（数组） return categoryList; //返回列表，作为列表框的可选值 在category1的change事件中添加如下代码： //获category2下拉框，并刷新可选项 this.form.get(&quot;category2&quot;).resetOption(); 设计数据字典如下图，并命名为：&quot;分类配置&quot;，别名为：“category”。 预览表单，即可看到大类下拉框中选项为数据字典中的第一层数据，选择不同的大类可与小类下拉框实现联动。 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.$Input.html":{"url":"MWF.xApplication.process.Xform.$Input.html","title":"$Input","kind":"Class","body":" O2OA WebAPI: $Input | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class $Input $Input --> Extends MWF.xApplication.process.Xform.$Module $Input 组件类，此类为所有输入组件的父类 Source x_component_process_Xform/$Input.js, line 8 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.$Module.html":{"url":"MWF.xApplication.process.Xform.$Module.html","title":"$Module","kind":"Class","body":" O2OA WebAPI: $Module | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class $Module $Module --> $Module 组件类，此类为所有组件的父类。 Source x_component_process_Xform/$Module.js, line 7 Members nodeElement 组件的节点 Type Element See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Actionbar.html":{"url":"MWF.xApplication.process.Xform.Actionbar.html","title":"Actionbar","kind":"Class","body":" O2OA WebAPI: Actionbar | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MtoolbarWidgetMnodeMjsonMformFreloadFgetItemFgetAllItemFhideFshowEqueryLoadEloadEpostLoadEafterLoad Class Actionbar Actionbar --> Extends MWF.xApplication.process.Xform.$Module Actionbar 操作条组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar actionbar = this.form.get(\"name\"); //获取操作条\r//方法2\rvar actionbar = this.target; //在操作条和操作本身的事件脚本中获取 Source x_component_process_Xform/Actionbar.js, line 17 Members toolbarWidgeto2.widget.Toolbar Toolbar组件，平台使用该组件生成操作条。 Type o2.widget.Toolbar Example //可以在脚本中获取该组件\rvar toolbarWidget = this.form.get(\"fieldId\").toolbarWidget; //获取组件对象 Source x_component_process_Xform/Actionbar.js, line 71 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods reload() Summary 重新加载操作条. Example this.form.get(\"name\").reload(); //显示操作条 Source x_component_process_Xform/Actionbar.js, line 49 getItem(id) &rarr; {o2.widget.ToolbarButton} Summary 根据操作id获取操作，该方法在操作条的afterLoad事件中有效，操作的操作脚本有效。 Parameters id String 必选，操作id. Returns o2.widget.ToolbarButton 操作 Example var actionbar = this.form.get(\"name\"); //获取操作条\r var item = actionbar.getItem( \"action_delete\" ); //获取删除操作\r item.node.hide(); //隐藏删除操作的节点\r item.node.click(); //触发操作的click事件 Source x_component_process_Xform/Actionbar.js, line 261 getAllItem() &rarr; {Array} Summary 获取所有操作，该方法在操作条的afterLoad事件中有效，操作的操作脚本有效。 Returns Array 操作数组 Example var actionbar = this.form.get(\"name\"); //获取操作条\r var itemList = actionbar.getAllItem(); //获取操作数组\r itemList[1].node.hide(); //隐藏第一个操作 Source x_component_process_Xform/Actionbar.js, line 274 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后事件.由于加载过程中有异步处理，这个时候操作条有可能还未生成。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoad \t \t \t \t\t\t组件加载后事件。这个时候操作条已生成 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Address.html":{"url":"MWF.xApplication.process.Xform.Address.html","title":"Address","kind":"Class","body":" O2OA WebAPI: Address | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFgetOptionsFsetDataFresetOptionFaddOptionFgetTextDataFisReadonlyFisEmptyFgetDataFresetDataFvalidationFhideFshowEcommitInputEchangeEqueryLoadEloadEpostLoad Class Address Address --> Extends MWF.xApplication.process.Xform.Combox Address 地址选择组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar address = this.form.get(\"name\"); //获取组件\r//方法2\rvar address = this.target; //组件本身的事件和脚本中获取 Source x_component_process_Xform/Address.js, line 15 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.Combox#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.Combox#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.Combox#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods getOptions() &rarr; {Array} Summary 获取选择项数组. Inherited From MWF.xApplication.process.Xform.Combox#getOptions Returns Array 选择项数组，如果配置为脚本返回计算结果. Example var array = this.form.get('fieldId').getOptions(); Source x_component_process_Xform/Combox.js, line 113 setData(value) Summary 为组件赋值。 Description 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters value String . Inherited From MWF.xApplication.process.Xform.Combox#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } Source x_component_process_Xform/Combox.js, line 173 resetOption() Summary 重新计算下拉选项，该功能通常用在下拉选项为动态计算的情况. Inherited From MWF.xApplication.process.Xform.Combox#resetOption Example this.form.get('fieldId').resetOption(); Source x_component_process_Xform/Combox.js, line 218 addOption(text, value) Summary 添加下拉选项. Parameters text String 下拉选项文本 value String 下拉选项值 Inherited From MWF.xApplication.process.Xform.Combox#addOption Example this.form.get('fieldId').addOption(\"秘密\",\"level1\"); Source x_component_process_Xform/Combox.js, line 231 getTextData() &rarr; {Object} Summary 获取选中的值和文本. Inherited From MWF.xApplication.process.Xform.Combox#getTextData Returns Object 返回选中项值和文本，格式为 { 'value' : value, 'text' : text }. Example var array = this.form.get('fieldId').getTextData(); Source x_component_process_Xform/Combox.js, line 259 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tcommitInput \t \t \t \t\t\t手工输入完成后触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Combox#event:commitInput See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t值改变时触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Combox#event:change See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Attachment.html":{"url":"MWF.xApplication.process.Xform.Attachment.html","title":"Attachment","kind":"Class","body":" O2OA WebAPI: Attachment | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MattachmentControllerMnodeMjsonMformFgetDataFsetDataFvalidationFhideFshowEuploadEdeleteEafterDeleteEloadEchangeEdownloadEopen Class Attachment Attachment --> Extends MWF.xApplication.process.Xform.$Module Attachment 附件组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar attachment = this.form.get(\"name\"); //获取组件\r//方法2\rvar attachment = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Attachment.js, line 1052 Members attachmentControllerMWF.xApplication.process.Xform.AttachmentController 附件容器. Type MWF.xApplication.process.Xform.AttachmentController Example var attachmentController = this.form.get(\"fieldId\").AttachmentController; //获取附件容器\rvar attachmentList = attachmentController.attachments; //获取所有的附件\rvar attachmentData = attachment[0].data; //获取第一个附件的数据 Source x_component_process_Xform/Attachment.js, line 1161 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods getData() &rarr; {StringArray|Null} Summary 获取当前组件所有附件的标题.如果没有附件返回null Returns StringArray Null 附件标题. Example var getAttachmentNames = this.form.get(\"name\").getData(); Source x_component_process_Xform/Attachment.js, line 1214 setData(data) Summary 为组件重新设置附件，该附件必须已经上传。 Parameters data Object . { \"id\": \"56c4e86f-a4c8-4cc2-a150-1a0d2c5febcb\", //附件ID \"name\": \"133203a2-92e6-4653-9954-161b72ddb7f9.png\", //附件名称 \"extension\": \"png\", //附件扩展名 \"length\": 43864, //附件大小 \"person\": \"xx@huqi@P\", //附件上传人 \"lastUpdateTime\": \"2018-09-27 15:50:34\", //最后的修改时间 \"lastUpdatePerson\": \"xx@huqi@P\", //最后的修改人 \"activity\": \"e31ad938-c495-45a6-8d77-b8a9b61a165b\", //附件上传的活动ID \"activityName\": \"申请人\", //附件上传的活动名称 \"activityType\": \"manual\", //附件上传的活动类型 \"site\": \"$mediaOpinion\", //附件存储位置（一般用于区分附件在哪个表单元素中显示） \"type\": \"image/png\" //附件类型（contentType） } Source x_component_process_Xform/Attachment.js, line 1711 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/Attachment.js, line 1859 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tupload \t \t \t \t\t\t附件上传后触发。本事件中可以通过this.event获取上传附件的数据 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tdelete \t \t \t \t\t\t删除附件前触发。本事件中可以通过this.event获取被删附件的数据 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterDelete \t \t \t \t\t\t删除附件后触发。本事件中可以通过this.event获取被删附件的数据 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t附件容器加载时触发。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t附件有变化的时候会被触发，包括上传、删除、排序 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tdownload \t \t \t \t\t\t下载附件后触发。本事件中可以通过this.event获取被下载附件对象 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\topen \t \t \t \t\t\t打开附件后触发。本事件中可以通过this.event获取被打开附件对象 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Button.html":{"url":"MWF.xApplication.process.Xform.Button.html","title":"Button","kind":"Class","body":" O2OA WebAPI: Button | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Button Button --> Extends MWF.xApplication.process.Xform.$Module Button 按钮组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar button = this.form.get(\"name\"); //获取组件\r//方法2\rvar button = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Button.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Calendar.html":{"url":"MWF.xApplication.process.Xform.Calendar.html","title":"Calendar","kind":"Class","body":" O2OA WebAPI: Calendar | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag McalendarMdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEcompleteEclearEchangeEshowEhideEqueryLoadEloadEpostLoad Class Calendar Calendar --> Extends MWF.xApplication.process.Xform.$Input Calendar 日期组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等 Source x_component_process_Xform/Calendar.js, line 14 Members calendarMWF.widget.Calendar 日期弹出选择界面，只读情况下无此成员. Type MWF.widget.Calendar Example var calendar = this.form.get(\"fieldId\").calendar; //获取组件\rif(calendar)calendar.show(); //弹出选择组件 Source x_component_process_Xform/Calendar.js, line 195 descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tcomplete \t \t \t \t\t\t日期选择完成时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tclear \t \t \t \t\t\t日期选择器上点清空时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t值改变时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tshow \t \t \t \t\t\t显示日期选择器时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\thide \t \t \t \t\t\t隐藏日期选择器时触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Checkbox.html":{"url":"MWF.xApplication.process.Xform.Checkbox.html","title":"Checkbox","kind":"Class","body":" O2OA WebAPI: Checkbox | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFresetOptionFgetOptionsFgetOptionsObjFgetTextDataFsetDataFisReadonlyFisEmptyFgetDataFresetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Checkbox Checkbox --> Extends MWF.xApplication.process.Xform.$Input Calendar 多选按钮组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等 Source x_component_process_Xform/Checkbox.js, line 15 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetOption() Summary 重新计算下拉选项，该功能通常用在下拉选项为动态计算的情况. Example this.form.get('fieldId').resetOption(); Source x_component_process_Xform/Checkbox.js, line 107 getOptions() &rarr; {Array} Summary 获取选择项。 Returns Array 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：[ &quot;女|female&quot;, &quot;男|male&quot; ] Example this.form.get('fieldId').getOptions(); Source x_component_process_Xform/Checkbox.js, line 120 getOptionsObj() &rarr; {Object} Summary 获取整理后的选择项。 Returns Object 返回整理后的选择项，如： {\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]} Example var optionData = this.form.get('fieldId').getOptionsObj(); Source x_component_process_Xform/Checkbox.js, line 137 getTextData() &rarr; {Object} Summary 获取选中的值和文本. Returns Object 返回选中项值和文本，格式为 { 'value' : value, 'text' : text }. Example var array = this.form.get('fieldId').getTextData(); Source x_component_process_Xform/Checkbox.js, line 275 setData(data) Summary 为字段赋值，并且使值对应的选项选中。 Description 当参数为Promise的时候，请查看文档: 使用Promise处理表单异步 Parameters data String | Promise . Overrides MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值\r //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/Checkbox.js, line 344 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Overrides MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Overrides MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Combox.html":{"url":"MWF.xApplication.process.Xform.Combox.html","title":"Combox","kind":"Class","body":" O2OA WebAPI: Combox | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFgetOptionsFsetDataFresetOptionFaddOptionFgetTextDataFisReadonlyFisEmptyFgetDataFresetDataFvalidationFhideFshowEcommitInputEchangeEqueryLoadEloadEpostLoad Class Combox Combox --> Extends MWF.xApplication.process.Xform.$Input Combox 组合框组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等 Source x_component_process_Xform/Combox.js, line 14 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Input#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Input#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods getOptions() &rarr; {Array} Summary 获取选择项数组. Returns Array 选择项数组，如果配置为脚本返回计算结果. Example var array = this.form.get('fieldId').getOptions(); Source x_component_process_Xform/Combox.js, line 113 setData(value) Summary 为组件赋值。 Description 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters value String . Overrides MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } Source x_component_process_Xform/Combox.js, line 173 resetOption() Summary 重新计算下拉选项，该功能通常用在下拉选项为动态计算的情况. Example this.form.get('fieldId').resetOption(); Source x_component_process_Xform/Combox.js, line 218 addOption(text, value) Summary 添加下拉选项. Parameters text String 下拉选项文本 value String 下拉选项值 Example this.form.get('fieldId').addOption(\"秘密\",\"level1\"); Source x_component_process_Xform/Combox.js, line 231 getTextData() &rarr; {Object} Summary 获取选中的值和文本. Returns Object 返回选中项值和文本，格式为 { 'value' : value, 'text' : text }. Example var array = this.form.get('fieldId').getTextData(); Source x_component_process_Xform/Combox.js, line 259 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Overrides MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Overrides MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tcommitInput \t \t \t \t\t\t手工输入完成后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t值改变时触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Common.html":{"url":"MWF.xApplication.process.Xform.Common.html","title":"Common","kind":"Class","body":" O2OA WebAPI: Common | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Common Common --> Extends MWF.xApplication.process.Xform.$Module Common 通用组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar el = this.form.get(\"name\"); //获取组件\r//方法2\rvar el = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Common.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.DatagridMobile.html":{"url":"MWF.xApplication.process.Xform.DatagridMobile.html","title":"DatagridMobile","kind":"Class","body":" O2OA WebAPI: DatagridMobile | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFresetDataFsetDataFgetTotalFisEmptyFgetDataFvalidationFhideFshowEcompleteLineEditEaddLineEdeleteLineEafterDeleteLineEeditLineEqueryLoadEloadEpostLoad Class DatagridMobile DatagridMobile --> Extends MWF.xApplication.process.Xform.$Module DatagridMobile 数据网格组件（移动端）。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar datagrid = this.form.get(\"name\"); //获取组件\r//方法2\rvar datagrid = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/DatagridMobile.js, line 14 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetData() Summary 重置数据网格的值为默认值或置空。 Example this.form.get('fieldId').resetData(); Source x_component_process_Xform/DatagridMobile.js, line 1401 setData(data) Summary 为数据网格赋值。 Description 当参数为Promise的时候，请查看文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data DatagridData | Promise | Array 必选，数组或Promise. Examples this.form.get(\"fieldId\").setData([]); //赋空值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var promise = new Promise(function(resolve, reject){ //发起异步请求\r var oReq = new XMLHttpRequest();\r oReq.addEventListener(\"load\", function(){ //绑定load事件\r resolve(oReq.responseText);\r });\r oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r oReq.send();\r });\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r})\r field.setData( promise ); Source x_component_process_Xform/DatagridMobile.js, line 1433 getTotal() &rarr; {Object} Summary 获取总计数据. Returns Object 总计数据 Example var totalObject = this.form.get('fieldId').getTotal(); Source x_component_process_Xform/DatagridMobile.js, line 1564 isEmpty() &rarr; {Boolean} Summary 判断数据网格是否为空. Returns Boolean 是否为空 Example if( this.form.get('fieldId').isEmpty() ){\r this.form.notice('至少需要添加一条数据', 'warn');\r} Source x_component_process_Xform/DatagridMobile.js, line 1576 getData() &rarr; {DatagridData} Summary 获取数据网格数据. Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Returns DatagridData Examples var data = this.form.get('fieldId').getData(); //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r }\r //使用Promise\r var field = this.form.get(\"fieldId\");\r var promise = new Promise(function(resolve, reject){ //发起异步请求\r var oReq = new XMLHttpRequest();\r oReq.addEventListener(\"load\", function(){ //绑定load事件\r resolve(oReq.responseText);\r });\r oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r oReq.send();\r });\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r})\r field.setData( promise ); Source x_component_process_Xform/DatagridMobile.js, line 1621 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/DatagridMobile.js, line 1787 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tcompleteLineEdit \t \t \t \t\t\t当前条目编辑完成时触发。通过this.event可以获取对应的table。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\taddLine \t \t \t \t\t\t添加条目时触发。通过this.event可以获取对应的table。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tdeleteLine \t \t \t \t\t\t删除条目前触发。通过this.event可以获取对应的table。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterDeleteLine \t \t \t \t\t\t删除条目后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\teditLine \t \t \t \t\t\t编辑条目时触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.DatagridPC.html":{"url":"MWF.xApplication.process.Xform.DatagridPC.html","title":"DatagridPC","kind":"Class","body":" O2OA WebAPI: DatagridPC | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFresetDataFsetDataFgetTotalFisEmptyFgetDataFvalidationFhideFshowEcompleteLineEditEaddLineEdeleteLineEafterDeleteLineEeditLineEexportEvalidImportEimportEqueryLoadEloadEpostLoad Class DatagridPC DatagridPC --> Extends MWF.xApplication.process.Xform.$Module DatagridPC 数据网格组件（PC端）。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar datagrid = this.form.get(\"name\"); //获取组件\r//方法2\rvar datagrid = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/DatagridPC.js, line 81 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetData() Summary 重置数据网格的值为默认值或置空。 Example this.form.get('fieldId').resetData(); Source x_component_process_Xform/DatagridPC.js, line 1415 setData(data) Summary 为数据网格赋值。 Description 当参数为Promise的时候，请查看文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data DatagridData | Promise | Array 必选，数组或Promise. Examples this.form.get(\"fieldId\").setData([]); //赋空值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var promise = new Promise(function(resolve, reject){ //发起异步请求\r var oReq = new XMLHttpRequest();\r oReq.addEventListener(\"load\", function(){ //绑定load事件\r resolve(oReq.responseText);\r });\r oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r oReq.send();\r });\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r})\r field.setData( promise ); Source x_component_process_Xform/DatagridPC.js, line 1447 getTotal() &rarr; {Object} Summary 获取总计数据. Returns Object 总计数据 Example var totalObject = this.form.get('fieldId').getTotal(); Source x_component_process_Xform/DatagridPC.js, line 1534 isEmpty() &rarr; {Boolean} Summary 判断数据网格是否为空. Returns Boolean 是否为空 Example if( this.form.get('fieldId').isEmpty() ){\r this.form.notice('至少需要添加一条数据', 'warn');\r} Source x_component_process_Xform/DatagridPC.js, line 1546 getData() &rarr; {DatagridData} Summary 获取数据网格数据. Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Returns DatagridData Examples var data = this.form.get('fieldId').getData(); //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r }\r //使用Promise\r var field = this.form.get(\"fieldId\");\r var promise = new Promise(function(resolve, reject){ //发起异步请求\r var oReq = new XMLHttpRequest();\r oReq.addEventListener(\"load\", function(){ //绑定load事件\r resolve(oReq.responseText);\r });\r oReq.open(\"GET\", \"/data.json\"); //假设数据存放在data.json\r oReq.send();\r });\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获得data.json的值\r})\r field.setData( promise ); Source x_component_process_Xform/DatagridPC.js, line 1592 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/DatagridPC.js, line 1757 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tcompleteLineEdit \t \t \t \t\t\t当前条目编辑完成时触发。通过this.event可以获取对应的tr。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\taddLine \t \t \t \t\t\t添加条目时触发。通过this.event可以获取对应的tr。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tdeleteLine \t \t \t \t\t\t删除条目前触发。通过this.event可以获取对应的tr。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterDeleteLine \t \t \t \t\t\t删除条目后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\teditLine \t \t \t \t\t\t编辑条目时触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\texport \t \t \t \t\t\t导出excel的时候触发，this.event指向导出的数据，您可以通过修改this.event来修改数据。 \t \t \t \t \t \t See 组件事件说明 \t \t\tExample \t\t this.event数据格式如下： {\r \tdata : [\r \t\t[\"姓名\",\"性别\",\"学历\",\"专业\",\"出生日期\",\"毕业日期\"], //标题\r \t\t[ \"张三\",\"男\",\"大学本科\",\"计算机\",\"2001-1-2\",\"2019-9-2\" ], //第一行数据\r \t\t[ \"李四\",\"男\",\"大学专科\",\"数学\",\"1998-1-2\",\"2018-9-2\" ] //第二行数据\r\t], //导出的数据\r colWidthArray : [100, 50, 100, 200, 150, 150], //每列宽度\r title : \"xxxx\" //导出的excel文件标题\r} \t \t \t \t \t \t \t\t \t \t \t\tvalidImport \t \t \t \t\t\t在导入excel，进行数据校验后触发，this.event指向导入的数据。 \t \t \t \t \t \t See 组件事件说明 \t \t\tExample \t\t this.event数据格式如下： {\r \tdata : [\r \t {\r \t \t\"姓名\" : \"张三\",\r \t \t\"性别\" : \"男\",\r \t \t\"学历\" ： \"大学本科\",\r \t \"专业\" : \"计算机\",\r \t \"出生日期\" : \"aa01-1-2\",\r \t \t\"毕业日期\" : \"2019-9-2\",\r \t \t\"errorTextList\" : [\r \t \t \"第5列：aa01-1-2不是正确的日期格式。\"\r \t \t] //校验出的错误信息，如果改行数据正确，则无该字段\r \t }\r \t ...\r ], //导入的数据\r \"validted\" : true //是否校验通过，可以在本事件中修改该参数，确定是否强制导入\r} \t \t \t \t \t \t \t\t \t \t \t\timport \t \t \t \t\t\t在导入excel，数据校验成功将要设置回数据网格的时候触发，this.event指向整理过的导入数据，格式见DatagridData。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Div.html":{"url":"MWF.xApplication.process.Xform.Div.html","title":"Div","kind":"Class","body":" O2OA WebAPI: Div | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Div Div --> Extends MWF.xApplication.process.Xform.$Module Div 容器组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar div = this.form.get(\"name\"); //获取组件\r//方法2\rvar div = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Div.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Documenteditor.html":{"url":"MWF.xApplication.process.Xform.Documenteditor.html","title":"Documenteditor","kind":"Class","body":" O2OA WebAPI: Documenteditor | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFactiveFscaleToFreloadFisEmptyFgetDataFsetDataFvalidationFgetDocumentHtmlFtoWordFhideFshowEloadPageEqueryLoadEloadEpostLoad Class Documenteditor Documenteditor --> Extends MWF.xApplication.process.Xform.$Module Documenteditor 公文编辑器。 Usable Range Process Example //可以在脚本中获取该组件\r//方法1：\rvar documenteditor = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar documenteditor = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Documenteditor.js, line 14 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods active() 激活公文编辑器编辑。设置了延迟加载的时候，可以通过这个方法来激活 Example this.form.get(\"fieldId\").active(); Source x_component_process_Xform/Documenteditor.js, line 69 scaleTo(scale) 缩放文件内容 Parameters scale Number 缩放的比率 Example this.form.get(\"fieldId\").scaleTo(0.5); Source x_component_process_Xform/Documenteditor.js, line 1720 reload() 重新计算公文编辑器的所有字段，当字段是脚本时可以使用该方法立即更新 Example this.form.get(\"fieldId\").reload(); Source x_component_process_Xform/Documenteditor.js, line 2520 isEmpty() &rarr; {Boolean} Summary 判断公文编辑器的正文内容是否已经填写 Returns Boolean 是否为空 Example if( this.form.get(\"fieldId\").isEmpty() ){\r this.form.notice('请填写正文内容')\r} Source x_component_process_Xform/Documenteditor.js, line 2550 getData() &rarr; {Object} Summary 获取公文编辑器数据 Returns Object 公文编辑器的数据 Example var data = this.form.get(\"fieldId\").getData(); Source x_component_process_Xform/Documenteditor.js, line 2561 setData(data) 设置公文编辑器数据 Parameters data Object Example var data = this.form.get(\"fieldId\").getData();\rdata.filetext = \"测试内容\";\rthis.form.get(\"fieldId\").setData(data); Source x_component_process_Xform/Documenteditor.js, line 2651 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/Documenteditor.js, line 2934 getDocumentHtml() &rarr; {String} 将公文编辑器内容以html形式输出 Returns String Example var html = this.form.get(\"fieldId\").getDocumentHtml(); Source x_component_process_Xform/Documenteditor.js, line 2970 toWord(callbackopt, nameopt) Summary 将公文编辑器转换成附件，转换的文件名和格式等信息与配置有关 Parameters callback function &lt;optional&gt; 转换后的回调方法，参数是附件数据. name string &lt;optional&gt; 如果为空或者不传，转换的文件名和格式等信息与配置有关. Example this.form.get(\"fieldId\").toWord( function(attachmentData){\r //attachmentData 转换后的附件数据\r}) Source x_component_process_Xform/Documenteditor.js, line 3003 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tloadPage \t \t \t \t\t\t当公文编辑器内容每次被渲染的时候都会触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Form.html":{"url":"MWF.xApplication.process.Xform.Form.html","title":"Form","kind":"Class","body":" O2OA WebAPI: Form | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag McontainerMjsonMmodulesMallFgetDataFgetRouteDataListFpressWorkFpauseTaskFresumeTaskFrerouteWorkFreadedWorkFuploadedAttachmentEqueryLoadEbeforeLoadEbeforeModulesLoadEpostLoadEafterModulesLoadEafterLoadEbeforeSaveEafterSaveEbeforeCloseEbeforeProcessWorkEbeforeProcessEafterProcessEbeforeResetEafterResetEbeforeRetractEafterRetractEbeforeRerouteEafterRerouteEbeforeDeleteEafterDeleteEbeforeReadedEafterReaded Class Form Form --> Form 流程表单。 Usable Range Process Example //可以在脚本中获取表单\r//方法1：\rvar form = this.form.getApp().appForm; //获取表单\r//方法2\rvar form = this.target; //在表单本身的事件脚本中获取 Source x_component_process_Xform/Form.js, line 19 Members containerElement 表单容器 Type Element See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取表单容器\rvar formContainer = this.form.getApp().appForm.container; Source x_component_process_Xform/Form.js, line 176 jsonObject 表单的配置信息，比如表单名称，提交方式等等. Type Object Example //可以在脚本中获取表单配置信息\rvar json = this.form.getApp().appForm.json; //表单配置信息\rvar name = json.name; //表单名称 Source x_component_process_Xform/Form.js, line 189 modulesArray 表单中的所有组件数组. Type Array Example //下面的样例对表单组件进行循环，并且判断是输入类型的组件\rvar modules = this.form.getApp().appForm.modules; //获取所有表单组件\rfor( var i=0; i&lt;modules.length; i++ ){ //循环处理组件\r //获取组件的类型\r var moduleName = module.json.moduleName;\r if( !moduleName ){\r moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r }\r if( [\"calendar\",\"combox\",\"number\",\"textfield\"].contains( moduleName )){ //输入类型框\r //do something\r }\r} Source x_component_process_Xform/Form.js, line 215 allObject 表单中的所有组件对象. 该对象的key是组件标识，value是组件对象，可以使用该对象根据组件标识获取组件。 需要注意的是，在子表单中嵌入不绑定数据的组件（比如div,common,button等等），系统允许重名。 在打开表单的时候，系统会根据重名情况，自动在组件的标识后跟上 &quot;_1&quot;, &quot;_2&quot;。 Type Object Example var moduleAll = this.form.getApp().appForm.all; //获取组件对象\rvar subjectField = moduleAll[\"subject\"] //获取名称为subject的组件 Source x_component_process_Xform/Form.js, line 227 Methods getData() &rarr; {Object} Summary 获取表单的所有数据. Returns Object Example var data = this.form.getApp().appForm.getData(); Source x_component_process_Xform/Form.js, line 1191 getRouteDataList() &rarr; {Array.&lt;Object>} Summary 获取当前工作的路由配置数据. Returns Array.&lt;Object> Example this.form.getApp().appForm.getRouteDataList(); Source x_component_process_Xform/Form.js, line 1543 pressWork() Summary 给待办人发送提醒(催促办理). Description 需要判断权限 Example if( this.workContext.getControl().allowPress ){ //判断流程节点是否设置了催办并且当前人员是否有催办权限\r this.form.getApp().appForm.pressWork();\r} Source x_component_process_Xform/Form.js, line 3107 pauseTask() Summary 将待办设置为挂起状态，不计算工作时长. Example this.form.getApp().appForm.pauseTask(); Source x_component_process_Xform/Form.js, line 3135 resumeTask() Summary 将待办从挂起状态恢复为正常状态. Example this.form.getApp().appForm.resumeTask(); Source x_component_process_Xform/Form.js, line 3170 rerouteWork() Summary 弹出调度界面 Description 如果当前人员没有调度权限或者流程节点未配置调度，则提醒Permission Denied. Example this.form.getApp().appForm.rerouteWork(); Source x_component_process_Xform/Form.js, line 3649 readedWork(eopt) Summary 将当前处理人的待阅设置为已阅. Parameters e Event | Element &lt;optional&gt; Event 或者Mootools Element，指定提示框弹出的位置 Example if( this.workContext.getControl().allowReadProcessing ){ //是否有待阅\r this.form.getApp().appForm.readedWork();\r} Source x_component_process_Xform/Form.js, line 4183 uploadedAttachment(site, id) Summary 将新上传的附件在指定的附件组件中展现. Parameters site String 附件组件的标识 id String 新上传的附件id Example this.form.getApp().appForm.uploadedAttachment(site, id); Source x_component_process_Xform/Form.js, line 4253 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t表单加载前触发。数据（businessData）、预加载脚本和表单html已经就位。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeLoad \t \t \t \t\t\t表单加载前触发。如果是流程表单，已提示抢办锁定。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeModulesLoad \t \t \t \t\t\t表单的所有组件加载前触发，此时表单的样式和js head已经加载。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t表单加载后触发。主表单的组件加载完成，但不保证子表单、子页面、部件加载完成。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterModulesLoad \t \t \t \t\t\t表单的所有组件加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoad \t \t \t \t\t\t表单加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeSave \t \t \t \t\t\t保存前触发。如果是流程表单，流转前也会触发本事件。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSave \t \t \t \t\t\t保存后触发。如果是流程表单，流转后也会触发本事件。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeClose \t \t \t \t\t\t关闭前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeProcessWork \t \t \t \t\t\t弹出提交界面前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeProcess \t \t \t \t\t\t流转前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterProcess \t \t \t \t\t\t流转后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeReset \t \t \t \t\t\t重置处理人前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterReset \t \t \t \t\t\t重置处理人后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeRetract \t \t \t \t\t\t撤回前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterRetract \t \t \t \t\t\t撤回后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeReroute \t \t \t \t\t\t调度前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterReroute \t \t \t \t\t\t调度后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeDelete \t \t \t \t\t\t删除工作前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterDelete \t \t \t \t\t\t删除工作后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeReaded \t \t \t \t\t\t已阅前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterReaded \t \t \t \t\t\t已阅后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"PortalPage.html":{"url":"PortalPage.html","title":"PortalPage","kind":"Class","body":" O2OA WebAPI: PortalPage | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag McontainerMjsonMmodulesMallFgetDataFpauseTaskFresumeTaskEqueryLoadEbeforeLoadEbeforeModulesLoadEpostLoadEafterModulesLoadEafterLoadEbeforeSaveEafterSaveEbeforeClose Class PortalPage PortalPage --> Extends MWF.xApplication.process.Xform.Form PortalPage 门户页面。 Usable Range Portal Example //可以在脚本中获取页面\r//方法1：\rvar page = this.form.getApp().appForm; //获取页面\r//方法2\rvar page = this.target; //在页面本身的事件脚本中获取 Source x_component_process_Xform/Form.js, line 4350 Members containerElement 表单容器 Type Element Inherited From MWF.xApplication.process.Xform.Form#container See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取表单容器\rvar formContainer = this.form.getApp().appForm.container; Source x_component_process_Xform/Form.js, line 176 jsonObject 表单的配置信息，比如表单名称，提交方式等等. Type Object Inherited From MWF.xApplication.process.Xform.Form#json Example //可以在脚本中获取表单配置信息\rvar json = this.form.getApp().appForm.json; //表单配置信息\rvar name = json.name; //表单名称 Source x_component_process_Xform/Form.js, line 189 modulesArray 表单中的所有组件数组. Type Array Inherited From MWF.xApplication.process.Xform.Form#modules Example //下面的样例对表单组件进行循环，并且判断是输入类型的组件\rvar modules = this.form.getApp().appForm.modules; //获取所有表单组件\rfor( var i=0; i&lt;modules.length; i++ ){ //循环处理组件\r //获取组件的类型\r var moduleName = module.json.moduleName;\r if( !moduleName ){\r moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r }\r if( [\"calendar\",\"combox\",\"number\",\"textfield\"].contains( moduleName )){ //输入类型框\r //do something\r }\r} Source x_component_process_Xform/Form.js, line 215 allObject 表单中的所有组件对象. 该对象的key是组件标识，value是组件对象，可以使用该对象根据组件标识获取组件。 需要注意的是，在子表单中嵌入不绑定数据的组件（比如div,common,button等等），系统允许重名。 在打开表单的时候，系统会根据重名情况，自动在组件的标识后跟上 &quot;_1&quot;, &quot;_2&quot;。 Type Object Inherited From MWF.xApplication.process.Xform.Form#all Example var moduleAll = this.form.getApp().appForm.all; //获取组件对象\rvar subjectField = moduleAll[\"subject\"] //获取名称为subject的组件 Source x_component_process_Xform/Form.js, line 227 Methods getData() &rarr; {Object} Summary 获取表单的所有数据. Inherited From MWF.xApplication.process.Xform.Form#getData Returns Object Example var data = this.form.getApp().appForm.getData(); Source x_component_process_Xform/Form.js, line 1191 pauseTask() Summary 将待办设置为挂起状态，不计算工作时长. Inherited From MWF.xApplication.process.Xform.Form#pauseTask Example this.form.getApp().appForm.pauseTask(); Source x_component_process_Xform/Form.js, line 3135 resumeTask() Summary 将待办从挂起状态恢复为正常状态. Inherited From MWF.xApplication.process.Xform.Form#resumeTask Example this.form.getApp().appForm.resumeTask(); Source x_component_process_Xform/Form.js, line 3170 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t表单加载前触发。数据（businessData）、预加载脚本和表单html已经就位。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeLoad \t \t \t \t\t\t表单加载前触发。如果是流程表单，已提示抢办锁定。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:beforeLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeModulesLoad \t \t \t \t\t\t表单的所有组件加载前触发，此时表单的样式和js head已经加载。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:beforeModulesLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t表单加载后触发。主表单的组件加载完成，但不保证子表单、子页面、部件加载完成。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:postLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterModulesLoad \t \t \t \t\t\t表单的所有组件加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:afterModulesLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoad \t \t \t \t\t\t表单加载后触发。表单包含有子表单、子页面、部件时，此事件会在这些组件加载后触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:afterLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeSave \t \t \t \t\t\t保存前触发。如果是流程表单，流转前也会触发本事件。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:beforeSave See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSave \t \t \t \t\t\t保存后触发。如果是流程表单，流转后也会触发本事件。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:afterSave See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeClose \t \t \t \t\t\t关闭前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Form#event:beforeClose See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Htmleditor.html":{"url":"MWF.xApplication.process.Xform.Htmleditor.html","title":"Htmleditor","kind":"Class","body":" O2OA WebAPI: Htmleditor | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFresetDataFisEmptyFgetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Htmleditor Htmleditor --> Extends MWF.xApplication.process.Xform.$Module Htmleditor HTML编辑器。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar htmlEditor = this.form.get(\"name\"); //获取组件\r//方法2\rvar htmlEditor = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Htmleditor.js, line 14 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetData() Summary 重置组件的值为默认值或置空。 Example this.form.get('fieldId').resetData(); Source x_component_process_Xform/Htmleditor.js, line 398 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Returns Boolean 值是否为空. Example if( this.form.get('fieldId').isEmpty() ){\r this.form.notice('HTML编辑器不能为空', 'warn');\r} Source x_component_process_Xform/Htmleditor.js, line 409 getData() Summary 获取组件值。 Description 当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } Source x_component_process_Xform/Htmleditor.js, line 427 setData(data) Summary 为组件赋值。 Description 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String . Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } Source x_component_process_Xform/Htmleditor.js, line 445 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/Htmleditor.js, line 587 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Iframe.html":{"url":"MWF.xApplication.process.Xform.Iframe.html","title":"Iframe","kind":"Class","body":" O2OA WebAPI: Iframe | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Iframe Iframe --> Extends MWF.xApplication.process.Xform.$Module Iframe HTML iframe。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar iframe = this.form.get(\"name\"); //获取组件\r//方法2\rvar iframe = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Iframe.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Image.html":{"url":"MWF.xApplication.process.Xform.Image.html","title":"Image","kind":"Class","body":" O2OA WebAPI: Image | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Image Image --> Extends MWF.xApplication.process.Xform.$Module Image 图片。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar img = this.form.get(\"name\"); //获取组件\r//方法2\rvar img = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Image.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.ImageClipper.html":{"url":"MWF.xApplication.process.Xform.ImageClipper.html","title":"ImageClipper","kind":"Class","body":" O2OA WebAPI: ImageClipper | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFisEmptyFgetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class ImageClipper ImageClipper --> Extends MWF.xApplication.process.Xform.$Module ImageClipper 图片编辑组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar imageClipper = this.form.get(\"name\"); //获取组件\r//方法2\rvar imageClipper = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/ImageClipper.js, line 14 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Returns Boolean 值是否为空. Example if( this.form.get('fieldId').isEmpty() ){\r this.form.notice('请上传图片', 'warn');\r} Source x_component_process_Xform/ImageClipper.js, line 111 getData() 获取上传的图片ID。 Example var id = this.form.get('fieldId').getData(); //获取上传的图片id\rvar url = MWF.xDesktop.getImageSrc( id ); //获取图片的url Source x_component_process_Xform/ImageClipper.js, line 121 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/ImageClipper.js, line 320 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Label.html":{"url":"MWF.xApplication.process.Xform.Label.html","title":"Label","kind":"Class","body":" O2OA WebAPI: Label | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFsetTextFhideFshowEqueryLoadEloadEpostLoad Class Label Label --> Extends MWF.xApplication.process.Xform.$Module Label 文本组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar label = this.form.get(\"name\"); //获取组件\r//方法2\rvar label = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Label.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods setText(text) Summary 为组件设置文本，该文本不会被保存到后台。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 Parameters text String | Promise . Examples this.form.get(\"fieldId\").setText(\"test\"); //赋文本值 //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setText( promise ); Source x_component_process_Xform/Label.js, line 84 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Log.html":{"url":"MWF.xApplication.process.Xform.Log.html","title":"Log","kind":"Class","body":" O2OA WebAPI: Log | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEpostLoadDataEpostLoadLineEqueryLoadEloadEpostLoad Class Log Log --> Extends MWF.xApplication.process.Xform.$Module Log 流程记录组件。 Usable Range Process Example //可以在脚本中获取该组件\r//方法1：\rvar log = this.form.get(\"name\"); //获取组件\r//方法2\rvar log = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Log.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tpostLoadData \t \t \t \t\t\t加载数据后事件。 \t \t \t \t \t \t See 组件事件说明 \t \t\tExample \t\t //触发该事件的时候可以获取到流程数据workLog\rvar workLog = this.target.workLog;\r//可以修改workLog达到定制化流程记录的效果\rdo something \t \t \t \t \t \t \t\t \t \t \t\tpostLoadLine \t \t \t \t\t\t加载每行流程信息以后触发，可以通过this.event获得下列信息： { \"data\" : {}, //当前行流程信息 \"node\" : logTaskNode, //当前节点 \"log\" : object, //指向流程记录 \"type\" : \"task\" //\"task\"表示待办，\"taskCompleted\"表示已办 } \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Monitor.html":{"url":"MWF.xApplication.process.Xform.Monitor.html","title":"Monitor","kind":"Class","body":" O2OA WebAPI: Monitor | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MmonitorMnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Monitor Monitor --> Extends MWF.xApplication.process.Xform.$Module Monitor 流程图组件。 Usable Range Process Example //可以在脚本中获取该组件\r//方法1：\rvar attachment = this.form.get(\"name\"); //获取组件\r//方法2\rvar attachment = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Monitor.js, line 15 Members monitor 流程图对象，是一个 MWF.xApplication.process.Xform.widget.Monitor 类实例 Source x_component_process_Xform/Monitor.js, line 29 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Number.html":{"url":"MWF.xApplication.process.Xform.Number.html","title":"Number","kind":"Class","body":" O2OA WebAPI: Number | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Number Number --> Extends MWF.xApplication.process.Xform.Textfield Number 数字输入组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"name\"); //获取组件\r//方法2\rvar field = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Number.js, line 14 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Office.html":{"url":"MWF.xApplication.process.Xform.Office.html","title":"Office","kind":"Class","body":" O2OA WebAPI: Office | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MofficeOCXMnodeMjsonMformFeditEnabledFdocReadonlyFprotectFstartRevisionsFstopRevisionsFsealFredFileFshowRevisionsFhideRevisionsFsaveFhideFshowEredFileEsealEafterOpenEafterOpenOfficeEafterCreateEbeforeSaveEafterSaveEafterCloseOfficeEload Class Office Office --> Extends MWF.xApplication.process.Xform.$Module Office Office控件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar attachment = this.form.get(\"name\"); //获取组件\r//方法2\rvar attachment = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Office.js, line 14 Members officeOCX Ntko Office 控件对象, 第三方控件 See NTKO官网 Example var officeOCX = this.form.get(\"fieldId\").officeOCX;\r var activeDocument = officeOCX.ActiveDocument //返回一个Office Document 对象，该对象代表活动文档。 Source x_component_process_Xform/Office.js, line 1294 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods editEnabled() Summary 允许编辑Office文档 Example this.form.get(\"fieldId\").editEnabled(); Source x_component_process_Xform/Office.js, line 340 docReadonly() Summary 设置Office文档为只读 Example this.form.get(\"fieldId\").docReadonly(); Source x_component_process_Xform/Office.js, line 350 protect(type) Summary 设置Office文档状态 Parameters type Number 1(批注),2(填写窗体),3(只读),0(修订),-1(限制编辑样式) Example this.form.get(\"fieldId\").protect(1); Source x_component_process_Xform/Office.js, line 359 startRevisions() Summary 设置Office文档保留痕迹 Source x_component_process_Xform/Office.js, line 372 stopRevisions() Summary 设置Office文档取消保留痕迹 Source x_component_process_Xform/Office.js, line 398 seal() Summary 盖章 Source x_component_process_Xform/Office.js, line 703 redFile() Summary 套红 Source x_component_process_Xform/Office.js, line 709 showRevisions() Summary 显示痕迹 Source x_component_process_Xform/Office.js, line 738 hideRevisions() Summary 隐藏痕迹 Source x_component_process_Xform/Office.js, line 750 save(history) Summary 保存Office文档到后台 Parameters history Boolean 是否生产保留痕迹文件 Source x_component_process_Xform/Office.js, line 1337 hide() Summary 隐藏组件. Overrides MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Overrides MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tredFile \t \t \t \t\t\t点击套红按钮触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tseal \t \t \t \t\t\t点击盖章按钮触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterOpen \t \t \t \t\t\tNtko控件执行AfterOpenFromURL事件（BeginOpenFromURL方法执行完毕之后被触发）时执行。 本事件可以通过this.event获取当前打开的文档对象。比如，对于一个Word文档，第二个参数是一个Word.Document对象。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterOpenOffice \t \t \t \t\t\tNtko控件执行OnDocumentOpened事件（Office文档打开完毕）时触发。 本事件可以通过this.event获取以下内容 { url : url, //Office文档路径或者URL doc : doc //Office文档的自动化接口，比如，对于一个Word文档，第二个参数是一个Word.Document对象。 } \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterCreate \t \t \t \t\t\t在新建Office文档后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeSave \t \t \t \t\t\t在保存Office文档前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSave \t \t \t \t\t\t在保存Office文档后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterCloseOffice \t \t \t \t\t\t在关闭Office文档时执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Opinion.html":{"url":"MWF.xApplication.process.Xform.Opinion.html","title":"Opinion","kind":"Class","body":" O2OA WebAPI: Opinion | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MhandwritingActionMaudioRecordActionMaudioRecorderMhandwritingNodeMtabletMdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Opinion Opinion --> Extends MWF.xApplication.process.Xform.$Input Opinion 意见输入框。 Usable Range Process Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Opinion.js, line 22 Members handwritingActionElement 手写意见按钮按钮。 Type Element Source x_component_process_Xform/Opinion.js, line 147 audioRecordActionElement 音频按钮.在浏览器支持HTML5的getUserMedia才可用。 Type Element Source x_component_process_Xform/Opinion.js, line 159 audioRecordero2.widget.AudioRecorder 音频意见组件. Type o2.widget.AudioRecorder Source x_component_process_Xform/Opinion.js, line 253 handwritingNodeElement 手写板容器. Type Element Source x_component_process_Xform/Opinion.js, line 321 tableto2.widget.Tablet 手写板组件. Type o2.widget.Tablet Source x_component_process_Xform/Opinion.js, line 352 descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Overrides MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Org.html":{"url":"MWF.xApplication.process.Xform.Org.html","title":"Org","kind":"Class","body":" O2OA WebAPI: Org | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MselectorMdescriptionNodeMnodeMjsonMformFclickSelectFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoadEchangeEselectEqueryLoadSelectorEpostLoadSelectorEqueryLoadCategoryEpostLoadContentEqueryLoadCategoryEpostLoadCategoryEselectCategoryEunselectCategoryEexpandEcollapseEqueryLoadItemEpostLoadItemEselectItemEunselectItem Class Org Org --> Extends MWF.xApplication.process.Xform.$Input Org 人员组织组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Org.js, line 23 Members selectoro2.O2Selector 人员选择框package的对象 Type o2.O2Selector Example //可以在脚本中获取该组件\rvar selector = this.form.get(\"fieldId\").selector.selector; //获取人员选择框对象\rvar options = selector.options; //获取人员选择框的选项 Source x_component_process_Xform/Org.js, line 626 descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Overrides MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods clickSelect() Summary 弹出选择界面. Example this.form.get('org').clickSelect(); Source x_component_process_Xform/Org.js, line 609 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Overrides MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Overrides MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Overrides MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Input#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Input#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.$Input#event:postLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t当组件值改变时触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselect \t \t \t \t\t\t当组件不允许输入（使用人员选择框）时，完成选择人员，并且给组件赋值后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadSelector \t \t \t \t\t\t人员选择框事件：加载前执行。this.target指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadSelector \t \t \t \t\t\t人员选择框事件：加载后执行，由于选择项为异步加载，此时选择项并未加载完成。this.target指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadCategory \t \t \t \t\t\t人员选择框事件：加载选择框容器节点前执行。this.target指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadContent \t \t \t \t\t\t人员选择框事件：加载选择框容器节点后执行。this.target指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadCategory \t \t \t \t\t\t人员选择框事件：加载分类前执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadCategory \t \t \t \t\t\t人员选择框事件：加载分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectCategory \t \t \t \t\t\t人员选择框事件：选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectCategory \t \t \t \t\t\t人员选择框事件：取消选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\texpand \t \t \t \t\t\t人员选择框事件：展开分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tcollapse \t \t \t \t\t\t人员选择框事件：折叠分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项前执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectItem \t \t \t \t\t\t人员选择框事件：选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectItem \t \t \t \t\t\t人员选择框事件：取消选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Radio.html":{"url":"MWF.xApplication.process.Xform.Radio.html","title":"Radio","kind":"Class","body":" O2OA WebAPI: Radio | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFresetOptionFgetOptionsFgetOptionsObjFgetTextDataFgetSelectedInputFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Radio Radio --> Extends MWF.xApplication.process.Xform.$Input Radio 单选按钮。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Radio.js, line 22 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetOption() Summary 刷新选择项，如果选择项是脚本，重新计算。 Example this.form.get('fieldId').resetOption(); Source x_component_process_Xform/Radio.js, line 125 getOptions() &rarr; {Array} Summary 获取选择项。 Returns Array 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：[ &quot;女|female&quot;, &quot;男|male&quot; ] Example this.form.get('fieldId').getOptions(); Source x_component_process_Xform/Radio.js, line 138 getOptionsObj() &rarr; {Object} Summary 获取整理后的选择项。 Returns Object 返回整理后的选择项，如： {\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]} Example var optionData = this.form.get('fieldId').getOptionsObj(); Source x_component_process_Xform/Radio.js, line 155 getTextData() &rarr; {Object} Summary 获取选中项的value和text。 Returns Object 返回选中项的value和text，如： {\"value\": [\"male\"], \"text\": [\"男\"]} {\"value\": [\"\"], \"text\": [\"\"]} Example var data = this.form.get('fieldId').getTextData();\rvar text = data.text[0] //获取选中项的文本 Source x_component_process_Xform/Radio.js, line 355 getSelectedInput() &rarr; {Element} Summary 获取选中的Dom对象。 Returns Element 返回选中的Dom对象 Example var input = this.form.get('fieldId').getSelectedInput(); Source x_component_process_Xform/Radio.js, line 399 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Overrides MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Overrides MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Select.html":{"url":"MWF.xApplication.process.Xform.Select.html","title":"Select","kind":"Class","body":" O2OA WebAPI: Select | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFresetOptionFgetOptionsFgetOptionsObjFgetTextDataFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Select Select --> Extends MWF.xApplication.process.Xform.$Input Select 下拉选择组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Select.js, line 21 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Input#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Overrides MWF.xApplication.process.Xform.$Input#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Overrides MWF.xApplication.process.Xform.$Input#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods resetOption() Summary 刷新选择项，如果选择项是脚本，重新计算。 Example this.form.get('fieldId').resetOption(); Source x_component_process_Xform/Select.js, line 154 getOptions() &rarr; {Array} Summary 获取选择项。 Returns Array 返回选择项数组，如果使用选择项脚本，根据脚本返回决定，如：[ &quot;女|female&quot;, &quot;男|male&quot; ] Example this.form.get('fieldId').getOptions(); Source x_component_process_Xform/Select.js, line 168 getOptionsObj() &rarr; {Object} Summary 获取整理后的选择项。 Returns Object 返回整理后的选择项，如： {\"valueList\": [\"\",\"female\",\"male\"], \"textList\": [\"\",\"女\",\"男\"]} Example var optionData = this.form.get('fieldId').getOptionsObj(); Source x_component_process_Xform/Select.js, line 185 getTextData() &rarr; {Object} Summary 获取选中项的value和text。 Returns Object 返回选中项的value和text，如： {\"value\": [\"male\"], \"text\": [\"男\"]} {\"value\": [\"\"], \"text\": [\"\"]} Example var data = this.form.get('fieldId').getTextData();\rvar text = data.text[0] //获取选中项的文本 Source x_component_process_Xform/Select.js, line 372 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Overrides MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Overrides MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Sidebar.html":{"url":"MWF.xApplication.process.Xform.Sidebar.html","title":"Sidebar","kind":"Class","body":" O2OA WebAPI: Sidebar | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MtoolbarWidgetMnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Sidebar Sidebar --> Extends MWF.xApplication.process.Xform.$Module Sidebar 侧边操作条。 Usable Range Process Example //可以在脚本中获取该组件\r//方法1：\rvar sidebar = this.form.get(\"fieldId\"); //获取侧边操作条\r//方法2\rvar sidebar = this.target; //在侧边操作条和操作本身的事件脚本中获取 Source x_component_process_Xform/Sidebar.js, line 15 Members toolbarWidgeto2.widget.Toolbar Toolbar组件，平台使用该组件生成操作条。 Type o2.widget.Toolbar Example //可以在脚本中获取该组件\rvar toolbarWidget = this.form.get(\"fieldId\").toolbarWidget; //获取组件对象 Source x_component_process_Xform/Sidebar.js, line 68 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Source.html":{"url":"MWF.xApplication.process.Xform.Source.html","title":"Source","kind":"Class","body":" O2OA WebAPI: Source | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFsetParametersFaddParametersFreloadFhideFshowEpostLoadDataEloadDataEqueryLoadEloadEpostLoad Class Source Source --> Extends MWF.xApplication.process.Xform.Div Source 数据源组件。 Usable Range Portal Example //可以在脚本中获取该组件\r//方法1：\rvar source = this.form.get(\"fieldId\"); //获取数据源组件\r//方法2\rvar source = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Source.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods setParameters(url参数) Summary 替换全部的url参数，但不刷新组件 Parameters url参数 Object Example //如，原来的组件url参数为：\r{ \"page\" : 1, \"count\" : 10 }\r\rthis.form.get(\"fieldId\").setParameters({\"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"});\r\r//执行后变为\r{\"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"} Source x_component_process_Xform/Source.js, line 132 addParameters(url参数) Summary 新增url参数，但不刷新组件。如果该参数key已经存在，则覆盖 Parameters url参数 Object Example * //如，原来的组件url参数为：\r{ \"page\" : 1, \"count\" : 10 }\r\rthis.form.get(\"fieldId\").addParameters({\r \"page\" : 2,\r \"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"\r });\r\r//执行后变为\r{\r \"page\" : 2,\r \"count\" : 10\r \"id\":\"662ede34-4e21-428a-9c3b-f1bf14d15650\"\r } Source x_component_process_Xform/Source.js, line 156 reload(notInit, callback) Summary 重新加载组件。会触发loadData事件 Parameters notInit Boolean false表示不重新初始化子数据源和数据文本，true表示重新初始化，默认为false callback function 加载完成后的回调 Example this.form.get(\"fieldId\").reload(); //重新加载组件 Source x_component_process_Xform/Source.js, line 171 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tpostLoadData \t \t \t \t\t\t加载数据后执行，但这时还未加载下属组件，可以可以使用this.target.data获取数据进行修改。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tloadData \t \t \t \t\t\t加载数据、下属组件后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.SourceText.html":{"url":"MWF.xApplication.process.Xform.SourceText.html","title":"SourceText","kind":"Class","body":" O2OA WebAPI: SourceText | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class SourceText SourceText --> Extends MWF.xApplication.process.Xform.$Module SourceText 数据文本组件。 Usable Range Portal Example //可以在脚本中获取该组件\r//方法1：\rvar sourceText = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar sourceText = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/SourceText.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Stat.html":{"url":"MWF.xApplication.process.Xform.Stat.html","title":"Stat","kind":"Class","body":" O2OA WebAPI: Stat | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MstatMnodeMjsonMformFgetDataFhideFshowEloadStatEqueryLoadEloadEpostLoad Class Stat Stat --> Extends MWF.xApplication.process.Xform.$Module Stat 统计组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar stat = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar stat = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Stat.js, line 16 Members statMWF.xApplication.query.Query.Statistician Statistician组件，平台使用该组件执行统计的逻辑 Type MWF.xApplication.query.Query.Statistician Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\").stat; //获取组件对象 Source x_component_process_Xform/Stat.js, line 60 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods getData() &rarr; {Ojbect|Boolean} Summary 获取统计数据。 Returns Ojbect 统计数据. Boolean 是否通过校验 Example var data = this.form.get(\"fieldId\").getData();\r Source x_component_process_Xform/Stat.js, line 76 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tloadStat \t \t \t \t\t\t组件异步加载完成触发. \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Statement.html":{"url":"MWF.xApplication.process.Xform.Statement.html","title":"Statement","kind":"Class","body":" O2OA WebAPI: Statement | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MviewMnodeMjsonMformFreloadFactiveFgetDataFhideFshowEloadViewEselectEopenDocumentEqueryLoadEloadEpostLoad Class Statement Statement --> Extends MWF.xApplication.process.Xform.$Module Statement 查询视图组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar statement = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar statement = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Statement.js, line 15 Members viewMWF.xApplication.query.Query.Statement Statement组件，平台使用该组件实现查询视图的功能 Type MWF.xApplication.query.Query.Statement Example //可以在脚本中获取该组件\rvar view = this.form.get(\"fieldId\").view; //获取组件对象 Source x_component_process_Xform/Statement.js, line 110 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods reload() Summary 重新加载查询视图 Example this.form.get(\"fieldId\").reload() Source x_component_process_Xform/Statement.js, line 52 active() Summary 当查询视图被设置为延迟加载（未立即载入），通过active方法激活 Example this.form.get(\"fieldId\").active() Source x_component_process_Xform/Statement.js, line 65 getData() &rarr; {Array.&lt;Object>} Summary 获取查询视图被选中行的数据 Returns Array.&lt;Object> 被选中行的数据 Example var data = this.form.get(\"fieldId\").getData(); Source x_component_process_Xform/Statement.js, line 136 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tloadView \t \t \t \t\t\t异步加载查询视图后完成。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselect \t \t \t \t\t\t选中查询视图中的一条记录后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\topenDocument \t \t \t \t\t\t打开查询视图中的一条记录后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.StatementSelector.html":{"url":"MWF.xApplication.process.Xform.StatementSelector.html","title":"StatementSelector","kind":"Class","body":" O2OA WebAPI: StatementSelector | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class StatementSelector StatementSelector --> Extends MWF.xApplication.process.Xform.ViewSelector ViewSelector 查询视图选择组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar statementSelector = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar statementSelector = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/StatementSelector.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Subform.html":{"url":"MWF.xApplication.process.Xform.Subform.html","title":"Subform","kind":"Class","body":" O2OA WebAPI: Subform | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFactiveFreloadFhideFshowEqueryLoadEloadEpostLoad Class Subform Subform --> Extends MWF.xApplication.process.Xform.$Module Subform 子表单组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar subform = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar subform = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Subform.js, line 14 Members nodeElement 组件的节点 Type Element Overrides MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods active(callback) Summary 当子表单被设置为延迟加载，通过active方法激活 Parameters callback function Example var subform = this.form.get(\"fieldId\");\rsubform.active(function(){\r //do someting\r}) Source x_component_process_Xform/Subform.js, line 45 reload(callback) Summary 重新加载子表单 Parameters callback function Example this.form.get(\"fieldId\").reload(function(){\r //do someting\r}) Source x_component_process_Xform/Subform.js, line 60 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.SubSource.html":{"url":"MWF.xApplication.process.Xform.SubSource.html","title":"SubSource","kind":"Class","body":" O2OA WebAPI: SubSource | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEpostLoadDataEloadDataEqueryLoadEloadEpostLoad Class SubSource SubSource --> Extends MWF.xApplication.process.Xform.$Module SubSource 子数据源。 Usable Range Portal Example //可以在脚本中获取该组件\r//方法1：\rvar subSource = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar subSource = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/SubSource.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tpostLoadData \t \t \t \t\t\t加载数据后执行，但这时还未加载下属组件，可以可以使用this.target.data获取数据进行修改。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tloadData \t \t \t \t\t\t加载数据、下属组件后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Tab.html":{"url":"MWF.xApplication.process.Xform.Tab.html","title":"Tab","kind":"Class","body":" O2OA WebAPI: Tab | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MtabMnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Tab Tab --> Extends MWF.xApplication.process.Xform.$Module Tab 分页组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar tab = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar tab = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Tab.js, line 15 Members tabMWF.widget.Tab tab组件，平台使用该组件实现分页组件的功能 Type MWF.widget.Tab Example //可以在脚本中获取该组件\rvar tab = this.form.get(\"fieldId\").tab; //获取组件对象\rvar pages = tab.pages //获取每个分页\rpages[1].addEvent(\"queryShow\", function(){\r //添加显示分页前事件\r})\rpages[1].addEvent(\"postShow\", function(){\r //添加显示分页后事件\r})\rpages[1]._showTab(); //显示第2个分页 Source x_component_process_Xform/Tab.js, line 42 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Table.html":{"url":"MWF.xApplication.process.Xform.Table.html","title":"Table","kind":"Class","body":" O2OA WebAPI: Table | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MtableMnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Table Table --> Extends MWF.xApplication.process.Xform.$Module Table 表格组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar table = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar table = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Table.js, line 14 Members tableElement table，DOM对象 Type Element Example //可以在脚本中获取该组件\rvar table = this.form.get(\"fieldId\").table; //获取组件对象 Source x_component_process_Xform/Table.js, line 19 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Table$Td.html":{"url":"MWF.xApplication.process.Xform.Table$Td.html","title":"Table$Td","kind":"Class","body":" O2OA WebAPI: Table$Td | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Table$Td Table$Td --> Extends MWF.xApplication.process.Xform.$Module Table$Td 单元格组件。 Example //可以在脚本中获取该组件\r//方法1：\rvar td = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar td = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Table.js, line 116 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Textarea.html":{"url":"MWF.xApplication.process.Xform.Textarea.html","title":"Textarea","kind":"Class","body":" O2OA WebAPI: Textarea | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Textarea Textarea --> Extends MWF.xApplication.process.Xform.$Input Textarea 多行文本组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Textarea.js, line 21 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Textfield.html":{"url":"MWF.xApplication.process.Xform.Textfield.html","title":"Textfield","kind":"Class","body":" O2OA WebAPI: Textfield | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MdescriptionNodeMnodeMjsonMformFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoad Class Textfield Textfield --> Extends MWF.xApplication.process.Xform.$Input Textfield 文本输入框。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_process_Xform/Textfield.js, line 21 Members descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Tree.html":{"url":"MWF.xApplication.process.Xform.Tree.html","title":"Tree","kind":"Class","body":" O2OA WebAPI: Tree | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MtreeMnodeMjsonMformFhideFshowEbeforeLoadTreeEafterLoadTreeEbeforeLoadTreeNodeEafterLoadTreeNodeEexpandEcollapseEbeforeSelectEafterSelectEqueryLoadEloadEpostLoad Class Tree Tree --> Extends MWF.xApplication.process.Xform.$Module Tree 树组件。 Usable Range Process CMS Portal See 树组件数据结构 Example //可以在脚本中获取该组件\r//方法1：\rvar datagrid = this.form.get(\"name\"); //获取组件\r//方法2\rvar datagrid = this.target; //在组件事件脚本中获取 Source x_component_process_Xform/Tree.js, line 42 Members treeo2.widget.Tree 树组件，平台使用该组件实现树的功能，该组件为异步加载 Type o2.widget.Tree Example //可以在脚本中获取该组件\rvar tree = this.form.get(\"fieldId\").tree; //获取组件对象\rvar children = tree.children[]; //获取第一层树叶\rtree.reLoad( json ); //给整颗树重新赋数据，并重新加载 Source x_component_process_Xform/Tree.js, line 125 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tbeforeLoadTree \t \t \t \t\t\t异步加载树前执行。this.target指向当前组件。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoadTree \t \t \t \t\t\t异步加载树后执行。this.target指向当前组件。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeLoadTreeNode \t \t \t \t\t\t加载树的叶子前执行。this.target指向加载的叶子。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoadTreeNode \t \t \t \t\t\t加载树的叶子后执行。this.target指向加载的叶子。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\texpand \t \t \t \t\t\t加载树的叶子后执行。this.target指向加载的叶子。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tcollapse \t \t \t \t\t\t折叠节点的时候执行。this.target指向被折叠的节点。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeSelect \t \t \t \t\t\t选中节点前执行。此时原来被选中的节点还未取消。this.target指向选中的节点。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSelect \t \t \t \t\t\t选中节点后执行。this.target指向选中的节点。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.View.html":{"url":"MWF.xApplication.process.Xform.View.html","title":"View","kind":"Class","body":" O2OA WebAPI: View | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MviewMnodeMjsonMformFreloadFactiveFgetDataFhideFshowEloadViewEselectEopenDocumentEqueryLoadEloadEpostLoad Class View View --> Extends MWF.xApplication.process.Xform.$Module View 视图组件。 Usable Range Process CMS Portal Example //可以在脚本中获取该组件\r//方法1：\rvar view = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar view = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/View.js, line 15 Members viewMWF.xApplication.process.Application.Viewer view组件，平台使用该组件实现视图的功能 Type MWF.xApplication.process.Application.Viewer Example //可以在脚本中获取该组件\rvar view = this.form.get(\"fieldId\").view; //获取组件对象 Source x_component_process_Xform/View.js, line 191 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods reload() Summary 重新加载视图 Example this.form.get(\"fieldId\").reload() Source x_component_process_Xform/View.js, line 60 active() Summary 当视图被设置为延迟加载（未立即载入），通过active方法激活 Example this.form.get(\"fieldId\").active() Source x_component_process_Xform/View.js, line 73 getData() &rarr; {Array.&lt;Object>} Summary 获取视图被选中行的数据 Returns Array.&lt;Object> 被选中行的数据 Example var data = this.form.get(\"fieldId\").getData(); Source x_component_process_Xform/View.js, line 210 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tloadView \t \t \t \t\t\t异步加载视图后完成。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselect \t \t \t \t\t\t选中视图中的一条记录后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\topenDocument \t \t \t \t\t\t打开视图中的一条记录后执行。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.ViewSelector.html":{"url":"MWF.xApplication.process.Xform.ViewSelector.html","title":"ViewSelector","kind":"Class","body":" O2OA WebAPI: ViewSelector | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class ViewSelector ViewSelector --> Extends MWF.xApplication.process.Xform.Button ViewSelector 视图选择组件。 Usable Range Process CMS Example //可以在脚本中获取该组件\r//方法1：\rvar sourceText = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar sourceText = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/ViewSelector.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.process.Xform.Widget.html":{"url":"MWF.xApplication.process.Xform.Widget.html","title":"Widget","kind":"Class","body":" O2OA WebAPI: Widget | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFreloadFgetPageParamentersFhideFshowEqueryLoadEloadEpostLoad Class Widget Widget --> Extends MWF.xApplication.process.Xform.$Module Widget 门户的部件组件。 Usable Range Portal Example //可以在脚本中获取该组件\r//方法1：\rvar widget = this.form.get(\"fieldId\"); //获取组件\r//方法2\rvar widget = this.target; //在组件本身的脚本中获取 Source x_component_process_Xform/Widget.js, line 14 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods reload() Summary 重新加载部件 Example this.form.get(\"fieldId\").reload() Source x_component_process_Xform/Widget.js, line 31 getPageParamenters() Summary 获取设计部件时设置的参数 Returns 设置的参数 Example var param = this.form.get(\"fieldId\").getPageParamenters() Source x_component_process_Xform/Widget.js, line 200 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.cms.Xform.Author.html":{"url":"MWF.xApplication.cms.Xform.Author.html","title":"Author","kind":"Class","body":" O2OA WebAPI: Author | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MselectorMdescriptionNodeMnodeMjsonMformFclickSelectFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoadEchangeEselectEqueryLoadSelectorEpostLoadSelectorEqueryLoadCategoryEpostLoadContentEpostLoadCategoryEselectCategoryEunselectCategoryEexpandEcollapseEqueryLoadItemEpostLoadItemEselectItemEunselectItem Class Author Author --> Extends MWF.xApplication.process.Xform.Org Author 作者组件。 Usable Range CMS Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_cms_Xform/Author.js, line 21 Members selectoro2.O2Selector 人员选择框package的对象 Type o2.O2Selector Inherited From MWF.xApplication.process.Xform.Org#selector Example //可以在脚本中获取该组件\rvar selector = this.form.get(\"fieldId\").selector.selector; //获取人员选择框对象\rvar options = selector.options; //获取人员选择框的选项 Source x_component_process_Xform/Org.js, line 626 descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods clickSelect() Summary 弹出选择界面. Inherited From MWF.xApplication.process.Xform.Org#clickSelect Example this.form.get('org').clickSelect(); Source x_component_process_Xform/Org.js, line 609 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t当组件值改变时触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:change See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselect \t \t \t \t\t\t当组件不允许输入（使用人员选择框）时，完成选择人员，并且给组件赋值后执行。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:select See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadSelector \t \t \t \t\t\t人员选择框事件：加载前执行。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoadSelector See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadSelector \t \t \t \t\t\t人员选择框事件：加载后执行，由于选择项为异步加载，此时选择项并未加载完成。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadSelector See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadCategory \t \t \t \t\t\t人员选择框事件：加载选择框容器节点前执行。this.target指向人员选择框。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.Org#event:queryLoadCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadContent \t \t \t \t\t\t人员选择框事件：加载选择框容器节点后执行。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadContent See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadCategory \t \t \t \t\t\t人员选择框事件：加载分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectCategory \t \t \t \t\t\t人员选择框事件：选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:selectCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectCategory \t \t \t \t\t\t人员选择框事件：取消选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:unselectCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\texpand \t \t \t \t\t\t人员选择框事件：展开分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:expand See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tcollapse \t \t \t \t\t\t人员选择框事件：折叠分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:collapse See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项前执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoadItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectItem \t \t \t \t\t\t人员选择框事件：选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:selectItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectItem \t \t \t \t\t\t人员选择框事件：取消选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:unselectItem See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.cms.Xform.Comment.html":{"url":"MWF.xApplication.cms.Xform.Comment.html","title":"Comment","kind":"Class","body":" O2OA WebAPI: Comment | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class Comment Comment --> Extends MWF.xApplication.process.Xform.$Module Comment 评论组件。 Usable Range CMS Example //可以在脚本中获取该组件\r//方法1：\rvar datagrid = this.form.get(\"name\"); //获取组件\r//方法2\rvar datagrid = this.target; //在组件事件脚本中获取 Source x_component_cms_Xform/Comment.js, line 15 Members nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"CMSForm.html":{"url":"CMSForm.html","title":"CMSForm","kind":"Class","body":" O2OA WebAPI: CMSForm | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag McontainerMjsonMmodulesMallFgetDataFdeleteDocumentFeditDocumentFeditDocumentForMobileFsetPopularDocumentFuploadedAttachmentEqueryLoadEbeforeLoadEbeforeModulesLoadEpostLoadEafterModulesLoadEafterLoadEbeforeSaveEafterSaveEafterSaveEbeforeCloseEbeforePublishEpostPublishEafterPublishEbeforeDeleteEafterDelete Class CMSForm CMSForm --> CMSForm 内容管理表单。 Usable Range CMS Example //可以在脚本中获取表单\r//方法1：\rvar form = this.form.getApp().appForm; //获取表单\r//方法2\rvar form = this.target; //在表单本身的事件脚本中获取 Source x_component_cms_Xform/Form.js, line 24 Members containerElement 表单容器 Type Element See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取表单容器\rvar formContainer = this.form.getApp().appForm.container; Source x_component_cms_Xform/Form.js, line 149 jsonObject 表单的配置信息，比如表单名称等等. Type Object Example //可以在脚本中获取表单配置信息\rvar json = this.form.getApp().appForm.json; //表单配置信息\rvar name = json.name; //表单名称 Source x_component_cms_Xform/Form.js, line 161 modulesArray 表单中的所有组件数组. Type Array Example //下面的样例对表单组件进行循环，并且判断是输入类型的组件\rvar modules = this.form.getApp().appForm.modules; //获取所有表单组件\rfor( var i=0; i&lt;modules.length; i++ ){ //循环处理组件\r //获取组件的类型\r var moduleName = module.json.moduleName;\r if( !moduleName ){\r moduleName = typeOf(module.json.type) === \"string\" ? module.json.type.toLowerCase() : \"\";\r }\r if( [\"calendar\",\"combox\",\"number\",\"textfield\"].contains( moduleName )){ //输入类型框\r //do something\r }\r} Source x_component_cms_Xform/Form.js, line 185 allObject 表单中的所有组件对象. 该对象的key是组件标识，value是组件对象，可以使用该对象根据组件标识获取组件。 需要注意的是，在子表单中嵌入不绑定数据的组件（比如div,common,button等等），系统允许重名。 在打开表单的时候，系统会根据重名情况，自动在组件的标识后跟上 &quot;_1&quot;, &quot;_2&quot;。 Type Object Example var moduleAll = this.form.getApp().appForm.all; //获取组件对象\rvar subjectField = moduleAll[\"subject\"] //获取名称为subject的组件 Source x_component_cms_Xform/Form.js, line 197 Methods static getData() &rarr; {Object} Summary 获取表单的所有数据. Returns Object Example var data = this.form.getApp().appForm.getData(); Source x_component_cms_Xform/Form.js, line 130 static deleteDocument() Summary 弹出删除文档确认框. Example this.form.getApp().appForm.deleteDocument(); Source x_component_cms_Xform/Form.js, line 720 static editDocument() Summary 编辑文档. Example this.form.getApp().appForm.editDocument(); Source x_component_cms_Xform/Form.js, line 765 static editDocumentForMobile() Summary 移动端开启编辑模式. Example this.form.getApp().appForm.editDocumentForMobile(); Source x_component_cms_Xform/Form.js, line 792 static setPopularDocument() Summary 弹出设置热点的界面. Example this.form.getApp().appForm.setPopularDocument(); Source x_component_cms_Xform/Form.js, line 806 static uploadedAttachment(site, id) Summary 将新上传的附件在指定的附件组件中展现. Parameters site String 附件组件的标识 id String 新上传的附件id Example this.form.getApp().appForm.uploadedAttachment(site, id); Source x_component_cms_Xform/Form.js, line 837 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t表单加载前触发。表单html已经就位。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeLoad \t \t \t \t\t\t表单加载前触发。数据(businessData)已经就绪。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeModulesLoad \t \t \t \t\t\t表单的所有组件加载前触发，此时表单的样式和js head已经加载。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t表单加载后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterModulesLoad \t \t \t \t\t\t表单的所有组件加载后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterLoad \t \t \t \t\t\t表单加载后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeSave \t \t \t \t\t\t保存前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSave \t \t \t \t\t\t数据已经整理完成，但还未保存到后台时触发。this.event指向整理完成的数据 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterSave \t \t \t \t\t\t数据保存到后台后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeClose \t \t \t \t\t\t关闭前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforePublish \t \t \t \t\t\t发布前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostPublish \t \t \t \t\t\t数据已经整理完成，但还未调用服务发布触发。this.event指向整理完成的数据 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterPublish \t \t \t \t\t\t执行后台服务发布后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tbeforeDelete \t \t \t \t\t\t删除前触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tafterDelete \t \t \t \t\t\t删除后触发。 \t \t \t \t \t \t See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"CMSLog.html":{"url":"CMSLog.html","title":"CMSLog","kind":"Class","body":" O2OA WebAPI: CMSLog | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MlogMnodeMjsonMformFhideFshowEqueryLoadEloadEpostLoad Class CMSLog CMSLog --> Extends MWF.xApplication.process.Xform.$Module CMSLog 文档查看日志组件。 Usable Range CMS Example //可以在脚本中获取该组件\r//方法1：\rvar datagrid = this.form.get(\"name\"); //获取组件\r//方法2\rvar datagrid = this.target; //在组件事件脚本中获取 Source x_component_cms_Xform/Log.js, line 16 Members logMWF.xApplication.cms.Xform.widget.Log log组件使用this.log实现功能 Type MWF.xApplication.cms.Xform.widget.Log Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rvar items = field.log.items; //获取日志的行对象 Source x_component_cms_Xform/Log.js, line 31 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.$Module#event:postLoad See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"MWF.xApplication.cms.Xform.Reader.html":{"url":"MWF.xApplication.cms.Xform.Reader.html","title":"Reader","kind":"Class","body":" O2OA WebAPI: Reader | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MselectorMdescriptionNodeMnodeMjsonMformFclickSelectFisReadonlyFisEmptyFgetDataFresetDataFsetDataFvalidationFhideFshowEqueryLoadEloadEpostLoadEchangeEselectEqueryLoadSelectorEpostLoadSelectorEqueryLoadCategoryEpostLoadContentEpostLoadCategoryEselectCategoryEunselectCategoryEexpandEcollapseEqueryLoadItemEpostLoadItemEselectItemEunselectItem Class Reader Reader --> Extends MWF.xApplication.process.Xform.Org Reader 读者组件。 Usable Range CMS Example //可以在脚本中获取该组件\r//方法1：\rvar field = this.form.get(\"fieldId\"); //获取组件对象\r//方法2\rvar field = this.target; //在组件本身的脚本中获取，比如事件脚本、默认值脚本、校验脚本等等\r\rvar data = field.getData(); //获取值\rfield.setData(\"字符串值\"); //设置值\rfield.hide(); //隐藏字段\rvar id = field.json.id; //获取字段标识\rvar flag = field.isEmpty(); //字段是否为空\rfield.resetData(); //重置字段的值为默认值或置空 Source x_component_cms_Xform/Reader.js, line 21 Members selectoro2.O2Selector 人员选择框package的对象 Type o2.O2Selector Inherited From MWF.xApplication.process.Xform.Org#selector Example //可以在脚本中获取该组件\rvar selector = this.form.get(\"fieldId\").selector.selector; //获取人员选择框对象\rvar options = selector.options; //获取人员选择框的选项 Source x_component_process_Xform/Org.js, line 626 descriptionNodeElement 描述信息节点，允许用户手工输入的组件才有此节点，只读情况下无此节点. Type Element Inherited From MWF.xApplication.process.Xform.$Input#descriptionNode Source x_component_process_Xform/$Input.js, line 97 nodeElement 组件的节点 Type Element Inherited From MWF.xApplication.process.Xform.$Module#node See https://mootools.net/core/docs/1.6.0/Element/Element Example //可以在脚本中获取该组件\rvar field = this.form.get(\"fieldId\"); //获取组件对象\rfield.node.setStyle(\"font-size\",\"12px\"); //给节点设置样式 Source x_component_process_Xform/$Module.js, line 39 jsonJsonObject 组件的配置信息，比如id,类型等. Type JsonObject Inherited From MWF.xApplication.process.Xform.$Module#json Example //可以在脚本中获取该组件\rvar json = this.form.get(\"fieldId\").json; //获取组件对象\rvar id = json.id; //获取组件的id\rvar type = json.type; //获取组件的类型，如Textfield 为文本输入组件，Select为下拉组件 Source x_component_process_Xform/$Module.js, line 51 formMWF.xApplication.process.Xform.Form 组件的所在表单对象. Type MWF.xApplication.process.Xform.Form Inherited From MWF.xApplication.process.Xform.$Module#form Example var form = this.form.get(\"fieldId\").form; //获取组件所在表单对象\rvar container = form.container; //获取表单容器 Source x_component_process_Xform/$Module.js, line 60 Methods clickSelect() Summary 弹出选择界面. Inherited From MWF.xApplication.process.Xform.Org#clickSelect Example this.form.get('org').clickSelect(); Source x_component_process_Xform/Org.js, line 609 isReadonly() &rarr; {Boolean} Summary 判断组件是否只读. Inherited From MWF.xApplication.process.Xform.$Input#isReadonly Returns Boolean 是否只读. Example var readonly = this.form.get('subject').isReadonly(); Source x_component_process_Xform/$Input.js, line 273 isEmpty() &rarr; {Boolean} Summary 判断组件值是否为空. Inherited From MWF.xApplication.process.Xform.$Input#isEmpty Returns Boolean 值是否为空. Example if( this.form.get('subject').isEmpty() ){\r this.form.notice('标题不能为空', 'warn');\r} Source x_component_process_Xform/$Input.js, line 291 getData() Summary 获取组件值。 Description 在脚本中使用 this.data[fieldId] 也可以获取组件值。 区别如下： 1、当使用Promise的时候 使用异步函数生成器（Promise）为组件赋值的时候，用getData方法立即获取数据，可能返回修改前的值，当Promise执行完成以后，会返回修改后的值。 this.data[fieldId] 立即获取数据，可能获取到异步函数生成器，当Promise执行完成以后，会返回修改后的值。 具体差异请查看链接 2、当表单上没有对应组件的时候，可以使用this.data[fieldId]获取值，但是this.form.get('fieldId')无法获取到组件。 Inherited From MWF.xApplication.process.Xform.$Input#getData Returns 组件的数据. Examples var data = this.form.get('fieldId').getData(); //没有使用promise的情况、 //如果无法确定表单上是否有组件，需要判断\r var data;\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r data = this.form.get('fieldId').getData();\r }else{\r data = this.data['fieldId']; //直接从数据中获取字段值\r } //使用Promise的情况\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r promise.then( function(){\r var data = field.getData(); //此时由于异步请求已经执行完毕，getData方法获取到了数据字典的值\r })\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 325 resetData() Summary 重置组件的值为默认值或置空。 Inherited From MWF.xApplication.process.Xform.$Input#resetData Example this.form.get('subject').resetData(); Source x_component_process_Xform/$Input.js, line 341 setData(data) Summary 为组件赋值。 Description 当参数为Promise的时候，请参考文档: 使用Promise处理表单异步 当表单上没有对应组件的时候，可以使用this.data[fieldId] = data赋值。 Parameters data String | Promise . Inherited From MWF.xApplication.process.Xform.$Input#setData Examples this.form.get(\"fieldId\").setData(\"test\"); //赋文本值 //如果无法确定表单上是否有组件，需要判断\r if( this.form.get('fieldId') ){ //判断表单是否有无对应组件\r this.form.get('fieldId').setData( data );\r }else{\r this.data['fieldId'] = data;\r } //使用Promise\r var field = this.form.get(\"fieldId\");\r var dict = new this.Dict(\"test\"); //test为数据字典名称\r var promise = dict.get(\"tools\", true); //异步使用数据字典的get方法时返回Promise，参数true表示异步\r field.setData( promise ); Source x_component_process_Xform/$Input.js, line 364 validation(routeNameopt) &rarr; {Boolean} Summary 根据组件的校验设置进行校验。 Parameters routeName String &lt;optional&gt; 可选，路由名称. Inherited From MWF.xApplication.process.Xform.$Input#validation Returns Boolean 是否通过校验 Example if( !this.form.get('fieldId').validation() ){\r return false;\r }\r Source x_component_process_Xform/$Input.js, line 603 hide() Summary 隐藏组件. Inherited From MWF.xApplication.process.Xform.$Module#hide Example this.form.get(\"fieldId\").hide(); //隐藏组件 Source x_component_process_Xform/$Module.js, line 76 show() Summary 显示组件. Inherited From MWF.xApplication.process.Xform.$Module#show Example this.form.get(\"fieldId\").show(); //显示组件 Source x_component_process_Xform/$Module.js, line 87 Events \t \t\t \t \t \t\tqueryLoad \t \t \t \t\t\t组件加载前触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tload \t \t \t \t\t\t组件加载时触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:load See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoad \t \t \t \t\t\t组件加载后触发. \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoad See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tchange \t \t \t \t\t\t当组件值改变时触发。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:change See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselect \t \t \t \t\t\t当组件不允许输入（使用人员选择框）时，完成选择人员，并且给组件赋值后执行。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:select See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadSelector \t \t \t \t\t\t人员选择框事件：加载前执行。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoadSelector See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadSelector \t \t \t \t\t\t人员选择框事件：加载后执行，由于选择项为异步加载，此时选择项并未加载完成。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadSelector See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadCategory \t \t \t \t\t\t人员选择框事件：加载选择框容器节点前执行。this.target指向人员选择框。 \t \t \t \t \t \t Overrides MWF.xApplication.process.Xform.Org#event:queryLoadCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadContent \t \t \t \t\t\t人员选择框事件：加载选择框容器节点后执行。this.target指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadContent See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadCategory \t \t \t \t\t\t人员选择框事件：加载分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectCategory \t \t \t \t\t\t人员选择框事件：选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:selectCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectCategory \t \t \t \t\t\t人员选择框事件：取消选择分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:unselectCategory See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\texpand \t \t \t \t\t\t人员选择框事件：展开分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:expand See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tcollapse \t \t \t \t\t\t人员选择框事件：折叠分类后执行。this.target指向分类，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:collapse See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tqueryLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项前执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:queryLoadItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tpostLoadItem \t \t \t \t\t\t人员选择框事件：加载选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:postLoadItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tselectItem \t \t \t \t\t\t人员选择框事件：选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:selectItem See 组件事件说明 \t \t \t \t \t \t \t\t \t \t \t\tunselectItem \t \t \t \t\t\t人员选择框事件：取消选择选择项后执行。this.target指向选择项，this.target.selector指向人员选择框。 \t \t \t \t \t \t Inherited From MWF.xApplication.process.Xform.Org#event:unselectItem See 组件事件说明 \t \t \t \t \t Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-documentContext.html":{"url":"module-documentContext.html","title":"documentContext","kind":"Module","body":" O2OA WebAPI: documentContext | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetDocumentFgetControlFgetAttachmentList Module documentContext 您可以通过documentContext获取内容管理实例相关的对象数据。 Usable Range CMS Example //您可以在内容管理表单中，通过this来获取当前实例的documentContext对象，如下：\rvar context = this.documentContext; Source o2_core/o2/xScript/CMSEnvironment.js, line 35 Methods static getDocument() &rarr; {Document} 获取当前内容管理实例的文档对象：document对象。 Syntax var doc = this.documentContext.getDocument(); Returns Document 文档对象. { \t\"id\": \"3359aedd-c2d8-4d8c-b8b0-02507da1b3f4\",\t\t//数据库主键,自动生成. \t\"summary\": \" \",\t\t//文档摘要 \t\"title\": \"航天科工外部董事调研组到培训中心调研\",\t\t//文档标题 \t\"documentType\": \"信息\",\t\t//文档类型，跟随分类类型，信息 | 数据 \t\"appId\": \"c295f34c-9ce1-4122-b795-820267e32b68\",\t\t//栏目ID \t\"appName\": \"通知公告\",\t\t//栏目名称 \t\"appAlias\": \" \",\t\t//栏目别名 \t\"categoryId\": \"33fb19f0-0670-464d-875c-32fb86148f7a\",\t\t//分类ID \t\"categoryName\": \"通知公告\",\t\t//分类名称 \t\"categoryAlias\": \"通知公告-通知公告\",\t\t//分类别名 \t\"form\": \"dddefed4-4411-4e4e-b982-cdd4cd083443\",\t\t//绑定的表单模板ID \t\"formName\": \"通知公告编辑表单\",\t\t//绑定的表单模板名称 \t\"importBatchName\": \" \",\t\t//文件导入的批次号：一般是分类ID+时间缀 \t\"readFormId\": \"d6f1f596-fcb7-4a87-baaf-7f6cdafe3cec\",\t\t//绑定的阅读表单模板ID \t\"readFormName\": \"通知公告阅读表单\",\t\t//绑定的阅读表单模板名称 \t\"creatorPerson\": \"李义@liyi@P\",\t\t//创建人，可能为空，如果由系统创建。 \t\"creatorIdentity\": \"李义@469d1601-c4a5-46ae-b7bf-4da9af07b6fa@I\",\t\t//创建人Identity，可能为空，如果由系统创建。 \t\"creatorUnitName\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//创建人组织，可能为空，如果由系统创建。 \t\"creatorTopUnitName\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//创建人顶层组织，可能为空，如果由系统创建。 \t\"docStatus\": \"published\",\t\t//文档状态: published | draft | checking | error \t\"description\": \" \",\t\t//说明备注，可以填写说明信息，如导入信息检验失败原因等 \t\"viewCount\": 1,\t\t//文档被查看次数 \t\"commendCount\": 1,\t\t//文档被赞次数 \t\"commentCount\": 1,\t\t//文档评论次数 \t\"publishTime\": \"2018-01-04 14:17:16\",\t\t//文档发布时间 \t\"modifyTime\": \"2021-02-23 17:06:17\",\t\t//文档修改时间 \t\"isTop\": true,\t\t//是否置顶 \t\"hasIndexPic\": true,\t\t//是否含有首页图片 \t\"reviewed\": true,\t\t//是否已经更新review信息. \t\"sequenceTitle\": \" \",\t\t//用于标题排序的sequence \t\"sequenceAppAlias\": \" \",\t\t//用于栏目别名排序的sequence \t\"sequenceCategoryAlias\": \" \",\t\t//用于分类别名排序的sequence \t\"sequenceCreatorPerson\": \" \",\t\t//用于创建者排序的sequence \t\"sequenceCreatorUnitName\": \" \",\t\t//用于创建者组织排序的sequence \t\"readPersonList\": [ \t\t\"张三@zhangsan@P\" \t\t\"所有人\" \t],\t\t//阅读人员 \t\"readUnitList\": [ \t],\t\t//阅读组织 \t\"readGroupList\": [ \t],\t\t//阅读群组 \t\"authorPersonList\": [ \t\t\"张三@zhangsan@P\" \t],\t\t//作者人员 \t\"authorUnitList\": [ \t],\t\t//作者组织 \t\"authorGroupList\": [ \t],\t\t//作者群组 \t\"remindPersonList\": [ \t\t\" \" \t],\t\t//发布提醒人员 \t\"remindUnitList\": [ \t\t\" \" \t],\t\t//发布提醒组织 \t\"remindGroupList\": [ \t\t\" \" \t],\t\t//发布提醒群组 \t\"managerList\": [ \t\t\"张三@zhangsan@P\" \t],\t\t//管理者 \t\"pictureList\": [ \t],\t\t//首页图片列表 \t\"distributeFactor\": 1,\t\t//分布式存储标识位. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\",\t\t//修改时间,自动生成,索引创建在约束中. \t\"sequence\": \" \",\t\t//列表序号,由创建时间以及ID组成.在保存时自动生成,索引创建在约束中. } Source o2_core/o2/xScript/CMSEnvironment.js, line 45 static getControl() &rarr; {DocumentControl} 获取当前人对文档的权限。 Syntax var control = this.documentContext.getControl(); Returns DocumentControl 当前人对文档所拥有的权限. { \"allowRead\": true, //是否允许阅读文档 \"allowPublishDocument\": true, //是否允许发布文档 \"allowSave\": true, //是否允许保存文档 \"allowPopularDocument\": true, //是否允许设置为热点 \"allowEditDocument\": true, //是否允许编辑文档 \"allowDeleteDocument\": true //是否允许删除文档 } Source o2_core/o2/xScript/CMSEnvironment.js, line 55 static getAttachmentList() &rarr; {Array.&lt;DocumentFileInfo>} 获取当前文档的附件对象列表。 Syntax var attachmentList = this.documentContext.getAttachmentList(); Returns Array.&lt;DocumentFileInfo> 当前文档的附件对象列表. { \t\"id\": \"a5cc5858-cac5-445a-a0a5-888d224eb2f6\",\t\t//数据库主键,自动生成. \t\"lastUpdateTime\": \"2021-02-23 17:06:17\",\t\t//最后更新时间 \t\"storage\": \" \",\t\t//关联的存储名称. \t\"site\": \"attachment_1\",\t\t//附件框分类. \t\"name\": \"13145352_115454884000_2.jpg\",\t\t//文件真实名称 \t\"cloudId\": \" \",\t\t//云文件ID \t\"fileName\": \" \",\t\t//服务器上编码后的文件名,为了方便辨识带扩展名 \t\"appId\": \"c295f34c-9ce1-4122-b795-820267e32b68\",\t\t//文件所属应用ID \t\"categoryId\": \"33fb19f0-0670-464d-875c-32fb86148f7a\",\t\t//文件所属分类ID \t\"documentId\": \"ca74cbef-2a7f-401a-80e3-577ac9839348\",\t\t//文件所属文档ID \t\"fileType\": \" \",\t\t//文件类别：云文件（CLOUD） | 附件(ATTACHMENT) \t\"fileExtType\": \" \",\t\t//文件类别：PICTURE | WORD | EXCEL | PPT | ZIP | TXT | OTHER \t\"type\": \" \",\t\t//根据流文件判断的文件类型. \t\"fileHost\": \" \",\t\t//文件存储主机名 \t\"filePath\": \" \",\t\t//文件存储路径 \t\"description\": \" \",\t\t//文件说明 \t\"creatorUid\": \"XX@huqi@P\",\t\t//创建者UID \t\"extension\": \"jpg\",\t\t//扩展名 \t\"seqNumber\": 1,\t\t//排序号 \t\"length\": 364507,\t\t//文件大小. \t\"text\": \" \",\t\t//文本. \t\"readIdentityList\": [ \t\t\" \" \t],\t\t//可以访问的身份. \t\"readUnitList\": [ \t\t\" \" \t],\t\t//可以访问的组织. \t\"editIdentityList\": [ \t\t\" \" \t],\t\t//可以修改的用户. \t\"editUnitList\": [ \t\t\" \" \t],\t\t//可以修改的组织. \t\"controllerIdentityList\": [ \t\t\" \" \t],\t\t//可以管理的用户. \t\"controllerUnitList\": [ \t\t\" \" \t],\t\t//可以管理的组织. \t\"deepPath\": true,\t\t//是否使用更深的路径. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/CMSEnvironment.js, line 72 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-form.html":{"url":"module-form.html","title":"form","kind":"Module","body":" O2OA WebAPI: form | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MreadonlyMcurrentRouteNameMopinionMmediasFpublishFgetInforFgetAppFnodeFgetFgetFieldFgetDataFsaveFcloseFpauseTaskFresumeTaskFverifyFprocessFresetFretractFaddSplitFdeleteWorkFconfirmFalertFnoticeFaddEventFprintFopenWindowFopenWorkFopenJobFopenDocumentFopenPortalFopenCMSFopenProcessFopenApplicationFcreateDocumentFstartProcess Module form form对象可在流程表单或内容管理表单中可用。（仅前端脚本可用）。 Usable Range Process CMS Syntax //您可以在流程表单和内容管理的前端脚本中，通过this来获取form对象，如下：\rvar form = this.form; Source o2_core/o2/xScript/Environment.js, line 2122 Members static readonly 获取表单是否可编辑。只读。 Syntax var readonly = this.form.readonly; Source o2_core/o2/xScript/Environment.js, line 2200 static currentRouteName 在用户提交的时候，选择的路由。仅在表单的“校验意见”和“校验路由”脚本中可用。只读。（仅流程表单中可用）。 Syntax var currentRouteName = this.form.currentRouteName; Source o2_core/o2/xScript/Environment.js, line 3079 static opinion 在用户提交的时候，输入的意见。仅在表单的“校验意见”和“校验路由”脚本中可用。只读。（仅流程表单中可用）。 Syntax var opinion = this.form.opinion; Source o2_core/o2/xScript/Environment.js, line 3090 static medias 在提交的时候，用户的手写意见以及录音意见，仅在表单的“校验意见”和“校验路由”脚本中可用。只读。（仅流程表单中可用）。 Syntax var medias = this.form.medias; Source o2_core/o2/xScript/Environment.js, line 3101 Methods static publish(callback) 发布当前文档。（仅内容管理表单中可用） Syntax this.form.publish( callback ); Parameters callback function 发布后的回调方法 Source o2_core/o2/xScript/CMSEnvironment.js, line 1542 static getInfor() &rarr; {Object} 获取当前表单的基本信息。 Syntax var form = this.form.getInfor(); Returns Object 表单的基本信息. { \"id\": \"db3b2766-93a1-4058-b522-0edb922bd84f\", //表单ID \"name\": \"报销申请表单\", //表单名称 \"alias\": \"报销申请表单\", //表单别名 \"description\": \"\", //表单描述 \"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\", //应用ID \"lastUpdatePerson\": \"XX@huqi@P\", //最后修改人 \"lastUpdateTime\": \"2018-09-30 22:46:30\", //最后修改时间 \"icon\": \"...\", //表单图标 } Source o2_core/o2/xScript/Environment.js, line 2132 static getApp() &rarr; {x_component_process_Work} 获取打开当前文档的component对象。平台中每一个窗口应用，就是一个component对象。此处获取到的对象为x_component_process_Work。 Syntax var app = this.form.getApp(); Returns x_component_process_Work 打开当前文档的component对象. Example var app = this.form.getApp();\r //所有component对象都有以下方法。\r app.openInNewWindow(); //在新窗口中打开当前应用\r app.setCurrent(); //将当前应用设置为激活状态\r app.minSize(); //应用窗口最小化\r app.maxSize(); //应用窗口最大化\r app.restoreSize(); //应用窗口还原\r app.refresh(); //刷新应用\r app.close(); //关闭应用\r app.setTitle(str); //设置应用标题\r app.dialog(option); //弹出一个对话框（详见MWF.widget.Dialog）\r \r //显示一个通知消息\r app.notice(content, type, target, where, offset);\r \r //显示一个确认框\r app.confirm(type, e, title, text, width, height, ok, cancel);\r \r //弹出一个信息框\r app.alert(type, e, title, text, width, height);\r \r //为应用绑定一个事件\r app.addEvent(type, fun); Source o2_core/o2/xScript/Environment.js, line 2154 static node() &rarr; {HTMLDivElement} 获取Form对应的DOM对象。 Syntax var node = this.form.node(); Returns HTMLDivElement 当前form对应的div对象. Source o2_core/o2/xScript/Environment.js, line 2190 static get(name) &rarr; {FormComponent} 获取表单元素对象。 Actionbar(操作条)Address(地址输入框)Attachment(附件框)Button(按钮) Calendar(日期输入框)Checkbox(多选按钮)Combox(组合框)Datagrid(数据网格) Div(容器)Htmleditor(富文本编辑框)Html(内置html)Iframe(嵌入Iframe) Image(图片)Label(文本)Log(流程意见)Monitor(流程监控) Number(数字输入框)Office(office控件)Opinion(意见框)Org(人员组织选择) Radio(单选按钮)Select(选择框)Sidebar(侧边操作条)Stat(统计组件) Subform(子表单)Tab(分页)Table(表格)Textarea(多行输入) Textfield(文本输入框)Tree(树状控件)View(视图组件)ViewSelector(视图选择组件) Documenteditor(公文编辑器)ImageClipper(图片编辑器) Syntax var field = this.form.get(name); Parameters name String 字段标识 Returns FormComponent 请查看本文档的Classes导航下的FormComponents。 Example var field = this.form.get(\"subject\"); Source o2_core/o2/xScript/Environment.js, line 2210 static getField(name) &rarr; {FormComponent} 获取表单中可输入的字段元素对象。 Address(地址输入框)Attachment(附件框)Calendar(日期输入框)Checkbox(多选按钮) Combox(组合框)Datagrid(数据网格)Htmleditor(富文本编辑框)Number(数字输入框) Org(人员组织选择)Radio(单选按钮)Select(选择框)Textarea(多行输入) Textfield(文本输入框) Syntax var field = this.form.getField(name); Parameters name String 字段标识 Returns FormComponent 请查看本文档的Classes导航下的FormComponents。 Example var field = this.form.getField(\"subject\"); Source o2_core/o2/xScript/Environment.js, line 2234 static getData() &rarr; {Object} 获取业务数据 Syntax var data = this.form.getData(); See module:data Returns Object 返回表单绑定的业务数据。 Source o2_core/o2/xScript/Environment.js, line 2256 static save(callbackopt, silentopt) 保存当前表单所绑定的业务数据。 this.form.save()会触发 beforeSave和afterSave事件，因此在beforeSave和afterSave中不允许使用本方法。 Syntax this.form.save(callback, silent); Parameters callback function &lt;optional&gt; 保存后的回调 silent Boolean &lt;optional&gt; 是否静默，否提示保存成功，默认为false Example this.form.save(function(){\r //do someting\r }, true); Source o2_core/o2/xScript/Environment.js, line 2266 static close() 关闭当前表单 Example this.form.close(); Source o2_core/o2/xScript/Environment.js, line 2281 static pauseTask() 挂起当前待办 Example this.form.pauseTask(); Source o2_core/o2/xScript/Environment.js, line 2290 static resumeTask() 将待办从挂起状态恢复为正常状态 Example this.form.resumeTask(); Source o2_core/o2/xScript/Environment.js, line 2299 static verify() &rarr; {Boolean} Summary 根据表单中所有组件的校验设置和“流转校验”脚本进行校验。 Description 本校验不包括校验意见，校验路由；通常用在弹出提交界面时候的校验 Syntax this.form.verify() Returns Boolean 是否通过校验 Example if( !this.form.verify() ){\r return false;\r }\r Source o2_core/o2/xScript/Environment.js, line 2308 static process(optionopt) 对当前表单打开的流程实例进行流转。（仅流程表单中可用） 可以通过this.workContext.getControl().allowProcessing来判断当前用户是否有权限进行流转。 this.form.process()会触发 beforeSave、afterSave、beforeProcess、afterProcess事件，因此在上述事件中不允许使用本方法。 Parameters option Object &lt;optional&gt; 流程的相关数据，如果不带此参数，则弹出路由选择和意见填写框 格式如下： { &quot;routeName&quot;: &quot;&quot;, //流转到下一步要选择的路由名称 &quot;opinion&quot;: &quot;&quot;, //流转意见 &quot;callback&quot;: function(){} //流转完成后的回调方法 } Examples //不带参数，弹出路由选择和意见填写框\r this.form.process(); //带参数，流转\r this.form.process({\r \"routeName\": \"送审批\",\r \"opinion\": \"同意\",\r \"callback\": function(json){\r this.form.notice(\"process success\", \"success\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2326 static reset(optionopt) 对当前文档的待办重新设定处理人。（仅流程表单中可用） 可以通过this.workContext.getControl().allowReset来判断当前用户是否有权限重置处理人。 this.form.reset()会触发 beforeReset、afterReset事件，因此在上述事件中不允许使用本方法。 Parameters option Object &lt;optional&gt; 进行重置处理人的相关参数，如果不带此参数，弹出重置处理人对话框 格式如下： { &quot;names&quot;: &quot;&quot;, //{Array|String} 要重置给哪些身份 &quot;opinion&quot;: &quot;&quot;, //流转意见 &quot;success &quot;: function(){}, //重置成功后的回调方法 &quot;failure &quot;: function(){} //重置失败后的回调方法 } Examples //不带参数，弹出重置处理人对话框\r this.form.reset(); //带参数，直接调用后台服务重置\r this.form.reset({\r \"names\": [\"张三(综合部)\"],\r \"opinion\": \"授权处理\",\r \"success\": function(json){\r this.form.notice(\"reset success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"reset failure:\"+error, \"error\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2364 static retract(optionopt) 撤回文档操作，上一个处理人收回已经流转下去的文件。（仅流程表单中可用） 这个操作只允许上一个处理人在流转文件之后，下一个处理人未处理的时候执行。 可以通过this.workContext.getControl().allowRetract来判断当前用户是否有权限撤回。 this.form.retract()会触发 beforeRetract、afterRetract事件，因此在上述事件中不允许使用本方法。 Parameters option Object &lt;optional&gt; 进行撤回的相关参数，如果不提供option参数，则弹出撤回对话框。 格式如下： { &quot;success &quot;: function(){}, //撤回成功后的回调方法 &quot;failure &quot;: function(){} //撤回失败后的回调方法 } Examples //不带参数，则弹出撤回对话框\r this.form.retract(); //带参数，直接调用后台服务撤回\r this.form.retract({\r \"success\": function(json){\r this.form.notice(\"retract success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"retract failure: \"+error, \"error\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2406 static addSplit(optionopt) 在已拆分的工作上添加分支。（仅流程表单中可用） 可以通过this.workContext.getControl().allowAddSplit来判断当前用户是否有权限。 Parameters option Object &lt;optional&gt; 添加分支的相关参数，如果不提供option参数，则弹出添加分支对话框。 格式如下： { &quot;value&quot; : [], //splitValueList 添加的拆分值，拆分值取决于流程拆分节点的设置 &quot;trimExist&quot; : true, //排除已经存在的拆分值. &quot;success &quot;: function(){}, //执行成功后的回调方法 &quot;failure &quot;: function(){} //执行失败后的回调方法 } Examples //不带参数，则弹出添加分支对话框\r this.form.addSplit(); //带参数，直接添加分支\r this.form.addSplit({\r \"value\" : [\"开发部@kfb@U\"],\r \"trimExist\" : true,\r \"success\": function(json){\r this.form.notice(\"addSplit success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"addSplit failure: \"+error, \"error\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2445 static deleteWork(optionopt) 删除当前工作文档。（仅流程表单中可用） 可以通过this.workContext.getControl().allowDeleteWork来判断当前用户是否有权限删除文档。 Parameters option Object &lt;optional&gt; 删除相关参数，如果不提供option参数，则弹出删除对话框。 格式如下： { &quot;success &quot;: function(){}, //执行成功后的回调方法 &quot;failure &quot;: function(){} //执行失败后的回调方法 } Examples //不带参数，则弹出删除提示对话框\r this.form.deleteWork(); //带参数，直接调用服务删除\r this.form.deleteWork({\r \"success\": function(json){\r this.form.notice(\"deleteWork success\", \"success\");\r }.bind(this),\r \"failure\": function(xhr, text, error){\r //xhr--HttpRequest请求对象\r //text--HttpResponse内容文本\r //error--错误信息\r this.form.notice(\"deleteWork failure: \"+error, \"error\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2495 static confirm(type, title, text, width, height, ok, cancel) 弹出一个确认框，带确认和关闭按钮 Parameters type String 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告 title String 确认框标题栏显示文本。 text String 确认框的内容显示文本。 width Number 确认框的宽度。 height String 确认框的高度。 ok function 点击“确定”按钮后的回调函数。 cancel function 点击“取消”按钮后的回调函数。 Example this.form.confirm(\"wran\", \"删除确认\", \"您确定要删除吗？\", 300, 100,function(){\r //执行删除代码\r this.close();\r }, function(){\r this.close();\r }); Source o2_core/o2/xScript/Environment.js, line 2532 static alert(type, title, text, width, height) 弹出一个带关闭按钮的信息框 Parameters type String 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告 title String 信息框标题栏显示文本。 text String 信息框的内容显示文本。 width Number 信息框宽度。 height String 信息框的高度。 Example this.form.alert(\"wran\", \"必填提醒\", \"请填写标题！\", 300, 100); Source o2_core/o2/xScript/Environment.js, line 2573 static notice(content, typeopt, targetopt, whereopt, offsetopt, optionopt) 弹出一个提示框 Parameters content String 要显示的信息文本 type String &lt;optional&gt; 要显示的信息类型。可选值：success 成功，info :信息，error :错误， wran : 警告 target Element &lt;optional&gt; 信息框显示位置的参考DOM对象。 where Object &lt;optional&gt; 信息框显示相对于target的x轴和y轴位置。 如： {&quot;x&quot;: &quot;center&quot;, &quot;y&quot;: &quot;center&quot;} x : 　水平位置，可用“left”、“right”和“center”；可以用数组定义外部（outside）位置和内部（inside）位置，如：['right', 'inside'] y : 　垂直位置，可用“top”、“bottom”和“center”；可以用数组定义外部（outside）位置和内部（inside）位置，如：['top', 'outside']。 offset Object &lt;optional&gt; 相对位置的偏移量，允许负值。如：{&quot;x&quot;: 10, &quot;y&quot;: -10} option Object &lt;optional&gt; 其他选项。如： { delayClose: 5000 } 在5秒后关闭 Example this.form.notice(\"this is my information\", \"info\"); Source o2_core/o2/xScript/Environment.js, line 2588 static addEvent(type, event) 给表单添加事件。 Parameters type String 事件名称，参考本API Classer-&gt;FormComponents-&gt;Form的事件 event function 事件方法。 Example this.form.addEvent(\"load\", function(){\r this.form.notice(\"表单载入完成\", \"success\");\r }.bind(this)); Source o2_core/o2/xScript/Environment.js, line 2609 static print(applicationopt, formopt) 用一个新的浏览器窗口来打开当前文档，用于打印。（仅流程表单中可用） 如不指定表单，则使用表单设计中指定的打印表单。 Parameters application String &lt;optional&gt; 指定表单所在的流程应用ID或名称。省略此参数表示当前应用。 form String &lt;optional&gt; 指定表单ID或名称。 Examples //在新窗口中使用当前表单中配置的打印表单打开当前文档\r this.form.print(); //在新窗口中使用“订单打印表单”表单打开当前文档\r this.form.print(\"订单打印表单\"); //在新窗口中使用“订单管理”应用中的“订单打印表单”表单打开当前文档\r this.form.print(\"订单管理\", \"订单打印表单\"); Source o2_core/o2/xScript/Environment.js, line 2621 static openWindow(applicationopt, formopt) 同print方法。（仅流程表单中可用） Parameters application String &lt;optional&gt; 指定表单所在的流程应用ID或名称。省略此参数表示当前应用。 form String &lt;optional&gt; 指定表单ID或名称。 See this.form.print() Example this.form.openWindow(); Source o2_core/o2/xScript/Environment.js, line 2647 static openWork(workIdopt, workCompletedIdopt, titleopt) 打开一个在流转或已完成的流程实例。 Parameters workId String &lt;optional&gt; 在流转的流程实例ID。workId和workCompletedId两个参数必须提供其中一个 workCompletedId String &lt;optional&gt; 已完成的流程实例ID。 title String &lt;optional&gt; 手机端打开时的窗口标题。 Example this.form.openWork(id, \"\", \"work title\"); Source o2_core/o2/xScript/Environment.js, line 2666 static openJob(id, choiceopt) 使用流程的jobId打开工作。 Parameters id String 流程的jobId，如果流程拆分后，有多个流程实例（workId会有多个），但jobId是唯一的。 choice Boolean &lt;optional&gt; 如果有多个流程实例，是否弹出界面选择。如果传入false,则直接打开第一个工作。 Example this.form.openJob(jobId, true); Source o2_core/o2/xScript/Environment.js, line 2684 static openDocument(id, titleopt, optionsopt) 打开一个内容管理文档。 Parameters id String 内容管理文档实例的ID。 title Boolean &lt;optional&gt; 手机APP端打开时的窗口标题。 options Object &lt;optional&gt; 其他参数，内容如下 { \"readonly\": true, //是否以只读方式打开，默认为true \"forceFormId\": \"xxxxxx\", //不管编辑还是阅读都用此表单id打开，优先使用。6.0版本之前使用 printFormId。 \"readFormId\": \"xxxxxx\", //强制的阅读表单id，优先于表单的readFormId。6.0版本之前使用 formId。 \"editFormId\": \"xxxxxx\", //强制的编辑表单id，优先于表单的formId。6.0版本之前使用 formEditId。 \"saveOnClose\" : true, //关闭的时候是否自动保存 \"onPostPublish\" : function( documentData ){ //发布前执行方法，但数据已经准备好 //documentData 为文档数据 }, \"onAfterPublish\" : function( form, documentData ){ //发布后执行的方法 //form为内容管理Form对象，documentData 为文档数据 }, \"onPostDelete\" : function(){ //删除文档后执行的方法 } } Example this.form.openDocument(id, \"document title\"); Source o2_core/o2/xScript/Environment.js, line 2791 static openPortal(portal, pageopt, paropt) 打开一个门户页面。 Parameters portal String 要打开的门户应用名称、别名或ID。 page String &lt;optional&gt; 要打开的页面名称、别名或ID。如果忽略，则打开门户的默认首页 par Object &lt;optional&gt; 打开页面可以传入参数。在被打开的页面中，可以通过脚本this.page.parameters访问到此参数。 Example this.form.openPortal(id, \"\", {\"type\": \"my type\"}); Source o2_core/o2/xScript/Environment.js, line 2822 static openCMS(name) 打开一个内容管理栏目（应用）。 Parameters name String 内容管理栏目的名称、别名或ID。 Example this.form.openCMS(\"通知公告\"); Source o2_core/o2/xScript/Environment.js, line 2858 static openProcess(name) 打开一个流程应用。 Parameters name String 流程应用的名称、别名或ID。 Example this.form.openProcess(\"财务审批\"); Source o2_core/o2/xScript/Environment.js, line 2877 static openApplication(name, optionsopt) 打开任意一个component应用。 Parameters name String 要打开的component的名称。component对应的名称可以在“控制面板-系统设置-界面设置-模块部署”中找到（即“组件路径”）。 options Object &lt;optional&gt; 打开的component的相关参数 Examples //打开会议管理\r this.form.openApplication(\"Meeting\"); //打开一个流转中的流程实例。与 this.form.openWork(id, \"\", \"work title\");效果相同\r this.form.openApplication(\"process.Work\", {\r \"workId\": id, //流程实例ID\r \"width\": \"1200\", //宽度\r \"height\": \"800\", //高度\r \"docTitle\": \"work title\", //APP端窗口标题\r \"appId\": \"process.Work\"+id //给新打开的component实例一个唯一名称\r }); Source o2_core/o2/xScript/Environment.js, line 2896 static createDocument(columnOrOptionsopt, categoryopt, dataopt, identityopt, callbackopt, targetopt, latestopt, selectColumnEnableopt, ignoreTitleopt) 创建一条内容管理文档。 Parameters columnOrOptions String | Object &lt;optional&gt; 如果不传参数，则弹出范围为平台所有栏目的选择界面。 当使用String时为内容管理应用（栏目）的名称、别名或ID。 当使用Object时，本参数后面的参数省略，传入如下格式的内容: { \"column\" : column, //（string）可选，内容管理应用（栏目）的名称、别名或ID \"category\" : category, //（string）可选，要创建的文档所属的分类的名称、别名或ID \"data\" : data, //（json object）可选，创建文档时默认的业务数据 \"identity\" : identity, //（string）可选，创建文档所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。 \"callback\" : callback, //（funcation）可选，文档创建后的回调函数。 \"target\" : target, //（boolean）可选，为true时，在当前页面打开创建的文档；否则打开新窗口。默认false。 \"latest\" : latest, //（boolean）可选，为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。 \"selectColumnEnable\" : selectColumnEnable, //（boolean）可选，是否可以选择应用和分类进行创建文档。有category参数时为默认false,否则默认为true。 \"ignoreTitle\" : ignoreTitle //（boolean）可选，值为false时，创建的时候需要强制填写标题，默认为false。 } category String &lt;optional&gt; 要创建的文档所属的分类的名称、别名或ID data Object &lt;optional&gt; 创建文档时默认的业务数据 identity String &lt;optional&gt; 可选，创建文档所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。 callback function &lt;optional&gt; 文档创建后的回调函数 target Boolean &lt;optional&gt; 为true时，在当前页面打开创建的文档；否则打开新窗口。默认false latest Boolean &lt;optional&gt; 为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。 selectColumnEnable Boolean &lt;optional&gt; 为true时，如果当前用户已经创建了此分类的文档，并且没有发布过，直接调用此文档为新文档；否则创建一个新文档。默认true。 ignoreTitle Boolean &lt;optional&gt; 值为false时，创建的时候需要强制填写标题，默认为false。 Examples //启动一个通知公告\r this.form.createDocument(\"\", \"通知公告\"); //启动一个通知公告，标题为：关于XX的通知，启动后提示\r this.form.createDocument(\"\", \"通知公告\", {\"subject\": \"关于XX的通知\"}, function(json){\r this.form.notice(\"创建成功!\", \"success\");\r }.bind(this)); //启动一个通知公告，标题为：关于XX的通知，启动后提示\r this.form.createDocument({\r category : \"通知公告\",\r data : {\"subject\": \"关于XX的通知\"},\r callback : function(json){\r this.form.notice(\"创建成功!\", \"success\");\r }.bind(this)\r }); Source o2_core/o2/xScript/Environment.js, line 2918 static startProcess(app, process, dataopt, identityopt, callbackopt, targetopt, latestopt) 启动一个流程实例。 Parameters app String 流程应用的名称、别名或ID。 process String 要启动的流程的名称、别名或ID。 data Object &lt;optional&gt; 流程启动时默认的业务数据。 identity String &lt;optional&gt; 流程启动所使用的身份。如果此参数为空，且当前人有多个身份的情况下，会弹出身份选择对话框；否则使用默认身份。 callback function &lt;optional&gt; 流程启动后的回调函数。 target Boolean &lt;optional&gt; 为true时，在当前页面打开启动的流程实例；否则打开新窗口。默认false。 latest Boolean &lt;optional&gt; 为true时，如果当前用户已经创建了此流程的实例，并且没有流转过，直接调用此实例为新流程实例；否则创建一个新实例。默认false。 Examples //启动一个发文管理实例\r this.form.startProcess(\"公文管理\", \"发文管理\"); //启动一个发文管理实例，标题为：my file title，启动后提示\r this.form.startProcess(\"公文管理\", \"发文管理\", {\"title\": \"my file title\"}, function(json){\r this.form.notice(\"create file success!\", \"success\");\r }); Source o2_core/o2/xScript/Environment.js, line 3011 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-data.html":{"url":"module-data.html","title":"data","kind":"Module","body":" O2OA WebAPI: data | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag M[property]FaddFsave Module data data对象是流程平台中，流程实例的业务数据；以及内容管理平台中，文档实例的业务数据。 这些数据一般情况下是通过您创建的表单收集而来的，也可以通过脚本进行创建和增删改查操作。 data对象基本上是一个JSON对象，您可以用访问JSON对象的方法访问data对象的所有数据，但增加和删除数据时略有不同。 Example //您可以在表单或流程的各个嵌入脚本中，通过this来获取当前实例的业务数据，如下：\rvar data = this.data; Source o2_core/o2/xScript/Environment.js, line 29 Members [property]String|Number 访问或修改data对象的数据。 data数据用于存储表单获取的数据，所有属性都是动态的，其格式和访问方式都和JSON类似。 在表单脚本中使用data对象，实现了data和表单可编辑元素的双向绑定。 改变data对象，会自动更新表单元素，修改表单可编辑元素，也会自动修改data对象。 Type String | Number Examples var value = this.data.subject; //获取名为subject的数据值\r\r//将subject的值修改为'123'。\r//需要注意的是，用这种方式创建新字段，必须要在当前表单上有一个名为‘subject’的字段组件。\r//如果表单上没有该组件，可以使用this.data.add('subject','123',true)。给已有字段赋值则没有这个限制。\rthis.data.subject = '123'; \r获取流程文档中的数据网格的值：\r如有以下数据网格：\r \r其数据网格设计如下(数据网格id为：datagrid)：\r \r //获取流程文档中的数据网格的值\rvar data = this.data.datagrid;\r\r//获取到的data值格式如下：\r{\r \"data\": [\r {\r \"amountCol\": { \"amount\": \"12000\" },\r \"countCol\": { \"number\": \"10\" },\r \"nameCol\": { \"name\": \"手机\" },\r \"priceCol\": { \"price\": \"1200\" }\r },\r {\r \"amountCol\": { \"amount\": \"15000\" },\r \"countCol\": { \"number\": \"5\" },\r \"nameCol\": { \"name\": \"电脑\" },\r \"priceCol\": { \"price\": \"3000\" }\r }\r ],\r \"total\": {\r \"amountCol\": \"27000\",\r \"countCol\": \"15\"\r }\r}\r\r\r//获取到数据网格中的其他数据：\r\r//获取数据网格中的第一条数据\rvar data = this.data.datagrid.data[0];\r\r//获取数据网格中的第一条数据的 nameCol 列的值\rvar data = this.data.datagrid.data[0].nameCol.name;\r\r//获取数据网格中的 amountCol 列的总计值\rvar data = this.data.datagrid.total.amountCol; \r修改数据网格中的数据\r经过本样例修改后，数据网格将变为：\r \r //修改数据网格中的第一条数据的 nameCol 列的值\rthis.data.datagrid.data[0].nameCol.name='平板电脑'; Source o2_core/o2/xScript/Environment.js, line 41 Methods add(key, value, overwriteopt) &rarr; {String|Number|Array|JsonObject} 为data对象添加一个数据节点。 Syntax var newData = this.data.add(key, value, overwrite); Parameters key String | Number 要添加的新的数据节点名称或数组索引号。 value String | Number | Array | JsonObject 新的数据节点的值。 overwrite Boolean &lt;optional&gt; 如果要添加的节点已经存在，是否覆盖。默认为 false。 Returns String Number Array JsonObject 新添加的数据节点或原有的同名节点。 Examples //为data添加一个名为\"remark\"值为\"I am remark\"的数据\rthis.data.add(\"remark\", \"I am remark\"); //为data添加一个名为\"person\"的Object对象数据\rvar person = this.data.add(\"person\", {});\rperson.add(\"name\", \"Tom\");\rperson.add(\"age\", 23);\r\r//或者可以这样\rvar person = this.data.add(\"person\", {name: \"Tom\", \"age\": \"23\"}); //为data添加一个名为\"orders\"的数组对象数据\rvar orders = this.data.add(\"orders\", []);\rorders.add({name: \"phone\", count: 5});\rorders.add({name: \"computer\", count: 10});\rorders[0].add(\"count\", 10, true); //将第一条数据的count修改为10\r\r//或者可以这样\rvar orders = this.data.add(\"orders\", [\r {name: \"phone\", count: 5},\r {name: \"computer\", count: 10}\r]);\r//将第一条数据修改为name为mobile; count为10\rorders.add(0, {name: \"mobile\", count: 10}, true); Source o2_core/o2/xScript/Environment.js, line 112 static save(callbackopt) 保存data对象。不触发事件 Syntax this.data.save(callback); Parameters callback function &lt;optional&gt; 保存成功后的回调函数。 Example this.data.save(function(json){\r this.form.notice(\"save success!\", \"success\")\r}); Source o2_core/o2/xScript/Environment.js, line 150 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-workContext.html":{"url":"module-workContext.html","title":"workContext","kind":"Module","body":" O2OA WebAPI: workContext | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetWorkFgetActivityFgetTaskFgetTaskListFgetTaskListByJobFgetTaskCompletedListFgetTaskCompletedListByJobFgetReadListFgetReadListByJobFgetReadCompletedListFgetReadCompletedListByJobFgetControlFgetWorkLogListFgetRecordListFgetAttachmentListFgetRouteListFsetTitle Module workContext 您可以通过workContext获取和流程相关的流程实例对象数据。 Usable Range Process Syntax //您可以在表单或流程的各个嵌入脚本中，通过this来获取当前流程实例数据，如下：\rvar context = this.workContext; Source o2_core/o2/xScript/Environment.js, line 182 Methods static getWork() &rarr; {Work|WorkCompleted} 获取当前流程实例对象：work对象或workCompleted对象。 Syntax var work = this.workContext.getWork(); Returns Work WorkCompleted 流程实例对象；如果流程已结束，返回已结束的流程实例对象. Work对象: { \t\"id\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//工作 \t\"title\": \"xx7月北京出差报销审批\",\t\t//标题 \t\"startTime\": \"2018-09-07 14:03:22\",\t\t//工作开始时间 \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"creatorPerson\": \"xx@huqi@P\",\t\t//创建人，可能为空，如果由系统创建. \t\"creatorIdentity\": \"xx@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity,可能为空,如果由系统创建. \t\"creatorUnit\": \"xx@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织,可能为空,如果由系统创建。 \t\"creatorUnitLevelName\": \"浙江兰德纵横/开发部\",\t\t//创建人组织层级名. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用ID \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//当前活动ID. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityToken\": \" \",\t\t//活动的标识号，每进入一次活动将重新生成一次 \t\"activityArrivedTime\": \"2018-09-27 22:49:21\",\t\t//活动到达时间 \t\"serial\": \" \",\t\t//编号 \t\"dataChanged\": true,\t\t//当前工作是否经过保存修改的操作,用于判断是否是默认生成的未经修改的. \t\"workThroughManual\": true,\t\t//是否已经经过人工节点,用于判断是否是草稿.在到达环节进行判断. \t\"workCreateType\": \" \",\t\t//工作创建类型,surface,assgin \t\"workStatus\": \" \",//可选值:start,processing,hanging,\t\t//工作状态 \t\"beforeExecuted\": true,\t\t//是否已经通过执行前 \t\"manualTaskIdentityList\": [ \t\t\"张三@db3b2766-93a1-4058-b522-0edb922bd84f@I\" \t],\t\t//预期的处理人 \t\"manualTaskIdentityText\": \"张三\",\t\t//当前处理人身份合并文本,用','分割,超长截断,此字段仅用于显示当前工作的处理人,不索引. \t\"splitting\": true,\t\t//是否是拆分中的工作 \t\"splitToken\": \" \",\t\t//拆分工作令牌 \t\"splitTokenList\": [ \t\t\" \" \t],\t\t//拆分工作产生的Token \t\"splitValue\": \"xxxxxxxxxxxxxx\",\t\t//拆分值 \t\"form\": \"db3b2766-93a1-4058-b522-0edb922bd84f\",\t\t//使用表单 \t\"destinationRoute\": \" \",\t\t//到达使用的路由 \t\"destinationRouteName\": \" \",\t\t//到达使用的路由 \t\"destinationActivityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//当前活动类型 \t\"destinationActivity\": \" \",\t\t//目标活动的ID \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"embedTargetWork\": \" \",\t\t//Embed活动生成的WorkId，用于在embed生成targetWork之后在inquire环节进行推动。 \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } WorkCompleted对象: { \t\"id\": \"be0195f1-f2e2-4eac-911c-99897a43ff8f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//工作 \t\"title\": \"xx7月北京出差报销审批\",\t\t//标题 \t\"startTime\": \"2018-09-19 16:14:16\",\t\t//工作开始时间 \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"completedTime\": \"2018-09-19 16:15:28\",\t\t//工作开始时间 \t\"completedTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用.由于是自动计算所以允许空 \t\"creatorPerson\": \"xx@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"xx@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"xx@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"creatorUnitLevelName\": \"浙江兰德纵横/开发部\",\t\t//创建人组织层级名. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用ID \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID \t\"processName\": \"报销审批流程\",\t\t//流程名称 \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"form\": \"320be1ca-ee49-478f-a751-f65ab67cf818\",\t\t//使用表单ID \t\"work\": \" \",\t\t//Work Id. \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"expired\": true,\t\t//是否超时. \t\"duration\": 1,\t\t//工作时长(分钟数). \t\"allowRollback\": true,\t\t//完成后是否允许回滚. \t\"activity\": \" \",\t\t//结束节点的活动id. \t\"activityName\": \" \",\t\t//结束节点的活动名称. \t\"activityAlias\": \" \",\t\t//结束节点的活动别名. \t\"activityDescription\": \" \",\t\t//结束节点的活动说明. \t\"merged\": true,\t\t//合并数据 \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 192 static getActivity() &rarr; {Activity|Null} 获取当前流程实例所在的活动节点对象：activity对象。 Syntax var activity = this.workContext.getActivity(); Returns Activity Null 当前流程实例所在的活动节点对象，如果当前流程实例已流转完成，则返回null. { \"id\": \"801087c5-a4e6-4b91-bf4d-a81cdaa04471\", //节点ID \"name\": \"办理\", //节点名称 \"description\": \"\", //节点描述 \"alias\": \"\", //节点别名 \"resetRange\": \"department\", //重置处理人范围 \"resetCount\": 0, //重置处理人数字 \"allowReset\": true, //是否允许重置 \"manualMode\": \"single\" //处理方式 单人single, 并行parallel, 串行queue, grab抢办 } Source o2_core/o2/xScript/Environment.js, line 203 static getTask() &rarr; {Task|Null} Summary 获取当前流程与当前用户相关的待办对象：task对象。 Description 当前流程实例正在流转中，并且当前用户有待办，则返回当前用户的待办对象，否则返回null。 Syntax var task = this.workContext.getTask(); Returns Task Null 当前用户的待办任务对象：task。当前用户没有对此流程实例的待办时，或流程实例已经流转结束，返回null. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"empowerFromIdentity\": \" \",\t\t//授权自Identity \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人部门 \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"expired\": true,\t\t//是否已经超时. \t\"urgeTime\": \"2021-02-23 17:06:17\",\t\t//催办时间. \t\"urged\": true,\t\t//是否已经催办过. \t\"routeList\": [ \t\t\"89b58fe0-6dcb-4fe7-8c2e-3f77204df6d4\" \t\t\"f3105b7a-2929-4682-aab8-15fef5ea0f23\" \t],\t\t//当前活动可供选择的路由. \t\"routeNameList\": [ \t\t\"退回申请人\" \t\t\"送财务部门复审\" \t],\t\t//当前活动可供选择的路由名称. \t\"routeOpinionList\": [ \t\t\"\" \t\t\"\" \t],\t\t//当前活动可供选择的路由对应的默认意见. \t\"routeDecisionOpinionList\": [ \t\t\" \" \t],\t\t//决策性意见列表,使用#分割. \t\"routeName\": \" \",\t\t//选择的路由名称. \t\"opinion\": \" \",\t\t//处理意见. \t\"modified\": true,\t\t//是否在前台保存过数据. \t\"viewed\": true,\t\t//是否查看过. \t\"allowRapid\": true,\t\t//允许快速处理. \t\"mediaOpinion\": \" \",\t\t//多媒体意见. \t\"first\": true,\t\t//是否是第一条待办,用于却别待办和草稿. \t\"properties\": { \t\t\"serialVersionUID\": 1, \t\t\"prevTaskIdentity\": \" \",\t\t//上一人工环节处理人 \t\t\"prevTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//上一人工环节处理人列表 \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"prevTaskList\": [ \t\t\t{ \t\t\t\t\"routeName\": \" \", \t\t\t\t\"unit\": \" \", \t\t\t\t\"identity\": \" \", \t\t\t\t\"person\": \" \", \t\t\t\t\"opinion\": \" \", \t\t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"serialVersionUID\": 1 \t\t\t} \t\t],\t\t//上一人工环节待办对象列表 \t\t\"prevTask\": { \t\t\t\"routeName\": \" \", \t\t\t\"unit\": \" \", \t\t\t\"identity\": \" \", \t\t\t\"person\": \" \", \t\t\t\"opinion\": \" \", \t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\"serialVersionUID\": 1 \t\t},\t\t//上一人工环节最近待办对象 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"series\": \" \",\t\t//操作序列号,同次操作将会有相同的序列号. \t\"workCreateType\": \" \",\t\t//工作创建类型,surface,assign \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 223 static getTaskList(callbackopt, erroropt) &rarr; {Array.&lt;Task>} 获取当前流程实例的所有待办对象。如果流程实例已流转完成，则返回一个空数组。 Syntax //本样例以同步执行\rvar taskList = this.workContext.getTaskList(); //本样例以异步执行\rthis.workContext.getTaskList( function(taskList){\r //taskList 为待办数组\r}); Parameters callback function &lt;optional&gt; 正确获取待办数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取待办数组出错时的回调。 Returns Array.&lt;Task> 待办任务列表. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"empowerFromIdentity\": \" \",\t\t//授权自Identity \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人部门 \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"expired\": true,\t\t//是否已经超时. \t\"urgeTime\": \"2021-02-23 17:06:17\",\t\t//催办时间. \t\"urged\": true,\t\t//是否已经催办过. \t\"routeList\": [ \t\t\"89b58fe0-6dcb-4fe7-8c2e-3f77204df6d4\" \t\t\"f3105b7a-2929-4682-aab8-15fef5ea0f23\" \t],\t\t//当前活动可供选择的路由. \t\"routeNameList\": [ \t\t\"退回申请人\" \t\t\"送财务部门复审\" \t],\t\t//当前活动可供选择的路由名称. \t\"routeOpinionList\": [ \t\t\"\" \t\t\"\" \t],\t\t//当前活动可供选择的路由对应的默认意见. \t\"routeDecisionOpinionList\": [ \t\t\" \" \t],\t\t//决策性意见列表,使用#分割. \t\"routeName\": \" \",\t\t//选择的路由名称. \t\"opinion\": \" \",\t\t//处理意见. \t\"modified\": true,\t\t//是否在前台保存过数据. \t\"viewed\": true,\t\t//是否查看过. \t\"allowRapid\": true,\t\t//允许快速处理. \t\"mediaOpinion\": \" \",\t\t//多媒体意见. \t\"first\": true,\t\t//是否是第一条待办,用于却别待办和草稿. \t\"properties\": { \t\t\"serialVersionUID\": 1, \t\t\"prevTaskIdentity\": \" \",\t\t//上一人工环节处理人 \t\t\"prevTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//上一人工环节处理人列表 \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"prevTaskList\": [ \t\t\t{ \t\t\t\t\"routeName\": \" \", \t\t\t\t\"unit\": \" \", \t\t\t\t\"identity\": \" \", \t\t\t\t\"person\": \" \", \t\t\t\t\"opinion\": \" \", \t\t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"serialVersionUID\": 1 \t\t\t} \t\t],\t\t//上一人工环节待办对象列表 \t\t\"prevTask\": { \t\t\t\"routeName\": \" \", \t\t\t\"unit\": \" \", \t\t\t\"identity\": \" \", \t\t\t\"person\": \" \", \t\t\t\"opinion\": \" \", \t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\"serialVersionUID\": 1 \t\t},\t\t//上一人工环节最近待办对象 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"series\": \" \",\t\t//操作序列号,同次操作将会有相同的序列号. \t\"workCreateType\": \" \",\t\t//工作创建类型,surface,assign \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 235 static getTaskListByJob(callbackopt, erroropt) &rarr; {Array.&lt;Task>} 根据当前工作的job获取当前流程实例的所有待办对象。如果流程实例已流转完成，则返回一个空数组。 Syntax //本样例以同步执行\rvar taskList = this.workContext.getTaskListByJob(); //本样例以异步执行\rthis.workContext.getTaskListByJob( function(taskList){\r //taskList 为待办数组\r}); Parameters callback function &lt;optional&gt; 正确获取待办数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取待办数组出错时的回调。 Returns Array.&lt;Task> 待办任务列表. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"empowerFromIdentity\": \" \",\t\t//授权自Identity \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人部门 \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"expired\": true,\t\t//是否已经超时. \t\"urgeTime\": \"2021-02-23 17:06:17\",\t\t//催办时间. \t\"urged\": true,\t\t//是否已经催办过. \t\"routeList\": [ \t\t\"89b58fe0-6dcb-4fe7-8c2e-3f77204df6d4\" \t\t\"f3105b7a-2929-4682-aab8-15fef5ea0f23\" \t],\t\t//当前活动可供选择的路由. \t\"routeNameList\": [ \t\t\"退回申请人\" \t\t\"送财务部门复审\" \t],\t\t//当前活动可供选择的路由名称. \t\"routeOpinionList\": [ \t\t\"\" \t\t\"\" \t],\t\t//当前活动可供选择的路由对应的默认意见. \t\"routeDecisionOpinionList\": [ \t\t\" \" \t],\t\t//决策性意见列表,使用#分割. \t\"routeName\": \" \",\t\t//选择的路由名称. \t\"opinion\": \" \",\t\t//处理意见. \t\"modified\": true,\t\t//是否在前台保存过数据. \t\"viewed\": true,\t\t//是否查看过. \t\"allowRapid\": true,\t\t//允许快速处理. \t\"mediaOpinion\": \" \",\t\t//多媒体意见. \t\"first\": true,\t\t//是否是第一条待办,用于却别待办和草稿. \t\"properties\": { \t\t\"serialVersionUID\": 1, \t\t\"prevTaskIdentity\": \" \",\t\t//上一人工环节处理人 \t\t\"prevTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//上一人工环节处理人列表 \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"prevTaskList\": [ \t\t\t{ \t\t\t\t\"routeName\": \" \", \t\t\t\t\"unit\": \" \", \t\t\t\t\"identity\": \" \", \t\t\t\t\"person\": \" \", \t\t\t\t\"opinion\": \" \", \t\t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"serialVersionUID\": 1 \t\t\t} \t\t],\t\t//上一人工环节待办对象列表 \t\t\"prevTask\": { \t\t\t\"routeName\": \" \", \t\t\t\"unit\": \" \", \t\t\t\"identity\": \" \", \t\t\t\"person\": \" \", \t\t\t\"opinion\": \" \", \t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\"serialVersionUID\": 1 \t\t},\t\t//上一人工环节最近待办对象 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"series\": \" \",\t\t//操作序列号,同次操作将会有相同的序列号. \t\"workCreateType\": \" \",\t\t//工作创建类型,surface,assign \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 262 static getTaskCompletedList(callbackopt, erroropt) &rarr; {Array.&lt;TaskCompleted>} 获取当前流程实例的所有已办对象。如果流程实例没有任何人处理过，则返回一个空数组。 Syntax //本样例以同步执行\rvar taskCompletedList = this.workContext.getTaskCompletedList(); //本样例以异步执行\rthis.workContext.getTaskCompletedList( function(taskCompletedList){\r //taskCompletedList 为已办数组\r}); Parameters callback function &lt;optional&gt; 正确获取已办数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取已办数组出错时的回调。 Returns Array.&lt;TaskCompleted> 已办任务列表. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//待办.已办的开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"completedTime\": \"2021-02-23 17:06:17\",\t\t//task转成taskCompleted的完成时间,也就是任务的完成时间. \t\"completedTimeMonth\": \" \",\t\t//task转成taskCompleted的完成月份,也就是任务的完成时间,用于filter过滤. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"workCompleted\": \" \",\t\t//WorkCompleted ID. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"empowerToIdentity\": \" \",\t\t//授权给谁处理,在processType=empower时记录授权对象 \t\"empowerFromIdentity\": \" \",\t\t//授权自Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在部门. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"routeName\": \" \",\t\t//选择的路由名称. \t\"opinion\": \" \",\t\t//处理意见. \t\"task\": \" \",\t\t//Task ID. \t\"expired\": true,\t\t//是否超时. \t\"duration\": 1,\t\t//工作时长(分钟数). \t\"processingType\": \" \",\t\t//流程流转类型 \t\"retractTime\": \"2021-02-23 17:06:17\",\t\t//retract时间. \t\"latest\": true,\t\t//同一Job中同一用户是否是最新的,多人可以有多条已办,页面显示的时候可以通过此标记仅显示一条最新的. \t\"mediaOpinion\": \" \",\t\t//多媒体意见. \t\"pressCount\": 1,\t\t//提醒次数 \t\"pressTime\": \"2021-02-23 17:06:17\",\t\t//提醒办理时间. \t\"pressActivityToken\": \" \",\t\t//提醒办理环节. \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"joinInquire\": true,\t\t//已办是否参与路由. \t\"properties\": { \t\t\"prevTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//从task带过来的上一处理人 \t\t\"nextTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//后续处理人 \t\t\"prevTaskList\": [ \t\t\t{ \t\t\t\t\"routeName\": \" \", \t\t\t\t\"unit\": \" \", \t\t\t\t\"identity\": \" \", \t\t\t\t\"person\": \" \", \t\t\t\t\"opinion\": \" \", \t\t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"serialVersionUID\": 1 \t\t\t} \t\t],\t\t//上一人工环节待办对象列表 \t\t\"prevTask\": { \t\t\t\"routeName\": \" \", \t\t\t\"unit\": \" \", \t\t\t\"identity\": \" \", \t\t\t\"person\": \" \", \t\t\t\"opinion\": \" \", \t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\"serialVersionUID\": 1 \t\t},\t\t//上一人工环节最近待办对象 \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 290 static getTaskCompletedListByJob(callbackopt, erroropt) &rarr; {Array.&lt;TaskCompleted>} 根据当前工作的job获取当前流程实例的所有已办对象。如果流程实例没有任何人处理过，则返回一个空数组。 Syntax //本样例以同步执行\rvar taskCompletedList = this.workContext.getTaskCompletedListByJob(); //本样例以异步执行\rthis.workContext.getTaskCompletedListByJob( function(taskCompletedList){\r //taskCompletedList 为已办数组\r}); Parameters callback function &lt;optional&gt; 正确获取已办数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取已办数组出错时的回调。 Returns Array.&lt;TaskCompleted> 已办任务列表. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//待办.已办的开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"completedTime\": \"2021-02-23 17:06:17\",\t\t//task转成taskCompleted的完成时间,也就是任务的完成时间. \t\"completedTimeMonth\": \" \",\t\t//task转成taskCompleted的完成月份,也就是任务的完成时间,用于filter过滤. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"workCompleted\": \" \",\t\t//WorkCompleted ID. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"empowerToIdentity\": \" \",\t\t//授权给谁处理,在processType=empower时记录授权对象 \t\"empowerFromIdentity\": \" \",\t\t//授权自Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在部门. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"expireTime\": \"2021-02-23 17:06:17\",\t\t//任务截止时间. \t\"routeName\": \" \",\t\t//选择的路由名称. \t\"opinion\": \" \",\t\t//处理意见. \t\"task\": \" \",\t\t//Task ID. \t\"expired\": true,\t\t//是否超时. \t\"duration\": 1,\t\t//工作时长(分钟数). \t\"processingType\": \" \",\t\t//流程流转类型 \t\"retractTime\": \"2021-02-23 17:06:17\",\t\t//retract时间. \t\"latest\": true,\t\t//同一Job中同一用户是否是最新的,多人可以有多条已办,页面显示的时候可以通过此标记仅显示一条最新的. \t\"mediaOpinion\": \" \",\t\t//多媒体意见. \t\"pressCount\": 1,\t\t//提醒次数 \t\"pressTime\": \"2021-02-23 17:06:17\",\t\t//提醒办理时间. \t\"pressActivityToken\": \" \",\t\t//提醒办理环节. \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"joinInquire\": true,\t\t//已办是否参与路由. \t\"properties\": { \t\t\"prevTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//从task带过来的上一处理人 \t\t\"nextTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//后续处理人 \t\t\"prevTaskList\": [ \t\t\t{ \t\t\t\t\"routeName\": \" \", \t\t\t\t\"unit\": \" \", \t\t\t\t\"identity\": \" \", \t\t\t\t\"person\": \" \", \t\t\t\t\"opinion\": \" \", \t\t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\t\"serialVersionUID\": 1 \t\t\t} \t\t],\t\t//上一人工环节待办对象列表 \t\t\"prevTask\": { \t\t\t\"routeName\": \" \", \t\t\t\"unit\": \" \", \t\t\t\"identity\": \" \", \t\t\t\"person\": \" \", \t\t\t\"opinion\": \" \", \t\t\t\"startTime\": \"2021-02-23 17:06:17\", \t\t\t\"completedTime\": \"2021-02-23 17:06:17\", \t\t\t\"serialVersionUID\": 1 \t\t},\t\t//上一人工环节最近待办对象 \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 318 static getReadList(callbackopt, erroropt) &rarr; {Array.&lt;Read>} Summary 获取当前流程实例的所有待阅对象数组。如果流程实例无待阅，则返回一个空数组。 Syntax //本样例以同步执行\rvar readList = this.workContext.getReadList(); //本样例以异步执行\rthis.workContext.getReadList( function(readList){\r //readList 为待阅数组\r}); Parameters callback function &lt;optional&gt; 正确获取待阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取待阅数组出错时的回调。 Returns Array.&lt;Read> 当前流程实例的所有待阅对象数组. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"workCompleted\": \" \",\t\t//完成工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"opinion\": \" \",\t\t//处理意见. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID,针对已完成工作添加待阅字段为空. \t\"activityName\": \"部门领导审核\",\t\t//活动名称,针对已完成工作添加待阅字段为空. \t\"activityAlias\": \" \",\t\t//活动别名,针对已完成工作添加待阅字段为空. \t\"activityDescription\": \" \",\t\t//活动说明,针对已完成工作添加待阅字段为空. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型,针对已完成工作添加待阅字段为空. \t\"activityToken\": \" \",\t\t//活动Token,针对已完成工作添加待阅字段为空. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"viewed\": true,\t\t//是否查看过. \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"properties\": { \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 346 static getReadListByJob(callbackopt, erroropt) &rarr; {Array.&lt;Read>} Summary 根据当前工作的job获取当前流程实例的所有待阅对象。如果流程实例无待阅，则返回一个空数组。 Syntax //本样例以同步执行\rvar readList = this.workContext.getReadListByJob(); //本样例以异步执行\rthis.workContext.getReadListByJob( function(readList){\r //readList 为待阅数组\r}); Parameters callback function &lt;optional&gt; 正确获取待阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取待阅数组出错时的回调。 Returns Array.&lt;Read> 当前流程实例的所有待阅对象数组. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"workCompleted\": \" \",\t\t//完成工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"opinion\": \" \",\t\t//处理意见. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID,针对已完成工作添加待阅字段为空. \t\"activityName\": \"部门领导审核\",\t\t//活动名称,针对已完成工作添加待阅字段为空. \t\"activityAlias\": \" \",\t\t//活动别名,针对已完成工作添加待阅字段为空. \t\"activityDescription\": \" \",\t\t//活动说明,针对已完成工作添加待阅字段为空. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型,针对已完成工作添加待阅字段为空. \t\"activityToken\": \" \",\t\t//活动Token,针对已完成工作添加待阅字段为空. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"viewed\": true,\t\t//是否查看过. \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"properties\": { \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 373 static getReadCompletedList(callbackopt, erroropt) &rarr; {Array.&lt;ReadCompleted>} Summary 获取当前流程实例的所有已阅对象。如果流程实例没有已阅，则返回一个空数组。 Syntax //本样例以同步执行\rvar readCompletedList = this.workContext.getReadCompletedList(); //本样例以异步执行\rthis.workContext.getReadCompletedList( function(readCompletedList){\r //readCompletedList 为已阅数组\r}); Parameters callback function &lt;optional&gt; 正确获取已阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取已阅数组出错时的回调。 Returns Array.&lt;ReadCompleted> 当前流程实例的所有已阅对象数组. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"workCompleted\": \" \",\t\t//工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"read\": \" \",\t\t//待阅Id. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"opinion\": \" \",\t\t//处理意见. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"completedTime\": \"2021-02-23 17:06:17\",\t\t//read转成readCompleted的完成时间,也就是任务的完成时间. \t\"completedTimeMonth\": \" \",\t\t//read转成readCompleted的完成月份,也就是任务的完成时间,用于filter过滤.. \t\"duration\": 1,\t\t//工作时长(分钟数). \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"properties\": { \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 401 static getReadCompletedListByJob(callbackopt, erroropt) &rarr; {Array.&lt;ReadCompleted>} Summary 根据当前工作的job获取当前流程实例的所有已阅对象。如果流程实例没有已阅，则返回一个空数组。 Syntax //本样例以同步执行\rvar readCompletedList = this.workContext.getReadCompletedListByJob(); //本样例以异步执行\rthis.workContext.getReadCompletedListByJob( function(readCompletedList){\r //readCompletedList 为已阅数组\r}); Parameters callback function &lt;optional&gt; 正确获取已阅数组的回调，如果有此参数，本方法以异步执行，否则同步执行 error function &lt;optional&gt; 获取已阅数组出错时的回调。 Returns Array.&lt;ReadCompleted> 当前流程实例的所有已阅对象数组. { \t\"id\": \"dd476045-7c79-44f7-9dba-f51d322de40f\",\t\t//数据库主键,自动生成. \t\"job\": \" \",\t\t//任务. \t\"work\": \"854e2c22-718e-48bb-98db-96f4b43e7ee8\",\t\t//工作ID. \t\"workCompleted\": \" \",\t\t//工作ID. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"read\": \" \",\t\t//待阅Id. \t\"title\": \"XX7月北京出差报销审批\",\t\t//标题. \t\"application\": \"1dc23336-6be6-402b-bed6-36e707a1dd17\",\t\t//应用. \t\"applicationName\": \"财务管理\",\t\t//应用名称. \t\"applicationAlias\": \"finance\",\t\t//应用别名. \t\"process\": \"2207db11-dddf-4ebd-864d-3819f3e173c6\",\t\t//流程ID. \t\"processName\": \"报销审批流程\",\t\t//流程名称. \t\"processAlias\": \" \",\t\t//流程别名. \t\"serial\": \" \",\t\t//编号 \t\"person\": \"XXX@huqi@P\",\t\t//当前处理人 \t\"identity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//当前处理人Identity \t\"unit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//当前处理人所在组织. \t\"opinion\": \" \",\t\t//处理意见. \t\"activity\": \"13d15daf-2ac5-4c1b-a669-1607a0e5ed15\",\t\t//活动ID. \t\"activityName\": \"部门领导审核\",\t\t//活动名称. \t\"activityAlias\": \" \",\t\t//活动别名. \t\"activityDescription\": \" \",\t\t//活动说明. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"creatorPerson\": \"XX@huqi@P\",\t\t//创建人 \t\"creatorIdentity\": \"XX@481c9edc-5fb5-41f1-b5c2-6ea609082cdb@I\",\t\t//创建人Identity \t\"creatorUnit\": \"XX@c448d8bb-98b8-4305-9d3f-12537723cfcc@U\",\t\t//创建人组织 \t\"startTime\": \"2018-09-27 22:49:22\",\t\t//开始时间. \t\"startTimeMonth\": \"2018-09\",\t\t//用于在Filter中分类使用. \t\"completedTime\": \"2021-02-23 17:06:17\",\t\t//read转成readCompleted的完成时间,也就是任务的完成时间. \t\"completedTimeMonth\": \" \",\t\t//read转成readCompleted的完成月份,也就是任务的完成时间,用于filter过滤.. \t\"duration\": 1,\t\t//工作时长(分钟数). \t\"currentActivityName\": \" \",\t\t//当前活动名称. \t\"properties\": { \t\t\"title\": \" \",\t\t//标题 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"stringValue01\": \" \",\t\t//业务数据String值01. \t\"stringValue02\": \" \",\t\t//业务数据String值02. \t\"stringValue03\": \" \",\t\t//业务数据String值03. \t\"stringValue04\": \" \",\t\t//业务数据String值04. \t\"stringValue05\": \" \",\t\t//业务数据String值05. \t\"stringValue06\": \" \",\t\t//业务数据String值06. \t\"stringValue07\": \" \",\t\t//业务数据String值07. \t\"stringValue08\": \" \",\t\t//业务数据String值08. \t\"stringValue09\": \" \",\t\t//业务数据String值09. \t\"stringValue10\": \" \",\t\t//业务数据String值10. \t\"booleanValue01\": true,\t\t//业务数据Boolean值01. \t\"booleanValue02\": true,\t\t//业务数据Boolean值02. \t\"doubleValue01\": 1,\t\t//业务数据Double值01. \t\"doubleValue02\": 1,\t\t//业务数据Double值02. \t\"doubleValue03\": 1,\t\t//业务数据Double值03. \t\"doubleValue04\": 1,\t\t//业务数据Double值04. \t\"doubleValue05\": 1,\t\t//业务数据Double值05. \t\"longValue01\": 1,\t\t//业务数据Long值01. \t\"longValue02\": 1,\t\t//业务数据Long值02. \t\"longValue03\": 1,\t\t//业务数据Long值03. \t\"longValue04\": 1,\t\t//业务数据Long值04. \t\"longValue05\": 1,\t\t//业务数据Long值05. \t\"dateTimeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值01. \t\"dateTimeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值02. \t\"dateTimeValue03\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值03. \t\"dateTimeValue04\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值04. \t\"dateTimeValue05\": \"2021-02-23 17:06:17\",\t\t//业务数据DateTime值05. \t\"dateValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值01. \t\"dateValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Date值02. \t\"timeValue01\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值01. \t\"timeValue02\": \"2021-02-23 17:06:17\",\t\t//业务数据Time值02. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 428 static getControl() &rarr; {WorkControl} Summary 获取当前人对流程实例的权限。 Syntax var control = this.workContext.getControl(); Returns WorkControl 流程实例权限对象. { \"allowVisit\": true, //是否允许访问 \"allowProcessing\": true, //是否允许流转 \"allowReadProcessing\": false, //是否有待阅 \"allowSave\": true, //是否允许保存业务数据 \"allowReset\": false, //是否允许重置处理人 \"allowRetract\": false, //是否允许撤回 \"allowReroute\": false, //是否允许调度 \"allowDelete\": true, //是否允许删除流程实例 \"allowRollback\": false, //是否允许流程回溯 \"allowAddSplit\": false, //是否允许增加分支 \"allowPress\": false, //是否允许催办 } Source o2_core/o2/xScript/Environment.js, line 460 static getWorkLogList() &rarr; {Array.&lt;WorkLog>} Summary 获取当前流程实例的所有流程记录(WorkLog)。 Syntax var workLogList = this.workContext.getWorkLogList(); Returns Array.&lt;WorkLog> 流程记录对象. { \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"fromActivity\": \" \",\t\t//开始活动Id \t\"fromActivityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//开始活动类型. \t\"fromActivityName\": \" \",\t\t//开始活动名称 \t\"fromActivityAlias\": \" \",\t\t//开始活动别名 \t\"fromActivityToken\": \" \",\t\t//开始节点Token \t\"fromGroup\": \" \",\t\t//开始分组 \t\"fromOpinionGroup\": \" \",\t\t//开始意见分组 \t\"fromTime\": \"2021-02-23 17:06:17\",\t\t//开始时间. \t\"arrivedActivity\": \" \",\t\t//结束活动Id，可能为空，如果是未Connected的流程记录 \t\"arrivedActivityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//结束活动类型. \t\"arrivedActivityName\": \" \",\t\t//结束活动名称. \t\"arrivedActivityAlias\": \" \",\t\t//结束活动名称. \t\"arrivedActivityToken\": \" \",\t\t//结束活动Token. \t\"arrivedGroup\": \" \",\t\t//到达分组 \t\"arrivedOpinionGroup\": \" \",\t\t//到达意见分组 \t\"arrivedTime\": \"2021-02-23 17:06:17\",\t\t//完成时间. \t\"routeName\": \" \",\t\t//到达节点使用Route Name. \t\"connected\": true,\t\t//是否已经完整填写了From和Arrived. \t\"splitting\": true \t\t//是否是拆分中的工作,用于回溯时候将值改回去。 } Source o2_core/o2/xScript/Environment.js, line 482 static getRecordList() &rarr; {Array.&lt;Record>} Summary 获取当前流程实例的所有流程记录(Record)。 Syntax var workLogList = this.workContext.getRecordList(); Returns Array.&lt;Record> 流程记录(Record)对象. { \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"application\": \" \",\t\t//应用. \t\"process\": \" \",\t\t//流程ID. \t\"job\": \" \",\t\t//任务标识 \t\"work\": \" \",\t\t//工作 \t\"workCompleted\": \" \",\t\t//已完成工作 \t\"completed\": true,\t\t//工作是否已经完成. \t\"display\": true,\t\t//是否显示. \t\"order\": 1,\t\t//显示排序. \t\"properties\": { \t\t\"nextManualList\": [ \t\t\t{ \t\t\t\t\"activity\": \" \",\t\t//活动 \t\t\t\t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型 \t\t\t\t\"activityName\": \" \",\t\t//活动名称 \t\t\t\t\"activityAlias\": \" \",\t\t//活动别名 \t\t\t\t\"activityToken\": \" \",\t\t//活动活动令牌 \t\t\t\t\"taskIdentityList\": [ \t\t\t\t\t\" \" \t\t\t\t] \t\t//待办处理人 \t\t\t} \t\t],\t\t//后续人工环节 \t\t\"nextManualTaskIdentityList\": [ \t\t\t\" \" \t\t],\t\t//后续人工环节处理人 \t\t\"empowerToPerson\": \" \",\t\t//授权给处理人 \t\t\"empowerToIdentity\": \" \",\t\t//授权给处理人的身份 \t\t\"empowerFromIdentity\": \" \",\t\t//授权自身份 \t\t\"empowerToUnit\": \" \",\t\t//授权给处理人的组织 \t\t\"routeName\": \" \",\t\t//路由名称 \t\t\"opinion\": \" \",\t\t//意见 \t\t\"mediaOpinion\": \" \",\t\t//多媒体意见 \t\t\"startTime\": \"2021-02-23 17:06:17\",\t\t//开始时间. \t\t\"elapsed\": 1,\t\t//耗时 \t\t\"fromGroup\": \" \",\t\t//活动组 \t\t\"fromOpinionGroup\": \" \",\t\t//意见组 \t\t\"serialVersionUID\": 1 \t},\t\t//属性对象存储字段. \t\"fromActivity\": \" \",\t\t//开始活动Id \t\"fromActivityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//开始活动类型. \t\"fromActivityName\": \" \",\t\t//开始活动名称 \t\"fromActivityAlias\": \" \",\t\t//开始活动别名 \t\"fromActivityToken\": \" \",\t\t//开始节点Token \t\"arrivedActivity\": \" \",\t\t//结束活动Id，可能为空，如果是未Connected的流程记录 \t\"arrivedActivityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//结束活动类型. \t\"arrivedActivityName\": \" \",\t\t//结束活动名称. \t\"arrivedActivityAlias\": \" \",\t\t//结束活动名称. \t\"arrivedActivityToken\": \" \",\t\t//结束活动Token. \t\"recordTime\": \"2021-02-23 17:06:17\",\t\t//记录时间. \t\"person\": \" \",\t\t//记录人员 \t\"identity\": \" \",\t\t//记录身份 \t\"unit\": \" \",\t\t//记录人员所在组织. \t\"type\": \" \",\t\t//类型. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 492 static getAttachmentList() &rarr; {Array.&lt;WorkAttachmentData>} Summary 获取当前流程实例的附件对象列表。 Syntax var attachmentList = this.workContext.getAttachmentList(); Returns Array.&lt;WorkAttachmentData> 附件数据. { \t\"id\": \"56c4e86f-a4c8-4cc2-a150-1a0d2c5febcb\",\t\t//数据库主键,自动生成. \t\"name\": \"133203a2-92e6-4653-9954-161b72ddb7f9.png\",\t\t//文件名称,带扩展名的文件名. \t\"extension\": \"png\",\t\t//扩展名。 \t\"storage\": \" \",\t\t//关联的存储名称. \t\"length\": 43864,\t\t//文件大小. \t\"workCreateTime\": \"2021-02-23 17:06:17\",\t\t//关联的Work创建时间，用于分类目录。 \t\"application\": \" \",\t\t//应用ID. \t\"process\": \" \",\t\t//流程ID. \t\"job\": \" \",\t\t//任务. \t\"person\": \"xx@huqi@P\",\t\t//文件所有者 \t\"lastUpdateTime\": \"2018-09-27 15:50:34\",\t\t//最后更新时间 \t\"lastUpdatePerson\": \"xx@huqi@P\",\t\t//最后更新人员 \t\"activity\": \"e31ad938-c495-45a6-8d77-b8a9b61a165b\",\t\t//活动ID. \t\"activityName\": \"申请人\",\t\t//活动名称. \t\"activityType\": \" \",//可选值:agent,begin,cancel,choice,delay,end,embed,invoke,manual,merge,message,parallel,service,split,\t\t//活动类型. \t\"activityToken\": \" \",\t\t//活动Token. \t\"completed\": true,\t\t//整个job是否已经完成. \t\"workCompleted\": \" \",\t\t//工作ID. \t\"work\": \" \",\t\t//已完成工作ID. \t\"site\": \"$mediaOpinion\",\t\t//附件框分类. \t\"type\": \"image/png\",\t\t//根据流文件判断的文件类型. \t\"text\": \" \",\t\t//文本. \t\"readIdentityList\": [ \t\t\" \" \t],\t\t//可以访问的身份. \t\"readUnitList\": [ \t\t\" \" \t],\t\t//可以访问的组织. \t\"editIdentityList\": [ \t\t\" \" \t],\t\t//可以修改的用户. \t\"editUnitList\": [ \t\t\" \" \t],\t\t//可以修改的组织. \t\"controllerIdentityList\": [ \t\t\" \" \t],\t\t//可以管理的用户. \t\"controllerUnitList\": [ \t\t\" \" \t],\t\t//可以管理的组织. \t\"deepPath\": true,\t\t//是否使用更深的路径. \t\"orderNumber\": 1,\t\t//排序号,升序排列,为空在最后 \t\"divisionList\": [ \t\t\" \" \t],\t\t//分组. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/Environment.js, line 502 static getRouteList() &rarr; {Array.&lt;String>} Summary 获取当前待办的可选路由。与task对象中的routeNameList取值相同。 Syntax var routeList = this.workContext.getRouteList(); Returns Array.&lt;String> 路由字符串数组. Source o2_core/o2/xScript/Environment.js, line 512 static setTitle(title) Summary 重新设置流程实例标题。。 Syntax this.workContext.setTitle(title); Parameters title String 路由字符串数组. Example this.workContext.setTitle(\"标题\"); Source o2_core/o2/xScript/Environment.js, line 522 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-include.html":{"url":"module-include.html","title":"include","kind":"Module","body":" O2OA WebAPI: include | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag Module include this.include是一个方法，当您在流程、门户或者内容管理中创建了脚本配置，可以使用this.include()用来引用脚本配置。 （建议使用表单中的预加载脚本，需要判断加载的时候才使用本方法加载脚本，此时建议异步加载有助于表单加载速度。） Syntax //您可以在表单、流程、视图和查询视图的各个嵌入脚本中，通过this.include()来引用本应用或其他应用的脚本配置，如下：\rthis.include( optionsOrName, callback, async ) Parameters optionsOrName String | Object | Array.&lt;String> | Array.&lt;Object> 可以是脚本标识字符串（数组）或者是对象（数组）。 //如果需要引用本应用的脚本配置，将options设置为String或者String Array。 this.include(\"initScript\") //脚本配置的名称、别名或id this.include([\"initScript\",\"initScript2\"]) //可以是字符串数组 //如果需要引用其他应用的脚本配置，将options设置为Object或者Object Array; this.include({ //type: 应用类型。可以为 portal process cms。 //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。 //比如在门户的A应用脚本中引用门户B应用的脚本配置，则type可以省略。 type : \"portal\", application : \"首页\", // 门户、流程、CMS的名称、别名、id。 默认为当前应用 name : \"initScript\" // 脚本配置的名称、别名或id }) this.include([ //也可以对象和字符串混合数组 { type : \"portal\", application : \"首页\", name : \"initScript\" }, \"initScript2\" ]) callback function &lt;optional&gt; 加载后执行的回调方法 async Boolean &lt;optional&gt; 是否异步加载 Examples \r 样例一：在通用脚本中定义返回当前人员名称的方法，在各个门户应用都使用这个方法显示人员名称。\r 1、在门户应用中有一个commonApp的应用，在该应用中创建一个脚本，命名为initScript，并定义方法。\r \r //定义一个方法\rthis.define(\"getUserName\", function(){\r return ( layout.desktop.session.user || layout.user ).name\r}.bind(this)) \r 2、在门户页面中添加事件'queryLoad',在事件中引入 initScript 脚本配置。\r \r this.include({\r type : \"portal\",\r application : \"commonApp\",\r name : \"initScript\"\r}) \r 3、在门户页面的'load'事件中使用方法。\r \r var userNameNode = this.page.get(\"userName\").node; //获取Dom对象\rvar urerName = this.getUserName(); //使用initScript脚本中的方法\ruserNameNode.set(\"text\", urerName ); //为DOM对象设置值 Source o2_core/o2/xScript/Environment.js, line 1811 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-define.html":{"url":"module-define.html","title":"define","kind":"Module","body":" O2OA WebAPI: define | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag Module define this.define是一个方法，您可以在流程、门户或者内容管理中创建脚本配置，在脚本配置中您可以通过this.define()来定义自己的方法。 通过这种方式定义方法，在不同的应用使用相同的方法名称也不会造成冲突。 Syntax this.define(name, fun, overwrite) Parameters name String 定义的方法名称。 fun function 定义的方法 overwrite Boolean &lt;optional&gt; 定义的方法是否能被覆盖重写。默认值为true。 Examples \r 样例：在通用脚本中定义返回当前人员名称的方法，在各个门户应用都使用这个方法显示人员名称。\r 1、在门户应用中有一个commonApp的应用，在该应用中创建一个脚本，命名为initScript，并定义方法。\r \r //定义一个方法\rthis.define(\"getUserName\", function(){\r return ( layout.desktop.session.user || layout.user ).name\r}.bind(this)) \r 2、在门户页面中添加事件'queryLoad',在事件中引入 initScript 脚本配置。\r \r this.include({\r type : \"portal\",\r application : \"commonApp\",\r name : \"initScript\"\r}) \r 3、在门户页面的'load'事件中使用方法。\r \r var userNameNode = this.page.get(\"userName\").node; //获取Dom对象\rvar urerName = this.getUserName(); //使用initScript脚本中的方法\ruserNameNode.set(\"text\", urerName ); //为DOM对象设置值 Source o2_core/o2/xScript/Environment.js, line 1974 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-wait.html":{"url":"module-wait.html","title":"wait","kind":"Module","body":" O2OA WebAPI: wait | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag Module wait this.wait是一个方法，可以用来处理异步调用时的页面加载。 该方法使用的具体场景：为了加快速度，需要一次性加载全部外部资源（如：数据字典、外部JS、内容管理文档等）后，再进行表单的加载。 this.wait需和this.goon配合使用。 目前只有流程表单的queryload事件支持此方法。 Usable Range Process Syntax var resolve = this.wait(); //让表单停止加载页面\r\rif (resolve &amp;&amp; resolve.cb){\r resolve.cb(); //通过 resolve.cb() 方法继续执行表单加载\r}else{\r //如果没有发生异步，则resolve.cb方法不存在，\r //所以在回调中中使用this.goon();使表单继续加载\r this.goon();\r} Example 需要在加载数据字典，内容管理文档数据，按照条件获取的脚本后，再进行加载表单。 var resolve = this.wait(); //this.wait()让表单加载等待回调\rvar scriptLoaded = false; //脚本是否加载完成标识，按条件判断的脚本才建议用this.include(),否则使用预加载脚本更快。\rvar documentLoaded = false; //内容管理文档是否加载完成标识\rvar dictLoaded = true; //数据字典是否加载完成标识\r\r//检查是否全部资源已加载，如果是继续加载表单\rvar checkLoad = function(){\r if (scriptLoaded &amp;&amp; documentLoaded &amp;&amp; dictLoaded){ //各种资源以及加载完成\r if (resolve &amp;&amp; resolve.cb){\r resolve.cb(); //通过 resolve.cb() 方法继续执行表单加载\r }else{\r //如果没有发生异步，则resolve.cb方法不存在，\r //所以在回调中中使用this.goon();使表单继续加载\r this.goon();\r }\r }\r}.bind(this);\r\r//判断内容管理文档加载\rif( this.data.documentId ){\r //异步载入内容管理文档\r o2.Actions.get(\"x_cms_assemble_control\").getDocument(this.data.documentId, function (json) {\r this.form.documentJson = json; //将数据存在this.form上，以便其他地方使用\r documentLoaded = true; //标记内容管理加载完成\r checkLoad(); //检查全部资源是否完成加载\r }.bind(this), null, true); //true 为异步加载标志\r }else{\r documentLoaded = true; ////标记内容管理加载完成\r checkLoad(); //检查全部资源是否完成加载\r}\r\r//判断脚本加载\rif( this.data.scriptName ){ //假设scriptName为判断条件\r //加载脚本\r this.include( this.data.scriptName, function(){ //第二个参数为异步加载后的回调\r scriptLoaded = true; //标记脚本加载完成\r checkLoad(); //检查全部资源是否完成加载\r }, true ); //第三个参数表示异步\r}else{\r scriptLoaded = true; ////标记脚本加载完成\r checkLoad(); //检查全部资源是否完成加载\r}\r\r//加载数据字典bulletinDictionary的category数据\rvar dict = new Dict(\"bulletinDictionary\");\rdict.get(\"category\", function(data){ //成功的回调\r this.form.bulletinCategory = data; //将数据存在this.form上，以便其他地方使用\r dictLoaded = true; //标记数据字典加载完成\r checkLoad(); //检查全部资源是否完成加载\r }.bind(this), function(xhr){ //错误的回调\r dictLoaded = true; ////标记数据字典加载完成\r checkLoad(); //检查全部资源是否完成加载\r }, true //异步执行\r) Source o2_core/o2/xScript/Environment.js, line 2027 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-page.html":{"url":"module-page.html","title":"page","kind":"Module","body":" O2OA WebAPI: page | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag MparametersFtoPageFtoPortalFgetInforFgetAppFnodeFgetFgetWidgetModuleFgetFieldFcloseFconfirmFalertFnoticeFaddEventFopenWorkFopenJobFopenDocumentFopenPortalFopenCMSFopenProcessFopenApplicationFcreateDocumentFstartProcessFgetWidgetPrameters Module page page对象可在门户页面中可用。它的很多方法与form类似。（仅前端脚本可用） Usable Range Portal Syntax //您可以在门户表单中，通过this来获取page对象，如下：\rvar page = this.page; Source o2_core/o2/xScript/PageEnvironment.js, line 1427 Members static parameters 在打开的页面的任意脚本中，获取传入的参数。 Syntax var par = this.page.parameters Example //打开页面时传入参数：\rthis.form.openPortal(id, \"\", {\"type\": \"my type\"});\r\r//在打开的页面的任意脚本中，可以获取parameters：\rvar par = this.page.parameters;\r//par的内容：{\"type\": \"my type\"} Source o2_core/o2/xScript/PageEnvironment.js, line 1909 Methods static toPage(name, paropt, paropt) 跳转到当前门户的指定页面。（仅门户页面脚本可用） Syntax //跳转到当前门户的指定页面。\rthis.page.toPage( name, par ); Parameters name String 要跳转的页面名称 par Object &lt;optional&gt; 要传入被打开页面的数据。在被打开的页面可以用this.page.parameters获取 par Boolean &lt;optional&gt; 页面跳转的时候，不往History里增加历史状态，默认为false Example this.page.toPage(\"列表页面\", {\"key\": \"发文列表\"});//打开“列表页面”，并传入一个json数据。\r\r//在列表页面中，通过this.page.parameters获取传入的数据。\rvar key = this.page.parameters.key; //key=\"发文列表\" Source o2_core/o2/xScript/PageEnvironment.js, line 1437 static toPortal(portal, pageopt, paropt) 跳转到指定门户页面。（仅门户页面脚本可用） Syntax this.page.toPortal( portal, page, par ); Parameters portal String 要跳转的门户名称。 page String &lt;optional&gt; 要打开的门户的页面名称。为空则打开指定门户的默认首页。 par String &lt;optional&gt; 在被打开的页面可以用this.page.parameters获取。 Example this.page.toPortal(\"公文门户\", \"列表页面\", {\"key\": \"发文列表\"});//打开“公文门户”的“列表页面”，并传入一个json数据。\r\r//在列表页面中，通过this.page.parameters获取传入的数据。\rvar key = this.page.parameters.key; //key=\"发文列表\" Source o2_core/o2/xScript/PageEnvironment.js, line 1456 static getInfor() 获取当前页面的基本信息 See module:form.getInfor Source o2_core/o2/xScript/PageEnvironment.js, line 1473 static getApp() 获取打开当前页面的component对象。 See module:form.getApp Source o2_core/o2/xScript/PageEnvironment.js, line 1480 static node() 获取page对应的DOM对象。 See module:form.node Source o2_core/o2/xScript/PageEnvironment.js, line 1487 static get() 获取页面元素对象。 See module:form.get Source o2_core/o2/xScript/PageEnvironment.js, line 1494 static getWidgetModule(widgetId, fieldId) &rarr; {FormComponent} 获取指定部件元素对象。 Syntax this.page.getWidgetModule( widgetId, fieldId ); Parameters widgetId String 在主页面嵌入部件时用的标识。 fieldId String 部件内组件标识。 See module:form.get Returns FormComponent 请查看本文档的Classes导航下的FormComponents。 Example \r1、设计了一个部件，包含一个设计元素subject。\r2、在主页面里两次嵌入1步骤创建的部件，一个标识是widget_1, widget_2。\r var module = this.page.getWidgetModule( \"widget_1\", \"subject\"); //部件widget_1的subject组件\rvar data2 = this.page.getWidgetModule( \"widget_2\", \"subject\").getData(); //部件widget_2的subject组件的值 Source o2_core/o2/xScript/PageEnvironment.js, line 1501 static getField() 获取页面中可输入的字段元素对象 See module:form.getField Source o2_core/o2/xScript/PageEnvironment.js, line 1523 static close() 关闭当前页面 See module:form.close Source o2_core/o2/xScript/PageEnvironment.js, line 1535 static confirm() 弹出一个确认框 See module:form.confirm Source o2_core/o2/xScript/PageEnvironment.js, line 1546 static alert() 显示一个带关闭按钮的信息框 See module:form.alert Source o2_core/o2/xScript/PageEnvironment.js, line 1573 static notice() 显示一个信息框 See module:form.notice Source o2_core/o2/xScript/PageEnvironment.js, line 1582 static addEvent() 给页面添加事件。 See module:form.addEvent Source o2_core/o2/xScript/PageEnvironment.js, line 1590 static openWork() 打开一个在流转或已完成的流程实例 See module:form.openWork Source o2_core/o2/xScript/PageEnvironment.js, line 1601 static openJob() 使用流程的jobId打开工作 See module:form.openJob Source o2_core/o2/xScript/PageEnvironment.js, line 1614 static openDocument() 打开一个内容管理文档 See module:form.openDocument Source o2_core/o2/xScript/PageEnvironment.js, line 1711 static openPortal() 打开一个门户页面 See module:form.openPortal Source o2_core/o2/xScript/PageEnvironment.js, line 1722 static openCMS() 打开一个内容管理栏目（应用） See module:form.openCMS Source o2_core/o2/xScript/PageEnvironment.js, line 1752 static openProcess() 打开一个流程应用 See module:form.openProcess Source o2_core/o2/xScript/PageEnvironment.js, line 1768 static openApplication() 打开一个任意一个component应用 See module:form.openApplication Source o2_core/o2/xScript/PageEnvironment.js, line 1784 static createDocument() 创建一个内容管理文档 See module:form.createDocument Source o2_core/o2/xScript/PageEnvironment.js, line 1792 static startProcess() 启动一个流程实例 See module:form.startProcess Source o2_core/o2/xScript/PageEnvironment.js, line 1845 static getWidgetPrameters() &rarr; {Object} 在嵌入部件的时候，可以在主页面上传入参数。通过本方法，可以在对应部件或者部件元素的脚本中获取传入的参数。 Syntax var par = this.page.getWidgetPrameters(); Returns Object 任意数据类型，根据传入的参数决定。 Example //在主页面嵌入部件的地方传入参数：\rreturn {\"type\": \"my type\"};\r\r//在对应部件脚本中，可以获取parameters：\rvar par = this.page.getWidgetPrameters();\r//par的内容：{\"type\": \"my type\"} Source o2_core/o2/xScript/PageEnvironment.js, line 1926 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-Dict.html":{"url":"module-Dict.html","title":"Dict","kind":"Module","body":" O2OA WebAPI: Dict | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetFaddFsetFdelete Module Dict this.Dict是一个工具类，如果您在流程、门户中创建了数据字典，可以使用this.Dict类对数据字典进行增删改查操作。 Syntax //您可以在页面、表单、流程各个嵌入脚本中，通过this.Dict()对本应用或其他应用的数据字典中的数据进行增删改查，如下：\rvar dict = new this.Dict( options ) Parameters optionsOrName String | Object 数据字典标识字符串或者是对象。 如果对本应用的数据字典操作，将optionsOrName设置为string。 var dict = new this.Dict(\"bulletinDictionary\"); //数据字典的名称、别名或id 如果需要对其他应用的数据字典进行操作，将options设置为JsonObject var dict = new this.Dict({ //type: 应用类型。可以为process cms。 //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。 //比如在流程的A应用脚本中引用流程B应用的脚本配置，则type可以省略。 type : \"cms\", application : \"bulletin\", //流程、CMS的名称、别名、id, 默认为当前应用 name : \"bulletinDictionary\", // 数据字典的名称、别名、id enableAnonymous : true //允许用户在未登录的情况下读取cms的数据字典, type为process的时候此参数无效，默认为false }); Returns Object Dict对象 Source o2_core/o2/xScript/ViewEnvironment.js, line 219 Methods static get(pathopt, successopt, failureopt, asyncopt, refreshopt) &rarr; {Promise|Object|Array|String|Number|Boolean} 根据路径获取数据字典中的数据。 Syntax var data = dict.get( path, success, failure, async, refresh ) Parameters path String &lt;optional&gt; 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。当值为空的时候，表示获取数据字典中的所有数据。 success function &lt;optional&gt; 获取数据成功时的回调函数。 failure function &lt;optional&gt; 获取数据失败时的回调。 async Boolean &lt;optional&gt; 是否异步执行，默认为false。 refresh Boolean &lt;optional&gt; 是否忽略本地缓存直接从服务器获取，默认为false。 Returns Promise Object Array String Number Boolean 当async为true时返回Promise(Promise说明)； 否则返回数据字典的数据，类型和配置数据字典时候指定的一致。 Examples var dict = new this.Dict(\"bulletinDictionary\");\r\r//没有参数的时候，表示同步获取获取所有数据\r var data = dict.get()\r\r //同步执行，获取category下key为subCategory的数据\r var data = dict.get(\"category.subCategory\");\r\r//异步执行，使用回调处理数据，如果category为数组，获取第0项数据\rdict.get(\"category.0\", function(data){\r //data 是数据字典的数据\r }, function(xhr){\r //xhr 为 xmlHttpRequest\r }, true //异步执行\r)\r\r//异步执行，使用Promise处理结果\rvar promise = dict.get(\"category\", null, null, true);\rpromise.then( function(data){\r //data 是数据字典的数据\r}) \r 已经配置好了如下图所示的数据字典\r\r var dict = new this.Dict({\r //type: 应用类型。可以为process cms。\r //如果没有该选项或者值为空字符串，则表示应用脚本和被应用的脚本配置类型相同。\r //比如在流程的A应用脚本中引用流程B应用的脚本配置，则type可以省略。\r type : \"cms\",\r application : \"bulletin\", //流程、CMS的名称、别名、id, 默认为当前应用\r name : \"bulletinDictionary\", // 数据字典的名称、别名、id\r enableAnonymous : true //允许用户在未登录的情况下读取cms的数据字典, type为process的时候此参数无效，默认为false\r});\r\rvar data = dict.get();\r//data的值为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r }\r ]\r}\r\r var category = dict.get(\"category\");\r //category的值为\r [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r }\r ]\r\r var array0 = dict.get(\"category.0\");\r //array0 的值为\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r}\r\rvar enable = dict.get(\"category.0.eanble\");\r//enable 的值为 true Source o2_core/o2/xScript/ViewEnvironment.js, line 244 add(path, data, successopt, failureopt) 根据路径新增数据字典的数据。 Syntax dict.add( path, data, success, failure ) Parameters path String 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果path在数据字典中已有数据，且原有数据是数组，则数组添加一项；如果原有数据不是数组，则报错。 data Object | Array | String | Number | Boolean 需要新增的数据 success function &lt;optional&gt; 增加数据成功时的回调函数。 failure function &lt;optional&gt; 增加数据错误时的回调函数。 Examples var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.add( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r //data 形如\r //{\r // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r //}\r}, function(xhr){\r //xhr 为 xmlHttpRequest\r}); \r 对get方法样例的数据字典进行赋值，如下：\r var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.add( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r //data 形如\r //{\r // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r //}\r}, function(xhr, text, error){\r //xhr 为 xmlHttpRequest, text 为错误文本， error为Error对象\r});\r //数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"text\": \"系统公告\",\r \"value\": \"system\"\r }\r ]\r}\r\r dict.add( \"category.2.sequence\", 3 );\r //数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"sequence\" : 3.0,\r \"text\": \"系统公告\",\r \"value\": \"system\"\r }\r ]\r}\rdict.add( \"archiveOptions\", {\r \"yes\" : \"是\",\r \"no\" : \"否\"\r});\r //数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"sequence\" : 3.0,\r \"text\": \"系统公告\",\r \"value\": \"system\"\r }\r\r ],\r \"archiveOptions\" : {\r \"yes\" : \"是\",\r \"no\" : \"否\"\r }\r} 下面是错误的赋值，如下： dict.add( \"category.3\", { text : \"系统公告\", value : \"system\" }); //出错，因为不能对数组下标直接赋值\r\rdict.add( \"category.1.value\", { text : \"系统公告\" } ); //出错，因为不能对已经存在的非数组路径赋值 Source o2_core/o2/xScript/ViewEnvironment.js, line 345 set(path, data, successopt, failureopt) 根据路径修改数据字典的数据。 Syntax dict.set( path, data, success, failure ) Parameters path String 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果数据路径不存在，则报错。 data Object | Array | String | Number | Boolean 修改后的数据 success function &lt;optional&gt; 设置数据成功时的回调函数。 failure function &lt;optional&gt; 设置数据错误时的回调函数。 Examples var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.set( \"category\", { text : \"系统公告\", value : \"system\" }, function(data){\r //data 形如\r //{\r // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r //}\r}, function(xhr){\r //xhr 为 xmlHttpRequest\r}); \r 对Example add的数据字典进行赋值，如下：\r var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.set( \"archiveOptions\", [ { text : \"是\" }, { text : \"否\" } ]);\r //数据字典的值变为\r {\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"sequence\" : 3.0,\r \"text\": \"系统公告\",\r \"value\": \"system\"\r }\r\r ],\r \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r}\r\rdict.set( \"category.2\", { text : \"县级公告\", value : \"county\" }, function(data){\r //data 形如\r //{\r // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r //}\r }, function(xhr){\r //xhr 为 xmlHttpRequest\r });\r\r /数据字典的值变为\r {\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 2.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"text\": \"县级公告\",\r \"value\": \"county\"\r }\r ],\r \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r}\r\rdict.set( \"category.1.sequence\", 3 );\rdict.set( \"category.2.sequence\", 2 );\r //数据字典的值变为\r {\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 3.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"sequence\": 2.0,\r \"text\": \"县级公告\",\r \"value\": \"county\"\r }\r ],\r \"archiveOptions\" : [ { text : \"是\" }, { text : \"否\" } ]\r} \r 下面是错误的赋值：\r dict.set( \"category_1\", { text : \"公司公告\" } ); //出错，因为category_1在数据字典中不存在 Source o2_core/o2/xScript/ViewEnvironment.js, line 465 delete(path, successopt, failureopt) 根据路径删除数据字典的数据。 Syntax dict.delete( path, success, failure ) Parameters path String 数据字典中的数据路径，允许使用中文。当路径为多级时，用点号(.)分隔。如果数据路径不存在，则报错。 success function &lt;optional&gt; 删除数据成功时的回调函数。 failure function &lt;optional&gt; 删除数据错误时的回调函数。 Examples var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.delete( \"category\", function(){\r}, function(xhr){\r //xhr 为 xmlHttpRequest\r}); \r 对Example set的数据字典进行赋值，如下：\r var dict = new this.Dict(\"bulletinDictionary\");\r\rdict.delete( \"archiveOptions\");\r//数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r * \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 3.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"sequence\": 2.0,\r \"text\": \"县级公告\",\r \"value\": \"county\"\r }\r ]\r}\r\rdict.delete( \"category.2.sequence\", function(data){\r //data 形如\r //{\r // \"id\": \"80ed5f60-500f-4358-8bbc-b7e81f77aa39\" //id为数据字典ID\r //}\r}, function(xhr){\r //xhr 为 xmlHttpRequest\r});\r//数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 3.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r },\r {\r \"text\": \"县级公告\",\r \"value\": \"county\"\r }\r ]\r}\r\rdict.delete( \"category.2\");\r//数据字典的值变为\r{\r \"category\": [\r {\r \"enable\": true,\r \"sequence\": 1.0,\r \"text\": \"公司公告\",\r \"value\": \"company\"\r },\r {\r \"enable\": \"false\",\r \"sequence\": 3.0,\r \"text\": \"部门公告\",\r \"value\": \"department\"\r }\r ]\r} \r 下面是错误的删除：\r dict.delete( \"category_1\" ); //出错，因为category_1在数据字典中不存在 Source o2_core/o2/xScript/ViewEnvironment.js, line 583 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-org.html":{"url":"module-org.html","title":"org","kind":"Module","body":" O2OA WebAPI: org | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag identityFgetIdentityFlistIdentityWithPersonFlistIdentityWithUnitunitFgetUnitFlistSubUnitFlistSupUnitFgetUnitByIdentityFlistAllSupUnitWithIdentityFlistUnitWithPersonFlistAllSupUnitWithPersonFlistUnitWithAttributeFlistUnitWithDutyFlistTopUnitpersonFgetPersonFlistSubPersonFlistSupPersonFlistPersonWithGroupFlistPersonWithRoleFlistPersonWithIdentityFlistPersonWithUnitFlistPersonWithAttributedutyFgetDutyFlistDutyNameWithIdentityFlistDutyNameWithUnitFlistUnitAllDutygroupFgetGroupFlistSubGroupFlistSupGroupFlistGroupWithPersonroleFgetRoleFlistRoleWithPersonFpersonHasRoleFgroupHasRolepersonAttributeFappendPersonAttributeFsetPersonAttributeFgetPersonAttributeFlistPersonAttributeNameFlistPersonAllAttributeunitAttributeFappendUnitAttributeFsetUnitAttributeFgetUnitAttributeFlistUnitAttributeNameFlistUnitAllAttribute Module org 您可以通过this.org获取组织中的人员、人员属性、组织、组织属性、身份、群组和角色。 Syntax //您可以在流程表单、内容管理表单、门户页面、视图和查询视图中，通过this来获取当前实例的org对象，如下：\rvar org = this.org; Source o2_core/o2/xScript/ViewEnvironment.js, line 707 Methods static getIdentity(name, asyncOrCallbackopt) &rarr; {Promise|IdentityData|Array.&lt;IdentityData>} 根据身份标识获取对应的身份对象或数组 Syntax //同步执行，返回身份，单个是对象，多个是数组。\rvar identityList = this.org.getIdentity( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getIdentity( name, true);\rpromise.then(function(identityList){\r //identityList 为返回的身份，单个是对象，多个是数组。\r})\r\r//异步执行，在回调方法中获取身份\rthis.org.getIdentity( name, function(identityList){\r //identityList 为返回的身份，单个是对象，多个是数组。\r}) Parameters name IdentityFlag | Array.&lt;IdentityFlag> 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise IdentityData Array.&lt;IdentityData> 当async为true时，返回 Promise。 否则返回身份，单个是Object，多个是Array。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"pinyin\": \" \",\t\t//name拼音,自动生成 \t\"pinyinInitial\": \" \",\t\t//name拼音首字母,自动生成 \t\"description\": \" \",\t\t//描述. \t\"name\": \"李四\",\t\t//名称,可重名. \t\"unique\": \"23dd1b53-feed-485d-8c9c-1a4e64ff58a2\",\t\t//唯一标识,不可重复,为空则使用自动填充值 \t\"distinguishedName\": \"李四@23dd1b53-feed-485d-8c9c-1a4e64ff58a2@I\",\t\t//识别名. \t\"person\": \"李四@lisi@P\",\t\t//身份所属个人,存放个人 ID,不为空. \t\"unit\": \"开发部@kfb@U\",\t\t//属性所属组织,不可为空. \t\"unitName\": \"开发部\",\t\t//组织名称. \t\"unitLevel\": 2,\t\t//组织级别. \t\"unitLevelName\": \"浙江兰德纵横/开发部\",\t\t//显示的层级名. \t\"orderNumber\": 24920439,\t\t//排序号,升序排列,为空在最后 \t\"major\": true,\t\t//主身份标识 \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/ViewEnvironment.js, line 718 static listIdentityWithPerson(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;IdentityData>} 根据人员标识获取对应的身份对象数组。 Syntax //同步执行，返回身份对象数组。\rvar identityList = this.org.listIdentityWithPerson( person );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listIdentityWithPerson( person, true);\rpromise.then(function(identityList){\r //identityList 返回的身份对象数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listIdentityWithPerson( person, function(identityList){\r //identityList 返回的身份对象数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;IdentityData> 当async为true时，返回 Promise。 否则返回身份对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"name\": \"李四\",\t\t//身份名称 \t\"unique\": \"23dd1b53-feed-485d-8c9c-1a4e64ff58a2\",\t\t//身份标识 \t\"description\": \" \",\t\t//说明 \t\"distinguishedName\": \"李四@23dd1b53-feed-485d-8c9c-1a4e64ff58a2@I\",\t\t//识别名 \t\"person\": \"李四@lisi@P\",\t\t//人员 \t\"unit\": \"开发部@kfb@U\",\t\t//组织 \t\"unitName\": \"开发部\",\t\t//组织名称 \t\"unitLevel\": 2,\t\t//组织级别 \t\"unitLevelName\": \"浙江兰德纵横/开发部\",\t\t//组织级别名 \t\"orderNumber\": 24920439,\t\t//排序号 \t\"major\": true \t\t//是否是设定的主身份 } Source o2_core/o2/xScript/ViewEnvironment.js, line 760 static listIdentityWithUnit(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;IdentityData>} 根据组织标识获取对应的身份对象数组：identity对象数组。 Syntax //同步执行，返回直接组织身份对象数组。\rvar identityList = this.org.listIdentityWithUnit( unit );\r\r\r//同步执行，返回嵌套组织身份对象数组。\rvar identityList = this.org.listIdentityWithUnit( unit, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listIdentityWithUnit( unit, false, true);\rpromise.then(function(identityList){\r //identityList 返回直接组织身份对象数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listIdentityWithUnit( unit, false, function(identityList){\r //identityList 返回直接组织身份对象数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有身份成员；false直接身份成员；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;IdentityData> 当async为true时，返回 Promise。 否则返回身份对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"name\": \"李四\",\t\t//身份名称 \t\"unique\": \"23dd1b53-feed-485d-8c9c-1a4e64ff58a2\",\t\t//身份标识 \t\"description\": \" \",\t\t//说明 \t\"distinguishedName\": \"李四@23dd1b53-feed-485d-8c9c-1a4e64ff58a2@I\",\t\t//识别名 \t\"person\": \"李四@lisi@P\",\t\t//人员 \t\"unit\": \"开发部@kfb@U\",\t\t//组织 \t\"unitName\": \"开发部\",\t\t//组织名称 \t\"unitLevel\": 2,\t\t//组织级别 \t\"unitLevelName\": \"浙江兰德纵横/开发部\",\t\t//组织级别名 \t\"orderNumber\": 24920439,\t\t//排序号 \t\"major\": true \t\t//是否是设定的主身份 } Source o2_core/o2/xScript/ViewEnvironment.js, line 802 static getUnit(name, asyncOrCallbackopt) &rarr; {Promise|UnitData|Array.&lt;UnitData>} 根据组织标识获取对应的组织：unit对象或数组 Syntax //同步执行，返回组织，单个是对象，多个是数组。\rvar unitList = this.org.getUnit( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getUnit( name, true);\rpromise.then(function(unitList){\r //unitList 为返回的组织，单个是对象，多个是数组。\r})\r\r//异步执行，在回调方法中获取组织\rthis.org.getUnit( name, function(unitList){\r //unitList 为返回的组织，单个是对象，多个是数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise UnitData Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织，单个是Object，多个是Array。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"subDirectUnitCount\": 1,\t\t//直接下级组织数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"name\": \"开发部\",\t\t//名称,可以重名. \t\"unique\": \"kfb\",\t\t//唯一标识,不可重复,为空则使用自动填充值 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名.以@U结尾. \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型. \t\"pinyin\": \" \",\t\t//name拼音,自动生成 \t\"pinyinInitial\": \" \",\t\t//name拼音首字母,自动生成 \t\"description\": \" \",\t\t//描述. \t\"shortName\": \"kfb\",\t\t//组织简称。 \t\"level\": 2,\t\t//组织级别,1为最上层组织.自动计算. \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//显示的层级名. \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织. \t\"orderNumber\": 1,\t\t//排序号,升序排列,为空在最后 \t\"dingdingId\": \" \",\t\t//钉钉部门ID. \t\"dingdingHash\": \" \",\t\t//钉钉部门哈希特征. \t\"weLinkId\": \" \",\t\t//WeLink部门ID. \t\"weLinkHash\": \" \",\t\t//WeLink部门哈希特征. \t\"qiyeweixinId\": \" \",\t\t//企业微信人员ID. \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉人员ID. \t\"zhengwuDingdingHash\": \" \",\t\t//政务钉钉人员哈希特征. \t\"qiyeweixinHash\": \" \",\t\t//企业微信人员哈希特征. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/ViewEnvironment.js, line 866 static listSubUnit(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据组织标识获取下级组织的对象数组：unit对象数组。 Syntax //同步执行，返回嵌套下级组织数组。\rvar unitList = this.org.listSubUnit( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSubUnit( name, false, true);\rpromise.then(function(unitList){\r //unitList 为返回的直接下级组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listSubUnit( name, true, function(unitList){\r //unitList 为返回嵌套下级组织数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有下级组织；false直接下级组织；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 909 static listSupUnit(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据组织标识批量获取上级组织的对象数组：unit对象数组。 Syntax //同步执行，返回嵌套上级组织数组。\rvar unitList = this.org.listSupUnit( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSupUnit( name, false, true);\rpromise.then(function(unitList){\r //unitList 为返回的直接上级组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listSupUnit( name, true, function(unitList){\r //unitList 为返回嵌套上级组织数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有上级组织；false直接上级组织；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 958 static getUnitByIdentity(name, flagopt, asyncOrCallbackopt) &rarr; {Promise|UnitData|Array.&lt;UnitData>} 根据个人身份获取组织：unit对象或数组。 Syntax //同步执行，返回直接所在组织，单个为对象，多个为数组。\rvar unitList = this.org.getUnitByIdentity( name );\r\r//同步执行，返回第一层组织，单个为对象，多个为数组。\rvar unitList = this.org.getUnitByIdentity( name, 1 );\r\r* //同步执行，返回类型为company的组织，单个为对象，多个为数组。\rvar unitList = this.org.getUnitByIdentity( name, \"company\" );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getUnitByIdentity( name, null, true);\rpromise.then(function(unitList){\r //unitList 返回直接所在组织，单个为对象，多个为数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.getUnitByIdentity( name, 1, function(unitList){\r //unitList 返回第一层组织，单个为对象，多个为数组。\r}) Parameters name IdentityFlag 身份的distinguishedName、name、id、unique属性值，身份对象。 flag String | Number &lt;optional&gt; 当值为数字的时候， 表示获取第几层的组织。 当值为字符串的时候，表示获取指定类型的组织。 当值为空的时候，表示获取直接所在组织。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise UnitData Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回对应组织，单个为对象，多个为数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1025 static listAllSupUnitWithIdentity(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 批量查询身份所在的组织,并递归查找其上级组织对象. Syntax //同步执行，返回组织数组。\rvar unitList = this.org.listAllSupUnitWithIdentity( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listAllSupUnitWithIdentity( name, true);\rpromise.then(function(unitList){\r //unitList 返回组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listAllSupUnitWithIdentity( name, function(unitList){\r //unitList 返回组织数组。\r}) Parameters name IdentityFlag | Array.&lt;IdentityFlag> 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1122 static listUnitWithPerson(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据个人标识批量获取组织对象成员：Unit对象数组。 Syntax //同步执行，返回组织数组。\rvar unitList = this.org.listUnitWithPerson( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitWithPerson( name, true);\rpromise.then(function(unitList){\r //unitList 返回组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitWithPerson( name, function(unitList){\r //unitList 返回组织数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1163 static listAllSupUnitWithPerson(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据个人标识批量查询所在组织及所有上级组织：Unit对象数组。 Syntax //同步执行，返回组织数组。\rvar unitList = this.org.listAllSupUnitWithPerson( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listAllSupUnitWithPerson( name, true);\rpromise.then(function(unitList){\r //unitList 返回组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listAllSupUnitWithPerson( name, function(unitList){\r //unitList 返回组织数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回个人所在组织及所有上级组织。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1204 static listUnitWithAttribute(attributeName, attributeValue, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据组织属性，获取所有符合的组织。 Syntax //同步执行，返回组织数组。\rvar unitList = this.org.listUnitWithAttribute( attributeName, attributeName );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitWithAttribute( attributeName, attributeName, true);\rpromise.then(function(unitList){\r //unitList 返回组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitWithAttribute( attributeName, attributeName, function(unitList){\r //unitList 返回组织数组。\r}) Parameters attributeName String 组织属性名称。 attributeValue String 组织属性值。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1245 static listUnitWithDuty(dutyName, identity, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 根据组织职务，获取所有符合的组织。 Syntax //同步执行，返回组织数组。\rvar unitList = this.org.listUnitWithDuty( dutyName, identity );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitWithDuty( dutyName, identity, true);\rpromise.then(function(unitList){\r //unitList 返回组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitWithDuty( dutyName, identity, function(unitList){\r //unitList 返回组织数组。\r}) Parameters dutyName String 组织职务名称。 identity IdentityFlag 身份的distinguishedName、name、id、unique属性值，身份对象。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回组织数组。 { \t\"name\": \"开发部\",\t\t//组织名称 \t\"unique\": \"kfb\",\t\t//唯一标识 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名 \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型 \t\"description\": \" \",\t\t//说明 \t\"shortName\": \"kfb\",\t\t//简称 \t\"level\": 2,\t\t//组织层次 \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//组织层次名 \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织 \t\"orderNumber\": 1,\t\t//排序号 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink Id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1287 static listTopUnit(asyncOrCallbackopt) &rarr; {Promise|Array.&lt;UnitData>} 列式所有顶层组织。 Syntax //同步执行，返回顶层组织数组。\rvar unitList = this.org.listTopUnit();\r\r//异步执行，返回Promise对象\rvar promise = this.org.listTopUnit(true);\rpromise.then(function(unitList){\r //unitList 返回顶层组织数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listTopUnit(function(unitList){\r //unitList 返回顶层组织数组。\r}) Parameters asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;UnitData> 当async为true时，返回 Promise。 否则返回顶层组织数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"subDirectUnitCount\": 1,\t\t//直接下级组织数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"name\": \"开发部\",\t\t//名称,可以重名. \t\"unique\": \"kfb\",\t\t//唯一标识,不可重复,为空则使用自动填充值 \t\"distinguishedName\": \"开发部@kfb@U\",\t\t//识别名.以@U结尾. \t\"typeList\": [ \t\t\"部门\" \t],\t\t//组织类型. \t\"pinyin\": \" \",\t\t//name拼音,自动生成 \t\"pinyinInitial\": \" \",\t\t//name拼音首字母,自动生成 \t\"description\": \" \",\t\t//描述. \t\"shortName\": \"kfb\",\t\t//组织简称。 \t\"level\": 2,\t\t//组织级别,1为最上层组织.自动计算. \t\"levelName\": \"浙江兰德纵横/开发部\",\t\t//显示的层级名. \t\"superior\": \"浙江兰德纵横@a706f5f0-4a3b-4785-8e1d-0a944bfad4eb@U\",\t\t//上级组织. \t\"orderNumber\": 1,\t\t//排序号,升序排列,为空在最后 \t\"dingdingId\": \" \",\t\t//钉钉部门ID. \t\"dingdingHash\": \" \",\t\t//钉钉部门哈希特征. \t\"weLinkId\": \" \",\t\t//WeLink部门ID. \t\"weLinkHash\": \" \",\t\t//WeLink部门哈希特征. \t\"qiyeweixinId\": \" \",\t\t//企业微信人员ID. \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉人员ID. \t\"zhengwuDingdingHash\": \" \",\t\t//政务钉钉人员哈希特征. \t\"qiyeweixinHash\": \" \",\t\t//企业微信人员哈希特征. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/ViewEnvironment.js, line 1329 static getPerson(name, asyncOrCallbackopt) &rarr; {Promise|PersonData|Array.&lt;PersonData>} 根据人员标识获取对应的人员对象或数组：person对象或数组 Syntax //同步执行，返回人员，单个是对象，多个是数组。\rvar personList = this.org.getPerson( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getPerson( name, true);\rpromise.then(function(personList){\r //personList 为返回的人员，单个是对象，多个是数组。\r})\r\r//异步执行，在回调方法中获取人员\rthis.org.getPerson( name, function(personList){\r //personList 为返回的人员，单个是对象，多个是数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise PersonData Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员，单个是Object，多个是Array。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1370 static listSubPerson(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据人员标识获取下级人员的对象数组：person对象数组。该上下级关系被人员的汇报对象值（superior）决定。 Syntax //同步执行，返回嵌套下级人员数组。\rvar personList = this.org.listSubPerson( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSubPerson( name, false, true);\rpromise.then(function(personList){\r //personList 为返回的直接下级人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listSubPerson( name, true, function(personList){\r //personList 为返回嵌套下级人员数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有下级人员；false直接下级人员；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1417 static listSupPerson(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据人员标识获取上级人员的对象数组：person对象数组。该上下级关系被人员的汇报对象值（superior）决定。 Syntax //同步执行，返回嵌套上级人员数组。\rvar personList = this.org.listSupPerson( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSupPerson( name, false, true);\rpromise.then(function(personList){\r //personList 为返回的直接上级人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listSupPerson( name, true, function(personList){\r //personList 为返回嵌套上级人员数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有上级人员；false直接上级人员；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1466 static listPersonWithGroup(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据群组标识获取人员对象成员：person对象数组。 Syntax //同步执行，返回人员数组。\rvar personList = this.org.listPersonWithGroup( group );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonWithGroup( group, true);\rpromise.then(function(personList){\r //personList 为返回的人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonWithGroup( group, function(personList){\r //personList 为返回的人员数组。\r}) Parameters name GroupFlag | Array.&lt;GroupFlag> 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1513 static listPersonWithRole(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据角色标识获取人员对象数组：person对象数组。 Syntax //同步执行，返回人员数组。\rvar personList = this.org.listPersonWithRole( role );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonWithRole( role, true);\rpromise.then(function(personList){\r //personList 为返回的人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonWithRole( role, function(personList){\r //personList 为返回的人员数组。\r}) Parameters name RoleFlag | Array.&lt;RoleFlag> 角色的distinguishedName、name、id、unique属性值，角色对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1555 static listPersonWithIdentity(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据身份标识获取人员对象成员：person对象数组。 Syntax //同步执行，返回人员数组。\rvar personList = this.org.listPersonWithIdentity( identity );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonWithIdentity( identity, true);\rpromise.then(function(personList){\r //personList 为返回的人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonWithIdentity( identity, function(personList){\r //personList 为返回的人员数组。\r}) Parameters name IdentityFlag | Array.&lt;IdentityFlag> 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1597 static listPersonWithUnit(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据组织标识获取人员对象成员：person对象数组。 Syntax //同步执行，返回组织的直接人员数组。\rvar personList = this.org.listPersonWithUnit( unit );\r\r//同步执行，返回组织的以及嵌套下级组织所有的人员数组。\rvar personList = this.org.listPersonWithUnit( unit, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonWithUnit( unit, false, true);\rpromise.then(function(personList){\r //personList 为返回的组织的直接人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonWithUnit( unit, false, function(personList){\r //personList 为返回的群组的直接人员数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; 是否嵌套获取组织以及下级组织的人员，true表示嵌套，flase表示获取直接组织。默认为false asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1654 static listPersonWithAttribute(name, value, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;PersonData>} 根据人员属性名称和属性值获取人员对象成员：person对象数组。 Syntax //同步执行，返回拥有对应属性名和属性值人员数组。\rvar personList = this.org.listPersonWithAttribute( name, value );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonWithAttribute( name, value, true);\rpromise.then(function(personList){\r //personList 返回拥有对应属性名和属性值人员数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonWithAttribute( name, value, function(personList){\r //personList 返回拥有对应属性名和属性值人员数组。\r}) Parameters name String 人员属性名称。 value String 人员属性值。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;PersonData> 当async为true时，返回 Promise。 否则返回人员对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//数据库主键 \t\"name\": \"李四\",\t\t//个人名称 \t\"genderType\": \" \",//可选值:f,m,d,\t\t//性别,m:男,f:女,d:未知 \t\"signature\": \" \",\t\t//签名 \t\"description\": \" \",\t\t//说明 \t\"employee\": \"1111\",\t\t//员工号 \t\"unique\": \"lisi\",\t\t//唯一标识 \t\"distinguishedName\": \"李四@lisi@P\",\t\t//识别名 \t\"orderNumber\": 14214946,\t\t//排序号 \t\"superior\": \" \",\t\t//主管 \t\"mail\": \" \",\t\t//邮件地址 \t\"weixin\": \" \",\t\t//微信号 \t\"qq\": \" \",\t\t//qq号 \t\"mobile\": \"85252281460\",\t\t//手机号 \t\"officePhone\": \" \",\t\t//办公电话 \t\"boardDate\": \"2021-02-23 17:06:17\",\t\t//入职时间 \t\"birthday\": \"2021-02-23 17:06:17\",\t\t//生日 \t\"age\": 1,\t\t//年龄 \t\"qiyeweixinId\": \" \",\t\t//企业微信Id \t\"dingdingId\": \" \",\t\t//钉钉Id \t\"zhengwuDingdingId\": \" \",\t\t//政务钉钉Id \t\"weLinkId\": \" \" \t\t//华为WeLink id } Source o2_core/o2/xScript/ViewEnvironment.js, line 1706 static getDuty(dutyName, unit, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;IdentityData>} 根据职务名称和组织名称获取身份。 Syntax //同步执行，返回身份数组。\rvar identityList = this.org.getDuty( dutyName, unit );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getDuty( dutyName, unit, true);\rpromise.then(function(identityList){\r //identityList 返回身份数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.getDuty( dutyName, unit, function(unitList){\r //unitList 返回身份数组。\r}) Parameters dutyName String 组织职务名称。 unit UnitFlag 组织的distinguishedName、name、id、unique属性值，组织对象。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;IdentityData> 当async为true时，返回 Promise。 否则返回身份数组。 { \t\"id\": \" \",\t\t//数据库主键,自动生成. \t\"pinyin\": \" \",\t\t//name拼音,自动生成 \t\"pinyinInitial\": \" \",\t\t//name拼音首字母,自动生成 \t\"description\": \" \",\t\t//描述. \t\"name\": \"李四\",\t\t//名称,同一组织下不可重名. \t\"unique\": \"23dd1b53-feed-485d-8c9c-1a4e64ff58a2\",\t\t//唯一标识,不可重复,为空则使用自动填充值 \t\"distinguishedName\": \"李四@23dd1b53-feed-485d-8c9c-1a4e64ff58a2@I\",\t\t//识别名,自动填充,@UD结尾. \t\"unit\": \"开发部@kfb@U\",\t\t//组织职务所属组织,不可为空. \t\"orderNumber\": 24920439,\t\t//排序号,升序排列,为空在最后 \t\"identityList\": [ \t\t\" \" \t],\t\t//组织职务身份成员,多值. \t\"createTime\": \"2021-02-23 17:06:17\",\t\t//创建时间,自动生成,索引创建在约束中. \t\"updateTime\": \"2021-02-23 17:06:17\" \t\t//修改时间,自动生成,索引创建在约束中. } Source o2_core/o2/xScript/ViewEnvironment.js, line 1766 static listDutyNameWithIdentity(identity, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;String>} 批量获取身份的所有职务名称。 Syntax //同步执行，返回职务名称数组。\rvar dutyNameList = this.org.listDutyNameWithIdentity( identity );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listDutyNameWithIdentity( identity, true);\rpromise.then(function(dutyNameList){\r //dutyNameList 返回职务名称数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listDutyNameWithIdentity( identity, function(dutyNameList){\r //dutyNameList 返回职务名称数组。\r}) Parameters identity IdentityFlag | Array.&lt;IdentityFlag> 身份的distinguishedName、name、id、unique属性值，身份对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;String> 当async为true时，返回 Promise。 否则返回职务名称数组。 Source o2_core/o2/xScript/ViewEnvironment.js, line 1809 static listDutyNameWithUnit(unit, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;String>} 批量获取组织的所有职务名称。 Syntax //同步执行，返回职务名称数组。\rvar dutyNameList = this.org.listDutyNameWithUnit( unit );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listDutyNameWithUnit( unit, true);\rpromise.then(function(dutyNameList){\r //dutyNameList 返回职务名称数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listDutyNameWithUnit( unit, function(dutyNameList){\r //dutyNameList 返回职务名称数组。\r}) Parameters unit UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;String> 当async为true时，返回 Promise。 否则返回职务名称数组。 Source o2_core/o2/xScript/ViewEnvironment.js, line 1849 static listUnitAllDuty(unit, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;Object>} 批量获取组织的所有职务。 Syntax //同步执行，返回职务数组。\rvar dutyList = this.org.listUnitAllDuty( unit );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitAllDuty( unit, true);\rpromise.then(function(dutyList){\r //dutyList 返回职务数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitAllDuty( unit, function(dutyList){\r //dutyList 返回职务数组。\r}) Parameters unit UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;Object> 当async为true时，返回 Promise。 否则返回职务数组 { \t\"name\": \"李四\",\t\t//个人属性名称 \t\"unit\": \"开发部@kfb@U\",\t\t//组织 \t\"identityList\": [ \t\t{ \t\t\t\"matchKey\": \" \",\t\t//匹配字段 \t\t\t\"name\": \" \",\t\t//身份名称 \t\t\t\"unique\": \" \",\t\t//身份标识 \t\t\t\"description\": \" \",\t\t//说明 \t\t\t\"distinguishedName\": \" \",\t\t//识别名 \t\t\t\"person\": \" \",\t\t//人员 \t\t\t\"unit\": \" \",\t\t//组织 \t\t\t\"unitName\": \" \",\t\t//组织名称 \t\t\t\"unitLevel\": 1,\t\t//组织级别 \t\t\t\"unitLevelName\": \" \",\t\t//组织级别名 \t\t\t\"orderNumber\": 1,\t\t//排序号 \t\t\t\"major\": true,\t\t//是否是设定的主身份 \t\t\t\"serialVersionUID\": 1 \t\t} \t] \t\t//身份对象 } Source o2_core/o2/xScript/ViewEnvironment.js, line 1889 static getGroup(name, asyncOrCallbackopt) &rarr; {Promise|GroupData|Array.&lt;GroupData>} 根据群组标识获取对应的群组对象或数组：group对象或数组 Syntax //同步执行，返回群组，单个是Object，多个是Array。\rvar groupList = this.org.getGroup( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getGroup( name, true);\rpromise.then(function(groupList){\r //groupList 为返回的群组，单个是Object，多个是Array。\r})\r\r//异步执行，在回调方法中获取群组\rthis.org.getGroup( name, function(groupList){\r //groupList 为返回的群组，单个是Object，多个是Array。\r}) Parameters name GroupFlag | Array.&lt;GroupFlag> 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise GroupData Array.&lt;GroupData> 当async为true时，返回 Promise。 否则返回群组，单个是Object，多个是Array。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//群组id \t\"name\": \"工作汇报读者\",\t\t//群组名称 \t\"unique\": \"ReportReader\",\t\t//群组标识 \t\"description\": \"可查看所有部门所有状态的工作汇报\",\t\t//说明 \t\"distinguishedName\": \"工作汇报读者@ReportReader@G\",\t\t//识别名 \t\"orderNumber\": 13699599,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//个人成员 \t\"groupList\": [ \t\t\"所有部门领导@AllDepartLeader@G\" \t\t\"所有部门汇报管理员@AllDepartReportManager@G\" \t],\t\t//群组成员 \t\"unitList\": [ \t\t\" \" \t],\t\t//组织成员 \t\"identityList\": [ \t\t\" \" \t],\t\t//身份成员 \t\"subDirectGroupCount\": 1,\t\t//直接下级组织数量 \t\"subDirectPersonCount\": 1,\t\t//直接下级用户数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"subDirectOrgCount\": 1 \t\t//直接下级组织数量 } Source o2_core/o2/xScript/ViewEnvironment.js, line 1932 static listSubGroup(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;GroupData>} 根据群组标识获取下级群组的对象数组：group对象数组。 Syntax //同步执行，返回嵌套下级群组数组。\rvar groupList = this.org.listSubGroup( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSubGroup( name, false, true);\rpromise.then(function(groupList){\r //groupList 为返回的直接下级群组数组。\r})\r\r//异步执行，在回调方法中获取群组\rthis.org.listSubGroup( name, true, function(groupList){\r //groupList 为返回嵌套下级群组数组。\r}) Parameters name GroupFlag | Array.&lt;GroupFlag> 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有下级群组；false直接下级群组；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;GroupData> 当async为true时，返回 Promise。 否则返回群组数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//群组id \t\"name\": \"工作汇报读者\",\t\t//群组名称 \t\"unique\": \"ReportReader\",\t\t//群组标识 \t\"description\": \"可查看所有部门所有状态的工作汇报\",\t\t//说明 \t\"distinguishedName\": \"工作汇报读者@ReportReader@G\",\t\t//识别名 \t\"orderNumber\": 13699599,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//个人成员 \t\"groupList\": [ \t\t\"所有部门领导@AllDepartLeader@G\" \t\t\"所有部门汇报管理员@AllDepartReportManager@G\" \t],\t\t//群组成员 \t\"unitList\": [ \t\t\" \" \t],\t\t//组织成员 \t\"identityList\": [ \t\t\" \" \t],\t\t//身份成员 \t\"subDirectGroupCount\": 1,\t\t//直接下级组织数量 \t\"subDirectPersonCount\": 1,\t\t//直接下级用户数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"subDirectOrgCount\": 1 \t\t//直接下级组织数量 } Source o2_core/o2/xScript/ViewEnvironment.js, line 1981 static listSupGroup(name, nestedopt, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;GroupData>} 根据群组标识获取上级群组的对象数组：group对象数组。 Syntax //同步执行，返回嵌套上级群组数组。\rvar groupList = this.org.listSupGroup( name, true );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listSupGroup( name, false, true);\rpromise.then(function(groupList){\r //groupList 为返回的直接上级群组数组。\r})\r\r//异步执行，在回调方法中获取群组\rthis.org.listSupGroup( name, true, function(groupList){\r //groupList 为返回嵌套上级群组数组。\r}) Parameters name GroupFlag | Array.&lt;GroupFlag> 群组的distinguishedName、name、id、unique属性值，群组对象，或上述属性值和对象的数组。 nested Boolean &lt;optional&gt; true嵌套的所有上级群组；false直接上级群组；默认false。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;GroupData> 当async为true时，返回 Promise。 否则返回群组数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//群组id \t\"name\": \"工作汇报读者\",\t\t//群组名称 \t\"unique\": \"ReportReader\",\t\t//群组标识 \t\"description\": \"可查看所有部门所有状态的工作汇报\",\t\t//说明 \t\"distinguishedName\": \"工作汇报读者@ReportReader@G\",\t\t//识别名 \t\"orderNumber\": 13699599,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//个人成员 \t\"groupList\": [ \t\t\"所有部门领导@AllDepartLeader@G\" \t\t\"所有部门汇报管理员@AllDepartReportManager@G\" \t],\t\t//群组成员 \t\"unitList\": [ \t\t\" \" \t],\t\t//组织成员 \t\"identityList\": [ \t\t\" \" \t],\t\t//身份成员 \t\"subDirectGroupCount\": 1,\t\t//直接下级组织数量 \t\"subDirectPersonCount\": 1,\t\t//直接下级用户数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"subDirectOrgCount\": 1 \t\t//直接下级组织数量 } Source o2_core/o2/xScript/ViewEnvironment.js, line 2042 static listGroupWithPerson(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;GroupData>} 根据人员标识获取所有的群组对象数组。如果群组具有群组（group）成员，且群组成员中包含该人员，那么该群组也被返回。 Syntax //同步执行，返回群组数组。\rvar groupList = this.org.listGroupWithPerson( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listGroupWithPerson( name, true);\rpromise.then(function(groupList){\r //groupList 为返回的群组数组。\r})\r\r//异步执行，在回调方法中获取群组\rthis.org.listGroupWithPerson( name, function(groupList){\r //groupList 为返回的群组数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;GroupData> 当async为true时，返回 Promise。 否则返回群组对象数组。 { \t\"matchKey\": \" \",\t\t//匹配字段 \t\"id\": \" \",\t\t//群组id \t\"name\": \"工作汇报读者\",\t\t//群组名称 \t\"unique\": \"ReportReader\",\t\t//群组标识 \t\"description\": \"可查看所有部门所有状态的工作汇报\",\t\t//说明 \t\"distinguishedName\": \"工作汇报读者@ReportReader@G\",\t\t//识别名 \t\"orderNumber\": 13699599,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//个人成员 \t\"groupList\": [ \t\t\"所有部门领导@AllDepartLeader@G\" \t\t\"所有部门汇报管理员@AllDepartReportManager@G\" \t],\t\t//群组成员 \t\"unitList\": [ \t\t\" \" \t],\t\t//组织成员 \t\"identityList\": [ \t\t\" \" \t],\t\t//身份成员 \t\"subDirectGroupCount\": 1,\t\t//直接下级组织数量 \t\"subDirectPersonCount\": 1,\t\t//直接下级用户数量 \t\"subDirectIdentityCount\": 1,\t\t//直接下级身份数量 \t\"subDirectOrgCount\": 1 \t\t//直接下级组织数量 } Source o2_core/o2/xScript/ViewEnvironment.js, line 2097 static getRole(name, asyncOrCallbackopt) &rarr; {Promise|RoleData|Array.&lt;RoleData>} 根据角色标识获取对应的角色对象或数组。 Syntax //同步执行，返回角色，单个为对象，多个为数组。\rvar roleList = this.org.getRole( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getRole( name, true);\rpromise.then(function(roleList){\r //roleList 为返回的角色，单个为对象，多个为数组。\r})\r\r//异步执行，在回调方法中获取角色，单个为对象，多个为数组\rthis.org.getRole( name, function(roleList){\r //roleList 为返回判断结果。\r}) Parameters name RoleFlag | Array.&lt;RoleFlag> 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise RoleData Array.&lt;RoleData> 当async为true时，返回 Promise。 否则返回角色，单个为Object，多个为Array。 { \t\"name\": \"Manager\",\t\t//角色名称 \t\"unique\": \"ManagerSystemRole\",\t\t//唯一标识 \t\"description\": \" \",\t\t//说明 \t\"distinguishedName\": \"Manager@ManagerSystemRole@R\",\t\t//识别名 \t\"orderNumber\": 7897556,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//成员个人 \t\"groupList\": [ \t\t\"测试群组@ceshizu@G\" \t] \t\t//成员群组 } Source o2_core/o2/xScript/ViewEnvironment.js, line 2144 static listRoleWithPerson(name, asyncOrCallbackopt) &rarr; {Promise|Array.&lt;RoleData>} 根据人员标识获取所有的角色对象数组。如果角色具有群组（group）成员，且群组中包含该人员，那么该角色也被返回。 Syntax //同步执行，返回角色数组。\rvar roleList = this.org.listRoleWithPerson( name );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listRoleWithPerson( name, true);\rpromise.then(function(roleList){\r //roleList 为返回的角色数组。\r})\r\r//异步执行，在回调方法中获取角色\rthis.org.listRoleWithPerson( name, function(roleList){\r //roleList 为返回的角色数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Array.&lt;RoleData> 当async为true时，返回 Promise。 否则返回角色对象数组。 { \t\"name\": \"Manager\",\t\t//角色名称 \t\"unique\": \"ManagerSystemRole\",\t\t//唯一标识 \t\"description\": \" \",\t\t//说明 \t\"distinguishedName\": \"Manager@ManagerSystemRole@R\",\t\t//识别名 \t\"orderNumber\": 7897556,\t\t//排序号 \t\"personList\": [ \t\t\"张三@zhangsan@P\" \t\t\"李四@lisi@P\" \t],\t\t//成员个人 \t\"groupList\": [ \t\t\"测试群组@ceshizu@G\" \t] \t\t//成员群组 } Source o2_core/o2/xScript/ViewEnvironment.js, line 2191 static personHasRole(name, roleList, asyncOrCallbackopt) &rarr; {Promise|Boolean} 人员是否拥有角色。 Syntax //同步执行，返回判断结果。\rvar groupList = this.org.personHasRole( name, roleList );\r\r//异步执行，返回Promise对象\rvar promise = this.org.personHasRole( name, roleList, true);\rpromise.then(function(flag){\r //flag 为返回判断结果。\r})\r\r//异步执行，在回调方法中获取判断结果\rthis.org.personHasRole( name, roleList, function(flag){\r //flag 为返回判断结果。\r}) Parameters name PersonFlag 人员的distinguishedName、name、id、unique属性值，人员对象。 roleList RoleFlag | Array.&lt;RoleFlag> 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Boolean 当async为true时，返回 Promise。 否则如果人员拥有角色返回true, 否则返回false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2238 static groupHasRole(name, roleList, asyncOrCallbackopt) &rarr; {Promise|Boolean} 群组是否拥有角色。 Syntax //同步执行，返回判断结果。\rvar groupList = this.org.groupHasRole( name, roleList );\r\r//异步执行，返回Promise对象\rvar promise = this.org.groupHasRole( name, roleList, true);\rpromise.then(function(flag){\r //flag 为返回判断结果。\r})\r\r//异步执行，在回调方法中获取判断结果\rthis.org.groupHasRole( name, roleList, function(flag){\r //flag 为返回判断结果。\r}) Parameters name GroupFlag 群组的distinguishedName、name、id、unique属性值，群组对象。 roleList RoleFlag | Array.&lt;RoleFlag> 角色的distinguishedName、name、id、unique属性值，角色对象；或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Promise Boolean 当async为true时，返回 Promise。 否则如果群组拥有角色返回true, 否则返回false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2285 static appendPersonAttribute(person, attr, values, successopt, failureopt, asyncopt) 添加人员属性值(在属性中添加values值，如果没有此属性，则创建一个) Syntax //同步执行\rthis.org.appendPersonAttribute( person, attribute, valueArray);\r\r//异步执行\rthis.org.appendPersonAttribute( person, attribute, valueArray, function(){\r //执行成功的回调\r}, null, true); Parameters person PersonFlag 人员的distinguishedName、name、id、unique属性值，人员对象。 attr String 属性名称。 values Array.&lt;String> 属性值，必须为数组。 success function &lt;optional&gt; 执行成功的回调。 failure function &lt;optional&gt; 执行失败的回调。 async Boolean &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2334 static setPersonAttribute(person, attr, values, successopt, failureopt, asyncopt) 设置人员属性值(将属性值修改为values，如果没有此属性，则创建一个) Syntax //同步执行\rthis.org.setPersonAttribute( person, attribute, valueArray);\r\r//异步执行\rthis.org.setPersonAttribute( person, attribute, valueArray, function(){\r //执行成功的回调\r}, null, true); Parameters person PersonFlag 人员的distinguishedName、name、id、unique属性值，人员对象。 attr String 属性名称。 values Array.&lt;String> 属性值，必须为数组。 success function &lt;optional&gt; 执行成功的回调。 failure function &lt;optional&gt; 执行失败的回调。 async Boolean &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2369 static getPersonAttribute(person, attr, asyncOrCallbackopt) &rarr; {Array.&lt;String>} 根据人员和属性名称获取属性值数组。 Syntax //同步执行，返回该人员的属性值数组。\rvar attributeList = this.org.getPersonAttribute( person, attr );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getPersonAttribute( person, attr, true);\rpromise.then(function(attributeList){\r //attributeList 为返回该人员的属性值数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.getPersonAttribute( person, attr, function(attributeList){\r //attributeList 为返回该人员的属性值数组。\r}) Parameters person PersonFlag 人员的distinguishedName、name、id、unique属性值，人员对象。 attr String 属性名称。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;String> 当async为true时，返回 Promise。 否则返回属性值数组， 如：[ value1, value2 ] Source o2_core/o2/xScript/ViewEnvironment.js, line 2404 static listPersonAttributeName(name, asyncOrCallbackopt) &rarr; {Array.&lt;String>} 列出人员所有属性的名称数组。 Syntax //同步执行，返回人员所有属性的名称数组。\rvar attributeNameList = this.org.listPersonAttributeName( person );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonAttributeName( person, true);\rpromise.then(function(attributeNameList){\r //attributeNameList 为人员所有属性的名称数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonAttributeName( person, function(attributeNameList){\r //attributeNameList 为人员所有属性的名称数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;String> 当async为true时，返回 Promise。 否则返回人员属性名称数组， 如：[ attributeName1, attributeName2 ] Source o2_core/o2/xScript/ViewEnvironment.js, line 2447 static listPersonAllAttribute(name, asyncOrCallbackopt) &rarr; {Array.&lt;Object>} 列出人员的所有属性对象数组。 Syntax //同步执行，返回人员所有属性的对象数组。\rvar attributeObjectList = this.org.listPersonAllAttribute( person );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listPersonAllAttribute( person, true);\rpromise.then(function(attributeObjectList){\r //attributeObjectList 为人员所有属性的对象数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listPersonAllAttribute( person, function(attributeObjectList){\r //attributeObjectList 为人员所有属性的对象数组。\r}) Parameters name PersonFlag | Array.&lt;PersonFlag> 人员的distinguishedName、name、id、unique属性值，人员对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;Object> 当async为true时，返回 Promise。 否则返回人员属性对象数组，如： [{ \"name\": \"住址\", \"person\": \"张三@zhangsan@P\", \"attributeList\": [ \"杭州市\",\"绍兴市\" ] }] Source o2_core/o2/xScript/ViewEnvironment.js, line 2488 static appendUnitAttribute(unit, attribute, valueArray, successopt, failureopt, asyncopt) 添加组织属性值(在属性中添加values值，如果没有此属性，则创建一个) Syntax //同步执行\rthis.org.appendUnitAttribute( unit, attribute, valueArray);\r\r//异步执行\rthis.org.appendUnitAttribute( unit, attribute, valueArray, function(){\r //执行成功的回调\r}, null, true); Parameters unit UnitFlag 组织的distinguishedName、name、id、unique属性值，组织对象。 attribute String 属性名称。 valueArray Array.&lt;String> 属性值，必须为数组。 success function &lt;optional&gt; 执行成功的回调。 failure function &lt;optional&gt; 执行失败的回调。 async Boolean &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2537 static setUnitAttribute(unit, attribute, valueArray, successopt, failureopt, asyncopt) 设置组织属性值(将属性值修改为values，如果没有此属性，则创建一个) Syntax //同步执行\rthis.org.setUnitAttribute( unit, attribute, valueArray);\r\r//异步执行\rthis.org.setUnitAttribute( unit, attribute, valueArray, function(){\r //执行成功的回调\r}, null, true); Parameters unit UnitFlag 组织的distinguishedName、name、id、unique属性值，组织对象。 attribute String 属性名称。 valueArray Array.&lt;String> 属性值，必须为数组。 success function &lt;optional&gt; 执行成功的回调。 failure function &lt;optional&gt; 执行失败的回调。 async Boolean &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。 Source o2_core/o2/xScript/ViewEnvironment.js, line 2582 static getUnitAttribute(unit, attr, asyncOrCallbackopt) &rarr; {Array.&lt;String>} 根据组织标识和属性名称获取对应属性值。 Syntax //同步执行，返回该组织的属性值数组。\rvar attributeList = this.org.getUnitAttribute( unit, attr );\r\r//异步执行，返回Promise对象\rvar promise = this.org.getUnitAttribute( unit, attr, true);\rpromise.then(function(attributeList){\r //attributeList 为返回该组织的属性值数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.getUnitAttribute( unit, attr, function(attributeList){\r //attributeList 为返回该组织的属性值数组。\r}) Parameters unit UnitFlag 组织的distinguishedName、name、id、unique属性值，组织对象。 attr String 属性名称。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;String> 当async为true时，返回 Promise。 否则返回属性值数组， 如：[ value1, value2 ] Source o2_core/o2/xScript/ViewEnvironment.js, line 2626 static listUnitAttributeName(name, asyncOrCallbackopt) &rarr; {Array.&lt;String>} 列出组织所有属性的名称数组。 Syntax //同步执行，返回组织所有属性的名称数组。\rvar attributeNameList = this.org.listUnitAttributeName( unit );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitAttributeName( unit, true);\rpromise.then(function(attributeNameList){\r //attributeNameList 为组织所有属性的名称数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitAttributeName( unit, function(attributeNameList){\r //attributeNameList 为组织所有属性的名称数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;String> 当async为true时，返回 Promise。 否则返回组织属性名称数组， 如：[ attributeName1, attributeName2 ] Source o2_core/o2/xScript/ViewEnvironment.js, line 2669 static listUnitAllAttribute(name, asyncOrCallbackopt) &rarr; {Array.&lt;Object>} 列出组织的所有属性对象数组。 Syntax //同步执行，返回组织所有属性的对象数组。\rvar attributeObjectList = this.org.listUnitAllAttribute( unit );\r\r//异步执行，返回Promise对象\rvar promise = this.org.listUnitAllAttribute( unit, true);\rpromise.then(function(attributeObjectList){\r //attributeObjectList 为组织所有属性的对象数组。\r})\r\r//异步执行，在回调方法中获取\rthis.org.listUnitAllAttribute( unit, function(attributeObjectList){\r //attributeObjectList 为组织所有属性的对象数组。\r}) Parameters name UnitFlag | Array.&lt;UnitFlag> 组织的distinguishedName、name、id、unique属性值，组织对象，或上述属性值和对象的数组。 asyncOrCallback Boolean | function &lt;optional&gt; 当参数为boolean，表示是否异步执行，默认为false。当参数为function，表示回调方法。 Returns Array.&lt;Object> 当async为true时，返回 Promise。 否则返回组织属性对象数组，如： [{ \"name\": \"部门类别\", \"unit\": \"开发部@kfb@U\", \"attributeList\": [ \"生产部门\", \"二级部门\" ] }] Source o2_core/o2/xScript/ViewEnvironment.js, line 2710 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-view.html":{"url":"module-view.html","title":"view","kind":"Module","body":" O2OA WebAPI: view | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FlookupFselect Module view 您可以通过view对象，获取视图数据或选择视图数据。 Syntax //您可以在流程表单、内容管理表单或门户页面中，通过this来获取view对象，如下：\rvar view = this.view; Source o2_core/o2/xScript/ViewEnvironment.js, line 2799 Methods static lookup(view, callback, asyncopt) 获取指定视图的数据。 Syntax this.view.lookup(view, callback, async); Parameters view Object 要访问的视图信息。数据格式如下： 以下的filter参数参考ViewFilter { \"view\" : \"testView\", //（String）必选，视图的名称、别名或ID \"application\" : \"test数据中心应用\", //（String）必选，视图所在数据应用的名称、别名或ID \"filter\": [ //（Array of Object）可选，对视图进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件。 { \"logic\":\"and\", \"path\":\"$work.title\", \"comparison\":\"like\", \"value\":\"7月\", \"formatType\":\"textValue\" } ] } callback function 访问成功后的回调函数 async Boolean &lt;optional&gt; 同步或异步调用。true：异步；false：同步。默认为true。 Examples //获取“财务管理”应用中“报销审批数据”视图中的数据\r//过滤条件为标题（$work.title）包含包含（like））“7月”。\rthis.view.lookup({\r \"view\": \"报销审批数据\",\r \"application\": \"财务管理\",\r \"filter\": [\r {\r \"logic\":\"and\",\r \"path\":\"$work.title\",\r \"comparison\":\"like\",\r \"value\":\"7月\",\r \"formatType\":\"textValue\"\r }\r ]\r}, function(data){\r var result = data.grid; //得到过滤后的数据\r //......\r}); //获取“财务管理”应用中“报销审批数据”视图中的数据\r//过滤条件为标题（$work.title）包含包含（like））“7月”，并且总金额大于500小于5000\rthis.view.lookup({\r \"view\": \"报销审批数据\",\r \"application\": \"财务管理\",\r \"filter\": [\r {\r \"logic\":\"and\",\r \"path\":\"$work.title\",\r \"comparison\":\"like\",\r \"value\":\"7月\",\r \"formatType\":\"textValue\"\r },\r {\r \"logic\":\"and\",\r \"path\":\"amount\",\r \"comparison\":\"range\",\r \"value\":500,\r \"otherValue\":5000,\r \"formatType\":\"numberValue\"\r },\r ]\r}, function(data){\r var result = data.grid; //得到过滤后的数据\r //......\r}); Source o2_core/o2/xScript/ViewEnvironment.js, line 2808 static select(view, callback) 通过视图进行数据选择。 Syntax this.view.select(view, callback); Parameters view Object 要访问的视图信息。数据格式如下： 以下的filter参数参考ViewFilter { \"view\" : \"testView\", //（String）必选，视图的名称、别名或ID \"application\" : \"test数据中心应用\", //（String）必选，视图所在数据应用的名称、别名或ID \"isTitle\" : true, //（Boolean）可选，是否显示视图标题。默认true \"isMulti\" : true, //（Boolean）可选，是否允许多选。默认true \"width\" : 700, //（Number）可选，选择框的宽度。默认700 \"height\" : 400, //（Number）可选，选择框的高度。默认400 \"caption\" : \"标题\", //（String）可选，选择框的标题 \"filter\": [ //（Array of Object）可选，对视图进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件。 { \"logic\":\"and\", \"path\":\"$work.title\", \"comparison\":\"like\", \"value\":\"7月\", \"formatType\":\"textValue\" } ] } callback function 必选，当选择完成，点击“确定”之后的回调函数。 Example this.view.select({\r \"application\": \"物业材料\", //数据中心中的应用\r \"view\": \"物业材料视图\", //视图的名称\r \"isMulti\": false, //只允许单选\r}, function(items) {\r //如果选择了某个数据，将数据赋值给表单输入框\r if (items.length) {\r //物料名称，表单中输入框名为“materialName”， 视图中列的名称为“ylmc”\r this.data.materialName = items[0].data.ylmc;\r //规格，表单中输入框名为“specification”， 视图中列的名称为“gg”\r this.data.specification = items[0].data.gg;\r //单价，表单中输入框名为“price”， 视图中列的名称为“dj”\r this.data.price = items[0].data.dj;\r }\r}.bind(this)); Source o2_core/o2/xScript/ViewEnvironment.js, line 2905 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-statement.html":{"url":"module-statement.html","title":"statement","kind":"Module","body":" O2OA WebAPI: statement | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FexecuteFselect Module statement 您可以通过statement对象，获取执行查询语句或者对查询结果进行选择。 Syntax //您可以在流程表单、内容管理表单、门户页面或视图中，通过this来获取statement对象，如下：\rvar statement = this.statement; Source o2_core/o2/xScript/ViewEnvironment.js, line 3039 Methods static execute(statement, callback, asyncopt) 执行指定的查询语句。 Syntax this.statement.execute(statement, callback, async); Parameters statement Object 要执行的查询语句的信息。数据格式如下： 以下的filter参数参考StatementFilter, parameter参数参考StatementParameter { \"name\" : \"tesStatement\", //（String）必选，查询配置的名称、别名或ID \"mode\" : \"all\", //（String）必选，“all”、“data”或者“count”，all表示同时执行查询语句和总数语句，data表示执行查询语句，count表示执行总数语句 \"page\" : 1, //（number）可选，当前页码，默认为1 \"pageSize\" : 20, //（number）可选，每页的数据条数，默认为20 \"filter\": [ //（Array）可选，对查询进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件，每个元素数据格式如下： { \"path\":\"o.title\", \"comparison\":\"like\", \"value\":\"关于\", \"formatType\":\"textValue\" } ], parameter : { \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组) \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型 \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询 \"processName\" : \"test流程\" //其他写确定的值 } } callback function 访问成功后的回调函数 async Boolean &lt;optional&gt; 同步或异步调用。true：异步；false：同步。默认为true。 Example //获取“task”查询中的数据\r//查询语句为 select o from Task o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)\r//总数语句为 select count(o.id) from Task o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)\r//过滤条件为标题o.title包含包含（like））“7月”。\rthis.statement.execute({\r \"name\": \"task\",\r \"mode\" : \"all\",\r \"filter\": [\r {\r \"path\":\"o.title\",\r \"comparison\":\"like\",\r \"value\":\"7月\",\r \"formatType\":\"textValue\"\r }\r],\r\"parameter\" : {\r \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组)\r \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型\r \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询\r \"processName\" : \"test流程\" //其他写确定的值\r }\r}, function(json){\r var count = json.count; //总数语句执行后返回的数字\r var list = json.data; //查询语句后返回的数组\r //......\r}); Source o2_core/o2/xScript/ViewEnvironment.js, line 3048 static select(statement, callback) 如果查询的类型是&quot;select&quot;，并且配置了查询视图，可以通过本方法进行数据选择。 Syntax this.statement.select(statement, callback); Parameters statement Object 要访问的查询配置的信息。数据格式如下： 以下的filter参数参考StatementFilter, parameter参数参考StatementParameter { \"name\" : \"tesStatement\", //（String）必选，查询配置的名称、别名或ID \"isTitle\" : true, //（Boolean）可选，是否显示视图标题。默认true \"isMulti\" : true, //（Boolean）可选，是否允许多选。默认true \"width\" : 700, //（Number）可选，选择框的宽度。默认700 \"height\" : 400, //（Number）可选，选择框的高度。默认400 \"caption\" : \"标题\", //（String）可选，选择框的标题 \"filter\": [ //（Array）可选，对查询进行过滤的条件。json数组格式，每个数组元素描述一个过滤条件，每个元素数据格式如下： { \"path\":\"o.title\", \"comparison\":\"like\", \"value\":\"关于\", \"formatType\":\"textValue\" } ], parameter : { \"person\" : \"\", //参数名称为下列值时，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组) \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型 \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询 \"processName\" : \"test流程\" //其他写确定的值 } } callback function 访问成功后的回调函数 Example this.statement.select({\r \"name\": \"物业材料查询\", //查询的名称\r \"isMulti\": false, //只允许单选\r}, function(items) {\r //如果选择了某个数据，将数据赋值给表单输入框\r if (items.length) {\r //物料名称，表单中输入框名为“materialName”， 查询语句返回的字段名为“ylmc”\r this.data.materialName = items[0].ylmc;\r //规格，表单中输入框名为“specification”， 查询语句返回的字段名为“gg”\r this.data.specification = items[0].gg;\r //单价，表单中输入框名为“price”， 查询语句返回的字段名为“dj”\r this.data.price = items[0].dj;\r }\r}.bind(this)); Source o2_core/o2/xScript/ViewEnvironment.js, line 3162 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-queryStatement.html":{"url":"module-queryStatement.html","title":"queryStatement","kind":"Module","body":" O2OA WebAPI: queryStatement | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetParentEnvironmentFgetPageInforFgetPageDataFtoPageFselectAllFunSelectAllFgetSelectedDataFnodeFgetStatementInforFsetStatementFilterFswitchStatementFconfirmFalertFnoticeFaddEventFopenWorkFopenJobFopenDocumentFopenPortalFopenCMSFopenProcessFopenApplicationFcreateDocumentFstartProcess Module queryStatement 当查询设计中使用了select语句，并且配置了视图，可以在查询视图中使用本章API。 queryStatement对象在查询视图中可用。它的很多方法与queryView类似。（仅前端脚本可用） Usable Range QueryStatement Syntax //您可以在查询视图中，通过this来获取queryStatement对象，如下：\rvar queryStatement = this.queryStatement; Source o2_core/o2/xScript/ViewEnvironment.js, line 3401 Methods static getParentEnvironment() &rarr; {MWF.xScript.Environment|MWF.xScript.CMSEnvironment} 当查询视图被嵌入到门户页面、流程表单或内容管理表单的时候，可以通过这个方法来获取页面或表单的上下文。 Syntax this.queryStatement.getParentEnvironment(); Returns MWF.xScript.Environment MWF.xScript.CMSEnvironment 页面或表单的上下文. Example var env = this.queryStatement.getParentEnvironment(); //当视图被嵌入到页面的时候，可以在视图里获取页面的上下文\renv.page.toPortal( \"公文门户\" ); //调用page的toPage() 跳转到其他门户 Source o2_core/o2/xScript/ViewEnvironment.js, line 3425 static getPageInfor() &rarr; {Object} 获取查询视图当前页的基本信息。 Syntax this.queryStatement.getPageInfor(); Returns Object 当前页的信息，格式如下: { \"pages\": 3, //总页数 \"perPageCount\": 50, //每页的条数 \"currentPageNumber\": 1 // 当前页数 } Source o2_core/o2/xScript/ViewEnvironment.js, line 3438 static getPageData() &rarr; {Array.&lt;Object>|Array.&lt;Array>} 获取当前页的数据。 Syntax var data = this.queryStatement.getPageData(); Returns Array.&lt;Object> Array.&lt;Array> 当前页数据。 数据格式和 jpql 语句的写法有关 如: \"select o from table o\" 返回 json数组 [ { \"id\" : \"id1\", \"title\" : \"title1\" }, { \"id\" : \"id2\", \"title\" : \"title2\" }, ... ] 如：\"select id, title from table o\" 返回 二维数组： [ [\"id1\", \"title1\"], [\"id2\", \"title2\"], ... ] Source o2_core/o2/xScript/ViewEnvironment.js, line 3454 static toPage(pageNumber, callbackopt) 跳转到指定的页面。 Syntax var data = this.queryStatement.toPage( pageNumber, callback ); Parameters pageNumber Number 需要跳转的页码。 callback function &lt;optional&gt; 跳转的页面数据加载完成以后的回调方法。 Example //　跳转到第2页并且获取该页的数据。\rthis.queryStatement.toPage( 2, function(){\r var data = this.queryStatement.getPageData();\r}.bind(this) ) Source o2_core/o2/xScript/ViewEnvironment.js, line 3485 static selectAll() 当查询视图设置了允许多选的时候，可以通过这个方法全部选中当前页面的条目。 Syntax this.queryStatement.selectAll(); Source o2_core/o2/xScript/ViewEnvironment.js, line 3501 static unSelectAll() 当查询视图设置了允许多选的时候，可以通过这个方法取消选中的条目。 Syntax this.queryStatement.unSelectAll(); Source o2_core/o2/xScript/ViewEnvironment.js, line 3510 static getSelectedData() &rarr; {Array.&lt;Object>|Array.&lt;Array>} 获取选中的条目的数据。 Syntax var data = this.queryStatement.getSelectedData(); Returns Array.&lt;Object> Array.&lt;Array> 选中的条目的数据。 数据格式和 jpql 语句的写法有关 如: \"select o from table o\" 返回 json数组 [ { \"id\" : \"id1\", \"title\" : \"title1\" }, { \"id\" : \"id2\", \"title\" : \"title2\" }, ... ] 如：\"select id, title from table o\" 返回 二维数组： [ [\"id1\", \"title1\"], [\"id2\", \"title2\"], ... ] Source o2_core/o2/xScript/ViewEnvironment.js, line 3519 static node() 获取queryStatement对应的DOM对象。 See module:form.node Source o2_core/o2/xScript/ViewEnvironment.js, line 3550 static getStatementInfor() &rarr; {Object} 获取查询的配置信息。 Syntax this.queryStatement.getStatementInfor(); Returns Object 查询的配置信息. { \"query\": \"26d21c71-5114-4496-8ca1-a69e56324841\", //所属应用id \"id\": \"ee334220-66d3-4f78-afce-8ccf6b995c8c\", //查询id \"name\": \"测试查询\", //名称 \"alias\": \"\", //别名 \"description\": \"\", //描述 \"table\": \"\", //自建表的id \"entityClassName\": \"com.x.processplatform.core.entity.content.Task\", //系统表表名 \"entityCategory\": \"official\", //表类型 official(系统表) 或 dynamic(自建表) \"format\": \"jpql\", //语句类型,jpql 或者 script(脚本) \"type\": \"select\", //select/update/delete \"data\": \"SELECT o FROM Task o where o.person = :person\", //查询语句 \"countData\": \"SELECT count(o.id) FROM Task o where o.person = :person\", //总数语句 \"countScriptText\" : \"\", //总数语句脚本 \"scriptText\" : \"\", //查询语句脚本 \"viewJson\": { ... } //视图相关信息 } Source o2_core/o2/xScript/ViewEnvironment.js, line 3581 static setStatementFilter(filteropt, parameteropt, callbackopt) 增加查询语句where子句的过滤条件。 Syntax this.queryStatement.setStatementFilter( filter, parameter, callback ); Parameters filter Array.&lt;StatementFilter> | Null &lt;optional&gt; 过滤条件。 过滤条件。当不传参数、参数为null或为空数组的情况下，表示清空非视图默认的过滤条件。 如果传入非空数组的时候，参数如下： [ { \"path\":\"o.title\", \"comparison\":\"like\", \"value\":\"关于\", \"formatType\":\"textValue\" } ] parameter StatementParameter &lt;optional&gt; 过滤条件。对查询语句where子句的形如&quot;:person&quot;的参数部分进行赋值，参数如下： //假设语句为 select count(o.id) from Read o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName)。 //那么可能的参数如下： { \"person\" : \"\", //出于安全考虑参数名称为下列值时，不需要填写参数值，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组) \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型 \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询 \"processName\" : \"test流程\" //其他写确定的值 } callback function &lt;optional&gt; 过滤完成并重新加载数据后的回调方法。 Source o2_core/o2/xScript/ViewEnvironment.js, line 3780 static switchStatement(options) 把当前查询视图切换成另外一个查询视图。 Syntax this.queryStatement.switchStatement( options ); Parameters options Object 需要跳转的参数配置。参数说明如下： 下列说明的filter属性参考StatementFilter， parameter属性参考StatementParameter this.queryStatement.switchStatement({ \"statementId\": statementId, //必选，查询的名称、别名、id \"isTitle\": \"yes\", //可选，是否显示视图的标题行，可选值有:yes no \"select\": \"multi\", //可选，是否允许新视图选择，如果不传，则使用原视图的配置, 可选值有： 不允许选择 none, 单选 single，多选 multi \"showActionbar\": false, //可选，是否显示操作条 \"filter\": [ //可选，增加查询语句where子句的过滤条件 { \"path\": \"o.title\", \"title\": \"标题\", \"type\": \"filter\", \"comparison\": \"like\", \"formatType\": \"textValue\", \"value\": \"测试\" } ], //假设语句为 select count(o.id) from Read o where (o.person = :person) and (o.startTime > :startTime) and (o.applicationName like :applicationName) and (o.processName = :processName) \"parameter\" : { //可选，对查询语句where语句的形如\":person\"的参数部分进行赋值 \"person\" : \"\", //出于安全考虑参数名称为下列值时，不需要填写参数值，后台默认赋值，person(当前人),identityList(当前人身份列表),unitList(当前人所在直接组织), unitAllList(当前人所在所有组织), groupList(当前人所在群组) \"startTime\" : (new Date(\"2020-01-01\")), //如果对比的是日期，需要传入 Date 类型 \"applicationName\" : \"%test%\", //如果运算符用的是 like, noLike，模糊查询 \"processName\" : \"test流程\" //其他写确定的值 } }) Source o2_core/o2/xScript/ViewEnvironment.js, line 3851 static confirm() 弹出一个确认框。 See module:form.confirm Source o2_core/o2/xScript/ViewEnvironment.js, line 3928 static alert() 显示一个带关闭按钮的信息框。 See module:form.alert Source o2_core/o2/xScript/ViewEnvironment.js, line 3957 static notice() 显示一个信息框。 See module:form.notice Source o2_core/o2/xScript/ViewEnvironment.js, line 3967 static addEvent() 给视图添加事件。 See module:form.addEvent Source o2_core/o2/xScript/ViewEnvironment.js, line 3977 static openWork() 打开一个在流转或已完成的流程实例。 See module:form.openWork Source o2_core/o2/xScript/ViewEnvironment.js, line 3995 static openJob() 根据流程的jobId打开工作。 See module:form.openJob Source o2_core/o2/xScript/ViewEnvironment.js, line 4010 static openDocument() 打开一个内容管理文档。 See module:form.openDocument Source o2_core/o2/xScript/ViewEnvironment.js, line 4109 static openPortal() 打开一个门户页面。 See module:form.openPortal Source o2_core/o2/xScript/ViewEnvironment.js, line 4122 static openCMS() 打开一个内容管理栏目。 See module:form.openCMS Source o2_core/o2/xScript/ViewEnvironment.js, line 4154 static openProcess() 打开一个流程应用。 See module:form.openProcess Source o2_core/o2/xScript/ViewEnvironment.js, line 4172 static openApplication() 打开一个任意一个component应用。 See module:form.openApplication Source o2_core/o2/xScript/ViewEnvironment.js, line 4190 static createDocument() 创建一个内容管理文档。 See module:form.createDocument Source o2_core/o2/xScript/ViewEnvironment.js, line 4200 static startProcess() 启动一个流程实例。 See module:form.startProcess Source o2_core/o2/xScript/ViewEnvironment.js, line 4255 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-queryView.html":{"url":"module-queryView.html","title":"queryView","kind":"Module","body":" O2OA WebAPI: queryView | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetParentEnvironmentFgetViewInforFgetPageInforFgetPageDataFtoPageFselectAllFunSelectAllFgetSelectedDataFsetFilterFswitchViewFreloadFnodeFconfirmFalertFnoticeFaddEventFopenWorkFopenJobFopenDocumentFopenPortalFopenCMSFopenProcessFopenApplicationFcreateDocumentFstartProcess Module queryView queryView对象可在视图中可用。它的很多方法与form类似。（仅前端脚本可用） Usable Range QueryView Syntax //您可以在视图中，通过this来获取queryView对象，如下：\rvar queryView = this.queryView; Source o2_core/o2/xScript/ViewEnvironment.js, line 3558 Methods static getParentEnvironment() &rarr; {MWF.xScript.Environment|MWF.xScript.CMSEnvironment} 当视图被嵌入到门户页面、流程表单或内容管理表单的时候，可以通过这个方法来获取页面或表单的上下文。 Syntax this.queryView.getParentEnvironment(); Returns MWF.xScript.Environment MWF.xScript.CMSEnvironment 页面或表单的上下文. Example var env = this.queryView.getParentEnvironment(); //当视图被嵌入到页面的时候，可以在视图里获取页面的上下文\renv.page.toPortal( \"公文门户\" ); //调用page的toPage() 跳转到其他门户 Source o2_core/o2/xScript/ViewEnvironment.js, line 3568 static getViewInfor() &rarr; {Object} 获取查询的配置信息。 Syntax this.queryView.getViewInfor(); Returns Object 视图的配置信息. { \"application\": \"db9fc893-7dbc-4e0f-a617-99089d2c6323\", //视图所在应用 \"query\": \"db9fc893-7dbc-4e0f-a617-99089d2c6323\", //视图所在应用，同application \"name\": \"视图自定义测试\", //视图名称 \"viewName\": \"视图自定义测试\", //视图名称，同name \"isExpand\": \"no\", //如果有分类，默认是否展开开 \"id\": \"705ce967-2f9c-425c-8873-3bd729249e1d\", //视图id \"alias\": \"\", //视图别名 \"description\": \"\", //视图描述 \"display\": true, //视图是否显示 \"type\": \"cms\", //视图嵌入的数据类型, cms 或 process \"count\": 2000, //最多返回2000条 \"pageSize\": 20, //每页的条数 \"createTime\": \"2019-09-02 10:18:27\", \"updateTime\": \"2020-03-26 15:53:03\" } Source o2_core/o2/xScript/ViewEnvironment.js, line 3609 static getPageInfor() &rarr; {Object} 获取视图当前页的基本信息。 Syntax this.queryView.getPageInfor(); Returns Object 当前页的信息，格式如下: { \"pages\": 3, //总页数 \"perPageCount\": 50, //每页的条数 \"currentPageNumber\": 1 // 当前页数 } Source o2_core/o2/xScript/ViewEnvironment.js, line 3636 static getPageData() &rarr; {Array.&lt;Object>} 获取当前页的数据。 Syntax var data = this.queryView.getPageData(); Returns Array.&lt;Object> 当前页数据。 没有分类时候，数据格式如下： [ { \"bundle\": \"099ed3c9-dfbc-4094-a8b7-5bfd6c5f7070\", //cms 的 documentId, process 的 jobId \"data\": { //视图中配置的数据 \"title\": \"考勤管理-配置-统计周期设置\", //列名称及列值 \"time\": \"2018-08-25 11:29:45\" } }, ... ] 有分类的时候，数据格式如下： [ { \"group\": \"工作日志\", //分类1 \"list\": [ //分类下的数据 { \"bundle\": \"001257be-725a-43cf-9679-3892bbab696a\", //cms 的 documentId, process 的 jobId \"data\": { //视图中配置的数据 \"title\": \"标题\", //列名称及列值 \"time\": \"2018-07-31 15:39:13\", \"category\": \"工作日志\" } }, ... ] }, ... ] Source o2_core/o2/xScript/ViewEnvironment.js, line 3653 static toPage(pageNumber, callbackopt) 跳转到指定的页面。 Syntax var data = this.queryView.toPage( pageNumber, callback ); Parameters pageNumber Number 需要跳转的页码。 callback function &lt;optional&gt; 跳转的页面数据加载完成以后的回调方法。 Example //　跳转到第2页并且获取该页的数据。\rthis.queryView.toPage( 2, function(){\r var data = this.queryView.getPageData();\r}.bind(this) ) Source o2_core/o2/xScript/ViewEnvironment.js, line 3695 static selectAll() 当视图设置了允许多选的时候，可以通过这个方法全部选中当前页面的条目。 Syntax this.queryView.selectAll(); Source o2_core/o2/xScript/ViewEnvironment.js, line 3712 static unSelectAll() 当视图设置了允许多选的时候，可以通过这个方法取消选中的条目。 Syntax this.queryView.unSelectAll(); Source o2_core/o2/xScript/ViewEnvironment.js, line 3722 static getSelectedData() &rarr; {Array.&lt;Object>} 获取选中的条目的数据。 Syntax var data = this.queryView.getSelectedData(); Returns Array.&lt;Object> 选中的条目的数据。 格式如下： [ { \"bundle\": \"099ed3c9-dfbc-4094-a8b7-5bfd6c5f7070\", //cms 的 documentId, process 的 jobId \"data\": { //视图中配置的数据 \"title\": \"考勤管理-配置-统计周期设置\", //列名称及列值 \"time\": \"2018-08-25 11:29:45\" } }, ... ] Source o2_core/o2/xScript/ViewEnvironment.js, line 3732 static setFilter(filteropt, callbackopt) 设置视图的过滤条件，该方法不能修改视图中默认的过滤条件（在开发视图的时候添加的过滤条件），而是在这上面新增。 Syntax this.queryView.setFilter( filter ); Parameters filter Array.&lt;ViewFilter> | ViewFilter | Null &lt;optional&gt; 过滤条件。 当不传参数、参数为null或为空数组的情况下，表示清空非视图默认的过滤条件。 如果传入对象或者非空数组的时候，参数如下： [ { \"logic\":\"and\", \"path\":\"$work.title\", \"comparison\":\"like\", \"value\":\"7月\", \"formatType\":\"textValue\" } ] callback function &lt;optional&gt; 过滤完成并重新加载数据后的回调方法。 Source o2_core/o2/xScript/ViewEnvironment.js, line 3756 static switchView(options) 把当前视图切换成另外一个视图。 Syntax this.queryView.switchView( options ); Parameters options Object 需要跳转的参数配置。参数说明如下： 下列说明的filter属性参考ViewFilter { \"application\": application, //必选，视图的所在应用id \"viewName\": viewName, //必选，视图的名称 \"filter\": [ { \"logic\":\"and\", \"path\":\"$work.title\", \"comparison\":\"like\", \"value\":\"7月\", \"formatType\":\"textValue\" } ], //可选，增加视图的过滤条件（ViewFilter），如果不传，则使用原视图的配置；如果需要去掉原视图的配置，则传入空数组 [] \"isTitle\": \"yes\", //可选，是否显示t视图的标题行，可选值有:yes no \"select\": \"none\", //可选，是否允许新视图选择，如果不传，则使用原视图的配置, 可选值有： 不允许选择 none, 单选 single，多选 multi \"titleStyles\": { \"color\" : \"red\", \"font-size\" : \"14px\" }, //可选，标题行样式，如果不传，则使用原视图的配置 \"itemStyles\": { \"color\" : \"#333\", \"font-size\" : \"12px\" }, //可选，内容行样式，如果不传，则使用原视图的配置 \"isExpand\": \"no\", //可选，默认是否展开分类，如果不传，则使用原视图的配置, 可选值有:yes no } Source o2_core/o2/xScript/ViewEnvironment.js, line 3814 static reload() 重新加载视图。 Syntax this.queryView.reload(); Source o2_core/o2/xScript/ViewEnvironment.js, line 3888 static node() 获取queryView对应的DOM对象。 See module:form.node Source o2_core/o2/xScript/ViewEnvironment.js, line 3903 static confirm() 弹出一个确认框。 See module:form.confirm Source o2_core/o2/xScript/ViewEnvironment.js, line 3928 static alert() 显示一个带关闭按钮的信息框。 See module:form.alert Source o2_core/o2/xScript/ViewEnvironment.js, line 3957 static notice() 显示一个信息框。 See module:form.notice Source o2_core/o2/xScript/ViewEnvironment.js, line 3967 static addEvent() 给视图添加事件。 See module:form.addEvent Source o2_core/o2/xScript/ViewEnvironment.js, line 3977 static openWork() 打开一个在流转或已完成的流程实例。 See module:form.openWork Source o2_core/o2/xScript/ViewEnvironment.js, line 3995 static openJob() 根据流程的jobId打开工作。 See module:form.openJob Source o2_core/o2/xScript/ViewEnvironment.js, line 4010 static openDocument() 打开一个内容管理文档。 See module:form.openDocument Source o2_core/o2/xScript/ViewEnvironment.js, line 4109 static openPortal() 打开一个门户页面。 See module:form.openPortal Source o2_core/o2/xScript/ViewEnvironment.js, line 4122 static openCMS() 打开一个内容管理栏目。 See module:form.openCMS Source o2_core/o2/xScript/ViewEnvironment.js, line 4154 static openProcess() 打开一个流程应用。 See module:form.openProcess Source o2_core/o2/xScript/ViewEnvironment.js, line 4172 static openApplication() 打开一个任意一个component应用。 See module:form.openApplication Source o2_core/o2/xScript/ViewEnvironment.js, line 4190 static createDocument() 创建一个内容管理文档。 See module:form.createDocument Source o2_core/o2/xScript/ViewEnvironment.js, line 4200 static startProcess() 启动一个流程实例。 See module:form.startProcess Source o2_core/o2/xScript/ViewEnvironment.js, line 4255 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-session.html":{"url":"module-session.html","title":"session","kind":"Module","body":" O2OA WebAPI: session | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag Module session 在前端脚本中，可以通过this.session.user来获取当前用户信息。 Syntax var user = this.session.user; Returns Object 当前用户信息，内容和格式如下： { \"id\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\", //人员ID \"genderType\": \"m\", //性别 \"icon\": \"...\", //头像 \"signature\": \"\", //个人签名 \"name\": \"胡起\", //姓名 \"employee\": \"huqi\", //员工号 \"unique\": \"huqi\", //唯一标识 \"distinguishedName\": \"xx@huqi@P\", //人员全称 \"superior\": \"\", //上级人员id \"changePasswordTime\": \"2017-03-13\", //修改密码时间 \"lastLoginTime\": \"2019-01-02\", //最后登录时间 \"mail\": \"huqi@zoneland.net\", //邮件地址 \"weixin\": \"\", //微信号 \"qq\": \"\", //QQ \"mobile\": \"18057190078\", //手机号码 \"officePhone\": \"\", //办公电话 \"createTime\": \"2017-03-13 12:27:04\", //人员创建时间 \"updateTime\": \"2019-01-02 13:00:04\", //人员修改时间 \"token\": \"...\", //当前用户token \"roleList\": [ //人员角色 \"ProcessPlatformCreator@ProcessPlatformCreatorSystemRole@R\", \"ProcessPlatformManager@ProcessPlatformManagerSystemRole@R\", \"Manager@ManagerSystemRole@R\" ], \"identityList\": [ //人员身份列表 { \"id\": \"709328c8-44a0-4f5d-a3fa-3c31208232d5\", //身份ID \"name\": \"xx\", //身份名称 \"unique\": \"709328c8-44a0-4f5d-a3fa-3c31208232d5\", //身份唯一标识 \"distinguishedName\": \"xx@709328c8-44a0-4f5d-a3fa-3c31208232d5@I\", //身份全称 \"person\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\", //人员ID \"unit\": \"d5356fd4-6675-45ad-9a00-5eff20b83dfa\", //所属组织ID \"unitName\": \"开发部\", //所属组织名称 \"unitLevel\": 2, //所属组织层级 \"unitLevelName\": \"兰德纵横/开发部\", //所属组织层次名 \"major\": true //是否是主身份 }, { \"id\": \"343510af-57c2-4a55-a1f2-f30d7af6d284\", \"description\": \"\", \"name\": \"xx\", \"unique\": \"343510af-57c2-4a55-a1f2-f30d7af6d284\", \"distinguishedName\": \"xx@343510af-57c2-4a55-a1f2-f30d7af6d284@I\", \"person\": \"267a7bcc-f27a-49c8-8364-f1c12061085a\", \"unit\": \"108b1b7c-cc78-49ab-9ab1-e67073bd6541\", \"unitName\": \"开发部\", \"unitLevel\": 2, \"unitLevelName\": \"浙江兰德纵横/开发部\", \"major\": false } ] } Example //获取当前用户信息\rvar user = this.session.user Source o2_core/o2/xScript/ViewEnvironment.js, line 4329 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-Actions.html":{"url":"module-Actions.html","title":"Actions","kind":"Module","body":" O2OA WebAPI: Actions | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag FgetHostFloadFget Module Actions 本文档说明如何在前台脚本中使用Actions调用平台的RESTful服务。 通过访问以下地址来查询服务列表：http://server:20030/x_program_center/jest/list.html Syntax //获取Actions\rthis.Actions\r//或者\ro2.Actions Source o2_core/o2/xScript/ViewEnvironment.js, line 4398 Methods static getHost(root) &rarr; {String} 本平台不同的服务根可能对应不同的域名或端口，您可以使用this.Actions.getHost来获取服务跟对应的host。 Syntax var actions = this.Actions.getHost( root ); Parameters root String 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。 如: &quot;x_processplatform_assemble_surface&quot; //流程平台相关服务根 Returns String 对应服务跟对应的host。如：http://127.0.0.1:20020 Source o2_core/o2/xScript/ViewEnvironment.js, line 4410 load(root) &rarr; {Object} 平台预置了Actions对象用于调用平台提供的服务，您可以使用this.Actions.load来获取这些方法。 Syntax var actions = o2.Actions.load( root );\r//或\rvar actions = this.Actions.load( root ); //获取流程平台服务对象。\rvar processAction = this.Actions.load(\"x_processplatform_assemble_surface\"); \r 通过this.Actions.load(root)方法得到action对象，就可以访问此服务下的方法了。\r 访问方法的规则如下：\r var promise = this.Actions.load( root )[actionName][methodName]( arguements );\r\r promise : Promise对象，可以通过promise.then接收返回数据\r promise.then(\r function(json){\r //json为返回的数据\r }\r )\r\r root : 平台服务根名称，如果 x_processplatform_assemble_surface\r\r actionName : 服务下的Action分类名称，如 TaskAction\r\r methodName : Action分类下的方法名称，如 get\r\r arguements : 需调用的RESTful服务的相关参数。这些参数需要按照先后顺序传入。根据实际情况可以省略某些参数。参数序列分别是:\r\r uri的参数, data/formData(Post, Put方法), file(附件), success, failure, async。\r\r uri参数：如果有uri有多个参数，需要按先后顺序传入。\r\r data（formData）参数：提交到后台的数据，如果是上传附件，传入formData。POST 和 PUT 方法需要传入，GET方法和DELETE方法省略。\r\r file参数：POST 或者 PUT方法中有效，当需要上传附件时传入,否则可以省略。\r\r success参数：服务执行成功时的回调方法，形如 function(json){\r json为后台服务传回的数据\r }。\r\r failure 参数：服务执行失败时的回调方法，形如 function(xhr){\r xhr XmlHttpRequest对象，服务器请求失败时有值\r }\r 此参数可以省略，如果省略，系统会自动弹出错误信息。\r\r async : 方法同步或者异步执行，默认为true。 \r 处理返回的数据有两种方式，二选一即可：\r 1、该方法return的结果是Promise对象，可以通过 promise.then() 方法来处理。\r Promise说明\r 2、通过success方法作为第一个参数来处理结果\r promise.then(\r function(json){\r //json为返回的数据\r }\r )\r\r //success：arguements中的第一个function对象\r function(json){\r //json为后台服务传回的数据\r } Parameters root String 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。 如: \"x_processplatform_assemble_surface\" //流程平台相关服务根 Returns Object 返回action对象，用于后续服务调用 Examples \r 样例1:\r 根据x_processplatform_assemble_surface服务获取当前用户的待办列表：\r 可以通过对应服务的查询页面，http://server:20020/x_processplatform_assemble_surface/jest/index.html\r 可以看到以下界面：\r 我们可以找到TaskAction的V2ListPaging服务是列式当前用户待办的服务。\r 该服务有以下信息：\r 1、actionName是：TaskAction\r 2、methodName是：V2ListPaging\r 3、有两个url参数，分别是 page(分页), size(每页数量)\r 4、有一系列的body参数\r 5、该服务方法类型是POST\r 根据这些信息我们可以组织出下面的方法：\r var processAction = this.Actions.load(\"x_processplatform_assemble_surface\"); //获取action\rvar method = processAction.TaskAction.V2ListPaging; //获取列式方法\r//执行方法1\rmethod(\r 1, //uri 第1个参数，如果无uri参数，可以省略\r 20, //uri 第2个参数，如果无uri参数，可以省略，如果还有其他uri参数，可以用逗号, 分隔\r { //body 参数，对POST和PUT请求，该参数必须传，可以为空对象\r processList : [xxx] //具体参数\r },\r function(json){ //正确调用的回调\r //json.data得到服务返回数据\r },\r function(xhr){ //可选，错误调用的回调\r //xhr为XmlHttpRequest对象，服务器请求失败时有值\r var responseJSON = JSON.parse( xhr.responseText ) //xhr.responseText {String}是后台返回的出错信息\r //responseJSON见下面的说明\r\r var message = responseJSON.message; //message为错误提示文本\r },\r true //可选，true为异步调用，false为同步调用，默认为true\r);\r\r//执行方法2\rvar promise = method( 1, 20, {processList : [xxx]} )\rpromise.then( function(json){\r //json.data得到服务返回数据\r}) 出错信息responseJSON的格式 {\r \"type\": \"error\", //类型为错误\r \"message\": \"标识为:343434 的 Task 对象不存在.\", //提示文本\r \"date\": \"2020-12-29 17:02:13\", //出错时间\r \"prompt\": \"com.x.base.core.project.exception.ExceptionEntityNotExist\" //后台错误类\r} \r 样例2:\r 已知流程实例的workid，在脚本中获取数据，修改后进行保存。\r //查询服务列表找到获取data数据服务为DataAction的getWithWork方法\r//查询服务列表找到更新data数据服务为DataAction的updateWithWork方法\r\rvar workid = \"cce8bc22-225a-4f85-8132-7374d546886e\";\rvar data;\rthis.Actions.load(\"x_processplatform_assemble_surface\").DataAction.getWithWork( //平台封装好的方法\r workid, //uri的参数\r function( json ){ //服务调用成功的回调函数, json为服务传回的数据\r data = json.data; //为变量data赋值\r }.bind(this),\r false //同步执行\r)\r\rdata.subject = \"新标题\"; //修改数据\rthis.Actions.load(\"x_processplatform_assemble_surface\").DataAction.updateWithWork(\r workid, //uri的参数\r data, //保存的数据\r function(){ //服务调用成功的回调函数\r o2.xDesktop.notice(\"success\", {\"y\":\"top\", \"x\": \"right\"}, \"保存成功\"); //提示，{\"y\":\"top\", \"x\": \"right\"}指提示框在顶部右边\r }.bind(this)\r); Source o2_core/o2/xScript/ViewEnvironment.js, line 4424 get(root) &rarr; {String} 已过时。平台预置了Action的调用方法，您可以使用o2.Actions.get来获取这些方法。RESTful配置文件在{服务器目录}/webServer/o2_core/o2/xAction/services下。 Syntax var actions = o2.Actions.get( root );\ractions[ methodName ]( arguements );\r\ror\r\ro2.Actions.get( root )[methodName]( arguements ); methodName :（string）方法名称。\rarguements : 见load方法的arguements说明 Parameters root String 平台RESTful服务根，具体服务列表参见:http://server:20030/x_program_center/jest/list.html。 如: &quot;x_processplatform_assemble_surface&quot; //流程平台相关服务根 Deprecated Yes Returns String 对应服务根的host。如：http://127.0.0.1:20020 Examples 样例一:已知流程实例的workid，在脚本中获取数据，修改后进行保存。 //现已知获取数据的方法名称是 getWorkData uri为： /jaxrs/data/work/{workid}\r//已知更新数据的方法名称是 saveData uri为： /jaxrs/data/work/{workid}\rvar workid = \"cce8bc22-225a-4f85-8132-7374d546886e\";\rvar action = o2.Actions.get(\"x_processplatform_assemble_surface\");\rvar data;\raction.getWorkData( //平台封装好的方法\r workid, //uri的参数\r function( json ){ //服务调用成功的回调函数, json为服务传回的数据\r data = json.data; //为变量data赋值\r }.bind(this),\r false //同步执行\r);\rdata.subject = \"新标题\"; //修改数据\raction.saveData(\r workid, //uri的参数\r data, //保存的数据\r function(){ //服务调用成功的回调函数\r o2.xDesktop.notice(\"success\", {\"y\":\"top\", \"x\": \"right\"}, \"保存成功\"); //提示，{\"y\":\"top\", \"x\": \"right\"}指提示框在顶部右边\r }.bind(this)\r); 样例二:已知流程应用的workid，分页列式出流程实例。 //现已知获取数据的方法名称是 listWorkNext uri为： {\"uri\": \"/jaxrs/work/list/{id}/next/{count}/application/{applicationId}\"},\rvar id = \"(0)\"; //如果是第一页id是(0)，否则传上一页最后一个流程实例的id\rvar count = 10;\rvar applicationId = \"dde8bc22-225a-4f85-8132-7374d546886e\";\ro2.Actions.get(\"x_processplatform_assemble_surface\").listWorkNext(\r id, //listWorkNext服务有3个uri参数，要按先后顺序列出\r count,\r applicationId,\r function( json ){\r //json.data\r }.bind(this)\r); Source o2_core/o2/xScript/ViewEnvironment.js, line 4577 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "},"module-o2m.html":{"url":"module-o2m.html","title":"o2m","kind":"Module","body":" O2OA WebAPI: o2m | O2OA开发平台 O2OA前台API ModulesMdataMworkContextMdocumentContextMformMpageMqueryViewMviewMqueryStatementMstatementMorgMsessionMDictMActionsMincludeMdefineMo2mMwaitClassesFormComponentsC$InputC$ModuleCActionbarCAddressCAttachmentCButtonCCalendarCCheckboxCComboxCCommonCDatagridMobileCDatagridPCCDivCDocumenteditorCFormCPortalPageCHtmleditorCIframeCImageCImageClipperCLabelCLogCMonitorCNumberCOfficeCOpinionCOrgCRadioCSelectCSidebarCSourceCSourceTextCStatCStatementCStatementSelectorCSubformCSubSourceCTabCTableCTable$TdCTextareaCTextfieldCTreeCViewCViewSelectorCWidgetCAuthorCCommentCCMSFormCCMSLogCReaderGlobalsTDatagridDataTTreeDataTViewFilterTStatementFilterTStatementParameterTGroupFlagTPersonFlagTRoleFlagTIdentityFlagTUnitFlag notificationFalertFconfirmFpromptFvibrateFtoastFactionSheetFshowLoadingFhideLoadingutil.dateFdatePickerFtimePickerFdateTimePickerFchooseOneDayFchooseDateTimeFchooseIntervalutil.deviceFgetPhoneInfoFscanFlocationutil.navigationFsetTitleFcloseFgoBackbizFworkCloseFdepartmentsPickerFIdentityPickerFGroupPickerFPersonPickerFComplexPicker Module o2m o2m 是O2OA移动端APP提供的调用原生控件的能力，帮助开发者高效使用拍照、定位等手机系统的能力，同时可以直接使用扫一扫、打开原生应用、选择时间，人员，组织等业务的能力，带给门户接近原生代码的体验 o2m 只有在O2OA移动端APP中才能提供能力 Usable Range 流程表单 门户 Syntax // 可以在移动端 流程表单、门户 上使用\rthis.o2m Source x_desktop/js/o2m.api.js, line 30 Methods static alert(obj) 原生Alert提示弹出窗 Parameters obj Object 提示窗传入对象 { \"title\": \"提示\", //消息标题，可为空 \"message\": \"这里是消息内容\", //消息内容 \"buttonName\": \"确定\", //确定按钮名称 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.notification.alert({\r message: \"亲爱的\",\r title: \"提示\",//可传空\r buttonName: \"收到\",\r onSuccess : function() {//onSuccess将在点击button之后回调},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 114 static confirm(obj) 原生confirm提示弹出窗 Parameters obj Object 提示窗传入对象 { \"title\": \"提示\", //消息标题，可为空 \"message\": \"这里是消息内容\", //消息内容 \"buttonLabels\": [\"确定\", \"取消\"], //按钮名称 Array[String] \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.notification.confirm({\r message: \"你爱我吗\",\r title: \"提示\",//可传空\r buttonLabels: ['爱', '不爱'],\r onSuccess : function(buttonIndex) {\r //onSuccess将在点击button之后回调\r //buttonIndex: 0 被点击按钮的索引值，Number类型，从0开始\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 175 static prompt(obj) 原生prompt提示弹出窗 Parameters obj Object prompt需要传入对象 { \"title\": \"提示\", //消息标题，可为空 \"message\": \"这里是消息内容\", //消息内容 \"buttonLabels\": ['继续', '不玩了'], //按钮名称 Array[String] \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.notification.prompt({\r message: \"再说一遍？\",\r title: \"提示\",//可传空\r buttonLabels: ['继续', '不玩了'],\r onSuccess : function(result) {\r //result是一个字符串，格式是json格式，内容如下：\r //{\r // buttonIndex: 0, //被点击按钮的索引值，Number类型，从0开始\r // value: '' //输入的值\r //}\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 239 static vibrate(obj) 手机震动 Parameters obj Object 震动需要传入对象 { \"duration\": 300, //震动时间，android可配置 iOS忽略 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.notification.vibrate({\r duration: 300, \r onSuccess : function() {\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 297 static toast(obj) toast提示 Parameters obj Object toast需要传入对象 { \"message\": \"这里是提示信息\", \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.notification.toast({\r message: \"提示消息内容\", \r onSuccess : function() {\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 346 static actionSheet(obj) 底部弹出菜单 Parameters obj Object actionSheet需要传入对象 { \"title\": \"谁是最棒哒？\",//标题 \"cancelButton\": '取消', //取消按钮文本 \"otherButtons\": [\"孙悟空\",\"猪八戒\",\"唐僧\",\"沙和尚\"], //其他选项按钮名称 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.notification.actionSheet({\r title: \"谁是最棒哒？\", //标题\r cancelButton: '取消', //取消按钮文本\r otherButtons: [\"孙悟空\",\"猪八戒\",\"唐僧\",\"沙和尚\"],\r onSuccess : function(buttonIndex) {\r //buttonIndex: 0 被点击按钮的索引值，Number，从0开始, 取消按钮为-1\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 400 static showLoading(obj) 显示Loading浮层，请和hideLoading配合使用 Parameters obj Object showLoading需要传入对象 { text: \"使劲加载中..\", //loading显示的字符，空表示不显示文字 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.notification.showLoading({\r text: \"使劲加载中..\", //loading显示的字符，空表示不显示文字\r onSuccess : function() {\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 451 static hideLoading(obj) 隐藏Loading浮层 Parameters obj Object hideLoading需要传入对象 { \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.notification.hideLoading({\r onSuccess : function() {\r},\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 495 static datePicker(obj) 日期选择器 Parameters obj Object datePicker需要传入对象 { value: '2019-04-17', //默认显示日期 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.datePicker({\rvalue: '2019-04-17', //默认显示日期\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r value: \"2019-02-10\"\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 587 static timePicker(obj) 时间选择器 Parameters obj Object timePicker需要传入对象 { value: '14:00', //默认显示时间 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.timePicker({\rvalue: '14:00', //默认显示时间\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r value: \"18:10\"\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 636 static dateTimePicker(obj) 日期时间选择器 Parameters obj Object dateTimePicker需要传入对象 { value: '2019-05-05 14:00', //默认显示时间 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.dateTimePicker({\rvalue: '2019-05-05 14:00', //默认显示时间\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r value: \"2019-03-18 18:10\"\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 687 static chooseOneDay(obj) 月历日期选择器 Parameters obj Object chooseOneDay需要传入对象 { value: '2019-05-05', //默认显示日期 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.chooseOneDay({\rvalue: '2019-05-05', //默认显示日期\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r value: \"2019-03-18\"\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 738 static chooseDateTime(obj) 月历日期时间选择器 Parameters obj Object chooseDateTime需要传入对象 { value: '2019-05-05 11:00', //默认显示时间 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.chooseDateTime({\rvalue: '2019-05-05 11:00', //默认显示时间\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r value: \"2019-03-18 18:45\"\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 788 static chooseInterval(obj) 月历日期区间选择器 Parameters obj Object chooseInterval需要传入对象 { startDate: '2019-05-05', endDate: '2019-05-06', \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.util.date.chooseInterval({\rvalue: '2019-05-05 11:00', //默认显示时间\ronSuccess : function(result) {\r //onSuccess将在点击完成之后回调\r {\r startDate: \"2019-05-05\", \r endDate: \"2019-05-06\",\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 840 static getPhoneInfo(obj) 获取手机基础信息 Parameters obj Object getPhoneInfo需要传入对象 { \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.util.device.getPhoneInfo({\ronSuccess : function(result) {\r {\r screenWidth: 1080, // 手机屏幕宽度\r screenHeight: 1920, // 手机屏幕高度\r brand:'Mi'， // 手机品牌\r model:'Note4', // 手机型号\r version:'7.0'. // 版本\r netInfo:'wifi' , // 网络类型 wifi／4g／3g \r operatorType :'xx' // 运营商信息\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 891 static scan(obj) 扫二维码 Parameters obj Object scan需要传入对象 { \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.util.device.scan({\ronSuccess : function(result) {\r { 'text': '扫码内容'}\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 939 static location(obj) 单次定位 Parameters obj Object location需要传入对象 { \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.util.device.location({\ronSuccess : function(result) {\r //这里返回百度坐标系的定位信息 \r { \r 'latitude': 39.903578, // 纬度\r 'longitude': 116.473565, // 经度\r 'address': '地址描述'\r }\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 979 static setTitle(obj) 设置原生页面标题 Parameters obj Object setTitle需要传入对象 { title : '导航标题', \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example o2m.util.navigation.setTitle({\rtitle : '导航标题', \ronSuccess : function() {\r },\r onFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1025 static close() 关闭当前原生页面 Example o2m.util.navigation.close(); Source x_desktop/js/o2m.api.js, line 1065 static goBack() 返回上级原生页面 Example o2m.util.navigation.goBack(); Source x_desktop/js/o2m.api.js, line 1094 static workClose() 关闭当前工作页面，只能在工作表单中可以使用 Example o2m.biz.workClose(); Source x_desktop/js/o2m.api.js, line 1149 static departmentsPicker(obj) 通讯录选部门 Parameters obj Object departmentsPicker需要传入对象 { topList: [],//Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织 orgType: \"\",//String 可选择的组织类别。为空就是全部组织类型都可以 multiple:true, //是否多选 maxNumber: 0, //Int 当multiple为true的时候，最多可选择的部门数 pickedDepartments:[],//Array[String] 已经选择的部门distinguishedName列表 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.biz.contact.departmentsPicker({\rtopList: [],//不传或者空列表，显示全部组织\rorgType: \"\",//可传空 只显示某种类型的组织\rmultiple:true, //是否多选\rmaxNumber: 0, //最大选择数量\rpickedDepartments:[],//已选部门\ronSuccess : function(result) {\r //返回结果样例\r {\r departments:[{\r \"id\":\"xxxx\",\r \"name\":\"部门名称\", \r \"unique\":\"xxxx\",\r \"distinguishedName\":\"部门@xxxx@U\",\r \"typeList\":[\"xxxx\"],\r \"shortName\":\"xxxx\",\r \"level\": 0,\r \"levelName\":\"xxxx\",\r }]\r }\r \r},\ronFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1188 static IdentityPicker(obj) 通讯录选身份 Parameters obj Object IdentityPicker需要传入对象 { topList: [],//Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织 multiple:true, //Boolean 是否多选 maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数 pickedIdentities:[],//Array[String] 已经选择的身份distinguishedName列表 duty: [],//Array[String] 可选择的人员职责 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.biz.contact.IdentityPicker({\rtopList: [],//不传或者空列表，显示全部组织\rmultiple:true, //是否多选\rmaxNumber: 0, //最大选择数量\rpickedIdentities:[],//已选身份列表\rduty: [],//人员职责\ronSuccess : function(result) {\r //返回结果样例\r {\r identities:[{\r \"id\":\"xxxx\",\r \"name\":\"姓名\", \r \"distinguishedName\":\"姓名@xxxx@I\",\r \"person\":\"xxx\", \r \"unique\":\"xxxx\",\r \"unit\":\"xxx\",\r \"unitName\":\"xxxx\",\r \"unitLevel\": 0,\r \"unitLevelName\":\"xxxx\",\r \"personName\":\"xxxx\",\r \"personUnique\":\"xxx\",\r \"personDn\":\"xxx\"\r }]\r }\r \r},\ronFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1264 static GroupPicker(obj) 群组选择 Parameters obj Object GroupPicker需要传入对象 { multiple:true, //Boolean 是否多选 maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数 pickedGroups:[],//Array[String] 已经选择的群组distinguishedName列表 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.biz.contact.GroupPicker({\rmultiple:true, //是否多选\rmaxNumber: 0, //最大选择数量\rpickedGroups:[],//已选群组列表\ronSuccess : function(result) {\r //返回结果样例\r {\r groups:[{\r \"id\":\"xxxx\", \r \"name\":\"群组名称\", \r \"distinguishedName\":\"群组名称@xxxx@G\"\r \"unique\":\"xxxx\", \r }]\r }\r \r},\ronFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1341 static PersonPicker(obj) 人员选择 Parameters obj Object PersonPicker需要传入对象 { multiple:true, //Boolean 是否多选 maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数 pickedUsers:[],//Array[String] 已经选择的人员distinguishedName列表 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.biz.contact.PersonPicker({\rmultiple:true, //是否多选\rmaxNumber: 0, //最大选择数量\rpickedUsers:[],//已选人员列表\ronSuccess : function(result) {\r //返回结果样例\r {\r users:[{\r \"id\":\"xxx\", \r \"name\":\"姓名\", \r \"unique\":\"xxx\", \r \"distinguishedName\":\"姓名@xxxx@P\"\r \"genderType\":\"xxx\", \r \"employee\":\"xxx\", \r \"mail\":\"xxx\", \r \"weixin\":\"xxx\", \r \"qq\":\"xxx\", \r \"mobile\":\"xxx\", \r \"officePhone\":\"xxx\"\r }]\r }\r \r},\ronFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1405 static ComplexPicker(obj) 复合选择器，可配置选择多种数据 Parameters obj Object ComplexPicker需要传入对象 { pickMode: [\"departmentPicker\", \"identityPicker\"], //Array[String] 选择器类型，可传入值：departmentPicker、identityPicker、groupPicker、personPicker topList：Array[String] 可选的顶级组织列表，不传或列表为空的时候，显示全部组织 duty: Array[String] 可选择的人员职责 orgType：String 可选择的组织类别。为空就是全部组织类型都可以 multiple:true, //Boolean 是否多选 maxNumber: 0, //Int 当multiple为true的时候，最多可选择的身份数 pickedDepartments：Array[String] 已经选择的部门distinguishedName列表 pickedIdentities：Array[String] 已经选择的身份distinguishedName列表 pickedGroups： Array[String] 已经选择的群组distinguishedName列表 pickedUsers:[],//Array[String] 已经选择的人员distinguishedName列表 \"onSuccess\": function, //成功回调 \"onFail\": function, //失败回调 } Example \r样例效果：\r\r o2m.biz.contact.ComplexPicker({\rpickMode: [\"departmentPicker\", \"identityPicker\"], //选择器类型\rtopList: [],//不传或者空列表，显示全部组织\rorgType: \"\",//可传空 只显示某种类型的组织\rduty: [],//人员职责\rmultiple:true, //是否多选\rmaxNumber: 0, //最大选择数量\rpickedDepartments:[],//已选部门\rpickedIdentities:[],//已选身份列表\rpickedGroups:[],//已选群组列表\rpickedUsers:[],//已选人员列表\ronSuccess : function(result) {\r //返回结果样例\r {\r departments:[{\r \"id\":\"xxxx\",\r \"name\":\"部门名称\", \r \"unique\":\"xxxx\",\r \"distinguishedName\":\"部门@xxxx@U\",\r \"typeList\":[\"xxxx\"],\r \"shortName\":\"xxxx\",\r \"level\": 0,\r \"levelName\":\"xxxx\",\r }],\r identities:[{\r \"id\":\"xxxx\",\r \"name\":\"姓名\", \r \"distinguishedName\":\"姓名@xxxx@I\",\r \"person\":\"xxx\", \r \"unique\":\"xxxx\",\r \"unit\":\"xxx\",\r \"unitName\":\"xxxx\",\r \"unitLevel\": 0,\r \"unitLevelName\":\"xxxx\",\r \"personName\":\"xxxx\",\r \"personUnique\":\"xxx\",\r \"personDn\":\"xxx\"\r }],\r groups:[{\r \"id\":\"xxxx\", \r \"name\":\"群组名称\", \r \"distinguishedName\":\"群组名称@xxxx@G\"\r \"unique\":\"xxxx\", \r }],\r users:[{\r \"id\":\"xxx\", \r \"name\":\"姓名\", \r \"unique\":\"xxx\", \r \"distinguishedName\":\"姓名@xxxx@P\"\r \"genderType\":\"xxx\", \r \"employee\":\"xxx\", \r \"mail\":\"xxx\", \r \"weixin\":\"xxx\", \r \"qq\":\"xxx\", \r \"mobile\":\"xxx\", \r \"officePhone\":\"xxx\"\r }]\r }\r},\ronFail : function(err) {}\r}); Source x_desktop/js/o2m.api.js, line 1490 Documentation generated by JSDoc 3.6.6 on Tue Feb 23 2021 17:06:17 GMT+0800 (GMT+08:00) "}}