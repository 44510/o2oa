<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="main" default="default">
	<property name="VERSION" value="4.3.6" />
	<property name="targetdir" value="target"/>
	<target name="default" depends="md5code" />
	<target name="md5code" depends="default_zip">
		<checksum file="o2server-windows-${VERSION}.zip" property="build_win.sha" algorithm="SHA-256" />
		<length file="o2server-windows-${VERSION}.zip" property="length_win"/>
		<script language="javascript">
		<![CDATA[
			var length_win_bytes = project.getProperty("length_win");
			var length_win_kbytes = Math.round((length_win_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_win_mbytes = Math.round((length_win_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_win_mb", length_win_mbytes);
		]]>
		</script>
		<checksum file="o2server-linux-${VERSION}.zip" property="build_linux.sha" algorithm="SHA-256" />
		<length file="o2server-linux-${VERSION}.zip" property="length_linux"/>
		<script language="javascript">
		<![CDATA[
			var length_linux_bytes = project.getProperty("length_linux");
			var length_linux_kbytes = Math.round((length_linux_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_linux_mbytes = Math.round((length_linux_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_linux_mb", length_linux_mbytes);
		]]>
		</script>
		<checksum file="o2server-macos-${VERSION}.zip" property="build_macos.sha" algorithm="SHA-256" />
		<length file="o2server-macos-${VERSION}.zip" property="length_macos"/>
		<script language="javascript">
		<![CDATA[
			var length_macos_bytes = project.getProperty("length_macos");
			var length_macos_kbytes = Math.round((length_macos_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_macos_mbytes = Math.round((length_macos_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_macos_mb", length_macos_mbytes);
		]]>
		</script>
		<checksum file="o2server-aix-${VERSION}.zip" property="build_aix.sha" algorithm="SHA-256" />
		<length file="o2server-aix-${VERSION}.zip" property="length_aix"/>
		<script language="javascript">
		<![CDATA[
			var length_aix_bytes = project.getProperty("length_aix");
			var length_aix_kbytes = Math.round((length_aix_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_aix_mbytes = Math.round((length_aix_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_aix_mb", length_aix_mbytes);
		]]>
		</script>
		<checksum file="o2server-raspberrypi-${VERSION}.zip" property="build_raspberrypi.sha" algorithm="SHA-256" />
		<length file="o2server-raspberrypi-${VERSION}.zip" property="length_raspberrypi"/>
		<script language="javascript">
		<![CDATA[
			var length_raspberrypi_bytes = project.getProperty("length_raspberrypi");
			var length_raspberrypi_kbytes = Math.round((length_raspberrypi_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_raspberrypi_mbytes = Math.round((length_raspberrypi_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_raspberrypi_mb", length_raspberrypi_mbytes);
		]]>
		</script>
		<checksum file="o2server-neokylin-loongson-${VERSION}.zip" property="build_neokylin-loongson.sha" algorithm="SHA-256" />
		<length file="o2server-neokylin-loongson-${VERSION}.zip" property="length_neokylin-loongson"/>
		<script language="javascript">
		<![CDATA[
			var length_neokylin_loongson_bytes = project.getProperty("length_neokylin-loongson");
			var length_neokylin_loongson_kbytes = Math.round((length_neokylin_loongson_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_neokylin_loongson_mbytes = Math.round((length_neokylin_loongson_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_neokylin-loongson_mb", length_neokylin_loongson_mbytes);
		]]>
		</script>
		<checksum file="o2server-kylinos-phytium-${VERSION}.zip" property="build_kylinos_phytium.sha" algorithm="SHA-256" />
		<length file="o2server-kylinos-phytium-${VERSION}.zip" property="length_kylinos_phytium"/>
		<script language="javascript">
		<![CDATA[
			var length_kylinos_phytium_bytes = project.getProperty("length_kylinos_phytium");
			var length_kylinos_phytium_kbytes = Math.round((length_kylinos_phytium_bytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			var length_kylinos_phytium_mbytes = Math.round((length_kylinos_phytium_kbytes / 1024) * Math.pow(10,2))/ Math.pow(10,2);
			project.setNewProperty("length_kylinos_phytium_mb", length_kylinos_phytium_mbytes);
		]]>
		</script>
		<tstamp>
			<format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss"/>
		</tstamp>
		<echo file="download_preview.jsonp">callback(
		{
		  "windows": {
			"system": "windows",
			"name": "o2server-windows-${VERSION}",
			"fileName": "o2server-windows-${VERSION}.zip",
			"fileSize": "${length_win_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-windows-${VERSION}.zip",
			"sha256": "${build_win.sha}"
		  },
		  "linux": {
			"system": "linux",
			"name": "o2server-linux-${VERSION}",
			"fileName": "o2server-linux-${VERSION}.zip",
			"fileSize": "${length_linux_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-linux-${VERSION}.zip",
			"sha256": "${build_linux.sha}"
		  },
		  "macos": {
			"system": "macos",
			"name": "o2server-macos-${VERSION}",
			"fileName": "o2server-macos-${VERSION}.zip",
			"fileSize": "${length_macos_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-macos-${VERSION}.zip",
			"sha256": "${build_macos.sha}"
		  },
		  "aix": {
			"system": "aix",
			"name": "o2server-aix-${VERSION}",
			"fileName": "o2server-aix-${VERSION}.zip",
			"fileSize": "${length_aix_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-aix-${VERSION}.zip",
			"sha256": "${build_aix.sha}"
		  },
		  "raspberrypi": {
			"system": "raspberrypi",
			"name": "o2server-raspberrypi-${VERSION}",
			"fileName": "o2server-raspberrypi-${VERSION}.zip",
			"fileSize": "${length_raspberrypi_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-raspberrypi-${VERSION}.zip",
			"sha256": "${build_raspberrypi.sha}"
		  },
		  "neokylin_loongson": {
			"system": "neokylin_loongson",
			"name": "o2server-neokylin-loongson-${VERSION}",
			"fileName": "o2server-neokylin-loongson-${VERSION}.zip",
			"fileSize": "${length_neokylin-loongson_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-neokylin-loongson-${VERSION}.zip",
			"sha256": "${build_neokylin-loongson.sha}"
		  },
		  "kylinos_phytium": {
			"system": "kylinos_phytium",
			"name": "o2server-kylinos-phytium-${VERSION}",
			"fileName": "o2server-kylinos-phytium-${VERSION}.zip",
			"fileSize": "${length_kylinos_phytium_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-kylinos-phytium-${VERSION}.zip",
			"sha256": "${build_kylinos_phytium.sha}"
		  },
		  "jvm_windows": {}
		}
		)</echo>
		<echo file="download-pro.json">{
		  "title": "O2OA V${VERSION}",
		  "publishTime": "${TODAY}",
		  "windows": {
			"system": "windows",
			"name": "o2server-windows-${VERSION}",
			"fileName": "o2server-windows-${VERSION}.zip",
			"fileSize": "${length_win_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-windows-${VERSION}.zip",
			"sha256": "${build_win.sha}"
		  },
		  "linux": {
			"system": "linux",
			"name": "o2server-linux-${VERSION}",
			"fileName": "o2server-linux-${VERSION}.zip",
			"fileSize": "${length_linux_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-linux-${VERSION}.zip",
			"sha256": "${build_linux.sha}"
		  },
		  "macos": {
			"system": "macos",
			"name": "o2server-macos-${VERSION}",
			"fileName": "o2server-macos-${VERSION}.zip",
			"fileSize": "${length_macos_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-macos-${VERSION}.zip",
			"sha256": "${build_macos.sha}"
		  },
		  "aix": {
			"system": "aix",
			"name": "o2server-aix-${VERSION}",
			"fileName": "o2server-aix-${VERSION}.zip",
			"fileSize": "${length_aix_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-aix-${VERSION}.zip",
			"sha256": "${build_aix.sha}"
		  },
		  "raspberrypi": {
			"system": "raspberrypi",
			"name": "o2server-raspberrypi-${VERSION}",
			"fileName": "o2server-raspberrypi-${VERSION}.zip",
			"fileSize": "${length_raspberrypi_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-raspberrypi-${VERSION}.zip",
			"sha256": "${build_raspberrypi.sha}"
		  },
		  "neokylin_loongson": {
			"system": "neokylin_loongson",
			"name": "o2server-neokylin-loongson-${VERSION}",
			"fileName": "o2server-neokylin-loongson-${VERSION}.zip",
			"fileSize": "${length_neokylin-loongson_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-neokylin-loongson-${VERSION}.zip",
			"sha256": "${build_neokylin-loongson.sha}"
		  },
		  "kylinos_phytium": {
			"system": "kylinos_phytium",
			"name": "o2server-kylinos-phytium-${VERSION}",
			"fileName": "o2server-kylinos-phytium-${VERSION}.zip",
			"fileSize": "${length_kylinos_phytium_mb}MB",
			"updateTime": "${TODAY}",
			"url": "/download/o2server-kylinos-phytium-${VERSION}.zip",
			"sha256": "${build_kylinos_phytium.sha}"
		  },
		  "source":{
			"name":"o2oa-master",
			"updateTime":"${TODAY}",
			"fileSize":"990MB",
			"url":"https://github.com/o2oa/o2oa"
		  }
		}</echo>
	</target>
	<target name="default_zip" depends="version_o2,zip_windows,zip_linux,zip_macos,zip_aix,zip_raspberrypi,zip_neokylin_loongson,zip_kylinos_phytium" />
	<target name="version_o2">
		<tstamp>
			<format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss"/>
		</tstamp>
		<echo file="${targetdir}/version.o2">{"version":"${VERSION}","date":"${TODAY}"}</echo>
	</target>
	<target name="zip_windows">
		<zip encoding="utf-8" destfile="o2server-windows-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/windows/"/>
				<include name="service_windows.bat"/>
				<include name="start_windows.bat"/>
				<include name="start_windows_debug.bat"/>
				<include name="console_windows.bat"/>
				<include name="stop_windows.bat"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_linux">
		<zip encoding="utf-8" destfile="o2server-linux-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/linux/"/>
				<include name="start_linux.sh"/>
				<include name="start_linux_debug.sh"/>
				<include name="console_linux.sh"/>
				<include name="stop_linux.sh"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_macos">
		<zip encoding="utf-8" destfile="o2server-macos-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/macos/"/>
				<include name="start_macos.sh"/>
				<include name="start_macos_debug.sh"/>
				<include name="console_macos.sh"/>
				<include name="stop_macos.sh"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_aix">
		<zip encoding="utf-8" destfile="o2server-aix-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/aix/"/>
				<include name="start_aix.sh"/>
				<include name="start_aix_debug.sh"/>
				<include name="console_aix.sh"/>
				<include name="stop_aix.sh"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_raspberrypi">
		<zip encoding="utf-8" destfile="o2server-raspberrypi-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/raspberrypi/"/>
				<include name="start_raspberrypi.sh"/>
				<include name="start_raspberrypi_debug.sh"/>
				<include name="console_raspberrypi.sh"/>
				<include name="stop_raspberrypi.sh"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_neokylin_loongson">
		<zip encoding="utf-8" destfile="o2server-neokylin-loongson-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/neokylin_loongson/"/>
				<include name="start_neokylin_loongson.sh"/>
				<include name="start_neokylin_loongson_debug.sh"/>
				<include name="console_neokylin_loongson.sh"/>
				<include name="stop_neokylin_loongson.sh"/>
			</zipfileset>
		</zip>
	</target>
	<target name="zip_kylinos_phytium">
		<zip encoding="utf-8" destfile="o2server-kylinos-phytium-${VERSION}.zip" update="false">
			<zipfileset dir="${targetdir}/o2server" filemode="777" dirmode="777" encoding="utf-8" prefix="o2server">
				<include name="commons/"/>
				<include name="configSample/"/>
				<include name="localSample/"/>
				<include name="servers/"/>
				<include name="store/"/>
				<include name="console.jar"/>
				<include name="index.html"/>
				<include name="version.o2"/>
				<include name="console.jar"/>
				<include name="jvm/kylinos_phytium/"/>
				<include name="start_kylinos_phytium.sh"/>
				<include name="start_kylinos_phytium_debug.sh"/>
				<include name="console_kylinos_phytium.sh"/>
				<include name="stop_kylinos_phytium.sh"/>
			</zipfileset>
		</zip>
	</target>
</project>